var S3e=Object.defineProperty;var w3e=(Xr,To,en)=>To in Xr?S3e(Xr,To,{enumerable:!0,configurable:!0,writable:!0,value:en}):Xr[To]=en;var Ls=(Xr,To,en)=>w3e(Xr,typeof To!="symbol"?To+"":To,en);try{let Xr=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},To=new Xr.Error().stack;To&&(Xr._sentryDebugIds=Xr._sentryDebugIds||{},Xr._sentryDebugIds[To]="90c461c3-84cb-4564-9641-eb0773956854",Xr._sentryDebugIdIdentifier="sentry-dbid-90c461c3-84cb-4564-9641-eb0773956854")}catch{}(function(){"use strict";var AN,yN;var Xr=typeof document<"u"?document.currentScript:null;/**
* @vue/shared v3.5.23
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function To(n){const e=Object.create(null);for(const t of n.split(","))e[t]=1;return t=>t in e}const en={},Tc=[],aa=()=>{},px=()=>!1,hp=n=>n.charCodeAt(0)===111&&n.charCodeAt(1)===110&&(n.charCodeAt(2)>122||n.charCodeAt(2)<97),i_=n=>n.startsWith("onUpdate:"),br=Object.assign,a_=(n,e)=>{const t=n.indexOf(e);t>-1&&n.splice(t,1)},EN=Object.prototype.hasOwnProperty,vn=(n,e)=>EN.call(n,e),_t=Array.isArray,Ic=n=>Td(n)==="[object Map]",Rc=n=>Td(n)==="[object Set]",mx=n=>Td(n)==="[object Date]",Lt=n=>typeof n=="function",Yn=n=>typeof n=="string",Ni=n=>typeof n=="symbol",wn=n=>n!==null&&typeof n=="object",gx=n=>(wn(n)||Lt(n))&&Lt(n.then)&&Lt(n.catch),_x=Object.prototype.toString,Td=n=>_x.call(n),CN=n=>Td(n).slice(8,-1),vx=n=>Td(n)==="[object Object]",s_=n=>Yn(n)&&n!=="NaN"&&n[0]!=="-"&&""+parseInt(n,10)===n,Id=To(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),pp=n=>{const e=Object.create(null);return(t=>e[t]||(e[t]=n(t)))},SN=/-\w/g,Qo=pp(n=>n.replace(SN,e=>e.slice(1).toUpperCase())),wN=/\B([A-Z])/g,Ps=pp(n=>n.replace(wN,"-$1").toLowerCase()),mp=pp(n=>n.charAt(0).toUpperCase()+n.slice(1)),l_=pp(n=>n?`on${mp(n)}`:""),Io=(n,e)=>!Object.is(n,e),gp=(n,...e)=>{for(let t=0;t<n.length;t++)n[t](...e)},Ax=(n,e,t,r=!1)=>{Object.defineProperty(n,e,{configurable:!0,enumerable:!1,writable:r,value:t})},_p=n=>{const e=parseFloat(n);return isNaN(e)?n:e},MN=n=>{const e=Yn(n)?Number(n):NaN;return isNaN(e)?n:e};let yx;const vp=()=>yx||(yx=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function Rd(n){if(_t(n)){const e={};for(let t=0;t<n.length;t++){const r=n[t],o=Yn(r)?LN(r):Rd(r);if(o)for(const i in o)e[i]=o[i]}return e}else if(Yn(n)||wn(n))return n}const TN=/;(?![^(]*\))/g,IN=/:([^]+)/,RN=/\/\*[^]*?\*\//g;function LN(n){const e={};return n.replace(RN,"").split(TN).forEach(t=>{if(t){const r=t.split(IN);r.length>1&&(e[r[0].trim()]=r[1].trim())}}),e}function Qt(n){let e="";if(Yn(n))e=n;else if(_t(n))for(let t=0;t<n.length;t++){const r=Qt(n[t]);r&&(e+=r+" ")}else if(wn(n))for(const t in n)n[t]&&(e+=t+" ");return e.trim()}const PN=To("itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly");function bx(n){return!!n||n===""}function DN(n,e){if(n.length!==e.length)return!1;let t=!0;for(let r=0;t&&r<n.length;r++)t=Ld(n[r],e[r]);return t}function Ld(n,e){if(n===e)return!0;let t=mx(n),r=mx(e);if(t||r)return t&&r?n.getTime()===e.getTime():!1;if(t=Ni(n),r=Ni(e),t||r)return n===e;if(t=_t(n),r=_t(e),t||r)return t&&r?DN(n,e):!1;if(t=wn(n),r=wn(e),t||r){if(!t||!r)return!1;const o=Object.keys(n).length,i=Object.keys(e).length;if(o!==i)return!1;for(const a in n){const s=n.hasOwnProperty(a),l=e.hasOwnProperty(a);if(s&&!l||!s&&l||!Ld(n[a],e[a]))return!1}}return String(n)===String(e)}function c_(n,e){return n.findIndex(t=>Ld(t,e))}const xx=n=>!!(n&&n.__v_isRef===!0),Ae=n=>Yn(n)?n:n==null?"":_t(n)||wn(n)&&(n.toString===_x||!Lt(n.toString))?xx(n)?Ae(n.value):JSON.stringify(n,Ex,2):String(n),Ex=(n,e)=>xx(e)?Ex(n,e.value):Ic(e)?{[`Map(${e.size})`]:[...e.entries()].reduce((t,[r,o],i)=>(t[u_(r,i)+" =>"]=o,t),{})}:Rc(e)?{[`Set(${e.size})`]:[...e.values()].map(t=>u_(t))}:Ni(e)?u_(e):wn(e)&&!_t(e)&&!vx(e)?String(e):e,u_=(n,e="")=>{var t;return Ni(n)?`Symbol(${(t=n.description)!=null?t:e})`:n};/**
* @vue/reactivity v3.5.23
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let qr;class Cx{constructor(e=!1){this.detached=e,this._active=!0,this._on=0,this.effects=[],this.cleanups=[],this._isPaused=!1,this.parent=qr,!e&&qr&&(this.index=(qr.scopes||(qr.scopes=[])).push(this)-1)}get active(){return this._active}pause(){if(this._active){this._isPaused=!0;let e,t;if(this.scopes)for(e=0,t=this.scopes.length;e<t;e++)this.scopes[e].pause();for(e=0,t=this.effects.length;e<t;e++)this.effects[e].pause()}}resume(){if(this._active&&this._isPaused){this._isPaused=!1;let e,t;if(this.scopes)for(e=0,t=this.scopes.length;e<t;e++)this.scopes[e].resume();for(e=0,t=this.effects.length;e<t;e++)this.effects[e].resume()}}run(e){if(this._active){const t=qr;try{return qr=this,e()}finally{qr=t}}}on(){++this._on===1&&(this.prevScope=qr,qr=this)}off(){this._on>0&&--this._on===0&&(qr=this.prevScope,this.prevScope=void 0)}stop(e){if(this._active){this._active=!1;let t,r;for(t=0,r=this.effects.length;t<r;t++)this.effects[t].stop();for(this.effects.length=0,t=0,r=this.cleanups.length;t<r;t++)this.cleanups[t]();if(this.cleanups.length=0,this.scopes){for(t=0,r=this.scopes.length;t<r;t++)this.scopes[t].stop(!0);this.scopes.length=0}if(!this.detached&&this.parent&&!e){const o=this.parent.scopes.pop();o&&o!==this&&(this.parent.scopes[this.index]=o,o.index=this.index)}this.parent=void 0}}}function BN(n){return new Cx(n)}function Sx(){return qr}function NN(n,e=!1){qr&&qr.cleanups.push(n)}let Nn;const d_=new WeakSet;class wx{constructor(e){this.fn=e,this.deps=void 0,this.depsTail=void 0,this.flags=5,this.next=void 0,this.cleanup=void 0,this.scheduler=void 0,qr&&qr.active&&qr.effects.push(this)}pause(){this.flags|=64}resume(){this.flags&64&&(this.flags&=-65,d_.has(this)&&(d_.delete(this),this.trigger()))}notify(){this.flags&2&&!(this.flags&32)||this.flags&8||Tx(this)}run(){if(!(this.flags&1))return this.fn();this.flags|=2,Dx(this),Ix(this);const e=Nn,t=Oi;Nn=this,Oi=!0;try{return this.fn()}finally{Rx(this),Nn=e,Oi=t,this.flags&=-3}}stop(){if(this.flags&1){for(let e=this.deps;e;e=e.nextDep)m_(e);this.deps=this.depsTail=void 0,Dx(this),this.onStop&&this.onStop(),this.flags&=-2}}trigger(){this.flags&64?d_.add(this):this.scheduler?this.scheduler():this.runIfDirty()}runIfDirty(){p_(this)&&this.run()}get dirty(){return p_(this)}}let Mx=0,Pd,Dd;function Tx(n,e=!1){if(n.flags|=8,e){n.next=Dd,Dd=n;return}n.next=Pd,Pd=n}function f_(){Mx++}function h_(){if(--Mx>0)return;if(Dd){let e=Dd;for(Dd=void 0;e;){const t=e.next;e.next=void 0,e.flags&=-9,e=t}}let n;for(;Pd;){let e=Pd;for(Pd=void 0;e;){const t=e.next;if(e.next=void 0,e.flags&=-9,e.flags&1)try{e.trigger()}catch(r){n||(n=r)}e=t}}if(n)throw n}function Ix(n){for(let e=n.deps;e;e=e.nextDep)e.version=-1,e.prevActiveLink=e.dep.activeLink,e.dep.activeLink=e}function Rx(n){let e,t=n.depsTail,r=t;for(;r;){const o=r.prevDep;r.version===-1?(r===t&&(t=o),m_(r),ON(r)):e=r,r.dep.activeLink=r.prevActiveLink,r.prevActiveLink=void 0,r=o}n.deps=e,n.depsTail=t}function p_(n){for(let e=n.deps;e;e=e.nextDep)if(e.dep.version!==e.version||e.dep.computed&&(Lx(e.dep.computed)||e.dep.version!==e.version))return!0;return!!n._dirty}function Lx(n){if(n.flags&4&&!(n.flags&16)||(n.flags&=-17,n.globalVersion===Bd)||(n.globalVersion=Bd,!n.isSSR&&n.flags&128&&(!n.deps&&!n._dirty||!p_(n))))return;n.flags|=2;const e=n.dep,t=Nn,r=Oi;Nn=n,Oi=!0;try{Ix(n);const o=n.fn(n._value);(e.version===0||Io(o,n._value))&&(n.flags|=128,n._value=o,e.version++)}catch(o){throw e.version++,o}finally{Nn=t,Oi=r,Rx(n),n.flags&=-3}}function m_(n,e=!1){const{dep:t,prevSub:r,nextSub:o}=n;if(r&&(r.nextSub=o,n.prevSub=void 0),o&&(o.prevSub=r,n.nextSub=void 0),t.subs===n&&(t.subs=r,!r&&t.computed)){t.computed.flags&=-5;for(let i=t.computed.deps;i;i=i.nextDep)m_(i,!0)}!e&&!--t.sc&&t.map&&t.map.delete(t.key)}function ON(n){const{prevDep:e,nextDep:t}=n;e&&(e.nextDep=t,n.prevDep=void 0),t&&(t.prevDep=e,n.nextDep=void 0)}let Oi=!0;const Px=[];function sa(){Px.push(Oi),Oi=!1}function la(){const n=Px.pop();Oi=n===void 0?!0:n}function Dx(n){const{cleanup:e}=n;if(n.cleanup=void 0,e){const t=Nn;Nn=void 0;try{e()}finally{Nn=t}}}let Bd=0;class kN{constructor(e,t){this.sub=e,this.dep=t,this.version=t.version,this.nextDep=this.prevDep=this.nextSub=this.prevSub=this.prevActiveLink=void 0}}class Ap{constructor(e){this.computed=e,this.version=0,this.activeLink=void 0,this.subs=void 0,this.map=void 0,this.key=void 0,this.sc=0,this.__v_skip=!0}track(e){if(!Nn||!Oi||Nn===this.computed)return;let t=this.activeLink;if(t===void 0||t.sub!==Nn)t=this.activeLink=new kN(Nn,this),Nn.deps?(t.prevDep=Nn.depsTail,Nn.depsTail.nextDep=t,Nn.depsTail=t):Nn.deps=Nn.depsTail=t,Bx(t);else if(t.version===-1&&(t.version=this.version,t.nextDep)){const r=t.nextDep;r.prevDep=t.prevDep,t.prevDep&&(t.prevDep.nextDep=r),t.prevDep=Nn.depsTail,t.nextDep=void 0,Nn.depsTail.nextDep=t,Nn.depsTail=t,Nn.deps===t&&(Nn.deps=r)}return t}trigger(e){this.version++,Bd++,this.notify(e)}notify(e){f_();try{for(let t=this.subs;t;t=t.prevSub)t.sub.notify()&&t.sub.dep.notify()}finally{h_()}}}function Bx(n){if(n.dep.sc++,n.sub.flags&4){const e=n.dep.computed;if(e&&!n.dep.subs){e.flags|=20;for(let r=e.deps;r;r=r.nextDep)Bx(r)}const t=n.dep.subs;t!==n&&(n.prevSub=t,t&&(t.nextSub=n)),n.dep.subs=n}}const g_=new WeakMap,Cl=Symbol(""),__=Symbol(""),Nd=Symbol("");function Kr(n,e,t){if(Oi&&Nn){let r=g_.get(n);r||g_.set(n,r=new Map);let o=r.get(t);o||(r.set(t,o=new Ap),o.map=r,o.key=t),o.track()}}function Oa(n,e,t,r,o,i){const a=g_.get(n);if(!a){Bd++;return}const s=l=>{l&&l.trigger()};if(f_(),e==="clear")a.forEach(s);else{const l=_t(n),c=l&&s_(t);if(l&&t==="length"){const u=Number(r);a.forEach((d,f)=>{(f==="length"||f===Nd||!Ni(f)&&f>=u)&&s(d)})}else switch((t!==void 0||a.has(void 0))&&s(a.get(t)),c&&s(a.get(Nd)),e){case"add":l?c&&s(a.get("length")):(s(a.get(Cl)),Ic(n)&&s(a.get(__)));break;case"delete":l||(s(a.get(Cl)),Ic(n)&&s(a.get(__)));break;case"set":Ic(n)&&s(a.get(Cl));break}}h_()}function Lc(n){const e=cn(n);return e===n?e:(Kr(e,"iterate",Nd),gi(n)?e:e.map(Ur))}function yp(n){return Kr(n=cn(n),"iterate",Nd),n}const FN={__proto__:null,[Symbol.iterator](){return v_(this,Symbol.iterator,Ur)},concat(...n){return Lc(this).concat(...n.map(e=>_t(e)?Lc(e):e))},entries(){return v_(this,"entries",n=>(n[1]=Ur(n[1]),n))},every(n,e){return ka(this,"every",n,e,void 0,arguments)},filter(n,e){return ka(this,"filter",n,e,t=>t.map(Ur),arguments)},find(n,e){return ka(this,"find",n,e,Ur,arguments)},findIndex(n,e){return ka(this,"findIndex",n,e,void 0,arguments)},findLast(n,e){return ka(this,"findLast",n,e,Ur,arguments)},findLastIndex(n,e){return ka(this,"findLastIndex",n,e,void 0,arguments)},forEach(n,e){return ka(this,"forEach",n,e,void 0,arguments)},includes(...n){return A_(this,"includes",n)},indexOf(...n){return A_(this,"indexOf",n)},join(n){return Lc(this).join(n)},lastIndexOf(...n){return A_(this,"lastIndexOf",n)},map(n,e){return ka(this,"map",n,e,void 0,arguments)},pop(){return Od(this,"pop")},push(...n){return Od(this,"push",n)},reduce(n,...e){return Nx(this,"reduce",n,e)},reduceRight(n,...e){return Nx(this,"reduceRight",n,e)},shift(){return Od(this,"shift")},some(n,e){return ka(this,"some",n,e,void 0,arguments)},splice(...n){return Od(this,"splice",n)},toReversed(){return Lc(this).toReversed()},toSorted(n){return Lc(this).toSorted(n)},toSpliced(...n){return Lc(this).toSpliced(...n)},unshift(...n){return Od(this,"unshift",n)},values(){return v_(this,"values",Ur)}};function v_(n,e,t){const r=yp(n),o=r[e]();return r!==n&&!gi(n)&&(o._next=o.next,o.next=()=>{const i=o._next();return i.done||(i.value=t(i.value)),i}),o}const VN=Array.prototype;function ka(n,e,t,r,o,i){const a=yp(n),s=a!==n&&!gi(n),l=a[e];if(l!==VN[e]){const d=l.apply(n,i);return s?Ur(d):d}let c=t;a!==n&&(s?c=function(d,f){return t.call(this,Ur(d),f,n)}:t.length>2&&(c=function(d,f){return t.call(this,d,f,n)}));const u=l.call(a,c,r);return s&&o?o(u):u}function Nx(n,e,t,r){const o=yp(n);let i=t;return o!==n&&(gi(n)?t.length>3&&(i=function(a,s,l){return t.call(this,a,s,l,n)}):i=function(a,s,l){return t.call(this,a,Ur(s),l,n)}),o[e](i,...r)}function A_(n,e,t){const r=cn(n);Kr(r,"iterate",Nd);const o=r[e](...t);return(o===-1||o===!1)&&b_(t[0])?(t[0]=cn(t[0]),r[e](...t)):o}function Od(n,e,t=[]){sa(),f_();const r=cn(n)[e].apply(n,t);return h_(),la(),r}const UN=To("__proto__,__v_isRef,__isVue"),Ox=new Set(Object.getOwnPropertyNames(Symbol).filter(n=>n!=="arguments"&&n!=="caller").map(n=>Symbol[n]).filter(Ni));function zN(n){Ni(n)||(n=String(n));const e=cn(this);return Kr(e,"has",n),e.hasOwnProperty(n)}class kx{constructor(e=!1,t=!1){this._isReadonly=e,this._isShallow=t}get(e,t,r){if(t==="__v_skip")return e.__v_skip;const o=this._isReadonly,i=this._isShallow;if(t==="__v_isReactive")return!o;if(t==="__v_isReadonly")return o;if(t==="__v_isShallow")return i;if(t==="__v_raw")return r===(o?i?Hx:Gx:i?zx:Ux).get(e)||Object.getPrototypeOf(e)===Object.getPrototypeOf(r)?e:void 0;const a=_t(e);if(!o){let l;if(a&&(l=FN[t]))return l;if(t==="hasOwnProperty")return zN}const s=Reflect.get(e,t,Ir(e)?e:r);if((Ni(t)?Ox.has(t):UN(t))||(o||Kr(e,"get",t),i))return s;if(Ir(s)){const l=a&&s_(t)?s:s.value;return o&&wn(l)?Cp(l):l}return wn(s)?o?Cp(s):Zr(s):s}}class Fx extends kx{constructor(e=!1){super(!1,e)}set(e,t,r,o){let i=e[t];if(!this._isShallow){const l=Ds(i);if(!gi(r)&&!Ds(r)&&(i=cn(i),r=cn(r)),!_t(e)&&Ir(i)&&!Ir(r))return l||(i.value=r),!0}const a=_t(e)&&s_(t)?Number(t)<e.length:vn(e,t),s=Reflect.set(e,t,r,Ir(e)?e:o);return e===cn(o)&&(a?Io(r,i)&&Oa(e,"set",t,r):Oa(e,"add",t,r)),s}deleteProperty(e,t){const r=vn(e,t);e[t];const o=Reflect.deleteProperty(e,t);return o&&r&&Oa(e,"delete",t,void 0),o}has(e,t){const r=Reflect.has(e,t);return(!Ni(t)||!Ox.has(t))&&Kr(e,"has",t),r}ownKeys(e){return Kr(e,"iterate",_t(e)?"length":Cl),Reflect.ownKeys(e)}}class Vx extends kx{constructor(e=!1){super(!0,e)}set(e,t){return!0}deleteProperty(e,t){return!0}}const GN=new Fx,HN=new Vx,WN=new Fx(!0),jN=new Vx(!0),y_=n=>n,bp=n=>Reflect.getPrototypeOf(n);function QN(n,e,t){return function(...r){const o=this.__v_raw,i=cn(o),a=Ic(i),s=n==="entries"||n===Symbol.iterator&&a,l=n==="keys"&&a,c=o[n](...r),u=t?y_:e?wp:Ur;return!e&&Kr(i,"iterate",l?__:Cl),{next(){const{value:d,done:f}=c.next();return f?{value:d,done:f}:{value:s?[u(d[0]),u(d[1])]:u(d),done:f}},[Symbol.iterator](){return this}}}}function xp(n){return function(...e){return n==="delete"?!1:n==="clear"?void 0:this}}function $N(n,e){const t={get(o){const i=this.__v_raw,a=cn(i),s=cn(o);n||(Io(o,s)&&Kr(a,"get",o),Kr(a,"get",s));const{has:l}=bp(a),c=e?y_:n?wp:Ur;if(l.call(a,o))return c(i.get(o));if(l.call(a,s))return c(i.get(s));i!==a&&i.get(o)},get size(){const o=this.__v_raw;return!n&&Kr(cn(o),"iterate",Cl),o.size},has(o){const i=this.__v_raw,a=cn(i),s=cn(o);return n||(Io(o,s)&&Kr(a,"has",o),Kr(a,"has",s)),o===s?i.has(o):i.has(o)||i.has(s)},forEach(o,i){const a=this,s=a.__v_raw,l=cn(s),c=e?y_:n?wp:Ur;return!n&&Kr(l,"iterate",Cl),s.forEach((u,d)=>o.call(i,c(u),c(d),a))}};return br(t,n?{add:xp("add"),set:xp("set"),delete:xp("delete"),clear:xp("clear")}:{add(o){!e&&!gi(o)&&!Ds(o)&&(o=cn(o));const i=cn(this);return bp(i).has.call(i,o)||(i.add(o),Oa(i,"add",o,o)),this},set(o,i){!e&&!gi(i)&&!Ds(i)&&(i=cn(i));const a=cn(this),{has:s,get:l}=bp(a);let c=s.call(a,o);c||(o=cn(o),c=s.call(a,o));const u=l.call(a,o);return a.set(o,i),c?Io(i,u)&&Oa(a,"set",o,i):Oa(a,"add",o,i),this},delete(o){const i=cn(this),{has:a,get:s}=bp(i);let l=a.call(i,o);l||(o=cn(o),l=a.call(i,o)),s&&s.call(i,o);const c=i.delete(o);return l&&Oa(i,"delete",o,void 0),c},clear(){const o=cn(this),i=o.size!==0,a=o.clear();return i&&Oa(o,"clear",void 0,void 0),a}}),["keys","values","entries",Symbol.iterator].forEach(o=>{t[o]=QN(o,n,e)}),t}function Ep(n,e){const t=$N(n,e);return(r,o,i)=>o==="__v_isReactive"?!n:o==="__v_isReadonly"?n:o==="__v_raw"?r:Reflect.get(vn(t,o)&&o in r?t:r,o,i)}const YN={get:Ep(!1,!1)},XN={get:Ep(!1,!0)},qN={get:Ep(!0,!1)},KN={get:Ep(!0,!0)},Ux=new WeakMap,zx=new WeakMap,Gx=new WeakMap,Hx=new WeakMap;function ZN(n){switch(n){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function JN(n){return n.__v_skip||!Object.isExtensible(n)?0:ZN(CN(n))}function Zr(n){return Ds(n)?n:Sp(n,!1,GN,YN,Ux)}function Wx(n){return Sp(n,!1,WN,XN,zx)}function Cp(n){return Sp(n,!0,HN,qN,Gx)}function T3e(n){return Sp(n,!0,jN,KN,Hx)}function Sp(n,e,t,r,o){if(!wn(n)||n.__v_raw&&!(e&&n.__v_isReactive))return n;const i=JN(n);if(i===0)return n;const a=o.get(n);if(a)return a;const s=new Proxy(n,i===2?r:t);return o.set(n,s),s}function Pc(n){return Ds(n)?Pc(n.__v_raw):!!(n&&n.__v_isReactive)}function Ds(n){return!!(n&&n.__v_isReadonly)}function gi(n){return!!(n&&n.__v_isShallow)}function b_(n){return n?!!n.__v_raw:!1}function cn(n){const e=n&&n.__v_raw;return e?cn(e):n}function e8(n){return!vn(n,"__v_skip")&&Object.isExtensible(n)&&Ax(n,"__v_skip",!0),n}const Ur=n=>wn(n)?Zr(n):n,wp=n=>wn(n)?Cp(n):n;function Ir(n){return n?n.__v_isRef===!0:!1}function vt(n){return jx(n,!1)}function Jr(n){return jx(n,!0)}function jx(n,e){return Ir(n)?n:new t8(n,e)}class t8{constructor(e,t){this.dep=new Ap,this.__v_isRef=!0,this.__v_isShallow=!1,this._rawValue=t?e:cn(e),this._value=t?e:Ur(e),this.__v_isShallow=t}get value(){return this.dep.track(),this._value}set value(e){const t=this._rawValue,r=this.__v_isShallow||gi(e)||Ds(e);e=r?e:cn(e),Io(e,t)&&(this._rawValue=e,this._value=r?e:Ur(e),this.dep.trigger())}}function Ct(n){return Ir(n)?n.value:n}function Bs(n){return Lt(n)?n():Ct(n)}const n8={get:(n,e,t)=>e==="__v_raw"?n:Ct(Reflect.get(n,e,t)),set:(n,e,t,r)=>{const o=n[e];return Ir(o)&&!Ir(t)?(o.value=t,!0):Reflect.set(n,e,t,r)}};function Qx(n){return Pc(n)?n:new Proxy(n,n8)}class r8{constructor(e){this.__v_isRef=!0,this._value=void 0;const t=this.dep=new Ap,{get:r,set:o}=e(t.track.bind(t),t.trigger.bind(t));this._get=r,this._set=o}get value(){return this._value=this._get()}set value(e){this._set(e)}}function o8(n){return new r8(n)}class i8{constructor(e,t,r){this.fn=e,this.setter=t,this._value=void 0,this.dep=new Ap(this),this.__v_isRef=!0,this.deps=void 0,this.depsTail=void 0,this.flags=16,this.globalVersion=Bd-1,this.next=void 0,this.effect=this,this.__v_isReadonly=!t,this.isSSR=r}notify(){if(this.flags|=16,!(this.flags&8)&&Nn!==this)return Tx(this,!0),!0}get value(){const e=this.dep.track();return Lx(this),e&&(e.version=this.dep.version),this._value}set value(e){this.setter&&this.setter(e)}}function a8(n,e,t=!1){let r,o;return Lt(n)?r=n:(r=n.get,o=n.set),new i8(r,o,t)}const Mp={},Tp=new WeakMap;let Sl;function s8(n,e=!1,t=Sl){if(t){let r=Tp.get(t);r||Tp.set(t,r=[]),r.push(n)}}function l8(n,e,t=en){const{immediate:r,deep:o,once:i,scheduler:a,augmentJob:s,call:l}=t,c=b=>o?b:gi(b)||o===!1||o===0?Fa(b,1):Fa(b);let u,d,f,h,p=!1,m=!1;if(Ir(n)?(d=()=>n.value,p=gi(n)):Pc(n)?(d=()=>c(n),p=!0):_t(n)?(m=!0,p=n.some(b=>Pc(b)||gi(b)),d=()=>n.map(b=>{if(Ir(b))return b.value;if(Pc(b))return c(b);if(Lt(b))return l?l(b,2):b()})):Lt(n)?e?d=l?()=>l(n,2):n:d=()=>{if(f){sa();try{f()}finally{la()}}const b=Sl;Sl=u;try{return l?l(n,3,[h]):n(h)}finally{Sl=b}}:d=aa,e&&o){const b=d,E=o===!0?1/0:o;d=()=>Fa(b(),E)}const g=Sx(),_=()=>{u.stop(),g&&g.active&&a_(g.effects,u)};if(i&&e){const b=e;e=(...E)=>{b(...E),_()}}let A=m?new Array(n.length).fill(Mp):Mp;const y=b=>{if(!(!(u.flags&1)||!u.dirty&&!b))if(e){const E=u.run();if(o||p||(m?E.some((x,w)=>Io(x,A[w])):Io(E,A))){f&&f();const x=Sl;Sl=u;try{const w=[E,A===Mp?void 0:m&&A[0]===Mp?[]:A,h];A=E,l?l(e,3,w):e(...w)}finally{Sl=x}}}else u.run()};return s&&s(y),u=new wx(d),u.scheduler=a?()=>a(y,!1):y,h=b=>s8(b,!1,u),f=u.onStop=()=>{const b=Tp.get(u);if(b){if(l)l(b,4);else for(const E of b)E();Tp.delete(u)}},e?r?y(!0):A=u.run():a?a(y.bind(null,!0),!0):u.run(),_.pause=u.pause.bind(u),_.resume=u.resume.bind(u),_.stop=_,_}function Fa(n,e=1/0,t){if(e<=0||!wn(n)||n.__v_skip||(t=t||new Map,(t.get(n)||0)>=e))return n;if(t.set(n,e),e--,Ir(n))Fa(n.value,e,t);else if(_t(n))for(let r=0;r<n.length;r++)Fa(n[r],e,t);else if(Rc(n)||Ic(n))n.forEach(r=>{Fa(r,e,t)});else if(vx(n)){for(const r in n)Fa(n[r],e,t);for(const r of Object.getOwnPropertySymbols(n))Object.prototype.propertyIsEnumerable.call(n,r)&&Fa(n[r],e,t)}return n}/**
* @vue/runtime-core v3.5.23
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/const kd=[];let x_=!1;function I3e(n,...e){if(x_)return;x_=!0,sa();const t=kd.length?kd[kd.length-1].component:null,r=t&&t.appContext.config.warnHandler,o=c8();if(r)Dc(r,t,11,[n+e.map(i=>{var a,s;return(s=(a=i.toString)==null?void 0:a.call(i))!=null?s:JSON.stringify(i)}).join(""),t&&t.proxy,o.map(({vnode:i})=>`at <${tC(t,i.type)}>`).join(`
`),o]);else{const i=[`[Vue warn]: ${n}`,...e];o.length&&i.push(`
`,...u8(o)),console.warn(...i)}la(),x_=!1}function c8(){let n=kd[kd.length-1];if(!n)return[];const e=[];for(;n;){const t=e[0];t&&t.vnode===n?t.recurseCount++:e.push({vnode:n,recurseCount:0});const r=n.component&&n.component.parent;n=r&&r.vnode}return e}function u8(n){const e=[];return n.forEach((t,r)=>{e.push(...r===0?[]:[`
`],...d8(t))}),e}function d8({vnode:n,recurseCount:e}){const t=e>0?`... (${e} recursive calls)`:"",r=n.component?n.component.parent==null:!1,o=` at <${tC(n.component,n.type,r)}`,i=">"+t;return n.props?[o,...f8(n.props),i]:[o+i]}function f8(n){const e=[],t=Object.keys(n);return t.slice(0,3).forEach(r=>{e.push(...$x(r,n[r]))}),t.length>3&&e.push(" ..."),e}function $x(n,e,t){return Yn(e)?(e=JSON.stringify(e),t?e:[`${n}=${e}`]):typeof e=="number"||typeof e=="boolean"||e==null?t?e:[`${n}=${e}`]:Ir(e)?(e=$x(n,cn(e.value),!0),t?e:[`${n}=Ref<`,e,">"]):Lt(e)?[`${n}=fn${e.name?`<${e.name}>`:""}`]:(e=cn(e),t?e:[`${n}=`,e])}function Dc(n,e,t,r){try{return r?n(...r):n()}catch(o){Fd(o,e,t)}}function ki(n,e,t,r){if(Lt(n)){const o=Dc(n,e,t,r);return o&&gx(o)&&o.catch(i=>{Fd(i,e,t)}),o}if(_t(n)){const o=[];for(let i=0;i<n.length;i++)o.push(ki(n[i],e,t,r));return o}}function Fd(n,e,t,r=!0){const o=e?e.vnode:null,{errorHandler:i,throwUnhandledErrorInProduction:a}=e&&e.appContext.config||en;if(e){let s=e.parent;const l=e.proxy,c=`https://vuejs.org/error-reference/#runtime-${t}`;for(;s;){const u=s.ec;if(u){for(let d=0;d<u.length;d++)if(u[d](n,l,c)===!1)return}s=s.parent}if(i){sa(),Dc(i,null,10,[n,l,c]),la();return}}h8(n,t,o,r,a)}function h8(n,e,t,r=!0,o=!1){if(o)throw n;console.error(n)}const uo=[];let ca=-1;const Bc=[];let Ns=null,Nc=0;const Yx=Promise.resolve();let Ip=null;function Va(n){const e=Ip||Yx;return n?e.then(this?n.bind(this):n):e}function p8(n){let e=ca+1,t=uo.length;for(;e<t;){const r=e+t>>>1,o=uo[r],i=Vd(o);i<n||i===n&&o.flags&2?e=r+1:t=r}return e}function E_(n){if(!(n.flags&1)){const e=Vd(n),t=uo[uo.length-1];!t||!(n.flags&2)&&e>=Vd(t)?uo.push(n):uo.splice(p8(e),0,n),n.flags|=1,Xx()}}function Xx(){Ip||(Ip=Yx.then(Zx))}function m8(n){_t(n)?Bc.push(...n):Ns&&n.id===-1?Ns.splice(Nc+1,0,n):n.flags&1||(Bc.push(n),n.flags|=1),Xx()}function qx(n,e,t=ca+1){for(;t<uo.length;t++){const r=uo[t];if(r&&r.flags&2){if(n&&r.id!==n.uid)continue;uo.splice(t,1),t--,r.flags&4&&(r.flags&=-2),r(),r.flags&4||(r.flags&=-2)}}}function Kx(n){if(Bc.length){const e=[...new Set(Bc)].sort((t,r)=>Vd(t)-Vd(r));if(Bc.length=0,Ns){Ns.push(...e);return}for(Ns=e,Nc=0;Nc<Ns.length;Nc++){const t=Ns[Nc];t.flags&4&&(t.flags&=-2),t.flags&8||t(),t.flags&=-2}Ns=null,Nc=0}}const Vd=n=>n.id==null?n.flags&2?-1:1/0:n.id;function Zx(n){try{for(ca=0;ca<uo.length;ca++){const e=uo[ca];e&&!(e.flags&8)&&(e.flags&4&&(e.flags&=-2),Dc(e,e.i,e.i?15:14),e.flags&4||(e.flags&=-2))}}finally{for(;ca<uo.length;ca++){const e=uo[ca];e&&(e.flags&=-2)}ca=-1,uo.length=0,Kx(),Ip=null,(uo.length||Bc.length)&&Zx()}}let zr=null,Jx=null;function Rp(n){const e=zr;return zr=n,Jx=n&&n.type.__scopeId||null,e}function ot(n,e=zr,t){if(!e||n._n)return n;const r=(...o)=>{r._d&&Hp(-1);const i=Rp(e);let a;try{a=n(...o)}finally{Rp(i),r._d&&Hp(1)}return a};return r._n=!0,r._c=!0,r._d=!0,r}function Kn(n,e){if(zr===null)return n;const t=Qp(zr),r=n.dirs||(n.dirs=[]);for(let o=0;o<e.length;o++){let[i,a,s,l=en]=e[o];i&&(Lt(i)&&(i={mounted:i,updated:i}),i.deep&&Fa(a),r.push({dir:i,instance:t,value:a,oldValue:void 0,arg:s,modifiers:l}))}return n}function wl(n,e,t,r){const o=n.dirs,i=e&&e.dirs;for(let a=0;a<o.length;a++){const s=o[a];i&&(s.oldValue=i[a].value);let l=s.dir[r];l&&(sa(),ki(l,t,8,[n.el,s,n,e]),la())}}const eE=Symbol("_vte"),tE=n=>n.__isTeleport,Ud=n=>n&&(n.disabled||n.disabled===""),nE=n=>n&&(n.defer||n.defer===""),rE=n=>typeof SVGElement<"u"&&n instanceof SVGElement,oE=n=>typeof MathMLElement=="function"&&n instanceof MathMLElement,C_=(n,e)=>{const t=n&&n.to;return Yn(t)?e?e(t):null:t},iE={name:"Teleport",__isTeleport:!0,process(n,e,t,r,o,i,a,s,l,c){const{mc:u,pc:d,pbc:f,o:{insert:h,querySelector:p,createText:m,createComment:g}}=c,_=Ud(e.props);let{shapeFlag:A,children:y,dynamicChildren:b}=e;if(n==null){const E=e.el=m(""),x=e.anchor=m("");h(E,t,r),h(x,t,r);const w=(C,P)=>{A&16&&u(y,C,P,o,i,a,s,l)},L=()=>{const C=e.target=C_(e.props,p),P=aE(C,e,m,h);C&&(a!=="svg"&&rE(C)?a="svg":a!=="mathml"&&oE(C)&&(a="mathml"),o&&o.isCE&&(o.ce._teleportTargets||(o.ce._teleportTargets=new Set)).add(C),_||(w(C,P),Pp(e,!1)))};_&&(w(t,x),Pp(e,!0)),nE(e.props)?(e.el.__isMounted=!1,ho(()=>{L(),delete e.el.__isMounted},i)):L()}else{if(nE(e.props)&&n.el.__isMounted===!1){ho(()=>{iE.process(n,e,t,r,o,i,a,s,l,c)},i);return}e.el=n.el,e.targetStart=n.targetStart;const E=e.anchor=n.anchor,x=e.target=n.target,w=e.targetAnchor=n.targetAnchor,L=Ud(n.props),C=L?t:x,P=L?E:w;if(a==="svg"||rE(x)?a="svg":(a==="mathml"||oE(x))&&(a="mathml"),b?(f(n.dynamicChildren,b,C,o,i,a,s),O_(n,e,!0)):l||d(n,e,C,P,o,i,a,s,!1),_)L?e.props&&n.props&&e.props.to!==n.props.to&&(e.props.to=n.props.to):Lp(e,t,E,c,1);else if((e.props&&e.props.to)!==(n.props&&n.props.to)){const D=e.target=C_(e.props,p);D&&Lp(e,D,null,c,0)}else L&&Lp(e,x,w,c,1);Pp(e,_)}},remove(n,e,t,{um:r,o:{remove:o}},i){const{shapeFlag:a,children:s,anchor:l,targetStart:c,targetAnchor:u,target:d,props:f}=n;if(d&&(o(c),o(u)),i&&o(l),a&16){const h=i||!Ud(f);for(let p=0;p<s.length;p++){const m=s[p];r(m,e,t,h,!!m.dynamicChildren)}}},move:Lp,hydrate:g8};function Lp(n,e,t,{o:{insert:r},m:o},i=2){i===0&&r(n.targetAnchor,e,t);const{el:a,anchor:s,shapeFlag:l,children:c,props:u}=n,d=i===2;if(d&&r(a,e,t),(!d||Ud(u))&&l&16)for(let f=0;f<c.length;f++)o(c[f],e,t,2);d&&r(s,e,t)}function g8(n,e,t,r,o,i,{o:{nextSibling:a,parentNode:s,querySelector:l,insert:c,createText:u}},d){function f(m,g,_,A){g.anchor=d(a(m),g,s(m),t,r,o,i),g.targetStart=_,g.targetAnchor=A}const h=e.target=C_(e.props,l),p=Ud(e.props);if(h){const m=h._lpa||h.firstChild;if(e.shapeFlag&16)if(p)f(n,e,m,m&&a(m));else{e.anchor=a(n);let g=m;for(;g;){if(g&&g.nodeType===8){if(g.data==="teleport start anchor")e.targetStart=g;else if(g.data==="teleport anchor"){e.targetAnchor=g,h._lpa=e.targetAnchor&&a(e.targetAnchor);break}}g=a(g)}e.targetAnchor||aE(h,e,u,c),d(m&&a(m),e,h,t,r,o,i)}Pp(e,p)}else p&&e.shapeFlag&16&&f(n,e,n,a(n));return e.anchor&&a(e.anchor)}const Oc=iE;function Pp(n,e){const t=n.ctx;if(t&&t.ut){let r,o;for(e?(r=n.el,o=n.anchor):(r=n.targetStart,o=n.targetAnchor);r&&r!==o;)r.nodeType===1&&r.setAttribute("data-v-owner",t.uid),r=r.nextSibling;t.ut()}}function aE(n,e,t,r){const o=e.targetStart=t(""),i=e.targetAnchor=t("");return o[eE]=i,n&&(r(o,n),r(i,n)),i}const Ua=Symbol("_leaveCb"),Dp=Symbol("_enterCb");function _8(){const n={isMounted:!1,isLeaving:!1,isUnmounting:!1,leavingVNodes:new Map};return $o(()=>{n.isMounted=!0}),Fc(()=>{n.isUnmounting=!0}),n}const _i=[Function,Array],sE={mode:String,appear:Boolean,persisted:Boolean,onBeforeEnter:_i,onEnter:_i,onAfterEnter:_i,onEnterCancelled:_i,onBeforeLeave:_i,onLeave:_i,onAfterLeave:_i,onLeaveCancelled:_i,onBeforeAppear:_i,onAppear:_i,onAfterAppear:_i,onAppearCancelled:_i},lE=n=>{const e=n.subTree;return e.component?lE(e.component):e},v8={name:"BaseTransition",props:sE,setup(n,{slots:e}){const t=Po(),r=_8();return()=>{const o=e.default&&fE(e.default(),!0);if(!o||!o.length)return;const i=cE(o),a=cn(n),{mode:s}=a;if(r.isLeaving)return w_(i);const l=dE(i);if(!l)return w_(i);let c=S_(l,a,r,t,d=>c=d);l.type!==eo&&zd(l,c);let u=t.subTree&&dE(t.subTree);if(u&&u.type!==eo&&!Rl(u,l)&&lE(t).type!==eo){let d=S_(u,a,r,t);if(zd(u,d),s==="out-in"&&l.type!==eo)return r.isLeaving=!0,d.afterLeave=()=>{r.isLeaving=!1,t.job.flags&8||t.update(),delete d.afterLeave,u=void 0},w_(i);s==="in-out"&&l.type!==eo?d.delayLeave=(f,h,p)=>{const m=uE(r,u);m[String(u.key)]=u,f[Ua]=()=>{h(),f[Ua]=void 0,delete c.delayedLeave,u=void 0},c.delayedLeave=()=>{p(),delete c.delayedLeave,u=void 0}}:u=void 0}else u&&(u=void 0);return i}}};function cE(n){let e=n[0];if(n.length>1){for(const t of n)if(t.type!==eo){e=t;break}}return e}const A8=v8;function uE(n,e){const{leavingVNodes:t}=n;let r=t.get(e.type);return r||(r=Object.create(null),t.set(e.type,r)),r}function S_(n,e,t,r,o){const{appear:i,mode:a,persisted:s=!1,onBeforeEnter:l,onEnter:c,onAfterEnter:u,onEnterCancelled:d,onBeforeLeave:f,onLeave:h,onAfterLeave:p,onLeaveCancelled:m,onBeforeAppear:g,onAppear:_,onAfterAppear:A,onAppearCancelled:y}=e,b=String(n.key),E=uE(t,n),x=(C,P)=>{C&&ki(C,r,9,P)},w=(C,P)=>{const D=P[1];x(C,P),_t(C)?C.every(Q=>Q.length<=1)&&D():C.length<=1&&D()},L={mode:a,persisted:s,beforeEnter(C){let P=l;if(!t.isMounted)if(i)P=g||l;else return;C[Ua]&&C[Ua](!0);const D=E[b];D&&Rl(n,D)&&D.el[Ua]&&D.el[Ua](),x(P,[C])},enter(C){let P=c,D=u,Q=d;if(!t.isMounted)if(i)P=_||c,D=A||u,Q=y||d;else return;let re=!1;const G=C[Dp]=se=>{re||(re=!0,se?x(Q,[C]):x(D,[C]),L.delayedLeave&&L.delayedLeave(),C[Dp]=void 0)};P?w(P,[C,G]):G()},leave(C,P){const D=String(n.key);if(C[Dp]&&C[Dp](!0),t.isUnmounting)return P();x(f,[C]);let Q=!1;const re=C[Ua]=G=>{Q||(Q=!0,P(),G?x(m,[C]):x(p,[C]),C[Ua]=void 0,E[D]===n&&delete E[D])};E[D]=n,h?w(h,[C,re]):re()},clone(C){const P=S_(C,e,t,r,o);return o&&o(P),P}};return L}function w_(n){if(Hd(n))return n=Os(n),n.children=null,n}function dE(n){if(!Hd(n))return tE(n.type)&&n.children?cE(n.children):n;if(n.component)return n.component.subTree;const{shapeFlag:e,children:t}=n;if(t){if(e&16)return t[0];if(e&32&&Lt(t.default))return t.default()}}function zd(n,e){n.shapeFlag&6&&n.component?(n.transition=e,zd(n.component.subTree,e)):n.shapeFlag&128?(n.ssContent.transition=e.clone(n.ssContent),n.ssFallback.transition=e.clone(n.ssFallback)):n.transition=e}function fE(n,e=!1,t){let r=[],o=0;for(let i=0;i<n.length;i++){let a=n[i];const s=t==null?a.key:String(t)+String(a.key!=null?a.key:i);a.type===Nt?(a.patchFlag&128&&o++,r=r.concat(fE(a.children,e,s))):(e||a.type!==eo)&&r.push(s!=null?Os(a,{key:s}):a)}if(o>1)for(let i=0;i<r.length;i++)r[i].patchFlag=-2;return r}function Ml(n,e){return Lt(n)?br({name:n.name},e,{setup:n}):n}function M_(n){n.ids=[n.ids[0]+n.ids[2]+++"-",0,0]}const Bp=new WeakMap;function Gd(n,e,t,r,o=!1){if(_t(n)){n.forEach((p,m)=>Gd(p,e&&(_t(e)?e[m]:e),t,r,o));return}if(kc(r)&&!o){r.shapeFlag&512&&r.type.__asyncResolved&&r.component.subTree.component&&Gd(n,e,t,r.component.subTree);return}const i=r.shapeFlag&4?Qp(r.component):r.el,a=o?null:i,{i:s,r:l}=n,c=e&&e.r,u=s.refs===en?s.refs={}:s.refs,d=s.setupState,f=cn(d),h=d===en?px:p=>vn(f,p);if(c!=null&&c!==l){if(hE(e),Yn(c))u[c]=null,h(c)&&(d[c]=null);else if(Ir(c)){c.value=null;const p=e;p.k&&(u[p.k]=null)}}if(Lt(l))Dc(l,s,12,[a,u]);else{const p=Yn(l),m=Ir(l);if(p||m){const g=()=>{if(n.f){const _=p?h(l)?d[l]:u[l]:l.value;if(o)_t(_)&&a_(_,i);else if(_t(_))_.includes(i)||_.push(i);else if(p)u[l]=[i],h(l)&&(d[l]=u[l]);else{const A=[i];l.value=A,n.k&&(u[n.k]=A)}}else p?(u[l]=a,h(l)&&(d[l]=a)):m&&(l.value=a,n.k&&(u[n.k]=a))};if(a){const _=()=>{g(),Bp.delete(n)};_.id=-1,Bp.set(n,_),ho(_,t)}else hE(n),g()}}}function hE(n){const e=Bp.get(n);e&&(e.flags|=8,Bp.delete(n))}const pE=n=>n.nodeType===8;vp().requestIdleCallback,vp().cancelIdleCallback;function y8(n,e){if(pE(n)&&n.data==="["){let t=1,r=n.nextSibling;for(;r;){if(r.nodeType===1){if(e(r)===!1)break}else if(pE(r))if(r.data==="]"){if(--t===0)break}else r.data==="["&&t++;r=r.nextSibling}}else e(n)}const kc=n=>!!n.type.__asyncLoader;function b8(n){Lt(n)&&(n={loader:n});const{loader:e,loadingComponent:t,errorComponent:r,delay:o=200,hydrate:i,timeout:a,suspensible:s=!0,onError:l}=n;let c=null,u,d=0;const f=()=>(d++,c=null,h()),h=()=>{let p;return c||(p=c=e().catch(m=>{if(m=m instanceof Error?m:new Error(String(m)),l)return new Promise((g,_)=>{l(m,()=>g(f()),()=>_(m),d+1)});throw m}).then(m=>p!==c&&c?c:(m&&(m.__esModule||m[Symbol.toStringTag]==="Module")&&(m=m.default),u=m,m)))};return Ml({name:"AsyncComponentWrapper",__asyncLoader:h,__asyncHydrate(p,m,g){let _=!1;(m.bu||(m.bu=[])).push(()=>_=!0);const A=()=>{_||g()},y=i?()=>{const b=i(A,E=>y8(p,E));b&&(m.bum||(m.bum=[])).push(b)}:A;u?y():h().then(()=>!m.isUnmounted&&y())},get __asyncResolved(){return u},setup(){const p=Gr;if(M_(p),u)return()=>Np(u,p);const m=y=>{c=null,Fd(y,p,13,!r)};if(s&&p.suspense||Vc)return h().then(y=>()=>Np(y,p)).catch(y=>(m(y),()=>r?Be(r,{error:y}):null));const g=vt(!1),_=vt(),A=vt(!!o);return o&&setTimeout(()=>{A.value=!1},o),a!=null&&setTimeout(()=>{if(!g.value&&!_.value){const y=new Error(`Async component timed out after ${a}ms.`);m(y),_.value=y}},a),h().then(()=>{g.value=!0,p.parent&&Hd(p.parent.vnode)&&p.parent.update()}).catch(y=>{m(y),_.value=y}),()=>{if(g.value&&u)return Np(u,p);if(_.value&&r)return Be(r,{error:_.value});if(t&&!A.value)return Np(t,p)}}})}function Np(n,e){const{ref:t,props:r,children:o,ce:i}=e.vnode,a=Be(n,r,o);return a.ref=t,a.ce=i,delete e.vnode.ce,a}const Hd=n=>n.type.__isKeepAlive;function x8(n,e){mE(n,"a",e)}function E8(n,e){mE(n,"da",e)}function mE(n,e,t=Gr){const r=n.__wdc||(n.__wdc=()=>{let o=t;for(;o;){if(o.isDeactivated)return;o=o.parent}return n()});if(Op(e,r,t),t){let o=t.parent;for(;o&&o.parent;)Hd(o.parent.vnode)&&C8(r,e,t,o),o=o.parent}}function C8(n,e,t,r){const o=Op(e,n,r,!0);Wd(()=>{a_(r[e],o)},t)}function Op(n,e,t=Gr,r=!1){if(t){const o=t[n]||(t[n]=[]),i=e.__weh||(e.__weh=(...a)=>{sa();const s=Kd(t),l=ki(e,t,n,a);return s(),la(),l});return r?o.unshift(i):o.push(i),i}}const za=n=>(e,t=Gr)=>{(!Vc||n==="sp")&&Op(n,(...r)=>e(...r),t)},gE=za("bm"),$o=za("m"),S8=za("bu"),_E=za("u"),Fc=za("bum"),Wd=za("um"),w8=za("sp"),M8=za("rtg"),T8=za("rtc");function I8(n,e=Gr){Op("ec",n,e)}const R8="components";function Yt(n,e){return P8(R8,n,!0,e)||n}const L8=Symbol.for("v-ndc");function P8(n,e,t=!0,r=!1){const o=zr||Gr;if(o){const i=o.type;{const s=eC(i,!1);if(s&&(s===e||s===Qo(e)||s===mp(Qo(e))))return i}const a=vE(o[n]||i[n],e)||vE(o.appContext[n],e);return!a&&r?i:a}}function vE(n,e){return n&&(n[e]||n[Qo(e)]||n[mp(Qo(e))])}function Xn(n,e,t,r){let o;const i=t,a=_t(n);if(a||Yn(n)){const s=a&&Pc(n);let l=!1,c=!1;s&&(l=!gi(n),c=Ds(n),n=yp(n)),o=new Array(n.length);for(let u=0,d=n.length;u<d;u++)o[u]=e(l?c?wp(Ur(n[u])):Ur(n[u]):n[u],u,void 0,i)}else if(typeof n=="number"){o=new Array(n);for(let s=0;s<n;s++)o[s]=e(s+1,s,void 0,i)}else if(wn(n))if(n[Symbol.iterator])o=Array.from(n,(s,l)=>e(s,l,void 0,i));else{const s=Object.keys(n);o=new Array(s.length);for(let l=0,c=s.length;l<c;l++){const u=s[l];o[l]=e(n[u],u,l,i)}}else o=[];return o}function AE(n,e){for(let t=0;t<e.length;t++){const r=e[t];if(_t(r))for(let o=0;o<r.length;o++)n[r[o].name]=r[o].fn;else r&&(n[r.name]=r.key?(...o)=>{const i=r.fn(...o);return i&&(i.key=r.key),i}:r.fn)}return n}function Ro(n,e,t={},r,o){if(zr.ce||zr.parent&&kc(zr.parent)&&zr.parent.ce){const c=Object.keys(t).length>0;return e!=="default"&&(t.name=e),he(),gt(Nt,null,[Be("slot",t,r&&r())],c?-2:64)}let i=n[e];i&&i._c&&(i._d=!1),he();const a=i&&yE(i(t)),s=t.key||a&&a.key,l=gt(Nt,{key:(s&&!Ni(s)?s:`_${e}`)+(!a&&r?"_fb":"")},a||(r?r():[]),a&&n._===1?64:-2);return!o&&l.scopeId&&(l.slotScopeIds=[l.scopeId+"-s"]),i&&i._c&&(i._d=!0),l}function yE(n){return n.some(e=>qd(e)?!(e.type===eo||e.type===Nt&&!yE(e.children)):!0)?n:null}const T_=n=>n?KE(n)?Qp(n):T_(n.parent):null,jd=br(Object.create(null),{$:n=>n,$el:n=>n.vnode.el,$data:n=>n.data,$props:n=>n.props,$attrs:n=>n.attrs,$slots:n=>n.slots,$refs:n=>n.refs,$parent:n=>T_(n.parent),$root:n=>T_(n.root),$host:n=>n.ce,$emit:n=>n.emit,$options:n=>CE(n),$forceUpdate:n=>n.f||(n.f=()=>{E_(n.update)}),$nextTick:n=>n.n||(n.n=Va.bind(n.proxy)),$watch:n=>e7.bind(n)}),I_=(n,e)=>n!==en&&!n.__isScriptSetup&&vn(n,e),D8={get({_:n},e){if(e==="__v_skip")return!0;const{ctx:t,setupState:r,data:o,props:i,accessCache:a,type:s,appContext:l}=n;let c;if(e[0]!=="$"){const h=a[e];if(h!==void 0)switch(h){case 1:return r[e];case 2:return o[e];case 4:return t[e];case 3:return i[e]}else{if(I_(r,e))return a[e]=1,r[e];if(o!==en&&vn(o,e))return a[e]=2,o[e];if((c=n.propsOptions[0])&&vn(c,e))return a[e]=3,i[e];if(t!==en&&vn(t,e))return a[e]=4,t[e];R_&&(a[e]=0)}}const u=jd[e];let d,f;if(u)return e==="$attrs"&&Kr(n.attrs,"get",""),u(n);if((d=s.__cssModules)&&(d=d[e]))return d;if(t!==en&&vn(t,e))return a[e]=4,t[e];if(f=l.config.globalProperties,vn(f,e))return f[e]},set({_:n},e,t){const{data:r,setupState:o,ctx:i}=n;return I_(o,e)?(o[e]=t,!0):r!==en&&vn(r,e)?(r[e]=t,!0):vn(n.props,e)||e[0]==="$"&&e.slice(1)in n?!1:(i[e]=t,!0)},has({_:{data:n,setupState:e,accessCache:t,ctx:r,appContext:o,propsOptions:i,type:a}},s){let l,c;return!!(t[s]||n!==en&&s[0]!=="$"&&vn(n,s)||I_(e,s)||(l=i[0])&&vn(l,s)||vn(r,s)||vn(jd,s)||vn(o.config.globalProperties,s)||(c=a.__cssModules)&&c[s])},defineProperty(n,e,t){return t.get!=null?n._.accessCache[e]=0:vn(t,"value")&&this.set(n,e,t.value,null),Reflect.defineProperty(n,e,t)}};function kp(n){return _t(n)?n.reduce((e,t)=>(e[t]=null,e),{}):n}function bE(n,e){return!n||!e?n||e:_t(n)&&_t(e)?n.concat(e):br({},kp(n),kp(e))}let R_=!0;function B8(n){const e=CE(n),t=n.proxy,r=n.ctx;R_=!1,e.beforeCreate&&xE(e.beforeCreate,n,"bc");const{data:o,computed:i,methods:a,watch:s,provide:l,inject:c,created:u,beforeMount:d,mounted:f,beforeUpdate:h,updated:p,activated:m,deactivated:g,beforeDestroy:_,beforeUnmount:A,destroyed:y,unmounted:b,render:E,renderTracked:x,renderTriggered:w,errorCaptured:L,serverPrefetch:C,expose:P,inheritAttrs:D,components:Q,directives:re,filters:G}=e;if(c&&N8(c,r,null),a)for(const ie in a){const H=a[ie];Lt(H)&&(r[ie]=H.bind(t))}if(o){const ie=o.call(t,t);wn(ie)&&(n.data=Zr(ie))}if(R_=!0,i)for(const ie in i){const H=i[ie],T=Lt(H)?H.bind(t,t):Lt(H.get)?H.get.bind(t,t):aa,R=!Lt(H)&&Lt(H.set)?H.set.bind(t):aa,O=bt({get:T,set:R});Object.defineProperty(r,ie,{enumerable:!0,configurable:!0,get:()=>O.value,set:W=>O.value=W})}if(s)for(const ie in s)EE(s[ie],r,t,ie);if(l){const ie=Lt(l)?l.call(t):l;Reflect.ownKeys(ie).forEach(H=>{Vp(H,ie[H])})}u&&xE(u,n,"c");function ee(ie,H){_t(H)?H.forEach(T=>ie(T.bind(t))):H&&ie(H.bind(t))}if(ee(gE,d),ee($o,f),ee(S8,h),ee(_E,p),ee(x8,m),ee(E8,g),ee(I8,L),ee(T8,x),ee(M8,w),ee(Fc,A),ee(Wd,b),ee(w8,C),_t(P))if(P.length){const ie=n.exposed||(n.exposed={});P.forEach(H=>{Object.defineProperty(ie,H,{get:()=>t[H],set:T=>t[H]=T,enumerable:!0})})}else n.exposed||(n.exposed={});E&&n.render===aa&&(n.render=E),D!=null&&(n.inheritAttrs=D),Q&&(n.components=Q),re&&(n.directives=re),C&&M_(n)}function N8(n,e,t=aa){_t(n)&&(n=L_(n));for(const r in n){const o=n[r];let i;wn(o)?"default"in o?i=Lo(o.from||r,o.default,!0):i=Lo(o.from||r):i=Lo(o),Ir(i)?Object.defineProperty(e,r,{enumerable:!0,configurable:!0,get:()=>i.value,set:a=>i.value=a}):e[r]=i}}function xE(n,e,t){ki(_t(n)?n.map(r=>r.bind(e.proxy)):n.bind(e.proxy),e,t)}function EE(n,e,t,r){let o=r.includes(".")?zE(t,r):()=>t[r];if(Yn(n)){const i=e[n];Lt(i)&&dr(o,i)}else if(Lt(n))dr(o,n.bind(t));else if(wn(n))if(_t(n))n.forEach(i=>EE(i,e,t,r));else{const i=Lt(n.handler)?n.handler.bind(t):e[n.handler];Lt(i)&&dr(o,i,n)}}function CE(n){const e=n.type,{mixins:t,extends:r}=e,{mixins:o,optionsCache:i,config:{optionMergeStrategies:a}}=n.appContext,s=i.get(e);let l;return s?l=s:!o.length&&!t&&!r?l=e:(l={},o.length&&o.forEach(c=>Fp(l,c,a,!0)),Fp(l,e,a)),wn(e)&&i.set(e,l),l}function Fp(n,e,t,r=!1){const{mixins:o,extends:i}=e;i&&Fp(n,i,t,!0),o&&o.forEach(a=>Fp(n,a,t,!0));for(const a in e)if(!(r&&a==="expose")){const s=O8[a]||t&&t[a];n[a]=s?s(n[a],e[a]):e[a]}return n}const O8={data:SE,props:wE,emits:wE,methods:Qd,computed:Qd,beforeCreate:fo,created:fo,beforeMount:fo,mounted:fo,beforeUpdate:fo,updated:fo,beforeDestroy:fo,beforeUnmount:fo,destroyed:fo,unmounted:fo,activated:fo,deactivated:fo,errorCaptured:fo,serverPrefetch:fo,components:Qd,directives:Qd,watch:F8,provide:SE,inject:k8};function SE(n,e){return e?n?function(){return br(Lt(n)?n.call(this,this):n,Lt(e)?e.call(this,this):e)}:e:n}function k8(n,e){return Qd(L_(n),L_(e))}function L_(n){if(_t(n)){const e={};for(let t=0;t<n.length;t++)e[n[t]]=n[t];return e}return n}function fo(n,e){return n?[...new Set([].concat(n,e))]:e}function Qd(n,e){return n?br(Object.create(null),n,e):e}function wE(n,e){return n?_t(n)&&_t(e)?[...new Set([...n,...e])]:br(Object.create(null),kp(n),kp(e??{})):e}function F8(n,e){if(!n)return e;if(!e)return n;const t=br(Object.create(null),n);for(const r in e)t[r]=fo(n[r],e[r]);return t}function ME(){return{app:null,config:{isNativeTag:px,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let V8=0;function U8(n,e){return function(r,o=null){Lt(r)||(r=br({},r)),o!=null&&!wn(o)&&(o=null);const i=ME(),a=new WeakSet,s=[];let l=!1;const c=i.app={_uid:V8++,_component:r,_props:o,_container:null,_context:i,_instance:null,version:E7,get config(){return i.config},set config(u){},use(u,...d){return a.has(u)||(u&&Lt(u.install)?(a.add(u),u.install(c,...d)):Lt(u)&&(a.add(u),u(c,...d))),c},mixin(u){return i.mixins.includes(u)||i.mixins.push(u),c},component(u,d){return d?(i.components[u]=d,c):i.components[u]},directive(u,d){return d?(i.directives[u]=d,c):i.directives[u]},mount(u,d,f){if(!l){const h=c._ceVNode||Be(r,o);return h.appContext=i,f===!0?f="svg":f===!1&&(f=void 0),n(h,u,f),l=!0,c._container=u,u.__vue_app__=c,Qp(h.component)}},onUnmount(u){s.push(u)},unmount(){l&&(ki(s,c._instance,16),n(null,c._container),delete c._container.__vue_app__)},provide(u,d){return i.provides[u]=d,c},runWithContext(u){const d=Tl;Tl=c;try{return u()}finally{Tl=d}}};return c}}let Tl=null;function Vp(n,e){if(Gr){let t=Gr.provides;const r=Gr.parent&&Gr.parent.provides;r===t&&(t=Gr.provides=Object.create(r)),t[n]=e}}function Lo(n,e,t=!1){const r=Po();if(r||Tl){let o=Tl?Tl._context.provides:r?r.parent==null||r.ce?r.vnode.appContext&&r.vnode.appContext.provides:r.parent.provides:void 0;if(o&&n in o)return o[n];if(arguments.length>1)return t&&Lt(e)?e.call(r&&r.proxy):e}}function TE(){return!!(Po()||Tl)}const IE={},RE=()=>Object.create(IE),LE=n=>Object.getPrototypeOf(n)===IE;function z8(n,e,t,r=!1){const o={},i=RE();n.propsDefaults=Object.create(null),PE(n,e,o,i);for(const a in n.propsOptions[0])a in o||(o[a]=void 0);t?n.props=r?o:Wx(o):n.type.props?n.props=o:n.props=i,n.attrs=i}function G8(n,e,t,r){const{props:o,attrs:i,vnode:{patchFlag:a}}=n,s=cn(o),[l]=n.propsOptions;let c=!1;if((r||a>0)&&!(a&16)){if(a&8){const u=n.vnode.dynamicProps;for(let d=0;d<u.length;d++){let f=u[d];if(zp(n.emitsOptions,f))continue;const h=e[f];if(l)if(vn(i,f))h!==i[f]&&(i[f]=h,c=!0);else{const p=Qo(f);o[p]=P_(l,s,p,h,n,!1)}else h!==i[f]&&(i[f]=h,c=!0)}}}else{PE(n,e,o,i)&&(c=!0);let u;for(const d in s)(!e||!vn(e,d)&&((u=Ps(d))===d||!vn(e,u)))&&(l?t&&(t[d]!==void 0||t[u]!==void 0)&&(o[d]=P_(l,s,d,void 0,n,!0)):delete o[d]);if(i!==s)for(const d in i)(!e||!vn(e,d))&&(delete i[d],c=!0)}c&&Oa(n.attrs,"set","")}function PE(n,e,t,r){const[o,i]=n.propsOptions;let a=!1,s;if(e)for(let l in e){if(Id(l))continue;const c=e[l];let u;o&&vn(o,u=Qo(l))?!i||!i.includes(u)?t[u]=c:(s||(s={}))[u]=c:zp(n.emitsOptions,l)||(!(l in r)||c!==r[l])&&(r[l]=c,a=!0)}if(i){const l=cn(t),c=s||en;for(let u=0;u<i.length;u++){const d=i[u];t[d]=P_(o,l,d,c[d],n,!vn(c,d))}}return a}function P_(n,e,t,r,o,i){const a=n[t];if(a!=null){const s=vn(a,"default");if(s&&r===void 0){const l=a.default;if(a.type!==Function&&!a.skipFactory&&Lt(l)){const{propsDefaults:c}=o;if(t in c)r=c[t];else{const u=Kd(o);r=c[t]=l.call(null,e),u()}}else r=l;o.ce&&o.ce._setProp(t,r)}a[0]&&(i&&!s?r=!1:a[1]&&(r===""||r===Ps(t))&&(r=!0))}return r}const H8=new WeakMap;function DE(n,e,t=!1){const r=t?H8:e.propsCache,o=r.get(n);if(o)return o;const i=n.props,a={},s=[];let l=!1;if(!Lt(n)){const u=d=>{l=!0;const[f,h]=DE(d,e,!0);br(a,f),h&&s.push(...h)};!t&&e.mixins.length&&e.mixins.forEach(u),n.extends&&u(n.extends),n.mixins&&n.mixins.forEach(u)}if(!i&&!l)return wn(n)&&r.set(n,Tc),Tc;if(_t(i))for(let u=0;u<i.length;u++){const d=Qo(i[u]);BE(d)&&(a[d]=en)}else if(i)for(const u in i){const d=Qo(u);if(BE(d)){const f=i[u],h=a[d]=_t(f)||Lt(f)?{type:f}:br({},f),p=h.type;let m=!1,g=!0;if(_t(p))for(let _=0;_<p.length;++_){const A=p[_],y=Lt(A)&&A.name;if(y==="Boolean"){m=!0;break}else y==="String"&&(g=!1)}else m=Lt(p)&&p.name==="Boolean";h[0]=m,h[1]=g,(m||vn(h,"default"))&&s.push(d)}}const c=[a,s];return wn(n)&&r.set(n,c),c}function BE(n){return n[0]!=="$"&&!Id(n)}const D_=n=>n==="_"||n==="_ctx"||n==="$stable",B_=n=>_t(n)?n.map(ua):[ua(n)],W8=(n,e,t)=>{if(e._n)return e;const r=ot((...o)=>B_(e(...o)),t);return r._c=!1,r},NE=(n,e,t)=>{const r=n._ctx;for(const o in n){if(D_(o))continue;const i=n[o];if(Lt(i))e[o]=W8(o,i,r);else if(i!=null){const a=B_(i);e[o]=()=>a}}},OE=(n,e)=>{const t=B_(e);n.slots.default=()=>t},kE=(n,e,t)=>{for(const r in e)(t||!D_(r))&&(n[r]=e[r])},j8=(n,e,t)=>{const r=n.slots=RE();if(n.vnode.shapeFlag&32){const o=e._;o?(kE(r,e,t),t&&Ax(r,"_",o,!0)):NE(e,r)}else e&&OE(n,e)},Q8=(n,e,t)=>{const{vnode:r,slots:o}=n;let i=!0,a=en;if(r.shapeFlag&32){const s=e._;s?t&&s===1?i=!1:kE(o,e,t):(i=!e.$stable,NE(e,o)),a=e}else e&&(OE(n,e),a={default:1});if(i)for(const s in o)!D_(s)&&a[s]==null&&delete o[s]},ho=l7;function $8(n){return Y8(n)}function Y8(n,e){const t=vp();t.__VUE__=!0;const{insert:r,remove:o,patchProp:i,createElement:a,createText:s,createComment:l,setText:c,setElementText:u,parentNode:d,nextSibling:f,setScopeId:h=aa,insertStaticContent:p}=n,m=(v,M,S,I=null,J=null,$=null,B=void 0,V=null,Y=!!M.dynamicChildren)=>{if(v===M)return;v&&!Rl(v,M)&&(I=k(v),W(v,J,$,!0),v=null),M.patchFlag===-2&&(Y=!1,M.dynamicChildren=null);const{type:le,ref:me,shapeFlag:fe}=M;switch(le){case $d:g(v,M,S,I);break;case eo:_(v,M,S,I);break;case Gp:v==null&&A(M,S,I,B);break;case Nt:Q(v,M,S,I,J,$,B,V,Y);break;default:fe&1?E(v,M,S,I,J,$,B,V,Y):fe&6?re(v,M,S,I,J,$,B,V,Y):(fe&64||fe&128)&&le.process(v,M,S,I,J,$,B,V,Y,U)}me!=null&&J?Gd(me,v&&v.ref,$,M||v,!M):me==null&&v&&v.ref!=null&&Gd(v.ref,null,$,v,!0)},g=(v,M,S,I)=>{if(v==null)r(M.el=s(M.children),S,I);else{const J=M.el=v.el;M.children!==v.children&&c(J,M.children)}},_=(v,M,S,I)=>{v==null?r(M.el=l(M.children||""),S,I):M.el=v.el},A=(v,M,S,I)=>{[v.el,v.anchor]=p(v.children,M,S,I,v.el,v.anchor)},y=({el:v,anchor:M},S,I)=>{let J;for(;v&&v!==M;)J=f(v),r(v,S,I),v=J;r(M,S,I)},b=({el:v,anchor:M})=>{let S;for(;v&&v!==M;)S=f(v),o(v),v=S;o(M)},E=(v,M,S,I,J,$,B,V,Y)=>{if(M.type==="svg"?B="svg":M.type==="math"&&(B="mathml"),v==null)x(M,S,I,J,$,B,V,Y);else{const le=v.el&&v.el._isVueCE?v.el:null;try{le&&le._beginPatch(),C(v,M,J,$,B,V,Y)}finally{le&&le._endPatch()}}},x=(v,M,S,I,J,$,B,V)=>{let Y,le;const{props:me,shapeFlag:fe,transition:te,dirs:de}=v;if(Y=v.el=a(v.type,$,me&&me.is,me),fe&8?u(Y,v.children):fe&16&&L(v.children,Y,null,I,J,N_(v,$),B,V),de&&wl(v,null,I,"created"),w(Y,v,v.scopeId,B,I),me){for(const Ie in me)Ie!=="value"&&!Id(Ie)&&i(Y,Ie,null,me[Ie],$,I);"value"in me&&i(Y,"value",null,me.value,$),(le=me.onVnodeBeforeMount)&&da(le,I,v)}de&&wl(v,null,I,"beforeMount");const we=X8(J,te);we&&te.beforeEnter(Y),r(Y,M,S),((le=me&&me.onVnodeMounted)||we||de)&&ho(()=>{le&&da(le,I,v),we&&te.enter(Y),de&&wl(v,null,I,"mounted")},J)},w=(v,M,S,I,J)=>{if(S&&h(v,S),I)for(let $=0;$<I.length;$++)h(v,I[$]);if(J){let $=J.subTree;if(M===$||QE($.type)&&($.ssContent===M||$.ssFallback===M)){const B=J.vnode;w(v,B,B.scopeId,B.slotScopeIds,J.parent)}}},L=(v,M,S,I,J,$,B,V,Y=0)=>{for(let le=Y;le<v.length;le++){const me=v[le]=V?ks(v[le]):ua(v[le]);m(null,me,M,S,I,J,$,B,V)}},C=(v,M,S,I,J,$,B)=>{const V=M.el=v.el;let{patchFlag:Y,dynamicChildren:le,dirs:me}=M;Y|=v.patchFlag&16;const fe=v.props||en,te=M.props||en;let de;if(S&&Il(S,!1),(de=te.onVnodeBeforeUpdate)&&da(de,S,M,v),me&&wl(M,v,S,"beforeUpdate"),S&&Il(S,!0),(fe.innerHTML&&te.innerHTML==null||fe.textContent&&te.textContent==null)&&u(V,""),le?P(v.dynamicChildren,le,V,S,I,N_(M,J),$):B||H(v,M,V,null,S,I,N_(M,J),$,!1),Y>0){if(Y&16)D(V,fe,te,S,J);else if(Y&2&&fe.class!==te.class&&i(V,"class",null,te.class,J),Y&4&&i(V,"style",fe.style,te.style,J),Y&8){const we=M.dynamicProps;for(let Ie=0;Ie<we.length;Ie++){const Ne=we[Ie],He=fe[Ne],je=te[Ne];(je!==He||Ne==="value")&&i(V,Ne,He,je,J,S)}}Y&1&&v.children!==M.children&&u(V,M.children)}else!B&&le==null&&D(V,fe,te,S,J);((de=te.onVnodeUpdated)||me)&&ho(()=>{de&&da(de,S,M,v),me&&wl(M,v,S,"updated")},I)},P=(v,M,S,I,J,$,B)=>{for(let V=0;V<M.length;V++){const Y=v[V],le=M[V],me=Y.el&&(Y.type===Nt||!Rl(Y,le)||Y.shapeFlag&198)?d(Y.el):S;m(Y,le,me,null,I,J,$,B,!0)}},D=(v,M,S,I,J)=>{if(M!==S){if(M!==en)for(const $ in M)!Id($)&&!($ in S)&&i(v,$,M[$],null,J,I);for(const $ in S){if(Id($))continue;const B=S[$],V=M[$];B!==V&&$!=="value"&&i(v,$,V,B,J,I)}"value"in S&&i(v,"value",M.value,S.value,J)}},Q=(v,M,S,I,J,$,B,V,Y)=>{const le=M.el=v?v.el:s(""),me=M.anchor=v?v.anchor:s("");let{patchFlag:fe,dynamicChildren:te,slotScopeIds:de}=M;de&&(V=V?V.concat(de):de),v==null?(r(le,S,I),r(me,S,I),L(M.children||[],S,me,J,$,B,V,Y)):fe>0&&fe&64&&te&&v.dynamicChildren?(P(v.dynamicChildren,te,S,J,$,B,V),(M.key!=null||J&&M===J.subTree)&&O_(v,M,!0)):H(v,M,S,me,J,$,B,V,Y)},re=(v,M,S,I,J,$,B,V,Y)=>{M.slotScopeIds=V,v==null?M.shapeFlag&512?J.ctx.activate(M,S,I,B,Y):G(M,S,I,J,$,B,Y):se(v,M,Y)},G=(v,M,S,I,J,$,B)=>{const V=v.component=m7(v,I,J);if(Hd(v)&&(V.ctx.renderer=U),g7(V,!1,B),V.asyncDep){if(J&&J.registerDep(V,ee,B),!v.el){const Y=V.subTree=Be(eo);_(null,Y,M,S),v.placeholder=Y.el}}else ee(V,v,M,S,J,$,B)},se=(v,M,S)=>{const I=M.component=v.component;if(a7(v,M,S))if(I.asyncDep&&!I.asyncResolved){ie(I,M,S);return}else I.next=M,I.update();else M.el=v.el,I.vnode=M},ee=(v,M,S,I,J,$,B)=>{const V=()=>{if(v.isMounted){let{next:fe,bu:te,u:de,parent:we,vnode:Ie}=v;{const Vt=FE(v);if(Vt){fe&&(fe.el=Ie.el,ie(v,fe,B)),Vt.asyncDep.then(()=>{v.isUnmounted||V()});return}}let Ne=fe,He;Il(v,!1),fe?(fe.el=Ie.el,ie(v,fe,B)):fe=Ie,te&&gp(te),(He=fe.props&&fe.props.onVnodeBeforeUpdate)&&da(He,we,fe,Ie),Il(v,!0);const je=WE(v),ct=v.subTree;v.subTree=je,m(ct,je,d(ct.el),k(ct),v,J,$),fe.el=je.el,Ne===null&&s7(v,je.el),de&&ho(de,J),(He=fe.props&&fe.props.onVnodeUpdated)&&ho(()=>da(He,we,fe,Ie),J)}else{let fe;const{el:te,props:de}=M,{bm:we,m:Ie,parent:Ne,root:He,type:je}=v,ct=kc(M);Il(v,!1),we&&gp(we),!ct&&(fe=de&&de.onVnodeBeforeMount)&&da(fe,Ne,M),Il(v,!0);{He.ce&&He.ce._def.shadowRoot!==!1&&He.ce._injectChildStyle(je);const Vt=v.subTree=WE(v);m(null,Vt,S,I,v,J,$),M.el=Vt.el}if(Ie&&ho(Ie,J),!ct&&(fe=de&&de.onVnodeMounted)){const Vt=M;ho(()=>da(fe,Ne,Vt),J)}(M.shapeFlag&256||Ne&&kc(Ne.vnode)&&Ne.vnode.shapeFlag&256)&&v.a&&ho(v.a,J),v.isMounted=!0,M=S=I=null}};v.scope.on();const Y=v.effect=new wx(V);v.scope.off();const le=v.update=Y.run.bind(Y),me=v.job=Y.runIfDirty.bind(Y);me.i=v,me.id=v.uid,Y.scheduler=()=>E_(me),Il(v,!0),le()},ie=(v,M,S)=>{M.component=v;const I=v.vnode.props;v.vnode=M,v.next=null,G8(v,M.props,I,S),Q8(v,M.children,S),sa(),qx(v),la()},H=(v,M,S,I,J,$,B,V,Y=!1)=>{const le=v&&v.children,me=v?v.shapeFlag:0,fe=M.children,{patchFlag:te,shapeFlag:de}=M;if(te>0){if(te&128){R(le,fe,S,I,J,$,B,V,Y);return}else if(te&256){T(le,fe,S,I,J,$,B,V,Y);return}}de&8?(me&16&&F(le,J,$),fe!==le&&u(S,fe)):me&16?de&16?R(le,fe,S,I,J,$,B,V,Y):F(le,J,$,!0):(me&8&&u(S,""),de&16&&L(fe,S,I,J,$,B,V,Y))},T=(v,M,S,I,J,$,B,V,Y)=>{v=v||Tc,M=M||Tc;const le=v.length,me=M.length,fe=Math.min(le,me);let te;for(te=0;te<fe;te++){const de=M[te]=Y?ks(M[te]):ua(M[te]);m(v[te],de,S,null,J,$,B,V,Y)}le>me?F(v,J,$,!0,!1,fe):L(M,S,I,J,$,B,V,Y,fe)},R=(v,M,S,I,J,$,B,V,Y)=>{let le=0;const me=M.length;let fe=v.length-1,te=me-1;for(;le<=fe&&le<=te;){const de=v[le],we=M[le]=Y?ks(M[le]):ua(M[le]);if(Rl(de,we))m(de,we,S,null,J,$,B,V,Y);else break;le++}for(;le<=fe&&le<=te;){const de=v[fe],we=M[te]=Y?ks(M[te]):ua(M[te]);if(Rl(de,we))m(de,we,S,null,J,$,B,V,Y);else break;fe--,te--}if(le>fe){if(le<=te){const de=te+1,we=de<me?M[de].el:I;for(;le<=te;)m(null,M[le]=Y?ks(M[le]):ua(M[le]),S,we,J,$,B,V,Y),le++}}else if(le>te)for(;le<=fe;)W(v[le],J,$,!0),le++;else{const de=le,we=le,Ie=new Map;for(le=we;le<=te;le++){const pe=M[le]=Y?ks(M[le]):ua(M[le]);pe.key!=null&&Ie.set(pe.key,le)}let Ne,He=0;const je=te-we+1;let ct=!1,Vt=0;const En=new Array(je);for(le=0;le<je;le++)En[le]=0;for(le=de;le<=fe;le++){const pe=v[le];if(He>=je){W(pe,J,$,!0);continue}let Te;if(pe.key!=null)Te=Ie.get(pe.key);else for(Ne=we;Ne<=te;Ne++)if(En[Ne-we]===0&&Rl(pe,M[Ne])){Te=Ne;break}Te===void 0?W(pe,J,$,!0):(En[Te-we]=le+1,Te>=Vt?Vt=Te:ct=!0,m(pe,M[Te],S,null,J,$,B,V,Y),He++)}const Rt=ct?q8(En):Tc;for(Ne=Rt.length-1,le=je-1;le>=0;le--){const pe=we+le,Te=M[pe],Ce=M[pe+1],Zt=pe+1<me?Ce.el||Ce.placeholder:I;En[le]===0?m(null,Te,S,Zt,J,$,B,V,Y):ct&&(Ne<0||le!==Rt[Ne]?O(Te,S,Zt,2):Ne--)}}},O=(v,M,S,I,J=null)=>{const{el:$,type:B,transition:V,children:Y,shapeFlag:le}=v;if(le&6){O(v.component.subTree,M,S,I);return}if(le&128){v.suspense.move(M,S,I);return}if(le&64){B.move(v,M,S,U);return}if(B===Nt){r($,M,S);for(let fe=0;fe<Y.length;fe++)O(Y[fe],M,S,I);r(v.anchor,M,S);return}if(B===Gp){y(v,M,S);return}if(I!==2&&le&1&&V)if(I===0)V.beforeEnter($),r($,M,S),ho(()=>V.enter($),J);else{const{leave:fe,delayLeave:te,afterLeave:de}=V,we=()=>{v.ctx.isUnmounted?o($):r($,M,S)},Ie=()=>{$._isLeaving&&$[Ua](!0),fe($,()=>{we(),de&&de()})};te?te($,we,Ie):Ie()}else r($,M,S)},W=(v,M,S,I=!1,J=!1)=>{const{type:$,props:B,ref:V,children:Y,dynamicChildren:le,shapeFlag:me,patchFlag:fe,dirs:te,cacheIndex:de}=v;if(fe===-2&&(J=!1),V!=null&&(sa(),Gd(V,null,S,v,!0),la()),de!=null&&(M.renderCache[de]=void 0),me&256){M.ctx.deactivate(v);return}const we=me&1&&te,Ie=!kc(v);let Ne;if(Ie&&(Ne=B&&B.onVnodeBeforeUnmount)&&da(Ne,M,v),me&6)oe(v.component,S,I);else{if(me&128){v.suspense.unmount(S,I);return}we&&wl(v,null,M,"beforeUnmount"),me&64?v.type.remove(v,M,S,U,I):le&&!le.hasOnce&&($!==Nt||fe>0&&fe&64)?F(le,M,S,!1,!0):($===Nt&&fe&384||!J&&me&16)&&F(Y,M,S),I&&ae(v)}(Ie&&(Ne=B&&B.onVnodeUnmounted)||we)&&ho(()=>{Ne&&da(Ne,M,v),we&&wl(v,null,M,"unmounted")},S)},ae=v=>{const{type:M,el:S,anchor:I,transition:J}=v;if(M===Nt){ne(S,I);return}if(M===Gp){b(v);return}const $=()=>{o(S),J&&!J.persisted&&J.afterLeave&&J.afterLeave()};if(v.shapeFlag&1&&J&&!J.persisted){const{leave:B,delayLeave:V}=J,Y=()=>B(S,$);V?V(v.el,$,Y):Y()}else $()},ne=(v,M)=>{let S;for(;v!==M;)S=f(v),o(v),v=S;o(M)},oe=(v,M,S)=>{const{bum:I,scope:J,job:$,subTree:B,um:V,m:Y,a:le}=v;VE(Y),VE(le),I&&gp(I),J.stop(),$&&($.flags|=8,W(B,v,M,S)),V&&ho(V,M),ho(()=>{v.isUnmounted=!0},M)},F=(v,M,S,I=!1,J=!1,$=0)=>{for(let B=$;B<v.length;B++)W(v[B],M,S,I,J)},k=v=>{if(v.shapeFlag&6)return k(v.component.subTree);if(v.shapeFlag&128)return v.suspense.next();const M=f(v.anchor||v.el),S=M&&M[eE];return S?f(S):M};let q=!1;const j=(v,M,S)=>{v==null?M._vnode&&W(M._vnode,null,null,!0):m(M._vnode||null,v,M,null,null,null,S),M._vnode=v,q||(q=!0,qx(),Kx(),q=!1)},U={p:m,um:W,m:O,r:ae,mt:G,mc:L,pc:H,pbc:P,n:k,o:n};return{render:j,hydrate:void 0,createApp:U8(j)}}function N_({type:n,props:e},t){return t==="svg"&&n==="foreignObject"||t==="mathml"&&n==="annotation-xml"&&e&&e.encoding&&e.encoding.includes("html")?void 0:t}function Il({effect:n,job:e},t){t?(n.flags|=32,e.flags|=4):(n.flags&=-33,e.flags&=-5)}function X8(n,e){return(!n||n&&!n.pendingBranch)&&e&&!e.persisted}function O_(n,e,t=!1){const r=n.children,o=e.children;if(_t(r)&&_t(o))for(let i=0;i<r.length;i++){const a=r[i];let s=o[i];s.shapeFlag&1&&!s.dynamicChildren&&((s.patchFlag<=0||s.patchFlag===32)&&(s=o[i]=ks(o[i]),s.el=a.el),!t&&s.patchFlag!==-2&&O_(a,s)),s.type===$d&&s.patchFlag!==-1&&(s.el=a.el),s.type===eo&&!s.el&&(s.el=a.el)}}function q8(n){const e=n.slice(),t=[0];let r,o,i,a,s;const l=n.length;for(r=0;r<l;r++){const c=n[r];if(c!==0){if(o=t[t.length-1],n[o]<c){e[r]=o,t.push(r);continue}for(i=0,a=t.length-1;i<a;)s=i+a>>1,n[t[s]]<c?i=s+1:a=s;c<n[t[i]]&&(i>0&&(e[r]=t[i-1]),t[i]=r)}}for(i=t.length,a=t[i-1];i-- >0;)t[i]=a,a=e[a];return t}function FE(n){const e=n.subTree.component;if(e)return e.asyncDep&&!e.asyncResolved?e:FE(e)}function VE(n){if(n)for(let e=0;e<n.length;e++)n[e].flags|=8}const K8=Symbol.for("v-scx"),Z8=()=>Lo(K8);function UE(n,e){return Up(n,null,e)}function J8(n,e){return Up(n,null,{flush:"sync"})}function dr(n,e,t){return Up(n,e,t)}function Up(n,e,t=en){const{immediate:r,deep:o,flush:i,once:a}=t,s=br({},t),l=e&&r||!e&&i!=="post";let c;if(Vc){if(i==="sync"){const h=Z8();c=h.__watcherHandles||(h.__watcherHandles=[])}else if(!l){const h=()=>{};return h.stop=aa,h.resume=aa,h.pause=aa,h}}const u=Gr;s.call=(h,p,m)=>ki(h,u,p,m);let d=!1;i==="post"?s.scheduler=h=>{ho(h,u&&u.suspense)}:i!=="sync"&&(d=!0,s.scheduler=(h,p)=>{p?h():E_(h)}),s.augmentJob=h=>{e&&(h.flags|=4),d&&(h.flags|=2,u&&(h.id=u.uid,h.i=u))};const f=l8(n,e,s);return Vc&&(c?c.push(f):l&&f()),f}function e7(n,e,t){const r=this.proxy,o=Yn(n)?n.includes(".")?zE(r,n):()=>r[n]:n.bind(r,r);let i;Lt(e)?i=e:(i=e.handler,t=e);const a=Kd(this),s=Up(o,i.bind(r),t);return a(),s}function zE(n,e){const t=e.split(".");return()=>{let r=n;for(let o=0;o<t.length&&r;o++)r=r[t[o]];return r}}function t7(n,e,t=en){const r=Po(),o=Qo(e),i=Ps(e),a=GE(n,o),s=o8((l,c)=>{let u,d=en,f;return J8(()=>{const h=n[o];Io(u,h)&&(u=h,c())}),{get(){return l(),t.get?t.get(u):u},set(h){const p=t.set?t.set(h):h;if(!Io(p,u)&&!(d!==en&&Io(h,d)))return;const m=r.vnode.props;m&&(e in m||o in m||i in m)&&(`onUpdate:${e}`in m||`onUpdate:${o}`in m||`onUpdate:${i}`in m)||(u=h,c()),r.emit(`update:${e}`,p),Io(h,p)&&Io(h,d)&&!Io(p,f)&&c(),d=h,f=p}}});return s[Symbol.iterator]=()=>{let l=0;return{next(){return l<2?{value:l++?a||en:s,done:!1}:{done:!0}}}},s}const GE=(n,e)=>e==="modelValue"||e==="model-value"?n.modelModifiers:n[`${e}Modifiers`]||n[`${Qo(e)}Modifiers`]||n[`${Ps(e)}Modifiers`];function n7(n,e,...t){if(n.isUnmounted)return;const r=n.vnode.props||en;let o=t;const i=e.startsWith("update:"),a=i&&GE(r,e.slice(7));a&&(a.trim&&(o=t.map(u=>Yn(u)?u.trim():u)),a.number&&(o=t.map(_p)));let s,l=r[s=l_(e)]||r[s=l_(Qo(e))];!l&&i&&(l=r[s=l_(Ps(e))]),l&&ki(l,n,6,o);const c=r[s+"Once"];if(c){if(!n.emitted)n.emitted={};else if(n.emitted[s])return;n.emitted[s]=!0,ki(c,n,6,o)}}const r7=new WeakMap;function HE(n,e,t=!1){const r=t?r7:e.emitsCache,o=r.get(n);if(o!==void 0)return o;const i=n.emits;let a={},s=!1;if(!Lt(n)){const l=c=>{const u=HE(c,e,!0);u&&(s=!0,br(a,u))};!t&&e.mixins.length&&e.mixins.forEach(l),n.extends&&l(n.extends),n.mixins&&n.mixins.forEach(l)}return!i&&!s?(wn(n)&&r.set(n,null),null):(_t(i)?i.forEach(l=>a[l]=null):br(a,i),wn(n)&&r.set(n,a),a)}function zp(n,e){return!n||!hp(e)?!1:(e=e.slice(2).replace(/Once$/,""),vn(n,e[0].toLowerCase()+e.slice(1))||vn(n,Ps(e))||vn(n,e))}function R3e(){}function WE(n){const{type:e,vnode:t,proxy:r,withProxy:o,propsOptions:[i],slots:a,attrs:s,emit:l,render:c,renderCache:u,props:d,data:f,setupState:h,ctx:p,inheritAttrs:m}=n,g=Rp(n);let _,A;try{if(t.shapeFlag&4){const b=o||r,E=b;_=ua(c.call(E,b,u,d,h,f,p)),A=s}else{const b=e;_=ua(b.length>1?b(d,{attrs:s,slots:a,emit:l}):b(d,null)),A=e.props?s:o7(s)}}catch(b){Yd.length=0,Fd(b,n,1),_=Be(eo)}let y=_;if(A&&m!==!1){const b=Object.keys(A),{shapeFlag:E}=y;b.length&&E&7&&(i&&b.some(i_)&&(A=i7(A,i)),y=Os(y,A,!1,!0))}return t.dirs&&(y=Os(y,null,!1,!0),y.dirs=y.dirs?y.dirs.concat(t.dirs):t.dirs),t.transition&&zd(y,t.transition),_=y,Rp(g),_}const o7=n=>{let e;for(const t in n)(t==="class"||t==="style"||hp(t))&&((e||(e={}))[t]=n[t]);return e},i7=(n,e)=>{const t={};for(const r in n)(!i_(r)||!(r.slice(9)in e))&&(t[r]=n[r]);return t};function a7(n,e,t){const{props:r,children:o,component:i}=n,{props:a,children:s,patchFlag:l}=e,c=i.emitsOptions;if(e.dirs||e.transition)return!0;if(t&&l>=0){if(l&1024)return!0;if(l&16)return r?jE(r,a,c):!!a;if(l&8){const u=e.dynamicProps;for(let d=0;d<u.length;d++){const f=u[d];if(a[f]!==r[f]&&!zp(c,f))return!0}}}else return(o||s)&&(!s||!s.$stable)?!0:r===a?!1:r?a?jE(r,a,c):!0:!!a;return!1}function jE(n,e,t){const r=Object.keys(e);if(r.length!==Object.keys(n).length)return!0;for(let o=0;o<r.length;o++){const i=r[o];if(e[i]!==n[i]&&!zp(t,i))return!0}return!1}function s7({vnode:n,parent:e},t){for(;e;){const r=e.subTree;if(r.suspense&&r.suspense.activeBranch===n&&(r.el=n.el),r===n)(n=e.vnode).el=t,e=e.parent;else break}}const QE=n=>n.__isSuspense;function l7(n,e){e&&e.pendingBranch?_t(n)?e.effects.push(...n):e.effects.push(n):m8(n)}const Nt=Symbol.for("v-fgt"),$d=Symbol.for("v-txt"),eo=Symbol.for("v-cmt"),Gp=Symbol.for("v-stc"),Yd=[];let Yo=null;function he(n=!1){Yd.push(Yo=n?null:[])}function c7(){Yd.pop(),Yo=Yd[Yd.length-1]||null}let Xd=1;function Hp(n,e=!1){Xd+=n,n<0&&Yo&&e&&(Yo.hasOnce=!0)}function $E(n){return n.dynamicChildren=Xd>0?Yo||Tc:null,c7(),Xd>0&&Yo&&Yo.push(n),n}function ye(n,e,t,r,o,i){return $E(K(n,e,t,r,o,i,!0))}function gt(n,e,t,r,o){return $E(Be(n,e,t,r,o,!0))}function qd(n){return n?n.__v_isVNode===!0:!1}function Rl(n,e){return n.type===e.type&&n.key===e.key}const YE=({key:n})=>n??null,Wp=({ref:n,ref_key:e,ref_for:t})=>(typeof n=="number"&&(n=""+n),n!=null?Yn(n)||Ir(n)||Lt(n)?{i:zr,r:n,k:e,f:!!t}:n:null);function K(n,e=null,t=null,r=0,o=null,i=n===Nt?0:1,a=!1,s=!1){const l={__v_isVNode:!0,__v_skip:!0,type:n,props:e,key:e&&YE(e),ref:e&&Wp(e),scopeId:Jx,slotScopeIds:null,children:t,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetStart:null,targetAnchor:null,staticCount:0,shapeFlag:i,patchFlag:r,dynamicProps:o,dynamicChildren:null,appContext:null,ctx:zr};return s?(k_(l,t),i&128&&n.normalize(l)):t&&(l.shapeFlag|=Yn(t)?8:16),Xd>0&&!a&&Yo&&(l.patchFlag>0||i&6)&&l.patchFlag!==32&&Yo.push(l),l}const Be=u7;function u7(n,e=null,t=null,r=0,o=null,i=!1){if((!n||n===L8)&&(n=eo),qd(n)){const s=Os(n,e,!0);return t&&k_(s,t),Xd>0&&!i&&Yo&&(s.shapeFlag&6?Yo[Yo.indexOf(n)]=s:Yo.push(s)),s.patchFlag=-2,s}if(x7(n)&&(n=n.__vccOpts),e){e=d7(e);let{class:s,style:l}=e;s&&!Yn(s)&&(e.class=Qt(s)),wn(l)&&(b_(l)&&!_t(l)&&(l=br({},l)),e.style=Rd(l))}const a=Yn(n)?1:QE(n)?128:tE(n)?64:wn(n)?4:Lt(n)?2:0;return K(n,e,t,r,o,a,i,!0)}function d7(n){return n?b_(n)||LE(n)?br({},n):n:null}function Os(n,e,t=!1,r=!1){const{props:o,ref:i,patchFlag:a,children:s,transition:l}=n,c=e?f7(o||{},e):o,u={__v_isVNode:!0,__v_skip:!0,type:n.type,props:c,key:c&&YE(c),ref:e&&e.ref?t&&i?_t(i)?i.concat(Wp(e)):[i,Wp(e)]:Wp(e):i,scopeId:n.scopeId,slotScopeIds:n.slotScopeIds,children:s,target:n.target,targetStart:n.targetStart,targetAnchor:n.targetAnchor,staticCount:n.staticCount,shapeFlag:n.shapeFlag,patchFlag:e&&n.type!==Nt?a===-1?16:a|16:a,dynamicProps:n.dynamicProps,dynamicChildren:n.dynamicChildren,appContext:n.appContext,dirs:n.dirs,transition:l,component:n.component,suspense:n.suspense,ssContent:n.ssContent&&Os(n.ssContent),ssFallback:n.ssFallback&&Os(n.ssFallback),placeholder:n.placeholder,el:n.el,anchor:n.anchor,ctx:n.ctx,ce:n.ce};return l&&r&&zd(u,l.clone(u)),u}function Ye(n=" ",e=0){return Be($d,null,n,e)}function XE(n,e){const t=Be(Gp,null,n);return t.staticCount=e,t}function Pe(n="",e=!1){return e?(he(),gt(eo,null,n)):Be(eo,null,n)}function ua(n){return n==null||typeof n=="boolean"?Be(eo):_t(n)?Be(Nt,null,n.slice()):qd(n)?ks(n):Be($d,null,String(n))}function ks(n){return n.el===null&&n.patchFlag!==-1||n.memo?n:Os(n)}function k_(n,e){let t=0;const{shapeFlag:r}=n;if(e==null)e=null;else if(_t(e))t=16;else if(typeof e=="object")if(r&65){const o=e.default;o&&(o._c&&(o._d=!1),k_(n,o()),o._c&&(o._d=!0));return}else{t=32;const o=e._;!o&&!LE(e)?e._ctx=zr:o===3&&zr&&(zr.slots._===1?e._=1:(e._=2,n.patchFlag|=1024))}else Lt(e)?(e={default:e,_ctx:zr},t=32):(e=String(e),r&64?(t=16,e=[Ye(e)]):t=8);n.children=e,n.shapeFlag|=t}function f7(...n){const e={};for(let t=0;t<n.length;t++){const r=n[t];for(const o in r)if(o==="class")e.class!==r.class&&(e.class=Qt([e.class,r.class]));else if(o==="style")e.style=Rd([e.style,r.style]);else if(hp(o)){const i=e[o],a=r[o];a&&i!==a&&!(_t(i)&&i.includes(a))&&(e[o]=i?[].concat(i,a):a)}else o!==""&&(e[o]=r[o])}return e}function da(n,e,t,r=null){ki(n,e,7,[t,r])}const h7=ME();let p7=0;function m7(n,e,t){const r=n.type,o=(e?e.appContext:n.appContext)||h7,i={uid:p7++,vnode:n,type:r,parent:e,appContext:o,root:null,next:null,subTree:null,effect:null,update:null,job:null,scope:new Cx(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:e?e.provides:Object.create(o.provides),ids:e?e.ids:["",0,0],accessCache:null,renderCache:[],components:null,directives:null,propsOptions:DE(r,o),emitsOptions:HE(r,o),emit:null,emitted:null,propsDefaults:en,inheritAttrs:r.inheritAttrs,ctx:en,data:en,props:en,attrs:en,slots:en,refs:en,setupState:en,setupContext:null,suspense:t,suspenseId:t?t.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return i.ctx={_:i},i.root=e?e.root:i,i.emit=n7.bind(null,i),n.ce&&n.ce(i),i}let Gr=null;const Po=()=>Gr||zr;let jp,F_;{const n=vp(),e=(t,r)=>{let o;return(o=n[t])||(o=n[t]=[]),o.push(r),i=>{o.length>1?o.forEach(a=>a(i)):o[0](i)}};jp=e("__VUE_INSTANCE_SETTERS__",t=>Gr=t),F_=e("__VUE_SSR_SETTERS__",t=>Vc=t)}const Kd=n=>{const e=Gr;return jp(n),n.scope.on(),()=>{n.scope.off(),jp(e)}},qE=()=>{Gr&&Gr.scope.off(),jp(null)};function KE(n){return n.vnode.shapeFlag&4}let Vc=!1;function g7(n,e=!1,t=!1){e&&F_(e);const{props:r,children:o}=n.vnode,i=KE(n);z8(n,r,i,e),j8(n,o,t||e);const a=i?_7(n,e):void 0;return e&&F_(!1),a}function _7(n,e){const t=n.type;n.accessCache=Object.create(null),n.proxy=new Proxy(n.ctx,D8);const{setup:r}=t;if(r){sa();const o=n.setupContext=r.length>1?A7(n):null,i=Kd(n),a=Dc(r,n,0,[n.props,o]),s=gx(a);if(la(),i(),(s||n.sp)&&!kc(n)&&M_(n),s){if(a.then(qE,qE),e)return a.then(l=>{ZE(n,l)}).catch(l=>{Fd(l,n,0)});n.asyncDep=a}else ZE(n,a)}else JE(n)}function ZE(n,e,t){Lt(e)?n.type.__ssrInlineRender?n.ssrRender=e:n.render=e:wn(e)&&(n.setupState=Qx(e)),JE(n)}function JE(n,e,t){const r=n.type;n.render||(n.render=r.render||aa);{const o=Kd(n);sa();try{B8(n)}finally{la(),o()}}}const v7={get(n,e){return Kr(n,"get",""),n[e]}};function A7(n){const e=t=>{n.exposed=t||{}};return{attrs:new Proxy(n.attrs,v7),slots:n.slots,emit:n.emit,expose:e}}function Qp(n){return n.exposed?n.exposeProxy||(n.exposeProxy=new Proxy(Qx(e8(n.exposed)),{get(e,t){if(t in e)return e[t];if(t in jd)return jd[t](n)},has(e,t){return t in e||t in jd}})):n.proxy}const y7=/(?:^|[-_])\w/g,b7=n=>n.replace(y7,e=>e.toUpperCase()).replace(/[-_]/g,"");function eC(n,e=!0){return Lt(n)?n.displayName||n.name:n.name||e&&n.__name}function tC(n,e,t=!1){let r=eC(e);if(!r&&e.__file){const o=e.__file.match(/([^/\\]+)\.\w+$/);o&&(r=o[1])}if(!r&&n&&n.parent){const o=i=>{for(const a in i)if(i[a]===e)return a};r=o(n.components||n.parent.type.components)||o(n.appContext.components)}return r?b7(r):t?"App":"Anonymous"}function x7(n){return Lt(n)&&"__vccOpts"in n}const bt=(n,e)=>a8(n,e,Vc);function Zd(n,e,t){try{Hp(-1);const r=arguments.length;return r===2?wn(e)&&!_t(e)?qd(e)?Be(n,null,[e]):Be(n,e):Be(n,null,e):(r>3?t=Array.prototype.slice.call(arguments,2):r===3&&qd(t)&&(t=[t]),Be(n,e,t))}finally{Hp(1)}}const E7="3.5.23";/**
* @vue/runtime-dom v3.5.23
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let V_;const nC=typeof window<"u"&&window.trustedTypes;if(nC)try{V_=nC.createPolicy("vue",{createHTML:n=>n})}catch{}const rC=V_?n=>V_.createHTML(n):n=>n,C7="http://www.w3.org/2000/svg",S7="http://www.w3.org/1998/Math/MathML",Ga=typeof document<"u"?document:null,oC=Ga&&Ga.createElement("template"),w7={insert:(n,e,t)=>{e.insertBefore(n,t||null)},remove:n=>{const e=n.parentNode;e&&e.removeChild(n)},createElement:(n,e,t,r)=>{const o=e==="svg"?Ga.createElementNS(C7,n):e==="mathml"?Ga.createElementNS(S7,n):t?Ga.createElement(n,{is:t}):Ga.createElement(n);return n==="select"&&r&&r.multiple!=null&&o.setAttribute("multiple",r.multiple),o},createText:n=>Ga.createTextNode(n),createComment:n=>Ga.createComment(n),setText:(n,e)=>{n.nodeValue=e},setElementText:(n,e)=>{n.textContent=e},parentNode:n=>n.parentNode,nextSibling:n=>n.nextSibling,querySelector:n=>Ga.querySelector(n),setScopeId(n,e){n.setAttribute(e,"")},insertStaticContent(n,e,t,r,o,i){const a=t?t.previousSibling:e.lastChild;if(o&&(o===i||o.nextSibling))for(;e.insertBefore(o.cloneNode(!0),t),!(o===i||!(o=o.nextSibling)););else{oC.innerHTML=rC(r==="svg"?`<svg>${n}</svg>`:r==="mathml"?`<math>${n}</math>`:n);const s=oC.content;if(r==="svg"||r==="mathml"){const l=s.firstChild;for(;l.firstChild;)s.appendChild(l.firstChild);s.removeChild(l)}e.insertBefore(s,t)}return[a?a.nextSibling:e.firstChild,t?t.previousSibling:e.lastChild]}},Fs="transition",Jd="animation",ef=Symbol("_vtc"),iC={name:String,type:String,css:{type:Boolean,default:!0},duration:[String,Number,Object],enterFromClass:String,enterActiveClass:String,enterToClass:String,appearFromClass:String,appearActiveClass:String,appearToClass:String,leaveFromClass:String,leaveActiveClass:String,leaveToClass:String},M7=br({},sE,iC),Ll=(n=>(n.displayName="Transition",n.props=M7,n))((n,{slots:e})=>Zd(A8,T7(n),e)),Pl=(n,e=[])=>{_t(n)?n.forEach(t=>t(...e)):n&&n(...e)},aC=n=>n?_t(n)?n.some(e=>e.length>1):n.length>1:!1;function T7(n){const e={};for(const Q in n)Q in iC||(e[Q]=n[Q]);if(n.css===!1)return e;const{name:t="v",type:r,duration:o,enterFromClass:i=`${t}-enter-from`,enterActiveClass:a=`${t}-enter-active`,enterToClass:s=`${t}-enter-to`,appearFromClass:l=i,appearActiveClass:c=a,appearToClass:u=s,leaveFromClass:d=`${t}-leave-from`,leaveActiveClass:f=`${t}-leave-active`,leaveToClass:h=`${t}-leave-to`}=n,p=I7(o),m=p&&p[0],g=p&&p[1],{onBeforeEnter:_,onEnter:A,onEnterCancelled:y,onLeave:b,onLeaveCancelled:E,onBeforeAppear:x=_,onAppear:w=A,onAppearCancelled:L=y}=e,C=(Q,re,G,se)=>{Q._enterCancelled=se,Dl(Q,re?u:s),Dl(Q,re?c:a),G&&G()},P=(Q,re)=>{Q._isLeaving=!1,Dl(Q,d),Dl(Q,h),Dl(Q,f),re&&re()},D=Q=>(re,G)=>{const se=Q?w:A,ee=()=>C(re,Q,G);Pl(se,[re,ee]),sC(()=>{Dl(re,Q?l:i),Ha(re,Q?u:s),aC(se)||lC(re,r,m,ee)})};return br(e,{onBeforeEnter(Q){Pl(_,[Q]),Ha(Q,i),Ha(Q,a)},onBeforeAppear(Q){Pl(x,[Q]),Ha(Q,l),Ha(Q,c)},onEnter:D(!1),onAppear:D(!0),onLeave(Q,re){Q._isLeaving=!0;const G=()=>P(Q,re);Ha(Q,d),Q._enterCancelled?(Ha(Q,f),dC(Q)):(dC(Q),Ha(Q,f)),sC(()=>{Q._isLeaving&&(Dl(Q,d),Ha(Q,h),aC(b)||lC(Q,r,g,G))}),Pl(b,[Q,G])},onEnterCancelled(Q){C(Q,!1,void 0,!0),Pl(y,[Q])},onAppearCancelled(Q){C(Q,!0,void 0,!0),Pl(L,[Q])},onLeaveCancelled(Q){P(Q),Pl(E,[Q])}})}function I7(n){if(n==null)return null;if(wn(n))return[U_(n.enter),U_(n.leave)];{const e=U_(n);return[e,e]}}function U_(n){return MN(n)}function Ha(n,e){e.split(/\s+/).forEach(t=>t&&n.classList.add(t)),(n[ef]||(n[ef]=new Set)).add(e)}function Dl(n,e){e.split(/\s+/).forEach(r=>r&&n.classList.remove(r));const t=n[ef];t&&(t.delete(e),t.size||(n[ef]=void 0))}function sC(n){requestAnimationFrame(()=>{requestAnimationFrame(n)})}let R7=0;function lC(n,e,t,r){const o=n._endId=++R7,i=()=>{o===n._endId&&r()};if(t!=null)return setTimeout(i,t);const{type:a,timeout:s,propCount:l}=L7(n,e);if(!a)return r();const c=a+"end";let u=0;const d=()=>{n.removeEventListener(c,f),i()},f=h=>{h.target===n&&++u>=l&&d()};setTimeout(()=>{u<l&&d()},s+1),n.addEventListener(c,f)}function L7(n,e){const t=window.getComputedStyle(n),r=p=>(t[p]||"").split(", "),o=r(`${Fs}Delay`),i=r(`${Fs}Duration`),a=cC(o,i),s=r(`${Jd}Delay`),l=r(`${Jd}Duration`),c=cC(s,l);let u=null,d=0,f=0;e===Fs?a>0&&(u=Fs,d=a,f=i.length):e===Jd?c>0&&(u=Jd,d=c,f=l.length):(d=Math.max(a,c),u=d>0?a>c?Fs:Jd:null,f=u?u===Fs?i.length:l.length:0);const h=u===Fs&&/\b(?:transform|all)(?:,|$)/.test(r(`${Fs}Property`).toString());return{type:u,timeout:d,propCount:f,hasTransform:h}}function cC(n,e){for(;n.length<e.length;)n=n.concat(n);return Math.max(...e.map((t,r)=>uC(t)+uC(n[r])))}function uC(n){return n==="auto"?0:Number(n.slice(0,-1).replace(",","."))*1e3}function dC(n){return(n?n.ownerDocument:document).body.offsetHeight}function P7(n,e,t){const r=n[ef];r&&(e=(e?[e,...r]:[...r]).join(" ")),e==null?n.removeAttribute("class"):t?n.setAttribute("class",e):n.className=e}const $p=Symbol("_vod"),fC=Symbol("_vsh"),hC={name:"show",beforeMount(n,{value:e},{transition:t}){n[$p]=n.style.display==="none"?"":n.style.display,t&&e?t.beforeEnter(n):tf(n,e)},mounted(n,{value:e},{transition:t}){t&&e&&t.enter(n)},updated(n,{value:e,oldValue:t},{transition:r}){!e!=!t&&(r?e?(r.beforeEnter(n),tf(n,!0),r.enter(n)):r.leave(n,()=>{tf(n,!1)}):tf(n,e))},beforeUnmount(n,{value:e}){tf(n,e)}};function tf(n,e){n.style.display=e?n[$p]:"none",n[fC]=!e}const D7=Symbol(""),B7=/(?:^|;)\s*display\s*:/;function N7(n,e,t){const r=n.style,o=Yn(t);let i=!1;if(t&&!o){if(e)if(Yn(e))for(const a of e.split(";")){const s=a.slice(0,a.indexOf(":")).trim();t[s]==null&&Yp(r,s,"")}else for(const a in e)t[a]==null&&Yp(r,a,"");for(const a in t)a==="display"&&(i=!0),Yp(r,a,t[a])}else if(o){if(e!==t){const a=r[D7];a&&(t+=";"+a),r.cssText=t,i=B7.test(t)}}else e&&n.removeAttribute("style");$p in n&&(n[$p]=i?r.display:"",n[fC]&&(r.display="none"))}const pC=/\s*!important$/;function Yp(n,e,t){if(_t(t))t.forEach(r=>Yp(n,e,r));else if(t==null&&(t=""),e.startsWith("--"))n.setProperty(e,t);else{const r=O7(n,e);pC.test(t)?n.setProperty(Ps(r),t.replace(pC,""),"important"):n[r]=t}}const mC=["Webkit","Moz","ms"],z_={};function O7(n,e){const t=z_[e];if(t)return t;let r=Qo(e);if(r!=="filter"&&r in n)return z_[e]=r;r=mp(r);for(let o=0;o<mC.length;o++){const i=mC[o]+r;if(i in n)return z_[e]=i}return e}const gC="http://www.w3.org/1999/xlink";function _C(n,e,t,r,o,i=PN(e)){r&&e.startsWith("xlink:")?t==null?n.removeAttributeNS(gC,e.slice(6,e.length)):n.setAttributeNS(gC,e,t):t==null||i&&!bx(t)?n.removeAttribute(e):n.setAttribute(e,i?"":Ni(t)?String(t):t)}function vC(n,e,t,r,o){if(e==="innerHTML"||e==="textContent"){t!=null&&(n[e]=e==="innerHTML"?rC(t):t);return}const i=n.tagName;if(e==="value"&&i!=="PROGRESS"&&!i.includes("-")){const s=i==="OPTION"?n.getAttribute("value")||"":n.value,l=t==null?n.type==="checkbox"?"on":"":String(t);(s!==l||!("_value"in n))&&(n.value=l),t==null&&n.removeAttribute(e),n._value=t;return}let a=!1;if(t===""||t==null){const s=typeof n[e];s==="boolean"?t=bx(t):t==null&&s==="string"?(t="",a=!0):s==="number"&&(t=0,a=!0)}try{n[e]=t}catch{}a&&n.removeAttribute(o||e)}function Vs(n,e,t,r){n.addEventListener(e,t,r)}function k7(n,e,t,r){n.removeEventListener(e,t,r)}const AC=Symbol("_vei");function F7(n,e,t,r,o=null){const i=n[AC]||(n[AC]={}),a=i[e];if(r&&a)a.value=r;else{const[s,l]=V7(e);if(r){const c=i[e]=G7(r,o);Vs(n,s,c,l)}else a&&(k7(n,s,a,l),i[e]=void 0)}}const yC=/(?:Once|Passive|Capture)$/;function V7(n){let e;if(yC.test(n)){e={};let r;for(;r=n.match(yC);)n=n.slice(0,n.length-r[0].length),e[r[0].toLowerCase()]=!0}return[n[2]===":"?n.slice(3):Ps(n.slice(2)),e]}let G_=0;const U7=Promise.resolve(),z7=()=>G_||(U7.then(()=>G_=0),G_=Date.now());function G7(n,e){const t=r=>{if(!r._vts)r._vts=Date.now();else if(r._vts<=t.attached)return;ki(H7(r,t.value),e,5,[r])};return t.value=n,t.attached=z7(),t}function H7(n,e){if(_t(e)){const t=n.stopImmediatePropagation;return n.stopImmediatePropagation=()=>{t.call(n),n._stopped=!0},e.map(r=>o=>!o._stopped&&r&&r(o))}else return e}const bC=n=>n.charCodeAt(0)===111&&n.charCodeAt(1)===110&&n.charCodeAt(2)>96&&n.charCodeAt(2)<123,W7=(n,e,t,r,o,i)=>{const a=o==="svg";e==="class"?P7(n,r,a):e==="style"?N7(n,t,r):hp(e)?i_(e)||F7(n,e,t,r,i):(e[0]==="."?(e=e.slice(1),!0):e[0]==="^"?(e=e.slice(1),!1):j7(n,e,r,a))?(vC(n,e,r),!n.tagName.includes("-")&&(e==="value"||e==="checked"||e==="selected")&&_C(n,e,r,a,i,e!=="value")):n._isVueCE&&(/[A-Z]/.test(e)||!Yn(r))?vC(n,Qo(e),r,i,e):(e==="true-value"?n._trueValue=r:e==="false-value"&&(n._falseValue=r),_C(n,e,r,a))};function j7(n,e,t,r){if(r)return!!(e==="innerHTML"||e==="textContent"||e in n&&bC(e)&&Lt(t));if(e==="spellcheck"||e==="draggable"||e==="translate"||e==="autocorrect"||e==="sandbox"&&n.tagName==="IFRAME"||e==="form"||e==="list"&&n.tagName==="INPUT"||e==="type"&&n.tagName==="TEXTAREA")return!1;if(e==="width"||e==="height"){const o=n.tagName;if(o==="IMG"||o==="VIDEO"||o==="CANVAS"||o==="SOURCE")return!1}return bC(e)&&Yn(t)?!1:e in n}const Uc=n=>{const e=n.props["onUpdate:modelValue"]||!1;return _t(e)?t=>gp(e,t):e};function Q7(n){n.target.composing=!0}function xC(n){const e=n.target;e.composing&&(e.composing=!1,e.dispatchEvent(new Event("input")))}const Wa=Symbol("_assign");function EC(n,e,t){return e&&(n=n.trim()),t&&(n=_p(n)),n}const Rr={created(n,{modifiers:{lazy:e,trim:t,number:r}},o){n[Wa]=Uc(o);const i=r||o.props&&o.props.type==="number";Vs(n,e?"change":"input",a=>{a.target.composing||n[Wa](EC(n.value,t,i))}),(t||i)&&Vs(n,"change",()=>{n.value=EC(n.value,t,i)}),e||(Vs(n,"compositionstart",Q7),Vs(n,"compositionend",xC),Vs(n,"change",xC))},mounted(n,{value:e}){n.value=e??""},beforeUpdate(n,{value:e,oldValue:t,modifiers:{lazy:r,trim:o,number:i}},a){if(n[Wa]=Uc(a),n.composing)return;const s=(i||n.type==="number")&&!/^0\d/.test(n.value)?_p(n.value):n.value,l=e??"";s!==l&&(document.activeElement===n&&n.type!=="range"&&(r&&e===t||o&&n.value.trim()===l)||(n.value=l))}},$7={deep:!0,created(n,e,t){n[Wa]=Uc(t),Vs(n,"change",()=>{const r=n._modelValue,o=nf(n),i=n.checked,a=n[Wa];if(_t(r)){const s=c_(r,o),l=s!==-1;if(i&&!l)a(r.concat(o));else if(!i&&l){const c=[...r];c.splice(s,1),a(c)}}else if(Rc(r)){const s=new Set(r);i?s.add(o):s.delete(o),a(s)}else a(wC(n,i))})},mounted:CC,beforeUpdate(n,e,t){n[Wa]=Uc(t),CC(n,e,t)}};function CC(n,{value:e,oldValue:t},r){n._modelValue=e;let o;if(_t(e))o=c_(e,r.props.value)>-1;else if(Rc(e))o=e.has(r.props.value);else{if(e===t)return;o=Ld(e,wC(n,!0))}n.checked!==o&&(n.checked=o)}const Y7={deep:!0,created(n,{value:e,modifiers:{number:t}},r){const o=Rc(e);Vs(n,"change",()=>{const i=Array.prototype.filter.call(n.options,a=>a.selected).map(a=>t?_p(nf(a)):nf(a));n[Wa](n.multiple?o?new Set(i):i:i[0]),n._assigning=!0,Va(()=>{n._assigning=!1})}),n[Wa]=Uc(r)},mounted(n,{value:e}){SC(n,e)},beforeUpdate(n,e,t){n[Wa]=Uc(t)},updated(n,{value:e}){n._assigning||SC(n,e)}};function SC(n,e){const t=n.multiple,r=_t(e);if(!(t&&!r&&!Rc(e))){for(let o=0,i=n.options.length;o<i;o++){const a=n.options[o],s=nf(a);if(t)if(r){const l=typeof s;l==="string"||l==="number"?a.selected=e.some(c=>String(c)===String(s)):a.selected=c_(e,s)>-1}else a.selected=e.has(s);else if(Ld(nf(a),e)){n.selectedIndex!==o&&(n.selectedIndex=o);return}}!t&&n.selectedIndex!==-1&&(n.selectedIndex=-1)}}function nf(n){return"_value"in n?n._value:n.value}function wC(n,e){const t=e?"_trueValue":"_falseValue";return t in n?n[t]:e}const X7=["ctrl","shift","alt","meta"],q7={stop:n=>n.stopPropagation(),prevent:n=>n.preventDefault(),self:n=>n.target!==n.currentTarget,ctrl:n=>!n.ctrlKey,shift:n=>!n.shiftKey,alt:n=>!n.altKey,meta:n=>!n.metaKey,left:n=>"button"in n&&n.button!==0,middle:n=>"button"in n&&n.button!==1,right:n=>"button"in n&&n.button!==2,exact:(n,e)=>X7.some(t=>n[`${t}Key`]&&!e.includes(t))},ja=(n,e)=>{const t=n._withMods||(n._withMods={}),r=e.join(".");return t[r]||(t[r]=((o,...i)=>{for(let a=0;a<e.length;a++){const s=q7[e[a]];if(s&&s(o,e))return}return n(o,...i)}))},K7=br({patchProp:W7},w7);let MC;function Z7(){return MC||(MC=$8(K7))}const J7=((...n)=>{const e=Z7().createApp(...n),{mount:t}=e;return e.mount=r=>{const o=t9(r);if(!o)return;const i=e._component;!Lt(i)&&!i.render&&!i.template&&(i.template=o.innerHTML),o.nodeType===1&&(o.textContent="");const a=t(o,!1,e9(o));return o instanceof Element&&(o.removeAttribute("v-cloak"),o.setAttribute("data-v-app","")),a},e});function e9(n){if(n instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&n instanceof MathMLElement)return"mathml"}function t9(n){return Yn(n)?document.querySelector(n):n}/*!
  * shared v11.1.12
  * (c) 2025 kazuya kawaguchi
  * Released under the MIT License.
  */function n9(n,e){typeof console<"u"&&(console.warn("[intlify] "+n),e&&console.warn(e.stack))}const Xp=typeof window<"u",Us=(n,e=!1)=>e?Symbol.for(n):Symbol(n),r9=(n,e,t)=>o9({l:n,k:e,s:t}),o9=n=>JSON.stringify(n).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029").replace(/\u0027/g,"\\u0027"),fr=n=>typeof n=="number"&&isFinite(n),i9=n=>H_(n)==="[object Date]",zc=n=>H_(n)==="[object RegExp]",qp=n=>Xt(n)&&Object.keys(n).length===0,xr=Object.assign,a9=Object.create,Mn=(n=null)=>a9(n);let TC;const Bl=()=>TC||(TC=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:Mn());function IC(n){return n.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/\//g,"&#x2F;").replace(/=/g,"&#x3D;")}function RC(n){return n.replace(/&(?![a-zA-Z0-9#]{2,6};)/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function s9(n){return n=n.replace(/(\w+)\s*=\s*"([^"]*)"/g,(r,o,i)=>`${o}="${RC(i)}"`),n=n.replace(/(\w+)\s*=\s*'([^']*)'/g,(r,o,i)=>`${o}='${RC(i)}'`),/\s*on\w+\s*=\s*["']?[^"'>]+["']?/gi.test(n)&&(n=n.replace(/(\s+)(on)(\w+\s*=)/gi,"$1&#111;n$3")),[/(\s+(?:href|src|action|formaction)\s*=\s*["']?)\s*javascript:/gi,/(style\s*=\s*["'][^"']*url\s*\(\s*)javascript:/gi].forEach(r=>{n=n.replace(r,"$1javascript&#58;")}),n}const l9=Object.prototype.hasOwnProperty;function Fi(n,e){return l9.call(n,e)}const Zn=Array.isArray,Un=n=>typeof n=="function",nt=n=>typeof n=="string",fn=n=>typeof n=="boolean",mn=n=>n!==null&&typeof n=="object",c9=n=>mn(n)&&Un(n.then)&&Un(n.catch),LC=Object.prototype.toString,H_=n=>LC.call(n),Xt=n=>H_(n)==="[object Object]",u9=n=>n==null?"":Zn(n)||Xt(n)&&n.toString===LC?JSON.stringify(n,null,2):String(n);function W_(n,e=""){return n.reduce((t,r,o)=>o===0?t+r:t+e+r,"")}const Kp=n=>!mn(n)||Zn(n);function Zp(n,e){if(Kp(n)||Kp(e))throw new Error("Invalid value");const t=[{src:n,des:e}];for(;t.length;){const{src:r,des:o}=t.pop();Object.keys(r).forEach(i=>{i!=="__proto__"&&(mn(r[i])&&!mn(o[i])&&(o[i]=Array.isArray(r[i])?[]:Mn()),Kp(o[i])||Kp(r[i])?o[i]=r[i]:t.push({src:r[i],des:o[i]}))})}}/*!
  * message-compiler v11.1.12
  * (c) 2025 kazuya kawaguchi
  * Released under the MIT License.
  */function d9(n,e,t){return{line:n,column:e,offset:t}}function j_(n,e,t){return{start:n,end:e}}const An={EXPECTED_TOKEN:1,INVALID_TOKEN_IN_PLACEHOLDER:2,UNTERMINATED_SINGLE_QUOTE_IN_PLACEHOLDER:3,UNKNOWN_ESCAPE_SEQUENCE:4,INVALID_UNICODE_ESCAPE_SEQUENCE:5,UNBALANCED_CLOSING_BRACE:6,UNTERMINATED_CLOSING_BRACE:7,EMPTY_PLACEHOLDER:8,NOT_ALLOW_NEST_PLACEHOLDER:9,INVALID_LINKED_FORMAT:10,MUST_HAVE_MESSAGES_IN_PLURAL:11,UNEXPECTED_EMPTY_LINKED_MODIFIER:12,UNEXPECTED_EMPTY_LINKED_KEY:13,UNEXPECTED_LEXICAL_ANALYSIS:14},f9=17;function Jp(n,e,t={}){const{domain:r,messages:o,args:i}=t,a=n,s=new SyntaxError(String(a));return s.code=n,e&&(s.location=e),s.domain=r,s}function h9(n){throw n}const fa=" ",p9="\r",to=`
`,m9="\u2028",g9="\u2029";function _9(n){const e=n;let t=0,r=1,o=1,i=0;const a=w=>e[w]===p9&&e[w+1]===to,s=w=>e[w]===to,l=w=>e[w]===g9,c=w=>e[w]===m9,u=w=>a(w)||s(w)||l(w)||c(w),d=()=>t,f=()=>r,h=()=>o,p=()=>i,m=w=>a(w)||l(w)||c(w)?to:e[w],g=()=>m(t),_=()=>m(t+i);function A(){return i=0,u(t)&&(r++,o=0),a(t)&&t++,t++,o++,e[t]}function y(){return a(t+i)&&i++,i++,e[t+i]}function b(){t=0,r=1,o=1,i=0}function E(w=0){i=w}function x(){const w=t+i;for(;w!==t;)A();i=0}return{index:d,line:f,column:h,peekOffset:p,charAt:m,currentChar:g,currentPeek:_,next:A,peek:y,reset:b,resetPeek:E,skipToPeek:x}}const Qa=void 0,v9=".",PC="'",A9="tokenizer";function y9(n,e={}){const t=e.location!==!1,r=_9(n),o=()=>r.index(),i=()=>d9(r.line(),r.column(),r.index()),a=i(),s=o(),l={currentType:13,offset:s,startLoc:a,endLoc:a,lastType:13,lastOffset:s,lastStartLoc:a,lastEndLoc:a,braceNest:0,inLinked:!1,text:""},c=()=>l,{onError:u}=e;function d(B,V,Y,...le){const me=c();if(V.column+=Y,V.offset+=Y,u){const fe=t?j_(me.startLoc,V):null,te=Jp(B,fe,{domain:A9,args:le});u(te)}}function f(B,V,Y){B.endLoc=i(),B.currentType=V;const le={type:V};return t&&(le.loc=j_(B.startLoc,B.endLoc)),Y!=null&&(le.value=Y),le}const h=B=>f(B,13);function p(B,V){return B.currentChar()===V?(B.next(),V):(d(An.EXPECTED_TOKEN,i(),0,V),"")}function m(B){let V="";for(;B.currentPeek()===fa||B.currentPeek()===to;)V+=B.currentPeek(),B.peek();return V}function g(B){const V=m(B);return B.skipToPeek(),V}function _(B){if(B===Qa)return!1;const V=B.charCodeAt(0);return V>=97&&V<=122||V>=65&&V<=90||V===95}function A(B){if(B===Qa)return!1;const V=B.charCodeAt(0);return V>=48&&V<=57}function y(B,V){const{currentType:Y}=V;if(Y!==2)return!1;m(B);const le=_(B.currentPeek());return B.resetPeek(),le}function b(B,V){const{currentType:Y}=V;if(Y!==2)return!1;m(B);const le=B.currentPeek()==="-"?B.peek():B.currentPeek(),me=A(le);return B.resetPeek(),me}function E(B,V){const{currentType:Y}=V;if(Y!==2)return!1;m(B);const le=B.currentPeek()===PC;return B.resetPeek(),le}function x(B,V){const{currentType:Y}=V;if(Y!==7)return!1;m(B);const le=B.currentPeek()===".";return B.resetPeek(),le}function w(B,V){const{currentType:Y}=V;if(Y!==8)return!1;m(B);const le=_(B.currentPeek());return B.resetPeek(),le}function L(B,V){const{currentType:Y}=V;if(!(Y===7||Y===11))return!1;m(B);const le=B.currentPeek()===":";return B.resetPeek(),le}function C(B,V){const{currentType:Y}=V;if(Y!==9)return!1;const le=()=>{const fe=B.currentPeek();return fe==="{"?_(B.peek()):fe==="@"||fe==="|"||fe===":"||fe==="."||fe===fa||!fe?!1:fe===to?(B.peek(),le()):D(B,!1)},me=le();return B.resetPeek(),me}function P(B){m(B);const V=B.currentPeek()==="|";return B.resetPeek(),V}function D(B,V=!0){const Y=(me=!1,fe="")=>{const te=B.currentPeek();return te==="{"||te==="@"||!te?me:te==="|"?!(fe===fa||fe===to):te===fa?(B.peek(),Y(!0,fa)):te===to?(B.peek(),Y(!0,to)):!0},le=Y();return V&&B.resetPeek(),le}function Q(B,V){const Y=B.currentChar();return Y===Qa?Qa:V(Y)?(B.next(),Y):null}function re(B){const V=B.charCodeAt(0);return V>=97&&V<=122||V>=65&&V<=90||V>=48&&V<=57||V===95||V===36}function G(B){return Q(B,re)}function se(B){const V=B.charCodeAt(0);return V>=97&&V<=122||V>=65&&V<=90||V>=48&&V<=57||V===95||V===36||V===45}function ee(B){return Q(B,se)}function ie(B){const V=B.charCodeAt(0);return V>=48&&V<=57}function H(B){return Q(B,ie)}function T(B){const V=B.charCodeAt(0);return V>=48&&V<=57||V>=65&&V<=70||V>=97&&V<=102}function R(B){return Q(B,T)}function O(B){let V="",Y="";for(;V=H(B);)Y+=V;return Y}function W(B){let V="";for(;;){const Y=B.currentChar();if(Y==="{"||Y==="}"||Y==="@"||Y==="|"||!Y)break;if(Y===fa||Y===to)if(D(B))V+=Y,B.next();else{if(P(B))break;V+=Y,B.next()}else V+=Y,B.next()}return V}function ae(B){g(B);let V="",Y="";for(;V=ee(B);)Y+=V;const le=B.currentChar();if(le&&le!=="}"&&le!==Qa&&le!==fa&&le!==to&&le!==""){const me=U(B);return d(An.INVALID_TOKEN_IN_PLACEHOLDER,i(),0,Y+me),Y+me}return B.currentChar()===Qa&&d(An.UNTERMINATED_CLOSING_BRACE,i(),0),Y}function ne(B){g(B);let V="";return B.currentChar()==="-"?(B.next(),V+=`-${O(B)}`):V+=O(B),B.currentChar()===Qa&&d(An.UNTERMINATED_CLOSING_BRACE,i(),0),V}function oe(B){return B!==PC&&B!==to}function F(B){g(B),p(B,"'");let V="",Y="";for(;V=Q(B,oe);)V==="\\"?Y+=k(B):Y+=V;const le=B.currentChar();return le===to||le===Qa?(d(An.UNTERMINATED_SINGLE_QUOTE_IN_PLACEHOLDER,i(),0),le===to&&(B.next(),p(B,"'")),Y):(p(B,"'"),Y)}function k(B){const V=B.currentChar();switch(V){case"\\":case"'":return B.next(),`\\${V}`;case"u":return q(B,V,4);case"U":return q(B,V,6);default:return d(An.UNKNOWN_ESCAPE_SEQUENCE,i(),0,V),""}}function q(B,V,Y){p(B,V);let le="";for(let me=0;me<Y;me++){const fe=R(B);if(!fe){d(An.INVALID_UNICODE_ESCAPE_SEQUENCE,i(),0,`\\${V}${le}${B.currentChar()}`);break}le+=fe}return`\\${V}${le}`}function j(B){return B!=="{"&&B!=="}"&&B!==fa&&B!==to}function U(B){g(B);let V="",Y="";for(;V=Q(B,j);)Y+=V;return Y}function z(B){let V="",Y="";for(;V=G(B);)Y+=V;return Y}function v(B){const V=Y=>{const le=B.currentChar();return le==="{"||le==="@"||le==="|"||le==="("||le===")"||!le||le===fa?Y:(Y+=le,B.next(),V(Y))};return V("")}function M(B){g(B);const V=p(B,"|");return g(B),V}function S(B,V){let Y=null;switch(B.currentChar()){case"{":return V.braceNest>=1&&d(An.NOT_ALLOW_NEST_PLACEHOLDER,i(),0),B.next(),Y=f(V,2,"{"),g(B),V.braceNest++,Y;case"}":return V.braceNest>0&&V.currentType===2&&d(An.EMPTY_PLACEHOLDER,i(),0),B.next(),Y=f(V,3,"}"),V.braceNest--,V.braceNest>0&&g(B),V.inLinked&&V.braceNest===0&&(V.inLinked=!1),Y;case"@":return V.braceNest>0&&d(An.UNTERMINATED_CLOSING_BRACE,i(),0),Y=I(B,V)||h(V),V.braceNest=0,Y;default:{let me=!0,fe=!0,te=!0;if(P(B))return V.braceNest>0&&d(An.UNTERMINATED_CLOSING_BRACE,i(),0),Y=f(V,1,M(B)),V.braceNest=0,V.inLinked=!1,Y;if(V.braceNest>0&&(V.currentType===4||V.currentType===5||V.currentType===6))return d(An.UNTERMINATED_CLOSING_BRACE,i(),0),V.braceNest=0,J(B,V);if(me=y(B,V))return Y=f(V,4,ae(B)),g(B),Y;if(fe=b(B,V))return Y=f(V,5,ne(B)),g(B),Y;if(te=E(B,V))return Y=f(V,6,F(B)),g(B),Y;if(!me&&!fe&&!te)return Y=f(V,12,U(B)),d(An.INVALID_TOKEN_IN_PLACEHOLDER,i(),0,Y.value),g(B),Y;break}}return Y}function I(B,V){const{currentType:Y}=V;let le=null;const me=B.currentChar();switch((Y===7||Y===8||Y===11||Y===9)&&(me===to||me===fa)&&d(An.INVALID_LINKED_FORMAT,i(),0),me){case"@":return B.next(),le=f(V,7,"@"),V.inLinked=!0,le;case".":return g(B),B.next(),f(V,8,".");case":":return g(B),B.next(),f(V,9,":");default:return P(B)?(le=f(V,1,M(B)),V.braceNest=0,V.inLinked=!1,le):x(B,V)||L(B,V)?(g(B),I(B,V)):w(B,V)?(g(B),f(V,11,z(B))):C(B,V)?(g(B),me==="{"?S(B,V)||le:f(V,10,v(B))):(Y===7&&d(An.INVALID_LINKED_FORMAT,i(),0),V.braceNest=0,V.inLinked=!1,J(B,V))}}function J(B,V){let Y={type:13};if(V.braceNest>0)return S(B,V)||h(V);if(V.inLinked)return I(B,V)||h(V);switch(B.currentChar()){case"{":return S(B,V)||h(V);case"}":return d(An.UNBALANCED_CLOSING_BRACE,i(),0),B.next(),f(V,3,"}");case"@":return I(B,V)||h(V);default:{if(P(B))return Y=f(V,1,M(B)),V.braceNest=0,V.inLinked=!1,Y;if(D(B))return f(V,0,W(B));break}}return Y}function $(){const{currentType:B,offset:V,startLoc:Y,endLoc:le}=l;return l.lastType=B,l.lastOffset=V,l.lastStartLoc=Y,l.lastEndLoc=le,l.offset=o(),l.startLoc=i(),r.currentChar()===Qa?f(l,13):J(r,l)}return{nextToken:$,currentOffset:o,currentPosition:i,context:c}}const b9="parser",x9=/(?:\\\\|\\'|\\u([0-9a-fA-F]{4})|\\U([0-9a-fA-F]{6}))/g;function E9(n,e,t){switch(n){case"\\\\":return"\\";case"\\'":return"'";default:{const r=parseInt(e||t,16);return r<=55295||r>=57344?String.fromCodePoint(r):""}}}function C9(n={}){const e=n.location!==!1,{onError:t}=n;function r(_,A,y,b,...E){const x=_.currentPosition();if(x.offset+=b,x.column+=b,t){const w=e?j_(y,x):null,L=Jp(A,w,{domain:b9,args:E});t(L)}}function o(_,A,y){const b={type:_};return e&&(b.start=A,b.end=A,b.loc={start:y,end:y}),b}function i(_,A,y,b){e&&(_.end=A,_.loc&&(_.loc.end=y))}function a(_,A){const y=_.context(),b=o(3,y.offset,y.startLoc);return b.value=A,i(b,_.currentOffset(),_.currentPosition()),b}function s(_,A){const y=_.context(),{lastOffset:b,lastStartLoc:E}=y,x=o(5,b,E);return x.index=parseInt(A,10),_.nextToken(),i(x,_.currentOffset(),_.currentPosition()),x}function l(_,A){const y=_.context(),{lastOffset:b,lastStartLoc:E}=y,x=o(4,b,E);return x.key=A,_.nextToken(),i(x,_.currentOffset(),_.currentPosition()),x}function c(_,A){const y=_.context(),{lastOffset:b,lastStartLoc:E}=y,x=o(9,b,E);return x.value=A.replace(x9,E9),_.nextToken(),i(x,_.currentOffset(),_.currentPosition()),x}function u(_){const A=_.nextToken(),y=_.context(),{lastOffset:b,lastStartLoc:E}=y,x=o(8,b,E);return A.type!==11?(r(_,An.UNEXPECTED_EMPTY_LINKED_MODIFIER,y.lastStartLoc,0),x.value="",i(x,b,E),{nextConsumeToken:A,node:x}):(A.value==null&&r(_,An.UNEXPECTED_LEXICAL_ANALYSIS,y.lastStartLoc,0,ha(A)),x.value=A.value||"",i(x,_.currentOffset(),_.currentPosition()),{node:x})}function d(_,A){const y=_.context(),b=o(7,y.offset,y.startLoc);return b.value=A,i(b,_.currentOffset(),_.currentPosition()),b}function f(_){const A=_.context(),y=o(6,A.offset,A.startLoc);let b=_.nextToken();if(b.type===8){const E=u(_);y.modifier=E.node,b=E.nextConsumeToken||_.nextToken()}switch(b.type!==9&&r(_,An.UNEXPECTED_LEXICAL_ANALYSIS,A.lastStartLoc,0,ha(b)),b=_.nextToken(),b.type===2&&(b=_.nextToken()),b.type){case 10:b.value==null&&r(_,An.UNEXPECTED_LEXICAL_ANALYSIS,A.lastStartLoc,0,ha(b)),y.key=d(_,b.value||"");break;case 4:b.value==null&&r(_,An.UNEXPECTED_LEXICAL_ANALYSIS,A.lastStartLoc,0,ha(b)),y.key=l(_,b.value||"");break;case 5:b.value==null&&r(_,An.UNEXPECTED_LEXICAL_ANALYSIS,A.lastStartLoc,0,ha(b)),y.key=s(_,b.value||"");break;case 6:b.value==null&&r(_,An.UNEXPECTED_LEXICAL_ANALYSIS,A.lastStartLoc,0,ha(b)),y.key=c(_,b.value||"");break;default:{r(_,An.UNEXPECTED_EMPTY_LINKED_KEY,A.lastStartLoc,0);const E=_.context(),x=o(7,E.offset,E.startLoc);return x.value="",i(x,E.offset,E.startLoc),y.key=x,i(y,E.offset,E.startLoc),{nextConsumeToken:b,node:y}}}return i(y,_.currentOffset(),_.currentPosition()),{node:y}}function h(_){const A=_.context(),y=A.currentType===1?_.currentOffset():A.offset,b=A.currentType===1?A.endLoc:A.startLoc,E=o(2,y,b);E.items=[];let x=null;do{const C=x||_.nextToken();switch(x=null,C.type){case 0:C.value==null&&r(_,An.UNEXPECTED_LEXICAL_ANALYSIS,A.lastStartLoc,0,ha(C)),E.items.push(a(_,C.value||""));break;case 5:C.value==null&&r(_,An.UNEXPECTED_LEXICAL_ANALYSIS,A.lastStartLoc,0,ha(C)),E.items.push(s(_,C.value||""));break;case 4:C.value==null&&r(_,An.UNEXPECTED_LEXICAL_ANALYSIS,A.lastStartLoc,0,ha(C)),E.items.push(l(_,C.value||""));break;case 6:C.value==null&&r(_,An.UNEXPECTED_LEXICAL_ANALYSIS,A.lastStartLoc,0,ha(C)),E.items.push(c(_,C.value||""));break;case 7:{const P=f(_);E.items.push(P.node),x=P.nextConsumeToken||null;break}}}while(A.currentType!==13&&A.currentType!==1);const w=A.currentType===1?A.lastOffset:_.currentOffset(),L=A.currentType===1?A.lastEndLoc:_.currentPosition();return i(E,w,L),E}function p(_,A,y,b){const E=_.context();let x=b.items.length===0;const w=o(1,A,y);w.cases=[],w.cases.push(b);do{const L=h(_);x||(x=L.items.length===0),w.cases.push(L)}while(E.currentType!==13);return x&&r(_,An.MUST_HAVE_MESSAGES_IN_PLURAL,y,0),i(w,_.currentOffset(),_.currentPosition()),w}function m(_){const A=_.context(),{offset:y,startLoc:b}=A,E=h(_);return A.currentType===13?E:p(_,y,b,E)}function g(_){const A=y9(_,xr({},n)),y=A.context(),b=o(0,y.offset,y.startLoc);return e&&b.loc&&(b.loc.source=_),b.body=m(A),n.onCacheKey&&(b.cacheKey=n.onCacheKey(_)),y.currentType!==13&&r(A,An.UNEXPECTED_LEXICAL_ANALYSIS,y.lastStartLoc,0,_[y.offset]||""),i(b,A.currentOffset(),A.currentPosition()),b}return{parse:g}}function ha(n){if(n.type===13)return"EOF";const e=(n.value||"").replace(/\r?\n/gu,"\\n");return e.length>10?e.slice(0,9)+"":e}function S9(n,e={}){const t={ast:n,helpers:new Set};return{context:()=>t,helper:i=>(t.helpers.add(i),i)}}function DC(n,e){for(let t=0;t<n.length;t++)Q_(n[t],e)}function Q_(n,e){switch(n.type){case 1:DC(n.cases,e),e.helper("plural");break;case 2:DC(n.items,e);break;case 6:{Q_(n.key,e),e.helper("linked"),e.helper("type");break}case 5:e.helper("interpolate"),e.helper("list");break;case 4:e.helper("interpolate"),e.helper("named");break}}function w9(n,e={}){const t=S9(n);t.helper("normalize"),n.body&&Q_(n.body,t);const r=t.context();n.helpers=Array.from(r.helpers)}function M9(n){const e=n.body;return e.type===2?BC(e):e.cases.forEach(t=>BC(t)),n}function BC(n){if(n.items.length===1){const e=n.items[0];(e.type===3||e.type===9)&&(n.static=e.value,delete e.value)}else{const e=[];for(let t=0;t<n.items.length;t++){const r=n.items[t];if(!(r.type===3||r.type===9)||r.value==null)break;e.push(r.value)}if(e.length===n.items.length){n.static=W_(e);for(let t=0;t<n.items.length;t++){const r=n.items[t];(r.type===3||r.type===9)&&delete r.value}}}}function Gc(n){switch(n.t=n.type,n.type){case 0:{const e=n;Gc(e.body),e.b=e.body,delete e.body;break}case 1:{const e=n,t=e.cases;for(let r=0;r<t.length;r++)Gc(t[r]);e.c=t,delete e.cases;break}case 2:{const e=n,t=e.items;for(let r=0;r<t.length;r++)Gc(t[r]);e.i=t,delete e.items,e.static&&(e.s=e.static,delete e.static);break}case 3:case 9:case 8:case 7:{const e=n;e.value&&(e.v=e.value,delete e.value);break}case 6:{const e=n;Gc(e.key),e.k=e.key,delete e.key,e.modifier&&(Gc(e.modifier),e.m=e.modifier,delete e.modifier);break}case 5:{const e=n;e.i=e.index,delete e.index;break}case 4:{const e=n;e.k=e.key,delete e.key;break}}delete n.type}function T9(n,e){const{filename:t,breakLineCode:r,needIndent:o}=e,i=e.location!==!1,a={filename:t,code:"",column:1,line:1,offset:0,map:void 0,breakLineCode:r,needIndent:o,indentLevel:0};i&&n.loc&&(a.source=n.loc.source);const s=()=>a;function l(m,g){a.code+=m}function c(m,g=!0){const _=g?r:"";l(o?_+"  ".repeat(m):_)}function u(m=!0){const g=++a.indentLevel;m&&c(g)}function d(m=!0){const g=--a.indentLevel;m&&c(g)}function f(){c(a.indentLevel)}return{context:s,push:l,indent:u,deindent:d,newline:f,helper:m=>`_${m}`,needIndent:()=>a.needIndent}}function I9(n,e){const{helper:t}=n;n.push(`${t("linked")}(`),Hc(n,e.key),e.modifier?(n.push(", "),Hc(n,e.modifier),n.push(", _type")):n.push(", undefined, _type"),n.push(")")}function R9(n,e){const{helper:t,needIndent:r}=n;n.push(`${t("normalize")}([`),n.indent(r());const o=e.items.length;for(let i=0;i<o&&(Hc(n,e.items[i]),i!==o-1);i++)n.push(", ");n.deindent(r()),n.push("])")}function L9(n,e){const{helper:t,needIndent:r}=n;if(e.cases.length>1){n.push(`${t("plural")}([`),n.indent(r());const o=e.cases.length;for(let i=0;i<o&&(Hc(n,e.cases[i]),i!==o-1);i++)n.push(", ");n.deindent(r()),n.push("])")}}function P9(n,e){e.body?Hc(n,e.body):n.push("null")}function Hc(n,e){const{helper:t}=n;switch(e.type){case 0:P9(n,e);break;case 1:L9(n,e);break;case 2:R9(n,e);break;case 6:I9(n,e);break;case 8:n.push(JSON.stringify(e.value),e);break;case 7:n.push(JSON.stringify(e.value),e);break;case 5:n.push(`${t("interpolate")}(${t("list")}(${e.index}))`,e);break;case 4:n.push(`${t("interpolate")}(${t("named")}(${JSON.stringify(e.key)}))`,e);break;case 9:n.push(JSON.stringify(e.value),e);break;case 3:n.push(JSON.stringify(e.value),e);break}}const D9=(n,e={})=>{const t=nt(e.mode)?e.mode:"normal",r=nt(e.filename)?e.filename:"message.intl";e.sourceMap;const o=e.breakLineCode!=null?e.breakLineCode:t==="arrow"?";":`
`,i=e.needIndent?e.needIndent:t!=="arrow",a=n.helpers||[],s=T9(n,{filename:r,breakLineCode:o,needIndent:i});s.push(t==="normal"?"function __msg__ (ctx) {":"(ctx) => {"),s.indent(i),a.length>0&&(s.push(`const { ${W_(a.map(u=>`${u}: _${u}`),", ")} } = ctx`),s.newline()),s.push("return "),Hc(s,n),s.deindent(i),s.push("}"),delete n.helpers;const{code:l,map:c}=s.context();return{ast:n,code:l,map:c?c.toJSON():void 0}};function B9(n,e={}){const t=xr({},e),r=!!t.jit,o=!!t.minify,i=t.optimize==null?!0:t.optimize,s=C9(t).parse(n);return r?(i&&M9(s),o&&Gc(s),{ast:s,code:""}):(w9(s,t),D9(s,t))}/*!
  * core-base v11.1.12
  * (c) 2025 kazuya kawaguchi
  * Released under the MIT License.
  */function N9(){typeof __INTLIFY_PROD_DEVTOOLS__!="boolean"&&(Bl().__INTLIFY_PROD_DEVTOOLS__=!1),typeof __INTLIFY_DROP_MESSAGE_COMPILER__!="boolean"&&(Bl().__INTLIFY_DROP_MESSAGE_COMPILER__=!1)}function pa(n){return mn(n)&&$_(n)===0&&(Fi(n,"b")||Fi(n,"body"))}const NC=["b","body"];function O9(n){return zs(n,NC)}const OC=["c","cases"];function k9(n){return zs(n,OC,[])}const kC=["s","static"];function F9(n){return zs(n,kC)}const FC=["i","items"];function V9(n){return zs(n,FC,[])}const VC=["t","type"];function $_(n){return zs(n,VC)}const UC=["v","value"];function em(n,e){const t=zs(n,UC);if(t!=null)return t;throw rf(e)}const zC=["m","modifier"];function U9(n){return zs(n,zC)}const GC=["k","key"];function z9(n){const e=zs(n,GC);if(e)return e;throw rf(6)}function zs(n,e,t){for(let r=0;r<e.length;r++){const o=e[r];if(Fi(n,o)&&n[o]!=null)return n[o]}return t}const HC=[...NC,...OC,...kC,...FC,...GC,...zC,...UC,...VC];function rf(n){return new Error(`unhandled node type: ${n}`)}function Y_(n){return t=>G9(t,n)}function G9(n,e){const t=O9(e);if(t==null)throw rf(0);if($_(t)===1){const i=k9(t);return n.plural(i.reduce((a,s)=>[...a,WC(n,s)],[]))}else return WC(n,t)}function WC(n,e){const t=F9(e);if(t!=null)return n.type==="text"?t:n.normalize([t]);{const r=V9(e).reduce((o,i)=>[...o,X_(n,i)],[]);return n.normalize(r)}}function X_(n,e){const t=$_(e);switch(t){case 3:return em(e,t);case 9:return em(e,t);case 4:{const r=e;if(Fi(r,"k")&&r.k)return n.interpolate(n.named(r.k));if(Fi(r,"key")&&r.key)return n.interpolate(n.named(r.key));throw rf(t)}case 5:{const r=e;if(Fi(r,"i")&&fr(r.i))return n.interpolate(n.list(r.i));if(Fi(r,"index")&&fr(r.index))return n.interpolate(n.list(r.index));throw rf(t)}case 6:{const r=e,o=U9(r),i=z9(r);return n.linked(X_(n,i),o?X_(n,o):void 0,n.type)}case 7:return em(e,t);case 8:return em(e,t);default:throw new Error(`unhandled node on format message part: ${t}`)}}const H9=n=>n;let tm=Mn();function W9(n,e={}){let t=!1;const r=e.onError||h9;return e.onError=o=>{t=!0,r(o)},{...B9(n,e),detectError:t}}function j9(n,e){if(!__INTLIFY_DROP_MESSAGE_COMPILER__&&nt(n)){fn(e.warnHtmlMessage)&&e.warnHtmlMessage;const r=(e.onCacheKey||H9)(n),o=tm[r];if(o)return o;const{ast:i,detectError:a}=W9(n,{...e,location:!1,jit:!0}),s=Y_(i);return a?s:tm[r]=s}else{const t=n.cacheKey;if(t){const r=tm[t];return r||(tm[t]=Y_(n))}else return Y_(n)}}let of=null;function Q9(n){of=n}function $9(n,e,t){of&&of.emit("i18n:init",{timestamp:Date.now(),i18n:n,version:e,meta:t})}const Y9=X9("function:translate");function X9(n){return e=>of&&of.emit(n,e)}const $a={INVALID_ARGUMENT:f9,INVALID_DATE_ARGUMENT:18,INVALID_ISO_DATE_ARGUMENT:19,NOT_SUPPORT_LOCALE_PROMISE_VALUE:21,NOT_SUPPORT_LOCALE_ASYNC_FUNCTION:22,NOT_SUPPORT_LOCALE_TYPE:23},q9=24;function Ya(n){return Jp(n,null,void 0)}function q_(n,e){return e.locale!=null?jC(e.locale):jC(n.locale)}let K_;function jC(n){if(nt(n))return n;if(Un(n)){if(n.resolvedOnce&&K_!=null)return K_;if(n.constructor.name==="Function"){const e=n();if(c9(e))throw Ya($a.NOT_SUPPORT_LOCALE_PROMISE_VALUE);return K_=e}else throw Ya($a.NOT_SUPPORT_LOCALE_ASYNC_FUNCTION)}else throw Ya($a.NOT_SUPPORT_LOCALE_TYPE)}function K9(n,e,t){return[...new Set([t,...Zn(e)?e:mn(e)?Object.keys(e):nt(e)?[e]:[t]])]}function QC(n,e,t){const r=nt(t)?t:af,o=n;o.__localeChainCache||(o.__localeChainCache=new Map);let i=o.__localeChainCache.get(r);if(!i){i=[];let a=[t];for(;Zn(a);)a=$C(i,a,e);const s=Zn(e)||!Xt(e)?e:e.default?e.default:null;a=nt(s)?[s]:s,Zn(a)&&$C(i,a,!1),o.__localeChainCache.set(r,i)}return i}function $C(n,e,t){let r=!0;for(let o=0;o<e.length&&fn(r);o++){const i=e[o];nt(i)&&(r=Z9(n,e[o],t))}return r}function Z9(n,e,t){let r;const o=e.split("-");do{const i=o.join("-");r=J9(n,i,t),o.splice(-1,1)}while(o.length&&r===!0);return r}function J9(n,e,t){let r=!1;if(!n.includes(e)&&(r=!0,e)){r=e[e.length-1]!=="!";const o=e.replace(/!/g,"");n.push(o),(Zn(t)||Xt(t))&&t[o]&&(r=t[o])}return r}const Gs=[];Gs[0]={w:[0],i:[3,0],"[":[4],o:[7]},Gs[1]={w:[1],".":[2],"[":[4],o:[7]},Gs[2]={w:[2],i:[3,0],0:[3,0]},Gs[3]={i:[3,0],0:[3,0],w:[1,1],".":[2,1],"[":[4,1],o:[7,1]},Gs[4]={"'":[5,0],'"':[6,0],"[":[4,2],"]":[1,3],o:8,l:[4,0]},Gs[5]={"'":[4,0],o:8,l:[5,0]},Gs[6]={'"':[4,0],o:8,l:[6,0]};const eO=/^\s?(?:true|false|-?[\d.]+|'[^']*'|"[^"]*")\s?$/;function tO(n){return eO.test(n)}function nO(n){const e=n.charCodeAt(0),t=n.charCodeAt(n.length-1);return e===t&&(e===34||e===39)?n.slice(1,-1):n}function rO(n){if(n==null)return"o";switch(n.charCodeAt(0)){case 91:case 93:case 46:case 34:case 39:return n;case 95:case 36:case 45:return"i";case 9:case 10:case 13:case 160:case 65279:case 8232:case 8233:return"w"}return"i"}function oO(n){const e=n.trim();return n.charAt(0)==="0"&&isNaN(parseInt(n))?!1:tO(e)?nO(e):"*"+e}function iO(n){const e=[];let t=-1,r=0,o=0,i,a,s,l,c,u,d;const f=[];f[0]=()=>{a===void 0?a=s:a+=s},f[1]=()=>{a!==void 0&&(e.push(a),a=void 0)},f[2]=()=>{f[0](),o++},f[3]=()=>{if(o>0)o--,r=4,f[0]();else{if(o=0,a===void 0||(a=oO(a),a===!1))return!1;f[1]()}};function h(){const p=n[t+1];if(r===5&&p==="'"||r===6&&p==='"')return t++,s="\\"+p,f[0](),!0}for(;r!==null;)if(t++,i=n[t],!(i==="\\"&&h())){if(l=rO(i),d=Gs[r],c=d[l]||d.l||8,c===8||(r=c[0],c[1]!==void 0&&(u=f[c[1]],u&&(s=i,u()===!1))))return;if(r===7)return e}}const YC=new Map;function aO(n,e){return mn(n)?n[e]:null}function sO(n,e){if(!mn(n))return null;let t=YC.get(e);if(t||(t=iO(e),t&&YC.set(e,t)),!t)return null;const r=t.length;let o=n,i=0;for(;i<r;){const a=t[i];if(HC.includes(a)&&pa(o))return null;const s=o[a];if(s===void 0||Un(o))return null;o=s,i++}return o}const lO="11.1.12",nm=-1,af="en-US",XC="",qC=n=>`${n.charAt(0).toLocaleUpperCase()}${n.substr(1)}`;function cO(){return{upper:(n,e)=>e==="text"&&nt(n)?n.toUpperCase():e==="vnode"&&mn(n)&&"__v_isVNode"in n?n.children.toUpperCase():n,lower:(n,e)=>e==="text"&&nt(n)?n.toLowerCase():e==="vnode"&&mn(n)&&"__v_isVNode"in n?n.children.toLowerCase():n,capitalize:(n,e)=>e==="text"&&nt(n)?qC(n):e==="vnode"&&mn(n)&&"__v_isVNode"in n?qC(n.children):n}}let KC;function uO(n){KC=n}let ZC;function dO(n){ZC=n}let JC;function fO(n){JC=n}let eS=null;const hO=n=>{eS=n},pO=()=>eS;let tS=null;const nS=n=>{tS=n},mO=()=>tS;let rS=0;function gO(n={}){const e=Un(n.onWarn)?n.onWarn:n9,t=nt(n.version)?n.version:lO,r=nt(n.locale)||Un(n.locale)?n.locale:af,o=Un(r)?af:r,i=Zn(n.fallbackLocale)||Xt(n.fallbackLocale)||nt(n.fallbackLocale)||n.fallbackLocale===!1?n.fallbackLocale:o,a=Xt(n.messages)?n.messages:Z_(o),s=Xt(n.datetimeFormats)?n.datetimeFormats:Z_(o),l=Xt(n.numberFormats)?n.numberFormats:Z_(o),c=xr(Mn(),n.modifiers,cO()),u=n.pluralRules||Mn(),d=Un(n.missing)?n.missing:null,f=fn(n.missingWarn)||zc(n.missingWarn)?n.missingWarn:!0,h=fn(n.fallbackWarn)||zc(n.fallbackWarn)?n.fallbackWarn:!0,p=!!n.fallbackFormat,m=!!n.unresolving,g=Un(n.postTranslation)?n.postTranslation:null,_=Xt(n.processor)?n.processor:null,A=fn(n.warnHtmlMessage)?n.warnHtmlMessage:!0,y=!!n.escapeParameter,b=Un(n.messageCompiler)?n.messageCompiler:KC,E=Un(n.messageResolver)?n.messageResolver:ZC||aO,x=Un(n.localeFallbacker)?n.localeFallbacker:JC||K9,w=mn(n.fallbackContext)?n.fallbackContext:void 0,L=n,C=mn(L.__datetimeFormatters)?L.__datetimeFormatters:new Map,P=mn(L.__numberFormatters)?L.__numberFormatters:new Map,D=mn(L.__meta)?L.__meta:{};rS++;const Q={version:t,cid:rS,locale:r,fallbackLocale:i,messages:a,modifiers:c,pluralRules:u,missing:d,missingWarn:f,fallbackWarn:h,fallbackFormat:p,unresolving:m,postTranslation:g,processor:_,warnHtmlMessage:A,escapeParameter:y,messageCompiler:b,messageResolver:E,localeFallbacker:x,fallbackContext:w,onWarn:e,__meta:D};return Q.datetimeFormats=s,Q.numberFormats=l,Q.__datetimeFormatters=C,Q.__numberFormatters=P,__INTLIFY_PROD_DEVTOOLS__&&$9(Q,t,D),Q}const Z_=n=>({[n]:Mn()});function J_(n,e,t,r,o){const{missing:i,onWarn:a}=n;if(i!==null){const s=i(n,t,e,o);return nt(s)?s:e}else return e}function sf(n,e,t){const r=n;r.__localeChainCache=new Map,n.localeFallbacker(n,t,e)}function _O(n,e){return n===e?!1:n.split("-")[0]===e.split("-")[0]}function vO(n,e){const t=e.indexOf(n);if(t===-1)return!1;for(let r=t+1;r<e.length;r++)if(_O(n,e[r]))return!0;return!1}function oS(n,...e){const{datetimeFormats:t,unresolving:r,fallbackLocale:o,onWarn:i,localeFallbacker:a}=n,{__datetimeFormatters:s}=n,[l,c,u,d]=ev(...e),f=fn(u.missingWarn)?u.missingWarn:n.missingWarn;fn(u.fallbackWarn)?u.fallbackWarn:n.fallbackWarn;const h=!!u.part,p=q_(n,u),m=a(n,o,p);if(!nt(l)||l==="")return new Intl.DateTimeFormat(p,d).format(c);let g={},_,A=null;const y="datetime format";for(let x=0;x<m.length&&(_=m[x],g=t[_]||{},A=g[l],!Xt(A));x++)J_(n,l,_,f,y);if(!Xt(A)||!nt(_))return r?nm:l;let b=`${_}__${l}`;qp(d)||(b=`${b}__${JSON.stringify(d)}`);let E=s.get(b);return E||(E=new Intl.DateTimeFormat(_,xr({},A,d)),s.set(b,E)),h?E.formatToParts(c):E.format(c)}const iS=["localeMatcher","weekday","era","year","month","day","hour","minute","second","timeZoneName","formatMatcher","hour12","timeZone","dateStyle","timeStyle","calendar","dayPeriod","numberingSystem","hourCycle","fractionalSecondDigits"];function ev(...n){const[e,t,r,o]=n,i=Mn();let a=Mn(),s;if(nt(e)){const l=e.match(/(\d{4}-\d{2}-\d{2})(T|\s)?(.*)/);if(!l)throw Ya($a.INVALID_ISO_DATE_ARGUMENT);const c=l[3]?l[3].trim().startsWith("T")?`${l[1].trim()}${l[3].trim()}`:`${l[1].trim()}T${l[3].trim()}`:l[1].trim();s=new Date(c);try{s.toISOString()}catch{throw Ya($a.INVALID_ISO_DATE_ARGUMENT)}}else if(i9(e)){if(isNaN(e.getTime()))throw Ya($a.INVALID_DATE_ARGUMENT);s=e}else if(fr(e))s=e;else throw Ya($a.INVALID_ARGUMENT);return nt(t)?i.key=t:Xt(t)&&Object.keys(t).forEach(l=>{iS.includes(l)?a[l]=t[l]:i[l]=t[l]}),nt(r)?i.locale=r:Xt(r)&&(a=r),Xt(o)&&(a=o),[i.key||"",s,i,a]}function aS(n,e,t){const r=n;for(const o in t){const i=`${e}__${o}`;r.__datetimeFormatters.has(i)&&r.__datetimeFormatters.delete(i)}}function sS(n,...e){const{numberFormats:t,unresolving:r,fallbackLocale:o,onWarn:i,localeFallbacker:a}=n,{__numberFormatters:s}=n,[l,c,u,d]=tv(...e),f=fn(u.missingWarn)?u.missingWarn:n.missingWarn;fn(u.fallbackWarn)?u.fallbackWarn:n.fallbackWarn;const h=!!u.part,p=q_(n,u),m=a(n,o,p);if(!nt(l)||l==="")return new Intl.NumberFormat(p,d).format(c);let g={},_,A=null;const y="number format";for(let x=0;x<m.length&&(_=m[x],g=t[_]||{},A=g[l],!Xt(A));x++)J_(n,l,_,f,y);if(!Xt(A)||!nt(_))return r?nm:l;let b=`${_}__${l}`;qp(d)||(b=`${b}__${JSON.stringify(d)}`);let E=s.get(b);return E||(E=new Intl.NumberFormat(_,xr({},A,d)),s.set(b,E)),h?E.formatToParts(c):E.format(c)}const lS=["localeMatcher","style","currency","currencyDisplay","currencySign","useGrouping","minimumIntegerDigits","minimumFractionDigits","maximumFractionDigits","minimumSignificantDigits","maximumSignificantDigits","compactDisplay","notation","signDisplay","unit","unitDisplay","roundingMode","roundingPriority","roundingIncrement","trailingZeroDisplay"];function tv(...n){const[e,t,r,o]=n,i=Mn();let a=Mn();if(!fr(e))throw Ya($a.INVALID_ARGUMENT);const s=e;return nt(t)?i.key=t:Xt(t)&&Object.keys(t).forEach(l=>{lS.includes(l)?a[l]=t[l]:i[l]=t[l]}),nt(r)?i.locale=r:Xt(r)&&(a=r),Xt(o)&&(a=o),[i.key||"",s,i,a]}function cS(n,e,t){const r=n;for(const o in t){const i=`${e}__${o}`;r.__numberFormatters.has(i)&&r.__numberFormatters.delete(i)}}const AO=n=>n,yO=n=>"",bO="text",xO=n=>n.length===0?"":W_(n),EO=u9;function uS(n,e){return n=Math.abs(n),e===2?n?n>1?1:0:1:n?Math.min(n,2):0}function CO(n){const e=fr(n.pluralIndex)?n.pluralIndex:-1;return n.named&&(fr(n.named.count)||fr(n.named.n))?fr(n.named.count)?n.named.count:fr(n.named.n)?n.named.n:e:e}function SO(n,e){e.count||(e.count=n),e.n||(e.n=n)}function wO(n={}){const e=n.locale,t=CO(n),r=mn(n.pluralRules)&&nt(e)&&Un(n.pluralRules[e])?n.pluralRules[e]:uS,o=mn(n.pluralRules)&&nt(e)&&Un(n.pluralRules[e])?uS:void 0,i=_=>_[r(t,_.length,o)],a=n.list||[],s=_=>a[_],l=n.named||Mn();fr(n.pluralIndex)&&SO(t,l);const c=_=>l[_];function u(_,A){const y=Un(n.messages)?n.messages(_,!!A):mn(n.messages)?n.messages[_]:!1;return y||(n.parent?n.parent.message(_):yO)}const d=_=>n.modifiers?n.modifiers[_]:AO,f=Xt(n.processor)&&Un(n.processor.normalize)?n.processor.normalize:xO,h=Xt(n.processor)&&Un(n.processor.interpolate)?n.processor.interpolate:EO,p=Xt(n.processor)&&nt(n.processor.type)?n.processor.type:bO,g={list:s,named:c,plural:i,linked:(_,...A)=>{const[y,b]=A;let E="text",x="";A.length===1?mn(y)?(x=y.modifier||x,E=y.type||E):nt(y)&&(x=y||x):A.length===2&&(nt(y)&&(x=y||x),nt(b)&&(E=b||E));const w=u(_,!0)(g),L=E==="vnode"&&Zn(w)&&x?w[0]:w;return x?d(x)(L,E):L},message:u,type:p,interpolate:h,normalize:f,values:xr(Mn(),a,l)};return g}const dS=()=>"",vi=n=>Un(n);function fS(n,...e){const{fallbackFormat:t,postTranslation:r,unresolving:o,messageCompiler:i,fallbackLocale:a,messages:s}=n,[l,c]=nv(...e),u=fn(c.missingWarn)?c.missingWarn:n.missingWarn,d=fn(c.fallbackWarn)?c.fallbackWarn:n.fallbackWarn,f=fn(c.escapeParameter)?c.escapeParameter:n.escapeParameter,h=!!c.resolvedMessage,p=nt(c.default)||fn(c.default)?fn(c.default)?i?l:()=>l:c.default:t?i?l:()=>l:null,m=t||p!=null&&(nt(p)||Un(p)),g=q_(n,c);f&&MO(c);let[_,A,y]=h?[l,g,s[g]||Mn()]:hS(n,l,g,a,d,u),b=_,E=l;if(!h&&!(nt(b)||pa(b)||vi(b))&&m&&(b=p,E=b),!h&&(!(nt(b)||pa(b)||vi(b))||!nt(A)))return o?nm:l;let x=!1;const w=()=>{x=!0},L=vi(b)?b:pS(n,l,A,b,E,w);if(x)return b;const C=RO(n,A,y,c),P=wO(C),D=TO(n,L,P);let Q=r?r(D,l):D;if(f&&nt(Q)&&(Q=s9(Q)),__INTLIFY_PROD_DEVTOOLS__){const re={timestamp:Date.now(),key:nt(l)?l:vi(b)?b.key:"",locale:A||(vi(b)?b.locale:""),format:nt(b)?b:vi(b)?b.source:"",message:Q};re.meta=xr({},n.__meta,pO()||{}),Y9(re)}return Q}function MO(n){Zn(n.list)?n.list=n.list.map(e=>nt(e)?IC(e):e):mn(n.named)&&Object.keys(n.named).forEach(e=>{nt(n.named[e])&&(n.named[e]=IC(n.named[e]))})}function hS(n,e,t,r,o,i){const{messages:a,onWarn:s,messageResolver:l,localeFallbacker:c}=n,u=c(n,r,t);let d=Mn(),f,h=null;const p="translate";for(let m=0;m<u.length&&(f=u[m],d=a[f]||Mn(),(h=l(d,e))===null&&(h=d[e]),!(nt(h)||pa(h)||vi(h)));m++)if(!vO(f,u)){const g=J_(n,e,f,i,p);g!==e&&(h=g)}return[h,f,d]}function pS(n,e,t,r,o,i){const{messageCompiler:a,warnHtmlMessage:s}=n;if(vi(r)){const c=r;return c.locale=c.locale||t,c.key=c.key||e,c}if(a==null){const c=(()=>r);return c.locale=t,c.key=e,c}const l=a(r,IO(n,t,o,r,s,i));return l.locale=t,l.key=e,l.source=r,l}function TO(n,e,t){return e(t)}function nv(...n){const[e,t,r]=n,o=Mn();if(!nt(e)&&!fr(e)&&!vi(e)&&!pa(e))throw Ya($a.INVALID_ARGUMENT);const i=fr(e)?String(e):(vi(e),e);return fr(t)?o.plural=t:nt(t)?o.default=t:Xt(t)&&!qp(t)?o.named=t:Zn(t)&&(o.list=t),fr(r)?o.plural=r:nt(r)?o.default=r:Xt(r)&&xr(o,r),[i,o]}function IO(n,e,t,r,o,i){return{locale:e,key:t,warnHtmlMessage:o,onError:a=>{throw i&&i(a),a},onCacheKey:a=>r9(e,t,a)}}function RO(n,e,t,r){const{modifiers:o,pluralRules:i,messageResolver:a,fallbackLocale:s,fallbackWarn:l,missingWarn:c,fallbackContext:u}=n,f={locale:e,modifiers:o,pluralRules:i,messages:(h,p)=>{let m=a(t,h);if(m==null&&(u||p)){const[,,g]=hS(u||n,h,e,s,l,c);m=a(g,h)}if(nt(m)||pa(m)){let g=!1;const A=pS(n,h,e,m,h,()=>{g=!0});return g?dS:A}else return vi(m)?m:dS}};return n.processor&&(f.processor=n.processor),r.list&&(f.list=r.list),r.named&&(f.named=r.named),fr(r.plural)&&(f.pluralIndex=r.plural),f}N9();/*!
  * vue-i18n v11.1.12
  * (c) 2025 kazuya kawaguchi
  * Released under the MIT License.
  */const LO="11.1.12";function PO(){typeof __VUE_I18N_FULL_INSTALL__!="boolean"&&(Bl().__VUE_I18N_FULL_INSTALL__=!0),typeof __VUE_I18N_LEGACY_API__!="boolean"&&(Bl().__VUE_I18N_LEGACY_API__=!0),typeof __INTLIFY_DROP_MESSAGE_COMPILER__!="boolean"&&(Bl().__INTLIFY_DROP_MESSAGE_COMPILER__=!1),typeof __INTLIFY_PROD_DEVTOOLS__!="boolean"&&(Bl().__INTLIFY_PROD_DEVTOOLS__=!1)}const Do={UNEXPECTED_RETURN_TYPE:q9,INVALID_ARGUMENT:25,MUST_BE_CALL_SETUP_TOP:26,NOT_INSTALLED:27,REQUIRED_VALUE:28,INVALID_VALUE:29,NOT_INSTALLED_WITH_PROVIDE:31,UNEXPECTED_ERROR:32};function Xo(n,...e){return Jp(n,null,void 0)}const rv=Us("__translateVNode"),ov=Us("__datetimeParts"),iv=Us("__numberParts"),mS=Us("__setPluralRules"),gS=Us("__injectWithOption"),av=Us("__dispose");function lf(n){if(!mn(n)||pa(n))return n;for(const e in n)if(Fi(n,e))if(!e.includes("."))mn(n[e])&&lf(n[e]);else{const t=e.split("."),r=t.length-1;let o=n,i=!1;for(let a=0;a<r;a++){if(t[a]==="__proto__")throw new Error(`unsafe key: ${t[a]}`);if(t[a]in o||(o[t[a]]=Mn()),!mn(o[t[a]])){i=!0;break}o=o[t[a]]}if(i||(pa(o)?HC.includes(t[r])||delete n[e]:(o[t[r]]=n[e],delete n[e])),!pa(o)){const a=o[t[r]];mn(a)&&lf(a)}}return n}function sv(n,e){const{messages:t,__i18n:r,messageResolver:o,flatJson:i}=e,a=Xt(t)?t:Zn(r)?Mn():{[n]:Mn()};if(Zn(r)&&r.forEach(s=>{if("locale"in s&&"resource"in s){const{locale:l,resource:c}=s;l?(a[l]=a[l]||Mn(),Zp(c,a[l])):Zp(c,a)}else nt(s)&&Zp(JSON.parse(s),a)}),o==null&&i)for(const s in a)Fi(a,s)&&lf(a[s]);return a}function _S(n){return n.type}function vS(n,e,t){let r=mn(e.messages)?e.messages:Mn();"__i18nGlobal"in t&&(r=sv(n.locale.value,{messages:r,__i18n:t.__i18nGlobal}));const o=Object.keys(r);o.length&&o.forEach(i=>{n.mergeLocaleMessage(i,r[i])});{if(mn(e.datetimeFormats)){const i=Object.keys(e.datetimeFormats);i.length&&i.forEach(a=>{n.mergeDateTimeFormat(a,e.datetimeFormats[a])})}if(mn(e.numberFormats)){const i=Object.keys(e.numberFormats);i.length&&i.forEach(a=>{n.mergeNumberFormat(a,e.numberFormats[a])})}}}function AS(n){return Be($d,null,n,0)}const yS="__INTLIFY_META__",bS=()=>[],DO=()=>!1;let xS=0;function ES(n){return((e,t,r,o)=>n(t,r,Po()||void 0,o))}const BO=()=>{const n=Po();let e=null;return n&&(e=_S(n)[yS])?{[yS]:e}:null};function lv(n={}){const{__root:e,__injectWithOption:t}=n,r=e===void 0,o=n.flatJson,i=Xp?vt:Jr;let a=fn(n.inheritLocale)?n.inheritLocale:!0;const s=i(e&&a?e.locale.value:nt(n.locale)?n.locale:af),l=i(e&&a?e.fallbackLocale.value:nt(n.fallbackLocale)||Zn(n.fallbackLocale)||Xt(n.fallbackLocale)||n.fallbackLocale===!1?n.fallbackLocale:s.value),c=i(sv(s.value,n)),u=i(Xt(n.datetimeFormats)?n.datetimeFormats:{[s.value]:{}}),d=i(Xt(n.numberFormats)?n.numberFormats:{[s.value]:{}});let f=e?e.missingWarn:fn(n.missingWarn)||zc(n.missingWarn)?n.missingWarn:!0,h=e?e.fallbackWarn:fn(n.fallbackWarn)||zc(n.fallbackWarn)?n.fallbackWarn:!0,p=e?e.fallbackRoot:fn(n.fallbackRoot)?n.fallbackRoot:!0,m=!!n.fallbackFormat,g=Un(n.missing)?n.missing:null,_=Un(n.missing)?ES(n.missing):null,A=Un(n.postTranslation)?n.postTranslation:null,y=e?e.warnHtmlMessage:fn(n.warnHtmlMessage)?n.warnHtmlMessage:!0,b=!!n.escapeParameter;const E=e?e.modifiers:Xt(n.modifiers)?n.modifiers:{};let x=n.pluralRules||e&&e.pluralRules,w;w=(()=>{r&&nS(null);const te={version:LO,locale:s.value,fallbackLocale:l.value,messages:c.value,modifiers:E,pluralRules:x,missing:_===null?void 0:_,missingWarn:f,fallbackWarn:h,fallbackFormat:m,unresolving:!0,postTranslation:A===null?void 0:A,warnHtmlMessage:y,escapeParameter:b,messageResolver:n.messageResolver,messageCompiler:n.messageCompiler,__meta:{framework:"vue"}};te.datetimeFormats=u.value,te.numberFormats=d.value,te.__datetimeFormatters=Xt(w)?w.__datetimeFormatters:void 0,te.__numberFormatters=Xt(w)?w.__numberFormatters:void 0;const de=gO(te);return r&&nS(de),de})(),sf(w,s.value,l.value);function C(){return[s.value,l.value,c.value,u.value,d.value]}const P=bt({get:()=>s.value,set:te=>{w.locale=te,s.value=te}}),D=bt({get:()=>l.value,set:te=>{w.fallbackLocale=te,l.value=te,sf(w,s.value,te)}}),Q=bt(()=>c.value),re=bt(()=>u.value),G=bt(()=>d.value);function se(){return Un(A)?A:null}function ee(te){A=te,w.postTranslation=te}function ie(){return g}function H(te){te!==null&&(_=ES(te)),g=te,w.missing=_}const T=(te,de,we,Ie,Ne,He)=>{C();let je;try{__INTLIFY_PROD_DEVTOOLS__,r||(w.fallbackContext=e?mO():void 0),je=te(w)}finally{__INTLIFY_PROD_DEVTOOLS__,r||(w.fallbackContext=void 0)}if(we!=="translate exists"&&fr(je)&&je===nm||we==="translate exists"&&!je){const[ct,Vt]=de();return e&&p?Ie(e):Ne(ct)}else{if(He(je))return je;throw Xo(Do.UNEXPECTED_RETURN_TYPE)}};function R(...te){return T(de=>Reflect.apply(fS,null,[de,...te]),()=>nv(...te),"translate",de=>Reflect.apply(de.t,de,[...te]),de=>de,de=>nt(de))}function O(...te){const[de,we,Ie]=te;if(Ie&&!mn(Ie))throw Xo(Do.INVALID_ARGUMENT);return R(de,we,xr({resolvedMessage:!0},Ie||{}))}function W(...te){return T(de=>Reflect.apply(oS,null,[de,...te]),()=>ev(...te),"datetime format",de=>Reflect.apply(de.d,de,[...te]),()=>XC,de=>nt(de)||Zn(de))}function ae(...te){return T(de=>Reflect.apply(sS,null,[de,...te]),()=>tv(...te),"number format",de=>Reflect.apply(de.n,de,[...te]),()=>XC,de=>nt(de)||Zn(de))}function ne(te){return te.map(de=>nt(de)||fr(de)||fn(de)?AS(String(de)):de)}const F={normalize:ne,interpolate:te=>te,type:"vnode"};function k(...te){return T(de=>{let we;const Ie=de;try{Ie.processor=F,we=Reflect.apply(fS,null,[Ie,...te])}finally{Ie.processor=null}return we},()=>nv(...te),"translate",de=>de[rv](...te),de=>[AS(de)],de=>Zn(de))}function q(...te){return T(de=>Reflect.apply(sS,null,[de,...te]),()=>tv(...te),"number format",de=>de[iv](...te),bS,de=>nt(de)||Zn(de))}function j(...te){return T(de=>Reflect.apply(oS,null,[de,...te]),()=>ev(...te),"datetime format",de=>de[ov](...te),bS,de=>nt(de)||Zn(de))}function U(te){x=te,w.pluralRules=x}function z(te,de){return T(()=>{if(!te)return!1;const we=nt(de)?de:s.value,Ie=S(we),Ne=w.messageResolver(Ie,te);return pa(Ne)||vi(Ne)||nt(Ne)},()=>[te],"translate exists",we=>Reflect.apply(we.te,we,[te,de]),DO,we=>fn(we))}function v(te){let de=null;const we=QC(w,l.value,s.value);for(let Ie=0;Ie<we.length;Ie++){const Ne=c.value[we[Ie]]||{},He=w.messageResolver(Ne,te);if(He!=null){de=He;break}}return de}function M(te){const de=v(te);return de??(e?e.tm(te)||{}:{})}function S(te){return c.value[te]||{}}function I(te,de){if(o){const we={[te]:de};for(const Ie in we)Fi(we,Ie)&&lf(we[Ie]);de=we[te]}c.value[te]=de,w.messages=c.value}function J(te,de){c.value[te]=c.value[te]||{};const we={[te]:de};if(o)for(const Ie in we)Fi(we,Ie)&&lf(we[Ie]);de=we[te],Zp(de,c.value[te]),w.messages=c.value}function $(te){return u.value[te]||{}}function B(te,de){u.value[te]=de,w.datetimeFormats=u.value,aS(w,te,de)}function V(te,de){u.value[te]=xr(u.value[te]||{},de),w.datetimeFormats=u.value,aS(w,te,de)}function Y(te){return d.value[te]||{}}function le(te,de){d.value[te]=de,w.numberFormats=d.value,cS(w,te,de)}function me(te,de){d.value[te]=xr(d.value[te]||{},de),w.numberFormats=d.value,cS(w,te,de)}xS++,e&&Xp&&(dr(e.locale,te=>{a&&(s.value=te,w.locale=te,sf(w,s.value,l.value))}),dr(e.fallbackLocale,te=>{a&&(l.value=te,w.fallbackLocale=te,sf(w,s.value,l.value))}));const fe={id:xS,locale:P,fallbackLocale:D,get inheritLocale(){return a},set inheritLocale(te){a=te,te&&e&&(s.value=e.locale.value,l.value=e.fallbackLocale.value,sf(w,s.value,l.value))},get availableLocales(){return Object.keys(c.value).sort()},messages:Q,get modifiers(){return E},get pluralRules(){return x||{}},get isGlobal(){return r},get missingWarn(){return f},set missingWarn(te){f=te,w.missingWarn=f},get fallbackWarn(){return h},set fallbackWarn(te){h=te,w.fallbackWarn=h},get fallbackRoot(){return p},set fallbackRoot(te){p=te},get fallbackFormat(){return m},set fallbackFormat(te){m=te,w.fallbackFormat=m},get warnHtmlMessage(){return y},set warnHtmlMessage(te){y=te,w.warnHtmlMessage=te},get escapeParameter(){return b},set escapeParameter(te){b=te,w.escapeParameter=te},t:R,getLocaleMessage:S,setLocaleMessage:I,mergeLocaleMessage:J,getPostTranslationHandler:se,setPostTranslationHandler:ee,getMissingHandler:ie,setMissingHandler:H,[mS]:U};return fe.datetimeFormats=re,fe.numberFormats=G,fe.rt=O,fe.te=z,fe.tm=M,fe.d=W,fe.n=ae,fe.getDateTimeFormat=$,fe.setDateTimeFormat=B,fe.mergeDateTimeFormat=V,fe.getNumberFormat=Y,fe.setNumberFormat=le,fe.mergeNumberFormat=me,fe[gS]=t,fe[rv]=k,fe[ov]=j,fe[iv]=q,fe}function NO(n){const e=nt(n.locale)?n.locale:af,t=nt(n.fallbackLocale)||Zn(n.fallbackLocale)||Xt(n.fallbackLocale)||n.fallbackLocale===!1?n.fallbackLocale:e,r=Un(n.missing)?n.missing:void 0,o=fn(n.silentTranslationWarn)||zc(n.silentTranslationWarn)?!n.silentTranslationWarn:!0,i=fn(n.silentFallbackWarn)||zc(n.silentFallbackWarn)?!n.silentFallbackWarn:!0,a=fn(n.fallbackRoot)?n.fallbackRoot:!0,s=!!n.formatFallbackMessages,l=Xt(n.modifiers)?n.modifiers:{},c=n.pluralizationRules,u=Un(n.postTranslation)?n.postTranslation:void 0,d=nt(n.warnHtmlInMessage)?n.warnHtmlInMessage!=="off":!0,f=!!n.escapeParameterHtml,h=fn(n.sync)?n.sync:!0;let p=n.messages;if(Xt(n.sharedMessages)){const E=n.sharedMessages;p=Object.keys(E).reduce((w,L)=>{const C=w[L]||(w[L]={});return xr(C,E[L]),w},p||{})}const{__i18n:m,__root:g,__injectWithOption:_}=n,A=n.datetimeFormats,y=n.numberFormats,b=n.flatJson;return{locale:e,fallbackLocale:t,messages:p,flatJson:b,datetimeFormats:A,numberFormats:y,missing:r,missingWarn:o,fallbackWarn:i,fallbackRoot:a,fallbackFormat:s,modifiers:l,pluralRules:c,postTranslation:u,warnHtmlMessage:d,escapeParameter:f,messageResolver:n.messageResolver,inheritLocale:h,__i18n:m,__root:g,__injectWithOption:_}}function cv(n={}){const e=lv(NO(n)),{__extender:t}=n,r={id:e.id,get locale(){return e.locale.value},set locale(o){e.locale.value=o},get fallbackLocale(){return e.fallbackLocale.value},set fallbackLocale(o){e.fallbackLocale.value=o},get messages(){return e.messages.value},get datetimeFormats(){return e.datetimeFormats.value},get numberFormats(){return e.numberFormats.value},get availableLocales(){return e.availableLocales},get missing(){return e.getMissingHandler()},set missing(o){e.setMissingHandler(o)},get silentTranslationWarn(){return fn(e.missingWarn)?!e.missingWarn:e.missingWarn},set silentTranslationWarn(o){e.missingWarn=fn(o)?!o:o},get silentFallbackWarn(){return fn(e.fallbackWarn)?!e.fallbackWarn:e.fallbackWarn},set silentFallbackWarn(o){e.fallbackWarn=fn(o)?!o:o},get modifiers(){return e.modifiers},get formatFallbackMessages(){return e.fallbackFormat},set formatFallbackMessages(o){e.fallbackFormat=o},get postTranslation(){return e.getPostTranslationHandler()},set postTranslation(o){e.setPostTranslationHandler(o)},get sync(){return e.inheritLocale},set sync(o){e.inheritLocale=o},get warnHtmlInMessage(){return e.warnHtmlMessage?"warn":"off"},set warnHtmlInMessage(o){e.warnHtmlMessage=o!=="off"},get escapeParameterHtml(){return e.escapeParameter},set escapeParameterHtml(o){e.escapeParameter=o},get pluralizationRules(){return e.pluralRules||{}},__composer:e,t(...o){return Reflect.apply(e.t,e,[...o])},rt(...o){return Reflect.apply(e.rt,e,[...o])},te(o,i){return e.te(o,i)},tm(o){return e.tm(o)},getLocaleMessage(o){return e.getLocaleMessage(o)},setLocaleMessage(o,i){e.setLocaleMessage(o,i)},mergeLocaleMessage(o,i){e.mergeLocaleMessage(o,i)},d(...o){return Reflect.apply(e.d,e,[...o])},getDateTimeFormat(o){return e.getDateTimeFormat(o)},setDateTimeFormat(o,i){e.setDateTimeFormat(o,i)},mergeDateTimeFormat(o,i){e.mergeDateTimeFormat(o,i)},n(...o){return Reflect.apply(e.n,e,[...o])},getNumberFormat(o){return e.getNumberFormat(o)},setNumberFormat(o,i){e.setNumberFormat(o,i)},mergeNumberFormat(o,i){e.mergeNumberFormat(o,i)}};return r.__extender=t,r}function OO(n,e,t){return{beforeCreate(){const r=Po();if(!r)throw Xo(Do.UNEXPECTED_ERROR);const o=this.$options;if(o.i18n){const i=o.i18n;if(o.__i18n&&(i.__i18n=o.__i18n),i.__root=e,this===this.$root)this.$i18n=CS(n,i);else{i.__injectWithOption=!0,i.__extender=t.__vueI18nExtend,this.$i18n=cv(i);const a=this.$i18n;a.__extender&&(a.__disposer=a.__extender(this.$i18n))}}else if(o.__i18n)if(this===this.$root)this.$i18n=CS(n,o);else{this.$i18n=cv({__i18n:o.__i18n,__injectWithOption:!0,__extender:t.__vueI18nExtend,__root:e});const i=this.$i18n;i.__extender&&(i.__disposer=i.__extender(this.$i18n))}else this.$i18n=n;o.__i18nGlobal&&vS(e,o,o),this.$t=(...i)=>this.$i18n.t(...i),this.$rt=(...i)=>this.$i18n.rt(...i),this.$te=(i,a)=>this.$i18n.te(i,a),this.$d=(...i)=>this.$i18n.d(...i),this.$n=(...i)=>this.$i18n.n(...i),this.$tm=i=>this.$i18n.tm(i),t.__setInstance(r,this.$i18n)},mounted(){},unmounted(){const r=Po();if(!r)throw Xo(Do.UNEXPECTED_ERROR);const o=this.$i18n;delete this.$t,delete this.$rt,delete this.$te,delete this.$d,delete this.$n,delete this.$tm,o.__disposer&&(o.__disposer(),delete o.__disposer,delete o.__extender),t.__deleteInstance(r),delete this.$i18n}}}function CS(n,e){n.locale=e.locale||n.locale,n.fallbackLocale=e.fallbackLocale||n.fallbackLocale,n.missing=e.missing||n.missing,n.silentTranslationWarn=e.silentTranslationWarn||n.silentFallbackWarn,n.silentFallbackWarn=e.silentFallbackWarn||n.silentFallbackWarn,n.formatFallbackMessages=e.formatFallbackMessages||n.formatFallbackMessages,n.postTranslation=e.postTranslation||n.postTranslation,n.warnHtmlInMessage=e.warnHtmlInMessage||n.warnHtmlInMessage,n.escapeParameterHtml=e.escapeParameterHtml||n.escapeParameterHtml,n.sync=e.sync||n.sync,n.__composer[mS](e.pluralizationRules||n.pluralizationRules);const t=sv(n.locale,{messages:e.messages,__i18n:e.__i18n});return Object.keys(t).forEach(r=>n.mergeLocaleMessage(r,t[r])),e.datetimeFormats&&Object.keys(e.datetimeFormats).forEach(r=>n.mergeDateTimeFormat(r,e.datetimeFormats[r])),e.numberFormats&&Object.keys(e.numberFormats).forEach(r=>n.mergeNumberFormat(r,e.numberFormats[r])),n}const uv={tag:{type:[String,Object]},locale:{type:String},scope:{type:String,validator:n=>n==="parent"||n==="global",default:"parent"},i18n:{type:Object}};function kO({slots:n},e){return e.length===1&&e[0]==="default"?(n.default?n.default():[]).reduce((r,o)=>[...r,...o.type===Nt?o.children:[o]],[]):e.reduce((t,r)=>{const o=n[r];return o&&(t[r]=o()),t},Mn())}function SS(){return Nt}const wS=Ml({name:"i18n-t",props:xr({keypath:{type:String,required:!0},plural:{type:[Number,String],validator:n=>fr(n)||!isNaN(n)}},uv),setup(n,e){const{slots:t,attrs:r}=e,o=n.i18n||cf({useScope:n.scope,__useComponent:!0});return()=>{const i=Object.keys(t).filter(d=>d[0]!=="_"),a=Mn();n.locale&&(a.locale=n.locale),n.plural!==void 0&&(a.plural=nt(n.plural)?+n.plural:n.plural);const s=kO(e,i),l=o[rv](n.keypath,s,a),c=xr(Mn(),r),u=nt(n.tag)||mn(n.tag)?n.tag:SS();return Zd(u,c,l)}}});function FO(n){return Zn(n)&&!nt(n[0])}function MS(n,e,t,r){const{slots:o,attrs:i}=e;return()=>{const a={part:!0};let s=Mn();n.locale&&(a.locale=n.locale),nt(n.format)?a.key=n.format:mn(n.format)&&(nt(n.format.key)&&(a.key=n.format.key),s=Object.keys(n.format).reduce((f,h)=>t.includes(h)?xr(Mn(),f,{[h]:n.format[h]}):f,Mn()));const l=r(n.value,a,s);let c=[a.key];Zn(l)?c=l.map((f,h)=>{const p=o[f.type],m=p?p({[f.type]:f.value,index:h,parts:l}):[f.value];return FO(m)&&(m[0].key=`${f.type}-${h}`),m}):nt(l)&&(c=[l]);const u=xr(Mn(),i),d=nt(n.tag)||mn(n.tag)?n.tag:SS();return Zd(d,u,c)}}const TS=Ml({name:"i18n-n",props:xr({value:{type:Number,required:!0},format:{type:[String,Object]}},uv),setup(n,e){const t=n.i18n||cf({useScope:n.scope,__useComponent:!0});return MS(n,e,lS,(...r)=>t[iv](...r))}});function VO(n,e){const t=n;if(n.mode==="composition")return t.__getInstance(e)||n.global;{const r=t.__getInstance(e);return r!=null?r.__composer:n.global.__composer}}function UO(n){const e=a=>{const{instance:s,value:l}=a;if(!s||!s.$)throw Xo(Do.UNEXPECTED_ERROR);const c=VO(n,s.$),u=IS(l);return[Reflect.apply(c.t,c,[...RS(u)]),c]};return{created:(a,s)=>{const[l,c]=e(s);Xp&&n.global===c&&(a.__i18nWatcher=dr(c.locale,()=>{s.instance&&s.instance.$forceUpdate()})),a.__composer=c,a.textContent=l},unmounted:a=>{Xp&&a.__i18nWatcher&&(a.__i18nWatcher(),a.__i18nWatcher=void 0,delete a.__i18nWatcher),a.__composer&&(a.__composer=void 0,delete a.__composer)},beforeUpdate:(a,{value:s})=>{if(a.__composer){const l=a.__composer,c=IS(s);a.textContent=Reflect.apply(l.t,l,[...RS(c)])}},getSSRProps:a=>{const[s]=e(a);return{textContent:s}}}}function IS(n){if(nt(n))return{path:n};if(Xt(n)){if(!("path"in n))throw Xo(Do.REQUIRED_VALUE,"path");return n}else throw Xo(Do.INVALID_VALUE)}function RS(n){const{path:e,locale:t,args:r,choice:o,plural:i}=n,a={},s=r||{};return nt(t)&&(a.locale=t),fr(o)&&(a.plural=o),fr(i)&&(a.plural=i),[e,s,a]}function zO(n,e,...t){const r=Xt(t[0])?t[0]:{};(fn(r.globalInstall)?r.globalInstall:!0)&&([wS.name,"I18nT"].forEach(i=>n.component(i,wS)),[TS.name,"I18nN"].forEach(i=>n.component(i,TS)),[PS.name,"I18nD"].forEach(i=>n.component(i,PS))),n.directive("t",UO(e))}const GO=Us("global-vue-i18n");function HO(n={}){const e=__VUE_I18N_LEGACY_API__&&fn(n.legacy)?n.legacy:__VUE_I18N_LEGACY_API__,t=fn(n.globalInjection)?n.globalInjection:!0,r=new Map,[o,i]=WO(n,e),a=Us("");function s(d){return r.get(d)||null}function l(d,f){r.set(d,f)}function c(d){r.delete(d)}const u={get mode(){return __VUE_I18N_LEGACY_API__&&e?"legacy":"composition"},async install(d,...f){if(d.__VUE_I18N_SYMBOL__=a,d.provide(d.__VUE_I18N_SYMBOL__,u),Xt(f[0])){const m=f[0];u.__composerExtend=m.__composerExtend,u.__vueI18nExtend=m.__vueI18nExtend}let h=null;!e&&t&&(h=ZO(d,u.global)),__VUE_I18N_FULL_INSTALL__&&zO(d,u,...f),__VUE_I18N_LEGACY_API__&&e&&d.mixin(OO(i,i.__composer,u));const p=d.unmount;d.unmount=()=>{h&&h(),u.dispose(),p()}},get global(){return i},dispose(){o.stop()},__instances:r,__getInstance:s,__setInstance:l,__deleteInstance:c};return u}function cf(n={}){const e=Po();if(e==null)throw Xo(Do.MUST_BE_CALL_SETUP_TOP);if(!e.isCE&&e.appContext.app!=null&&!e.appContext.app.__VUE_I18N_SYMBOL__)throw Xo(Do.NOT_INSTALLED);const t=jO(e),r=$O(t),o=_S(e),i=QO(n,o);if(i==="global")return vS(r,n,o),r;if(i==="parent"){let l=YO(t,e,n.__useComponent);return l==null&&(l=r),l}const a=t;let s=a.__getInstance(e);if(s==null){const l=xr({},n);"__i18n"in o&&(l.__i18n=o.__i18n),r&&(l.__root=r),s=lv(l),a.__composerExtend&&(s[av]=a.__composerExtend(s)),qO(a,e,s),a.__setInstance(e,s)}return s}function WO(n,e){const t=BN(),r=__VUE_I18N_LEGACY_API__&&e?t.run(()=>cv(n)):t.run(()=>lv(n));if(r==null)throw Xo(Do.UNEXPECTED_ERROR);return[t,r]}function jO(n){const e=Lo(n.isCE?GO:n.appContext.app.__VUE_I18N_SYMBOL__);if(!e)throw Xo(n.isCE?Do.NOT_INSTALLED_WITH_PROVIDE:Do.UNEXPECTED_ERROR);return e}function QO(n,e){return qp(n)?"__i18n"in e?"local":"global":n.useScope?n.useScope:"local"}function $O(n){return n.mode==="composition"?n.global:n.global.__composer}function YO(n,e,t=!1){let r=null;const o=e.root;let i=XO(e,t);for(;i!=null;){const a=n;if(n.mode==="composition")r=a.__getInstance(i);else if(__VUE_I18N_LEGACY_API__){const s=a.__getInstance(i);s!=null&&(r=s.__composer,t&&r&&!r[gS]&&(r=null))}if(r!=null||o===i)break;i=i.parent}return r}function XO(n,e=!1){return n==null?null:e&&n.vnode.ctx||n.parent}function qO(n,e,t){$o(()=>{},e),Wd(()=>{const r=t;n.__deleteInstance(e);const o=r[av];o&&(o(),delete r[av])},e)}const KO=["locale","fallbackLocale","availableLocales"],LS=["t","rt","d","n","tm","te"];function ZO(n,e){const t=Object.create(null);return KO.forEach(o=>{const i=Object.getOwnPropertyDescriptor(e,o);if(!i)throw Xo(Do.UNEXPECTED_ERROR);const a=Ir(i.value)?{get(){return i.value.value},set(s){i.value.value=s}}:{get(){return i.get&&i.get()}};Object.defineProperty(t,o,a)}),n.config.globalProperties.$i18n=t,LS.forEach(o=>{const i=Object.getOwnPropertyDescriptor(e,o);if(!i||!i.value)throw Xo(Do.UNEXPECTED_ERROR);Object.defineProperty(n.config.globalProperties,`$${o}`,i)}),()=>{delete n.config.globalProperties.$i18n,LS.forEach(o=>{delete n.config.globalProperties[`$${o}`]})}}const PS=Ml({name:"i18n-d",props:xr({value:{type:[Number,Date],required:!0},format:{type:[String,Object]}},uv),setup(n,e){const t=n.i18n||cf({useScope:n.scope,__useComponent:!0});return MS(n,e,iS,(...r)=>t[ov](...r))}});if(PO(),uO(j9),dO(sO),fO(QC),__INTLIFY_PROD_DEVTOOLS__){const n=Bl();n.__INTLIFY__=!0,Q9(n.__INTLIFY_DEVTOOLS_GLOBAL_HOOK__)}const JO={step1:{choose_product:"Kies product",door_type:"Type deur",fixed_panel:"Vaste wand",fixed_panel_explain:"Een vast paneel dat niet beweegt.",pivot_door:"Taatsdeur",pivot_door_explain:"Een draaideur die naar beide kanten opent.",hinged_door:"Scharnierdeur met kozijn",hinged_door_explain:"Een deur die opent met scharnieren in een vast kozijn.",sliding_door:"Schuifdeur",sliding_door_explain:"Een deur die zijwaarts opent langs een rail.",rebated_door:"Opdekdeur",rebated_door_explain:"Een deur die deels over het kozijn valt bij sluiting.",folding_wall:"Vouwwand",folding_wall_explain:"Een wand bestaande uit meerdere panelen die kunnen worden opgevouwen.",dimensions:"Afmeting",width:"Breedte",height:"Hoogte",number_of_panels:"Aantal panelen",number_of_doors:"Aantal deuren",top_light:"Bovenlicht",top_light_above_doorpanel:"Bovenlicht boven deur/paneel",top_light_hide_intermediate_style:"Verberg tussenstijl",top_light_style_continued_in_side_panel:"Stijl doorlopen in zijpaneel",top_light_height:"Hoogte bovenlicht",side_panels_left:"Zijpanelen links",side_panels_right:"Zijpanelen rechts",user_input_custom_door_width:"Breedte per paneel zelf bepalen",panel_width:"Breedte paneel",panel:"Paneel",side_panel_size:"Afmeting zijpaneel"},step2:{choose_layout:"Kies verdeling",type_layout:"Type verdeling",custom_layout:"Zelf indelen",predefined_layout:"Ontwerpsjablonen",custom_layout_tooltip:"Kies een rechte, eenvoudige roedeverdeling en stel deze zelf samen",predefined_layout_tooltip:"Laat je inspireren door opvallende en creatieve roede-ontwerpen, speciaal door ons samengesteld",number_of_horizontal_rods:"Aantal liggers",number_of_vertical_rods:"Aantal staanders",layout_templates:"Sjablonen",continuous_lines_side_panels:"Roedes doorlopend",positioning:"Positionering",positioning_fixed_layout:"Vaste verdeling",positioning_custom_layout:"Eigen verdeling",panel_custom_layout:"Paneel {index} - eigen verdeling",door_custom_layout:"Deur {index} - eigen verdeling",horizontal_rod:"Ligger {index}",vertical_rod:"Staander {index}",number_of_vertical_rods_side_panel:"Aantal staanders zijpaneel",left_side_panel_layout:"Zijpaneel links - verdeling",right_side_panel_layout:"Zijpaneel rechts - verdeling"},step3:{choose_detailing:"Kies detaillering",material_colour:"Kleur materiaal",material_colours:{black:"Zwart",bronze:"Brons",black_grey:"Zwartgrijs",light_grey:"Lichtgrijs",gold:"Goud",ral:"RAL"},material_colours_tooltip:{black:"Zwart RAL 9005",bronze:"Aluw Bronze",black_grey:"Zwartgrijs RAL 7021",light_grey:"Lichtgrijs RAL 7044",gold:"Aluw Gold",ral:"RAL-kleur. Dit kan mogelijk een meerprijs geven."},ral_colour_number:"RAL-kleurnummer",coating_type:{tbd:"N.t.b.",matt:"Mat",gloss:"Glans",fine_texture:"Fijnstructuur"},ral_colour_note:"Opmerking RAL-kleur",oak_veneer_colour:"Kleur eiken fineer",veneer_colours:{natural:"Naturel",chocolate:"Chocolade"},glass_colour:"Kleur glas",glass_colours:{clear:"Helder",bronze_clear:"Brons",grey_clear:"Grijs",bronze_satin:"Mat brons",satin:"Mat",grey_satin:"Mat grijs"},glass_option:"Optie glas",glass_10mm:"10mm glas",glass_10mm_hide_styles:"Verberg tussenstaanders",handle:"Handgreep",aluminium_handle:"Aluminium grepen",aluminium_handles:{corner:"Hoek",tube:"Buis",bracket:"Beugel",full_box:"Koker volledig",box:"Koker",moon:"Maan",bowl:"Kom",none:"Geen",lever:"Klink"},wooden_handle:"Houten grepen",wooden_handles:{corner:"Hoek",corner_1050:"Hoek 1050",corner_1200:"Hoek 1200",oval:"Ovaal",moon:"Maan",bow:"Beugel",box:"Koker",bowl:"Kom",none:"Geen"},bar_type:"Type roede",T_bar:"T-roede",flat_bar:"Platte roede",active_door:"Actieve deur",opening_direction:"Draairichting",sliding_direction:"Schuifrichting",to_be_determined:"N.t.b.",din_left:"DIN links",din_right:"DIN rechts",sliding_direction_hint:"Vanuit welke kamer gezien is de schuifrichting?",opening_direction_hint:"Vanuit welke kamer gezien is de draairichting?",active_door_hint:"De kant van de actievedeur is vanuit welke kamer gezien?",sliding_door_options:"Opties schuifdeur",softclose_single:"Softclose enkelzijdig",softclose_double:"Softclose dubbelzijdig",hide_rail_in_wall:"Verberg schuifrail in wand",hide_rail_in_wall_tooltip_title:"Verberg schuifrail in wand",hide_rail_in_wall_tooltip_description:"Met deze optie schuift je deur volledig weg in de wand of tussen twee kasten. De opening blijft dan helemaal vrij. Heb je zijpanelen? Dan is deze optie niet nodig, de deur schuift dan voor de opening langs en blijft zichtbaar naast het zijpaneel.",bottom_guide:"Ondergeleiding",bottom_guide_tooltip_title:"Ondergeleiding",bottom_guide_tooltip_description:"Met een ondergeleiding blijft de deur altijd netjes in het spoor lopen. Dit is vooral aan te raden bij bredere deuren of wanneer de deur veel gebruikt gaat worden.",high_threshold_option:"Optie hoge onderdorpel",high_threshold:"Hoge onderdorpel",drop_seal_option:"Optie valdorpel",drop_seal:"Valdorpel",remarks:"Opmerkingen",any_remarks:"Eventuele opmerkingen",material_existing_frame:"Materiaalsoort bestaand kozijn",wooden_frame:"Houten kozijn",metal_frame:"Metalen kozijn",locking:"Vergrendeling",lock_none:"Geen",lock_cylinder:"Cilinderslot",lock_occupied_free:"Vrij / bezet"},buttons:{show_dimensions:"Maatvoering weergeven",rotate_camera:"Draai camera",save_configuration:"Ontwerpen opslaan"},popupStepNext:"Verder",edit:"Wijzigen",finish:"Afronden",requestQuote:"Offerte ontvangen",editQuote:"Offerte wijzigen",copyConfigUrl:"Kopieer config URL",saveTemplate:"Template opslaan",templateName:"Template naam",templateNamePlaceholder:"Geef een naam voor dit template",quote:"Offerte",left:"Links",right:"Rechts",userMessages:{minPosition:"De minimale positie is {limit} cm.",maxPosition:"De maximale positie is {limit} cm.",minHeight:"De minimale hoogte is {limit} cm.",maxHeight:"De maximale hoogte is {limit} cm.",minWidth:"De minimale breedte is {limit} cm.",maxWidth:"De maximale breedte is {limit} cm.",maxWidthAutoAdjusted:"De maximale breedte is {limit} cm. De breedte is automatisch aangepast",minHeightTopLight:"De minimale hoogte van een bovenlicht is {limit} cm.",maxHeightTopLight:"De maximale hoogte van een bovenlicht is {limit} cm.",minWidthSidePanel:"De minimale breedte van een zijpaneel is {limit} cm.",maxWidthSidePanel:"De maximale breedte van een zijpaneel is {limit} cm. Kies eventueel meerdere zijpanelen",maxWidthThisSidePanel:"De maximale breedte voor dit paneel is {maxPanelWidth} cm. De totale breedte is max. {maxTotalWidth} cm.",maxSidePanelTotalWidth:"De totale maximale breedte is {limit} cm. De breedte van de zijpanelen is aangepast.",topLightHeight:"De maximale hoogte van een bovenlicht i.c.m. een deurhoogte van {doorHeight} cm is {limit} cm.",topLightWithSidePanelMaxHeight:"De maximale hoogte van een zijpaneel is {maxHeight} cm. De hoogte van de deur is aangepast naar {heightDoor} cm en de hoogte van het bovenlicht naar {heightTopLight} cm.",ralColorRange:"Een RAL-nummer ligt altijd tussen 1000 en 9999"},footer:{questions_contact:"Heb je vragen? Neem contact op!",product_price:"Product prijs",product_price_title:'Wat betekent "Product prijs"?',product_price_explain:"Dit is de prijs die gerekend wordt voor het product exclusief de montagekosten, transportkosten en BTW. Wanneer je een offerte aanvraagt krijg je een complete prijsopgave die bij jouw persoonlijke situatie past.",excl_vat_assembly_transport:"excl. BTW, montage en transport",incl_vat:"incl. 21% BTW",excl_vat:"excl. BTW",total_price:"Totaalprijs",total:"Totaal",measuring:"Inmeten",assembly:"Montage",request_quote:"Vraag offerte aan"},header:{add_design:"Ontwerp toevoegen"},popup:{close:"Sluiten",image_alt:"Popup afbeelding"},editName:{title:"Naam wijzigen",description:"Wijzig de configuratie naam.",design_name:"Naam ontwerp",design_name_placeholder:"Je volledige naam",button:"Naam wijzigen"},deleteConfig:{title:"Configuratie verwijderen",description:"Configuratie verwijderen? Je kunt altijd weer een nieuwe configuratie toevoegen.",button:"Configuratie verwijderen"},saveDesign:{title:"Ontwerp opslaan",intro:"Stuur je gemaakte ontwerp naar je emailadres en raak deze nooit meer kwijt. Je kan deze dan altijd weer openen door de link die je ontvangt",firstName:"Voornaam (Vereist)",firstName_placeholder:"Bijv. Jan",lastName:"Achternaam (Vereist)",lastName_placeholder:"Bijv. Bakker",email:"Emailadres (Vereist)",email_placeholder:"{'jan@domein.nl'}",button:"Ontwerp opslaan"},quoteForm:{intro:"Laat je gegevens achter en ontvang vrijblijvend binnen 1 werkdag een offerte van ons.",introEdit:"Je ontvangt de offerte binnen 24 uur (werkdagen) in jouw mailbox. Houd alsjeblieft ook je ongewenste e-mail in de gaten. De eventuele kosten voor het inmeten en monteren zijn afhankelijk van de plaats van montage, het is dus belangrijk dat je de plaats opgeeft waar de deur gemonteerd moet worden. Velden met een * zijn verplicht.",private:"Particulier",business:"Zakelijk",companyName:"Bedrijfsnaam (vereist)",companyName_placeholder:"bijv. Mijn Studio",reference:"Referentie",reference_placeholder:"Bijv. Project Tilburg",firstName:"Voornaam (vereist)",firstName_placeholder:"Bijv. Jan",lastName_required:"Achternaam (vereist)",lastName_placeholder:"Bijv. Bakker",city:"Woonplaats (vereist)",city_placeholder:"Bijv. Amsterdam",installation_choice:"Montage keuze",email:"Emailadres",email_required:"Emailadres (vereist)",email_placeholder:"{'Bijv. jan@domein.nl'}",phone:"Telefoonnummer",phone_required:"Telefoonnummer (vereist)",phone_placeholder:"Bijv. 06 1234 5678",remarks_optional:"Toelichting (optioneel)",remarks_placeholder:"Graag maak ik een opmerking over...",no_change_mail:"GEEN wijziging mail versturen",options:{measure_collect:"Zelf inmeten en afhalen",measure_deliver:"Zelf inmeten en afleveren",measure_deliver_by_us:"Laten inmeten en afleveren",measure_install_by_us:"Laten inmeten en monteren"},success:{received:"Top, we hebben je aanvraag binnen!",followup:"Binnen 1 werkdag nemen we contact met je op zodat je een complete offerte van ons ontvangt.",contact:"{'Heb je toch nog een vraag? Bel ons gerust op 085-1301965 of stuur een mail naar sales@aluwdoors.com.'}",closure:"Tot snel!"}},validation:{required:"Dit veld is vereist.",email:"Geen geldig e-mailadres.",phone:"Geen geldig telefoonnummer.",too_long:"Invoer is te lang."},loading:"Laden...",auth:{loginTitle:"Admin Login",loginSubtitle:"Log in om data te beheren",email:"E-mailadres",emailPlaceholder:"{'admin@example.com'}",password:"Wachtwoord",passwordPlaceholder:"Voer uw wachtwoord in",rememberMe:"Onthoud mij",loginButton:"Inloggen",logout:"Uitloggen",loggedInAs:"Ingelogd als"},users:{title:"Gebruikers beheren",description:"Beheer gebruikers en hun rechten.",notAuthorized:"Je hebt geen rechten om gebruikers te beheren. Alleen SuperAdmins kunnen dit.",empty:"Geen gebruikers gevonden.",name:"Naam",email:"E-mail",password:"Wachtwoord",role:"Rol",actions:"Acties",admin:"Admin",superadmin:"SuperAdmin",create:"Nieuwe gebruiker",createUser:"Gebruiker aanmaken",editUser:"Gebruiker bewerken",edit:"Bewerken",delete:"Verwijderen",save:"Opslaan",cancel:"Annuleren",leaveBlank:"laat leeg om ongewijzigd te laten",confirmDeleteTitle:"Gebruiker verwijderen",confirmDeleteMessage:"Weet je zeker dat je deze gebruiker wilt verwijderen? Dit kan niet ongedaan worden gemaakt."},templates:{title:"Templates beheren",description:"Overzicht van alle opgeslagen templates.",empty:"Geen templates gevonden.",noDescription:"Geen beschrijving",templateKey:"Template sleutel",createdAt:"Aangemaakt op",updatedAt:"Laatst gewijzigd",url:"URL",create:"Nieuwe template",view:"Bekijken",edit:"Wijzigen",download:"Download",delete:"Verwijderen",confirmDeleteTitle:"Template verwijderen",confirmDeleteMessage:"Weet je zeker dat je deze template wilt verwijderen? Dit kan niet ongedaan worden gemaakt.",cancel:"Annuleren"},quotation_loaded:"Uw offerte {index} is succesvol geladen.",quotation_notification_editable:"LET OP! uw wijzigingen worden niet automatisch opgeslagen. Indien er wijzigingen zijn, dan kunnen deze middels de knop 'offerte wijzigen' worden opgeslagen.",quotation_notification_not_editable:"Deze offerte kan niet gewijzigd worden. Voor vragen kunt u contact met ons opnemen."},ek={step1:{choose_product:"Choose product",door_type:"Door type",fixed_panel:"Fixed panel",fixed_panel_explain:"A fixed panel that remains in place.",pivot_door:"Pivot door",pivot_door_explain:"A door that rotates on a pivot hinge and opens both ways.",hinged_door:"Hinged door",hinged_door_explain:"A door that swings open on hinges within a fixed frame.",sliding_door:"Sliding door",sliding_door_explain:"A door that slides open sideways along a track.",rebated_door:"Rebated door",rebated_door_explain:"A door that partially overlaps the frame when closed.",folding_wall:"Folding wall",folding_wall_explain:"A wall made up of multiple panels that can be folded.",dimensions:"Dimensions",width:"Width",height:"Height",number_of_panels:"Number of panels",number_of_doors:"Number of doors",top_light:"Top light",top_light_above_doorpanel:"Top light above door/panel",top_light_hide_intermediate_style:"Hide intermediate style",top_light_style_continued_in_side_panel:"Style continued in side panel",top_light_height:"Height of top light",side_panels_left:"Side panels left",side_panels_right:"Side panels right",user_input_custom_door_width:"Adjust panel widht",panel_width:"Panel width",panel:"Panel",side_panel_size:"Side panel size"},step2:{choose_layout:"Choose layout",type_layout:"Layout type",custom_layout:"Custom layout",predefined_layout:"Design templates",custom_layout_tooltip:"Choose a straight, simple bar layout and compose it yourself",predefined_layout_tooltip:"Get inspired by striking and creative designs, specially curated by us",number_of_horizontal_rods:"Number of horizontal bars",number_of_vertical_rods:"Number of vertical bars",layout_templates:"Templates",continuous_lines_side_panels:"Continuous bars",positioning:"Positioning",positioning_fixed_layout:"Fixed layout",positioning_custom_layout:"Custom layout",panel_custom_layout:"Panel {index} - custom layout",door_custom_layout:"Door {index} - custom layout",horizontal_rod:"Horizontal bar {index}",vertical_rod:"Vertical bar {index}",number_of_vertical_rods_side_panel:"Number of side panel vertical bars",left_side_panel_layout:"Left side panel - layout",right_side_panel_layout:"Right side panel - layout"},step3:{choose_detailing:"Choose detailing",material_colour:"Material colour",material_colours:{black:"Black",bronze:"Bronze",black_grey:"Black Grey",light_grey:"Light Grey",gold:"Gold",ral:"RAL"},material_colours_tooltip:{black:"Black RAL 9005",bronze:"Aluw Bronze",black_grey:"Black Grey RAL 7021",light_grey:"Light Grey RAL 7044",gold:"Aluw Gold",ral:"RAL-colour. This may incur an additional charge."},ral_colour_number:"RAL colour number",coating_type:{tbd:"TBD",matt:"Matt",gloss:"Gloss",fine_texture:"Fine texture"},ral_colour_note:"RAL colour note",oak_veneer_colour:"Oak veneer colour",veneer_colours:{natural:"Natural",chocolate:"Chocolate"},glass_colour:"Glass colour",glass_colours:{clear:"Clear",bronze_clear:"Bronze clear",grey_clear:"Grey",bronze_satin:"Bronze satin",satin:"Satin",grey_satin:"Grey satin"},glass_option:"Glass option",glass_10mm:"10mm glass",glass_10mm_hide_styles:"Hide intermediate styles",handle:"Handle",aluminium_handle:"Aluminium handles",aluminium_handles:{corner:"Corner",tube:"Tube",bracket:"Bracket",full_box:"Full box profile",box:"Box profile",moon:"Moon",bowl:"Bowl",none:"None",lever:"Lever"},wooden_handle:"Wooden handles",wooden_handles:{corner:"Corner",corner_1050:"Corner 1050",corner_1200:"Corner 1200",oval:"Oval",moon:"Moon",bow:"Bow",box:"Box profile",bowl:"Bowl",none:"None"},bar_type:"Bar type",T_bar:"T-bar",flat_bar:"Flat bar",active_door:"Active door",opening_direction:"Opening direction",sliding_direction:"Sliding direction",to_be_determined:"TBD",din_left:"DIN links",din_right:"DIN rechts",sliding_direction_hint:"From which room is the sliding direction viewed?",opening_direction_hint:"From which room is the opening direction viewed?",active_door_hint:"From which room is the active door viewed?",sliding_door_options:"Sliding door options",softclose_single:"Soft-close single sided",softclose_double:"Soft-close double sided",hide_rail_in_wall:"Conceal sliding track in wall",hide_rail_in_wall_tooltip_title:"Conceal sliding track in wall",hide_rail_in_wall_tooltip_description:"This option allows the door to slide completely into the wall or between two cabinets, keeping the opening fully clear. When side panels are used, this is not necessarythe door will slide alongside the opening and remain visible next to the side panel.",bottom_guide:"Bottom guide",bottom_guide_tooltip_title:"Bottom guide",bottom_guide_tooltip_description:"With a bottom guide, the door always stays neatly in the track. This is especially recommended for wider doors or when the door is used frequently.",high_threshold_option:"High threshold option",high_threshold:"High threshold",drop_seal_option:"Drop seal option",drop_seal:"Drop seal",remarks:"Remarks",any_remarks:"Any remarks",material_existing_frame:"Material of existing frame",wooden_frame:"Wooden frame",metal_frame:"Metal frame",locking:"Locking",lock_none:"None",lock_cylinder:"Cylinder lock",lock_occupied_free:"Engaged / vacant"},buttons:{show_dimensions:"Show dimensions",rotate_camera:"Rotate camera",save_configuration:"Save my design"},popupStepNext:"Next",edit:"Edit",finish:"Finish",requestQuote:"Request Quote",editQuote:"Edit Quote",copyConfigUrl:"Copy config URL",saveTemplate:"Save template",templateName:"Template name",templateNamePlaceholder:"Enter a name for this template",quote:"Quote",left:"Left",right:"Right",userMessages:{minPosition:"The minimum bar position is {limit} cm.",maxPosition:"The maximum bar position is {limit} cm.",minHeight:"The minimum height is {limit} cm.",maxHeight:"The maximum height is {limit} cm.",minWidth:"The minimum width is {limit} cm.",maxWidth:"The maximum width is {limit} cm.",maxWidthAutoAdjusted:"The maximum width is {limit} cm. The width has been automatically adjusted.",minHeightTopLight:"The minimum height of a top light is {limit} cm.",maxHeightTopLight:"The maximum height of a top light is {limit} cm.",minWidthSidePanel:"The minimum width of a side panel is {limit} cm.",maxWidthSidePanel:"The maximum width of a side panel is {limit} cm. You may choose multiple side panels.",maxWidthThisSidePanel:"The maximum width for this panel is {maxPanelWidth} cm. The total width is max. {maxTotalWidth} cm.",maxSidePanelTotalWidth:"The total maximum width is {limit} cm. The width of the side panels has been adjusted.",topLightHeight:"The maximum height of a top light combined with a door height of {doorHeight} cm is {limit} cm",topLightWithSidePanelMaxHeight:"The maximum height of a side panel is {maxHeight} cm. The height of the door has been adjusted to {heightDoor} cm and the height of the top light to {heightTopLight} cm.",ralColorRange:"A RAL number is always between 1000 and 9999"},footer:{questions_contact:"Got questions? Get in touch!",product_price:"Product price",product_price_title:'What does "Product price" mean?',product_price_explain:"This is the price charged for the product excluding installation costs, transport costs, and VAT. When you request a quote, you will receive a complete price quote tailored to your personal situation.",excl_vat_assembly_transport:"excl. VAT, assembly and transport",incl_vat:"incl. 21% VAT",excl_vat:"excl. VAT",total_price:"Total price",total:"Total",measuring:"Measuring",assembly:"Assembly",request_quote:"Request a quote"},header:{add_design:"Add design"},popup:{close:"Close",image_alt:"Popup image"},editName:{title:"Rename",description:"Change the configuration name.",design_name:"Design name",design_name_placeholder:"Your full name",button:"Rename"},deleteConfig:{title:"Delete configuration",description:"Delete configuration? You can always add a new configuration later.",button:"Delete configuration"},saveDesign:{title:"Save design",intro:"Send your design to your email address so you never lose it. You can always open it again using the link you receive.",firstName:"Your first name",firstName_placeholder:"Your first name",lastName:"Your last name",lastName_placeholder:"Your last name",email:"Email address",email_placeholder:"{'info@customer.com'}",button:"Save design"},quoteForm:{intro:"Leave your details and receive a quote from us within 1 business day, free of obligation.",introEdit:"You will receive the quote within 24 hours (business days) in your mailbox. Please also check your spam folder. Any costs for measuring and installation depend on the installation location, so it is important to specify where the door should be installed. Fields marked with * are required.",private:"Private",business:"Business",companyName:"Company name (required)",companyName_placeholder:"e.g. Studio me",reference:"Reference",reference_placeholder:"e.g. Project Tilburg",firstName:"First name (required)",firstName_placeholder:"e.g. John",lastName_required:"Last name (required)",lastName_placeholder:"e.g. Smith",city:"City (required)",city_placeholder:"e.g. Amsterdam",installation_choice:"Installation choice",email:"Email address",email_required:"Email address (required)",email_placeholder:"{'e.g. john@domain.com'}",phone:"Phone number",phone_required:"Phone number (required)",phone_placeholder:"e.g. +31 6 1234 5678",remarks_optional:"Notes (optional)",remarks_placeholder:"I would like to comment...",no_change_mail:"DO NOT send change email",options:{measure_collect:"Measure yourself and collect",measure_deliver:"Measure yourself and deliver",measure_deliver_by_us:"We measure and deliver",measure_install_by_us:"We measure and install"},success:{received:"Great, we've received your request!",followup:"We'll contact you within 1 business day so you receive a complete quote from us.",contact:"{'Do you still have a question? Feel free to call us at 085-1301965 or email sales@aluwdoors.com.'}",closure:"See you soon!"}},validation:{required:"This field is required.",email:"No valid email address.",phone:"No valid phone number.",too_long:"Input is too long."},loading:"Loading...",auth:{loginTitle:"Admin Login",loginSubtitle:"Sign in to manage data",email:"Email address",emailPlaceholder:"{'admin@example.com'}",password:"Password",passwordPlaceholder:"Enter your password",rememberMe:"Remember me",loginButton:"Sign in",logout:"Logout",loggedInAs:"Logged in as"},users:{title:"Manage users",description:"Manage users and their permissions.",notAuthorized:"You are not authorized to manage users. Only SuperAdmins can do this.",empty:"No users found.",name:"Name",email:"Email",password:"Password",role:"Role",actions:"Actions",admin:"Admin",superadmin:"SuperAdmin",create:"New user",createUser:"Create user",editUser:"Edit user",edit:"Edit",delete:"Delete",save:"Save",cancel:"Cancel",leaveBlank:"leave blank to keep unchanged",confirmDeleteTitle:"Delete user",confirmDeleteMessage:"Are you sure you want to delete this user? This action cannot be undone."},templates:{title:"Manage templates",description:"Overview of all saved templates.",empty:"No templates found.",noDescription:"No description",templateKey:"Template key",createdAt:"Created at",updatedAt:"Last modified",url:"URL",create:"New template",view:"View",edit:"Edit",download:"Download",delete:"Delete",confirmDeleteTitle:"Delete template",confirmDeleteMessage:"Are you sure you want to delete this template? This action cannot be undone.",cancel:"Cancel"},quotation_loaded:"Your quotation {index} has been successfully loaded.",quotation_notification_editable:"PLEASE NOTE! Your changes will not be saved automatically. If there are any changes, they can be saved by clicking the 'change quote' button.",quotation_notification_not_editable:"This quotation cannot be changed. If you have any questions, please contact us."},tk={step1:{choose_product:"Produkt auswhlen",door_type:"Nach Typ",fixed_panel:"Feststehendes Paneel",fixed_panel_explain:"Ein festes Paneel, das an Ort und Stelle bleibt",pivot_door:"Pivottr",pivot_door_explain:"Eine Tr, die sich an einem Drehgelenk dreht und in beide Richtungen ffnet",hinged_door:"Flgeltr",hinged_door_explain:"Eine Tr, die an Scharnieren in einem festen Rahmen aufschwingt",sliding_door:"Schiebetr",sliding_door_explain:"Eine Tr, die seitlich entlang einer Schiene aufgeschoben wird",rebated_door:"Gefalzt",rebated_door_explain:"Eine Tr, die im geschlossenen Zustand den Rahmen teilweise berlappt",folding_wall:"Faltwand",folding_wall_explain:"Eine Wand aus mehreren faltbaren Paneelen."},buttons:{show_dimensions:"Abmessungen anzeigen",rotate_camera:"Kamera drehen"},popupStepNext:"Weiter",edit:"ndern",finish:"Abschlieen",requestQuote:"Angebot anfordern",editQuote:"Angebot bearbeiten",quote:"Angebot",userMessages:{ralColorRange:"Eine RAL-Nummer liegt immer zwischen 1000 und 9999"},users:{title:"Benutzer verwalten",description:"Benutzer und ihre Berechtigungen verwalten.",notAuthorized:"Sie sind nicht berechtigt, Benutzer zu verwalten. Nur SuperAdmins knnen dies tun.",empty:"Keine Benutzer gefunden.",name:"Name",email:"E-Mail",password:"Passwort",role:"Rolle",actions:"Aktionen",admin:"Admin",superadmin:"SuperAdmin",create:"Neuer Benutzer",createUser:"Benutzer erstellen",editUser:"Benutzer bearbeiten",edit:"Bearbeiten",delete:"Lschen",save:"Speichern",cancel:"Abbrechen",leaveBlank:"leer lassen, um unverndert zu lassen",confirmDeleteTitle:"Benutzer lschen",confirmDeleteMessage:"Sind Sie sicher, dass Sie diesen Benutzer lschen mchten? Diese Aktion kann nicht rckgngig gemacht werden."},templates:{create:"Neue Vorlage"},footer:{excl_vat_assembly_transport:"exkl. MwSt., Montage und Transport",incl_vat:"inkl. 21% MwSt.",excl_vat:"exkl. MwSt.",total_price:"Gesamtpreis",total:"Gesamt"}};/*!
 * vue-router v4.6.3
 * (c) 2025 Eduardo San Martin Morote
 * @license MIT
 */const Wc=typeof document<"u";function DS(n){return typeof n=="object"||"displayName"in n||"props"in n||"__vccOpts"in n}function nk(n){return n.__esModule||n[Symbol.toStringTag]==="Module"||n.default&&DS(n.default)}const yn=Object.assign;function dv(n,e){const t={};for(const r in e){const o=e[r];t[r]=Vi(o)?o.map(n):n(o)}return t}const uf=()=>{},Vi=Array.isArray;function BS(n,e){const t={};for(const r in n)t[r]=r in e?e[r]:n[r];return t}const NS=/#/g,rk=/&/g,ok=/\//g,ik=/=/g,ak=/\?/g,OS=/\+/g,sk=/%5B/g,lk=/%5D/g,kS=/%5E/g,ck=/%60/g,FS=/%7B/g,uk=/%7C/g,VS=/%7D/g,dk=/%20/g;function fv(n){return n==null?"":encodeURI(""+n).replace(uk,"|").replace(sk,"[").replace(lk,"]")}function fk(n){return fv(n).replace(FS,"{").replace(VS,"}").replace(kS,"^")}function hv(n){return fv(n).replace(OS,"%2B").replace(dk,"+").replace(NS,"%23").replace(rk,"%26").replace(ck,"`").replace(FS,"{").replace(VS,"}").replace(kS,"^")}function hk(n){return hv(n).replace(ik,"%3D")}function pk(n){return fv(n).replace(NS,"%23").replace(ak,"%3F")}function mk(n){return pk(n).replace(ok,"%2F")}function df(n){if(n==null)return null;try{return decodeURIComponent(""+n)}catch{}return""+n}const gk=/\/$/,_k=n=>n.replace(gk,"");function pv(n,e,t="/"){let r,o={},i="",a="";const s=e.indexOf("#");let l=e.indexOf("?");return l=s>=0&&l>s?-1:l,l>=0&&(r=e.slice(0,l),i=e.slice(l,s>0?s:e.length),o=n(i.slice(1))),s>=0&&(r=r||e.slice(0,s),a=e.slice(s,e.length)),r=bk(r??e,t),{fullPath:r+i+a,path:r,query:o,hash:df(a)}}function vk(n,e){const t=e.query?n(e.query):"";return e.path+(t&&"?")+t+(e.hash||"")}function US(n,e){return!e||!n.toLowerCase().startsWith(e.toLowerCase())?n:n.slice(e.length)||"/"}function Ak(n,e,t){const r=e.matched.length-1,o=t.matched.length-1;return r>-1&&r===o&&jc(e.matched[r],t.matched[o])&&zS(e.params,t.params)&&n(e.query)===n(t.query)&&e.hash===t.hash}function jc(n,e){return(n.aliasOf||n)===(e.aliasOf||e)}function zS(n,e){if(Object.keys(n).length!==Object.keys(e).length)return!1;for(const t in n)if(!yk(n[t],e[t]))return!1;return!0}function yk(n,e){return Vi(n)?GS(n,e):Vi(e)?GS(e,n):n===e}function GS(n,e){return Vi(e)?n.length===e.length&&n.every((t,r)=>t===e[r]):n.length===1&&n[0]===e}function bk(n,e){if(n.startsWith("/"))return n;if(!n)return e;const t=e.split("/"),r=n.split("/"),o=r[r.length-1];(o===".."||o===".")&&r.push("");let i=t.length-1,a,s;for(a=0;a<r.length;a++)if(s=r[a],s!==".")if(s==="..")i>1&&i--;else break;return t.slice(0,i).join("/")+"/"+r.slice(a).join("/")}const Hs={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0};let mv=(function(n){return n.pop="pop",n.push="push",n})({}),gv=(function(n){return n.back="back",n.forward="forward",n.unknown="",n})({});function xk(n){if(!n)if(Wc){const e=document.querySelector("base");n=e&&e.getAttribute("href")||"/",n=n.replace(/^\w+:\/\/[^\/]+/,"")}else n="/";return n[0]!=="/"&&n[0]!=="#"&&(n="/"+n),_k(n)}const Ek=/^[^#]+#/;function Ck(n,e){return n.replace(Ek,"#")+e}function Sk(n,e){const t=document.documentElement.getBoundingClientRect(),r=n.getBoundingClientRect();return{behavior:e.behavior,left:r.left-t.left-(e.left||0),top:r.top-t.top-(e.top||0)}}const rm=()=>({left:window.scrollX,top:window.scrollY});function wk(n){let e;if("el"in n){const t=n.el,r=typeof t=="string"&&t.startsWith("#"),o=typeof t=="string"?r?document.getElementById(t.slice(1)):document.querySelector(t):t;if(!o)return;e=Sk(o,n)}else e=n;"scrollBehavior"in document.documentElement.style?window.scrollTo(e):window.scrollTo(e.left!=null?e.left:window.scrollX,e.top!=null?e.top:window.scrollY)}function HS(n,e){return(history.state?history.state.position-e:-1)+n}const _v=new Map;function Mk(n,e){_v.set(n,e)}function Tk(n){const e=_v.get(n);return _v.delete(n),e}function Ik(n){return typeof n=="string"||n&&typeof n=="object"}function WS(n){return typeof n=="string"||typeof n=="symbol"}let Jn=(function(n){return n[n.MATCHER_NOT_FOUND=1]="MATCHER_NOT_FOUND",n[n.NAVIGATION_GUARD_REDIRECT=2]="NAVIGATION_GUARD_REDIRECT",n[n.NAVIGATION_ABORTED=4]="NAVIGATION_ABORTED",n[n.NAVIGATION_CANCELLED=8]="NAVIGATION_CANCELLED",n[n.NAVIGATION_DUPLICATED=16]="NAVIGATION_DUPLICATED",n})({});const jS=Symbol("");Jn.MATCHER_NOT_FOUND+"",Jn.NAVIGATION_GUARD_REDIRECT+"",Jn.NAVIGATION_ABORTED+"",Jn.NAVIGATION_CANCELLED+"",Jn.NAVIGATION_DUPLICATED+"";function Qc(n,e){return yn(new Error,{type:n,[jS]:!0},e)}function Xa(n,e){return n instanceof Error&&jS in n&&(e==null||!!(n.type&e))}const Rk=["params","query","hash"];function Lk(n){if(typeof n=="string")return n;if(n.path!=null)return n.path;const e={};for(const t of Rk)t in n&&(e[t]=n[t]);return JSON.stringify(e,null,2)}function Pk(n){const e={};if(n===""||n==="?")return e;const t=(n[0]==="?"?n.slice(1):n).split("&");for(let r=0;r<t.length;++r){const o=t[r].replace(OS," "),i=o.indexOf("="),a=df(i<0?o:o.slice(0,i)),s=i<0?null:df(o.slice(i+1));if(a in e){let l=e[a];Vi(l)||(l=e[a]=[l]),l.push(s)}else e[a]=s}return e}function QS(n){let e="";for(let t in n){const r=n[t];if(t=hk(t),r==null){r!==void 0&&(e+=(e.length?"&":"")+t);continue}(Vi(r)?r.map(o=>o&&hv(o)):[r&&hv(r)]).forEach(o=>{o!==void 0&&(e+=(e.length?"&":"")+t,o!=null&&(e+="="+o))})}return e}function Dk(n){const e={};for(const t in n){const r=n[t];r!==void 0&&(e[t]=Vi(r)?r.map(o=>o==null?null:""+o):r==null?r:""+r)}return e}const Bk=Symbol(""),$S=Symbol(""),vv=Symbol(""),Av=Symbol(""),yv=Symbol("");function ff(){let n=[];function e(r){return n.push(r),()=>{const o=n.indexOf(r);o>-1&&n.splice(o,1)}}function t(){n=[]}return{add:e,list:()=>n.slice(),reset:t}}function Ws(n,e,t,r,o,i=a=>a()){const a=r&&(r.enterCallbacks[o]=r.enterCallbacks[o]||[]);return()=>new Promise((s,l)=>{const c=f=>{f===!1?l(Qc(Jn.NAVIGATION_ABORTED,{from:t,to:e})):f instanceof Error?l(f):Ik(f)?l(Qc(Jn.NAVIGATION_GUARD_REDIRECT,{from:e,to:f})):(a&&r.enterCallbacks[o]===a&&typeof f=="function"&&a.push(f),s())},u=i(()=>n.call(r&&r.instances[o],e,t,c));let d=Promise.resolve(u);n.length<3&&(d=d.then(c)),d.catch(f=>l(f))})}function bv(n,e,t,r,o=i=>i()){const i=[];for(const a of n)for(const s in a.components){let l=a.components[s];if(!(e!=="beforeRouteEnter"&&!a.instances[s]))if(DS(l)){const c=(l.__vccOpts||l)[e];c&&i.push(Ws(c,t,r,a,s,o))}else{let c=l();i.push(()=>c.then(u=>{if(!u)throw new Error(`Couldn't resolve component "${s}" at "${a.path}"`);const d=nk(u)?u.default:u;a.mods[s]=u,a.components[s]=d;const f=(d.__vccOpts||d)[e];return f&&Ws(f,t,r,a,s,o)()}))}}return i}function Nk(n,e){const t=[],r=[],o=[],i=Math.max(e.matched.length,n.matched.length);for(let a=0;a<i;a++){const s=e.matched[a];s&&(n.matched.find(c=>jc(c,s))?r.push(s):t.push(s));const l=n.matched[a];l&&(e.matched.find(c=>jc(c,l))||o.push(l))}return[t,r,o]}/*!
 * vue-router v4.6.3
 * (c) 2025 Eduardo San Martin Morote
 * @license MIT
 */let Ok=()=>location.protocol+"//"+location.host;function YS(n,e){const{pathname:t,search:r,hash:o}=e,i=n.indexOf("#");if(i>-1){let a=o.includes(n.slice(i))?n.slice(i).length:1,s=o.slice(a);return s[0]!=="/"&&(s="/"+s),US(s,"")}return US(t,n)+r+o}function kk(n,e,t,r){let o=[],i=[],a=null;const s=({state:f})=>{const h=YS(n,location),p=t.value,m=e.value;let g=0;if(f){if(t.value=h,e.value=f,a&&a===p){a=null;return}g=m?f.position-m.position:0}else r(h);o.forEach(_=>{_(t.value,p,{delta:g,type:mv.pop,direction:g?g>0?gv.forward:gv.back:gv.unknown})})};function l(){a=t.value}function c(f){o.push(f);const h=()=>{const p=o.indexOf(f);p>-1&&o.splice(p,1)};return i.push(h),h}function u(){if(document.visibilityState==="hidden"){const{history:f}=window;if(!f.state)return;f.replaceState(yn({},f.state,{scroll:rm()}),"")}}function d(){for(const f of i)f();i=[],window.removeEventListener("popstate",s),window.removeEventListener("pagehide",u),document.removeEventListener("visibilitychange",u)}return window.addEventListener("popstate",s),window.addEventListener("pagehide",u),document.addEventListener("visibilitychange",u),{pauseListeners:l,listen:c,destroy:d}}function XS(n,e,t,r=!1,o=!1){return{back:n,current:e,forward:t,replaced:r,position:window.history.length,scroll:o?rm():null}}function Fk(n){const{history:e,location:t}=window,r={value:YS(n,t)},o={value:e.state};o.value||i(r.value,{back:null,current:r.value,forward:null,position:e.length-1,replaced:!0,scroll:null},!0);function i(l,c,u){const d=n.indexOf("#"),f=d>-1?(t.host&&document.querySelector("base")?n:n.slice(d))+l:Ok()+n+l;try{e[u?"replaceState":"pushState"](c,"",f),o.value=c}catch(h){console.error(h),t[u?"replace":"assign"](f)}}function a(l,c){i(l,yn({},e.state,XS(o.value.back,l,o.value.forward,!0),c,{position:o.value.position}),!0),r.value=l}function s(l,c){const u=yn({},o.value,e.state,{forward:l,scroll:rm()});i(u.current,u,!0),i(l,yn({},XS(r.value,l,null),{position:u.position+1},c),!1),r.value=l}return{location:r,state:o,push:s,replace:a}}function Vk(n){n=xk(n);const e=Fk(n),t=kk(n,e.state,e.location,e.replace);function r(i,a=!0){a||t.pauseListeners(),history.go(i)}const o=yn({location:"",base:n,go:r,createHref:Ck.bind(null,n)},e,t);return Object.defineProperty(o,"location",{enumerable:!0,get:()=>e.location.value}),Object.defineProperty(o,"state",{enumerable:!0,get:()=>e.state.value}),o}let Nl=(function(n){return n[n.Static=0]="Static",n[n.Param=1]="Param",n[n.Group=2]="Group",n})({});var Er=(function(n){return n[n.Static=0]="Static",n[n.Param=1]="Param",n[n.ParamRegExp=2]="ParamRegExp",n[n.ParamRegExpEnd=3]="ParamRegExpEnd",n[n.EscapeNext=4]="EscapeNext",n})(Er||{});const Uk={type:Nl.Static,value:""},zk=/[a-zA-Z0-9_]/;function Gk(n){if(!n)return[[]];if(n==="/")return[[Uk]];if(!n.startsWith("/"))throw new Error(`Invalid path "${n}"`);function e(h){throw new Error(`ERR (${t})/"${c}": ${h}`)}let t=Er.Static,r=t;const o=[];let i;function a(){i&&o.push(i),i=[]}let s=0,l,c="",u="";function d(){c&&(t===Er.Static?i.push({type:Nl.Static,value:c}):t===Er.Param||t===Er.ParamRegExp||t===Er.ParamRegExpEnd?(i.length>1&&(l==="*"||l==="+")&&e(`A repeatable param (${c}) must be alone in its segment. eg: '/:ids+.`),i.push({type:Nl.Param,value:c,regexp:u,repeatable:l==="*"||l==="+",optional:l==="*"||l==="?"})):e("Invalid state to consume buffer"),c="")}function f(){c+=l}for(;s<n.length;){if(l=n[s++],l==="\\"&&t!==Er.ParamRegExp){r=t,t=Er.EscapeNext;continue}switch(t){case Er.Static:l==="/"?(c&&d(),a()):l===":"?(d(),t=Er.Param):f();break;case Er.EscapeNext:f(),t=r;break;case Er.Param:l==="("?t=Er.ParamRegExp:zk.test(l)?f():(d(),t=Er.Static,l!=="*"&&l!=="?"&&l!=="+"&&s--);break;case Er.ParamRegExp:l===")"?u[u.length-1]=="\\"?u=u.slice(0,-1)+l:t=Er.ParamRegExpEnd:u+=l;break;case Er.ParamRegExpEnd:d(),t=Er.Static,l!=="*"&&l!=="?"&&l!=="+"&&s--,u="";break;default:e("Unknown state");break}}return t===Er.ParamRegExp&&e(`Unfinished custom RegExp for param "${c}"`),d(),a(),o}const qS="[^/]+?",Hk={sensitive:!1,strict:!1,start:!0,end:!0};var po=(function(n){return n[n._multiplier=10]="_multiplier",n[n.Root=90]="Root",n[n.Segment=40]="Segment",n[n.SubSegment=30]="SubSegment",n[n.Static=40]="Static",n[n.Dynamic=20]="Dynamic",n[n.BonusCustomRegExp=10]="BonusCustomRegExp",n[n.BonusWildcard=-50]="BonusWildcard",n[n.BonusRepeatable=-20]="BonusRepeatable",n[n.BonusOptional=-8]="BonusOptional",n[n.BonusStrict=.7000000000000001]="BonusStrict",n[n.BonusCaseSensitive=.25]="BonusCaseSensitive",n})(po||{});const Wk=/[.+*?^${}()[\]/\\]/g;function jk(n,e){const t=yn({},Hk,e),r=[];let o=t.start?"^":"";const i=[];for(const c of n){const u=c.length?[]:[po.Root];t.strict&&!c.length&&(o+="/");for(let d=0;d<c.length;d++){const f=c[d];let h=po.Segment+(t.sensitive?po.BonusCaseSensitive:0);if(f.type===Nl.Static)d||(o+="/"),o+=f.value.replace(Wk,"\\$&"),h+=po.Static;else if(f.type===Nl.Param){const{value:p,repeatable:m,optional:g,regexp:_}=f;i.push({name:p,repeatable:m,optional:g});const A=_||qS;if(A!==qS){h+=po.BonusCustomRegExp;try{`${A}`}catch(b){throw new Error(`Invalid custom RegExp for param "${p}" (${A}): `+b.message)}}let y=m?`((?:${A})(?:/(?:${A}))*)`:`(${A})`;d||(y=g&&c.length<2?`(?:/${y})`:"/"+y),g&&(y+="?"),o+=y,h+=po.Dynamic,g&&(h+=po.BonusOptional),m&&(h+=po.BonusRepeatable),A===".*"&&(h+=po.BonusWildcard)}u.push(h)}r.push(u)}if(t.strict&&t.end){const c=r.length-1;r[c][r[c].length-1]+=po.BonusStrict}t.strict||(o+="/?"),t.end?o+="$":t.strict&&!o.endsWith("/")&&(o+="(?:/|$)");const a=new RegExp(o,t.sensitive?"":"i");function s(c){const u=c.match(a),d={};if(!u)return null;for(let f=1;f<u.length;f++){const h=u[f]||"",p=i[f-1];d[p.name]=h&&p.repeatable?h.split("/"):h}return d}function l(c){let u="",d=!1;for(const f of n){(!d||!u.endsWith("/"))&&(u+="/"),d=!1;for(const h of f)if(h.type===Nl.Static)u+=h.value;else if(h.type===Nl.Param){const{value:p,repeatable:m,optional:g}=h,_=p in c?c[p]:"";if(Vi(_)&&!m)throw new Error(`Provided param "${p}" is an array but it is not repeatable (* or + modifiers)`);const A=Vi(_)?_.join("/"):_;if(!A)if(g)f.length<2&&(u.endsWith("/")?u=u.slice(0,-1):d=!0);else throw new Error(`Missing required param "${p}"`);u+=A}}return u||"/"}return{re:a,score:r,keys:i,parse:s,stringify:l}}function Qk(n,e){let t=0;for(;t<n.length&&t<e.length;){const r=e[t]-n[t];if(r)return r;t++}return n.length<e.length?n.length===1&&n[0]===po.Static+po.Segment?-1:1:n.length>e.length?e.length===1&&e[0]===po.Static+po.Segment?1:-1:0}function KS(n,e){let t=0;const r=n.score,o=e.score;for(;t<r.length&&t<o.length;){const i=Qk(r[t],o[t]);if(i)return i;t++}if(Math.abs(o.length-r.length)===1){if(ZS(r))return 1;if(ZS(o))return-1}return o.length-r.length}function ZS(n){const e=n[n.length-1];return n.length>0&&e[e.length-1]<0}const $k={strict:!1,end:!0,sensitive:!1};function Yk(n,e,t){const r=jk(Gk(n.path),t),o=yn(r,{record:n,parent:e,children:[],alias:[]});return e&&!o.record.aliasOf==!e.record.aliasOf&&e.children.push(o),o}function Xk(n,e){const t=[],r=new Map;e=BS($k,e);function o(d){return r.get(d)}function i(d,f,h){const p=!h,m=ew(d);m.aliasOf=h&&h.record;const g=BS(e,d),_=[m];if("alias"in d){const b=typeof d.alias=="string"?[d.alias]:d.alias;for(const E of b)_.push(ew(yn({},m,{components:h?h.record.components:m.components,path:E,aliasOf:h?h.record:m})))}let A,y;for(const b of _){const{path:E}=b;if(f&&E[0]!=="/"){const x=f.record.path,w=x[x.length-1]==="/"?"":"/";b.path=f.record.path+(E&&w+E)}if(A=Yk(b,f,g),h?h.alias.push(A):(y=y||A,y!==A&&y.alias.push(A),p&&d.name&&!tw(A)&&a(d.name)),nw(A)&&l(A),m.children){const x=m.children;for(let w=0;w<x.length;w++)i(x[w],A,h&&h.children[w])}h=h||A}return y?()=>{a(y)}:uf}function a(d){if(WS(d)){const f=r.get(d);f&&(r.delete(d),t.splice(t.indexOf(f),1),f.children.forEach(a),f.alias.forEach(a))}else{const f=t.indexOf(d);f>-1&&(t.splice(f,1),d.record.name&&r.delete(d.record.name),d.children.forEach(a),d.alias.forEach(a))}}function s(){return t}function l(d){const f=Zk(d,t);t.splice(f,0,d),d.record.name&&!tw(d)&&r.set(d.record.name,d)}function c(d,f){let h,p={},m,g;if("name"in d&&d.name){if(h=r.get(d.name),!h)throw Qc(Jn.MATCHER_NOT_FOUND,{location:d});g=h.record.name,p=yn(JS(f.params,h.keys.filter(y=>!y.optional).concat(h.parent?h.parent.keys.filter(y=>y.optional):[]).map(y=>y.name)),d.params&&JS(d.params,h.keys.map(y=>y.name))),m=h.stringify(p)}else if(d.path!=null)m=d.path,h=t.find(y=>y.re.test(m)),h&&(p=h.parse(m),g=h.record.name);else{if(h=f.name?r.get(f.name):t.find(y=>y.re.test(f.path)),!h)throw Qc(Jn.MATCHER_NOT_FOUND,{location:d,currentLocation:f});g=h.record.name,p=yn({},f.params,d.params),m=h.stringify(p)}const _=[];let A=h;for(;A;)_.unshift(A.record),A=A.parent;return{name:g,path:m,params:p,matched:_,meta:Kk(_)}}n.forEach(d=>i(d));function u(){t.length=0,r.clear()}return{addRoute:i,resolve:c,removeRoute:a,clearRoutes:u,getRoutes:s,getRecordMatcher:o}}function JS(n,e){const t={};for(const r of e)r in n&&(t[r]=n[r]);return t}function ew(n){const e={path:n.path,redirect:n.redirect,name:n.name,meta:n.meta||{},aliasOf:n.aliasOf,beforeEnter:n.beforeEnter,props:qk(n),children:n.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in n?n.components||null:n.component&&{default:n.component}};return Object.defineProperty(e,"mods",{value:{}}),e}function qk(n){const e={},t=n.props||!1;if("component"in n)e.default=t;else for(const r in n.components)e[r]=typeof t=="object"?t[r]:t;return e}function tw(n){for(;n;){if(n.record.aliasOf)return!0;n=n.parent}return!1}function Kk(n){return n.reduce((e,t)=>yn(e,t.meta),{})}function Zk(n,e){let t=0,r=e.length;for(;t!==r;){const i=t+r>>1;KS(n,e[i])<0?r=i:t=i+1}const o=Jk(n);return o&&(r=e.lastIndexOf(o,r-1)),r}function Jk(n){let e=n;for(;e=e.parent;)if(nw(e)&&KS(n,e)===0)return e}function nw({record:n}){return!!(n.name||n.components&&Object.keys(n.components).length||n.redirect)}function rw(n){const e=Lo(vv),t=Lo(Av),r=bt(()=>{const l=Ct(n.to);return e.resolve(l)}),o=bt(()=>{const{matched:l}=r.value,{length:c}=l,u=l[c-1],d=t.matched;if(!u||!d.length)return-1;const f=d.findIndex(jc.bind(null,u));if(f>-1)return f;const h=ow(l[c-2]);return c>1&&ow(u)===h&&d[d.length-1].path!==h?d.findIndex(jc.bind(null,l[c-2])):f}),i=bt(()=>o.value>-1&&rF(t.params,r.value.params)),a=bt(()=>o.value>-1&&o.value===t.matched.length-1&&zS(t.params,r.value.params));function s(l={}){if(nF(l)){const c=e[Ct(n.replace)?"replace":"push"](Ct(n.to)).catch(uf);return n.viewTransition&&typeof document<"u"&&"startViewTransition"in document&&document.startViewTransition(()=>c),c}return Promise.resolve()}return{route:r,href:bt(()=>r.value.href),isActive:i,isExactActive:a,navigate:s}}function eF(n){return n.length===1?n[0]:n}const tF=Ml({name:"RouterLink",compatConfig:{MODE:3},props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"},viewTransition:Boolean},useLink:rw,setup(n,{slots:e}){const t=Zr(rw(n)),{options:r}=Lo(vv),o=bt(()=>({[iw(n.activeClass,r.linkActiveClass,"router-link-active")]:t.isActive,[iw(n.exactActiveClass,r.linkExactActiveClass,"router-link-exact-active")]:t.isExactActive}));return()=>{const i=e.default&&eF(e.default(t));return n.custom?i:Zd("a",{"aria-current":t.isExactActive?n.ariaCurrentValue:null,href:t.href,onClick:t.navigate,class:o.value},i)}}});function nF(n){if(!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)&&!n.defaultPrevented&&!(n.button!==void 0&&n.button!==0)){if(n.currentTarget&&n.currentTarget.getAttribute){const e=n.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(e))return}return n.preventDefault&&n.preventDefault(),!0}}function rF(n,e){for(const t in e){const r=e[t],o=n[t];if(typeof r=="string"){if(r!==o)return!1}else if(!Vi(o)||o.length!==r.length||r.some((i,a)=>i!==o[a]))return!1}return!0}function ow(n){return n?n.aliasOf?n.aliasOf.path:n.path:""}const iw=(n,e,t)=>n??e??t,oF=Ml({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},compatConfig:{MODE:3},setup(n,{attrs:e,slots:t}){const r=Lo(yv),o=bt(()=>n.route||r.value),i=Lo($S,0),a=bt(()=>{let c=Ct(i);const{matched:u}=o.value;let d;for(;(d=u[c])&&!d.components;)c++;return c}),s=bt(()=>o.value.matched[a.value]);Vp($S,bt(()=>a.value+1)),Vp(Bk,s),Vp(yv,o);const l=vt();return dr(()=>[l.value,s.value,n.name],([c,u,d],[f,h,p])=>{u&&(u.instances[d]=c,h&&h!==u&&c&&c===f&&(u.leaveGuards.size||(u.leaveGuards=h.leaveGuards),u.updateGuards.size||(u.updateGuards=h.updateGuards))),c&&u&&(!h||!jc(u,h)||!f)&&(u.enterCallbacks[d]||[]).forEach(m=>m(c))},{flush:"post"}),()=>{const c=o.value,u=n.name,d=s.value,f=d&&d.components[u];if(!f)return aw(t.default,{Component:f,route:c});const h=d.props[u],p=h?h===!0?c.params:typeof h=="function"?h(c):h:null,g=Zd(f,yn({},p,e,{onVnodeUnmounted:_=>{_.component.isUnmounted&&(d.instances[u]=null)},ref:l}));return aw(t.default,{Component:g,route:c})||g}}});function aw(n,e){if(!n)return null;const t=n(e);return t.length===1?t[0]:t}const sw=oF;function iF(n){const e=Xk(n.routes,n),t=n.parseQuery||Pk,r=n.stringifyQuery||QS,o=n.history,i=ff(),a=ff(),s=ff(),l=Jr(Hs);let c=Hs;Wc&&n.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const u=dv.bind(null,k=>""+k),d=dv.bind(null,mk),f=dv.bind(null,df);function h(k,q){let j,U;return WS(k)?(j=e.getRecordMatcher(k),U=q):U=k,e.addRoute(U,j)}function p(k){const q=e.getRecordMatcher(k);q&&e.removeRoute(q)}function m(){return e.getRoutes().map(k=>k.record)}function g(k){return!!e.getRecordMatcher(k)}function _(k,q){if(q=yn({},q||l.value),typeof k=="string"){const S=pv(t,k,q.path),I=e.resolve({path:S.path},q),J=o.createHref(S.fullPath);return yn(S,I,{params:f(I.params),hash:df(S.hash),redirectedFrom:void 0,href:J})}let j;if(k.path!=null)j=yn({},k,{path:pv(t,k.path,q.path).path});else{const S=yn({},k.params);for(const I in S)S[I]==null&&delete S[I];j=yn({},k,{params:d(S)}),q.params=d(q.params)}const U=e.resolve(j,q),z=k.hash||"";U.params=u(f(U.params));const v=vk(r,yn({},k,{hash:fk(z),path:U.path})),M=o.createHref(v);return yn({fullPath:v,hash:z,query:r===QS?Dk(k.query):k.query||{}},U,{redirectedFrom:void 0,href:M})}function A(k){return typeof k=="string"?pv(t,k,l.value.path):yn({},k)}function y(k,q){if(c!==k)return Qc(Jn.NAVIGATION_CANCELLED,{from:q,to:k})}function b(k){return w(k)}function E(k){return b(yn(A(k),{replace:!0}))}function x(k,q){const j=k.matched[k.matched.length-1];if(j&&j.redirect){const{redirect:U}=j;let z=typeof U=="function"?U(k,q):U;return typeof z=="string"&&(z=z.includes("?")||z.includes("#")?z=A(z):{path:z},z.params={}),yn({query:k.query,hash:k.hash,params:z.path!=null?{}:k.params},z)}}function w(k,q){const j=c=_(k),U=l.value,z=k.state,v=k.force,M=k.replace===!0,S=x(j,U);if(S)return w(yn(A(S),{state:typeof S=="object"?yn({},z,S.state):z,force:v,replace:M}),q||j);const I=j;I.redirectedFrom=q;let J;return!v&&Ak(r,U,j)&&(J=Qc(Jn.NAVIGATION_DUPLICATED,{to:I,from:U}),O(U,U,!0,!1)),(J?Promise.resolve(J):P(I,U)).catch($=>Xa($)?Xa($,Jn.NAVIGATION_GUARD_REDIRECT)?$:R($):H($,I,U)).then($=>{if($){if(Xa($,Jn.NAVIGATION_GUARD_REDIRECT))return w(yn({replace:M},A($.to),{state:typeof $.to=="object"?yn({},z,$.to.state):z,force:v}),q||I)}else $=Q(I,U,!0,M,z);return D(I,U,$),$})}function L(k,q){const j=y(k,q);return j?Promise.reject(j):Promise.resolve()}function C(k){const q=ne.values().next().value;return q&&typeof q.runWithContext=="function"?q.runWithContext(k):k()}function P(k,q){let j;const[U,z,v]=Nk(k,q);j=bv(U.reverse(),"beforeRouteLeave",k,q);for(const S of U)S.leaveGuards.forEach(I=>{j.push(Ws(I,k,q))});const M=L.bind(null,k,q);return j.push(M),F(j).then(()=>{j=[];for(const S of i.list())j.push(Ws(S,k,q));return j.push(M),F(j)}).then(()=>{j=bv(z,"beforeRouteUpdate",k,q);for(const S of z)S.updateGuards.forEach(I=>{j.push(Ws(I,k,q))});return j.push(M),F(j)}).then(()=>{j=[];for(const S of v)if(S.beforeEnter)if(Vi(S.beforeEnter))for(const I of S.beforeEnter)j.push(Ws(I,k,q));else j.push(Ws(S.beforeEnter,k,q));return j.push(M),F(j)}).then(()=>(k.matched.forEach(S=>S.enterCallbacks={}),j=bv(v,"beforeRouteEnter",k,q,C),j.push(M),F(j))).then(()=>{j=[];for(const S of a.list())j.push(Ws(S,k,q));return j.push(M),F(j)}).catch(S=>Xa(S,Jn.NAVIGATION_CANCELLED)?S:Promise.reject(S))}function D(k,q,j){s.list().forEach(U=>C(()=>U(k,q,j)))}function Q(k,q,j,U,z){const v=y(k,q);if(v)return v;const M=q===Hs,S=Wc?history.state:{};j&&(U||M?o.replace(k.fullPath,yn({scroll:M&&S&&S.scroll},z)):o.push(k.fullPath,z)),l.value=k,O(k,q,j,M),R()}let re;function G(){re||(re=o.listen((k,q,j)=>{if(!oe.listening)return;const U=_(k),z=x(U,oe.currentRoute.value);if(z){w(yn(z,{replace:!0,force:!0}),U).catch(uf);return}c=U;const v=l.value;Wc&&Mk(HS(v.fullPath,j.delta),rm()),P(U,v).catch(M=>Xa(M,Jn.NAVIGATION_ABORTED|Jn.NAVIGATION_CANCELLED)?M:Xa(M,Jn.NAVIGATION_GUARD_REDIRECT)?(w(yn(A(M.to),{force:!0}),U).then(S=>{Xa(S,Jn.NAVIGATION_ABORTED|Jn.NAVIGATION_DUPLICATED)&&!j.delta&&j.type===mv.pop&&o.go(-1,!1)}).catch(uf),Promise.reject()):(j.delta&&o.go(-j.delta,!1),H(M,U,v))).then(M=>{M=M||Q(U,v,!1),M&&(j.delta&&!Xa(M,Jn.NAVIGATION_CANCELLED)?o.go(-j.delta,!1):j.type===mv.pop&&Xa(M,Jn.NAVIGATION_ABORTED|Jn.NAVIGATION_DUPLICATED)&&o.go(-1,!1)),D(U,v,M)}).catch(uf)}))}let se=ff(),ee=ff(),ie;function H(k,q,j){R(k);const U=ee.list();return U.length?U.forEach(z=>z(k,q,j)):console.error(k),Promise.reject(k)}function T(){return ie&&l.value!==Hs?Promise.resolve():new Promise((k,q)=>{se.add([k,q])})}function R(k){return ie||(ie=!k,G(),se.list().forEach(([q,j])=>k?j(k):q()),se.reset()),k}function O(k,q,j,U){const{scrollBehavior:z}=n;if(!Wc||!z)return Promise.resolve();const v=!j&&Tk(HS(k.fullPath,0))||(U||!j)&&history.state&&history.state.scroll||null;return Va().then(()=>z(k,q,v)).then(M=>M&&wk(M)).catch(M=>H(M,k,q))}const W=k=>o.go(k);let ae;const ne=new Set,oe={currentRoute:l,listening:!0,addRoute:h,removeRoute:p,clearRoutes:e.clearRoutes,hasRoute:g,getRoutes:m,resolve:_,options:n,push:b,replace:E,go:W,back:()=>W(-1),forward:()=>W(1),beforeEach:i.add,beforeResolve:a.add,afterEach:s.add,onError:ee.add,isReady:T,install(k){k.component("RouterLink",tF),k.component("RouterView",sw),k.config.globalProperties.$router=oe,Object.defineProperty(k.config.globalProperties,"$route",{enumerable:!0,get:()=>Ct(l)}),Wc&&!ae&&l.value===Hs&&(ae=!0,b(o.location).catch(U=>{}));const q={};for(const U in Hs)Object.defineProperty(q,U,{get:()=>l.value[U],enumerable:!0});k.provide(vv,oe),k.provide(Av,Wx(q)),k.provide(yv,l);const j=k.unmount;ne.add(k),k.unmount=function(){ne.delete(k),ne.size<1&&(c=Hs,re&&re(),re=null,l.value=Hs,ae=!1,ie=!1),j()}}};function F(k){return k.reduce((q,j)=>q.then(()=>C(j)),Promise.resolve())}return oe}function aF(n){return Lo(Av)}const sF=Ml({__name:"App",setup(n){return(e,t)=>(he(),gt(Ct(sw)))}});function xv(n){return Sx()?(NN(n),!0):!1}const Ev=new WeakMap,lF=(...n)=>{var e;const t=n[0],r=(e=Po())==null?void 0:e.proxy;if(r==null&&!TE())throw new Error("injectLocal must be called in setup");return r&&Ev.has(r)&&t in Ev.get(r)?Ev.get(r)[t]:Lo(...n)},cF=typeof window<"u"&&typeof document<"u";typeof WorkerGlobalScope<"u"&&globalThis instanceof WorkerGlobalScope;const uF=n=>n!=null,dF=Object.prototype.toString,fF=n=>dF.call(n)==="[object Object]";function lw(n){return n.endsWith("rem")?Number.parseFloat(n)*16:Number.parseFloat(n)}function om(n){return Array.isArray(n)?n:[n]}function hF(n){return Po()}function cw(n,e=!0,t){hF()?$o(n,t):e?n():Va(n)}function pF(n,e,t){return dr(n,e,{...t,immediate:!0})}const hf=cF?window:void 0;function $c(n){var e;const t=Bs(n);return(e=t==null?void 0:t.$el)!=null?e:t}function pf(...n){const e=[],t=()=>{e.forEach(s=>s()),e.length=0},r=(s,l,c,u)=>(s.addEventListener(l,c,u),()=>s.removeEventListener(l,c,u)),o=bt(()=>{const s=om(Bs(n[0])).filter(l=>l!=null);return s.every(l=>typeof l!="string")?s:void 0}),i=pF(()=>{var s,l;return[(l=(s=o.value)==null?void 0:s.map(c=>$c(c)))!=null?l:[hf].filter(c=>c!=null),om(Bs(o.value?n[1]:n[0])),om(Ct(o.value?n[2]:n[1])),Bs(o.value?n[3]:n[2])]},([s,l,c,u])=>{if(t(),!(s!=null&&s.length)||!(l!=null&&l.length)||!(c!=null&&c.length))return;const d=fF(u)?{...u}:u;e.push(...s.flatMap(f=>l.flatMap(h=>c.map(p=>r(f,h,p,d)))))},{flush:"post"}),a=()=>{i(),t()};return xv(t),a}function mF(){const n=Jr(!1),e=Po();return e&&$o(()=>{n.value=!0},e),n}function Cv(n){const e=mF();return bt(()=>(e.value,!!n()))}function gF(n,e,t={}){const{window:r=hf,...o}=t;let i;const a=Cv(()=>r&&"MutationObserver"in r),s=()=>{i&&(i.disconnect(),i=void 0)},l=bt(()=>{const f=Bs(n),h=om(f).map($c).filter(uF);return new Set(h)}),c=dr(l,f=>{s(),a.value&&f.size&&(i=new MutationObserver(e),f.forEach(h=>i.observe(h,o)))},{immediate:!0,flush:"post"}),u=()=>i==null?void 0:i.takeRecords(),d=()=>{c(),s()};return xv(d),{isSupported:a,stop:d,takeRecords:u}}const _F=Symbol("vueuse-ssr-width");function vF(){const n=TE()?lF(_F,null):null;return typeof n=="number"?n:void 0}function AF(n,e={}){const{window:t=hf,ssrWidth:r=vF()}=e,o=Cv(()=>t&&"matchMedia"in t&&typeof t.matchMedia=="function"),i=Jr(typeof r=="number"),a=Jr(),s=Jr(!1),l=c=>{s.value=c.matches};return UE(()=>{if(i.value){i.value=!o.value;const c=Bs(n).split(",");s.value=c.some(u=>{const d=u.includes("not all"),f=u.match(/\(\s*min-width:\s*(-?\d+(?:\.\d*)?[a-z]+\s*)\)/),h=u.match(/\(\s*max-width:\s*(-?\d+(?:\.\d*)?[a-z]+\s*)\)/);let p=!!(f||h);return f&&p&&(p=r>=lw(f[1])),h&&p&&(p=r<=lw(h[1])),d?!p:p});return}o.value&&(a.value=t.matchMedia(Bs(n)),s.value=a.value.matches)}),pf(a,"change",l,{passive:!0}),bt(()=>s.value)}function yF(n,e,t={}){const{window:r=hf,...o}=t;let i;const a=Cv(()=>r&&"ResizeObserver"in r),s=()=>{i&&(i.disconnect(),i=void 0)},l=bt(()=>{const d=Bs(n);return Array.isArray(d)?d.map(f=>$c(f)):[$c(d)]}),c=dr(l,d=>{if(s(),a.value&&r){i=new ResizeObserver(e);for(const f of d)f&&i.observe(f,o)}},{immediate:!0,flush:"post"}),u=()=>{s(),c()};return xv(u),{isSupported:a,stop:u}}function bF(n,e={}){const{reset:t=!0,windowResize:r=!0,windowScroll:o=!0,immediate:i=!0,updateTiming:a="sync"}=e,s=Jr(0),l=Jr(0),c=Jr(0),u=Jr(0),d=Jr(0),f=Jr(0),h=Jr(0),p=Jr(0);function m(){const _=$c(n);if(!_){t&&(s.value=0,l.value=0,c.value=0,u.value=0,d.value=0,f.value=0,h.value=0,p.value=0);return}const A=_.getBoundingClientRect();s.value=A.height,l.value=A.bottom,c.value=A.left,u.value=A.right,d.value=A.top,f.value=A.width,h.value=A.x,p.value=A.y}function g(){a==="sync"?m():a==="next-frame"&&requestAnimationFrame(()=>m())}return yF(n,g),dr(()=>$c(n),_=>!_&&g()),gF(n,g,{attributeFilter:["style","class"]}),o&&pf("scroll",g,{capture:!0,passive:!0}),r&&pf("resize",g,{passive:!0}),cw(()=>{i&&g()}),{height:s,bottom:l,left:c,right:u,top:d,width:f,x:h,y:p,update:g}}function xF(n={}){const{window:e=hf,initialWidth:t=Number.POSITIVE_INFINITY,initialHeight:r=Number.POSITIVE_INFINITY,listenOrientation:o=!0,includeScrollbar:i=!0,type:a="inner"}=n,s=Jr(t),l=Jr(r),c=()=>{if(e)if(a==="outer")s.value=e.outerWidth,l.value=e.outerHeight;else if(a==="visual"&&e.visualViewport){const{width:d,height:f,scale:h}=e.visualViewport;s.value=Math.round(d*h),l.value=Math.round(f*h)}else i?(s.value=e.innerWidth,l.value=e.innerHeight):(s.value=e.document.documentElement.clientWidth,l.value=e.document.documentElement.clientHeight)};c(),cw(c);const u={passive:!0};if(pf("resize",c,u),e&&a==="visual"&&e.visualViewport&&pf(e.visualViewport,"resize",c,u),o){const d=AF("(orientation: portrait)");dr(d,()=>c())}return{width:s,height:l}}function EF(n){return{all:n=n||new Map,on:function(e,t){var r=n.get(e);r?r.push(t):n.set(e,[t])},off:function(e,t){var r=n.get(e);r&&(t?r.splice(r.indexOf(t)>>>0,1):n.set(e,[]))},emit:function(e,t){var r=n.get(e);r&&r.slice().map(function(o){o(t)}),(r=n.get("*"))&&r.slice().map(function(o){o(e,t)})}}}{let n=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};n.SENTRY_RELEASE={id:"6da10dcfc82ede279c1d039b0b13a2659edfe3db"}}const Lr=EF();var im=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function am(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Sv,uw;function CF(){if(uw)return Sv;uw=1;var n="Expected a function",e=NaN,t="[object Symbol]",r=/^\s+|\s+$/g,o=/^[-+]0x[0-9a-f]+$/i,i=/^0b[01]+$/i,a=/^0o[0-7]+$/i,s=parseInt,l=typeof im=="object"&&im&&im.Object===Object&&im,c=typeof self=="object"&&self&&self.Object===Object&&self,u=l||c||Function("return this")(),d=Object.prototype,f=d.toString,h=Math.max,p=Math.min,m=function(){return u.Date.now()};function g(E,x,w){var L,C,P,D,Q,re,G=0,se=!1,ee=!1,ie=!0;if(typeof E!="function")throw new TypeError(n);x=b(x)||0,_(w)&&(se=!!w.leading,ee="maxWait"in w,P=ee?h(b(w.maxWait)||0,x):P,ie="trailing"in w?!!w.trailing:ie);function H(k){var q=L,j=C;return L=C=void 0,G=k,D=E.apply(j,q),D}function T(k){return G=k,Q=setTimeout(W,x),se?H(k):D}function R(k){var q=k-re,j=k-G,U=x-q;return ee?p(U,P-j):U}function O(k){var q=k-re,j=k-G;return re===void 0||q>=x||q<0||ee&&j>=P}function W(){var k=m();if(O(k))return ae(k);Q=setTimeout(W,R(k))}function ae(k){return Q=void 0,ie&&L?H(k):(L=C=void 0,D)}function ne(){Q!==void 0&&clearTimeout(Q),G=0,L=re=C=Q=void 0}function oe(){return Q===void 0?D:ae(m())}function F(){var k=m(),q=O(k);if(L=arguments,C=this,re=k,q){if(Q===void 0)return T(re);if(ee)return Q=setTimeout(W,x),H(re)}return Q===void 0&&(Q=setTimeout(W,x)),D}return F.cancel=ne,F.flush=oe,F}function _(E){var x=typeof E;return!!E&&(x=="object"||x=="function")}function A(E){return!!E&&typeof E=="object"}function y(E){return typeof E=="symbol"||A(E)&&f.call(E)==t}function b(E){if(typeof E=="number")return E;if(y(E))return e;if(_(E)){var x=typeof E.valueOf=="function"?E.valueOf():E;E=_(x)?x+"":x}if(typeof E!="string")return E===0?E:+E;E=E.replace(r,"");var w=i.test(E);return w||a.test(E)?s(E.slice(2),w?2:8):o.test(E)?e:+E}return Sv=g,Sv}var SF=CF();const wF=am(SF);var sm={exports:{}};sm.exports;var dw;function MF(){return dw||(dw=1,(function(n){const t=(i=0)=>a=>`\x1B[${38+i};5;${a}m`,r=(i=0)=>(a,s,l)=>`\x1B[${38+i};2;${a};${s};${l}m`;function o(){const i=new Map,a={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],overline:[53,55],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}};a.color.gray=a.color.blackBright,a.bgColor.bgGray=a.bgColor.bgBlackBright,a.color.grey=a.color.blackBright,a.bgColor.bgGrey=a.bgColor.bgBlackBright;for(const[s,l]of Object.entries(a)){for(const[c,u]of Object.entries(l))a[c]={open:`\x1B[${u[0]}m`,close:`\x1B[${u[1]}m`},l[c]=a[c],i.set(u[0],u[1]);Object.defineProperty(a,s,{value:l,enumerable:!1})}return Object.defineProperty(a,"codes",{value:i,enumerable:!1}),a.color.close="\x1B[39m",a.bgColor.close="\x1B[49m",a.color.ansi256=t(),a.color.ansi16m=r(),a.bgColor.ansi256=t(10),a.bgColor.ansi16m=r(10),Object.defineProperties(a,{rgbToAnsi256:{value:(s,l,c)=>s===l&&l===c?s<8?16:s>248?231:Math.round((s-8)/247*24)+232:16+36*Math.round(s/255*5)+6*Math.round(l/255*5)+Math.round(c/255*5),enumerable:!1},hexToRgb:{value:s=>{const l=/(?<colorString>[a-f\d]{6}|[a-f\d]{3})/i.exec(s.toString(16));if(!l)return[0,0,0];let{colorString:c}=l.groups;c.length===3&&(c=c.split("").map(d=>d+d).join(""));const u=Number.parseInt(c,16);return[u>>16&255,u>>8&255,u&255]},enumerable:!1},hexToAnsi256:{value:s=>a.rgbToAnsi256(...a.hexToRgb(s)),enumerable:!1}}),a}Object.defineProperty(n,"exports",{enumerable:!0,get:o})})(sm)),sm.exports}var TF=MF();const IF=am(TF);var RF=Object.defineProperty,un=(n,e)=>RF(n,"name",{value:e,configurable:!0}),LF=un(n=>{const e=Object.keys(n).sort();return Object.getOwnPropertySymbols&&Object.getOwnPropertySymbols(n).forEach(t=>{Object.getOwnPropertyDescriptor(n,t).enumerable&&e.push(t)}),e},"getKeysOfEnumerableProperties");function fw(n,e,t,r,o,i,a=": "){let s="",l=n.next();if(!l.done){s+=e.spacingOuter;const c=t+e.indent;for(;!l.done;){const u=i(l.value[0],e,c,r,o),d=i(l.value[1],e,c,r,o);s+=c+u+a+d,l=n.next(),l.done?e.min||(s+=","):s+=","+e.spacingInner}s+=e.spacingOuter+t}return s}un(fw,"printIteratorEntries");function hw(n,e,t,r,o,i){let a="",s=n.next();if(!s.done){a+=e.spacingOuter;const l=t+e.indent;for(;!s.done;)a+=l+i(s.value,e,l,r,o),s=n.next(),s.done?e.min||(a+=","):a+=","+e.spacingInner;a+=e.spacingOuter+t}return a}un(hw,"printIteratorValues");function wv(n,e,t,r,o,i){let a="";if(n.length){a+=e.spacingOuter;const s=t+e.indent;for(let l=0;l<n.length;l++)a+=s+i(n[l],e,s,r,o),l<n.length-1?a+=","+e.spacingInner:e.min||(a+=",");a+=e.spacingOuter+t}return a}un(wv,"printListItems");function pw(n,e,t,r,o,i){let a="";const s=LF(n);if(s.length){a+=e.spacingOuter;const l=t+e.indent;for(let c=0;c<s.length;c++){const u=s[c],d=i(u,e,l,r,o),f=i(n[u],e,l,r,o);a+=l+d+": "+f,c<s.length-1?a+=","+e.spacingInner:e.min||(a+=",")}a+=e.spacingOuter+t}return a}un(pw,"printObjectProperties");function PF(n){return n.replace(/</g,"&lt;").replace(/>/g,"&gt;")}un(PF,"escapeHTML");var DF=3,BF=8,NF=11;function OF(n){return n.nodeType===DF}un(OF,"nodeIsText");function kF(n){return n.nodeType===BF}un(kF,"nodeIsComment");function FF(n){return n.nodeType===NF}un(FF,"nodeIsFragment");var mw=Object.prototype.toString,VF=Date.prototype.toISOString,UF=Error.prototype.toString,gw=RegExp.prototype.toString,_w=un(n=>typeof n.constructor=="function"&&n.constructor.name||"Object","getConstructorName"),zF=un(n=>typeof window<"u"&&n===window,"isWindow"),GF=/^Symbol\((.*)\)(.*)$/,HF=/\n/gi,Mv=class extends Error{constructor(n,e){super(n),this.stack=e,this.name=this.constructor.name}};un(Mv,"PrettyFormatPluginError");function vw(n){return n==="[object Array]"||n==="[object ArrayBuffer]"||n==="[object DataView]"||n==="[object Float32Array]"||n==="[object Float64Array]"||n==="[object Int8Array]"||n==="[object Int16Array]"||n==="[object Int32Array]"||n==="[object Uint8Array]"||n==="[object Uint8ClampedArray]"||n==="[object Uint16Array]"||n==="[object Uint32Array]"}un(vw,"isToStringedArrayType");function Aw(n){return Object.is(n,-0)?"-0":String(n)}un(Aw,"printNumber");function yw(n){return`${n}n`}un(yw,"printBigInt");function Tv(n,e){return e?"[Function "+(n.name||"anonymous")+"]":"[Function]"}un(Tv,"printFunction");function Iv(n){return String(n).replace(GF,"Symbol($1)")}un(Iv,"printSymbol");function Rv(n){return"["+UF.call(n)+"]"}un(Rv,"printError");function Lv(n,e,t,r){if(n===!0||n===!1)return""+n;if(n===void 0)return"undefined";if(n===null)return"null";const o=typeof n;if(o==="number")return Aw(n);if(o==="bigint")return yw(n);if(o==="string")return r?'"'+n.replace(/"|\\/g,"\\$&")+'"':'"'+n+'"';if(o==="function")return Tv(n,e);if(o==="symbol")return Iv(n);const i=mw.call(n);return i==="[object WeakMap]"?"WeakMap {}":i==="[object WeakSet]"?"WeakSet {}":i==="[object Function]"||i==="[object GeneratorFunction]"?Tv(n,e):i==="[object Symbol]"?Iv(n):i==="[object Date]"?isNaN(+n)?"Date { NaN }":VF.call(n):i==="[object Error]"?Rv(n):i==="[object RegExp]"?t?gw.call(n).replace(/[\\^$*+?.()|[\]{}]/g,"\\$&"):gw.call(n):n instanceof Error?Rv(n):null}un(Lv,"printBasicValue");function Pv(n,e,t,r,o,i){if(o.indexOf(n)!==-1)return"[Circular]";o=o.slice(),o.push(n);const a=++r>e.maxDepth,s=e.min;if(e.callToJSON&&!a&&n.toJSON&&typeof n.toJSON=="function"&&!i)return qa(n.toJSON(),e,t,r,o,!0);const l=mw.call(n);return l==="[object Arguments]"?a?"[Arguments]":(s?"":"Arguments ")+"["+wv(n,e,t,r,o,qa)+"]":vw(l)?a?"["+n.constructor.name+"]":(s?"":n.constructor.name+" ")+"["+wv(n,e,t,r,o,qa)+"]":l==="[object Map]"?a?"[Map]":"Map {"+fw(n.entries(),e,t,r,o,qa," => ")+"}":l==="[object Set]"?a?"[Set]":"Set {"+hw(n.values(),e,t,r,o,qa)+"}":a||zF(n)?"["+_w(n)+"]":(s?"":_w(n)+" ")+"{"+pw(n,e,t,r,o,qa)+"}"}un(Pv,"printComplexValue");function bw(n){return n.serialize!=null}un(bw,"isNewPlugin");function Dv(n,e,t,r,o,i){let a;try{a=bw(n)?n.serialize(e,t,r,o,i,qa):n.print(e,s=>qa(s,t,r,o,i),s=>{const l=r+t.indent;return l+s.replace(HF,`
`+l)},{edgeSpacing:t.spacingOuter,min:t.min,spacing:t.spacingInner},t.colors)}catch(s){throw new Mv(s.message,s.stack)}if(typeof a!="string")throw new Error(`pretty-format: Plugin must return type "string" but instead returned "${typeof a}".`);return a}un(Dv,"printPlugin");function Bv(n,e){for(let t=0;t<n.length;t++)try{if(n[t].test(e))return n[t]}catch(r){throw new Mv(r.message,r.stack)}return null}un(Bv,"findPlugin");function qa(n,e,t,r,o,i){const a=Bv(e.plugins,n);if(a!==null)return Dv(a,n,e,t,r,o);const s=Lv(n,e.printFunctionName,e.escapeRegex,e.escapeString);return s!==null?s:Pv(n,e,t,r,o,i)}un(qa,"printer");var Nv={comment:"gray",content:"reset",prop:"yellow",tag:"cyan",value:"green"},xw=Object.keys(Nv),Ka={callToJSON:!0,escapeRegex:!1,escapeString:!0,highlight:!1,indent:2,maxDepth:1/0,min:!1,plugins:[],printFunctionName:!0,theme:Nv};function Ew(n){if(Object.keys(n).forEach(e=>{if(!Ka.hasOwnProperty(e))throw new Error(`pretty-format: Unknown option "${e}".`)}),n.min&&n.indent!==void 0&&n.indent!==0)throw new Error('pretty-format: Options "min" and "indent" cannot be used together.');if(n.theme!==void 0){if(n.theme===null)throw new Error('pretty-format: Option "theme" must not be null.');if(typeof n.theme!="object")throw new Error(`pretty-format: Option "theme" must be of type "object" but instead received "${typeof n.theme}".`)}}un(Ew,"validateOptions");var WF=un(n=>xw.reduce((e,t)=>{const r=n.theme&&n.theme[t]!==void 0?n.theme[t]:Nv[t],o=r&&IF[r];if(o&&typeof o.close=="string"&&typeof o.open=="string")e[t]=o;else throw new Error(`pretty-format: Option "theme" has a key "${t}" whose value "${r}" is undefined in ansi-styles.`);return e},Object.create(null)),"getColorsHighlight"),jF=un(()=>xw.reduce((n,e)=>(n[e]={close:"",open:""},n),Object.create(null)),"getColorsEmpty"),Cw=un(n=>n&&n.printFunctionName!==void 0?n.printFunctionName:Ka.printFunctionName,"getPrintFunctionName"),Sw=un(n=>n&&n.escapeRegex!==void 0?n.escapeRegex:Ka.escapeRegex,"getEscapeRegex"),ww=un(n=>n&&n.escapeString!==void 0?n.escapeString:Ka.escapeString,"getEscapeString"),Mw=un(n=>({callToJSON:n&&n.callToJSON!==void 0?n.callToJSON:Ka.callToJSON,colors:n&&n.highlight?WF(n):jF(),escapeRegex:Sw(n),escapeString:ww(n),indent:n&&n.min?"":Tw(n&&n.indent!==void 0?n.indent:Ka.indent),maxDepth:n&&n.maxDepth!==void 0?n.maxDepth:Ka.maxDepth,min:n&&n.min!==void 0?n.min:Ka.min,plugins:n&&n.plugins!==void 0?n.plugins:Ka.plugins,printFunctionName:Cw(n),spacingInner:n&&n.min?" ":`
`,spacingOuter:n&&n.min?"":`
`}),"getConfig");function Tw(n){return new Array(n+1).join(" ")}un(Tw,"createIndent");function Ol(n,e){if(e&&(Ew(e),e.plugins)){const r=Bv(e.plugins,n);if(r!==null)return Dv(r,n,Mw(e),"",0,[])}const t=Lv(n,Cw(e),Sw(e),ww(e));return t!==null?t:Pv(n,Mw(e),"",0,[])}un(Ol,"format");function Iw(n,e){return function(){return n.apply(e,arguments)}}const{toString:QF}=Object.prototype,{getPrototypeOf:Ov}=Object,{iterator:lm,toStringTag:Rw}=Symbol,cm=(n=>e=>{const t=QF.call(e);return n[t]||(n[t]=t.slice(8,-1).toLowerCase())})(Object.create(null)),Ui=n=>(n=n.toLowerCase(),e=>cm(e)===n),um=n=>e=>typeof e===n,{isArray:Yc}=Array,Xc=um("undefined");function mf(n){return n!==null&&!Xc(n)&&n.constructor!==null&&!Xc(n.constructor)&&Bo(n.constructor.isBuffer)&&n.constructor.isBuffer(n)}const Lw=Ui("ArrayBuffer");function $F(n){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(n):e=n&&n.buffer&&Lw(n.buffer),e}const YF=um("string"),Bo=um("function"),Pw=um("number"),gf=n=>n!==null&&typeof n=="object",XF=n=>n===!0||n===!1,dm=n=>{if(cm(n)!=="object")return!1;const e=Ov(n);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Rw in n)&&!(lm in n)},qF=n=>{if(!gf(n)||mf(n))return!1;try{return Object.keys(n).length===0&&Object.getPrototypeOf(n)===Object.prototype}catch{return!1}},KF=Ui("Date"),ZF=Ui("File"),JF=Ui("Blob"),eV=Ui("FileList"),tV=n=>gf(n)&&Bo(n.pipe),nV=n=>{let e;return n&&(typeof FormData=="function"&&n instanceof FormData||Bo(n.append)&&((e=cm(n))==="formdata"||e==="object"&&Bo(n.toString)&&n.toString()==="[object FormData]"))},rV=Ui("URLSearchParams"),[oV,iV,aV,sV]=["ReadableStream","Request","Response","Headers"].map(Ui),lV=n=>n.trim?n.trim():n.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function _f(n,e,{allOwnKeys:t=!1}={}){if(n===null||typeof n>"u")return;let r,o;if(typeof n!="object"&&(n=[n]),Yc(n))for(r=0,o=n.length;r<o;r++)e.call(null,n[r],r,n);else{if(mf(n))return;const i=t?Object.getOwnPropertyNames(n):Object.keys(n),a=i.length;let s;for(r=0;r<a;r++)s=i[r],e.call(null,n[s],s,n)}}function Dw(n,e){if(mf(n))return null;e=e.toLowerCase();const t=Object.keys(n);let r=t.length,o;for(;r-- >0;)if(o=t[r],e===o.toLowerCase())return o;return null}const kl=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,Bw=n=>!Xc(n)&&n!==kl;function kv(){const{caseless:n,skipUndefined:e}=Bw(this)&&this||{},t={},r=(o,i)=>{const a=n&&Dw(t,i)||i;dm(t[a])&&dm(o)?t[a]=kv(t[a],o):dm(o)?t[a]=kv({},o):Yc(o)?t[a]=o.slice():(!e||!Xc(o))&&(t[a]=o)};for(let o=0,i=arguments.length;o<i;o++)arguments[o]&&_f(arguments[o],r);return t}const cV=(n,e,t,{allOwnKeys:r}={})=>(_f(e,(o,i)=>{t&&Bo(o)?n[i]=Iw(o,t):n[i]=o},{allOwnKeys:r}),n),uV=n=>(n.charCodeAt(0)===65279&&(n=n.slice(1)),n),dV=(n,e,t,r)=>{n.prototype=Object.create(e.prototype,r),n.prototype.constructor=n,Object.defineProperty(n,"super",{value:e.prototype}),t&&Object.assign(n.prototype,t)},fV=(n,e,t,r)=>{let o,i,a;const s={};if(e=e||{},n==null)return e;do{for(o=Object.getOwnPropertyNames(n),i=o.length;i-- >0;)a=o[i],(!r||r(a,n,e))&&!s[a]&&(e[a]=n[a],s[a]=!0);n=t!==!1&&Ov(n)}while(n&&(!t||t(n,e))&&n!==Object.prototype);return e},hV=(n,e,t)=>{n=String(n),(t===void 0||t>n.length)&&(t=n.length),t-=e.length;const r=n.indexOf(e,t);return r!==-1&&r===t},pV=n=>{if(!n)return null;if(Yc(n))return n;let e=n.length;if(!Pw(e))return null;const t=new Array(e);for(;e-- >0;)t[e]=n[e];return t},mV=(n=>e=>n&&e instanceof n)(typeof Uint8Array<"u"&&Ov(Uint8Array)),gV=(n,e)=>{const r=(n&&n[lm]).call(n);let o;for(;(o=r.next())&&!o.done;){const i=o.value;e.call(n,i[0],i[1])}},_V=(n,e)=>{let t;const r=[];for(;(t=n.exec(e))!==null;)r.push(t);return r},vV=Ui("HTMLFormElement"),AV=n=>n.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,r,o){return r.toUpperCase()+o}),Nw=(({hasOwnProperty:n})=>(e,t)=>n.call(e,t))(Object.prototype),yV=Ui("RegExp"),Ow=(n,e)=>{const t=Object.getOwnPropertyDescriptors(n),r={};_f(t,(o,i)=>{let a;(a=e(o,i,n))!==!1&&(r[i]=a||o)}),Object.defineProperties(n,r)},bV=n=>{Ow(n,(e,t)=>{if(Bo(n)&&["arguments","caller","callee"].indexOf(t)!==-1)return!1;const r=n[t];if(Bo(r)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+t+"'")})}})},xV=(n,e)=>{const t={},r=o=>{o.forEach(i=>{t[i]=!0})};return Yc(n)?r(n):r(String(n).split(e)),t},EV=()=>{},CV=(n,e)=>n!=null&&Number.isFinite(n=+n)?n:e;function SV(n){return!!(n&&Bo(n.append)&&n[Rw]==="FormData"&&n[lm])}const wV=n=>{const e=new Array(10),t=(r,o)=>{if(gf(r)){if(e.indexOf(r)>=0)return;if(mf(r))return r;if(!("toJSON"in r)){e[o]=r;const i=Yc(r)?[]:{};return _f(r,(a,s)=>{const l=t(a,o+1);!Xc(l)&&(i[s]=l)}),e[o]=void 0,i}}return r};return t(n,0)},MV=Ui("AsyncFunction"),TV=n=>n&&(gf(n)||Bo(n))&&Bo(n.then)&&Bo(n.catch),kw=((n,e)=>n?setImmediate:e?((t,r)=>(kl.addEventListener("message",({source:o,data:i})=>{o===kl&&i===t&&r.length&&r.shift()()},!1),o=>{r.push(o),kl.postMessage(t,"*")}))(`axios@${Math.random()}`,[]):t=>setTimeout(t))(typeof setImmediate=="function",Bo(kl.postMessage)),IV=typeof queueMicrotask<"u"?queueMicrotask.bind(kl):typeof process<"u"&&process.nextTick||kw,Le={isArray:Yc,isArrayBuffer:Lw,isBuffer:mf,isFormData:nV,isArrayBufferView:$F,isString:YF,isNumber:Pw,isBoolean:XF,isObject:gf,isPlainObject:dm,isEmptyObject:qF,isReadableStream:oV,isRequest:iV,isResponse:aV,isHeaders:sV,isUndefined:Xc,isDate:KF,isFile:ZF,isBlob:JF,isRegExp:yV,isFunction:Bo,isStream:tV,isURLSearchParams:rV,isTypedArray:mV,isFileList:eV,forEach:_f,merge:kv,extend:cV,trim:lV,stripBOM:uV,inherits:dV,toFlatObject:fV,kindOf:cm,kindOfTest:Ui,endsWith:hV,toArray:pV,forEachEntry:gV,matchAll:_V,isHTMLForm:vV,hasOwnProperty:Nw,hasOwnProp:Nw,reduceDescriptors:Ow,freezeMethods:bV,toObjectSet:xV,toCamelCase:AV,noop:EV,toFiniteNumber:CV,findKey:Dw,global:kl,isContextDefined:Bw,isSpecCompliantForm:SV,toJSONObject:wV,isAsyncFn:MV,isThenable:TV,setImmediate:kw,asap:IV,isIterable:n=>n!=null&&Bo(n[lm])};function Ut(n,e,t,r,o){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=n,this.name="AxiosError",e&&(this.code=e),t&&(this.config=t),r&&(this.request=r),o&&(this.response=o,this.status=o.status?o.status:null)}Le.inherits(Ut,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Le.toJSONObject(this.config),code:this.code,status:this.status}}});const Fw=Ut.prototype,Vw={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(n=>{Vw[n]={value:n}}),Object.defineProperties(Ut,Vw),Object.defineProperty(Fw,"isAxiosError",{value:!0}),Ut.from=(n,e,t,r,o,i)=>{const a=Object.create(Fw);Le.toFlatObject(n,a,function(u){return u!==Error.prototype},c=>c!=="isAxiosError");const s=n&&n.message?n.message:"Error",l=e==null&&n?n.code:e;return Ut.call(a,s,l,t,r,o),n&&a.cause==null&&Object.defineProperty(a,"cause",{value:n,configurable:!0}),a.name=n&&n.name||"Error",i&&Object.assign(a,i),a};const RV=null;function Fv(n){return Le.isPlainObject(n)||Le.isArray(n)}function Uw(n){return Le.endsWith(n,"[]")?n.slice(0,-2):n}function zw(n,e,t){return n?n.concat(e).map(function(o,i){return o=Uw(o),!t&&i?"["+o+"]":o}).join(t?".":""):e}function LV(n){return Le.isArray(n)&&!n.some(Fv)}const PV=Le.toFlatObject(Le,{},null,function(e){return/^is[A-Z]/.test(e)});function fm(n,e,t){if(!Le.isObject(n))throw new TypeError("target must be an object");e=e||new FormData,t=Le.toFlatObject(t,{metaTokens:!0,dots:!1,indexes:!1},!1,function(m,g){return!Le.isUndefined(g[m])});const r=t.metaTokens,o=t.visitor||u,i=t.dots,a=t.indexes,l=(t.Blob||typeof Blob<"u"&&Blob)&&Le.isSpecCompliantForm(e);if(!Le.isFunction(o))throw new TypeError("visitor must be a function");function c(p){if(p===null)return"";if(Le.isDate(p))return p.toISOString();if(Le.isBoolean(p))return p.toString();if(!l&&Le.isBlob(p))throw new Ut("Blob is not supported. Use a Buffer instead.");return Le.isArrayBuffer(p)||Le.isTypedArray(p)?l&&typeof Blob=="function"?new Blob([p]):Buffer.from(p):p}function u(p,m,g){let _=p;if(p&&!g&&typeof p=="object"){if(Le.endsWith(m,"{}"))m=r?m:m.slice(0,-2),p=JSON.stringify(p);else if(Le.isArray(p)&&LV(p)||(Le.isFileList(p)||Le.endsWith(m,"[]"))&&(_=Le.toArray(p)))return m=Uw(m),_.forEach(function(y,b){!(Le.isUndefined(y)||y===null)&&e.append(a===!0?zw([m],b,i):a===null?m:m+"[]",c(y))}),!1}return Fv(p)?!0:(e.append(zw(g,m,i),c(p)),!1)}const d=[],f=Object.assign(PV,{defaultVisitor:u,convertValue:c,isVisitable:Fv});function h(p,m){if(!Le.isUndefined(p)){if(d.indexOf(p)!==-1)throw Error("Circular reference detected in "+m.join("."));d.push(p),Le.forEach(p,function(_,A){(!(Le.isUndefined(_)||_===null)&&o.call(e,_,Le.isString(A)?A.trim():A,m,f))===!0&&h(_,m?m.concat(A):[A])}),d.pop()}}if(!Le.isObject(n))throw new TypeError("data must be an object");return h(n),e}function Gw(n){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(n).replace(/[!'()~]|%20|%00/g,function(r){return e[r]})}function Vv(n,e){this._pairs=[],n&&fm(n,this,e)}const Hw=Vv.prototype;Hw.append=function(e,t){this._pairs.push([e,t])},Hw.toString=function(e){const t=e?function(r){return e.call(this,r,Gw)}:Gw;return this._pairs.map(function(o){return t(o[0])+"="+t(o[1])},"").join("&")};function DV(n){return encodeURIComponent(n).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function Ww(n,e,t){if(!e)return n;const r=t&&t.encode||DV;Le.isFunction(t)&&(t={serialize:t});const o=t&&t.serialize;let i;if(o?i=o(e,t):i=Le.isURLSearchParams(e)?e.toString():new Vv(e,t).toString(r),i){const a=n.indexOf("#");a!==-1&&(n=n.slice(0,a)),n+=(n.indexOf("?")===-1?"?":"&")+i}return n}class jw{constructor(){this.handlers=[]}use(e,t,r){return this.handlers.push({fulfilled:e,rejected:t,synchronous:r?r.synchronous:!1,runWhen:r?r.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){Le.forEach(this.handlers,function(r){r!==null&&e(r)})}}const Qw={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},BV={isBrowser:!0,classes:{URLSearchParams:typeof URLSearchParams<"u"?URLSearchParams:Vv,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]},Uv=typeof window<"u"&&typeof document<"u",zv=typeof navigator=="object"&&navigator||void 0,NV=Uv&&(!zv||["ReactNative","NativeScript","NS"].indexOf(zv.product)<0),OV=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",kV=Uv&&window.location.href||"http://localhost",no={...Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:Uv,hasStandardBrowserEnv:NV,hasStandardBrowserWebWorkerEnv:OV,navigator:zv,origin:kV},Symbol.toStringTag,{value:"Module"})),...BV};function FV(n,e){return fm(n,new no.classes.URLSearchParams,{visitor:function(t,r,o,i){return no.isNode&&Le.isBuffer(t)?(this.append(r,t.toString("base64")),!1):i.defaultVisitor.apply(this,arguments)},...e})}function VV(n){return Le.matchAll(/\w+|\[(\w*)]/g,n).map(e=>e[0]==="[]"?"":e[1]||e[0])}function UV(n){const e={},t=Object.keys(n);let r;const o=t.length;let i;for(r=0;r<o;r++)i=t[r],e[i]=n[i];return e}function $w(n){function e(t,r,o,i){let a=t[i++];if(a==="__proto__")return!0;const s=Number.isFinite(+a),l=i>=t.length;return a=!a&&Le.isArray(o)?o.length:a,l?(Le.hasOwnProp(o,a)?o[a]=[o[a],r]:o[a]=r,!s):((!o[a]||!Le.isObject(o[a]))&&(o[a]=[]),e(t,r,o[a],i)&&Le.isArray(o[a])&&(o[a]=UV(o[a])),!s)}if(Le.isFormData(n)&&Le.isFunction(n.entries)){const t={};return Le.forEachEntry(n,(r,o)=>{e(VV(r),o,t,0)}),t}return null}function zV(n,e,t){if(Le.isString(n))try{return(e||JSON.parse)(n),Le.trim(n)}catch(r){if(r.name!=="SyntaxError")throw r}return(t||JSON.stringify)(n)}const vf={transitional:Qw,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const r=t.getContentType()||"",o=r.indexOf("application/json")>-1,i=Le.isObject(e);if(i&&Le.isHTMLForm(e)&&(e=new FormData(e)),Le.isFormData(e))return o?JSON.stringify($w(e)):e;if(Le.isArrayBuffer(e)||Le.isBuffer(e)||Le.isStream(e)||Le.isFile(e)||Le.isBlob(e)||Le.isReadableStream(e))return e;if(Le.isArrayBufferView(e))return e.buffer;if(Le.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let s;if(i){if(r.indexOf("application/x-www-form-urlencoded")>-1)return FV(e,this.formSerializer).toString();if((s=Le.isFileList(e))||r.indexOf("multipart/form-data")>-1){const l=this.env&&this.env.FormData;return fm(s?{"files[]":e}:e,l&&new l,this.formSerializer)}}return i||o?(t.setContentType("application/json",!1),zV(e)):e}],transformResponse:[function(e){const t=this.transitional||vf.transitional,r=t&&t.forcedJSONParsing,o=this.responseType==="json";if(Le.isResponse(e)||Le.isReadableStream(e))return e;if(e&&Le.isString(e)&&(r&&!this.responseType||o)){const a=!(t&&t.silentJSONParsing)&&o;try{return JSON.parse(e,this.parseReviver)}catch(s){if(a)throw s.name==="SyntaxError"?Ut.from(s,Ut.ERR_BAD_RESPONSE,this,null,this.response):s}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:no.classes.FormData,Blob:no.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Le.forEach(["delete","get","head","post","put","patch"],n=>{vf.headers[n]={}});const GV=Le.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),HV=n=>{const e={};let t,r,o;return n&&n.split(`
`).forEach(function(a){o=a.indexOf(":"),t=a.substring(0,o).trim().toLowerCase(),r=a.substring(o+1).trim(),!(!t||e[t]&&GV[t])&&(t==="set-cookie"?e[t]?e[t].push(r):e[t]=[r]:e[t]=e[t]?e[t]+", "+r:r)}),e},Yw=Symbol("internals");function Af(n){return n&&String(n).trim().toLowerCase()}function hm(n){return n===!1||n==null?n:Le.isArray(n)?n.map(hm):String(n)}function WV(n){const e=Object.create(null),t=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let r;for(;r=t.exec(n);)e[r[1]]=r[2];return e}const jV=n=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(n.trim());function Gv(n,e,t,r,o){if(Le.isFunction(r))return r.call(this,e,t);if(o&&(e=t),!!Le.isString(e)){if(Le.isString(r))return e.indexOf(r)!==-1;if(Le.isRegExp(r))return r.test(e)}}function QV(n){return n.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,r)=>t.toUpperCase()+r)}function $V(n,e){const t=Le.toCamelCase(" "+e);["get","set","has"].forEach(r=>{Object.defineProperty(n,r+t,{value:function(o,i,a){return this[r].call(this,e,o,i,a)},configurable:!0})})}let No=class{constructor(e){e&&this.set(e)}set(e,t,r){const o=this;function i(s,l,c){const u=Af(l);if(!u)throw new Error("header name must be a non-empty string");const d=Le.findKey(o,u);(!d||o[d]===void 0||c===!0||c===void 0&&o[d]!==!1)&&(o[d||l]=hm(s))}const a=(s,l)=>Le.forEach(s,(c,u)=>i(c,u,l));if(Le.isPlainObject(e)||e instanceof this.constructor)a(e,t);else if(Le.isString(e)&&(e=e.trim())&&!jV(e))a(HV(e),t);else if(Le.isObject(e)&&Le.isIterable(e)){let s={},l,c;for(const u of e){if(!Le.isArray(u))throw TypeError("Object iterator must return a key-value pair");s[c=u[0]]=(l=s[c])?Le.isArray(l)?[...l,u[1]]:[l,u[1]]:u[1]}a(s,t)}else e!=null&&i(t,e,r);return this}get(e,t){if(e=Af(e),e){const r=Le.findKey(this,e);if(r){const o=this[r];if(!t)return o;if(t===!0)return WV(o);if(Le.isFunction(t))return t.call(this,o,r);if(Le.isRegExp(t))return t.exec(o);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=Af(e),e){const r=Le.findKey(this,e);return!!(r&&this[r]!==void 0&&(!t||Gv(this,this[r],r,t)))}return!1}delete(e,t){const r=this;let o=!1;function i(a){if(a=Af(a),a){const s=Le.findKey(r,a);s&&(!t||Gv(r,r[s],s,t))&&(delete r[s],o=!0)}}return Le.isArray(e)?e.forEach(i):i(e),o}clear(e){const t=Object.keys(this);let r=t.length,o=!1;for(;r--;){const i=t[r];(!e||Gv(this,this[i],i,e,!0))&&(delete this[i],o=!0)}return o}normalize(e){const t=this,r={};return Le.forEach(this,(o,i)=>{const a=Le.findKey(r,i);if(a){t[a]=hm(o),delete t[i];return}const s=e?QV(i):String(i).trim();s!==i&&delete t[i],t[s]=hm(o),r[s]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const t=Object.create(null);return Le.forEach(this,(r,o)=>{r!=null&&r!==!1&&(t[o]=e&&Le.isArray(r)?r.join(", "):r)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,t])=>e+": "+t).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){const r=new this(e);return t.forEach(o=>r.set(o)),r}static accessor(e){const r=(this[Yw]=this[Yw]={accessors:{}}).accessors,o=this.prototype;function i(a){const s=Af(a);r[s]||($V(o,a),r[s]=!0)}return Le.isArray(e)?e.forEach(i):i(e),this}};No.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),Le.reduceDescriptors(No.prototype,({value:n},e)=>{let t=e[0].toUpperCase()+e.slice(1);return{get:()=>n,set(r){this[t]=r}}}),Le.freezeMethods(No);function Hv(n,e){const t=this||vf,r=e||t,o=No.from(r.headers);let i=r.data;return Le.forEach(n,function(s){i=s.call(t,i,o.normalize(),e?e.status:void 0)}),o.normalize(),i}function Xw(n){return!!(n&&n.__CANCEL__)}function qc(n,e,t){Ut.call(this,n??"canceled",Ut.ERR_CANCELED,e,t),this.name="CanceledError"}Le.inherits(qc,Ut,{__CANCEL__:!0});function qw(n,e,t){const r=t.config.validateStatus;!t.status||!r||r(t.status)?n(t):e(new Ut("Request failed with status code "+t.status,[Ut.ERR_BAD_REQUEST,Ut.ERR_BAD_RESPONSE][Math.floor(t.status/100)-4],t.config,t.request,t))}function YV(n){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(n);return e&&e[1]||""}function XV(n,e){n=n||10;const t=new Array(n),r=new Array(n);let o=0,i=0,a;return e=e!==void 0?e:1e3,function(l){const c=Date.now(),u=r[i];a||(a=c),t[o]=l,r[o]=c;let d=i,f=0;for(;d!==o;)f+=t[d++],d=d%n;if(o=(o+1)%n,o===i&&(i=(i+1)%n),c-a<e)return;const h=u&&c-u;return h?Math.round(f*1e3/h):void 0}}function qV(n,e){let t=0,r=1e3/e,o,i;const a=(c,u=Date.now())=>{t=u,o=null,i&&(clearTimeout(i),i=null),n(...c)};return[(...c)=>{const u=Date.now(),d=u-t;d>=r?a(c,u):(o=c,i||(i=setTimeout(()=>{i=null,a(o)},r-d)))},()=>o&&a(o)]}const pm=(n,e,t=3)=>{let r=0;const o=XV(50,250);return qV(i=>{const a=i.loaded,s=i.lengthComputable?i.total:void 0,l=a-r,c=o(l),u=a<=s;r=a;const d={loaded:a,total:s,progress:s?a/s:void 0,bytes:l,rate:c||void 0,estimated:c&&s&&u?(s-a)/c:void 0,event:i,lengthComputable:s!=null,[e?"download":"upload"]:!0};n(d)},t)},Kw=(n,e)=>{const t=n!=null;return[r=>e[0]({lengthComputable:t,total:n,loaded:r}),e[1]]},Zw=n=>(...e)=>Le.asap(()=>n(...e)),KV=no.hasStandardBrowserEnv?((n,e)=>t=>(t=new URL(t,no.origin),n.protocol===t.protocol&&n.host===t.host&&(e||n.port===t.port)))(new URL(no.origin),no.navigator&&/(msie|trident)/i.test(no.navigator.userAgent)):()=>!0,ZV=no.hasStandardBrowserEnv?{write(n,e,t,r,o,i,a){if(typeof document>"u")return;const s=[`${n}=${encodeURIComponent(e)}`];Le.isNumber(t)&&s.push(`expires=${new Date(t).toUTCString()}`),Le.isString(r)&&s.push(`path=${r}`),Le.isString(o)&&s.push(`domain=${o}`),i===!0&&s.push("secure"),Le.isString(a)&&s.push(`SameSite=${a}`),document.cookie=s.join("; ")},read(n){if(typeof document>"u")return null;const e=document.cookie.match(new RegExp("(?:^|; )"+n+"=([^;]*)"));return e?decodeURIComponent(e[1]):null},remove(n){this.write(n,"",Date.now()-864e5,"/")}}:{write(){},read(){return null},remove(){}};function JV(n){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(n)}function eU(n,e){return e?n.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):n}function Jw(n,e,t){let r=!JV(e);return n&&(r||t==!1)?eU(n,e):e}const eM=n=>n instanceof No?{...n}:n;function Fl(n,e){e=e||{};const t={};function r(c,u,d,f){return Le.isPlainObject(c)&&Le.isPlainObject(u)?Le.merge.call({caseless:f},c,u):Le.isPlainObject(u)?Le.merge({},u):Le.isArray(u)?u.slice():u}function o(c,u,d,f){if(Le.isUndefined(u)){if(!Le.isUndefined(c))return r(void 0,c,d,f)}else return r(c,u,d,f)}function i(c,u){if(!Le.isUndefined(u))return r(void 0,u)}function a(c,u){if(Le.isUndefined(u)){if(!Le.isUndefined(c))return r(void 0,c)}else return r(void 0,u)}function s(c,u,d){if(d in e)return r(c,u);if(d in n)return r(void 0,c)}const l={url:i,method:i,data:i,baseURL:a,transformRequest:a,transformResponse:a,paramsSerializer:a,timeout:a,timeoutMessage:a,withCredentials:a,withXSRFToken:a,adapter:a,responseType:a,xsrfCookieName:a,xsrfHeaderName:a,onUploadProgress:a,onDownloadProgress:a,decompress:a,maxContentLength:a,maxBodyLength:a,beforeRedirect:a,transport:a,httpAgent:a,httpsAgent:a,cancelToken:a,socketPath:a,responseEncoding:a,validateStatus:s,headers:(c,u,d)=>o(eM(c),eM(u),d,!0)};return Le.forEach(Object.keys({...n,...e}),function(u){const d=l[u]||o,f=d(n[u],e[u],u);Le.isUndefined(f)&&d!==s||(t[u]=f)}),t}const tM=n=>{const e=Fl({},n);let{data:t,withXSRFToken:r,xsrfHeaderName:o,xsrfCookieName:i,headers:a,auth:s}=e;if(e.headers=a=No.from(a),e.url=Ww(Jw(e.baseURL,e.url,e.allowAbsoluteUrls),n.params,n.paramsSerializer),s&&a.set("Authorization","Basic "+btoa((s.username||"")+":"+(s.password?unescape(encodeURIComponent(s.password)):""))),Le.isFormData(t)){if(no.hasStandardBrowserEnv||no.hasStandardBrowserWebWorkerEnv)a.setContentType(void 0);else if(Le.isFunction(t.getHeaders)){const l=t.getHeaders(),c=["content-type","content-length"];Object.entries(l).forEach(([u,d])=>{c.includes(u.toLowerCase())&&a.set(u,d)})}}if(no.hasStandardBrowserEnv&&(r&&Le.isFunction(r)&&(r=r(e)),r||r!==!1&&KV(e.url))){const l=o&&i&&ZV.read(i);l&&a.set(o,l)}return e},tU=typeof XMLHttpRequest<"u"&&function(n){return new Promise(function(t,r){const o=tM(n);let i=o.data;const a=No.from(o.headers).normalize();let{responseType:s,onUploadProgress:l,onDownloadProgress:c}=o,u,d,f,h,p;function m(){h&&h(),p&&p(),o.cancelToken&&o.cancelToken.unsubscribe(u),o.signal&&o.signal.removeEventListener("abort",u)}let g=new XMLHttpRequest;g.open(o.method.toUpperCase(),o.url,!0),g.timeout=o.timeout;function _(){if(!g)return;const y=No.from("getAllResponseHeaders"in g&&g.getAllResponseHeaders()),E={data:!s||s==="text"||s==="json"?g.responseText:g.response,status:g.status,statusText:g.statusText,headers:y,config:n,request:g};qw(function(w){t(w),m()},function(w){r(w),m()},E),g=null}"onloadend"in g?g.onloadend=_:g.onreadystatechange=function(){!g||g.readyState!==4||g.status===0&&!(g.responseURL&&g.responseURL.indexOf("file:")===0)||setTimeout(_)},g.onabort=function(){g&&(r(new Ut("Request aborted",Ut.ECONNABORTED,n,g)),g=null)},g.onerror=function(b){const E=b&&b.message?b.message:"Network Error",x=new Ut(E,Ut.ERR_NETWORK,n,g);x.event=b||null,r(x),g=null},g.ontimeout=function(){let b=o.timeout?"timeout of "+o.timeout+"ms exceeded":"timeout exceeded";const E=o.transitional||Qw;o.timeoutErrorMessage&&(b=o.timeoutErrorMessage),r(new Ut(b,E.clarifyTimeoutError?Ut.ETIMEDOUT:Ut.ECONNABORTED,n,g)),g=null},i===void 0&&a.setContentType(null),"setRequestHeader"in g&&Le.forEach(a.toJSON(),function(b,E){g.setRequestHeader(E,b)}),Le.isUndefined(o.withCredentials)||(g.withCredentials=!!o.withCredentials),s&&s!=="json"&&(g.responseType=o.responseType),c&&([f,p]=pm(c,!0),g.addEventListener("progress",f)),l&&g.upload&&([d,h]=pm(l),g.upload.addEventListener("progress",d),g.upload.addEventListener("loadend",h)),(o.cancelToken||o.signal)&&(u=y=>{g&&(r(!y||y.type?new qc(null,n,g):y),g.abort(),g=null)},o.cancelToken&&o.cancelToken.subscribe(u),o.signal&&(o.signal.aborted?u():o.signal.addEventListener("abort",u)));const A=YV(o.url);if(A&&no.protocols.indexOf(A)===-1){r(new Ut("Unsupported protocol "+A+":",Ut.ERR_BAD_REQUEST,n));return}g.send(i||null)})},nU=(n,e)=>{const{length:t}=n=n?n.filter(Boolean):[];if(e||t){let r=new AbortController,o;const i=function(c){if(!o){o=!0,s();const u=c instanceof Error?c:this.reason;r.abort(u instanceof Ut?u:new qc(u instanceof Error?u.message:u))}};let a=e&&setTimeout(()=>{a=null,i(new Ut(`timeout ${e} of ms exceeded`,Ut.ETIMEDOUT))},e);const s=()=>{n&&(a&&clearTimeout(a),a=null,n.forEach(c=>{c.unsubscribe?c.unsubscribe(i):c.removeEventListener("abort",i)}),n=null)};n.forEach(c=>c.addEventListener("abort",i));const{signal:l}=r;return l.unsubscribe=()=>Le.asap(s),l}},rU=function*(n,e){let t=n.byteLength;if(t<e){yield n;return}let r=0,o;for(;r<t;)o=r+e,yield n.slice(r,o),r=o},oU=async function*(n,e){for await(const t of iU(n))yield*rU(t,e)},iU=async function*(n){if(n[Symbol.asyncIterator]){yield*n;return}const e=n.getReader();try{for(;;){const{done:t,value:r}=await e.read();if(t)break;yield r}}finally{await e.cancel()}},nM=(n,e,t,r)=>{const o=oU(n,e);let i=0,a,s=l=>{a||(a=!0,r&&r(l))};return new ReadableStream({async pull(l){try{const{done:c,value:u}=await o.next();if(c){s(),l.close();return}let d=u.byteLength;if(t){let f=i+=d;t(f)}l.enqueue(new Uint8Array(u))}catch(c){throw s(c),c}},cancel(l){return s(l),o.return()}},{highWaterMark:2})},rM=64*1024,{isFunction:mm}=Le,aU=(({Request:n,Response:e})=>({Request:n,Response:e}))(Le.global),{ReadableStream:oM,TextEncoder:iM}=Le.global,aM=(n,...e)=>{try{return!!n(...e)}catch{return!1}},sU=n=>{n=Le.merge.call({skipUndefined:!0},aU,n);const{fetch:e,Request:t,Response:r}=n,o=e?mm(e):typeof fetch=="function",i=mm(t),a=mm(r);if(!o)return!1;const s=o&&mm(oM),l=o&&(typeof iM=="function"?(p=>m=>p.encode(m))(new iM):async p=>new Uint8Array(await new t(p).arrayBuffer())),c=i&&s&&aM(()=>{let p=!1;const m=new t(no.origin,{body:new oM,method:"POST",get duplex(){return p=!0,"half"}}).headers.has("Content-Type");return p&&!m}),u=a&&s&&aM(()=>Le.isReadableStream(new r("").body)),d={stream:u&&(p=>p.body)};o&&["text","arrayBuffer","blob","formData","stream"].forEach(p=>{!d[p]&&(d[p]=(m,g)=>{let _=m&&m[p];if(_)return _.call(m);throw new Ut(`Response type '${p}' is not supported`,Ut.ERR_NOT_SUPPORT,g)})});const f=async p=>{if(p==null)return 0;if(Le.isBlob(p))return p.size;if(Le.isSpecCompliantForm(p))return(await new t(no.origin,{method:"POST",body:p}).arrayBuffer()).byteLength;if(Le.isArrayBufferView(p)||Le.isArrayBuffer(p))return p.byteLength;if(Le.isURLSearchParams(p)&&(p=p+""),Le.isString(p))return(await l(p)).byteLength},h=async(p,m)=>{const g=Le.toFiniteNumber(p.getContentLength());return g??f(m)};return async p=>{let{url:m,method:g,data:_,signal:A,cancelToken:y,timeout:b,onDownloadProgress:E,onUploadProgress:x,responseType:w,headers:L,withCredentials:C="same-origin",fetchOptions:P}=tM(p),D=e||fetch;w=w?(w+"").toLowerCase():"text";let Q=nU([A,y&&y.toAbortSignal()],b),re=null;const G=Q&&Q.unsubscribe&&(()=>{Q.unsubscribe()});let se;try{if(x&&c&&g!=="get"&&g!=="head"&&(se=await h(L,_))!==0){let O=new t(m,{method:"POST",body:_,duplex:"half"}),W;if(Le.isFormData(_)&&(W=O.headers.get("content-type"))&&L.setContentType(W),O.body){const[ae,ne]=Kw(se,pm(Zw(x)));_=nM(O.body,rM,ae,ne)}}Le.isString(C)||(C=C?"include":"omit");const ee=i&&"credentials"in t.prototype,ie={...P,signal:Q,method:g.toUpperCase(),headers:L.normalize().toJSON(),body:_,duplex:"half",credentials:ee?C:void 0};re=i&&new t(m,ie);let H=await(i?D(re,P):D(m,ie));const T=u&&(w==="stream"||w==="response");if(u&&(E||T&&G)){const O={};["status","statusText","headers"].forEach(oe=>{O[oe]=H[oe]});const W=Le.toFiniteNumber(H.headers.get("content-length")),[ae,ne]=E&&Kw(W,pm(Zw(E),!0))||[];H=new r(nM(H.body,rM,ae,()=>{ne&&ne(),G&&G()}),O)}w=w||"text";let R=await d[Le.findKey(d,w)||"text"](H,p);return!T&&G&&G(),await new Promise((O,W)=>{qw(O,W,{data:R,headers:No.from(H.headers),status:H.status,statusText:H.statusText,config:p,request:re})})}catch(ee){throw G&&G(),ee&&ee.name==="TypeError"&&/Load failed|fetch/i.test(ee.message)?Object.assign(new Ut("Network Error",Ut.ERR_NETWORK,p,re),{cause:ee.cause||ee}):Ut.from(ee,ee&&ee.code,p,re)}}},lU=new Map,sM=n=>{let e=n&&n.env||{};const{fetch:t,Request:r,Response:o}=e,i=[r,o,t];let a=i.length,s=a,l,c,u=lU;for(;s--;)l=i[s],c=u.get(l),c===void 0&&u.set(l,c=s?new Map:sU(e)),u=c;return c};sM();const Wv={http:RV,xhr:tU,fetch:{get:sM}};Le.forEach(Wv,(n,e)=>{if(n){try{Object.defineProperty(n,"name",{value:e})}catch{}Object.defineProperty(n,"adapterName",{value:e})}});const lM=n=>`- ${n}`,cU=n=>Le.isFunction(n)||n===null||n===!1;function uU(n,e){n=Le.isArray(n)?n:[n];const{length:t}=n;let r,o;const i={};for(let a=0;a<t;a++){r=n[a];let s;if(o=r,!cU(r)&&(o=Wv[(s=String(r)).toLowerCase()],o===void 0))throw new Ut(`Unknown adapter '${s}'`);if(o&&(Le.isFunction(o)||(o=o.get(e))))break;i[s||"#"+a]=o}if(!o){const a=Object.entries(i).map(([l,c])=>`adapter ${l} `+(c===!1?"is not supported by the environment":"is not available in the build"));let s=t?a.length>1?`since :
`+a.map(lM).join(`
`):" "+lM(a[0]):"as no adapter specified";throw new Ut("There is no suitable adapter to dispatch the request "+s,"ERR_NOT_SUPPORT")}return o}const cM={getAdapter:uU,adapters:Wv};function jv(n){if(n.cancelToken&&n.cancelToken.throwIfRequested(),n.signal&&n.signal.aborted)throw new qc(null,n)}function uM(n){return jv(n),n.headers=No.from(n.headers),n.data=Hv.call(n,n.transformRequest),["post","put","patch"].indexOf(n.method)!==-1&&n.headers.setContentType("application/x-www-form-urlencoded",!1),cM.getAdapter(n.adapter||vf.adapter,n)(n).then(function(r){return jv(n),r.data=Hv.call(n,n.transformResponse,r),r.headers=No.from(r.headers),r},function(r){return Xw(r)||(jv(n),r&&r.response&&(r.response.data=Hv.call(n,n.transformResponse,r.response),r.response.headers=No.from(r.response.headers))),Promise.reject(r)})}const dM="1.13.2",gm={};["object","boolean","number","function","string","symbol"].forEach((n,e)=>{gm[n]=function(r){return typeof r===n||"a"+(e<1?"n ":" ")+n}});const fM={};gm.transitional=function(e,t,r){function o(i,a){return"[Axios v"+dM+"] Transitional option '"+i+"'"+a+(r?". "+r:"")}return(i,a,s)=>{if(e===!1)throw new Ut(o(a," has been removed"+(t?" in "+t:"")),Ut.ERR_DEPRECATED);return t&&!fM[a]&&(fM[a]=!0,console.warn(o(a," has been deprecated since v"+t+" and will be removed in the near future"))),e?e(i,a,s):!0}},gm.spelling=function(e){return(t,r)=>(console.warn(`${r} is likely a misspelling of ${e}`),!0)};function dU(n,e,t){if(typeof n!="object")throw new Ut("options must be an object",Ut.ERR_BAD_OPTION_VALUE);const r=Object.keys(n);let o=r.length;for(;o-- >0;){const i=r[o],a=e[i];if(a){const s=n[i],l=s===void 0||a(s,i,n);if(l!==!0)throw new Ut("option "+i+" must be "+l,Ut.ERR_BAD_OPTION_VALUE);continue}if(t!==!0)throw new Ut("Unknown option "+i,Ut.ERR_BAD_OPTION)}}const _m={assertOptions:dU,validators:gm},ma=_m.validators;let Vl=class{constructor(e){this.defaults=e||{},this.interceptors={request:new jw,response:new jw}}async request(e,t){try{return await this._request(e,t)}catch(r){if(r instanceof Error){let o={};Error.captureStackTrace?Error.captureStackTrace(o):o=new Error;const i=o.stack?o.stack.replace(/^.+\n/,""):"";try{r.stack?i&&!String(r.stack).endsWith(i.replace(/^.+\n.+\n/,""))&&(r.stack+=`
`+i):r.stack=i}catch{}}throw r}}_request(e,t){typeof e=="string"?(t=t||{},t.url=e):t=e||{},t=Fl(this.defaults,t);const{transitional:r,paramsSerializer:o,headers:i}=t;r!==void 0&&_m.assertOptions(r,{silentJSONParsing:ma.transitional(ma.boolean),forcedJSONParsing:ma.transitional(ma.boolean),clarifyTimeoutError:ma.transitional(ma.boolean)},!1),o!=null&&(Le.isFunction(o)?t.paramsSerializer={serialize:o}:_m.assertOptions(o,{encode:ma.function,serialize:ma.function},!0)),t.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:t.allowAbsoluteUrls=!0),_m.assertOptions(t,{baseUrl:ma.spelling("baseURL"),withXsrfToken:ma.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let a=i&&Le.merge(i.common,i[t.method]);i&&Le.forEach(["delete","get","head","post","put","patch","common"],p=>{delete i[p]}),t.headers=No.concat(a,i);const s=[];let l=!0;this.interceptors.request.forEach(function(m){typeof m.runWhen=="function"&&m.runWhen(t)===!1||(l=l&&m.synchronous,s.unshift(m.fulfilled,m.rejected))});const c=[];this.interceptors.response.forEach(function(m){c.push(m.fulfilled,m.rejected)});let u,d=0,f;if(!l){const p=[uM.bind(this),void 0];for(p.unshift(...s),p.push(...c),f=p.length,u=Promise.resolve(t);d<f;)u=u.then(p[d++],p[d++]);return u}f=s.length;let h=t;for(;d<f;){const p=s[d++],m=s[d++];try{h=p(h)}catch(g){m.call(this,g);break}}try{u=uM.call(this,h)}catch(p){return Promise.reject(p)}for(d=0,f=c.length;d<f;)u=u.then(c[d++],c[d++]);return u}getUri(e){e=Fl(this.defaults,e);const t=Jw(e.baseURL,e.url,e.allowAbsoluteUrls);return Ww(t,e.params,e.paramsSerializer)}};Le.forEach(["delete","get","head","options"],function(e){Vl.prototype[e]=function(t,r){return this.request(Fl(r||{},{method:e,url:t,data:(r||{}).data}))}}),Le.forEach(["post","put","patch"],function(e){function t(r){return function(i,a,s){return this.request(Fl(s||{},{method:e,headers:r?{"Content-Type":"multipart/form-data"}:{},url:i,data:a}))}}Vl.prototype[e]=t(),Vl.prototype[e+"Form"]=t(!0)});let fU=class xN{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let t;this.promise=new Promise(function(i){t=i});const r=this;this.promise.then(o=>{if(!r._listeners)return;let i=r._listeners.length;for(;i-- >0;)r._listeners[i](o);r._listeners=null}),this.promise.then=o=>{let i;const a=new Promise(s=>{r.subscribe(s),i=s}).then(o);return a.cancel=function(){r.unsubscribe(i)},a},e(function(i,a,s){r.reason||(r.reason=new qc(i,a,s),t(r.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);t!==-1&&this._listeners.splice(t,1)}toAbortSignal(){const e=new AbortController,t=r=>{e.abort(r)};return this.subscribe(t),e.signal.unsubscribe=()=>this.unsubscribe(t),e.signal}static source(){let e;return{token:new xN(function(o){e=o}),cancel:e}}};function hU(n){return function(t){return n.apply(null,t)}}function pU(n){return Le.isObject(n)&&n.isAxiosError===!0}const Qv={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511,WebServerIsDown:521,ConnectionTimedOut:522,OriginIsUnreachable:523,TimeoutOccurred:524,SslHandshakeFailed:525,InvalidSslCertificate:526};Object.entries(Qv).forEach(([n,e])=>{Qv[e]=n});function hM(n){const e=new Vl(n),t=Iw(Vl.prototype.request,e);return Le.extend(t,Vl.prototype,e,{allOwnKeys:!0}),Le.extend(t,e,null,{allOwnKeys:!0}),t.create=function(o){return hM(Fl(n,o))},t}const Gt=hM(vf);Gt.Axios=Vl,Gt.CanceledError=qc,Gt.CancelToken=fU,Gt.isCancel=Xw,Gt.VERSION=dM,Gt.toFormData=fm,Gt.AxiosError=Ut,Gt.Cancel=Gt.CanceledError,Gt.all=function(e){return Promise.all(e)},Gt.spread=hU,Gt.isAxiosError=pU,Gt.mergeConfig=Fl,Gt.AxiosHeaders=No,Gt.formToJSON=n=>$w(Le.isHTMLForm(n)?new FormData(n):n),Gt.getAdapter=cM.getAdapter,Gt.HttpStatusCode=Qv,Gt.default=Gt;const{Axios:uEe,AxiosError:dEe,CanceledError:fEe,isCancel:hEe,CancelToken:pEe,VERSION:mEe,all:gEe,Cancel:_Ee,isAxiosError:vEe,spread:AEe,toFormData:yEe,AxiosHeaders:bEe,HttpStatusCode:xEe,formToJSON:EEe,getAdapter:CEe,mergeConfig:SEe}=Gt;let vm;const mU=new Uint8Array(16);function gU(){if(!vm&&(vm=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!vm))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return vm(mU)}const Hr=[];for(let n=0;n<256;++n)Hr.push((n+256).toString(16).slice(1));function _U(n,e=0){return Hr[n[e+0]]+Hr[n[e+1]]+Hr[n[e+2]]+Hr[n[e+3]]+"-"+Hr[n[e+4]]+Hr[n[e+5]]+"-"+Hr[n[e+6]]+Hr[n[e+7]]+"-"+Hr[n[e+8]]+Hr[n[e+9]]+"-"+Hr[n[e+10]]+Hr[n[e+11]]+Hr[n[e+12]]+Hr[n[e+13]]+Hr[n[e+14]]+Hr[n[e+15]]}const pM={randomUUID:typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function vU(n,e,t){if(pM.randomUUID&&!n)return pM.randomUUID();n=n||{};const r=n.random||(n.rng||gU)();return r[6]=r[6]&15|64,r[8]=r[8]&63|128,_U(r)}var Am={exports:{}},ym={exports:{}},bm={exports:{}},AU=bm.exports,mM;function $v(){return mM||(mM=1,(function(n,e){(function(t,r){n.exports=r()})(AU,function(){function t(m){return!isNaN(parseFloat(m))&&isFinite(m)}function r(m){return m.charAt(0).toUpperCase()+m.substring(1)}function o(m){return function(){return this[m]}}var i=["isConstructor","isEval","isNative","isToplevel"],a=["columnNumber","lineNumber"],s=["fileName","functionName","source"],l=["args"],c=["evalOrigin"],u=i.concat(a,s,l,c);function d(m){if(m)for(var g=0;g<u.length;g++)m[u[g]]!==void 0&&this["set"+r(u[g])](m[u[g]])}d.prototype={getArgs:function(){return this.args},setArgs:function(m){if(Object.prototype.toString.call(m)!=="[object Array]")throw new TypeError("Args must be an Array");this.args=m},getEvalOrigin:function(){return this.evalOrigin},setEvalOrigin:function(m){if(m instanceof d)this.evalOrigin=m;else if(m instanceof Object)this.evalOrigin=new d(m);else throw new TypeError("Eval Origin must be an Object or StackFrame")},toString:function(){var m=this.getFileName()||"",g=this.getLineNumber()||"",_=this.getColumnNumber()||"",A=this.getFunctionName()||"";return this.getIsEval()?m?"[eval] ("+m+":"+g+":"+_+")":"[eval]:"+g+":"+_:A?A+" ("+m+":"+g+":"+_+")":m+":"+g+":"+_}},d.fromString=function(g){var _=g.indexOf("("),A=g.lastIndexOf(")"),y=g.substring(0,_),b=g.substring(_+1,A).split(","),E=g.substring(A+1);if(E.indexOf("@")===0)var x=/@(.+?)(?::(\d+))?(?::(\d+))?$/.exec(E,""),w=x[1],L=x[2],C=x[3];return new d({functionName:y,args:b||void 0,fileName:w,lineNumber:L||void 0,columnNumber:C||void 0})};for(var f=0;f<i.length;f++)d.prototype["get"+r(i[f])]=o(i[f]),d.prototype["set"+r(i[f])]=(function(m){return function(g){this[m]=!!g}})(i[f]);for(var h=0;h<a.length;h++)d.prototype["get"+r(a[h])]=o(a[h]),d.prototype["set"+r(a[h])]=(function(m){return function(g){if(!t(g))throw new TypeError(m+" must be a Number");this[m]=Number(g)}})(a[h]);for(var p=0;p<s.length;p++)d.prototype["get"+r(s[p])]=o(s[p]),d.prototype["set"+r(s[p])]=(function(m){return function(g){this[m]=String(g)}})(s[p]);return d})})(bm)),bm.exports}var yU=ym.exports,gM;function bU(){return gM||(gM=1,(function(n,e){(function(t,r){n.exports=r($v())})(yU,function(r){var o=/(^|@)\S+:\d+/,i=/^\s*at .*(\S+:\d+|\(native\))/m,a=/^(eval@)?(\[native code])?$/;return{parse:function(l){if(typeof l.stacktrace<"u"||typeof l["opera#sourceloc"]<"u")return this.parseOpera(l);if(l.stack&&l.stack.match(i))return this.parseV8OrIE(l);if(l.stack)return this.parseFFOrSafari(l);throw new Error("Cannot parse given Error object")},extractLocation:function(l){if(l.indexOf(":")===-1)return[l];var c=/(.+?)(?::(\d+))?(?::(\d+))?$/,u=c.exec(l.replace(/[()]/g,""));return[u[1],u[2]||void 0,u[3]||void 0]},parseV8OrIE:function(l){var c=l.stack.split(`
`).filter(function(u){return!!u.match(i)},this);return c.map(function(u){u.indexOf("(eval ")>-1&&(u=u.replace(/eval code/g,"eval").replace(/(\(eval at [^()]*)|(,.*$)/g,""));var d=u.replace(/^\s+/,"").replace(/\(eval code/g,"(").replace(/^.*?\s+/,""),f=d.match(/ (\(.+\)$)/);d=f?d.replace(f[0],""):d;var h=this.extractLocation(f?f[1]:d),p=f&&d||void 0,m=["eval","<anonymous>"].indexOf(h[0])>-1?void 0:h[0];return new r({functionName:p,fileName:m,lineNumber:h[1],columnNumber:h[2],source:u})},this)},parseFFOrSafari:function(l){var c=l.stack.split(`
`).filter(function(u){return!u.match(a)},this);return c.map(function(u){if(u.indexOf(" > eval")>-1&&(u=u.replace(/ line (\d+)(?: > eval line \d+)* > eval:\d+:\d+/g,":$1")),u.indexOf("@")===-1&&u.indexOf(":")===-1)return new r({functionName:u});var d=/((.*".+"[^@]*)?[^@]*)(?:@)/,f=u.match(d),h=f&&f[1]?f[1]:void 0,p=this.extractLocation(u.replace(d,""));return new r({functionName:h,fileName:p[0],lineNumber:p[1],columnNumber:p[2],source:u})},this)},parseOpera:function(l){return!l.stacktrace||l.message.indexOf(`
`)>-1&&l.message.split(`
`).length>l.stacktrace.split(`
`).length?this.parseOpera9(l):l.stack?this.parseOpera11(l):this.parseOpera10(l)},parseOpera9:function(l){for(var c=/Line (\d+).*script (?:in )?(\S+)/i,u=l.message.split(`
`),d=[],f=2,h=u.length;f<h;f+=2){var p=c.exec(u[f]);p&&d.push(new r({fileName:p[2],lineNumber:p[1],source:u[f]}))}return d},parseOpera10:function(l){for(var c=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,u=l.stacktrace.split(`
`),d=[],f=0,h=u.length;f<h;f+=2){var p=c.exec(u[f]);p&&d.push(new r({functionName:p[3]||void 0,fileName:p[2],lineNumber:p[1],source:u[f]}))}return d},parseOpera11:function(l){var c=l.stack.split(`
`).filter(function(u){return!!u.match(o)&&!u.match(/^Error created at/)},this);return c.map(function(u){var d=u.split("@"),f=this.extractLocation(d.pop()),h=d.shift()||"",p=h.replace(/<anonymous function(: (\w+))?>/,"$2").replace(/\([^)]*\)/g,"")||void 0,m;h.match(/\(([^)]*)\)/)&&(m=h.replace(/^[^(]+\(([^)]*)\)$/,"$1"));var g=m===void 0||m==="[arguments not available]"?void 0:m.split(",");return new r({functionName:p,args:g,fileName:f[0],lineNumber:f[1],columnNumber:f[2],source:u})},this)}}})})(ym)),ym.exports}var xm={exports:{}},xU=xm.exports,_M;function EU(){return _M||(_M=1,(function(n,e){(function(t,r){n.exports=r($v())})(xU,function(t){return{backtrace:function(o){var i=[],a=10;typeof o=="object"&&typeof o.maxStackSize=="number"&&(a=o.maxStackSize);for(var s=arguments.callee;s&&i.length<a&&s.arguments;){for(var l=new Array(s.arguments.length),c=0;c<l.length;++c)l[c]=s.arguments[c];/function(?:\s+([\w$]+))+\s*\(/.test(s.toString())?i.push(new t({functionName:RegExp.$1||void 0,args:l})):i.push(new t({args:l}));try{s=s.caller}catch{break}}return i}}})})(xm)),xm.exports}var Em={exports:{}},yf={},Yv={},vM;function AM(){return vM||(vM=1,(function(n){function e(A,y,b){if(y in A)return A[y];if(arguments.length===3)return b;throw new Error('"'+y+'" is a required argument.')}n.getArg=e;var t=/^(?:([\w+\-.]+):)?\/\/(?:(\w+:\w+)@)?([\w.]*)(?::(\d+))?(\S*)$/,r=/^data:.+\,.+$/;function o(A){var y=A.match(t);return y?{scheme:y[1],auth:y[2],host:y[3],port:y[4],path:y[5]}:null}n.urlParse=o;function i(A){var y="";return A.scheme&&(y+=A.scheme+":"),y+="//",A.auth&&(y+=A.auth+"@"),A.host&&(y+=A.host),A.port&&(y+=":"+A.port),A.path&&(y+=A.path),y}n.urlGenerate=i;function a(A){var y=A,b=o(A);if(b){if(!b.path)return A;y=b.path}for(var E=n.isAbsolute(y),x=y.split(/\/+/),w,L=0,C=x.length-1;C>=0;C--)w=x[C],w==="."?x.splice(C,1):w===".."?L++:L>0&&(w===""?(x.splice(C+1,L),L=0):(x.splice(C,2),L--));return y=x.join("/"),y===""&&(y=E?"/":"."),b?(b.path=y,i(b)):y}n.normalize=a;function s(A,y){A===""&&(A="."),y===""&&(y=".");var b=o(y),E=o(A);if(E&&(A=E.path||"/"),b&&!b.scheme)return E&&(b.scheme=E.scheme),i(b);if(b||y.match(r))return y;if(E&&!E.host&&!E.path)return E.host=y,i(E);var x=y.charAt(0)==="/"?y:a(A.replace(/\/+$/,"")+"/"+y);return E?(E.path=x,i(E)):x}n.join=s,n.isAbsolute=function(A){return A.charAt(0)==="/"||!!A.match(t)};function l(A,y){A===""&&(A="."),A=A.replace(/\/$/,"");for(var b=0;y.indexOf(A+"/")!==0;){var E=A.lastIndexOf("/");if(E<0||(A=A.slice(0,E),A.match(/^([^\/]+:\/)?\/*$/)))return y;++b}return Array(b+1).join("../")+y.substr(A.length+1)}n.relative=l;var c=(function(){var A=Object.create(null);return!("__proto__"in A)})();function u(A){return A}function d(A){return h(A)?"$"+A:A}n.toSetString=c?u:d;function f(A){return h(A)?A.slice(1):A}n.fromSetString=c?u:f;function h(A){if(!A)return!1;var y=A.length;if(y<9||A.charCodeAt(y-1)!==95||A.charCodeAt(y-2)!==95||A.charCodeAt(y-3)!==111||A.charCodeAt(y-4)!==116||A.charCodeAt(y-5)!==111||A.charCodeAt(y-6)!==114||A.charCodeAt(y-7)!==112||A.charCodeAt(y-8)!==95||A.charCodeAt(y-9)!==95)return!1;for(var b=y-10;b>=0;b--)if(A.charCodeAt(b)!==36)return!1;return!0}function p(A,y,b){var E=A.source-y.source;return E!==0||(E=A.originalLine-y.originalLine,E!==0)||(E=A.originalColumn-y.originalColumn,E!==0||b)||(E=A.generatedColumn-y.generatedColumn,E!==0)||(E=A.generatedLine-y.generatedLine,E!==0)?E:A.name-y.name}n.compareByOriginalPositions=p;function m(A,y,b){var E=A.generatedLine-y.generatedLine;return E!==0||(E=A.generatedColumn-y.generatedColumn,E!==0||b)||(E=A.source-y.source,E!==0)||(E=A.originalLine-y.originalLine,E!==0)||(E=A.originalColumn-y.originalColumn,E!==0)?E:A.name-y.name}n.compareByGeneratedPositionsDeflated=m;function g(A,y){return A===y?0:A>y?1:-1}function _(A,y){var b=A.generatedLine-y.generatedLine;return b!==0||(b=A.generatedColumn-y.generatedColumn,b!==0)||(b=g(A.source,y.source),b!==0)||(b=A.originalLine-y.originalLine,b!==0)||(b=A.originalColumn-y.originalColumn,b!==0)?b:g(A.name,y.name)}n.compareByGeneratedPositionsInflated=_})(Yv)),Yv}var Xv={},yM;function CU(){return yM||(yM=1,(function(n){n.GREATEST_LOWER_BOUND=1,n.LEAST_UPPER_BOUND=2;function e(t,r,o,i,a,s){var l=Math.floor((r-t)/2)+t,c=a(o,i[l],!0);return c===0?l:c>0?r-l>1?e(l,r,o,i,a,s):s==n.LEAST_UPPER_BOUND?r<i.length?r:-1:l:l-t>1?e(t,l,o,i,a,s):s==n.LEAST_UPPER_BOUND?l:t<0?-1:t}n.search=function(r,o,i,a){if(o.length===0)return-1;var s=e(-1,o.length,r,o,i,a||n.GREATEST_LOWER_BOUND);if(s<0)return-1;for(;s-1>=0&&i(o[s],o[s-1],!0)===0;)--s;return s}})(Xv)),Xv}var qv={},bM;function SU(){if(bM)return qv;bM=1;var n=AM(),e=Object.prototype.hasOwnProperty;function t(){this._array=[],this._set=Object.create(null)}return t.fromArray=function(o,i){for(var a=new t,s=0,l=o.length;s<l;s++)a.add(o[s],i);return a},t.prototype.size=function(){return Object.getOwnPropertyNames(this._set).length},t.prototype.add=function(o,i){var a=n.toSetString(o),s=e.call(this._set,a),l=this._array.length;(!s||i)&&this._array.push(o),s||(this._set[a]=l)},t.prototype.has=function(o){var i=n.toSetString(o);return e.call(this._set,i)},t.prototype.indexOf=function(o){var i=n.toSetString(o);if(e.call(this._set,i))return this._set[i];throw new Error('"'+o+'" is not in the set.')},t.prototype.at=function(o){if(o>=0&&o<this._array.length)return this._array[o];throw new Error("No element indexed by "+o)},t.prototype.toArray=function(){return this._array.slice()},qv.ArraySet=t,qv}var Cm={},Sm={},xM;function wU(){if(xM)return Sm;xM=1;var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("");return Sm.encode=function(e){if(0<=e&&e<n.length)return n[e];throw new TypeError("Must be between 0 and 63: "+e)},Sm.decode=function(e){var t=65,r=90,o=97,i=122,a=48,s=57,l=43,c=47,u=26,d=52;return t<=e&&e<=r?e-t:o<=e&&e<=i?e-o+u:a<=e&&e<=s?e-a+d:e==l?62:e==c?63:-1},Sm}var EM;function MU(){if(EM)return Cm;EM=1;var n=wU(),e=5,t=1<<e,r=t-1,o=t;function i(s){return s<0?(-s<<1)+1:(s<<1)+0}function a(s){var l=(s&1)===1,c=s>>1;return l?-c:c}return Cm.encode=function(l){var c="",u,d=i(l);do u=d&r,d>>>=e,d>0&&(u|=o),c+=n.encode(u);while(d>0);return c},Cm.decode=function(l,c,u){var d=l.length,f=0,h=0,p,m;do{if(c>=d)throw new Error("Expected more digits in base 64 VLQ value.");if(m=n.decode(l.charCodeAt(c++)),m===-1)throw new Error("Invalid base64 digit: "+l.charAt(c-1));p=!!(m&o),m&=r,f=f+(m<<h),h+=e}while(p);u.value=a(f),u.rest=c},Cm}var Kv={},CM;function TU(){if(CM)return Kv;CM=1;function n(r,o,i){var a=r[o];r[o]=r[i],r[i]=a}function e(r,o){return Math.round(r+Math.random()*(o-r))}function t(r,o,i,a){if(i<a){var s=e(i,a),l=i-1;n(r,s,a);for(var c=r[a],u=i;u<a;u++)o(r[u],c)<=0&&(l+=1,n(r,l,u));n(r,l+1,u);var d=l+1;t(r,o,i,d-1),t(r,o,d+1,a)}}return Kv.quickSort=function(r,o){t(r,o,0,r.length-1)},Kv}var SM;function IU(){if(SM)return yf;SM=1;var n=AM(),e=CU(),t=SU().ArraySet,r=MU(),o=TU().quickSort;function i(c){var u=c;return typeof c=="string"&&(u=JSON.parse(c.replace(/^\)\]\}'/,""))),u.sections!=null?new l(u):new a(u)}i.fromSourceMap=function(c){return a.fromSourceMap(c)},i.prototype._version=3,i.prototype.__generatedMappings=null,Object.defineProperty(i.prototype,"_generatedMappings",{get:function(){return this.__generatedMappings||this._parseMappings(this._mappings,this.sourceRoot),this.__generatedMappings}}),i.prototype.__originalMappings=null,Object.defineProperty(i.prototype,"_originalMappings",{get:function(){return this.__originalMappings||this._parseMappings(this._mappings,this.sourceRoot),this.__originalMappings}}),i.prototype._charIsMappingSeparator=function(u,d){var f=u.charAt(d);return f===";"||f===","},i.prototype._parseMappings=function(u,d){throw new Error("Subclasses must implement _parseMappings")},i.GENERATED_ORDER=1,i.ORIGINAL_ORDER=2,i.GREATEST_LOWER_BOUND=1,i.LEAST_UPPER_BOUND=2,i.prototype.eachMapping=function(u,d,f){var h=d||null,p=f||i.GENERATED_ORDER,m;switch(p){case i.GENERATED_ORDER:m=this._generatedMappings;break;case i.ORIGINAL_ORDER:m=this._originalMappings;break;default:throw new Error("Unknown order of iteration.")}var g=this.sourceRoot;m.map(function(_){var A=_.source===null?null:this._sources.at(_.source);return A!=null&&g!=null&&(A=n.join(g,A)),{source:A,generatedLine:_.generatedLine,generatedColumn:_.generatedColumn,originalLine:_.originalLine,originalColumn:_.originalColumn,name:_.name===null?null:this._names.at(_.name)}},this).forEach(u,h)},i.prototype.allGeneratedPositionsFor=function(u){var d=n.getArg(u,"line"),f={source:n.getArg(u,"source"),originalLine:d,originalColumn:n.getArg(u,"column",0)};if(this.sourceRoot!=null&&(f.source=n.relative(this.sourceRoot,f.source)),!this._sources.has(f.source))return[];f.source=this._sources.indexOf(f.source);var h=[],p=this._findMapping(f,this._originalMappings,"originalLine","originalColumn",n.compareByOriginalPositions,e.LEAST_UPPER_BOUND);if(p>=0){var m=this._originalMappings[p];if(u.column===void 0)for(var g=m.originalLine;m&&m.originalLine===g;)h.push({line:n.getArg(m,"generatedLine",null),column:n.getArg(m,"generatedColumn",null),lastColumn:n.getArg(m,"lastGeneratedColumn",null)}),m=this._originalMappings[++p];else for(var _=m.originalColumn;m&&m.originalLine===d&&m.originalColumn==_;)h.push({line:n.getArg(m,"generatedLine",null),column:n.getArg(m,"generatedColumn",null),lastColumn:n.getArg(m,"lastGeneratedColumn",null)}),m=this._originalMappings[++p]}return h},yf.SourceMapConsumer=i;function a(c){var u=c;typeof c=="string"&&(u=JSON.parse(c.replace(/^\)\]\}'/,"")));var d=n.getArg(u,"version"),f=n.getArg(u,"sources"),h=n.getArg(u,"names",[]),p=n.getArg(u,"sourceRoot",null),m=n.getArg(u,"sourcesContent",null),g=n.getArg(u,"mappings"),_=n.getArg(u,"file",null);if(d!=this._version)throw new Error("Unsupported version: "+d);f=f.map(String).map(n.normalize).map(function(A){return p&&n.isAbsolute(p)&&n.isAbsolute(A)?n.relative(p,A):A}),this._names=t.fromArray(h.map(String),!0),this._sources=t.fromArray(f,!0),this.sourceRoot=p,this.sourcesContent=m,this._mappings=g,this.file=_}a.prototype=Object.create(i.prototype),a.prototype.consumer=i,a.fromSourceMap=function(u){var d=Object.create(a.prototype),f=d._names=t.fromArray(u._names.toArray(),!0),h=d._sources=t.fromArray(u._sources.toArray(),!0);d.sourceRoot=u._sourceRoot,d.sourcesContent=u._generateSourcesContent(d._sources.toArray(),d.sourceRoot),d.file=u._file;for(var p=u._mappings.toArray().slice(),m=d.__generatedMappings=[],g=d.__originalMappings=[],_=0,A=p.length;_<A;_++){var y=p[_],b=new s;b.generatedLine=y.generatedLine,b.generatedColumn=y.generatedColumn,y.source&&(b.source=h.indexOf(y.source),b.originalLine=y.originalLine,b.originalColumn=y.originalColumn,y.name&&(b.name=f.indexOf(y.name)),g.push(b)),m.push(b)}return o(d.__originalMappings,n.compareByOriginalPositions),d},a.prototype._version=3,Object.defineProperty(a.prototype,"sources",{get:function(){return this._sources.toArray().map(function(c){return this.sourceRoot!=null?n.join(this.sourceRoot,c):c},this)}});function s(){this.generatedLine=0,this.generatedColumn=0,this.source=null,this.originalLine=null,this.originalColumn=null,this.name=null}a.prototype._parseMappings=function(u,d){for(var f=1,h=0,p=0,m=0,g=0,_=0,A=u.length,y=0,b={},E={},x=[],w=[],L,C,P,D,Q;y<A;)if(u.charAt(y)===";")f++,y++,h=0;else if(u.charAt(y)===",")y++;else{for(L=new s,L.generatedLine=f,D=y;D<A&&!this._charIsMappingSeparator(u,D);D++);if(C=u.slice(y,D),P=b[C],P)y+=C.length;else{for(P=[];y<D;)r.decode(u,y,E),Q=E.value,y=E.rest,P.push(Q);if(P.length===2)throw new Error("Found a source, but no line and column");if(P.length===3)throw new Error("Found a source and line, but no column");b[C]=P}L.generatedColumn=h+P[0],h=L.generatedColumn,P.length>1&&(L.source=g+P[1],g+=P[1],L.originalLine=p+P[2],p=L.originalLine,L.originalLine+=1,L.originalColumn=m+P[3],m=L.originalColumn,P.length>4&&(L.name=_+P[4],_+=P[4])),w.push(L),typeof L.originalLine=="number"&&x.push(L)}o(w,n.compareByGeneratedPositionsDeflated),this.__generatedMappings=w,o(x,n.compareByOriginalPositions),this.__originalMappings=x},a.prototype._findMapping=function(u,d,f,h,p,m){if(u[f]<=0)throw new TypeError("Line must be greater than or equal to 1, got "+u[f]);if(u[h]<0)throw new TypeError("Column must be greater than or equal to 0, got "+u[h]);return e.search(u,d,p,m)},a.prototype.computeColumnSpans=function(){for(var u=0;u<this._generatedMappings.length;++u){var d=this._generatedMappings[u];if(u+1<this._generatedMappings.length){var f=this._generatedMappings[u+1];if(d.generatedLine===f.generatedLine){d.lastGeneratedColumn=f.generatedColumn-1;continue}}d.lastGeneratedColumn=1/0}},a.prototype.originalPositionFor=function(u){var d={generatedLine:n.getArg(u,"line"),generatedColumn:n.getArg(u,"column")},f=this._findMapping(d,this._generatedMappings,"generatedLine","generatedColumn",n.compareByGeneratedPositionsDeflated,n.getArg(u,"bias",i.GREATEST_LOWER_BOUND));if(f>=0){var h=this._generatedMappings[f];if(h.generatedLine===d.generatedLine){var p=n.getArg(h,"source",null);p!==null&&(p=this._sources.at(p),this.sourceRoot!=null&&(p=n.join(this.sourceRoot,p)));var m=n.getArg(h,"name",null);return m!==null&&(m=this._names.at(m)),{source:p,line:n.getArg(h,"originalLine",null),column:n.getArg(h,"originalColumn",null),name:m}}}return{source:null,line:null,column:null,name:null}},a.prototype.hasContentsOfAllSources=function(){return this.sourcesContent?this.sourcesContent.length>=this._sources.size()&&!this.sourcesContent.some(function(u){return u==null}):!1},a.prototype.sourceContentFor=function(u,d){if(!this.sourcesContent)return null;if(this.sourceRoot!=null&&(u=n.relative(this.sourceRoot,u)),this._sources.has(u))return this.sourcesContent[this._sources.indexOf(u)];var f;if(this.sourceRoot!=null&&(f=n.urlParse(this.sourceRoot))){var h=u.replace(/^file:\/\//,"");if(f.scheme=="file"&&this._sources.has(h))return this.sourcesContent[this._sources.indexOf(h)];if((!f.path||f.path=="/")&&this._sources.has("/"+u))return this.sourcesContent[this._sources.indexOf("/"+u)]}if(d)return null;throw new Error('"'+u+'" is not in the SourceMap.')},a.prototype.generatedPositionFor=function(u){var d=n.getArg(u,"source");if(this.sourceRoot!=null&&(d=n.relative(this.sourceRoot,d)),!this._sources.has(d))return{line:null,column:null,lastColumn:null};d=this._sources.indexOf(d);var f={source:d,originalLine:n.getArg(u,"line"),originalColumn:n.getArg(u,"column")},h=this._findMapping(f,this._originalMappings,"originalLine","originalColumn",n.compareByOriginalPositions,n.getArg(u,"bias",i.GREATEST_LOWER_BOUND));if(h>=0){var p=this._originalMappings[h];if(p.source===f.source)return{line:n.getArg(p,"generatedLine",null),column:n.getArg(p,"generatedColumn",null),lastColumn:n.getArg(p,"lastGeneratedColumn",null)}}return{line:null,column:null,lastColumn:null}},yf.BasicSourceMapConsumer=a;function l(c){var u=c;typeof c=="string"&&(u=JSON.parse(c.replace(/^\)\]\}'/,"")));var d=n.getArg(u,"version"),f=n.getArg(u,"sections");if(d!=this._version)throw new Error("Unsupported version: "+d);this._sources=new t,this._names=new t;var h={line:-1,column:0};this._sections=f.map(function(p){if(p.url)throw new Error("Support for url field in sections not implemented.");var m=n.getArg(p,"offset"),g=n.getArg(m,"line"),_=n.getArg(m,"column");if(g<h.line||g===h.line&&_<h.column)throw new Error("Section offsets must be ordered and non-overlapping.");return h=m,{generatedOffset:{generatedLine:g+1,generatedColumn:_+1},consumer:new i(n.getArg(p,"map"))}})}return l.prototype=Object.create(i.prototype),l.prototype.constructor=i,l.prototype._version=3,Object.defineProperty(l.prototype,"sources",{get:function(){for(var c=[],u=0;u<this._sections.length;u++)for(var d=0;d<this._sections[u].consumer.sources.length;d++)c.push(this._sections[u].consumer.sources[d]);return c}}),l.prototype.originalPositionFor=function(u){var d={generatedLine:n.getArg(u,"line"),generatedColumn:n.getArg(u,"column")},f=e.search(d,this._sections,function(p,m){var g=p.generatedLine-m.generatedOffset.generatedLine;return g||p.generatedColumn-m.generatedOffset.generatedColumn}),h=this._sections[f];return h?h.consumer.originalPositionFor({line:d.generatedLine-(h.generatedOffset.generatedLine-1),column:d.generatedColumn-(h.generatedOffset.generatedLine===d.generatedLine?h.generatedOffset.generatedColumn-1:0),bias:u.bias}):{source:null,line:null,column:null,name:null}},l.prototype.hasContentsOfAllSources=function(){return this._sections.every(function(u){return u.consumer.hasContentsOfAllSources()})},l.prototype.sourceContentFor=function(u,d){for(var f=0;f<this._sections.length;f++){var h=this._sections[f],p=h.consumer.sourceContentFor(u,!0);if(p)return p}if(d)return null;throw new Error('"'+u+'" is not in the SourceMap.')},l.prototype.generatedPositionFor=function(u){for(var d=0;d<this._sections.length;d++){var f=this._sections[d];if(f.consumer.sources.indexOf(n.getArg(u,"source"))!==-1){var h=f.consumer.generatedPositionFor(u);if(h){var p={line:h.line+(f.generatedOffset.generatedLine-1),column:h.column+(f.generatedOffset.generatedLine===h.line?f.generatedOffset.generatedColumn-1:0)};return p}}}return{line:null,column:null}},l.prototype._parseMappings=function(u,d){this.__generatedMappings=[],this.__originalMappings=[];for(var f=0;f<this._sections.length;f++)for(var h=this._sections[f],p=h.consumer._generatedMappings,m=0;m<p.length;m++){var g=p[m],_=h.consumer._sources.at(g.source);h.consumer.sourceRoot!==null&&(_=n.join(h.consumer.sourceRoot,_)),this._sources.add(_),_=this._sources.indexOf(_);var A=h.consumer._names.at(g.name);this._names.add(A),A=this._names.indexOf(A);var y={source:_,generatedLine:g.generatedLine+(h.generatedOffset.generatedLine-1),generatedColumn:g.generatedColumn+(h.generatedOffset.generatedLine===g.generatedLine?h.generatedOffset.generatedColumn-1:0),originalLine:g.originalLine,originalColumn:g.originalColumn,name:A};this.__generatedMappings.push(y),typeof y.originalLine=="number"&&this.__originalMappings.push(y)}o(this.__generatedMappings,n.compareByGeneratedPositionsDeflated),o(this.__originalMappings,n.compareByOriginalPositions)},yf.IndexedSourceMapConsumer=l,yf}var RU=Em.exports,wM;function LU(){return wM||(wM=1,(function(n,e){(function(t,r){n.exports=r(IU(),$v())})(RU,function(t,r){function o(f){return new Promise(function(h,p){var m=new XMLHttpRequest;m.open("get",f),m.onerror=p,m.onreadystatechange=function(){m.readyState===4&&(m.status>=200&&m.status<300||f.substr(0,7)==="file://"&&m.responseText?h(m.responseText):p(new Error("HTTP status: "+m.status+" retrieving "+f)))},m.send()})}function i(f){if(typeof window<"u"&&window.atob)return window.atob(f);throw new Error("You must supply a polyfill for window.atob in this environment")}function a(f){if(typeof JSON<"u"&&JSON.parse)return JSON.parse(f);throw new Error("You must supply a polyfill for JSON.parse in this environment")}function s(f,h){for(var p=[/['"]?([$_A-Za-z][$_A-Za-z0-9]*)['"]?\s*[:=]\s*function\b/,/function\s+([^('"`]*?)\s*\(([^)]*)\)/,/['"]?([$_A-Za-z][$_A-Za-z0-9]*)['"]?\s*[:=]\s*(?:eval|new Function)\b/,/\b(?!(?:if|for|switch|while|with|catch)\b)(?:(?:static)\s+)?(\S+)\s*\(.*?\)\s*\{/,/['"]?([$_A-Za-z][$_A-Za-z0-9]*)['"]?\s*[:=]\s*\(.*?\)\s*=>/],m=f.split(`
`),g="",_=Math.min(h,20),A=0;A<_;++A){var y=m[h-A-1],b=y.indexOf("//");if(b>=0&&(y=y.substr(0,b)),y){g=y+g;for(var E=p.length,x=0;x<E;x++){var w=p[x].exec(g);if(w&&w[1])return w[1]}}}}function l(){if(typeof Object.defineProperty!="function"||typeof Object.create!="function")throw new Error("Unable to consume source maps in older browsers")}function c(f){if(typeof f!="object")throw new TypeError("Given StackFrame is not an object");if(typeof f.fileName!="string")throw new TypeError("Given file name is not a String");if(typeof f.lineNumber!="number"||f.lineNumber%1!==0||f.lineNumber<1)throw new TypeError("Given line number must be a positive integer");if(typeof f.columnNumber!="number"||f.columnNumber%1!==0||f.columnNumber<0)throw new TypeError("Given column number must be a non-negative integer");return!0}function u(f){for(var h=/\/\/[#@] ?sourceMappingURL=([^\s'"]+)\s*$/mg,p,m;m=h.exec(f);)p=m[1];if(p)return p;throw new Error("sourceMappingURL not found")}function d(f,h,p){return new Promise(function(m,g){var _=h.originalPositionFor({line:f.lineNumber,column:f.columnNumber});if(_.source){var A=h.sourceContentFor(_.source);A&&(p[_.source]=A),m(new r({functionName:_.name||f.functionName,args:f.args,fileName:_.source,lineNumber:_.line,columnNumber:_.column}))}else g(new Error("Could not get original source for given stackframe and source map"))})}return function f(h){if(!(this instanceof f))return new f(h);h=h||{},this.sourceCache=h.sourceCache||{},this.sourceMapConsumerCache=h.sourceMapConsumerCache||{},this.ajax=h.ajax||o,this._atob=h.atob||i,this._get=function(m){return new Promise((function(g,_){var A=m.substr(0,5)==="data:";if(this.sourceCache[m])g(this.sourceCache[m]);else if(h.offline&&!A)_(new Error("Cannot make network requests in offline mode"));else if(A){var y=/^data:application\/json;([\w=:"-]+;)*base64,/,b=m.match(y);if(b){var E=b[0].length,x=m.substr(E),w=this._atob(x);this.sourceCache[m]=w,g(w)}else _(new Error("The encoding of the inline sourcemap is not supported"))}else{var L=this.ajax(m,{method:"get"});this.sourceCache[m]=L,L.then(g,_)}}).bind(this))},this._getSourceMapConsumer=function(m,g){return new Promise((function(_){if(this.sourceMapConsumerCache[m])_(this.sourceMapConsumerCache[m]);else{var A=new Promise((function(y,b){return this._get(m).then(function(E){typeof E=="string"&&(E=a(E.replace(/^\)\]\}'/,""))),typeof E.sourceRoot>"u"&&(E.sourceRoot=g),y(new t.SourceMapConsumer(E))}).catch(b)}).bind(this));this.sourceMapConsumerCache[m]=A,_(A)}}).bind(this))},this.pinpoint=function(m){return new Promise((function(g,_){this.getMappedLocation(m).then((function(A){function y(){g(A)}this.findFunctionName(A).then(g,y).catch(y)}).bind(this),_)}).bind(this))},this.findFunctionName=function(m){return new Promise((function(g,_){c(m),this._get(m.fileName).then(function(y){var b=m.lineNumber,E=m.columnNumber,x=s(y,b);g(x?new r({functionName:x,args:m.args,fileName:m.fileName,lineNumber:b,columnNumber:E}):m)},_).catch(_)}).bind(this))},this.getMappedLocation=function(m){return new Promise((function(g,_){l(),c(m);var A=this.sourceCache,y=m.fileName;this._get(y).then((function(b){var E=u(b),x=E.substr(0,5)==="data:",w=y.substring(0,y.lastIndexOf("/")+1);return E[0]!=="/"&&!x&&!/^https?:\/\/|^\/\//i.test(E)&&(E=w+E),this._getSourceMapConsumer(E,w).then(function(L){return d(m,L,A).then(g).catch(function(){g(m)})})}).bind(this),_).catch(_)}).bind(this))}}})})(Em)),Em.exports}var PU=Am.exports,MM;function DU(){return MM||(MM=1,(function(n,e){(function(t,r){n.exports=r(bU(),EU(),LU())})(PU,function(r,o,i){var a={filter:function(d){return(d.functionName||"").indexOf("StackTrace$$")===-1&&(d.functionName||"").indexOf("ErrorStackParser$$")===-1&&(d.functionName||"").indexOf("StackTraceGPS$$")===-1&&(d.functionName||"").indexOf("StackGenerator$$")===-1},sourceCache:{}},s=function(){try{throw new Error}catch(f){return f}};function l(d,f){var h={};return[d,f].forEach(function(p){for(var m in p)Object.prototype.hasOwnProperty.call(p,m)&&(h[m]=p[m]);return h}),h}function c(d){return d.stack||d["opera#sourceloc"]}function u(d,f){return typeof f=="function"?d.filter(f):d}return{get:function(f){var h=s();return c(h)?this.fromError(h,f):this.generateArtificially(f)},getSync:function(f){f=l(a,f);var h=s(),p=c(h)?r.parse(h):o.backtrace(f);return u(p,f.filter)},fromError:function(f,h){h=l(a,h);var p=new i(h);return new Promise((function(m){var g=u(r.parse(f),h.filter);m(Promise.all(g.map(function(_){return new Promise(function(A){function y(){A(_)}p.pinpoint(_).then(A,y).catch(y)})})))}).bind(this))},generateArtificially:function(f){f=l(a,f);var h=o.backtrace(f);return typeof f.filter=="function"&&(h=h.filter(f.filter)),Promise.resolve(h)},instrument:function(f,h,p,m){if(typeof f!="function")throw new Error("Cannot instrument non-function object");if(typeof f.__stacktraceOriginalFn=="function")return f;var g=(function(){try{return this.get().then(h,p).catch(p),f.apply(m||this,arguments)}catch(A){throw c(A)&&this.fromError(A).then(h,p).catch(p),A}}).bind(this);return g.__stacktraceOriginalFn=f,g},deinstrument:function(f){if(typeof f!="function")throw new Error("Cannot de-instrument non-function object");return typeof f.__stacktraceOriginalFn=="function"?f.__stacktraceOriginalFn:f},report:function(f,h,p,m){return new Promise(function(g,_){var A=new XMLHttpRequest;if(A.onerror=_,A.onreadystatechange=function(){A.readyState===4&&(A.status>=200&&A.status<400?g(A.responseText):_(new Error("POST to "+h+" failed with status: "+A.status)))},A.open("post",h),A.setRequestHeader("Content-Type","application/json"),m&&typeof m.headers=="object"){var y=m.headers;for(var b in y)Object.prototype.hasOwnProperty.call(y,b)&&A.setRequestHeader(b,y[b])}var E={stack:f};p!=null&&(E.message=p),A.send(JSON.stringify(E))})}}})})(Am)),Am.exports}var BU=DU();const bf=am(BU);var xf={exports:{}},wm={exports:{}},TM;function NU(){return TM||(TM=1,(function(n,e){Object.defineProperty(e,"__esModule",{value:!0}),e.ParsingError=void 0;class t extends Error{constructor(b,E){super(b),this.cause=E}}e.ParsingError=t;let r;function o(){return l(!1)||f()||d()||u()||s()}function i(){return m(/\s*/),l(!0)||d()||c()||s()}function a(){const y=s(),b=[];let E,x=i();for(;x;){if(x.node.type==="Element"){if(E)throw new Error("Found multiple root nodes");E=x.node}x.excluded||b.push(x.node),x=i()}if(!E)throw new t("Failed to parse XML","Root Element not found");if(r.xml.length!==0)throw new t("Failed to parse XML","Not Well-Formed XML");return{declaration:y?y.node:null,root:E,children:b}}function s(){const y=m(/^<\?([\w-:.]+)\s*/);if(!y)return;const b={name:y[1],type:"ProcessingInstruction",content:""},E=r.xml.indexOf("?>");if(E>-1)b.content=r.xml.substring(0,E).trim(),r.xml=r.xml.slice(E);else throw new t("Failed to parse XML","ProcessingInstruction closing tag not found");return m(/\?>/),{excluded:r.options.filter(b)===!1,node:b}}function l(y){const b=m(/^<([^?!</>\s]+)\s*/);if(!b)return;const E={type:"Element",name:b[1],attributes:{},children:[]},x=y?!1:r.options.filter(E)===!1;for(;!(g()||_(">")||_("?>")||_("/>"));){const L=h();if(L)E.attributes[L.name]=L.value;else return}if(m(/^\s*\/>/))return E.children=null,{excluded:x,node:E};m(/\??>/);let w=o();for(;w;)w.excluded||E.children.push(w.node),w=o();if(r.options.strictMode){const L=`</${E.name}>`;if(r.xml.startsWith(L))r.xml=r.xml.slice(L.length);else throw new t("Failed to parse XML",`Closing tag not matching "${L}"`)}else m(/^<\/[\w-:.\u00C0-\u00FF]+\s*>/);return{excluded:x,node:E}}function c(){const y=m(/^<!DOCTYPE\s+\S+\s+SYSTEM[^>]*>/)||m(/^<!DOCTYPE\s+\S+\s+PUBLIC[^>]*>/)||m(/^<!DOCTYPE\s+\S+\s*\[[^\]]*]>/)||m(/^<!DOCTYPE\s+\S+\s*>/);if(y){const b={type:"DocumentType",content:y[0]};return{excluded:r.options.filter(b)===!1,node:b}}}function u(){if(r.xml.startsWith("<![CDATA[")){const y=r.xml.indexOf("]]>");if(y>-1){const b=y+3,E={type:"CDATA",content:r.xml.substring(0,b)};return r.xml=r.xml.slice(b),{excluded:r.options.filter(E)===!1,node:E}}}}function d(){const y=m(/^<!--[\s\S]*?-->/);if(y){const b={type:"Comment",content:y[0]};return{excluded:r.options.filter(b)===!1,node:b}}}function f(){const y=m(/^([^<]+)/);if(y){const b={type:"Text",content:y[1]};return{excluded:r.options.filter(b)===!1,node:b}}}function h(){const y=m(/([^=]+)\s*=\s*("[^"]*"|'[^']*'|[^>\s]+)\s*/);if(y)return{name:y[1].trim(),value:p(y[2].trim())}}function p(y){return y.replace(/^['"]|['"]$/g,"")}function m(y){const b=r.xml.match(y);if(b)return r.xml=r.xml.slice(b[0].length),b}function g(){return r.xml.length===0}function _(y){return r.xml.indexOf(y)===0}function A(y,b={}){y=y.trim();const E=b.filter||(()=>!0);return r={xml:y,options:Object.assign(Object.assign({},b),{filter:E,strictMode:b.strictMode===!0})},a()}n.exports=A,e.default=A})(wm,wm.exports)),wm.exports}var IM=xf.exports,RM;function OU(){return RM||(RM=1,(function(n,e){var t=IM&&IM.__importDefault||function(p){return p&&p.__esModule?p:{default:p}};Object.defineProperty(e,"__esModule",{value:!0});const r=t(NU());function o(p){if(!p.options.indentation&&!p.options.lineSeparator)return;p.content+=p.options.lineSeparator;let m;for(m=0;m<p.level;m++)p.content+=p.options.indentation}function i(p){p.content=p.content.replace(/ +$/,"");let m;for(m=0;m<p.level;m++)p.content+=p.options.indentation}function a(p,m){p.content+=m}function s(p,m,g){if(p.type==="Element")u(p,m,g);else if(p.type==="ProcessingInstruction")f(p,m);else if(typeof p.content=="string")l(p.content,m,g);else throw new Error("Unknown node type: "+p.type)}function l(p,m,g){if(!g){const _=p.trim();(m.options.lineSeparator||_.length===0)&&(p=_)}p.length>0&&(!g&&m.content.length>0&&o(m),a(m,p))}function c(p,m){const g="/"+p.join("/"),_=p[p.length-1];return m.includes(_)||m.includes(g)}function u(p,m,g){if(m.path.push(p.name),!g&&m.content.length>0&&o(m),a(m,"<"+p.name),d(m,p.attributes),p.children===null||m.options.forceSelfClosingEmptyTag&&p.children.length===0){const _=m.options.whiteSpaceAtEndOfSelfclosingTag?" />":"/>";a(m,_)}else if(p.children.length===0)a(m,"></"+p.name+">");else{const _=p.children;a(m,">"),m.level++;let A=p.attributes["xml:space"]==="preserve"||g,y=!1;if(!A&&m.options.ignoredPaths&&(y=c(m.path,m.options.ignoredPaths),A=y),!A&&m.options.collapseContent){let b=!1,E=!1,x=!1;_.forEach(function(w,L){w.type==="Text"?(w.content.includes(`
`)?(E=!0,w.content=w.content.trim()):(L===0||L===_.length-1)&&!g&&w.content.trim().length===0&&(w.content=""),(w.content.trim().length>0||_.length===1)&&(b=!0)):w.type==="CDATA"?b=!0:x=!0}),b&&(!x||!E)&&(A=!0)}_.forEach(function(b){s(b,m,g||A)}),m.level--,!g&&!A&&o(m),y&&i(m),a(m,"</"+p.name+">")}m.path.pop()}function d(p,m){Object.keys(m).forEach(function(g){const _=m[g].replace(/"/g,"&quot;");a(p," "+g+'="'+_+'"')})}function f(p,m){m.content.length>0&&o(m),a(m,"<?"+p.name),a(m," "+p.content.trim()),a(m,"?>")}function h(p,m={}){m.indentation="indentation"in m?m.indentation:"    ",m.collapseContent=m.collapseContent===!0,m.lineSeparator="lineSeparator"in m?m.lineSeparator:`\r
`,m.whiteSpaceAtEndOfSelfclosingTag=m.whiteSpaceAtEndOfSelfclosingTag===!0,m.throwOnFailure=m.throwOnFailure!==!1;try{const g=(0,r.default)(p,{filter:m.filter,strictMode:m.strictMode}),_={content:"",level:0,options:m,path:[]};return g.declaration&&f(g.declaration,_),g.children.forEach(function(A){s(A,_,!1)}),m.lineSeparator?_.content.replace(/\r\n/g,`
`).replace(/\n/g,m.lineSeparator):_.content}catch(g){if(m.throwOnFailure)throw g;return p}}h.minify=(p,m={})=>h(p,Object.assign(Object.assign({},m),{indentation:"",lineSeparator:""})),n.exports=h,e.default=h})(xf,xf.exports)),xf.exports}var kU=OU();const LM=am(kU);var FU=Object.defineProperty,VU=(n,e,t)=>e in n?FU(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,ze=(n,e,t)=>(VU(n,typeof e!="symbol"?e+"":e,t),t);const Zv=class mi{constructor(e=23517,t="localhost",r="http"){this.portNumber=e,this.host=t,this.scheme=r}async init(){await this.updateRayAvailability()}isRayAvailable(){return this.attemptAvailableReset(),mi.rayState===null&&this.updateRayAvailability(),mi.rayState!==null?mi.rayState:!0}attemptAvailableReset(){mi.lastRayStateCheck!==null&&new Date().getTime()-mi.lastRayStateCheck>=3e4&&(mi.rayState=null)}async updateRayAvailability(){let e=!0;if(mi.lastRayStateCheck!==null&&new Date().getTime()-mi.lastRayStateCheck<3e4)return!0;mi.lastRayStateCheck=new Date().getTime();try{await Gt.get(this.getUrlForPath("/locks/__availabilty_check"),{})}catch(t){e=!1,t.response&&(e=!0)}finally{mi.rayState=e}}getUrlForPath(e){var t;return e=e.replace(/^\//,""),`${(t=this.scheme)!=null?t:"http"}://${this.host}:${this.portNumber}/${e}`}async send(e){(mi.rayState===null||mi.lastRayStateCheck===null)&&this.updateRayAvailability();try{e.payloads=this.ensureAllPayloadsHaveAnOrigin(e.payloads),await Gt.post(this.getUrlForPath("/"),e.toArray(),{withCredentials:!1}),await new Promise(t=>setTimeout(t,50))}catch{}}ensureAllPayloadsHaveAnOrigin(e){return e.forEach(t=>{(t.data.origin.file===null||t.data.origin.file===""||typeof t.data.origin.file>"u")&&(t.data.origin.file="/unknown-file.js",t.data.origin.line_number=1,t.data.origin.function_name="unknown")}),e}async lockExists(e){return new Promise(async(t,r)=>{let o;try{o=await Gt.get(this.getUrlForPath(`/locks/${e}`))}catch{return!1}if(o.data.stop_execution){r(new Error("stopping execution"));return}if(typeof o.data.active>"u"){t(o.data);return}t(o.data)})}};ze(Zv,"rayState",!0),ze(Zv,"lastRayStateCheck",null);let Ef=Zv;class UU{color(e){return this}green(){return this.color("green")}orange(){return this.color("orange")}red(){return this.color("red")}purple(){return this.color("purple")}blue(){return this.color("blue")}gray(){return this.color("gray")}}class zU{screenColor(e){return this}screenGreen(){return this.screenColor("green")}screenOrange(){return this.screenColor("orange")}screenRed(){return this.screenColor("red")}screenPurple(){return this.screenColor("purple")}screenBlue(){return this.screenColor("blue")}screenGray(){return this.screenColor("gray")}}class GU{size(e){return this}small(){return this.size("sm")}large(){return this.size("lg")}}class Kc{static removeRayFrames(e){return e.filter(t=>!Kc.isRayFrame(t)&&!Kc.isNodeFrame(t))}static isRayFrame(e){var t;for(const r of this.rayNamespaces())if((t=e.fileName)!=null&&t.includes(r))return!0;return!1}static isNodeFrame(e){var t,r;return((t=e.fileName)==null?void 0:t.includes("node:"))||((r=e.fileName)==null?void 0:r.includes("node_modules"))||!1}static rayNamespaces(){return["ray-node/dist","node-ray/dist","vue-ray/dist","-ray"]}}const PM=console.log.bind({}),HU=(...n)=>{typeof js.client<"u"&&js.client.isRayAvailable()&&js.create().then(e=>e.send(...n)),PM(...n)},DM=class o_{enable(){o_.active=!0,console.log=HU}disable(){o_.active=!1,console.log=PM}active(){return o_.active}};ze(DM,"active",!1);let WU=DM;const BM=class hx{static get(){var e;return(e=hx.hostname)!=null?e:"remote"}static set(e){hx.hostname=e}};ze(BM,"hostname",null);let Jv=BM;class Ul{static convertToPrimitive(e){return e===null?{value:null,isHtml:!1}:typeof e=="string"?{value:e,isHtml:!1}:typeof e=="number"?{value:e,isHtml:!1}:typeof e=="boolean"?{value:e,isHtml:!1}:{value:Ul.prettyFormatForHtml(e),isHtml:!0}}static buildHtmlElement(e,t,r){return`<${e} style="font-size: 0.8rem!important;" class="${t}">${r}</${e}>`}static prettyFormatForHtml(e){const t=Ol(e,{indent:"    "}).replaceAll(" ","&nbsp;").replace(/\r\n|\r|\n/g,"<br>").replace(/("[^"]+")/g,this.buildHtmlElement("code","bold text-green-600 p-0","$1")).replace(/Array(&nbsp;|\s)+(\[[^\]]+\])/g,this.buildHtmlElement("code","bold text-gray-500 p-0","$1$2")).replace(/^(\[[^\]]+\])$/g,this.buildHtmlElement("code","bold text-gray-500 p-0","$1")).replace(/(\{.+\})/g,this.buildHtmlElement("code","text-gray-600","$1")).replace(/(Array|Object|Number|Function|Circular|Symbol|WeakMap|Map)/g,this.buildHtmlElement("span","bold text-yellow-600","$1")).replaceAll(/(true|false|null|undefined|NaN)/g,this.buildHtmlElement("span","bold text-indigo-600","$1")).replace(/(:&nbsp;|[,[\]{}])/g,this.buildHtmlElement("span","bold text-orange-400","$1"));return this.buildHtmlElement("code","",t)}}class dn{constructor(){ze(this,"remotePath",null),ze(this,"localPath",null),ze(this,"initialized",!1),ze(this,"data",{type:"",content:"",origin:{function_name:"",file:"",line_number:0,hostname:"remote"}})}replaceRemotePathWithLocalPath(e){if(this.remotePath===null||this.localPath===null)return e;const t=new RegExp(`^${this.remotePath}`);return e.replace(t,this.localPath)}getContent(){return{}}toArray(){return this.initialized||(this.initialized=!0,this.data.type=this.getType(),this.data.content=this.getContent(),this.data.origin.file=this.replaceRemotePathWithLocalPath(this.data.origin.file)),this.data}toJson(){return JSON.stringify(this.toArray())}}class jU extends dn{constructor(e){super(),ze(this,"value"),this.value=e}getType(){return"custom"}getContent(){return{content:this.value,label:"Boolean"}}}class NM extends dn{constructor(e=""){super(),ze(this,"html"),this.html=e}getType(){return"custom"}getContent(){return{content:this.html,label:"HTML"}}}class OM extends dn{constructor(e){super(),ze(this,"values"),this.values=Array.isArray(e)?e:[e]}static createForArguments(e){const t=e.map(r=>Ul.convertToPrimitive(r).value);return new this(t)}getType(){return"log"}getContent(){return{values:this.values}}}class QU extends dn{getType(){return"custom"}getContent(){return{content:null,label:"Null"}}}class kM{constructor(e){ze(this,"values"),this.values=e}static createForValues(e){return new this(e).getPayloads()}static registerPayloadFinder(e){this.payloadFinder=e}getPayloads(){return this.values.map(e=>this.getPayload(e))}getPayload(e){if(typeof e=="boolean")return new jU(e);if(e===null)return new QU;const t=Ul.convertToPrimitive(e);return t.isHtml?new NM(t.value):new OM(t.value)}}ze(kM,"payloadFinder",null);class $U extends dn{constructor(e){super(),ze(this,"frames"),this.frames=Kc.removeRayFrames(e)}getType(){return"caller"}getContent(){var e,t,r,o,i,a,s,l;const c=this.frames.slice(0)[0]||null,u=(o=(r=(t=(e=c==null?void 0:c.getFunctionName())==null?void 0:e.replace("Proxy.",""))==null?void 0:t.split("."))==null?void 0:r.slice(0))!=null?o:[];return{frame:{file_name:this.replaceRemotePathWithLocalPath((i=c==null?void 0:c.getFileName())!=null?i:""),line_number:(c==null?void 0:c.getLineNumber())||0,class:(a=u[0])!=null?a:"",method:u?u.slice(1).join("."):"",vendor_frame:(l=(s=c==null?void 0:c.getFileName())==null?void 0:s.includes("node_modules"))!=null?l:!1}}}}class YU extends dn{getType(){return"clear_all"}}class XU extends dn{constructor(e){super(),ze(this,"color"),this.color=e}getType(){return"color"}getContent(){return{color:this.color}}}class qU extends dn{getType(){return"confetti"}}class KU extends dn{constructor(e){super(),ze(this,"name"),this.name=e}getType(){return"create_lock"}getContent(){return{name:this.name}}}class FM extends dn{constructor(e,t=""){super(),ze(this,"content"),ze(this,"label"),this.content=e,this.label=t}getType(){return"custom"}getContent(){return{content:this.content,label:this.label}}}function ro(n,e){return Math.floor(Math.random()*(e-n+1)+n)}const ZU=n=>JU(n*1e3),JU=n=>{const e=new Date().getTime();for(;new Date().getTime()<e+n;);},ez=n=>{const e={"":"cent","":"pound","":"yen","":"euro","":"copy","":"reg","<":"lt",">":"gt",'"':"quot","&":"amp","'":"#39"},t=Object.keys(e),r=new RegExp(`[${t.join("")}]`,"g");return n.replace(r,o=>`&${e[o]};`)},tz=n=>"&nbsp;".repeat(n.length),nz=n=>n.replace(/(\r\n|\r|\n)/g,"<br>"),eA=(n,e={encodeEntities:!0})=>(e.encodeEntities&&(n=ez(n)),nz(n.replace(/^(\s+)/gm,t=>`${tz(t)}`))),rz=()=>{const n={random:[ro(1,255),ro(1,255),ro(1,255),ro(1,255),ro(1,255),ro(1,255),ro(1,255),ro(1,255),ro(1,255),ro(1,255),ro(1,255),ro(1,255),ro(1,255),ro(1,255),ro(1,255),ro(1,255)]};return vU(n).toString()},VM=n=>n.length?n[n.length-1]:!1;function UM(n){const e="0123456789abcdef";function t(E){let x,w="";for(x=0;x<=3;x++)w+=e.charAt(E>>x*8+4&15)+e.charAt(E>>x*8&15);return w}function r(E,x){const w=(E&65535)+(x&65535);return(E>>16)+(x>>16)+(w>>16)<<16|w&65535}function o(E,x){return E<<x|E>>>32-x}function i(E,x,w,L,C,P){return r(o(r(r(x,E),r(L,P)),C),w)}function a(E,x,w,L,C,P,D){return i(x&w|~x&L,E,x,C,P,D)}function s(E,x,w,L,C,P,D){return i(x&L|w&~L,E,x,C,P,D)}function l(E,x,w,L,C,P,D){return i(x^w^L,E,x,C,P,D)}function c(E,x,w,L,C,P,D){return i(w^(x|~L),E,x,C,P,D)}function u(E){let x;const w=(E.length+8>>6)+1,L=new Array(w*16);for(x=0;x<w*16;x++)L[x]=0;for(x=0;x<E.length;x++)L[x>>2]|=E.charCodeAt(x)<<x%4*8;return L[x>>2]|=128<<x%4*8,L[w*16-2]=E.length*8,L}let d,f=1732584193,h=-271733879,p=-1732584194,m=271733878,g,_,A,y;const b=u(`${n}`);for(d=0;d<b.length;d+=16)g=f,_=h,A=p,y=m,f=a(f,h,p,m,b[d+0],7,-680876936),m=a(m,f,h,p,b[d+1],12,-389564586),p=a(p,m,f,h,b[d+2],17,606105819),h=a(h,p,m,f,b[d+3],22,-1044525330),f=a(f,h,p,m,b[d+4],7,-176418897),m=a(m,f,h,p,b[d+5],12,1200080426),p=a(p,m,f,h,b[d+6],17,-1473231341),h=a(h,p,m,f,b[d+7],22,-45705983),f=a(f,h,p,m,b[d+8],7,1770035416),m=a(m,f,h,p,b[d+9],12,-1958414417),p=a(p,m,f,h,b[d+10],17,-42063),h=a(h,p,m,f,b[d+11],22,-1990404162),f=a(f,h,p,m,b[d+12],7,1804603682),m=a(m,f,h,p,b[d+13],12,-40341101),p=a(p,m,f,h,b[d+14],17,-1502002290),h=a(h,p,m,f,b[d+15],22,1236535329),f=s(f,h,p,m,b[d+1],5,-165796510),m=s(m,f,h,p,b[d+6],9,-1069501632),p=s(p,m,f,h,b[d+11],14,643717713),h=s(h,p,m,f,b[d+0],20,-373897302),f=s(f,h,p,m,b[d+5],5,-701558691),m=s(m,f,h,p,b[d+10],9,38016083),p=s(p,m,f,h,b[d+15],14,-660478335),h=s(h,p,m,f,b[d+4],20,-405537848),f=s(f,h,p,m,b[d+9],5,568446438),m=s(m,f,h,p,b[d+14],9,-1019803690),p=s(p,m,f,h,b[d+3],14,-187363961),h=s(h,p,m,f,b[d+8],20,1163531501),f=s(f,h,p,m,b[d+13],5,-1444681467),m=s(m,f,h,p,b[d+2],9,-51403784),p=s(p,m,f,h,b[d+7],14,1735328473),h=s(h,p,m,f,b[d+12],20,-1926607734),f=l(f,h,p,m,b[d+5],4,-378558),m=l(m,f,h,p,b[d+8],11,-2022574463),p=l(p,m,f,h,b[d+11],16,1839030562),h=l(h,p,m,f,b[d+14],23,-35309556),f=l(f,h,p,m,b[d+1],4,-1530992060),m=l(m,f,h,p,b[d+4],11,1272893353),p=l(p,m,f,h,b[d+7],16,-155497632),h=l(h,p,m,f,b[d+10],23,-1094730640),f=l(f,h,p,m,b[d+13],4,681279174),m=l(m,f,h,p,b[d+0],11,-358537222),p=l(p,m,f,h,b[d+3],16,-722521979),h=l(h,p,m,f,b[d+6],23,76029189),f=l(f,h,p,m,b[d+9],4,-640364487),m=l(m,f,h,p,b[d+12],11,-421815835),p=l(p,m,f,h,b[d+15],16,530742520),h=l(h,p,m,f,b[d+2],23,-995338651),f=c(f,h,p,m,b[d+0],6,-198630844),m=c(m,f,h,p,b[d+7],10,1126891415),p=c(p,m,f,h,b[d+14],15,-1416354905),h=c(h,p,m,f,b[d+5],21,-57434055),f=c(f,h,p,m,b[d+12],6,1700485571),m=c(m,f,h,p,b[d+3],10,-1894986606),p=c(p,m,f,h,b[d+10],15,-1051523),h=c(h,p,m,f,b[d+1],21,-2054922799),f=c(f,h,p,m,b[d+8],6,1873313359),m=c(m,f,h,p,b[d+15],10,-30611744),p=c(p,m,f,h,b[d+6],15,-1560198380),h=c(h,p,m,f,b[d+13],21,1309151649),f=c(f,h,p,m,b[d+4],6,-145523070),m=c(m,f,h,p,b[d+11],10,-1120210379),p=c(p,m,f,h,b[d+2],15,718787259),h=c(h,p,m,f,b[d+9],21,-343485551),f=r(f,g),h=r(h,_),p=r(p,A),m=r(m,y);return t(f)+t(h)+t(p)+t(m)}function zM(n,e="YYYY-MM-DD HH:mm:ss"){const t=s=>s<10?`0${s}`:s,r=s=>{const l=new Intl.DateTimeFormat("en",{timeZoneName:"short"}).formatToParts(s).find(c=>c.type==="timeZoneName");return l?l.value:""},o={YYYY:()=>n.getFullYear(),YY:()=>String(n.getFullYear()).slice(-2),MM:()=>t(n.getMonth()+1),M:()=>n.getMonth()+1,DD:()=>t(n.getDate()),D:()=>n.getDate(),HH:()=>t(n.getHours()),H:()=>n.getHours(),hh:()=>t(n.getHours()%12||12),h:()=>n.getHours()%12||12,mm:()=>t(n.getMinutes()),m:()=>n.getMinutes(),ss:()=>t(n.getSeconds()),s:()=>n.getSeconds(),A:()=>n.getHours()<12?"AM":"PM",a:()=>n.getHours()<12?"am":"pm",T:()=>r(n),Z:()=>{const s=n.getTimezoneOffset();return`${(s>0?"-":"+")+t(Math.floor(Math.abs(s)/60))}:${t(Math.abs(s)%60)}`},z:()=>{const s=n.getTimezoneOffset();return`${(s>0?"-":"+")+t(Math.floor(Math.abs(s)/60))+t(Math.abs(s)%60)}`}};let i="",a=!1;for(let s=0;s<e.length;s++){if(e[s]==="["){a=!0;continue}if(e[s]==="]"){a=!1;continue}if(a){i+=e[s];continue}const l=e.substring(s,s+2),c=e.substring(s,s+4);o[c]?(i+=o[c](),s+=3):o[l]?(i+=o[l](),s+=1):i+=e[s]}return i}class oz extends dn{constructor(e,t="YYYY-MM-DD hh:mm:ss"){super(),ze(this,"date"),ze(this,"format"),this.date=e,this.format=t}getType(){return"carbon"}getContent(){return{formatted:this.getFormatted(),timestamp:this.getTimestamp(),timezone:this.getTimezoneName()}}getTimestamp(){return this.date?this.date.getTime()/1e3:null}getFormatted(){return this.date?zM(this.date,this.format):"--"}getTimezoneName(){return this.date?zM(this.date,"T"):"--"}}class iz extends dn{constructor(e){super(),this.value=e}getType(){return"custom"}getContent(){return{content:JSON.parse(this.value),label:"JSON"}}}class az extends dn{constructor(e,t="Error"){super(),ze(this,"err"),ze(this,"label"),this.err=e,this.label=t}getType(){return"custom"}getContent(){return{content:this.formatError(),label:this.label}}formatError(){return`<span class="text-red-400 bold">${this.err.name}</span>: <br><span class="pl-5 text-gray-500">${this.err.message}</span>`}}class sz extends dn{constructor(e,t){super(),ze(this,"eventName"),ze(this,"payload"),this.eventName=e,this.payload=t}getType(){return"event"}getContent(){return{name:this.eventName,event:this.payload[0],payload:Ul.convertToPrimitive(this.payload).value,class_based_event:!0}}}class tA extends dn{constructor(e,t={}){super(),ze(this,"exception"),ze(this,"meta",{}),ze(this,"stack"),this.exception=e,this.meta=t}static async make(e,t={}){const r=new tA(e,t);return r.stack=await bf.get(),r}getType(){return"exception"}getContent(){return{class:this.exception.name,message:this.exception.message,frames:this.getFrames(),meta:this.meta}}getFrames(){return this.stack.slice(1).map(e=>{var t,r,o,i;const a=(r=(t=e.functionName)==null?void 0:t.split("."))!=null?r:["unknown","unknown"],s=a.pop();let l=typeof e.functionName!="string"?"unknown":a.pop();return typeof e.functionName>"u"&&(l="unknown"),{file_name:this.replaceRemotePathWithLocalPath((o=e.getFileName())!=null?o:""),line_number:e.getLineNumber(),class:l,method:typeof e.fileName>"u"?"<anonymous>":s,vendor_frame:(i=e.getFileName())==null?void 0:i.includes("node_modules"),snippet:[]}}).filter(e=>!e.file_name.startsWith("node:")).filter(e=>!e.file_name.includes("jest-circus")).filter(e=>e.class!=="Ray"&&e.method!=="exception")}}class lz extends dn{getType(){return"hide_app"}}class cz extends dn{getType(){return"hide"}}class uz extends dn{constructor(e,t={highlight:"none"}){super(),ze(this,"value"),ze(this,"options"),this.value=e,this.options=t}getType(){return"custom"}getContent(){return{content:this.formatMarkupForDisplay(this.value),label:"Markup"}}formatMarkupForDisplay(e){const t=this.formatAndIndentMarkup(e);return this.highlightHtmlMarkup(eA(t,{encodeEntities:!0}))}formatAndIndentMarkup(e){return LM(e.toString(),{indentation:"    ",collapseContent:!0,lineSeparator:`
`})}highlightHtmlMarkup(e){return e.replace(/&quot;/g,'"').replace(/="([^"]+)"/g,"=<span style='color:#16A34A;'>&quot;$1&quot;</span>").replace(/(&lt;[A-Za-z\d-]+)(\s|&nbsp;|&gt;)/g,'<span style="color:#1D4ED8;">$1</span>$2').replace(/(&lt;\/[A-Za-z\d-]+)(&gt;)/g,'<span style="color:#1D4ED8;">$1$2</span>')}}class dz extends dn{constructor(e){super(),ze(this,"location"),this.location=e}getType(){return"custom"}getContent(){return{content:`<img src="${this.location.replace('"','\\\\"')}" alt="" />`,label:"Image"}}}class fz extends dn{constructor(e){super(),ze(this,"value"),this.value=e}getType(){return"json_string"}getContent(){return{value:JSON.stringify(this.value)}}}class hz extends dn{constructor(e){super(),ze(this,"label"),this.label=e}getType(){return"label"}getContent(){return{label:this.label}}}class pz extends dn{constructor(e,t){super(),ze(this,"name"),ze(this,"isNewTimer",!1),ze(this,"totalTime",0),ze(this,"maxMemoryUsageDuringTotalTime",0),ze(this,"timeSinceLastCall",0),ze(this,"maxMemoryUsageSinceLastCall",0),this.name=e,this.totalTime=t.getDuration(),this.maxMemoryUsageDuringTotalTime=t.getMemory();const r=t.getPeriods();r.length>1&&(this.timeSinceLastCall=VM(r),this.maxMemoryUsageSinceLastCall=0)}getType(){return"measure"}concernsNewTimer(){return this.isNewTimer=!0,this.totalTime=0,this.maxMemoryUsageDuringTotalTime=0,this.timeSinceLastCall=0,this.maxMemoryUsageSinceLastCall=0,this}getContent(){return{name:this.name,is_new_timer:this.isNewTimer,total_time:this.totalTime,max_memory_usage_during_total_time:this.maxMemoryUsageDuringTotalTime,time_since_last_call:this.timeSinceLastCall,max_memory_usage_since_last_call:this.maxMemoryUsageSinceLastCall}}}class mz extends dn{constructor(e){super(),ze(this,"name"),this.name=e}getType(){return"new_screen"}getContent(){return{name:this.name}}}class gz extends dn{constructor(e){super(),ze(this,"text"),this.text=e}getType(){return"notify"}getContent(){return{value:this.text}}}class _z extends dn{getType(){return"remove"}}class vz extends dn{constructor(e){super(),ze(this,"color"),this.color=e}getType(){return"screen_color"}getContent(){return{color:this.color}}}class Az extends dn{getType(){return"separator"}}class yz extends dn{getType(){return"show_app"}}class bz extends dn{constructor(e){super(),ze(this,"size"),this.size=e}getType(){return"size"}getContent(){return{size:this.size}}}class xz extends dn{constructor(e,t="Table"){super(),ze(this,"values"),ze(this,"label"),this.values=e,this.label=t}getType(){return"table"}getContent(){return{values:this.getValues(),label:this.label}}getValues(){if(Array.isArray(this.values))return this.values.map(t=>Ul.convertToPrimitive(t).value);const e={};for(const t in this.values)e[t]=Ul.convertToPrimitive(this.values[t]).value;return e}}class Ez extends dn{constructor(e){super(),this.text=e}getType(){return"custom"}getContent(){return{content:eA(this.text,{encodeEntities:!0}),label:"Text"}}}class Cz extends dn{constructor(e){super(),ze(this,"frames"),ze(this,"startFromIndexNum",null),ze(this,"limitNum",null),this.frames=Kc.removeRayFrames(e)}getType(){return"trace"}getContent(){var e;let t=this.frames.map(r=>{var o,i,a,s;const l=(o=r.getFunctionName())==null?void 0:o.replace("Proxy.","").split(".").slice(0),c=l!=null&&l.length?l.shift():"",u=(i=l==null?void 0:l.join("."))!=null?i:"";return{file_name:this.replaceRemotePathWithLocalPath((a=r.getFileName())!=null?a:""),line_number:r.getLineNumber(),class:c,method:u,vendor_frame:(s=r.getFileName())==null?void 0:s.includes("node_modules")}});return this.limitNum!==null&&(t=t.slice((e=this.startFromIndexNum)!=null?e:0,this.limitNum)),{frames:t}}}class Sz extends dn{constructor(e){super(),ze(this,"value"),this.value=e}getType(){return"custom"}getContent(){return{content:this.formatXmlForDisplay(this.value),label:"XML"}}formatXmlForDisplay(e){const t=this.formatAndIndentXml(e);return this.encodeXml(t)}encodeXml(e){return eA(e,{encodeEntities:!0})}formatAndIndentXml(e){return LM(e.toString(),{indentation:"    ",collapseContent:!0,lineSeparator:`
`})}}let GM=class{constructor(e,t,r={}){ze(this,"uuid"),ze(this,"payloads"),ze(this,"meta"),this.uuid=e,this.payloads=t,this.meta=r}toArray(){return{uuid:this.uuid,payloads:this.payloads.map(e=>e.toArray()),meta:this.meta}}toJson(){return JSON.stringify(this.toArray())}};class HM{constructor(e){ze(this,"enable",!0),ze(this,"_host","localhost"),ze(this,"_port",23517),ze(this,"_scheme","http"),ze(this,"remote_path",null),ze(this,"local_path",null),ze(this,"always_send_raw_values",!1),ze(this,"intercept_console_log",!1),ze(this,"enabled_callback",null),ze(this,"sent_payload_callback",null),ze(this,"sending_payload_callback",null),ze(this,"originalSettings"),this.originalSettings=Object.assign({},e);for(const t in e)this[t]=e[t]}set host(e){this._host=e,js.useClient(new Ef(this.port,this.host,this.scheme))}get host(){return this._host}set port(e){this._port=e,js.useClient(new Ef(this.port,this.host,this.scheme))}get port(){return this._port}get scheme(){return this._scheme}set scheme(e){this._scheme=e,js.useClient(new Ef(this.port,this.host,this.scheme))}toObject(){return this.originalSettings}}class nA{constructor(e,t=null){ze(this,"name"),ze(this,"laps",[]),ze(this,"startedAt"),ze(this,"endedAt"),ze(this,"lapTime");var r;this.name=(r=e.name)==null?void 0:r.slice(0),this.laps=e.laps.slice(0),this.startedAt=e.startedAt,this.endedAt=e.endedAt,this.lapTime=t??new Date().getTime()}getDuration(){return this.laps.reduce((e,t)=>t+e,0)}getMemory(e=null){return 0}getPeriods(){return this.laps.slice()}getPreviousDuration(){return VM(this.laps)-(new Date().getTime()-this.lapTime)}}class wz{constructor(e=void 0){ze(this,"name"),ze(this,"laps",[]),ze(this,"startedAt",0),ze(this,"endedAt",0),this.name=e,this.laps=[],this.startedAt=0,this.endedAt=0}initialize(e){this.name=e,this.laps=[],this.startedAt=0,this.endedAt=0}start(e){return this.startedAt=new Date().getTime(),new nA(this)}lap(){const e=new Date().getTime(),t=e-this.startedAt;return this.laps.push(t-this.totalDuration()),new nA(this,e)}stop(){this.endedAt=new Date().getTime();const e=this.endedAt-this.startedAt;return this.laps.push(e-this.totalDuration()),new nA(this)}totalDuration(){return this.laps.reduce((e,t)=>t+e,0)}reset(){return this.initialize(this.name),this}getLaps(){return this.laps}}class Mz{constructor(){ze(this,"counters",{})}async increment(e){typeof this.counters[e]>"u"&&(this.counters[e]=[await qM(),0]);const t=this.counters[e],r=t[0],i=t[1]+1;return this.counters[e]=[r,i],[r,i]}get(e){return typeof this.counters[e]>"u"?0:this.counters[e][1]}clear(){this.counters=[]}setRay(e,t){this.counters[e][0]=t}getCounters(){return this.counters}}class Tz{constructor(){ze(this,"counters",{})}initialize(e,t){const r=`${e.file}:${e.line_number}`;return typeof this.counters[r]>"u"&&(this.counters[r]={counter:0,limit:t,valid:!0}),this.counters[r]}increment(e){const t=`${e.file}:${e.line_number}`;if(typeof this.counters[t]>"u")return{counter:0,limit:0,valid:!1};const{counter:r,limit:o,valid:i}=this.counters[t];return this.counters[t]={counter:r+1,limit:o,valid:i},this.counters[t]}canSendPayload(e){const t=`${e.file}:${e.line_number}`;if(typeof this.counters[t]>"u")return!0;const{counter:r,limit:o,valid:i}=this.counters[t];return i&&(r<o||o<=0)}}class Iz{constructor(e){ze(this,"store",[]),ze(this,"clock"),this.clock=e}hit(){return this.store.push(this.clock.now()),this}clear(){return this.store=[],this}count(){return this.store.length}countLastSecond(){const e=this.clock.now().subSeconds(1);let t=0;return this.store.forEach(r=>{this.isBetween(r,e,this.clock.now())&&t++}),t}isBetween(e,t,r){return e.getTimestamp()>=t.getTimestamp()&&e.getTimestamp()<=r.getTimestamp()}}let Rz=class{};class Cf{constructor(e=null){ze(this,"dateStr"),ze(this,"dateTs"),ze(this,"_date"),this._date=e??new Date,this.date=this._date,this.dateStr=this.date.toISOString(),this.dateTs=this.date.getTime()}get date(){return this._date}set date(e){this.dateTs=e.getTime(),this.dateStr=e.toISOString()}static createFrom(e){return new Cf(e)}getTimestamp(){return Math.floor(this.dateTs/1e3)}addSeconds(e){return Cf.createFrom(new Date(this.dateTs+e*1e3))}subSeconds(e){return Cf.createFrom(new Date(this.dateTs-e*1e3))}}class Lz extends Rz{now(){return new Cf}}class Mm{constructor(e=null,t=null){ze(this,"maxCalls"),ze(this,"maxPerSecond"),ze(this,"cache"),ze(this,"notified",!1),this.maxCalls=e,this.maxPerSecond=t,this.cache=new Iz(new Lz)}static disabled(){return new Mm(null,null)}hit(){return this.cache.hit(),this}max(e=null){return this.maxCalls=e,this}perSecond(e=null){return this.maxPerSecond=e,this}isMaxReached(){if(this.maxCalls===null)return!1;const e=this.cache.count()>=this.maxCalls;return e||(this.notified=!1),e}isMaxPerSecondReached(){if(this.maxPerSecond===null)return!1;const e=this.cache.countLastSecond()>=this.maxPerSecond;return e===!1&&(this.notified=!1),e}clear(){return this.maxCalls=null,this.maxPerSecond=null,this.cache.clear(),this}isNotified(){return this.notified}notify(){this.notified=!0}getCache(){return this.cache}}var Sf=(n=>(n.Sending="sending",n.Sent="sent",n))(Sf||{});const Pz="2.1.2",WM=(n,e,t=[])=>{const r=Object.getOwnPropertyDescriptors(e);for(let o of t)delete r[o];Object.defineProperties(n,r)},wf=(n,e=[n])=>{const t=Object.getPrototypeOf(n);return t===null?e:wf(t,[...e,t])},Dz=(...n)=>{if(n.length===0)return;let e;const t=n.map(r=>wf(r));for(;t.every(r=>r.length>0);){const r=t.map(i=>i.pop()),o=r[0];if(r.every(i=>i===o))e=o;else break}return e},jM=(n,e,t=[])=>{var r;const o=(r=Dz(...n))!==null&&r!==void 0?r:Object.prototype,i=Object.create(o),a=wf(o);for(let s of n){let l=wf(s);for(let c=l.length-1;c>=0;c--){let u=l[c];a.indexOf(u)===-1&&(WM(i,u,["constructor",...t]),a.push(u))}}return i.constructor=e,i},rA=n=>n.filter((e,t)=>n.indexOf(e)==t),QM=new WeakMap,Bz=n=>QM.get(n),Nz=(n,e)=>QM.set(n,e),$M=(n,e)=>{var t,r;const o=rA([...Object.getOwnPropertyNames(n),...Object.getOwnPropertyNames(e)]),i={};for(let a of o)i[a]=rA([...(t=n==null?void 0:n[a])!==null&&t!==void 0?t:[],...(r=e==null?void 0:e[a])!==null&&r!==void 0?r:[]]);return i},YM=(n,e)=>{var t,r,o,i;return{property:$M((t=n==null?void 0:n.property)!==null&&t!==void 0?t:{},(r=e==null?void 0:e.property)!==null&&r!==void 0?r:{}),method:$M((o=n==null?void 0:n.method)!==null&&o!==void 0?o:{},(i=e==null?void 0:e.method)!==null&&i!==void 0?i:{})}},Oz=(n,e)=>{var t,r,o,i,a,s;return{class:rA([...(t=n==null?void 0:n.class)!==null&&t!==void 0?t:[],...(r=e==null?void 0:e.class)!==null&&r!==void 0?r:[]]),static:YM((o=n==null?void 0:n.static)!==null&&o!==void 0?o:{},(i=e==null?void 0:e.static)!==null&&i!==void 0?i:{}),instance:YM((a=n==null?void 0:n.instance)!==null&&a!==void 0?a:{},(s=e==null?void 0:e.instance)!==null&&s!==void 0?s:{})}},kz=new Map,Fz=(...n)=>{var e;const t=new Set,r=new Set([...n]);for(;r.size>0;)for(let o of r){const i=wf(o.prototype).map(c=>c.constructor),a=(e=Bz(o))!==null&&e!==void 0?e:[],l=[...i,...a].filter(c=>!t.has(c));for(let c of l)r.add(c);t.add(o),r.delete(o)}return[...t]},Vz=(...n)=>{const e=Fz(...n).map(t=>kz.get(t)).filter(t=>!!t);return e.length==0?{}:e.length==1?e[0]:e.reduce((t,r)=>Oz(t,r))};function Uz(...n){var e,t,r;const o=n.map(s=>s.prototype);function i(...s){for(const l of n)WM(this,new l(...s))}i.prototype=jM(o,i),Object.setPrototypeOf(i,jM(n,null,["prototype"]));let a=i;{const s=Vz(...n);for(let l of(e=s==null?void 0:s.class)!==null&&e!==void 0?e:[]){const c=l(a);c&&(a=c)}XM((t=s==null?void 0:s.static)!==null&&t!==void 0?t:{},a),XM((r=s==null?void 0:s.instance)!==null&&r!==void 0?r:{},a.prototype)}return Nz(a,n),a}const XM=(n,e)=>{const t=n.property,r=n.method;if(t)for(let o in t)for(let i of t[o])i(e,o);if(r)for(let o in r)for(let i of r[o])i(e,o,Object.getOwnPropertyDescriptor(e,o))},qo=class Et extends Uz(UU,GU,zU){constructor(e,t=null,r=null,o=!1){var i,a,s;super(),ze(this,"inCallback",!1),ze(this,"settings"),ze(this,"uuid"),ze(this,"limitOrigin",null),ze(this,"canSendPayload",!0),ze(this,"chaining",!1),ze(this,"chainedPayloads",[]),Et.defaultSettings.not_defined===!0&&(Et.defaultSettings={enable:!0,host:"localhost",port:23517,scheme:"http",local_path:null,remote_path:null,always_send_raw_values:!1,enabled_callback:null,sending_payload_callback:null,sent_payload_callback:null,not_defined:!1}),Et.defaultSettings=Object.assign({},Et.defaultSettings,e.toObject()),this.inCallback=o,this.settings=new HM(Et.defaultSettings),Et.enabled===null&&(Et.enabled=this.settings.enable!==!1),Et.client=(i=t??Et.client)!=null?i:new Ef(this.settings.port,this.settings.host),Et._rateLimiter=(a=Et._rateLimiter)!=null?a:Mm.disabled(),this.uuid=(s=r??Et.fakeUuid)!=null?s:rz(),this.settings.intercept_console_log&&!this.interceptor().active()&&this.interceptor().enable(),this.loadMacros()}static create(e=null,t=null){Et.defaultSettings.not_defined===!0&&(Et.defaultSettings={enable:!0,host:"localhost",port:23517,scheme:"http",local_path:null,remote_path:null,always_send_raw_values:!1,not_defined:!1,intercept_console_log:!1,enabled_callback:null,sending_payload_callback:null,sent_payload_callback:null});const r=new HM(Et.defaultSettings);return new this(r,e,t)}static useDefaultSettings(e){return Et.defaultSettings.not_defined===!0&&(Et.defaultSettings={enable:!0,host:"localhost",port:23517,scheme:"http",local_path:null,remote_path:null,always_send_raw_values:!1,enabled_callback:null,sending_payload_callback:null,sent_payload_callback:null,not_defined:!1}),Et.defaultSettings=Object.assign({},Et.defaultSettings,e),Et.defaultSettings.not_defined=!1,Et.client=new Ef(this.defaultSettings.port,this.defaultSettings.host),this}loadMacros(){for(const e in Et.macros){const t=Et.macros[e];this[e]=t.bind(this)}return this}interceptor(){return Et.interceptor}client(){return Et.client}enable(){return Et.enabled=!0,this}disable(){return Et.enabled=!1,this}enabled(){return typeof this.settings.enabled_callback=="function"?Et.enabled&&this.settings.enabled_callback():Et.enabled}disabled(){return!this.enabled()}static useClient(e){this.client=e}project(e){return Et.projectName=e,this}newScreen(e=""){const t=new mz(e);return this.sendRequest(t)}clearAll(){const e=new YU;return this.sendRequest(e)}clearScreen(){return this.newScreen()}color(e){const t=new XU(e);return this.sendRequest(t)}confetti(){const e=new qU;return this.sendRequest(e)}screenColor(e){const t=new vz(e);return this.sendRequest(t)}label(e){const t=new hz(e);return this.sendRequest(t)}size(e){const t=new bz(e);return this.sendRequest(t)}remove(){const e=new _z;return this.sendRequest(e)}hide(){const e=new cz;return this.sendRequest(e)}notify(e){const t=new gz(e);return this.sendRequest(t)}toJson(...e){const t=e.map(r=>new fz(r));return this.sendRequest(t)}json(...e){const t=e.map(r=>new iz(r));return this.sendRequest(t)}file(e){throw new Error("file() unsupported on node-ray/web.")}image(e){const t=new dz(e);return this.sendRequest(t)}die(e=""){throw new Error(`Ray.die() called: ${e||"no message"}`)}className(e){return this.send(e.constructor.name)}error(e){const t=new az(e,"Error");return this.sendRequest(t).red()}event(e,t=[]){const r=new sz(e,t);return this.sendRequest(r)}async exception(e,t={}){const r=await tA.make(e,t);return await this.sendRequest(r).red()}ban(){return this.send("")}charles(){return this.send("   ")}table(e,t="Table"){const r=new xz(e,t);return this.sendRequest(r)}async count(e=null){var t;const r=await this.getCaller(),o=UM(`${r==null?void 0:r.getFileName()}${r==null?void 0:r.getLineNumber()}`),[i,a]=await Et.counters.increment((t=e??o)!=null?t:"none");let s="Called ";return e&&(s+=`'${e}' `),s+=`${a} ${a===1?"time":"times"}.`,i.sendCustom(s,"Count"),i}clearCounters(){return Et.counters.clear(),this}async pause(){Et.lockCounter++;const e=UM(`${new Date().getTime()}-${Et.lockCounter}`),t=new KU(e);return this.sendRequest(t),new Promise(async(r,o)=>{let i;do{ZU(1);try{i=await Et.client.lockExists(e)}catch(a){return o(a),!1}if(i!==!0&&i&&i.stop_execution)return o(!1),!1}while(i.active);r(this)})}stopTime(e=""){return e===""?(Et.stopWatches={},this):(typeof Et.stopWatches[e]<"u"&&delete Et.stopWatches[e],this)}async caller(){const e=await bf.get(),t=new $U(e);return this.sendRequest(t)}async trace(){const e=await bf.get();return this.sendRequest(new Cz(e))}measure(e="default"){if(e instanceof Function)return this.measureClosure(e);if(typeof Et.stopWatches[e]>"u"){const i=this.getStopwatch(e);Et.stopWatches[e]=i;const a=i.start(e),s=this.getMeasurePayload(e,a);return s.concernsNewTimer(),this.sendRequest(s)}const r=Et.stopWatches[e].lap(),o=this.getMeasurePayload(e,r);return this.sendRequest(o)}measureClosure(e){const t=this.getStopwatch("closure");t.start("closure"),e();const r=t.stop(),o=this.getMeasurePayload("closure",r);return this.sendRequest(o)}getStopwatch(e){return new wz(e)}getMeasurePayload(e,t){return new pz(e,t)}separator(){const e=new Az;return this.sendRequest(e)}xml(e){const t=new Sz(e);return this.sendRequest(t)}html(e=""){const t=new NM(e);return this.sendRequest(t)}text(e=""){const t=new Ez(e);return this.sendRequest(t)}date(e){const t=new oz(e);return this.sendRequest(t)}raw(...e){if(!e.length)return this;const t=e.map(r=>OM.createForArguments([r]));return this.sendRequest(t)}send(...e){if(!e.length)return this;if(this.settings.always_send_raw_values)return this.raw(...e);const t=kM.createForValues(e);return this.sendRequest(t)}pass(e){return this.send(e),e}showApp(){const e=new yz;return this.sendRequest(e)}hideApp(){const e=new lz;return this.sendRequest(e)}macro(e,t){return Et.macros[e]=t,this[e]=t.bind(this),this}htmlMarkup(e,t={}){const r=new uz(e,t);return this.sendRequest(r)}if(e,t=null){return typeof e=="function"&&(e=e()),e&&t!==null&&t(this),t===null&&(this.canSendPayload=e),this}async limit(e){const t=await this.getCaller();return this.limitOrigin={function_name:t==null?void 0:t.getFunctionName(),file:t==null?void 0:t.getFileName(),line_number:t==null?void 0:t.getLineNumber(),hostname:Jv.get()},Et.limiters.initialize(this.limitOrigin,e),this}async once(...e){const t=await this.getCaller();return this.limitOrigin={function_name:t==null?void 0:t.getFunctionName(),file:t==null?void 0:t.getFileName(),line_number:t==null?void 0:t.getLineNumber(),hostname:Jv.get()},Et.limiters.initialize(this.limitOrigin,1),e.length>0?this.send(...e):this}chain(e){return this.chaining=!0,e(this),this.chaining=!1,this.sendRequest(this.chainedPayloads.slice(0)),this.chainedPayloads=[],this}sendCustom(e,t=""){const r=new FM(e,t);return this.sendRequest(r)}async getOriginFrame(){const e=await bf.get();let t=e.findIndex(o=>{var i;return(i=o.functionName)==null?void 0:i.includes("Ray.sendRequest")});return t===-1&&(t=0),Kc.removeRayFrames(e.slice(t)).slice(0).shift()}async getCaller(){const e=await bf.get();let t=e.findIndex(o=>{var i;return(i=o.functionName)==null?void 0:i.includes("Ray.getCaller")});t===-1&&(t=0);const r=e.slice(t);return r.length===1?r.shift():r.slice(2).shift()}async getOriginData(){const e=await this.getOriginFrame();return{function_name:e==null?void 0:e.getFunctionName(),file:e==null?void 0:e.getFileName(),line_number:e==null?void 0:e.getLineNumber(),hostname:Jv.get()}}prepareMeta(e){return Object.assign({},{node_ray_package_version:Pz,project_name:Et.projectName},e)}executePayloadCallback(e,t=[]){if(!this.inCallback){this.inCallback=!0;try{e===Sf.Sending&&this.settings.sending_payload_callback!==null&&this.settings.sending_payload_callback(new Et(this.settings,this.client(),this.uuid,!0),t),e===Sf.Sent&&this.settings.sent_payload_callback!==null&&this.settings.sent_payload_callback(this)}catch{}this.inCallback=!1}}sendRequest(e,t=[]){if(!this.enabled())return this;if(!this.canSendPayload)return this;if(this.chaining){const r=Array.isArray(e)?e:[e];return this.chainedPayloads.push(...r),this}if(this.limitOrigin!==null){if(!Et.limiters.canSendPayload(this.limitOrigin))return this;Et.limiters.increment(this.limitOrigin)}return Array.isArray(e)||(e=[e]),this.rateLimiter().isMaxReached()||this.rateLimiter().isMaxPerSecondReached()?(this.rateLimiter().notified=!0,this.notifyWhenRateLimitReached(),this):(e.forEach(r=>{this.getOriginData().then(o=>{r.data.origin=o}),r.remotePath=this.settings.remote_path,r.localPath=this.settings.local_path}),this.executePayloadCallback(Sf.Sending,e),Et.client.send(new GM(this.uuid,e,this.prepareMeta(t))),this.rateLimiter().hit(),this.executePayloadCallback(Sf.Sent,e),this)}rateLimiter(){return Et._rateLimiter}async notifyWhenRateLimitReached(){if(this.rateLimiter().isNotified())return;const e=new FM("Rate limit has been reached...","Rate limit"),t=new GM(this.uuid,[e],[]);await Et.client.send(t),this.rateLimiter().notify()}standalone(e){typeof e<"u"&&(e.ray=qM,e.Ray=Et)}};ze(qo,"lockCounter",0),ze(qo,"defaultSettings",{not_defined:!0}),ze(qo,"client"),ze(qo,"projectName",""),ze(qo,"counters",new Mz),ze(qo,"limiters",new Tz),ze(qo,"interceptor",new WU),ze(qo,"fakeUuid"),ze(qo,"stopWatches",{}),ze(qo,"enabled",null),ze(qo,"macros",{}),ze(qo,"_rateLimiter",Mm.disabled());let js=qo;const qM=(...n)=>js.create().send(...n);var zz=Object.defineProperty,Gz=(n,e,t)=>e in n?zz(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Qs=(n,e,t)=>(Gz(n,typeof e!="symbol"?e+"":e,t),t);const oA=n=>{const e=(n==null?void 0:n.name)??"unknown";let t=(n==null?void 0:n.__file)??"src/unknown.js";return e.length&&e!=="unknown"?e:(t=t.split("/").pop()??"unknown.js",t.replace(/\.[\w-_]+$/,""))},Zc=(n,e,t=null)=>{if(t=t??Za.methods.$ray,e.type&&(e=e.type),!((e==null?void 0:e.__file)??!1))return;const r=oA(e);let o=t;typeof t=="function"&&(o=t()),o.table([`component: <code class="text-green-600 font-bold bold">${r}</code>`,`lifecycle event: <code class="text-blue-600">${n}</code>`,`filename: <code class="text-gray-700">${(e==null?void 0:e.__file)??"unknown.js"}</code>`])},Za={beforeMount(n,e=null){Zc("before-mount",n,e)},beforeUnmount(n,e=null){Zc("before-unmount",n,e)},created(n,e=null){Zc("created",n,e)},mounted(n,e=null){Zc("mounted",n,e)},unmounted(n,e=null){Zc("unmounted",n,e)},updated(n,e=null){Zc("updated",n,e)},methods:{$ray(n){return ZM(n)}}};class KM extends js{constructor(){super(...arguments),Qs(this,"component",{$data:{},$refs:{}}),Qs(this,"$watch",()=>{})}data(){if(this.component){let e=Object.assign({},this.component.data);delete e.trackingRays,delete e.trackingStops,e=Object.freeze(e),this.table([e],"Data")}}props(){this.component&&this.table([this.component.props])}element(e){var t,r;return(t=this.component)!=null&&t.refs[e]?this.html(((r=this.component)==null?void 0:r.refs[e]).outerHTML):this}track(e){if(this.component&&typeof this.component.trackingRays[e]>"u"){this.component.trackingRays[e]=Za.methods.$ray(this.component)(this.component.data.name);const t=(r,o)=>{this.component.trackingRays[e]=this.component.trackingRays[e].sendCustom([`<code style="font-weight: bold;">tracking: </code><code style="color: #16a34a;">${oA(this.component.type)}.data.${e}</code>`,`<hr width="33%" align="left" /><code style="color: #94a3b8;">new value: </code><code class="text-gray-500 bold font-bold">${Ol(r)}</div>`,`                               <code style="color: #94a3b8;">old value: </code><code class="text-gray-700">${Ol(o)}</code>`,`<hr width="33%" align="left" /><code style="color: #94a3b8;">changed at: </code><code style="color: #60a5fa;">${new Date().toISOString()}</div>`].join("<br>"),"Tracking Data")};this.component.trackingStops[e]=this.$watch(()=>this.component.data[e],t,{deep:!0})}}untrack(e){this.component&&typeof this.component.trackingStops[e]<"u"&&(this.component.trackingStops[e](),delete this.component.trackingStops[e]),this.component&&typeof this.component.trackingRays[e]<"u"&&delete this.component.trackingRays[e]}unwatch(e){this.component&&typeof this.component.trackingStops[e]<"u"&&(this.component.trackingStops[e](),delete this.component.trackingStops[e]),this.component&&typeof this.component.trackingRays[e]<"u"&&delete this.component.trackingRays[e]}watch(e,t){if(this.component&&typeof this.component.trackingRays[e]>"u"){this.component.trackingRays[e]=Za.methods.$ray(this.component)(t.value);const r=(o,i)=>{this.component.trackingRays[e]=this.component.trackingRays[e].sendCustom([`<code style="font-weight: bold;">watching: </code><code style="color: #16a34a;">${oA(this.component.type)}  Ref&lt;${e}&gt;</code>`,`<hr width="33%" align="left" /><code style="color: #94a3b8;">new value: </code><code class="text-gray-500 bold font-bold">${Ol(o)}</div>`,`                               <code style="color: #94a3b8;">old value: </code><code class="text-gray-700">${Ol(i)}</code>`,`<hr width="33%" align="left" /><code style="color: #94a3b8;">changed at: </code><code style="color: #60a5fa" class="text-gray-500 bold font-bold">${new Date().toISOString()}</div>`].join("<br>"),"Watching Ref")};this.component.trackingStops[e]=this.$watch(t,r,{deep:!0})}}static useDefaultSettings(e){return super.useDefaultSettings(e)}send(...e){return super.send(...e)}}function ZM(n){return function(...e){const t=KM.create();return t.component=n,t.$watch=dr,e.length&&t.send(...e),t}}class Hz{constructor(e=null,t=null,r=null){Qs(this,"window"),Qs(this,"ray"),Qs(this,"additionalInfoCallback",null),Qs(this,"onVueError",(o,i)=>{const a=this.additionalInfoHtml(o,i,"vue"),s=o.stack.replace(/^(\w+):(.+)$/m,'<div class="flex bg-white border-0"><div class="flex-row bg-white text-red-400 pr-1 pl-1 border border-1 border-red-400">$1</div><div style="padding-top: 0.25em;" class="flex-row">$2</div></div>').replace(/\n/,`Stack Trace:
`).replace(/ at ([^ ]+) (.*)$/gm,'<div class="inline"> at <span class="text-blue-700">$1</span> $2</div>');i.$ray().sendCustom(`<pre>${s}${a}</pre>`,"Error").small().red()}),Qs(this,"onWindowError",(o,i,a,s,l)=>{var c;const u=this.additionalInfoHtml(l,{message:o,source:i,lineno:a,colno:s},"error"),d=`
        <div class="flex bg-white border-0">
            <div class="flex-row bg-white text-red-400 pr-1 pl-1 border border-1 border-red-400">${o}</div>
            <div style="padding-top: 0.25em;" class="flex-row"><code>${i}</code></div>
        </div>${u}`;(c=this.ray)==null||c.html(`<pre>${d}</pre>`,"Error").small().red()}),Qs(this,"onWindowUnhandledRejectionEvent",o=>{var i;const a=this.additionalInfoHtml(null,o,"unhandled_rejection"),s=`
        <div class="flex bg-white border-0">
            <div class="flex-row bg-white text-red-400 pr-1 pl-1 border border-1 border-red-400">${o.reason}</div>
            <div style="padding-top: 0.25em;" class="flex-row"><code>${JSON.stringify(o)}</code></div>
        </div>${a}`;(i=this.ray)==null||i.html(`<pre>${s}</pre>`,"Error").small().red()}),this.additionalInfoCallback=e,this.ray=r??Za.methods.$ray(Po()),this.window=t??globalThis}additionalInfo(e,t,r){return this.additionalInfoCallback?this.additionalInfoCallback(e,t,r):""}additionalInfoHtml(e,t,r){let o=this.additionalInfo(e,t,r);return typeof o=="string"&&o.length===0?"":typeof o!="string"&&typeof o!="number"?(o=Ol(o,{indent:4,highlight:!0}),`<details open><summary class="text-black w-full block mt-1 cursor-pointer">Additional Info:</summary><div class="text-blue-600 w-full block pl-8">${o}</div></details>`):`<div class="text-black w-full block mt-1">Additional Info:</div><div class="text-blue-600 w-full block pl-8">${o}</div>`}installVueErrorHandler(e){return e.errorHandler=this.onVueError,e}installWindowErrorHandlers(e=null,t=null){this.window&&(this.window.onerror=e??this.onWindowError,this.window.unhandledrejection=t??this.onWindowUnhandledRejectionEvent)}}new Hz;function Wz(n={},e=null){var t,r,o,i,a,s,l,c,u,d,f,h,p,m,g,_;e=e??Po();const A=ZM(e);if(n||(n={}),e.$ray=A,e.trackingRays={},e.trackingStops={},(t=n==null?void 0:n.connection)!=null&&t.host||(r=n==null?void 0:n.connection)!=null&&r.port){const y={};(o=n.connection)!=null&&o.port&&(y.port=n.connection.port),(i=n.connection)!=null&&i.host&&(y.host=n.connection.host),KM.useDefaultSettings(y)}return n.lifecycleEvents=n.lifecycleEvents??{},n.lifecycleEvents.all=((a=n.lifecycleEvents)==null?void 0:a.all)??!1,((s=n.lifecycleEvents)==null?void 0:s.all)===!0&&(n.lifecycleEvents.beforeMount=!0,n.lifecycleEvents.beforeUnmount=!0,n.lifecycleEvents.updated=!0,n.lifecycleEvents.mounted=!0,n.lifecycleEvents.unmounted=!0),(l=n.lifecycleEvents)!=null&&l.beforeMount&&(((c=n.lifecycleMethods)==null?void 0:c.beforeMount)??gE)(()=>Za.beforeMount(e,A())),(u=n.lifecycleEvents)!=null&&u.beforeUnmount&&(((d=n.lifecycleMethods)==null?void 0:d.beforeUnmount)??Fc)(()=>Za.beforeUnmount(e,A())),(f=n.lifecycleEvents)!=null&&f.updated&&(((h=n.lifecycleMethods)==null?void 0:h.updated)??_E)(()=>Za.updated(e,A())),(p=n.lifecycleEvents)!=null&&p.mounted&&(((m=n.lifecycleMethods)==null?void 0:m.mounted)??$o)(()=>Za.mounted(e,A())),(g=n.lifecycleEvents)!=null&&g.unmounted&&(((_=n.lifecycleMethods)==null?void 0:_.unmounted)??Wd)(()=>Za.unmounted(e,A())),vt(e.$ray)}const zi=(n,e)=>{const t=n.__vccOpts||n;for(const[r,o]of e)t[r]=o;return t},jz={class:"rounded-xl mb-[8px] md:mb-[10px] xl:mb-5"},Qz={class:"flex items-center space-x-4"},$z={class:"text-base md:text-lg font-medium"},Yz={id:"divContent",class:"bg-gray-50 px-4 py-2 rounded-b-xl"},iA=zi({__name:"Tab",props:{label:{type:String},modelValue:String,tabNumber:{type:String}},emits:["update:modelValue"],setup(n,{emit:e}){const t=n,r=e;return(o,i)=>(he(),ye("div",jz,[K("div",{class:Qt(["h-tabheight-sm md:h-tabheight-md lg:h-tabheight-lg p-[10px] lg:p-5 cursor-pointer select-none rounded-xl flex items-center justify-between w-full transition-colors duration-300 group",n.modelValue==n.tabNumber?"bg-secondary-green text-white":"bg-white text-secondary-green"]),onClick:i[0]||(i[0]=a=>n.modelValue==n.tabNumber?r("update:modelValue",""):r("update:modelValue",t.tabNumber))},[K("div",Qz,[K("div",{class:Qt(["w-8 h-8 border rounded-full flex items-center justify-center text-base lg:text-lg ",n.modelValue==n.tabNumber?"border-white text-white":"border-text-secondary-green text-secondary-green"])},Ae(n.tabNumber),3),K("span",$z,Ae(n.label),1)]),K("div",{class:Qt(["w-15 lg:w-16 h-10 md:h-12 rounded-md flex items-center justify-center transition-colors duration-300 ",n.modelValue==n.tabNumber?"bg-tertiary-green":"bg-background-light group-hover:bg-secondary-green"])},[(he(),ye("svg",{class:Qt(["group-hover:text-white duration-300",n.modelValue==n.tabNumber?"text-white rotate-90":"text-secondary-green rotate-0"]),width:"17",height:"11",viewBox:"0 0 17 11",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[...i[1]||(i[1]=[K("path",{d:"M16.457 5.79239L11.957 10.2924L11.6133 10.6361L10.8945 9.91739L11.2695 9.57364L14.8945 5.91739L1.30078 5.91739L0.800781 5.91739L0.800781 4.91739L1.30078 4.91739L14.8945 4.91739L11.2383 1.29239L10.8945 0.917391L11.6133 0.229891L11.957 0.573641L16.457 5.07364L16.8008 5.41739L16.457 5.79239Z",fill:"currentColor"},null,-1)])],2))],2)],2),Kn(K("div",Yz,[Ro(o.$slots,"default",{},void 0,!0)],512),[[hC,n.modelValue==n.tabNumber]])]))}},[["__scopeId","data-v-35c45e13"]]),Pr=1,JM=Zr({internalOverrideLimits:!1}),Ve={maximaleTotaleBreedteCm:600,maximaleTotaleHoogteCm:400,maximaleTotaleHoogteCmMetZijpanelen:300,get zijPaneelMinBreedte(){return Kz(20,10)},zijPaneelMaxBreedte:150,maxZijpanelenLinks:4,maxZijpanelenRechts:4,bovenLichtMinHoogte:20,bovenLichtMaxHoogte:150,vasteWandMinPanelen:1,vasteWandMaxPanelen:6,vasteWandMaxLiggers:4,vasteWandMaxStaanders:4,vasteWandMinBreedte:15,vasteWandMaxBreedte:150,vasteWandMinHoogte:30,vasteWandMaxHoogte:300,vasteWandOffsetMmLiggerStripRoede:30,vasteWandOffsetMmLiggerTRoede:17,taatsDeurSpelingMm:5,taatsDeurMinDeuren:1,taatsDeurMaxDeuren:2,taatsDeurMaxLiggers:4,taatsDeurMaxStaanders:4,taatsDeurMinBreedte:30,taatsDeurMaxBreedte:150,taatsDeurMinHoogte:150,taatsDeurMaxHoogte:300,taatsDeurDefaultBreedteZijpaneel:60,taatsDeurMinBreedteZijpaneel:25,taatsDeurMaxBreedteZijpaneel:150,taatsDeurMinHoogteZijpaneel:150,taatsDeurMaxHoogteZijpaneel:300,taatsDeurHandGreepMinHoogte:90,taatsDeurHandGreepMaxHoogte:120,taatsDeurHandGreepDefaultHoogte:105,taatsDeurHandgreepProfiellengteOffset:150,taatsDeurHandgreepOffset:17,taatsDeurOffsetMmLiggerStripRoede:35,taatsDeurOffsetMmLiggerTRoede:22,taatsDeurOffsetMmHandgreep:17,scharnierDeurMinBreedte:50,scharnierDeurMaxBreedte:120,scharnierDeurMinHoogte:150,scharnierDeurMaxHoogte:300,scharnierDeurMinDeuren:1,scharnierDeurMaxDeuren:2,scharnierDeurMaxZijpanelenLinks:4,scharnierDeurMaxZijpanelenRechts:4,scharnierDeurMinBreedteZijpaneel:25,scharnierDeurMaxBreedteZijpaneel:150,scharnierDeurMinHoogteZijpaneel:150,scharnierDeurMaxHoogteZijpaneel:300,scharnierDeurOffsetMmLiggerStripRoede:36.5,scharnierDeurOffsetMmLiggerTRoede:23.5,scharnierDeurKozijnBreedteMm:17,scharnierDeurFrameBreedteMm:31.5,scharnierDeurSpelingMm:5,scharnierDeurSmalslotStijlBreedteMm:30,scharnierDeurOffsetMmHandgreep:18.5,scharnierDeurProfielSlotstijl:23.5,scharnierDeurValdorpelBreedteMinCm:71,scharnierDeurValdorpelBreedteMaxCm:120,schuifDeurMinBreedte:50,schuifDeurMaxBreedte:150,schuifDeurMinDeuren:1,schuifDeurMaxDeuren:6,schuifDeurMinHoogte:150,schuifDeurMaxHoogte:300,schuifDeurOffsetMmLiggerStripRoede:30,schuifDeurOffsetMmLiggerTRoede:17,schuifDeurOffsetMmHandgreep:17,opdekDeurMinDeuren:1,opdekDeurMaxDeuren:1,opdekDeurMinBreedte:50,opdekDeurMaxBreedte:110,opdekDeurMinHoogte:150,opdekDeurMaxHoogte:280,opdekDeurOffsetMmLiggerStripRoede:33.5,opdekDeurOffsetMmLiggerTRoede:20.5,opdekDeurOffsetMmHandgreep:27.5,vouwwandMinPanelen:2,vouwwandMaxPanelen:7,vouwwandMaxLiggers:4,vouwwandMinBreedte:50,vouwwandMaxBreedte:95,vouwwandMinHoogte:150,vouwwandMaxHoogte:300,vouwwandOffsetMmLiggerStripRoede:10,vouwwandOffsetMmHandgreep:22.5},Xz={indexKey:"",name:"Configuratie",style:"style-1",type:"taatsdeur",deur_aantal:1,breedte:90,hoogte:250,deurbreedtevariabel:!1,bovenlicht:!1,bovenlicht_verberg_tussenstijl:!1,bovenlicht_stijl_zijpaneel:!1,hoogtebovenlicht:20,deurbreedtematen:[],deur_aantal_ligger:2,asymmetrisch:!1,asymmetrisch_ligger_maten:[],asymmetrisch_staander_maten_deur:[],asymmetrisch_staander_maten_zijpaneel:[],deur_aantal_staander:0,zijpaneel:"",zijpaneel_aantal_staander:0,zijpaneel_aantal_links:0,zijpaneel_aantal_rechts:0,zijpaneel_breedte_links:[],zijpaneel_breedte_rechts:[],kleur_materiaal:"KLEUR_ALUMINIUM_ZWART",kleur_ral:9001,ral_opmerking:"",kleur_glas:"GLAS_BLANK",handgreep:"HANDGREEP_HOEK",typeroede:"PLATTE_ROEDE",draairichting:"DRAAI_NTB",schuifrichting:"SCHUIF_NTB",actievedeur:"ACTIEVEDEUR_NTB",materiaalsoortbestaandkozijn:"",antikalk:!1,tienmmglas:!1,verbergtussenstaanders:!0,softclose:!1,verberg_rail_in_wand:!1,softclose_dubbel:!1,fineer:!1,ondergeleiding:!1,industrielerail:!1,hogeonderdorpel:!1,opm_actievedeur:"",opm_draairichting:"",opm_schuifrichting:"",valdorpel:!1,variabeledeurbreedte_maten:[],cilinder:!1,type_vergrendeling:"geen",hoekkoker_aantal:0,stabilisatie_aantal:0,opmerking:"",date_created:new Date,price:0,vat:0,maatvoering_weergeven:!1,roede_configuratie:"RV09",roede_design_keuze:!1,roede_design_roedes_doorlopen_zijlicht_bovenlicht:!1},qz=[{value:"RV01",label:"De Bergense",tooltip:"",imageSrc:"/Uploads/aluwdoors-configurator-roedeconfiguratie-rv01-de-bergense.svg",svg:`   <svg width="50" height="75" viewBox="0 0 50 75" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M25 62V58M25 13V17M34.5 40H30.5M12 40H16M34 34.5V17H16V58H34V45.5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" />
                        <path d="M38 62V13H12V62H38Z" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" />
                        <path d="M34 34.5C29 37 29 43 34 45.5M38 36.5C33.5 37.5 33.5 42.5 38 43.5" stroke="currentColor" stroke-linecap="round" />
                    </svg>`},{value:"RV02",label:"De Brabantse",tooltip:"",svg:`  <svg width="50" height="75" viewBox="0 0 50 75" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M38 13V62H12V13H38Z" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" />
                        <path d="M25 62V52.1914M25 13V22.8086M31.5 22.8086V52.1914H18.5V22.8086H31.5Z" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" />
                    </svg>`},{value:"RV03",label:"De Dokkumse",tooltip:"",svg:`<svg width="50" height="75" viewBox="0 0 50 75" fill="none" xmlns="http://www.w3.org/2000/svg">

                        <path d="M38 62V13H12V62H38Z" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" />
                        <path d="M17 13V62H33V13H17Z" stroke="currentColor" stroke-linejoin="round" />
                        <path d="M12 19L38 19" stroke="currentColor" stroke-linejoin="round" />
                        <path d="M17.0056 29C17.0056 15.6667 33.4941 15.6667 32.9944 29" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" />
                    </svg>`},{value:"RV04",label:"De Friesse",tooltip:"",svg:`<svg width="50" height="75" viewBox="0 0 50 75" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M30.2045 42.3827L29.8377 42.4259H29.4708L29.104 42.5123L28.7371 42.5988L28.3703 42.6852L28.0493 42.8148L27.7283 42.9876L27.4073 43.1605L27.0863 43.3765L26.8112 43.5926L26.5361 43.8086L26.261 44.0679L26.0317 44.3704L25.8482 44.6296L25.619 44.9321L25.4814 45.2778L25.3438 45.5802L25.2063 45.9259L25.1146 46.2716L25.0687 46.5741L25.0229 46.9629V47.3086M22.4091 32.5741L22.0423 32.6173L21.6754 32.6605L21.3086 32.7037L20.9417 32.7901L20.5749 32.9197L20.2539 33.0494L19.887 33.179L19.6119 33.3518L19.2909 33.5679L19.0158 33.7839L18.7407 34.0432L18.4655 34.3025L18.2363 34.5617L18.007 34.8642L17.8236 35.1667L17.686 35.4691L17.5484 35.7716L17.4109 36.1173L17.3192 36.4629L17.2733 36.8086L17.2274 37.1543L17.1816 37.5M27.5908 20.3457H27.9576L28.3244 20.3889L28.6913 20.4753L29.0581 20.5617L29.425 20.6481L29.746 20.7778L30.1128 20.9506L30.3879 21.1234L30.7089 21.3395L30.9841 21.5555L31.2592 21.7716L31.5343 22.0309L31.7636 22.2901L31.9929 22.5926L32.1763 22.895L32.3139 23.1975L32.4514 23.5432L32.589 23.8457L32.6807 24.1913L32.7266 24.537L32.7724 24.8827L32.8183 25.2284" stroke="currentColor" stroke-miterlimit="10" />
                        <path d="M38 13V62H12V13H38Z" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" />
                        <path d="M25.0229 47.3086V62M38 42.3827H30.2046M17.1817 37.5V62M38 32.5741H22.4092M32.8183 25.2284V62M12 20.3457H27.5908" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" />
                    </svg>`},{value:"RV05",label:"De Giethoornse",tooltip:"??",svg:`<svg width="50" height="75" viewBox="0 0 50 75" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M38 62V13H12V62H38Z" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" />
                        <path d="M12 23C29 27 29 48 12 52M38 57C12 52 12 23 38 18" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" />
                    </svg>`},{value:"RV06",label:"De Goudse",tooltip:"??",svg:`<svg width="50" height="75" viewBox="0 0 50 75" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M25 13L12 37.5L25 62L38 37.5L25 13Z" stroke="currentColor" stroke-linejoin="round" />
                        <path d="M38 62V13H12V62H38Z" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" />
                    </svg>`},{value:"RV07",label:"De Hollandse",tooltip:"??",svg:`<svg width="50" height="75" viewBox="0 0 50 75" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M27 62V13M23 62V13" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" />
                        <path d="M38 62V13H12V62H38Z" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" />
                        <path d="M37.2205 33.1667L37.4039 33.7169L37.5873 34.2672L37.7249 34.8633L37.8166 35.4136L37.9083 36.0097L37.9542 36.56L38 37.1561V37.7522L37.9542 38.3483L37.9083 38.8986L37.8166 39.4947L37.7249 40.045L37.5873 40.6411L37.4497 41.1914L37.2663 41.7416L37.0829 42.2919L36.8536 42.8422L36.5785 43.3466L36.3033 43.8968L36.0282 44.3554L35.7072 44.8598L35.3862 45.3183L35.0194 45.7769L34.6067 46.2355L34.2399 46.6481L33.7813 47.0608L33.3686 47.4735L32.9101 47.8404L32.4515 48.1614L31.9471 48.4824L31.4427 48.8034L30.9383 49.0785L30.4339 49.3078L29.8836 49.537L29.3334 49.7663L28.7831 49.9497L28.2328 50.0873L27.6367 50.2249L27.0864 50.3624L26.4903 50.4083L25.94 50.5H24.1517L23.6014 50.4541L23.0053 50.3624L22.455 50.2707L21.8589 50.1332L21.3087 49.9956L20.7584 49.8122L20.2081 49.5829L19.6579 49.3995L19.1535 49.1243L18.6032 48.8492L18.1446 48.5741L17.6402 48.2531L17.1817 47.8862L16.7231 47.5194L16.2646 47.1526L15.8519 46.7399L15.4392 46.3272L15.0265 45.9145L14.6596 45.4559L14.3386 44.9515L14.0176 44.4929L13.6967 43.9885L13.4215 43.4841L13.1923 42.9339L12.963 42.4295L12.7337 41.8792L12.5503 41.3289L12.4127 40.7328L12.2751 40.1825L12.1376 39.6323L12.0917 39.0362L12 38.44V36.6975L12.0459 36.1473L12.1376 35.5511L12.2293 34.955L12.3669 34.4048L12.5044 33.8545L12.6878 33.3042L12.9171 32.754L13.1005 32.2037L13.3757 31.6534L13.6508 31.149L13.9259 30.6446L14.2469 30.1861L14.6138 29.6817L14.9806 29.2231L15.3475 28.8104L15.7601 28.3519L16.1729 27.985L16.5855 27.5723L17.0441 27.2055L17.5485 26.8845L18.0071 26.5635L18.5115 26.2425L19.0159 25.9674L19.5661 25.6922L20.0706 25.463L20.6208 25.2795L21.1711 25.0961L21.7672 24.9127L22.3175 24.7751L22.8677 24.6834L23.4638 24.5917L24.06 24.5459L24.6102 24.5H25.2064L25.8025 24.5459L26.3528 24.5917L26.9489 24.6834L27.545 24.7751L28.0953 24.9127L28.6455 25.0503L29.1958 25.2337L29.746 25.4171L30.2963 25.6464L30.8466 25.9215L31.351 26.1966L31.8554 26.4718L32.314 26.7928L32.8183 27.1138L33.2769 27.4806L33.6896 27.8933L34.1482 28.2601L34.515 28.7187L34.9277 29.1314L35.2945 29.5899L35.6155 30.0485L35.9365 30.5529L36.2575 31.0573L36.5326 31.5617L36.8078 32.0661L37.037 32.6164L37.2205 33.1667Z" stroke="currentColor" stroke-miterlimit="10" />
                    </svg>`},{value:"RV08",label:"De Laarbeekse",tooltip:"??",svg:`<svg width="50" height="75" viewBox="0 0 50 75" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M18 13V51M38 56H23M32 62V24M27 19H12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" />
                        <path d="M38 62V13H12V62H38Z" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" />
                        <path d="M27 19C30 19 32 21 32 24M23 56C20 56 18 54 18 51" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" />
                    </svg>`},{value:"RV10",label:"De Nunspeetse",tooltip:"??",svg:` <svg width="50" height="75" viewBox="0 0 50 75" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M18.4654 39.963L18.5113 39.2285L18.5571 38.4939L18.603 37.7593L18.6947 37.068L18.8322 36.3334L18.9698 35.6421L19.1074 34.9507L19.3366 34.2161L19.5659 33.5248L19.7952 32.8766L20.0703 32.1853L20.3455 31.5371L20.6665 30.8458L21.0333 30.1976L21.4001 29.5927L21.767 28.9445L22.1797 28.3396L22.6382 27.7347L23.0968 27.1729L23.5553 26.6112L24.0597 26.0495L24.5642 25.5309L25.1144 25.0124L25.6647 24.4939L26.215 24.0186L26.8111 23.5865L27.4531 23.1112L28.0492 22.7223L28.6912 22.2902L29.3331 21.9013L30.0209 21.5556L30.7088 21.21L31.3966 20.9075L32.0844 20.605L32.7723 20.3458L33.506 20.0865L34.2396 19.8705L34.9733 19.6976L35.707 19.4816L36.4866 19.3519L37.2202 19.2223L37.9998 19.1359" stroke="currentColor" stroke-miterlimit="10" />
                        <path d="M12 62V13H38V62H12Z" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" />
                        <path d="M18.4656 62V39.9629" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" />
                    </svg>`},{value:"RV11",label:"De Utrechtse",tooltip:"??",svg:`<svg width="50" height="75" viewBox="0 0 50 75" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M25.0199 16.6728V13M34 26.4815V62M16 62V26.4815" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" />
                        <path d="M38 62V13H12V62H38Z" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" />
                        <path d="M16 27V26.4714L16.0397 25.9868L16.0795 25.4582L16.1589 24.9736L16.2781 24.489L16.3974 24.0044L16.5563 23.5198L16.7152 23.0352L16.9139 22.5947L17.1126 22.1542L17.351 21.7137L17.5894 21.2731L17.8675 20.8767L18.1457 20.4802L18.4636 20.0837L18.7815 19.7313L19.1391 19.4229L19.4967 19.0705L19.8543 18.8062L20.2517 18.4978L20.6093 18.2335L21.0464 18.0132L21.4437 17.793L21.8808 17.6167L22.3179 17.4405L22.755 17.3084L23.1921 17.2203L23.6291 17.1322L24.106 17.0441L24.543 17H25.457L25.894 17.0441L26.3709 17.1322L26.8079 17.2203L27.245 17.3084L27.6821 17.4405L28.1192 17.6167L28.5563 17.793L28.9536 18.0132L29.3907 18.2335L29.7483 18.4978L30.1457 18.8062L30.5033 19.0705L30.8609 19.4229L31.2185 19.7313L31.5364 20.0837L31.8543 20.4802L32.1324 20.8767L32.4106 21.2731L32.649 21.7137L32.8874 22.1542L33.0861 22.5947L33.2848 23.0352L33.4437 23.5198L33.6026 24.0044L33.7219 24.489L33.8411 24.9736L33.9205 25.4582L33.9603 25.9868L34 26.4714V27" stroke="currentColor" stroke-miterlimit="10" />
                    </svg>`},{value:"RV12",label:"De Veluwse",tooltip:"??",svg:`<svg width="50" height="75" viewBox="0 0 50 75" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M18 62V13M38 19H12M31 19C24 19 18 25 18 32" stroke="currentColor" stroke-linejoin="round" />
                        <path d="M38 62V13H12V62H38Z" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" />
                    </svg>`},{value:"RV13",label:"De Waterlandse",tooltip:"??",svg:`<svg width="50" height="75" viewBox="0 0 50 75" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M17 62V25M22 20C28.2484 20 31.7516 20 38 20M22 62C22 50.2843 22 43.7157 22 32M27 27C31.2958 27 33.7042 27 38 27" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" />
                        <path d="M38 62V13H12V62H38Z" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" />
                        <path d="M17 25C17 22 19 20 22 20M22 32C22 29 24 27 27 27" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" />
                    </svg>`},{value:"RV14",label:"De Zaanse",tooltip:"??",svg:`<svg width="50" height="75" viewBox="0 0 50 75" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M19 32V31.4912L19.0458 30.9399L19.1373 30.3887L19.2289 29.8799L19.3204 29.3286L19.4577 28.8198L19.6408 28.311L19.8239 27.8021L20.0528 27.2933L20.2817 26.7845L20.5563 26.318L20.831 25.8516L21.1514 25.3852L21.4718 24.9611L21.838 24.5371L22.2042 24.1131L22.6162 23.7314L23.0282 23.3498L23.4401 22.9682L23.8979 22.629L24.3556 22.2898L24.8134 21.9929L25.3169 21.6961L25.8204 21.4417L26.3697 21.1873L26.8732 20.9753L27.4225 20.7633L27.9718 20.5936L28.5211 20.424L29.0704 20.2968L29.6655 20.212L30.2148 20.1272L30.8099 20.0424L31.4049 20H32" stroke="currentColor" stroke-miterlimit="10" />
                        <path d="M12 62V13H38V62H12Z" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" />
                        <path d="M32 20H38M19 32V48H12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" />
                    </svg>`},{value:"RV15",label:"De Kinderdijkse",tooltip:"??",svg:`<svg width="50" height="75" viewBox="0 0 50 75" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M25 13V19.5M25 19.5L19 25.5M25 19.5L31 25.5M25 62V55.5M25 55.5L19 49.5M25 55.5L31 49.5M19 49.5L25 43.5M19 49.5H12M25 43.5L31 49.5M25 43.5L19 37.5M25 43.5L31 37.5M31 49.5H38M19 37.5L25 31.5M19 37.5H12M25 31.5L31 37.5M25 31.5L31 25.5M25 31.5L19 25.5M31 37.5H38M31 25.5H38M19 25.5H12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" />
                        <path d="M38 62V13H12V62H38Z" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" />
                    </svg>`},{value:"RV16",label:"De Kampense",tooltip:"??",svg:`<svg width="50" height="75" viewBox="0 0 50 75" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M25 13V24M25 62V51M38 44H32M12 31H18" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" />
                        <path d="M38 62V13H12V62H38Z" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" />
                        <path d="M25 24C25 28 22 31 18 31M25 51C25 47 28 44 32 44" stroke="currentColor" stroke-linecap="round" />
                    </svg>`}],aA={RV01:{Links:{1:{min_hoogte:750,max_hoogte:1500}},Rechts:{1:{min_hoogte:750,max_hoogte:1500}},Boven:{1:{min_breedte:250,max_breedte:750}}},RV02:{Boven:{1:{min_breedte:250,max_breedte:750}}},RV03:{Links:{1:{min_hoogte:1285,max_hoogte:2785}},Rechts:{1:{min_hoogte:1285,max_hoogte:2785}},Boven:{1:{min_breedte:90,max_breedte:215},2:{min_breedte:410,max_breedte:1285}}},RV04:{Links:{1:{min_hoogte:915,max_hoogte:1815},2:{min_hoogte:515,max_hoogte:1315}},Rechts:{1:{min_hoogte:1385,max_hoogte:2685}}},RV05:{Links:{1:{min_hoogte:1660,max_hoogte:2410,min_breedte:1810,max_breedte:2410},2:{min_hoogte:-160,max_hoogte:590,min_breedte:1210,max_breedte:590}},Rechts:{1:{min_hoogte:1960,max_hoogte:2710,min_breedte:1910,max_breedte:2710},2:{min_hoogte:-460,max_hoogte:290,min_breedte:1110,max_breedte:290}}},RV06:{Links:{1:{min_hoogte:750,max_hoogte:1500}},Rechts:{1:{min_hoogte:750,max_hoogte:1500}},Boven:{1:{min_breedte:250,max_breedte:750}}},RV07:{Boven:{1:{min_breedte:160,max_breedte:660},2:{min_breedte:340,max_breedte:840}}},RV08:{Links:{1:{min_hoogte:1335,max_hoogte:2685}},Rechts:{1:{min_hoogte:165,max_hoogte:315}},Boven:{1:{min_breedte:115,max_breedte:315}}},RV09:{Links:{},Rechts:{}},RV10:{Links:{},Rechts:{1:{min_hoogte:1335,max_hoogte:2685}}},RV11:{Boven:{1:{min_breedte:250,max_breedte:750}}},RV12:{Links:{1:{min_hoogte:1235,max_hoogte:2735}},Rechts:{1:{min_hoogte:1235,max_hoogte:2735}},Boven:{1:{min_breedte:165,max_breedte:265}}},RV13:{Links:{},Rechts:{1:{min_hoogte:1315,max_hoogte:2615},2:{min_hoogte:1015,max_hoogte:2115}}},RV14:{Links:{1:{min_hoogte:315,max_hoogte:615}},Rechts:{1:{min_hoogte:1285,max_hoogte:2685}}},RV15:{Links:{1:{min_hoogte:1555,max_hoogte:2305,min_breedte:0,max_breedte:0,min_compensatie:1882,max_compensatie:2305},2:{min_hoogte:750,max_hoogte:1500,min_compensatie:1500,max_compensatie:1500},3:{min_hoogte:-55,max_hoogte:695,min_compensatie:1118,max_compensatie:695}},Rechts:{1:{min_hoogte:1555,max_hoogte:2305,min_compensatie:1882,max_compensatie:2305},2:{min_hoogte:750,max_hoogte:1500,min_compensatie:1500,max_compensatie:1500},3:{min_hoogte:-55,max_hoogte:695,min_compensatie:1118,max_compensatie:695}},Boven:{1:{min_breedte:250,max_breedte:750}}},RV16:{Links:{1:{min_hoogte:750,max_hoogte:2115}},Rechts:{1:{min_hoogte:750,max_hoogte:885}},Boven:{1:{min_breedte:250,max_breedte:750}}}},sA=[{value:"KLEUR_ALUMINIUM_ZWART",label:"step3.material_colours.black",image:"/Uploads/aluwdoors-configurator-metaalkleur-zwart.jpg",tooltip:"step3.material_colours_tooltip.black",visible:["vaste-wand","taatsdeur","scharnierdeur","schuifdeur","opdekdeur","vouwwand"]},{value:"KLEUR_ALUMINIUM_BRONS",label:"step3.material_colours.bronze",image:"/Uploads/aluwdoors-configurator-metaalkleur-brons.jpg",tooltip:"step3.material_colours_tooltip.bronze",visible:["vaste-wand","taatsdeur","scharnierdeur","schuifdeur","opdekdeur"]},{value:"KLEUR_ALUMINIUM_ANTRACIET",label:"step3.material_colours.black_grey",image:"/Uploads/aluwdoors-configurator-metaalkleur-antraciet.jpg",tooltip:"step3.material_colours_tooltip.black_grey",visible:["vaste-wand","taatsdeur","scharnierdeur","schuifdeur","opdekdeur"]},{value:"KLEUR_ALUMINIUM_BEIGE",label:"step3.material_colours.light_grey",image:"/Uploads/aluwdoors-configurator-metaalkleur-beige.jpg",tooltip:"step3.material_colours_tooltip.light_grey",visible:["vaste-wand","taatsdeur","scharnierdeur","schuifdeur","opdekdeur"]},{value:"KLEUR_ALUMINIUM_GOLD",label:"step3.material_colours.gold",image:"/Uploads/aluwdoors-configurator-metaalkleur-goud.jpg",tooltip:"step3.material_colours_tooltip.gold",visible:["vaste-wand","taatsdeur","scharnierdeur","schuifdeur","opdekdeur"]},{value:"KLEUR_ALUMINIUM_RAL",label:"step3.material_colours.ral",image:"/Uploads/aluwdoors-configurator-metaalkleur-ral-keuze.jpg",tooltip:"step3.material_colours_tooltip.ral",visible:["vaste-wand","taatsdeur","scharnierdeur","schuifdeur","opdekdeur"]}],lA=[{value:"FINEER_RM_21_NATURAL",label:"step3.veneer_colours.natural",image:"/Uploads/RMC-Oil-Plus-2C_21-Natural_Print.jpg",tooltip:"Fineer",visible:["vaste-wand","taatsdeur","scharnierdeur","schuifdeur","opdekdeur"]},{value:"FINEER_RM_10_CHOCOLATE",label:"step3.veneer_colours.chocolate",image:"/Uploads/RMC-Oil-Plus-2C_10-Chocolate_Print.jpg",tooltip:"Fineer",visible:["vaste-wand","taatsdeur","scharnierdeur","schuifdeur","opdekdeur"]}],eT=[{value:"GLAS_BLANK",label:"step3.glass_colours.clear",image:"/Uploads/aluwdoors-configurator-glaskleur-blank.jpg",tooltip:"Transparant glas zonder kleuring",visible:["vaste-wand","taatsdeur","scharnierdeur","schuifdeur","opdekdeur","vouwwand"]},{value:"GLAS_BRONS",label:"step3.glass_colours.bronze_clear",image:"/Uploads/aluwdoors-configurator-glaskleur-brons.jpg",tooltip:"Licht getint glas met bronskleur",visible:["vaste-wand","taatsdeur","scharnierdeur","schuifdeur","opdekdeur"]},{value:"GLAS_GRIJS",label:"step3.glass_colours.grey_clear",image:"/Uploads/aluwdoors-configurator-glaskleur-grijs.jpg",tooltip:"Donker getint glas met grijstint",visible:["vaste-wand","taatsdeur","scharnierdeur","schuifdeur","opdekdeur"]},{value:"GLAS_BRONS_MAT",label:"step3.glass_colours.bronze_satin",image:"/Uploads/aluwdoors-configurator-glaskleur-mat-brons.jpg",tooltip:"Mat glas met bronskleurige tint",visible:["vaste-wand","taatsdeur","scharnierdeur","schuifdeur","opdekdeur"]},{value:"GLAS_MAT",label:"step3.glass_colours.satin",image:"/Uploads/aluwdoors-configurator-glaskleur-mat-blank.jpg",tooltip:"Mat glas zonder kleuring",visible:["vaste-wand","taatsdeur","scharnierdeur","schuifdeur","opdekdeur"]},{value:"GLAS_GRIJS_MAT",label:"step3.glass_colours.grey_satin",image:"/Uploads/aluwdoors-configurator-glaskleur-mat-zwart.jpg",tooltip:"Mat glas met grijstint",visible:["vaste-wand","taatsdeur","scharnierdeur","schuifdeur","opdekdeur"]}],cA=[{value:"HANDGREEP_HOEK",label:"step3.aluminium_handles.corner",image:"/Uploads/aluwdoors-configurator-handgreep-hoekgreep.svg",tooltip:"??",visible:["taatsdeur","scharnierdeur","schuifdeur"],activeFromVersion:0,activeToVersion:Pr},{value:"HANDGREEP_BUIS",label:"step3.aluminium_handles.tube",image:"/Uploads/aluwdoors-configurator-handgreep-buisgreep.svg",tooltip:"??",visible:["taatsdeur","scharnierdeur","schuifdeur"],activeFromVersion:0,activeToVersion:Pr},{value:"HANDGREEP_BEUGEL",label:"step3.aluminium_handles.bracket",image:"/Uploads/aluwdoors-configurator-handgreep-beugelgreep.svg",tooltip:"??",visible:["taatsdeur","scharnierdeur","schuifdeur"],activeFromVersion:0,activeToVersion:Pr},{value:"HANDGREEP_KOKER_VOLLEDIG",label:"step3.aluminium_handles.full_box",image:"/Uploads/aluwdoors-configurator-handgreep-buisgreep-volledig.svg",tooltip:"??",visible:["taatsdeur","scharnierdeur","schuifdeur"],activeFromVersion:0,activeToVersion:Pr},{value:"HANDGREEP_KOKERGREEP",label:"step3.aluminium_handles.box",image:"/Uploads/aluwdoors-configurator-handgreep-kokergreep.svg",tooltip:"??",visible:["taatsdeur","scharnierdeur","schuifdeur"],activeFromVersion:0,activeToVersion:Pr},{value:"HANDGREEP_MAANGREEP",label:"step3.aluminium_handles.moon",image:"/Uploads/aluwdoors-configurator-handgreep-maangreep.svg",tooltip:"??",visible:["taatsdeur","scharnierdeur","schuifdeur"],activeFromVersion:0,activeToVersion:Pr},{value:"HANDGREEP_KOMGREEP",label:"step3.aluminium_handles.bowl",image:"/Uploads/aluwdoors-configurator-handgreep-komgreep.svg",tooltip:"??",visible:["schuifdeur"],activeFromVersion:0,activeToVersion:Pr},{value:"HANDGREEP_GEEN",label:"step3.aluminium_handles.none",image:"/Uploads/aluwdoors-configurator-handgreep-greeploos.svg",tooltip:"??",visible:["taatsdeur","scharnierdeur","schuifdeur","vouwwand"],activeFromVersion:0,activeToVersion:Pr},{value:"HANDGREEP_KLINK_1",label:"step3.aluminium_handles.lever",image:"/Uploads/aluwdoors-configurator-handgreep-klink-1.svg",tooltip:"??",visible:["scharnierdeur","opdekdeur","vouwwand"],activeFromVersion:0,activeToVersion:Pr}],tT=[{value:"FINEER_HANDGREEP_HOEKGREEP",label:"step3.wooden_handles.corner",image:"/Uploads/aluwdoors-configurator-fineer-handgreep-hoekgreep.svg",tooltip:"??",visible:["taatsdeur","scharnierdeur","schuifdeur"],activeFromVersion:0,activeToVersion:Pr},{value:"FINEER_HANDGREEP_OVAALGREEP",label:"step3.wooden_handles.oval",image:"/Uploads/aluwdoors-configurator-fineer-handgreep-ovaalgreep.svg",tooltip:"??",visible:["taatsdeur","scharnierdeur","schuifdeur"],activeFromVersion:0,activeToVersion:Pr},{value:"FINEER_HANDGREEP_MAANGREEP",label:"step3.wooden_handles.moon",image:"/Uploads/aluwdoors-configurator-fineer-handgreep-maangreep.svg",tooltip:"??",visible:["taatsdeur","scharnierdeur","schuifdeur"],activeFromVersion:0,activeToVersion:Pr},{value:"FINEER_HANDGREEP_KOMGREEP",label:"step3.wooden_handles.bowl",image:"/Uploads/aluwdoors-configurator-fineer-handgreep-komgreep.svg",tooltip:"??",visible:["schuifdeur"],activeFromVersion:0,activeToVersion:Pr},{value:"FINEER_HANDGREEP_BEUGELGREEP",label:"step3.wooden_handles.bow",image:"/Uploads/aluwdoors-configurator-fineer-handgreep-beugelgreep.svg",tooltip:"??",visible:["taatsdeur","scharnierdeur","schuifdeur"],activeFromVersion:0,activeToVersion:Pr},{value:"FINEER_HANDGREEP_KOKERGREEP",label:"step3.wooden_handles.box",image:"/Uploads/aluwdoors-configurator-fineer-handgreep-kokergreep.svg",tooltip:"??",visible:["taatsdeur","scharnierdeur","schuifdeur"],activeFromVersion:10,activeToVersion:10},{value:"FINEER_HANDGREEP_HOEKGREEP_1050",label:"step3.wooden_handles.corner_1050",image:"/Uploads/aluwdoors-configurator-fineer-handgreep-hoekgreep-1050.svg",tooltip:"??",visible:["taatsdeur","scharnierdeur","schuifdeur"],activeFromVersion:0,activeToVersion:Pr},{value:"FINEER_HANDGREEP_HOEKGREEP_1200",label:"step3.wooden_handles.corner_1200",image:"/Uploads/aluwdoors-configurator-fineer-handgreep-hoekgreep-1200.svg",tooltip:"??",visible:["taatsdeur","scharnierdeur","schuifdeur"],activeFromVersion:10,activeToVersion:10},{value:"FINEER_HANDGREEP_GEEN",label:"step3.wooden_handles.none",image:"/Uploads/aluwdoors-configurator-fineer-handgreep-geen.svg",tooltip:"??",visible:["taatsdeur","scharnierdeur","schuifdeur"],activeFromVersion:0,activeToVersion:Pr}];function Kz(n,e){return JM.internalOverrideLimits?e:n}function nT(n){switch(n){case"vaste-wand":return Ve.vasteWandMinPanelen;case"taatsdeur":return Ve.taatsDeurMinDeuren;case"scharnierdeur":return Ve.scharnierDeurMinDeuren;case"schuifdeur":return Ve.schuifDeurMinDeuren;case"opdekdeur":return Ve.opdekDeurMinDeuren;case"vouwwand":return Ve.vouwwandMinPanelen;default:return 1}}function rT(n){switch(n){case"vaste-wand":return Ve.vasteWandMaxPanelen;case"taatsdeur":return Ve.taatsDeurMaxDeuren;case"scharnierdeur":return Ve.scharnierDeurMaxDeuren;case"schuifdeur":return Ve.schuifDeurMaxDeuren;case"opdekdeur":return Ve.opdekDeurMaxDeuren;case"vouwwand":return Ve.vouwwandMaxPanelen;default:return 1}}function oT(n){switch(n){case"vaste-wand":return Ve.vasteWandMinBreedte;case"taatsdeur":return Ve.taatsDeurMinBreedte;case"scharnierdeur":return Ve.scharnierDeurMinBreedte;case"schuifdeur":return Ve.schuifDeurMinBreedte;case"opdekdeur":return Ve.opdekDeurMinBreedte;case"vouwwand":return Ve.vouwwandMinBreedte;default:return 50}}function iT(n){switch(n){case"vaste-wand":return Ve.vasteWandMaxBreedte;case"taatsdeur":return Ve.taatsDeurMaxBreedte;case"scharnierdeur":return Ve.scharnierDeurMaxBreedte;case"schuifdeur":return Ve.schuifDeurMaxBreedte;case"opdekdeur":return Ve.opdekDeurMaxBreedte;case"vouwwand":return Ve.vouwwandMaxBreedte;default:return 100}}function aT(n){switch(n){case"vaste-wand":return Ve.vasteWandMinHoogte;case"taatsdeur":return Ve.taatsDeurMinHoogte;case"scharnierdeur":return Ve.scharnierDeurMinHoogte;case"schuifdeur":return Ve.schuifDeurMinHoogte;case"opdekdeur":return Ve.opdekDeurMinHoogte;case"vouwwand":return Ve.vouwwandMinHoogte;default:return 50}}function sT(n){switch(n){case"vaste-wand":return Ve.vasteWandMaxHoogte;case"taatsdeur":return Ve.taatsDeurMaxHoogte;case"scharnierdeur":return Ve.scharnierDeurMaxHoogte;case"schuifdeur":return Ve.schuifDeurMaxHoogte;case"opdekdeur":return Ve.opdekDeurMaxHoogte;case"vouwwand":return Ve.vouwwandMaxHoogte;default:return 300}}function Zz(n,e,t,r){return e&&(t>0||r>0)?Ve.maximaleTotaleHoogteCmMetZijpanelen:Ve.maximaleTotaleHoogteCm}const Jz={class:"flex items-center justify-center text-center px-5 py-2 h-10.5 md:h-11 xl:h-13 mt-4 mb-3 bg-primary-green rounded text-tertiary-green hover:bg-button-hover-green transition-colors duration-200 focus:outline-hidden"},eG={class:"pr-2 text-base"},Tm={__name:"ButtonNextStep",props:{label:{type:String,required:!0}},setup(n){return(e,t)=>(he(),ye("button",Jz,[K("div",eG,Ae(n.label),1),Ro(e.$slots,"icon")]))}},tG={class:"flex flex-col p-2 lg:p-5 gap-y-7"},nG={class:"grid grid-cols-2 gap-4"},rG={key:0},oG={key:1},iG={class:"grid grid-cols-2 gap-4 mt-2"},aG={key:2},sG={key:3,class:"border-1 border-border-gray rounded-xl p-4 mt-4"},lG={class:"grid grid-cols-2 gap-4 items-center py-1"},cG={class:"grid grid-cols-1 gap-4"},uG={key:0},dG={key:1},fG={key:4},hG={class:"grid grid-cols-2 gap-4"},pG={key:0},mG={class:"flex justify-center"},gG={__name:"Step1",props:{modelValue:{type:Object,required:!0},baseUrl:{type:String,default:""}},emits:["setTabValue","update:modelValue"],setup(n,{emit:e}){const t=n,r=e,o=bt(()=>nT(t.modelValue.type)),i=bt(()=>rT(t.modelValue.type)),a=bt(()=>oT(t.modelValue.type)),s=bt(()=>iT(t.modelValue.type)),l=bt(()=>aT(t.modelValue.type)),c=bt(()=>sT(t.modelValue.type));return(u,d)=>{var y,b,E,x,w,L,C,P,D,Q,re,G,se;const f=Yt("FormHeader"),h=Yt("FormRadioButton"),p=Yt("FormInputCm"),m=Yt("UserMessage"),g=Yt("FormButtonGroupQuantity"),_=Yt("FormInputCheckbox"),A=Yt("FormButtonGroupChoice");return he(),ye(Nt,null,[K("div",tG,[K("div",null,[Be(f,null,{default:ot(()=>[Ye(Ae(u.$t("step1.door_type")),1)]),_:1}),Be(h,{modelValue:n.modelValue.type,"onUpdate:modelValue":d[0]||(d[0]=ee=>n.modelValue.type=ee),labelDescription:u.$t("step1.fixed_panel"),setValueOnClick:"vaste-wand",tooltipTitle:u.$t("step1.fixed_panel"),tooltipDescription:u.$t("step1.fixed_panel_explain"),tooltipImage:n.baseUrl+"/Uploads/aluwdoors-configurator-vaste-wand.jpg"},null,8,["modelValue","labelDescription","tooltipTitle","tooltipDescription","tooltipImage"]),Be(h,{modelValue:n.modelValue.type,"onUpdate:modelValue":d[1]||(d[1]=ee=>n.modelValue.type=ee),labelDescription:u.$t("step1.pivot_door"),setValueOnClick:"taatsdeur",tooltipTitle:u.$t("step1.pivot_door"),tooltipDescription:u.$t("step1.pivot_door_explain"),tooltipImage:n.baseUrl+"/Uploads/aluwdoors-configurator-taatsdeur.jpg"},null,8,["modelValue","labelDescription","tooltipTitle","tooltipDescription","tooltipImage"]),Be(h,{modelValue:n.modelValue.type,"onUpdate:modelValue":d[2]||(d[2]=ee=>n.modelValue.type=ee),labelDescription:u.$t("step1.hinged_door"),setValueOnClick:"scharnierdeur",tooltipTitle:u.$t("step1.hinged_door"),tooltipDescription:u.$t("step1.hinged_door_explain"),tooltipImage:n.baseUrl+"/Uploads/aluwdoors-configurator-scharnierdeur.jpg"},null,8,["modelValue","labelDescription","tooltipTitle","tooltipDescription","tooltipImage"]),Be(h,{modelValue:n.modelValue.type,"onUpdate:modelValue":d[3]||(d[3]=ee=>n.modelValue.type=ee),labelDescription:u.$t("step1.sliding_door"),setValueOnClick:"schuifdeur",tooltipTitle:u.$t("step1.sliding_door"),tooltipDescription:u.$t("step1.sliding_door_explain"),tooltipImage:n.baseUrl+"/Uploads/aluwdoors-configurator-schuifdeur.jpg"},null,8,["modelValue","labelDescription","tooltipTitle","tooltipDescription","tooltipImage"]),Be(h,{modelValue:n.modelValue.type,"onUpdate:modelValue":d[4]||(d[4]=ee=>n.modelValue.type=ee),labelDescription:u.$t("step1.rebated_door"),setValueOnClick:"opdekdeur",tooltipTitle:u.$t("step1.rebated_door"),tooltipDescription:u.$t("step1.rebated_door_explain"),tooltipImage:n.baseUrl+"/Uploads/aluwdoors-configurator-opdekdeur.jpg"},null,8,["modelValue","labelDescription","tooltipTitle","tooltipDescription","tooltipImage"]),Be(h,{modelValue:n.modelValue.type,"onUpdate:modelValue":d[5]||(d[5]=ee=>n.modelValue.type=ee),labelDescription:u.$t("step1.folding_wall"),setValueOnClick:"vouwwand",tooltipTitle:u.$t("step1.folding_wall"),tooltipDescription:u.$t("step1.folding_wall_explain"),tooltipImage:n.baseUrl+"/Uploads/aluwdoors-configurator-vouwwand.jpg"},null,8,["modelValue","labelDescription","tooltipTitle","tooltipDescription","tooltipImage"])]),K("div",null,[Be(f,null,{default:ot(()=>[Ye(Ae(u.$t("step1.dimensions")),1)]),_:1}),K("div",nG,[!n.modelValue.deurbreedtevariabel||n.modelValue.deurbreedtevariabel&&n.modelValue.deur_aantal==1?(he(),gt(p,{key:0,modelValue:n.modelValue.breedte,"onUpdate:modelValue":d[6]||(d[6]=ee=>n.modelValue.breedte=ee),labelDescription:u.$t("step1.width"),min:a.value,max:s.value},null,8,["modelValue","labelDescription","min","max"])):Pe("",!0),Be(p,{modelValue:n.modelValue.hoogte,"onUpdate:modelValue":d[7]||(d[7]=ee=>n.modelValue.hoogte=ee),labelDescription:u.$t("step1.height"),min:l.value,max:c.value},null,8,["modelValue","labelDescription","min","max"])]),(b=(y=n.modelValue)==null?void 0:y.userMessages)!=null&&b.underWidthHeightInput?(he(),gt(m,{key:0,modelValue:n.modelValue.userMessages.underWidthHeightInput,"onUpdate:modelValue":d[8]||(d[8]=ee=>n.modelValue.userMessages.underWidthHeightInput=ee)},null,8,["modelValue"])):Pe("",!0),(x=(E=n.modelValue)==null?void 0:E.userMessages)!=null&&x.limitPanelWidth?(he(),gt(m,{key:1,modelValue:n.modelValue.userMessages.limitPanelWidth,"onUpdate:modelValue":d[9]||(d[9]=ee=>n.modelValue.userMessages.limitPanelWidth=ee)},null,8,["modelValue"])):Pe("",!0),(L=(w=n.modelValue)==null?void 0:w.userMessages)!=null&&L.limitPanelHeight?(he(),gt(m,{key:2,modelValue:n.modelValue.userMessages.limitPanelHeight,"onUpdate:modelValue":d[10]||(d[10]=ee=>n.modelValue.userMessages.limitPanelHeight=ee)},null,8,["modelValue"])):Pe("",!0)]),["vaste-wand","taatsdeur","scharnierdeur","schuifdeur","vouwwand"].includes(n.modelValue.type)?(he(),ye("div",rG,[["vaste-wand"].includes(n.modelValue.type)?(he(),gt(f,{key:0},{default:ot(()=>[Ye(Ae(u.$t("step1.number_of_panels")),1)]),_:1})):Pe("",!0),["taatsdeur","scharnierdeur","schuifdeur","vouwwand"].includes(n.modelValue.type)?(he(),gt(f,{key:1},{default:ot(()=>[Ye(Ae(u.$t("step1.number_of_doors")),1)]),_:1})):Pe("",!0),Be(g,{modelValue:n.modelValue.deur_aantal,"onUpdate:modelValue":d[11]||(d[11]=ee=>n.modelValue.deur_aantal=ee),minCount:o.value,maxCount:i.value},null,8,["modelValue","minCount","maxCount"]),(P=(C=n.modelValue)==null?void 0:C.userMessages)!=null&&P.underPanelQuantityInput?(he(),gt(m,{key:2,modelValue:n.modelValue.userMessages.underPanelQuantityInput,"onUpdate:modelValue":d[12]||(d[12]=ee=>n.modelValue.userMessages.underPanelQuantityInput=ee)},null,8,["modelValue"])):Pe("",!0)])):Pe("",!0),(D=n.modelValue)!=null&&D.bovenlichtVisible?(he(),ye("div",oG,[Be(f,null,{default:ot(()=>[Ye(Ae(u.$t("step1.top_light")),1)]),_:1}),Be(_,{checked:n.modelValue.bovenlicht,"onUpdate:checked":d[13]||(d[13]=ee=>n.modelValue.bovenlicht=ee),value:u.$t("step1.top_light_above_doorpanel")},null,8,["checked","value"]),n.modelValue.bovenlicht&&n.modelValue.deur_aantal>1?(he(),gt(_,{key:0,checked:n.modelValue.bovenlicht_verberg_tussenstijl,"onUpdate:checked":d[14]||(d[14]=ee=>n.modelValue.bovenlicht_verberg_tussenstijl=ee),value:u.$t("step1.top_light_hide_intermediate_style")},null,8,["checked","value"])):Pe("",!0),n.modelValue.bovenlicht&&(n.modelValue.zijpaneel_aantal_links>0||n.modelValue.zijpaneel_aantal_rechts>0)?(he(),gt(_,{key:1,checked:n.modelValue.bovenlicht_stijl_zijpaneel,"onUpdate:checked":d[15]||(d[15]=ee=>n.modelValue.bovenlicht_stijl_zijpaneel=ee),value:u.$t("step1.top_light_style_continued_in_side_panel")},null,8,["checked","value"])):Pe("",!0),K("div",iG,[n.modelValue.bovenlicht?(he(),gt(p,{key:0,modelValue:n.modelValue.hoogtebovenlicht,"onUpdate:modelValue":d[16]||(d[16]=ee=>n.modelValue.hoogtebovenlicht=ee),labelDescription:u.$t("step1.top_light_height")},null,8,["modelValue","labelDescription"])):Pe("",!0)]),(Q=n.modelValue)!=null&&Q.userMessages?(he(),gt(m,{key:2,modelValue:n.modelValue.userMessages.underBovenlichtInput,"onUpdate:modelValue":d[17]||(d[17]=ee=>n.modelValue.userMessages.underBovenlichtInput=ee)},null,8,["modelValue"])):Pe("",!0)])):Pe("",!0),(re=n.modelValue)!=null&&re.deurbreedtevariabelVisible?(he(),ye("div",aG,[Be(_,{checked:n.modelValue.deurbreedtevariabel,"onUpdate:checked":d[18]||(d[18]=ee=>n.modelValue.deurbreedtevariabel=ee),value:u.$t("step1.user_input_custom_door_width")},null,8,["checked","value"])])):Pe("",!0),n.modelValue.deurbreedtevariabel&&n.modelValue.deur_aantal>1?(he(),ye("div",sG,[Be(f,null,{default:ot(()=>[Ye(Ae(u.$t("step1.panel_width")),1)]),_:1}),(he(!0),ye(Nt,null,Xn(n.modelValue.deur_aantal,ee=>{var ie,H;return he(),ye("div",null,[K("div",lG,[K("div",null,Ae(u.$t("step1.panel"))+" "+Ae(ee),1),K("div",null,[n.modelValue.deur_aantal>=ee?(he(),gt(p,{key:0,modelValue:n.modelValue.variabeledeurbreedte_maten[ee-1],"onUpdate:modelValue":T=>n.modelValue.variabeledeurbreedte_maten[ee-1]=T},null,8,["modelValue","onUpdate:modelValue"])):Pe("",!0)])]),(H=(ie=n.modelValue)==null?void 0:ie.userMessages)!=null&&H.underPanelWidthInput[ee-1]?(he(),gt(m,{key:0,modelValue:n.modelValue.userMessages.underPanelWidthInput[ee-1],"onUpdate:modelValue":T=>n.modelValue.userMessages.underPanelWidthInput[ee-1]=T},null,8,["modelValue","onUpdate:modelValue"])):Pe("",!0)])}),256))])):Pe("",!0),K("div",cG,[["taatsdeur","scharnierdeur","schuifdeur"].includes(n.modelValue.type)?(he(),ye("div",uG,[Be(f,null,{default:ot(()=>[Ye(Ae(u.$t("step1.side_panels_left")),1)]),_:1}),Be(A,{modelValue:n.modelValue.zijpaneel_aantal_links,"onUpdate:modelValue":d[19]||(d[19]=ee=>n.modelValue.zijpaneel_aantal_links=ee),options:[{value:0,label:"0"},{value:1,label:"1"},{value:2,label:"2"},{value:3,label:"3"},{value:4,label:"4"}]},null,8,["modelValue"])])):Pe("",!0),["taatsdeur","scharnierdeur","schuifdeur"].includes(n.modelValue.type)?(he(),ye("div",dG,[Be(f,null,{default:ot(()=>[Ye(Ae(u.$t("step1.side_panels_right")),1)]),_:1}),Be(A,{modelValue:n.modelValue.zijpaneel_aantal_rechts,"onUpdate:modelValue":d[20]||(d[20]=ee=>n.modelValue.zijpaneel_aantal_rechts=ee),options:[{value:0,label:"0"},{value:1,label:"1"},{value:2,label:"2"},{value:3,label:"3"},{value:4,label:"4"}]},null,8,["modelValue"])])):Pe("",!0)]),n.modelValue.zijpaneel_aantal_links>0||n.modelValue.zijpaneel_aantal_rechts>0?(he(),ye("div",fG,[Be(f,null,{default:ot(()=>[Ye(Ae(u.$t("step1.side_panel_size")),1)]),_:1}),(se=(G=n.modelValue)==null?void 0:G.userMessages)!=null&&se.underSidePanelDimensionInput?(he(),gt(m,{key:0,modelValue:n.modelValue.userMessages.underSidePanelDimensionInput,"onUpdate:modelValue":d[21]||(d[21]=ee=>n.modelValue.userMessages.underSidePanelDimensionInput=ee)},null,8,["modelValue"])):Pe("",!0),K("div",hG,[n.modelValue.zijpaneel_aantal_links>0?(he(),ye("div",pG,[(he(!0),ye(Nt,null,Xn(Ct(Ve).maxZijpanelenLinks,ee=>Ro(u.$slots,"default",{},()=>{var ie,H;return[n.modelValue.zijpaneel_aantal_links>=ee?(he(),gt(p,{key:0,modelValue:n.modelValue.zijpaneel_breedte_links[ee-1],"onUpdate:modelValue":T=>n.modelValue.zijpaneel_breedte_links[ee-1]=T,labelDescription:u.$t("left")+" "+ee},null,8,["modelValue","onUpdate:modelValue","labelDescription"])):Pe("",!0),Array.isArray((H=(ie=n.modelValue)==null?void 0:ie.userMessages)==null?void 0:H.underSidePanelDimensionInputLeft)&&n.modelValue.userMessages.underSidePanelDimensionInputLeft.length>=ee&&n.modelValue.userMessages.underSidePanelDimensionInputLeft[ee-1]?(he(),gt(m,{key:1,modelValue:n.modelValue.userMessages.underSidePanelDimensionInputLeft[ee-1],"onUpdate:modelValue":T=>n.modelValue.userMessages.underSidePanelDimensionInputLeft[ee-1]=T},null,8,["modelValue","onUpdate:modelValue"])):Pe("",!0)]})),256))])):Pe("",!0),K("div",null,[(he(!0),ye(Nt,null,Xn(Ct(Ve).maxZijpanelenRechts,ee=>Ro(u.$slots,"default",{},()=>{var ie,H;return[n.modelValue.zijpaneel_aantal_rechts>=ee?(he(),gt(p,{key:0,modelValue:n.modelValue.zijpaneel_breedte_rechts[ee-1],"onUpdate:modelValue":T=>n.modelValue.zijpaneel_breedte_rechts[ee-1]=T,labelDescription:u.$t("right")+" "+ee},null,8,["modelValue","onUpdate:modelValue","labelDescription"])):Pe("",!0),Array.isArray((H=(ie=n.modelValue)==null?void 0:ie.userMessages)==null?void 0:H.underSidePanelDimensionInputRight)&&n.modelValue.userMessages.underSidePanelDimensionInputRight.length>=ee&&n.modelValue.userMessages.underSidePanelDimensionInputRight[ee-1]?(he(),gt(m,{key:1,modelValue:n.modelValue.userMessages.underSidePanelDimensionInputRight[ee-1],"onUpdate:modelValue":T=>n.modelValue.userMessages.underSidePanelDimensionInputRight[ee-1]=T},null,8,["modelValue","onUpdate:modelValue"])):Pe("",!0)]})),256))])])])):Pe("",!0)]),d[24]||(d[24]=K("div",{class:"border-t-1 border-horizontal-line"},null,-1)),K("div",mG,[Be(Tm,{label:u.$t("step2.choose_layout"),onClick:d[22]||(d[22]=ee=>r("setTabValue","2"))},{icon:ot(()=>[...d[23]||(d[23]=[K("svg",{width:"16",height:"12",viewBox:"0 0 16 12",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},[K("path",{d:"M15.625 6.375L11.125 10.875L10.7812 11.2188L10.0625 10.5L10.4375 10.1562L14.0625 6.5H0.5H0V5.5H0.5H14.0625L10.4375 1.875L10.0625 1.5L10.7812 0.8125L11.125 1.15625L15.625 5.65625L16 6L15.625 6.375Z"})],-1)])]),_:1},8,["label"])])],64)}}},_G={class:"flex flex-col p-2 lg:p-5 gap-y-7"},vG={key:0},AG={key:1,class:"grid grid-cols-1 gap-4"},yG={key:0},bG={key:1},xG={key:2,class:"grid grid-cols-1 gap-4"},EG={class:"flex flex-wrap gap-2"},CG=["innerHTML"],SG={key:3,class:""},wG={key:0},MG={class:"border border-border-gray rounded-xl p-4 mt-4"},TG={class:"py-1"},IG={class:"text-base font-normal"},RG={class:"py-1"},LG={class:"text-base font-normal"},PG={key:1,class:"p-4"},DG={class:"grid grid-cols-2 gap-4"},BG={key:2},NG={key:0,class:"border border-border-gray rounded-xl p-4 mt-4"},OG={class:"grid grid-cols-2 gap-4 items-center py-1"},kG={key:1,class:"border border-border-gray rounded-xl p-4 mt-4"},FG={class:"grid grid-cols-2 gap-4 items-center py-1"},VG={class:"flex justify-center"},UG={__name:"Step2",props:{modelValue:{type:Object,required:!0},baseUrl:{type:String,default:""}},emits:["setTabValue","update:modelValue"],setup(n,{emit:e}){const t=e;return(r,o)=>{var h,p,m,g;const i=Yt("FormHeader"),a=Yt("FormSegmentedControl"),s=Yt("FormButtonGroupChoice"),l=Yt("FormButtonImageSvg"),c=Yt("FormInputCheckbox"),u=Yt("FormInputCm"),d=Yt("UserMessage"),f=Yt("GroupFormInputCmWithLabel");return he(),ye(Nt,null,[K("div",_G,[n.modelValue.roede_design_keuzeVisible?(he(),ye("div",vG,[Be(i,null,{default:ot(()=>[Ye(Ae(r.$t("step2.type_layout")),1)]),_:1}),Be(a,{modelValue:n.modelValue.roede_design_keuze,"onUpdate:modelValue":o[0]||(o[0]=_=>n.modelValue.roede_design_keuze=_),options:[{value:!1,label:r.$t("step2.custom_layout"),tooltip:r.$t("step2.custom_layout_tooltip")},{value:!0,label:r.$t("step2.predefined_layout"),tooltip:r.$t("step2.predefined_layout_tooltip")}]},null,8,["modelValue","options"])])):Pe("",!0),(h=n.modelValue)!=null&&h.deur_aantal_liggerVisible||(p=n.modelValue)!=null&&p.deur_aantal_staanderVisible?(he(),ye("div",AG,[(m=n.modelValue)!=null&&m.deur_aantal_liggerVisible?(he(),ye("div",yG,[Be(i,null,{default:ot(()=>[Ye(Ae(r.$t("step2.number_of_horizontal_rods")),1)]),_:1}),Be(s,{modelValue:n.modelValue.deur_aantal_ligger_input,"onUpdate:modelValue":o[1]||(o[1]=_=>n.modelValue.deur_aantal_ligger_input=_),options:[{value:0,label:"0"},{value:1,label:"1"},{value:2,label:"2"},{value:3,label:"3"},{value:4,label:"4"}]},null,8,["modelValue"])])):Pe("",!0),(g=n.modelValue)!=null&&g.deur_aantal_staanderVisible?(he(),ye("div",bG,[Be(i,null,{default:ot(()=>[Ye(Ae(r.$t("step2.number_of_vertical_rods")),1)]),_:1}),Be(s,{modelValue:n.modelValue.deur_aantal_staander_input,"onUpdate:modelValue":o[2]||(o[2]=_=>n.modelValue.deur_aantal_staander_input=_),options:[{value:0,label:"0"},{value:1,label:"1"},{value:2,label:"2"},{value:3,label:"3"},{value:4,label:"4"}]},null,8,["modelValue"])])):Pe("",!0)])):Pe("",!0),n.modelValue.roede_design_keuze?(he(),ye("div",xG,[Be(i,null,{default:ot(()=>[Ye(Ae(r.$t("step2.layout_templates")),1)]),_:1}),K("div",EG,[(he(!0),ye(Nt,null,Xn(Ct(qz),_=>(he(),gt(l,{key:_.value,modelValue:n.modelValue.roede_configuratie_input,"onUpdate:modelValue":o[3]||(o[3]=A=>n.modelValue.roede_configuratie_input=A),setValueOnClick:_.value,labelDescription:_.label,tooltipDescription:_.tooltip,imageSrc:_.imageSrc},{default:ot(()=>[(he(),ye("svg",{width:"50",height:"75",viewBox:"0 0 50 75",fill:"none",xmlns:"http://www.w3.org/2000/svg",innerHTML:_.svg},null,8,CG))]),_:2},1032,["modelValue","setValueOnClick","labelDescription","tooltipDescription","imageSrc"]))),128))]),n.modelValue.zijpaneel_aantal_links>0||n.modelValue.zijpaneel_aantal_rechts>0||n.modelValue.bovenlicht?(he(),gt(c,{key:0,checked:n.modelValue.roede_design_roedes_doorlopen_zijlicht_bovenlicht,"onUpdate:checked":o[4]||(o[4]=_=>n.modelValue.roede_design_roedes_doorlopen_zijlicht_bovenlicht=_),value:r.$t("step2.continuous_lines_side_panels")},null,8,["checked","value"])):Pe("",!0)])):Pe("",!0),!n.modelValue.roede_design_keuze&&(n.modelValue.deur_aantal_ligger>0||n.modelValue.deur_aantal_staander>0||n.modelValue.zijpaneel_aantal_staander>0)?(he(),ye("div",SG,[Be(i,null,{default:ot(()=>[Ye(Ae(r.$t("step2.positioning")),1)]),_:1}),Be(a,{modelValue:n.modelValue.asymmetrisch,"onUpdate:modelValue":o[5]||(o[5]=_=>n.modelValue.asymmetrisch=_),options:[{value:!1,label:r.$t("step2.positioning_fixed_layout")},{value:!0,label:r.$t("step2.positioning_custom_layout")}]},null,8,["modelValue","options"])])):Pe("",!0)]),n.modelValue.deur_aantal&&!n.modelValue.roede_design_keuze&&n.modelValue.asymmetrisch&&(n.modelValue.deur_aantal_ligger>0||n.modelValue.deur_aantal_staander>0)?(he(),ye("div",wG,[(he(!0),ye(Nt,null,Xn(n.modelValue.deur_aantal,_=>(he(),ye("div",MG,[n.modelValue.type=="vaste-wand"?(he(),gt(i,{key:0,class:"border-b border-border-gray"},{default:ot(()=>[Ye(Ae(r.$t("step2.panel_custom_layout",{index:_})),1)]),_:2},1024)):Pe("",!0),n.modelValue.type!=="vaste-wand"?(he(),gt(i,{key:1,class:"border-b border-border-gray"},{default:ot(()=>[Ye(Ae(r.$t("step2.door_custom_layout",{index:_})),1)]),_:2},1024)):Pe("",!0),(he(!0),ye(Nt,null,Xn(n.modelValue.deur_aantal_ligger,A=>(he(),ye("div",TG,[Be(f,null,{label:ot(()=>[K("span",IG,Ae(r.$t("step2.horizontal_rod",{index:A})),1)]),input:ot(()=>{var y,b;return[n.modelValue.deur_aantal_ligger>=A?(he(),gt(u,{key:0,modelValue:n.modelValue.asymmetrisch_ligger_maten[A-1],"onUpdate:modelValue":E=>n.modelValue.asymmetrisch_ligger_maten[A-1]=E},null,8,["modelValue","onUpdate:modelValue"])):Pe("",!0),(b=(y=n.modelValue)==null?void 0:y.userMessages)!=null&&b.underInputLiggerDeur[A-1]?(he(),gt(d,{key:1,modelValue:n.modelValue.userMessages.underInputLiggerDeur[A-1],"onUpdate:modelValue":E=>n.modelValue.userMessages.underInputLiggerDeur[A-1]=E},null,8,["modelValue","onUpdate:modelValue"])):Pe("",!0)]}),_:2},1024)]))),256)),(he(!0),ye(Nt,null,Xn(n.modelValue.deur_aantal_staander,A=>(he(),ye("div",RG,[Be(f,null,{label:ot(()=>[K("span",LG,Ae(r.$t("step2.vertical_rod",{index:A})),1)]),input:ot(()=>{var y,b;return[Be(u,{modelValue:n.modelValue.asymmetrisch_staander_maten_deur[_*100+A],"onUpdate:modelValue":E=>n.modelValue.asymmetrisch_staander_maten_deur[_*100+A]=E},null,8,["modelValue","onUpdate:modelValue"]),(b=(y=n.modelValue)==null?void 0:y.userMessages)!=null&&b.underInputStaanderDeur[_*100+A]?(he(),gt(d,{key:0,modelValue:n.modelValue.userMessages.underInputStaanderDeur[_*100+A],"onUpdate:modelValue":E=>n.modelValue.userMessages.underInputStaanderDeur[_*100+A]=E},null,8,["modelValue","onUpdate:modelValue"])):Pe("",!0)]}),_:2},1024)]))),256))]))),256))])):Pe("",!0),n.modelValue.zijpaneel_aantal_staanderVisible?(he(),ye("div",PG,[Be(i,null,{default:ot(()=>[Ye(Ae(r.$t("step2.number_of_vertical_rods_side_panel")),1)]),_:1}),K("div",DG,[K("div",null,[Be(s,{modelValue:n.modelValue.zijpaneel_aantal_staander,"onUpdate:modelValue":o[6]||(o[6]=_=>n.modelValue.zijpaneel_aantal_staander=_),options:[{value:0,label:"0"},{value:1,label:"1"},{value:2,label:"2"},{value:3,label:"3"},{value:4,label:"4"}]},null,8,["modelValue"])]),o[8]||(o[8]=K("div",null,null,-1))])])):Pe("",!0),n.modelValue.zijpaneel_aantal_staander>0&&n.modelValue.asymmetrisch?(he(),ye("div",BG,[n.modelValue.zijpaneel_aantal_links>0?(he(),ye("div",NG,[Be(i,null,{default:ot(()=>[Ye(Ae(r.$t("step2.left_side_panel_layout")),1)]),_:1}),(he(!0),ye(Nt,null,Xn(n.modelValue.zijpaneel_aantal_staander,_=>(he(),ye("div",OG,[K("div",null,Ae(r.$t("step2.vertical_rod",{index:_})),1),K("div",null,[Be(u,{modelValue:n.modelValue.asymmetrisch_staander_maten_zijpaneel[100+_],"onUpdate:modelValue":A=>n.modelValue.asymmetrisch_staander_maten_zijpaneel[100+_]=A},null,8,["modelValue","onUpdate:modelValue"])])]))),256))])):Pe("",!0),n.modelValue.zijpaneel_aantal_rechts>0?(he(),ye("div",kG,[Be(i,null,{default:ot(()=>[Ye(Ae(r.$t("step2.right_side_panel_layout")),1)]),_:1}),(he(!0),ye(Nt,null,Xn(n.modelValue.zijpaneel_aantal_staander,_=>(he(),ye("div",FG,[K("div",null,Ae(r.$t("step2.vertical_rod",{index:_})),1),K("div",null,[Be(u,{modelValue:n.modelValue.asymmetrisch_staander_maten_zijpaneel[200+_],"onUpdate:modelValue":A=>n.modelValue.asymmetrisch_staander_maten_zijpaneel[200+_]=A},null,8,["modelValue","onUpdate:modelValue"])])]))),256))])):Pe("",!0)])):Pe("",!0),o[10]||(o[10]=K("div",{class:"border-t border-horizontal-line"},null,-1)),K("div",VG,[Be(Tm,{label:r.$t("step3.choose_detailing"),onClick:o[7]||(o[7]=_=>t("setTabValue","3"))},{icon:ot(()=>[...o[9]||(o[9]=[K("svg",{width:"16",height:"12",viewBox:"0 0 16 12",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},[K("path",{d:"M15.625 6.375L11.125 10.875L10.7812 11.2188L10.0625 10.5L10.4375 10.1562L14.0625 6.5H0.5H0V5.5H0.5H14.0625L10.4375 1.875L10.0625 1.5L10.7812 0.8125L11.125 1.15625L15.625 5.65625L16 6L15.625 6.375Z"})],-1)])]),_:1},8,["label"])])],64)}}},zG={key:0,class:"flex flex-col p-2 lg:p-5 gap-y-7"},GG={class:"grid grid-cols-3 gap-4"},HG={key:0,class:"mt-4"},WG={class:"grid grid-cols-1 gap-4"},jG={key:0},QG={class:"grid grid-cols-3 gap-4"},$G={class:"grid grid-cols-3 gap-4"},YG={key:1},XG={key:2},qG={key:0,class:"mb-6"},KG={key:1,class:"grid grid-cols-3 gap-4"},ZG={key:2,class:"grid grid-cols-3 gap-4"},JG={key:3},eH={class:"grid grid-cols-3 gap-4"},tH={key:4},nH={class:"grid grid-cols-3 gap-4"},rH={key:0,class:"mt-4"},oH={key:5},iH={class:"grid grid-cols-3 gap-4","data-name":"draairichting"},aH={key:0,class:"mt-4"},sH={key:6},lH={class:"grid grid-cols-3 gap-4"},cH={key:0,class:"mt-4"},uH={key:7},dH={key:8},fH={key:9},hH={key:10},pH={key:11},mH={key:12},gH={class:"flex justify-center"},_H={__name:"Step3",props:{modelValue:{type:Object,required:!0},baseUrl:{type:String,default:""},buttonQuoteVisible:{type:Boolean,default:!1},companyInternalEdit:{type:Boolean,default:!1},buttonQuoteRequestOrUpdate:{type:Boolean,default:!1},actualUserOptionsVersion:{type:Number,default:0}},emits:["setTabValue","update:modelValue","clickQuoteButton"],setup(n,{emit:e}){const t=e;function r(){t("setTabValue","0"),t("clickQuoteButton")}return(o,i)=>{var h,p,m,g,_,A,y,b,E;const a=Yt("FormHeader"),s=Yt("FormRadioButtonImage"),l=Yt("FormInput"),c=Yt("UserMessage"),u=Yt("FormSegmentedControl"),d=Yt("FormInputCheckbox"),f=Yt("FormInputTextarea");return n.modelValue?(he(),ye("div",zG,[K("div",null,[Be(a,null,{default:ot(()=>[Ye(Ae(o.$t("step3.material_colour")),1)]),_:1}),K("div",GG,[(he(!0),ye(Nt,null,Xn(Ct(sA),(x,w)=>{var L;return he(),gt(s,{key:x.value,modelValue:n.modelValue.kleur_materiaal,"onUpdate:modelValue":i[0]||(i[0]=C=>n.modelValue.kleur_materiaal=C),setValueOnClick:x.value,labelDescription:o.$t(x.label),imageSrc:n.baseUrl+x.image,imageRatio:"aspect-[104/80]",tooltipDescription:o.$t(x.tooltip),tooltipImage:n.baseUrl+x.image,visible:(L=x.visible)==null?void 0:L.includes(n.modelValue.type),index:w+1,tooltipTitle:o.$t(x.label)},null,8,["modelValue","setValueOnClick","labelDescription","imageSrc","tooltipDescription","tooltipImage","visible","index","tooltipTitle"])}),128))]),n.modelValue.kleur_materiaal=="KLEUR_ALUMINIUM_RAL"?(he(),ye("div",HG,[K("div",WG,[Be(l,{class:"",dataName:"kleur_ral",labelDescription:o.$t("step3.ral_colour_number"),modelValue:n.modelValue.kleur_ral,"onUpdate:modelValue":i[1]||(i[1]=x=>n.modelValue.kleur_ral=x)},null,8,["labelDescription","modelValue"]),(h=n.modelValue)!=null&&h.userMessages?(he(),gt(c,{key:0,modelValue:n.modelValue.userMessages.underRalColorNumberInput,"onUpdate:modelValue":i[2]||(i[2]=x=>n.modelValue.userMessages.underRalColorNumberInput=x)},null,8,["modelValue"])):Pe("",!0),K("div",null,[Be(u,{modelValue:n.modelValue.kleur_ral_type,"onUpdate:modelValue":i[3]||(i[3]=x=>n.modelValue.kleur_ral_type=x),options:[{value:"ntb",label:o.$t("step3.coating_type.tbd"),tooltip:""},{value:"mat",label:o.$t("step3.coating_type.matt"),tooltip:""},{value:"glans",label:o.$t("step3.coating_type.gloss"),tooltip:""},{value:"fijnstructuur",label:o.$t("step3.coating_type.fine_texture"),tooltip:""}]},null,8,["modelValue","options"])]),Be(l,{class:"",dataName:"ral_opmerking",labelDescription:o.$t("step3.ral_colour_note"),modelValue:n.modelValue.ral_opmerking,"onUpdate:modelValue":i[4]||(i[4]=x=>n.modelValue.ral_opmerking=x),inputType:""},null,8,["labelDescription","modelValue"])])])):Pe("",!0)]),["vaste-wand","taatsdeur","scharnierdeur","schuifdeur"].includes(n.modelValue.type)?(he(),ye("div",jG,[Be(a,null,{default:ot(()=>[Ye(Ae(o.$t("step3.oak_veneer_colour")),1)]),_:1}),K("div",QG,[(he(!0),ye(Nt,null,Xn(Ct(lA),x=>{var w;return he(),gt(s,{key:x.value,modelValue:n.modelValue.kleur_materiaal,"onUpdate:modelValue":i[5]||(i[5]=L=>n.modelValue.kleur_materiaal=L),setValueOnClick:x.value,labelDescription:o.$t(x.label),imageSrc:n.baseUrl+x.image,imageRatio:"aspect-[104/80]",tooltipDescription:x.tooltip,visible:(w=x.visible)==null?void 0:w.includes(n.modelValue.type)},null,8,["modelValue","setValueOnClick","labelDescription","imageSrc","tooltipDescription","visible"])}),128))])])):Pe("",!0),K("div",null,[Be(a,null,{default:ot(()=>[Ye(Ae(o.$t("step3.glass_colour")),1)]),_:1}),K("div",$G,[(he(!0),ye(Nt,null,Xn(Ct(eT),x=>{var w;return he(),gt(s,{key:x.value,modelValue:n.modelValue.kleur_glas,"onUpdate:modelValue":i[6]||(i[6]=L=>n.modelValue.kleur_glas=L),setValueOnClick:x.value,labelDescription:o.$t(x.label),imageSrc:n.baseUrl+x.image,imageRatio:"aspect-[104/80]",tooltipDescription:x.tooltip,visible:(w=x.visible)==null?void 0:w.includes(n.modelValue.type)},null,8,["modelValue","setValueOnClick","labelDescription","imageSrc","tooltipDescription","visible"])}),128))])]),n.modelValue.tienmmglasVisible?(he(),ye("div",YG,[Be(a,null,{default:ot(()=>[Ye(Ae(o.$t("step3.glass_option")),1)]),_:1}),Be(d,{checked:n.modelValue.tienmmglas,"onUpdate:checked":i[7]||(i[7]=x=>n.modelValue.tienmmglas=x),value:o.$t("step3.glass_10mm")},null,8,["checked","value"]),(p=n.modelValue)!=null&&p.verbergtussenstaandersVisible?(he(),gt(d,{key:0,checked:n.modelValue.verbergtussenstaanders,"onUpdate:checked":i[8]||(i[8]=x=>n.modelValue.verbergtussenstaanders=x),value:o.$t("step3.glass_10mm_hide_styles")},null,8,["checked","value"])):Pe("",!0)])):Pe("",!0),["taatsdeur","scharnierdeur","schuifdeur","opdekdeur","vouwwand"].includes(n.modelValue.type)?(he(),ye("div",XG,[Be(a,null,{default:ot(()=>[Ye(Ae(o.$t("step3.handle")),1)]),_:1}),n.modelValue.kleur_materiaal.includes("FINEER")?(he(),ye("div",qG,[Be(u,{modelValue:n.modelValue.type_handgreep,"onUpdate:modelValue":i[9]||(i[9]=x=>n.modelValue.type_handgreep=x),options:[{value:"aluminium",label:o.$t("step3.aluminium_handle"),tooltip:""},{value:"hout",label:o.$t("step3.wooden_handle"),tooltip:""}]},null,8,["modelValue","options"])])):Pe("",!0),n.modelValue.kleur_materiaal.includes("FINEER")&&n.modelValue.type_handgreep=="aluminium"||!n.modelValue.kleur_materiaal.includes("FINEER")?(he(),ye("div",KG,[(he(!0),ye(Nt,null,Xn(Ct(cA),(x,w)=>{var L;return he(),gt(s,{key:x.value,modelValue:n.modelValue.handgreep,"onUpdate:modelValue":C=>n.modelValue.handgreep=C,dataName:"handgreep",setValueOnClick:x.value,labelDescription:o.$t(x.label),imageSrc:n.baseUrl+x.image,imageRatio:"aspect-[104/124]",tooltipDescription:x.tooltip,visible:(L=x.visible)==null?void 0:L.includes(n.modelValue.type),active:n.actualUserOptionsVersion>=x.activeFromVersion&&n.actualUserOptionsVersion<=x.activeToVersion||n.modelValue.handgreep==x.value},null,8,["modelValue","onUpdate:modelValue","setValueOnClick","labelDescription","imageSrc","tooltipDescription","visible","active"])}),128))])):Pe("",!0),n.modelValue.kleur_materiaal.includes("FINEER")&&n.modelValue.type_handgreep=="hout"?(he(),ye("div",ZG,[(he(!0),ye(Nt,null,Xn(Ct(tT),(x,w)=>{var L;return he(),gt(s,{key:x.value,modelValue:n.modelValue.handgreep,"onUpdate:modelValue":C=>n.modelValue.handgreep=C,dataName:"handgreep",setValueOnClick:x.value,labelDescription:o.$t(x.label),imageSrc:n.baseUrl+x.image,imageRatio:"aspect-[104/124]",tooltipDescription:x.tooltip,visible:(L=x.visible)==null?void 0:L.includes(n.modelValue.type),active:n.actualUserOptionsVersion>=x.activeFromVersion&&n.actualUserOptionsVersion<=x.activeToVersion||n.modelValue.handgreep==x.value},null,8,["modelValue","onUpdate:modelValue","setValueOnClick","labelDescription","imageSrc","tooltipDescription","visible","active"])}),128))])):Pe("",!0)])):Pe("",!0),n.modelValue.typeroedeVisible?(he(),ye("div",JG,[Be(a,null,{default:ot(()=>[Ye(Ae(o.$t("step3.bar_type")),1)]),_:1}),K("div",eH,[n.modelValue.roede_design_keuze?Pe("",!0):(he(),gt(s,{key:0,modelValue:n.modelValue.typeroede,"onUpdate:modelValue":i[10]||(i[10]=x=>n.modelValue.typeroede=x),dataName:"typeroede",setValueOnClick:"T_ROEDE",labelDescription:o.$t("step3.T_bar"),imageSrc:n.baseUrl+"/Uploads/aluwdoors-configurator-roedetype-t-roede.svg",imageRatio:"aspect-[104/80]",tooltipDescription:"??"},null,8,["modelValue","labelDescription","imageSrc"])),Be(s,{modelValue:n.modelValue.typeroede,"onUpdate:modelValue":i[11]||(i[11]=x=>n.modelValue.typeroede=x),dataName:"typeroede",setValueOnClick:"PLATTE_ROEDE",labelDescription:o.$t("step3.flat_bar"),imageSrc:n.baseUrl+"/Uploads/aluwdoors-configurator-roedetype-platte-roede.svg",imageRatio:"aspect-[104/80]",tooltipDescription:"??"},null,8,["modelValue","labelDescription","imageSrc"])])])):Pe("",!0),n.modelValue.actievedeurVisible?(he(),ye("div",tH,[Be(a,null,{default:ot(()=>[Ye(Ae(o.$t("step3.active_door")),1)]),_:1}),K("div",nH,[Be(s,{modelValue:n.modelValue.actievedeur,"onUpdate:modelValue":i[12]||(i[12]=x=>n.modelValue.actievedeur=x),dataName:"actievedeur",setValueOnClick:"ACTIEVEDEUR_LINKS",labelDescription:o.$t("step3.din_left"),imageSrc:n.baseUrl+"/Uploads/aluwdoors-configurator-draairichting-DIN-links.svg",imageRatio:"aspect-[104/80]",tooltipDescription:"??"},null,8,["modelValue","labelDescription","imageSrc"]),Be(s,{modelValue:n.modelValue.actievedeur,"onUpdate:modelValue":i[13]||(i[13]=x=>n.modelValue.actievedeur=x),dataName:"actievedeur",setValueOnClick:"ACTIEVEDEUR_RECHTS",labelDescription:o.$t("step3.din_right"),imageSrc:n.baseUrl+"/Uploads/aluwdoors-configurator-draairichting-DIN-rechts.svg",imageRatio:"aspect-[104/80]",tooltipDescription:"??"},null,8,["modelValue","labelDescription","imageSrc"]),Be(s,{modelValue:n.modelValue.actievedeur,"onUpdate:modelValue":i[14]||(i[14]=x=>n.modelValue.actievedeur=x),dataName:"actievedeur",setValueOnClick:"ACTIEVEDEUR_NTB",labelDescription:o.$t("step3.to_be_determined"),imageSrc:n.baseUrl+"/Uploads/aluwdoors-configurator-draairichting-DIN-ntb.svg",imageRatio:"aspect-[104/80]",tooltipDescription:"??"},null,8,["modelValue","labelDescription","imageSrc"])]),["ACTIEVEDEUR_LINKS","ACTIEVEDEUR_RECHTS"].includes(n.modelValue.actievedeur)&&n.modelValue.actievedeurVisible?(he(),ye("div",rH,[Ye(Ae(o.$t("step3.active_door_hint"))+" ",1),Be(f,{dataName:"opm_actievedeur",labelDescription:"",modelValue:n.modelValue.opm_actievedeur,"onUpdate:modelValue":i[15]||(i[15]=x=>n.modelValue.opm_actievedeur=x)},null,8,["modelValue"])])):Pe("",!0)])):Pe("",!0),n.modelValue.draairichtingVisible?(he(),ye("div",oH,[Be(a,null,{default:ot(()=>[Ye(Ae(o.$t("step3.opening_direction")),1)]),_:1}),K("div",iH,[Be(s,{modelValue:n.modelValue.draairichting,"onUpdate:modelValue":i[16]||(i[16]=x=>n.modelValue.draairichting=x),dataName:"draairichting",setValueOnClick:"DRAAI_LINKS",labelDescription:o.$t("step3.din_left"),imageSrc:n.baseUrl+"/Uploads/aluwdoors-configurator-draairichting-DIN-links.svg",imageRatio:"aspect-[104/80]",tooltipDescription:"??"},null,8,["modelValue","labelDescription","imageSrc"]),Be(s,{modelValue:n.modelValue.draairichting,"onUpdate:modelValue":i[17]||(i[17]=x=>n.modelValue.draairichting=x),dataName:"draairichting",setValueOnClick:"DRAAI_RECHTS",labelDescription:o.$t("step3.din_right"),imageSrc:n.baseUrl+"/Uploads/aluwdoors-configurator-draairichting-DIN-rechts.svg",imageRatio:"aspect-[104/80]",tooltipDescription:"??"},null,8,["modelValue","labelDescription","imageSrc"]),Be(s,{modelValue:n.modelValue.draairichting,"onUpdate:modelValue":i[18]||(i[18]=x=>n.modelValue.draairichting=x),dataName:"draairichting",setValueOnClick:"DRAAI_NTB",labelDescription:o.$t("step3.to_be_determined"),imageSrc:n.baseUrl+"/Uploads/aluwdoors-configurator-draairichting-DIN-ntb.svg",imageRatio:"aspect-[104/80]",tooltipDescription:"??"},null,8,["modelValue","labelDescription","imageSrc"])]),["DRAAI_LINKS","DRAAI_RECHTS"].includes(n.modelValue.draairichting)?(he(),ye("div",aH,[Ye(Ae(o.$t("step3.opening_direction_hint"))+" ",1),Be(f,{dataName:"opm_draairichting",labelDescription:"",modelValue:n.modelValue.opm_draairichting,"onUpdate:modelValue":i[19]||(i[19]=x=>n.modelValue.opm_draairichting=x)},null,8,["modelValue"])])):Pe("",!0)])):Pe("",!0),["schuifdeur"].includes(n.modelValue.type)&&n.modelValue.deur_aantal==1?(he(),ye("div",sH,[Be(a,null,{default:ot(()=>[Ye(Ae(o.$t("step3.sliding_direction")),1)]),_:1}),K("div",lH,[Be(s,{modelValue:n.modelValue.schuifrichting,"onUpdate:modelValue":i[20]||(i[20]=x=>n.modelValue.schuifrichting=x),dataName:"schuifrichting",setValueOnClick:"SCHUIF_LINKS",labelDescription:o.$t("left"),imageSrc:n.baseUrl+"/Uploads/aluwdoors-configurator-schuifrichting-links.svg",imageRatio:"aspect-[104/80]",tooltipDescription:"??"},null,8,["modelValue","labelDescription","imageSrc"]),Be(s,{modelValue:n.modelValue.schuifrichting,"onUpdate:modelValue":i[21]||(i[21]=x=>n.modelValue.schuifrichting=x),dataName:"schuifrichting",setValueOnClick:"SCHUIF_RECHTS",labelDescription:o.$t("right"),imageSrc:n.baseUrl+"/Uploads/aluwdoors-configurator-schuifrichting-rechts.svg",imageRatio:"aspect-[104/80]",tooltipDescription:"??"},null,8,["modelValue","labelDescription","imageSrc"]),Be(s,{modelValue:n.modelValue.schuifrichting,"onUpdate:modelValue":i[22]||(i[22]=x=>n.modelValue.schuifrichting=x),dataName:"schuifrichting",setValueOnClick:"SCHUIF_NTB",labelDescription:o.$t("step3.to_be_determined"),imageSrc:n.baseUrl+"/Uploads/aluwdoors-configurator-draairichting-DIN-ntb.svg",imageRatio:"aspect-[104/80]",tooltipDescription:"??"},null,8,["modelValue","labelDescription","imageSrc"])]),["SCHUIF_LINKS","SCHUIF_RECHTS"].includes(n.modelValue.schuifrichting)?(he(),ye("div",cH,[Ye(Ae(o.$t("step3.sliding_direction_hint"))+" ",1),Be(f,{dataName:"opm_schuifrichting",labelDescription:"",modelValue:n.modelValue.opm_schuifrichting,"onUpdate:modelValue":i[23]||(i[23]=x=>n.modelValue.opm_schuifrichting=x)},null,8,["modelValue"])])):Pe("",!0)])):Pe("",!0),["schuifdeur"].includes(n.modelValue.type)?(he(),ye("div",uH,[Be(a,null,{default:ot(()=>[Ye(Ae(o.$t("step3.sliding_door_options")),1)]),_:1}),(m=n.modelValue)!=null&&m.softcloseVisible?(he(),gt(d,{key:0,checked:n.modelValue.softclose,"onUpdate:checked":[i[24]||(i[24]=x=>n.modelValue.softclose=x),i[25]||(i[25]=x=>n.modelValue.softclose_dubbel=!1)],value:o.$t("step3.softclose_single")},null,8,["checked","value"])):Pe("",!0),(g=n.modelValue)!=null&&g.softclose_dubbelVisible?(he(),gt(d,{key:1,checked:n.modelValue.softclose_dubbel,"onUpdate:checked":[i[26]||(i[26]=x=>n.modelValue.softclose_dubbel=x),i[27]||(i[27]=x=>n.modelValue.softclose=!1)],value:o.$t("step3.softclose_double")},null,8,["checked","value"])):Pe("",!0),(_=n.modelValue)!=null&&_.verberg_rail_in_wandVisible?(he(),gt(d,{key:2,checked:n.modelValue.verberg_rail_in_wand,"onUpdate:checked":i[28]||(i[28]=x=>n.modelValue.verberg_rail_in_wand=x),value:o.$t("step3.hide_rail_in_wall"),tooltipTitle:o.$t("step3.hide_rail_in_wall_tooltip_title"),tooltipDescription:o.$t("step3.hide_rail_in_wall_tooltip_description"),tooltipImage:n.baseUrl+"/Uploads/aluwdoors-configurator-verberg-schuifrail-in-wand.jpg"},null,8,["checked","value","tooltipTitle","tooltipDescription","tooltipImage"])):Pe("",!0),(A=n.modelValue)!=null&&A.ondergeleidingVisible?(he(),gt(d,{key:3,checked:n.modelValue.ondergeleiding,"onUpdate:checked":i[29]||(i[29]=x=>n.modelValue.ondergeleiding=x),value:o.$t("step3.bottom_guide")},null,8,["checked","value"])):Pe("",!0)])):Pe("",!0),(y=n.modelValue)!=null&&y.hogeonderdorpelVisible?(he(),ye("div",dH,[Be(a,null,{default:ot(()=>[Ye(Ae(o.$t("step3.high_threshold_option")),1)]),_:1}),Be(d,{checked:n.modelValue.hogeonderdorpel,"onUpdate:checked":i[30]||(i[30]=x=>n.modelValue.hogeonderdorpel=x),value:o.$t("step3.high_threshold")},null,8,["checked","value"])])):Pe("",!0),(b=n.modelValue)!=null&&b.valdorpelVisible?(he(),ye("div",fH,[Be(a,null,{default:ot(()=>[Ye(Ae(o.$t("step3.drop_seal_option")),1)]),_:1}),Be(d,{checked:n.modelValue.valdorpel,"onUpdate:checked":i[31]||(i[31]=x=>n.modelValue.valdorpel=x),value:o.$t("step3.drop_seal")},null,8,["checked","value"])])):Pe("",!0),["opdekdeur"].includes(n.modelValue.type)?(he(),ye("div",hH,[Be(a,null,{default:ot(()=>[Ye(Ae(o.$t("step3.material_existing_frame")),1)]),_:1}),Be(u,{modelValue:n.modelValue.materiaalsoortbestaandkozijn,"onUpdate:modelValue":i[32]||(i[32]=x=>n.modelValue.materiaalsoortbestaandkozijn=x),options:[{value:"hout",label:o.$t("step3.wooden_frame")},{value:"metaal",label:o.$t("step3.metal_frame")}]},null,8,["modelValue","options"])])):Pe("",!0),(E=n.modelValue)!=null&&E.type_vergrendelingVisible?(he(),ye("div",pH,[Be(a,null,{default:ot(()=>[Ye(Ae(o.$t("step3.locking")),1)]),_:1}),Be(u,{modelValue:n.modelValue.type_vergrendeling,"onUpdate:modelValue":i[33]||(i[33]=x=>n.modelValue.type_vergrendeling=x),options:n.modelValue.type_vergrendelingOptions},null,8,["modelValue","options"])])):Pe("",!0),n.companyInternalEdit?(he(),ye("div",mH,[Be(a,null,{default:ot(()=>[Ye(Ae(o.$t("step3.remarks")),1)]),_:1}),Be(f,{dataName:"opmerking",labelDescription:o.$t("step3.any_remarks"),modelValue:n.modelValue.opmerking,"onUpdate:modelValue":i[34]||(i[34]=x=>n.modelValue.opmerking=x)},null,8,["labelDescription","modelValue"])])):Pe("",!0),i[36]||(i[36]=K("div",{class:"border-t border-horizontal-line"},null,-1)),K("div",gH,[n.buttonQuoteVisible?(he(),gt(Tm,{key:0,label:n.buttonQuoteRequestOrUpdate?o.$t("editQuote"):o.$t("requestQuote"),onClick:r},{icon:ot(()=>[...i[35]||(i[35]=[K("svg",{class:"mx-2",width:"12",height:"16",viewBox:"0 0 12 16",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},[K("path",{d:"M1 15H11V6H6.5H6V5.5V1H1V15ZM7 1.1875V5H10.8125L7 1.1875ZM7.25 0L12 4.75V15V16H11H1H0V15V1V0H1H7.25ZM2 2H2.5H4.5H5V3H4.5H2.5H2V2ZM2 4H2.5H4.5H5V5H4.5H2.5H2V4ZM7 14V13H7.5H9.5H10V14H9.5H7.5H7ZM9 10.5V8.5H3V10.5H9ZM3 7.5H9H10V8.5V10.5V11.5H9H3H2V10.5V8.5V7.5H3Z"})],-1)])]),_:1},8,["label"])):Pe("",!0)])])):Pe("",!0)}}},vH={class:"text-base font-normal truncate"},AH={id:"dropdownMenu",class:"absolute z-10 w-full bg-dropdown-open rounded-b-md shadow-lg"},yH={class:"text-white"},bH=["onClick"],xH={class:"text-base font-normal truncate"},EH={class:"flex items-center w-full"},CH={class:"text-base font-normal truncate"},SH=zi({__name:"HeaderDropdown",props:{configuratorActualConfig:{type:Object,required:!0}},emits:["activateConfiguration","addConfig"],setup(n,{emit:e}){const t=e,r=vt(!1),o=vt(null),i=()=>{r.value=!r.value},a=u=>{o.value.contains(u.target)||(r.value=!1)},s=u=>{a(u)},l=u=>{t("activateConfiguration",u),r.value=!1},c=()=>{t("addConfig"),r.value=!1};return $o(()=>{document.addEventListener("click",s)}),Fc(()=>{document.removeEventListener("click",s)}),(u,d)=>(he(),ye("div",{class:"relative min-w-0 basis-72 max-w-72 shrink",ref_key:"dropdown",ref:o,onClick:a},[K("button",{class:"w-full h-10 sm:h-12 bg-dropdown-open text-white pl-4 pr-2 py-2 cursor-pointer rounded-md select-none flex items-center justify-between",onClick:i,id:"dropdownButton"},[K("span",vH,[Ro(u.$slots,"activeConfigName",{},void 0,!0)]),d[1]||(d[1]=K("svg",{class:"w-4 h-4 mx-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[K("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"})],-1))]),Kn(K("div",AH,[K("ul",yH,[(he(!0),ye(Nt,null,Xn(n.configuratorActualConfig.conf,(f,h)=>(he(),ye("li",{key:h,class:"flex items-center justify-between px-4 py-2 h-12 w-full hover:bg-secondary-green cursor-pointer",onClick:p=>l(h)},[K("div",xH,Ae(f.name),1)],8,bH))),128)),K("li",{class:"flex items-center px-4 py-2 h-12 w-full hover:bg-secondary-green cursor-pointer",onClick:d[0]||(d[0]=f=>c())},[K("div",EH,[d[2]||(d[2]=K("span",{class:"mr-2"},[K("svg",{width:"14",height:"14",viewBox:"0 0 14 14",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},[K("path",{d:"M7.5 1V6.5H13H13.5V7.5H13H7.5V13V13.5H6.5V13V7.5H1H0.5V6.5H1H6.5V1V0.5H7.5V1Z",fill:"currentColor"})])],-1)),K("span",CH,Ae(u.$t("header.add_design")),1)])])])],512),[[hC,r.value]])],512))}},[["__scopeId","data-v-1bd599e9"]]),wH={key:0,width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"},MH={key:1,width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"},TH={class:"text-[15px] lg:text-base font-normal leading-loose ms-3","data-label":""},IH={key:0,class:"flex items-center"},lT={__name:"FormInputCheckbox",props:{checked:{type:[Array,Boolean],default:!1},value:{type:String,default:null},tooltipTitle:{type:String,default:""},tooltipDescription:{type:String,default:""},tooltipImage:{type:String,default:""},disabled:{type:Boolean,default:!1}},emits:["update:checked"],setup(n,{emit:e}){const t=e,r=n,o=bt({get(){return r.checked},set(a){t("update:checked",a),Lr.emit("configuratorUserInput")}});function i(){r.disabled||(o.value=!o.value)}return(a,s)=>{const l=Yt("InfoPopup");return he(),ye("div",{class:Qt(["flex items-center justify-between",n.disabled?"cursor-not-allowed opacity-60":"cursor-pointer"])},[K("div",{class:Qt(["flex items-center",n.disabled?"cursor-not-allowed":"cursor-pointer"]),onClick:i},[K("div",null,[o.value?Pe("",!0):(he(),ye("svg",wH,[...s[0]||(s[0]=[K("rect",{x:"0.5",y:"0.5",width:"15",height:"15",rx:"1.5",fill:"#F0F3F3",stroke:"#2B3937"},null,-1)])])),o.value?(he(),ye("svg",MH,[...s[1]||(s[1]=[K("rect",{x:"0.5",y:"0.5",width:"15",height:"15",rx:"1.5",fill:"#F0F3F3",stroke:"#2B3937"},null,-1),K("path",{d:"M9.35547 1.04297L8.90625 1.47266L4.16016 5.98438L3.73047 6.39453L3.30078 5.98438L1.07422 3.875L0.625 3.44531L1.48438 2.54688L1.93359 2.97656L3.73047 4.65625L8.04688 0.554688L8.49609 0.125L9.35547 1.04297Z",fill:"#2B3937",transform:"translate(3.5, 4.5)"},null,-1)])])):Pe("",!0)]),K("div",null,[K("span",TH,Ae(n.value),1)])],2),n.tooltipTitle?(he(),ye("div",IH,[Be(l,{title:n.tooltipTitle,text:n.tooltipDescription,imageSrc:n.tooltipImage},null,8,["title","text","imageSrc"])])):Pe("",!0)],2)}}};let Jc="/apii";function RH(){const n=document.cookie.match(/XSRF-TOKEN=([^;]+)/);return n?decodeURIComponent(n[1]):null}const ar=Zr({user:null,isAuthenticated:!1,isLoading:!0,error:null}),bn={setApiUrl(n){Jc=n},get state(){return Cp(ar)},async init(){var n;ar.isLoading=!0,ar.error=null;try{await Gt.get(`${Jc}/sanctum/csrf-cookie`,{withCredentials:!0});const e=await Gt.get(`${Jc}/api/auth/user`,{withCredentials:!0});e.data.success&&e.data.user&&(ar.user=e.data.user,ar.isAuthenticated=!0)}catch(e){((n=e.response)==null?void 0:n.status)!==401&&console.error("Auth init error:",e),ar.user=null,ar.isAuthenticated=!1}finally{ar.isLoading=!1}},async login(n,e,t=!1){var r,o,i,a,s,l;ar.isLoading=!0,ar.error=null;try{await Gt.get(`${Jc}/sanctum/csrf-cookie`,{withCredentials:!0});const c=RH(),u=await Gt.post(`${Jc}/api/auth/login`,{email:n,password:e,remember:t},{withCredentials:!0,headers:c?{"X-XSRF-TOKEN":c}:{}});return u.data.success?(ar.user=u.data.user,ar.isAuthenticated=!0,{success:!0}):(ar.error="Login failed",{success:!1,error:ar.error})}catch(c){const u=((o=(r=c.response)==null?void 0:r.data)==null?void 0:o.message)||((l=(s=(a=(i=c.response)==null?void 0:i.data)==null?void 0:a.errors)==null?void 0:s.email)==null?void 0:l[0])||"Login failed. Please try again.";return ar.error=u,{success:!1,error:u}}finally{ar.isLoading=!1}},async logout(){ar.isLoading=!0;try{await Gt.post(`${Jc}/api/auth/logout`,{},{withCredentials:!0})}catch(n){console.error("Logout error:",n)}finally{ar.user=null,ar.isAuthenticated=!1,ar.isLoading=!1}},clearError(){ar.error=null}},LH={class:"px-2.5 mt-2.5 xl:mt-5 w-full"},PH={class:"w-full h-headerheight-sm md:h-headerheight-md lg:h-headerheight-lg bg-secondary-green text-white p-2 md:p-4 mb-[10px] md:mb-0 rounded-xl flex justify-between items-center"},DH={class:"flex items-center gap-2 w-full"},BH={key:0,class:"hidden md:flex items-center gap-2"},NH=["disabled"],OH={key:0,class:"animate-spin",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},kH={key:1,width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},FH={class:"text-base font-normal max-sm:hidden header-add-start:hidden header-add-end:block ml-2"},VH={__name:"Header",props:["configuratorActualConfig","activeConfigName","companyInternalEdit","companyInternalOverrideLimits"],emits:["addConfig","deleteConfig","editName","activateConfiguration","update:companyInternalOverrideLimits","showLogin"],setup(n){const e=vt(!1);async function t(){e.value=!0,await bn.logout(),e.value=!1}return(r,o)=>(he(),ye("div",LH,[K("div",PH,[K("div",DH,[Be(SH,{class:"",configuratorActualConfig:n.configuratorActualConfig,onActivateConfiguration:o[0]||(o[0]=i=>r.$emit("activateConfiguration",i)),onAddConfig:o[1]||(o[1]=i=>r.$emit("addConfig"))},{activeConfigName:ot(()=>[Ye(Ae(n.activeConfigName),1)]),_:1},8,["configuratorActualConfig"]),K("button",{class:"shrink-0 flex items-center justify-center text-center bg-tertiary-green p-2 rounded-md hover:bg-primary-green hover:text-tertiary-green w-10 h-10 md:w-12 md:h-12 cursor-pointer",onClick:o[2]||(o[2]=i=>r.$emit("editName"))},[...o[7]||(o[7]=[K("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},[K("path",{d:"M0 16L0.1875 14.9375L1 11L11.2812 0.71875L12 0L12.6875 0.71875L15.2812 3.3125L16 4L15.2812 4.71875L5 15L1.0625 15.8125L0 16ZM4.5 14.0938L12.4375 6.15625L9.84375 3.5625L1.90625 11.5L1.25 14.75L4.5 14.0938ZM13.125 5.46875L14.5625 4L12 1.4375L10.5312 2.875L13.125 5.4375V5.46875Z"})],-1)])]),K("button",{class:"shrink-0 flex items-center justify-center text-center bg-tertiary-green p-2 rounded-md hover:bg-warning-red w-10 h-10 md:w-12 md:h-12 cursor-pointer",onClick:o[3]||(o[3]=i=>r.$emit("deleteConfig"))},[...o[8]||(o[8]=[K("svg",{width:"14",height:"16",viewBox:"0 0 14 16",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},[K("path",{d:"M5 0H9H9.25L9.40625 0.25L10.5 2H11.9688H13H14V3H12.9062L12 16H2L1.0625 3H0V2H1H2H3.46875L4.5625 0.25L4.71875 0H5ZM9.34375 2L8.71875 1H5.25L4.625 2H9.34375ZM2.90625 15H11.0625L11.9062 3H2.0625L2.90625 15ZM4.96875 6.28125L5.3125 6.65625L7 8.3125L8.65625 6.65625L9 6.28125L9.71875 7L9.34375 7.34375L7.6875 9L9.34375 10.6875L9.71875 11.0312L9 11.75L8.65625 11.375L7 9.71875L5.3125 11.375L4.96875 11.75L4.25 11.0312L4.625 10.6875L6.28125 9L4.625 7.34375L4.25 7L4.96875 6.28125Z"})],-1)])]),n.companyInternalEdit?(he(),ye("div",BH,[Ct(bn).state.isAuthenticated?(he(),ye("button",{key:1,class:"shrink-0 flex items-center justify-center text-center bg-tertiary-green p-2 rounded-md hover:bg-warning-red w-10 h-10 md:w-12 md:h-12 cursor-pointer",disabled:e.value,onClick:t},[e.value?(he(),ye("svg",OH,[...o[10]||(o[10]=[K("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),K("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):(he(),ye("svg",kH,[...o[11]||(o[11]=[K("path",{d:"M17 7l-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.58L17 17l5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4V5z"},null,-1)])]))],8,NH)):(he(),ye("button",{key:0,class:"shrink-0 flex items-center justify-center text-center bg-tertiary-green p-2 rounded-md hover:bg-primary-green hover:text-tertiary-green w-10 h-10 md:w-12 md:h-12 cursor-pointer",onClick:o[4]||(o[4]=i=>r.$emit("showLogin"))},[...o[9]||(o[9]=[K("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},[K("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"})],-1)])])),Ct(bn).state.isAuthenticated||n.companyInternalOverrideLimits?(he(),ye("div",{key:2,class:Qt(["shrink-0 px-3 py-2 rounded-md",n.companyInternalOverrideLimits?"bg-warning-red text-white":"bg-tertiary-green"])},[Be(lT,{checked:n.companyInternalOverrideLimits,disabled:!Ct(bn).state.isAuthenticated,"onUpdate:checked":o[5]||(o[5]=i=>r.$emit("update:companyInternalOverrideLimits",i)),value:"Override limits"},null,8,["checked","disabled"])],2)):Pe("",!0)])):Pe("",!0),K("button",{class:"ml-auto shrink-0 bg-background-light text-secondary-green px-4 py-2 rounded-md hover:bg-white flex items-center justify-center h-10.5 w-10.5 md:h-12 md:w-auto cursor-pointer",onClick:o[6]||(o[6]=i=>r.$emit("addConfig"))},[o[12]||(o[12]=K("span",{class:""},[K("svg",{width:"14",height:"14",viewBox:"0 0 14 14",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},[K("path",{d:"M7.5 1V6.5H13H13.5V7.5H13H7.5V13V13.5H6.5V13V7.5H1H0.5V6.5H1H6.5V1V0.5H7.5V1Z"})])],-1)),K("span",FH,Ae(r.$t("header.add_design")),1)])])])]))}},UH={class:"h-fit overflow-y-auto"},zH={key:0,class:"text-[28px] font-normal mb-4 leading-[1.2]"},GH={key:1,class:"text-[28px] font-normal mb-4 leading-[1.2]"},HH={key:2},WH={key:0,class:"text-base font-normal text-white mb-6 leading-loose"},jH={key:1,class:"text-base font-normal text-white mb-6 leading-loose"},QH={class:"flex flex-row mt-2 mb-2"},$H={class:"space-y-4 mb-4"},YH={key:0,class:"flex flex-col xs:flex-row gap-4"},XH={class:"w-full text-sm"},qH=["placeholder"],KH={class:"w-full text-sm"},ZH=["placeholder"],JH={class:"flex flex-col xs:flex-row gap-4"},eW={class:"w-full text-sm"},tW=["placeholder","aria-invalid"],nW={class:"w-full text-sm"},rW=["placeholder","aria-invalid"],oW={class:"flex flex-col xs:flex-row gap-4"},iW={class:"w-full text-sm"},aW=["placeholder"],sW={class:"w-full text-sm"},lW={class:"flex flex-col xs:flex-row gap-4"},cW={class:"w-full text-sm"},uW=["placeholder"],dW={class:"w-full text-sm"},fW=["placeholder"],hW={class:"block text-sm"},pW=["placeholder"],mW={key:1},gW=["disabled"],_W={key:0,class:"mr-2",width:"12",height:"16",viewBox:"0 0 12 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"},vW={key:1,class:"mr-2 inline w-4 h-4 text-gray-200 animate-spin dark:text-gray-600 fill-blue-600",viewBox:"0 0 100 101",fill:"none",xmlns:"http://www.w3.org/2000/svg"},AW={key:0},yW={key:1},bW={key:3},xW={class:"text-base font-normal text-white mb-4 leading-loose"},EW={class:"mb-2 text-sm font-light"},CW={class:"mb-4 text-sm font-light"},SW={class:"mb-4 text-sm font-light"},wW={__name:"OfferteAanvragenOfWijzigen",props:{popupData:Object,baseUrl:String},emits:["submit"],setup(n,{emit:e}){const t=n,r=e,{t:o}=cf(),i=bt(()=>[{value:"zelf_inmeten_en_afhalen",label:o("quoteForm.options.measure_collect")},{value:"zelf_inmeten_en_afleveren",label:o("quoteForm.options.measure_deliver")},{value:"laten_inmeten_en_afleveren",label:o("quoteForm.options.measure_deliver_by_us")},{value:"laten_inmeten_en_monteren",label:o("quoteForm.options.measure_install_by_us")}]),a=Zr({bedrijfsnaam:"",voornaam:"",achternaam:"",emailadres:"",telefoonnummer:"",woonplaatsMontage:""}),s=/^[^\s@]+@[^\s@]+\.[^\s@]+$/,l=/^\+?[0-9\s()-]{6,}$/;bt(()=>f());const c=bt(()=>"w-fit bg-[#e74242] text-white text-[13px] font-normal mt-1 rounded-sm px-2 py-1");function u(){Object.keys(a).forEach(h=>a[h]="")}dr(()=>t.popupData.popup,h=>{h||u()});function d(h){var p;(p=h==null?void 0:h.preventDefault)==null||p.call(h),f()&&r("submit")}function f(){var p,m,g,_,A,y;u();let h=!0;return t.popupData.typeOpdracht==="particulier"&&!((p=t.popupData.voornaam)!=null&&p.trim())&&(a.voornaam=o("validation.required"),h=!1),t.popupData.typeOpdracht==="particulier"&&!((m=t.popupData.achternaam)!=null&&m.trim())&&(a.achternaam=o("validation.required"),h=!1),t.popupData.typeOpdracht==="zakelijk"&&!((g=t.popupData.bedrijfsnaam)!=null&&g.trim())&&(a.bedrijfsnaam=o("validation.required"),h=!1),t.popupData.typeOpdracht==="particulier"&&t.popupData.voornaam&&t.popupData.voornaam.trim().length>100&&(a.voornaam=o("validation.too_long"),h=!1),(_=t.popupData.emailadres)!=null&&_.trim()?s.test(t.popupData.emailadres.trim())||(a.emailadres=o("validation.email"),h=!1):(a.emailadres=o("validation.required"),h=!1),(A=t.popupData.telefoonnummer)!=null&&A.trim()?l.test(t.popupData.telefoonnummer.trim())||(a.telefoonnummer=o("validation.phone"),h=!1):(a.telefoonnummer=o("validation.required"),h=!1),(y=t.popupData.woonplaatsMontage)!=null&&y.trim()||(a.woonplaatsMontage=o("validation.required"),h=!1),h}return(h,p)=>{const m=Yt("FormDropdown"),g=Yt("FormInputCheckbox"),_=Yt("ConfirmDlg");return he(),gt(_,{modelValue:n.popupData.popup,"onUpdate:modelValue":p[14]||(p[14]=A=>n.popupData.popup=A),imageSrc:n.popupData.updateToBackendDone?n.baseUrl+"/Uploads/aluwdoors-offerte-ontvangen.jpg":n.baseUrl+"/Uploads/aluwdoors-offerte-aanvragen.jpg",imageAlt:h.$t("popup.image_alt")},{default:ot(()=>[K("form",{onSubmit:p[13]||(p[13]=ja(()=>{},["prevent"]))},[K("div",UH,[n.popupData.wijzigenPopup?Pe("",!0):(he(),ye("h2",zH,Ae(h.$t("requestQuote")),1)),n.popupData.wijzigenPopup?(he(),ye("h2",GH,Ae(h.$t("editQuote")),1)):Pe("",!0),n.popupData.updateToBackendDone?Pe("",!0):(he(),ye("div",HH,[n.popupData.wijzigenPopup?Pe("",!0):(he(),ye("span",WH,Ae(h.$t("quoteForm.intro")),1)),n.popupData.wijzigenPopup?(he(),ye("span",jH,Ae(h.$t("quoteForm.introEdit")),1)):Pe("",!0),K("div",QH,[K("button",{type:"button",class:Qt(["cursor-pointer h-buttonheight-sm rounded-md px-5 py-2 hover:bg-background-light hover:text-tertiary-green transition text-sm font-normal",n.popupData.typeOpdracht=="particulier"?"bg-background-light text-tertiary-green":"bg-dropdown-open text-white"]),onClick:p[0]||(p[0]=A=>n.popupData.typeOpdracht="particulier")},Ae(h.$t("quoteForm.private")),3),K("button",{type:"button",class:Qt(["cursor-pointer h-buttonheight-sm rounded-md px-5 py-2 hover:bg-background-light hover:text-tertiary-green transition text-sm font-normal",n.popupData.typeOpdracht=="zakelijk"?"bg-background-light text-tertiary-green":"bg-dropdown-open text-white"]),onClick:p[1]||(p[1]=A=>n.popupData.typeOpdracht="zakelijk")},Ae(h.$t("quoteForm.business")),3)]),K("div",$H,[n.popupData.typeOpdracht=="zakelijk"?(he(),ye("div",YH,[K("label",XH,[Ye(Ae(h.$t("quoteForm.companyName"))+" ",1),Kn(K("input",{type:"text",placeholder:h.$t("quoteForm.companyName_placeholder"),class:"mt-2 w-full bg-popup-input text-white px-4 py-2 rounded-md focus:outline-hidden h-12 placeholder:transition-opacity placeholder:duration-200 placeholder:ease-out focus:placeholder:opacity-0","onUpdate:modelValue":p[2]||(p[2]=A=>n.popupData.bedrijfsnaam=A)},null,8,qH),[[Rr,n.popupData.bedrijfsnaam]]),a.bedrijfsnaam?(he(),ye("div",{key:0,class:Qt(c.value)},Ae(a.bedrijfsnaam),3)):Pe("",!0)]),K("label",KH,[Ye(Ae(h.$t("quoteForm.reference"))+" ",1),Kn(K("input",{type:"text",placeholder:h.$t("quoteForm.reference_placeholder"),class:"mt-2 w-full bg-popup-input text-white px-4 py-2 rounded-md focus:outline-hidden h-12 placeholder:transition-opacity placeholder:duration-200 placeholder:ease-out focus:placeholder:opacity-0","onUpdate:modelValue":p[3]||(p[3]=A=>n.popupData.referentie=A)},null,8,ZH),[[Rr,n.popupData.referentie]])])])):Pe("",!0),K("div",JH,[K("label",eW,[Ye(Ae(h.$t("quoteForm.firstName"))+" ",1),Kn(K("input",{type:"text",placeholder:h.$t("quoteForm.firstName_placeholder"),class:"mt-2 w-full bg-popup-input text-white px-4 py-2 rounded-md focus:outline-hidden h-12 placeholder:transition-opacity placeholder:duration-200 placeholder:ease-out focus:placeholder:opacity-0","onUpdate:modelValue":p[4]||(p[4]=A=>n.popupData.voornaam=A),"aria-invalid":!!a.voornaam},null,8,tW),[[Rr,n.popupData.voornaam]]),a.voornaam?(he(),ye("div",{key:0,class:Qt(c.value)},Ae(a.voornaam),3)):Pe("",!0)]),K("label",nW,[Ye(Ae(h.$t("quoteForm.lastName_required"))+" ",1),Kn(K("input",{type:"text",placeholder:h.$t("quoteForm.lastName_placeholder"),class:"mt-2 w-full bg-popup-input text-white px-4 py-2 rounded-md focus:outline-hidden h-12 placeholder:transition-opacity placeholder:duration-200 placeholder:ease-out focus:placeholder:opacity-0","onUpdate:modelValue":p[5]||(p[5]=A=>n.popupData.achternaam=A),"aria-invalid":!!a.achternaam},null,8,rW),[[Rr,n.popupData.achternaam]]),a.achternaam?(he(),ye("div",{key:0,class:Qt(c.value)},Ae(a.achternaam),3)):Pe("",!0)])]),K("div",oW,[K("label",iW,[Ye(Ae(h.$t("quoteForm.city"))+" ",1),Kn(K("input",{type:"text",placeholder:h.$t("quoteForm.city_placeholder"),class:"mt-2 w-full bg-popup-input text-white px-4 py-2 rounded-md focus:outline-hidden h-12 placeholder:transition-opacity placeholder:duration-200 placeholder:ease-out focus:placeholder:opacity-0","onUpdate:modelValue":p[6]||(p[6]=A=>n.popupData.woonplaatsMontage=A)},null,8,aW),[[Rr,n.popupData.woonplaatsMontage]]),a.woonplaatsMontage?(he(),ye("div",{key:0,class:Qt(c.value)},Ae(a.woonplaatsMontage),3)):Pe("",!0)]),K("label",sW,[Ye(Ae(h.$t("quoteForm.installation_choice"))+" ",1),Be(m,{class:"mt-2",modelValue:n.popupData.klantkeuzeMontage,"onUpdate:modelValue":p[7]||(p[7]=A=>n.popupData.klantkeuzeMontage=A),options:i.value,mode:"dark"},null,8,["modelValue","options"])])]),K("div",lW,[K("label",cW,[Ye(Ae(h.$t("quoteForm.email_required"))+" ",1),Kn(K("input",{type:"email",placeholder:h.$t("quoteForm.email_placeholder"),class:"mt-2 w-full bg-popup-input text-white px-4 py-2 rounded-md focus:outline-hidden h-12 placeholder:transition-opacity placeholder:duration-200 placeholder:ease-out focus:placeholder:opacity-0","onUpdate:modelValue":p[8]||(p[8]=A=>n.popupData.emailadres=A)},null,8,uW),[[Rr,n.popupData.emailadres]]),a.emailadres?(he(),ye("div",{key:0,class:Qt(c.value)},Ae(a.emailadres),3)):Pe("",!0)]),K("label",dW,[Ye(Ae(h.$t("quoteForm.phone_required"))+" ",1),Kn(K("input",{type:"tel",placeholder:h.$t("quoteForm.phone_placeholder"),class:"mt-2 w-full bg-popup-input text-white px-4 py-2 rounded-md focus:outline-hidden h-12 placeholder:transition-opacity placeholder:duration-200 placeholder:ease-out focus:placeholder:opacity-0","onUpdate:modelValue":p[9]||(p[9]=A=>n.popupData.telefoonnummer=A)},null,8,fW),[[Rr,n.popupData.telefoonnummer]]),a.telefoonnummer?(he(),ye("div",{key:0,class:Qt(c.value)},Ae(a.telefoonnummer),3)):Pe("",!0)])]),K("label",hW,[Ye(Ae(h.$t("quoteForm.remarks_optional"))+" ",1),Kn(K("textarea",{placeholder:h.$t("quoteForm.remarks_placeholder"),class:"mt-2 w-full bg-popup-input text-white px-4 py-2 rounded-md resize-none h-24 focus:outline-hidden placeholder:transition-opacity placeholder:duration-200 placeholder:ease-out focus:placeholder:opacity-0","onUpdate:modelValue":p[10]||(p[10]=A=>n.popupData.opmerkingen=A)},null,8,pW),[[Rr,n.popupData.opmerkingen]])]),n.popupData.companyInternalEdit?(he(),ye("div",mW,[Be(g,{checked:n.popupData.updateToBackendSkipMailChecked,"onUpdate:checked":p[11]||(p[11]=A=>n.popupData.updateToBackendSkipMailChecked=A),value:h.$t("quoteForm.no_change_mail")},null,8,["checked","value"])])):Pe("",!0),K("button",{type:"button",class:"cursor-pointer flex items-center h-13 mt-2 bg-primary-green text-tertiary-green font-normal px-5 py-2.5 rounded-md hover:bg-button-hover-green transition",disabled:n.popupData.updateToBackendActive,onClick:d},[n.popupData.updateToBackendActive?Pe("",!0):(he(),ye("svg",_W,[...p[15]||(p[15]=[K("path",{d:"M1 15H11V6H6.5H6V5.5V1H1V15ZM7 1.1875V5H10.8125L7 1.1875ZM7.25 0L12 4.75V15V16H11H1H0V15V1V0H1H7.25ZM2 2H2.5H4.5H5V3H4.5H2.5H2V2ZM2 4H2.5H4.5H5V5H4.5H2.5H2V4ZM7 14V13H7.5H9.5H10V14H9.5H7.5H7ZM9 10.5V8.5H3V10.5H9ZM3 7.5H9H10V8.5V10.5V11.5H9H3H2V10.5V8.5V7.5H3Z",fill:"#1C2523"},null,-1)])])),n.popupData.updateToBackendActive?(he(),ye("svg",vW,[...p[16]||(p[16]=[K("path",{d:"M100 50.5908C100 78.2051 77.6142 100.591 50 100.591C22.3858 100.591 0 78.2051 0 50.5908C0 22.9766 22.3858 0.59082 50 0.59082C77.6142 0.59082 100 22.9766 100 50.5908ZM9.08144 50.5908C9.08144 73.1895 27.4013 91.5094 50 91.5094C72.5987 91.5094 90.9186 73.1895 90.9186 50.5908C90.9186 27.9921 72.5987 9.67226 50 9.67226C27.4013 9.67226 9.08144 27.9921 9.08144 50.5908Z",fill:"currentColor"},null,-1),K("path",{d:"M93.9676 39.0409C96.393 38.4038 97.8624 35.9116 97.0079 33.5539C95.2932 28.8227 92.871 24.3692 89.8167 20.348C85.8452 15.1192 80.8826 10.7238 75.2124 7.41289C69.5422 4.10194 63.2754 1.94025 56.7698 1.05124C51.7666 0.367541 46.6976 0.446843 41.7345 1.27873C39.2613 1.69328 37.813 4.19778 38.4501 6.62326C39.0873 9.04874 41.5694 10.4717 44.0505 10.1071C47.8511 9.54855 51.7191 9.52689 55.5402 10.0491C60.8642 10.7766 65.9928 12.5457 70.6331 15.2552C75.2735 17.9648 79.3347 21.5619 82.5849 25.841C84.9175 28.9121 86.7997 32.2913 88.1811 35.8758C89.083 38.2158 91.5421 39.6781 93.9676 39.0409Z",fill:"currentFill"},null,-1)])])):Pe("",!0),K("span",null,[n.popupData.wijzigenPopup?Pe("",!0):(he(),ye("span",AW,Ae(h.$t("requestQuote")),1)),n.popupData.wijzigenPopup?(he(),ye("span",yW,Ae(h.$t("editQuote")),1)):Pe("",!0)])],8,gW)])])),n.popupData.updateToBackendDone?(he(),ye("div",bW,[K("div",xW,Ae(h.$t("quoteForm.success.received")),1),K("div",EW,Ae(h.$t("quoteForm.success.followup")),1),K("div",CW,Ae(h.$t("quoteForm.success.contact")),1),K("div",SW,Ae(h.$t("quoteForm.success.closure")),1),K("button",{type:"submit",class:"flex items-center h-13 mt-2 bg-primary-green text-tertiary-green font-normal px-5 py-2.5 rounded-md hover:bg-button-hover-green transition",onClick:p[12]||(p[12]=A=>n.popupData.popup=!1)},[p[17]||(p[17]=K("svg",{class:"mr-2",width:"12",height:"16",viewBox:"0 0 12 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[K("path",{d:"M1 15H11V6H6.5H6V5.5V1H1V15ZM7 1.1875V5H10.8125L7 1.1875ZM7.25 0L12 4.75V15V16H11H1H0V15V1V0H1H7.25ZM2 2H2.5H4.5H5V3H4.5H2.5H2V2ZM2 4H2.5H4.5H5V5H4.5H2.5H2V4ZM7 14V13H7.5H9.5H10V14H9.5H7.5H7ZM9 10.5V8.5H3V10.5H9ZM3 7.5H9H10V8.5V10.5V11.5H9H3H2V10.5V8.5V7.5H3Z",fill:"#1C2523"})],-1)),K("span",null,[K("span",null,Ae(h.$t("popup.close")),1)])])])):Pe("",!0)])],32)]),_:1},8,["modelValue","imageSrc","imageAlt"])}}},MW={class:"h-fit overflow-y-auto"},TW={class:"text-[28px] font-normal mb-4 leading-[1.2]"},IW={class:"text-base font-normal text-white mb-6 leading-[2]"},RW={class:"space-y-4"},LW={class:"flex flex-col xs:flex-row gap-4"},PW={class:"w-full text-sm"},DW=["placeholder"],BW={class:"flex flex-col xs:flex-row gap-4"},NW={class:"w-full text-sm"},OW=["placeholder"],kW={class:"flex flex-col xs:flex-row gap-4"},FW={class:"w-full text-sm"},VW={key:0},UW={key:1},zW={class:"text-center"},GW={role:"status"},HW={class:"sr-only"},WW={__name:"OntwerpOpslaan",props:{popupData:Object,baseUrl:String},setup(n){return(e,t)=>{const r=Yt("ConfirmDlg");return he(),gt(r,{modelValue:n.popupData.popup,"onUpdate:modelValue":t[4]||(t[4]=o=>n.popupData.popup=o),imageSrc:n.baseUrl+"/Uploads/aluwdoors-configuratie-opslaan.jpg",imageAlt:e.$t("popup.image_alt")},{default:ot(()=>[K("div",MW,[K("h2",TW,Ae(e.$t("saveDesign.title")),1),K("span",IW,Ae(e.$t("saveDesign.intro")),1),K("div",RW,[K("div",LW,[K("label",PW,[Ye(Ae(e.$t("saveDesign.firstName"))+" ",1),Kn(K("input",{type:"text",placeholder:e.$t("saveDesign.firstName_placeholder"),class:"mt-2 w-full bg-popup-input text-white px-4 py-2 rounded focus:outline-hidden","onUpdate:modelValue":t[0]||(t[0]=o=>n.popupData.customerData.voornaam=o)},null,8,DW),[[Rr,n.popupData.customerData.voornaam]])])]),K("div",BW,[K("label",NW,[Ye(Ae(e.$t("saveDesign.lastName"))+" ",1),Kn(K("input",{type:"text",placeholder:e.$t("saveDesign.lastName_placeholder"),class:"mt-2 w-full bg-popup-input text-white px-4 py-2 rounded focus:outline-hidden","onUpdate:modelValue":t[1]||(t[1]=o=>n.popupData.customerData.achternaam=o)},null,8,OW),[[Rr,n.popupData.customerData.achternaam]])])]),K("div",kW,[K("label",FW,[Ye(Ae(e.$t("saveDesign.email"))+" ",1),Kn(K("input",{type:"email",placeholder:"info@klant.nl",class:"mt-2 w-full bg-popup-input text-white px-4 py-2 rounded focus:outline-hidden","onUpdate:modelValue":t[2]||(t[2]=o=>n.popupData.customerData.email=o)},null,512),[[Rr,n.popupData.customerData.email]])])]),K("button",{type:"submit",class:"flex items-center h-13 mt-2 bg-primary-green text-tertiary-green font-normal px-5 py-2.5 rounded-md hover:bg-button-hover-green transition",onClick:t[3]||(t[3]=o=>e.$emit("submit"))},[t[6]||(t[6]=K("svg",{class:"mr-2",width:"14",height:"14",viewBox:"0 0 14 14",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[K("path",{d:"M1 14H0V13V1V0H1H10.5L14 3.5V13V14H13H1ZM13 13V3.9375L10.0625 1H10V4.5V5H9.5H2.5H2V4.5V1H1V13H13ZM3 1V4H9V1H3ZM5.5 9C5.5 9.5625 5.78125 10.0312 6.25 10.3125C6.6875 10.5938 7.28125 10.5938 7.75 10.3125C8.1875 10.0312 8.5 9.5625 8.5 9C8.5 8.46875 8.1875 8 7.75 7.71875C7.28125 7.4375 6.6875 7.4375 6.25 7.71875C5.78125 8 5.5 8.46875 5.5 9ZM7 11.5C6.09375 11.5 5.28125 11.0312 4.8125 10.25C4.375 9.5 4.375 8.53125 4.8125 7.75C5.28125 7 6.09375 6.5 7 6.5C7.875 6.5 8.6875 7 9.15625 7.75C9.59375 8.53125 9.59375 9.5 9.15625 10.25C8.6875 11.0312 7.875 11.5 7 11.5Z",fill:"#1C2523"})],-1)),n.popupData.updateToBackendActive?Pe("",!0):(he(),ye("span",VW,Ae(e.$t("saveDesign.button")),1)),n.popupData.updateToBackendActive?(he(),ye("span",UW,[K("div",zW,[K("div",GW,[t[5]||(t[5]=K("svg",{"aria-hidden":"true",class:"inline w-8 h-8 text-gray-200 animate-spin dark:text-gray-600 fill-blue-600",viewBox:"0 0 100 101",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[K("path",{d:"M100 50.5908C100 78.2051 77.6142 100.591 50 100.591C22.3858 100.591 0 78.2051 0 50.5908C0 22.9766 22.3858 0.59082 50 0.59082C77.6142 0.59082 100 22.9766 100 50.5908ZM9.08144 50.5908C9.08144 73.1895 27.4013 91.5094 50 91.5094C72.5987 91.5094 90.9186 73.1895 90.9186 50.5908C90.9186 27.9921 72.5987 9.67226 50 9.67226C27.4013 9.67226 9.08144 27.9921 9.08144 50.5908Z",fill:"currentColor"}),K("path",{d:"M93.9676 39.0409C96.393 38.4038 97.8624 35.9116 97.0079 33.5539C95.2932 28.8227 92.871 24.3692 89.8167 20.348C85.8452 15.1192 80.8826 10.7238 75.2124 7.41289C69.5422 4.10194 63.2754 1.94025 56.7698 1.05124C51.7666 0.367541 46.6976 0.446843 41.7345 1.27873C39.2613 1.69328 37.813 4.19778 38.4501 6.62326C39.0873 9.04874 41.5694 10.4717 44.0505 10.1071C47.8511 9.54855 51.7191 9.52689 55.5402 10.0491C60.8642 10.7766 65.9928 12.5457 70.6331 15.2552C75.2735 17.9648 79.3347 21.5619 82.5849 25.841C84.9175 28.9121 86.7997 32.2913 88.1811 35.8758C89.083 38.2158 91.5421 39.6781 93.9676 39.0409Z",fill:"currentFill"})],-1)),K("span",HW,Ae(e.$t("loading")),1)])])])):Pe("",!0)])])])]),_:1},8,["modelValue","imageSrc","imageAlt"])}}},jW={class:"h-fit overflow-y-auto w-full"},QW={class:"text-[28px] font-normal mb-4 leading-[1.2]"},$W={class:"text-base font-normal text-white mb-6 leading-loose"},YW={class:"space-y-4"},XW={class:"flex flex-col xs:flex-row gap-4 my-4"},qW={class:"w-full text-sm"},KW=["placeholder"],ZW={__name:"EditConfigurationName",props:{popupData:Object,baseUrl:String},setup(n){return(e,t)=>{const r=Yt("ConfirmDlg");return he(),gt(r,{modelValue:n.popupData.popup,"onUpdate:modelValue":t[2]||(t[2]=o=>n.popupData.popup=o),imageSrc:n.baseUrl+"/Uploads/aluwdoors-configuratie-opslaan.jpg",imageAlt:e.$t("popup.image_alt")},{default:ot(()=>[K("div",jW,[K("h2",QW,Ae(e.$t("editName.title")),1),K("span",$W,Ae(e.$t("editName.description")),1),K("div",YW,[K("div",XW,[K("label",qW,[Ye(Ae(e.$t("editName.design_name"))+" ",1),Kn(K("input",{type:"text",placeholder:e.$t("editName.design_name_placeholder"),class:"mt-2 w-full bg-popup-input text-white px-4 py-2 rounded-md focus:outline-hidden h-12 placeholder:transition-opacity placeholder:duration-200 placeholder:ease-out focus:placeholder:opacity-0","onUpdate:modelValue":t[0]||(t[0]=o=>n.popupData.editNameInput=o)},null,8,KW),[[Rr,n.popupData.editNameInput]])])]),K("button",{type:"submit",class:"flex items-center h-13 mt-8 bg-primary-green text-tertiary-green font-normal px-5 py-2.5 rounded-md hover:bg-button-hover-green transition",onClick:t[1]||(t[1]=o=>e.$emit("submit"))},[t[3]||(t[3]=K("svg",{class:"mr-2",width:"14",height:"14",viewBox:"0 0 14 14",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[K("path",{d:"M1 14H0V13V1V0H1H10.5L14 3.5V13V14H13H1ZM13 13V3.9375L10.0625 1H10V4.5V5H9.5H2.5H2V4.5V1H1V13H13ZM3 1V4H9V1H3ZM5.5 9C5.5 9.5625 5.78125 10.0312 6.25 10.3125C6.6875 10.5938 7.28125 10.5938 7.75 10.3125C8.1875 10.0312 8.5 9.5625 8.5 9C8.5 8.46875 8.1875 8 7.75 7.71875C7.28125 7.4375 6.6875 7.4375 6.25 7.71875C5.78125 8 5.5 8.46875 5.5 9ZM7 11.5C6.09375 11.5 5.28125 11.0312 4.8125 10.25C4.375 9.5 4.375 8.53125 4.8125 7.75C5.28125 7 6.09375 6.5 7 6.5C7.875 6.5 8.6875 7 9.15625 7.75C9.59375 8.53125 9.59375 9.5 9.15625 10.25C8.6875 11.0312 7.875 11.5 7 11.5Z",fill:"#1C2523"})],-1)),Ye(" "+Ae(e.$t("editName.button")),1)])])])]),_:1},8,["modelValue","imageSrc","imageAlt"])}}},JW={class:"h-fit overflow-y-auto"},ej={class:"text-[28px] font-normal mb-4 leading-[1.2]"},tj={class:"text-base font-normal text-white mb-4 leading-loose"},nj={class:"space-y-4"},rj={class:"flex flex-col xs:flex-row gap-4 my-4"},oj={class:"w-full text-sm"},ij=["value"],aj={__name:"RemoveConfiguration",props:{popupData:Object,baseUrl:String},setup(n){return(e,t)=>{const r=Yt("ConfirmDlg");return he(),gt(r,{modelValue:n.popupData.popup,"onUpdate:modelValue":t[1]||(t[1]=o=>n.popupData.popup=o),imageSrc:n.baseUrl+"/Uploads/aluwdoors-configuratie-opslaan.jpg",imageAlt:e.$t("popup.image_alt")},{default:ot(()=>[K("div",JW,[K("h2",ej,Ae(e.$t("deleteConfig.title")),1),K("span",tj,Ae(e.$t("deleteConfig.description")),1),K("div",nj,[K("div",rj,[K("label",oj,[K("input",{type:"text",readonly:"",placeholder:"",class:"mt-2 w-full bg-popup-input text-white px-4 py-2 rounded-md focus:outline-hidden h-12 placeholder:transition-opacity placeholder:duration-200 placeholder:ease-out focus:placeholder:opacity-0",value:n.popupData.actualName},null,8,ij)])]),K("button",{type:"submit",class:"cursor-pointer flex items-center h-13 mt-8 bg-warning-red text-white font-normal px-5 py-2.5 rounded-md hover:bg-warning-red/80 transition",onClick:t[0]||(t[0]=o=>e.$emit("submit"))},[t[2]||(t[2]=K("svg",{class:"mr-2",width:"14",height:"16",viewBox:"0 0 14 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[K("path",{d:"M5 0H9H9.25L9.40625 0.25L10.5 2H11.9688H13H14V3H12.9062L12 16H2L1.0625 3H0V2H1H2H3.46875L4.5625 0.25L4.71875 0H5ZM9.34375 2L8.71875 1H5.25L4.625 2H9.34375ZM2.90625 15H11.0625L11.9062 3H2.0625L2.90625 15ZM4.96875 6.28125L5.3125 6.65625L7 8.3125L8.65625 6.65625L9 6.28125L9.71875 7L9.34375 7.34375L7.6875 9L9.34375 10.6875L9.71875 11.0312L9 11.75L8.65625 11.375L7 9.71875L5.3125 11.375L4.96875 11.75L4.25 11.0312L4.625 10.6875L6.28125 9L4.625 7.34375L4.25 7L4.96875 6.28125Z",fill:"#F0F3F3"})],-1)),Ye(" "+Ae(e.$t("deleteConfig.button")),1)])])])]),_:1},8,["modelValue","imageSrc","imageAlt"])}}};function sj(n,e=null,t=(r,o)=>r){const r=n?JSON.parse(JSON.stringify(n)):{};"price"in r&&delete r.price,"vat"in r&&delete r.vat,r.deur_aantal_staander??(r.deur_aantal_staander=0),r.deur_aantal_ligger??(r.deur_aantal_ligger=0),r.roede_configuratie??(r.roede_configuratie=""),r.fineer??(r.fineer=!1),r.roede_design_keuze??(r.roede_design_keuze=!1),r.bovenlicht_verberg_tussenstijl??(r.bovenlicht_verberg_tussenstijl=!1),r.bovenlicht_stijl_zijpaneel??(r.bovenlicht_stijl_zijpaneel=!1),r.kleur_ral_type??(r.kleur_ral_type="ntb"),r.zijpaneel_aantal_links??(r.zijpaneel_aantal_links=0),r.zijpaneel_aantal_rechts??(r.zijpaneel_aantal_rechts=0),r.deur_aantal_staander_input??(r.deur_aantal_staander_input=r.deur_aantal_staander),r.deur_aantal_ligger_input??(r.deur_aantal_ligger_input=r.deur_aantal_ligger),r.roede_configuratie_input??(r.roede_configuratie_input=r.roede_configuratie),!e||Object.keys(e).length;const o=!!e&&r.type!==e.type,i=!!e&&r.deur_aantal!==e.deur_aantal,a=!!e&&r.breedte!==e.breedte,s=!!e&&r.zijpaneel_aantal_links!==e.zijpaneel_aantal_links,l=!!e&&r.zijpaneel_aantal_rechts!==e.zijpaneel_aantal_rechts,c=!!e&&r.deur_aantal_ligger!==e.deur_aantal_ligger,u=!!e&&r.deur_aantal_staander!==e.deur_aantal_staander,d=!!e&&r.zijpaneel_aantal_staander!==e.zijpaneel_aantal_staander,f=!!e&&r.roede_design_keuze!==e.roede_design_keuze,h=!!e&&r.kleur_materiaal.includes("FINEER")&&!e.kleur_materiaal.includes("FINEER"),p=!!e&&r.draairichting!==e.draairichting&&(r.draairichting=="DRAAI_RECHTS"||e.draairichting=="DRAAI_RECHTS"),m=!!e&&r.schuifrichting!==e.schuifrichting&&(r.schuifrichting=="SCHUIF_RECHTS"||e.schuifrichting=="SCHUIF_RECHTS"),g={limitPanelWidth:"",limitPanelHeight:"",underWidthHeightInput:"",underPanelQuantityInput:"",underSidePanelDimensionInput:"",underSidePanelDimensionInputLeft:[],underSidePanelDimensionInputRight:[],underPanelWidthInput:[],underBovenlichtInput:"",underRalColorNumberInput:"",underInputStaanderDeur:[],underInputLiggerDeur:[]},_=nT(r.type),A=rT(r.type),y=oT(r.type),b=iT(r.type),E=aT(r.type),x=sT(r.type),w=Zz(r.type,r.bovenlicht,r.zijpaneel_aantal_links,r.zijpaneel_aantal_rechts);if(r.deurbreedtevariabelVisible=["vaste-wand"].includes(r.type)&&r.deur_aantal>1,r.deurbreedtevariabel=r.deurbreedtevariabel&&r.deurbreedtevariabelVisible,r.bovenlichtVisible=["taatsdeur","scharnierdeur"].includes(r.type),r.bovenlicht=r.bovenlicht&&r.bovenlichtVisible,r.hoogte=Number(r.hoogte),r.breedte=Number(r.breedte),r.hoogtebovenlicht=Number(r.hoogtebovenlicht),r.deur_aantal<_&&(r.deur_aantal=_),r.deur_aantal>A&&(r.deur_aantal=A),r.breedte<y?(r.breedte=y,o||(g.limitPanelWidth=t("userMessages.minWidth",{limit:y}))):r.breedte>b?(r.breedte=b,o||(g.limitPanelWidth=t("userMessages.maxWidth",{limit:b}))):g.limitPanelWidth="",r.breedte*r.deur_aantal>Ve.maximaleTotaleBreedteCm&&!r.deurbreedtevariabel){let G=Ve.maximaleTotaleBreedteCm/r.deur_aantal;G=Number(G.toFixed(2)),r.breedte=G,o||(g.underWidthHeightInput=t("userMessages.maxWidthAutoAdjusted",{limit:Ve.maximaleTotaleBreedteCm}))}if(r.deurbreedtevariabel){r.variabeledeurbreedte_maten=r.variabeledeurbreedte_maten.map(se=>Number(se)||0);let G=0;for(let se=0;se<r.deur_aantal;se++)G+=r.variabeledeurbreedte_maten[se];for(let se=0;se<r.deur_aantal;se++){if(g.underPanelWidthInput[se]="",!!e&&r.variabeledeurbreedte_maten[se]!==e.variabeledeurbreedte_maten[se]&&G>Ve.maximaleTotaleBreedteCm){let ie=Ve.maximaleTotaleBreedteCm-(G-r.variabeledeurbreedte_maten[se]);r.variabeledeurbreedte_maten[se]=ie,o||(g.underPanelWidthInput[se]=t("userMessages.maxWidthThisSidePanel",{maxPanelWidth:ie,maxTotalWidth:Ve.maximaleTotaleBreedteCm}))}r.variabeledeurbreedte_maten[se]<y&&(r.variabeledeurbreedte_maten[se]=y,o||(g.underPanelWidthInput[se]=t("userMessages.minWidth",{limit:y}))),r.variabeledeurbreedte_maten[se]>b&&(r.variabeledeurbreedte_maten[se]=b,o||(g.underPanelWidthInput[se]=t("userMessages.maxWidth",{limit:b})))}}if(r.deurbreedtevariabel&&i){let G=0;for(let se=0;se<r.deur_aantal;se++)G+=r.variabeledeurbreedte_maten[se];if(G>Ve.maximaleTotaleBreedteCm){for(let se=0;se<r.deur_aantal;se++)r.variabeledeurbreedte_maten[se]=Ve.maximaleTotaleBreedteCm/r.deur_aantal;o||(g.underPanelQuantityInput=t("userMessages.maxWidthAutoAdjusted",{limit:Ve.maximaleTotaleBreedteCm}))}else g.underPanelQuantityInput=""}if(r.variabeledeurbreedte_maten??(r.variabeledeurbreedte_maten=[]),r.deurbreedtevariabel)for(let G=0;G<r.deur_aantal;G++)typeof r.variabeledeurbreedte_maten[G]>"u"&&(r.variabeledeurbreedte_maten[G]=60);else for(let G=0;G<6;G++)r.variabeledeurbreedte_maten[G]=r.breedte;r.hoogte<E?(r.hoogte=E,o||(g.limitPanelHeight=t("userMessages.minHeight",{limit:E}))):r.hoogte>x?(r.hoogte=x,o||(g.limitPanelHeight=t("userMessages.maxHeight",{limit:x}))):g.limitPanelHeight="",r.bovenlicht&&(r.bovenlicht&&r.hoogtebovenlicht+r.hoogte>w?w-r.hoogte<Ve.bovenLichtMinHoogte?(r.hoogtebovenlicht=Ve.bovenLichtMinHoogte,r.hoogte=w-r.hoogtebovenlicht,g.underBovenlichtInput=t("userMessages.topLightWithSidePanelMaxHeight",{maxHeight:w,heightDoor:r.hoogte,heightTopLight:r.hoogtebovenlicht})):(r.hoogtebovenlicht=w-r.hoogte,g.underBovenlichtInput=t("userMessages.topLightHeight",{doorHeight:r.hoogte,limit:r.hoogtebovenlicht})):r.hoogtebovenlicht<Ve.bovenLichtMinHoogte?(r.hoogtebovenlicht=Ve.bovenLichtMinHoogte,g.underBovenlichtInput=t("userMessages.minHeightTopLight",{limit:Ve.bovenLichtMinHoogte})):r.hoogtebovenlicht>Ve.bovenLichtMaxHoogte?(r.hoogtebovenlicht=Ve.bovenLichtMaxHoogte,g.underBovenlichtInput=t("userMessages.maxHeightTopLight",{limit:Ve.bovenLichtMaxHoogte})):g.underBovenlichtInput=""),r.zijpaneel_breedte_links??(r.zijpaneel_breedte_links=[]);for(let G=1;G<=Ve.maxZijpanelenLinks;G++)typeof(r==null?void 0:r.zijpaneel_breedte_links[G-1])>"u"&&(r.zijpaneel_breedte_links[G-1]=60),r.zijpaneel_breedte_links[G-1]=Number(r.zijpaneel_breedte_links[G-1]),r.zijpaneel_breedte_links[G-1]<Ve.zijPaneelMinBreedte&&(r.zijpaneel_breedte_links[G-1]=Ve.zijPaneelMinBreedte,G<=r.zijpaneel_aantal_links&&!o&&(g.underSidePanelDimensionInputLeft[G-1]=t("userMessages.minWidthSidePanel",{limit:Ve.zijPaneelMinBreedte}))),r.zijpaneel_breedte_links[G-1]>Ve.zijPaneelMaxBreedte&&(r.zijpaneel_breedte_links[G-1]=Ve.zijPaneelMaxBreedte,G<=r.zijpaneel_aantal_links&&!o&&(g.underSidePanelDimensionInputLeft[G-1]=t("userMessages.maxWidthSidePanel",{limit:Ve.zijPaneelMaxBreedte})));r.zijpaneel_breedte_rechts??(r.zijpaneel_breedte_rechts=[]);for(let G=1;G<=Ve.maxZijpanelenRechts;G++)typeof r.zijpaneel_breedte_rechts[G-1]>"u"&&(r.zijpaneel_breedte_rechts[G-1]=60),r.zijpaneel_breedte_rechts[G-1]=Number(r.zijpaneel_breedte_rechts[G-1]),r.zijpaneel_breedte_rechts[G-1]<Ve.zijPaneelMinBreedte&&(r.zijpaneel_breedte_rechts[G-1]=Ve.zijPaneelMinBreedte,G<=r.zijpaneel_aantal_rechts&&!o&&(g.underSidePanelDimensionInputRight[G-1]=t("userMessages.minWidthSidePanel",{limit:Ve.zijPaneelMinBreedte}))),r.zijpaneel_breedte_rechts[G-1]>Ve.zijPaneelMaxBreedte&&(r.zijpaneel_breedte_rechts[G-1]=Ve.zijPaneelMaxBreedte,G<=r.zijpaneel_aantal_rechts&&!o&&(g.underSidePanelDimensionInputRight[G-1]=t("userMessages.maxWidthSidePanel",{limit:Ve.zijPaneelMaxBreedte})));if(["taatsdeur","scharnierdeur","schuifdeur"].includes(r.type)||(r.zijpaneel_aantal_links=0,r.zijpaneel_aantal_rechts=0),r.zijpaneel_aantal_links==0)for(let G=1;G<=Ve.maxZijpanelenLinks;G++)r.zijpaneel_breedte_links[G-1]=60;if(r.zijpaneel_aantal_rechts==0)for(let G=1;G<=Ve.maxZijpanelenRechts;G++)r.zijpaneel_breedte_rechts[G-1]=60;let L=Ve.maximaleTotaleBreedteCm-r.breedte*r.deur_aantal;r.zijpaneel_aantal_links>0||r.zijpaneel_aantal_rechts>0;{let G=0;if(r.zijpaneel_aantal_links>0)for(let se=1;se<=r.zijpaneel_aantal_links;se++)G+=r.zijpaneel_breedte_links[se-1];if(r.zijpaneel_aantal_rechts>0)for(let se=1;se<=r.zijpaneel_aantal_rechts;se++)G+=r.zijpaneel_breedte_rechts[se-1];if(G>L){let se=r.zijpaneel_aantal_links+r.zijpaneel_aantal_rechts,ee=L/se;if(ee=Number(ee.toFixed(2)),r.zijpaneel_aantal_links>0)for(let ie=1;ie<=r.zijpaneel_aantal_links;ie++)r.zijpaneel_breedte_links[ie-1]=ee;if(r.zijpaneel_aantal_rechts>0)for(let ie=1;ie<=r.zijpaneel_aantal_rechts;ie++)r.zijpaneel_breedte_rechts[ie-1]=ee;g.underSidePanelDimensionInput=t("userMessages.maxSidePanelTotalWidth",{limit:Ve.maximaleTotaleBreedteCm})}else g.underSidePanelDimensionInput=""}r.asymmetrisch||(r.asymmetrisch_staander_maten_deur=[],r.asymmetrisch_ligger_maten=[],r.asymmetrisch_staander_maten_zijpaneel=[]),r.roede_design_keuzeVisible=(["taatsdeur","scharnierdeur","schuifdeur","opdekdeur"].includes(r.type)&&r.deur_aantal<=2||["vaste-wand"].includes(r.type)&&r.deur_aantal<2)&&!(r.tienmmglas&&r.verbergtussenstaanders),r.roede_design_keuze=r.roede_design_keuzeVisible?r.roede_design_keuze:!1,r.roede_design_keuze&&(r.typeroede="PLATTE_ROEDE"),f&&r.roede_design_keuze&&(r.roede_design_roedes_doorlopen_zijlicht_bovenlicht=!0,r.roede_configuratie_input==""&&(r.roede_configuratie_input="RV09 - De Nunspeetse")),r.roede_configuratie=r.roede_design_keuze??!1?r.roede_configuratie_input??"":"";let C=0,P=r.deur_aantal==1&&r.draairichting=="DRAAI_RECHTS"?"Rechts":"Links";if(r.roede_design_keuze)for(let G=1;G<=4;G++)cT(G,P,r,aA)&&(C+=1);r.liggers_zijpaneel_links_roedeconfiguratie=C;let D=0,Q=r.deur_aantal==1&&r.draairichting=="DRAAI_RECHTS"?"Links":"Rechts";if(r.roede_design_keuze)for(let G=1;G<=4;G++)cT(G,Q,r,aA)&&(D+=1);if(r.liggers_zijpaneel_rechts_roedeconfiguratie=D,r.deur_aantal_staander_input>0&&!r.asymmetrisch&&!r.roede_design_keuze)for(let G=1;G<=r.deur_aantal;G++)for(let se=1;se<=4;se++)r.deur_aantal_staander_input>=se&&(r.deurbreedtevariabel?r.asymmetrisch_staander_maten_deur[G*100+se]=(r.deurbreedtematen[G]/(r.deur_aantal_staander_input+1)*se).toFixed(1):r.asymmetrisch_staander_maten_deur[G*100+se]=(r.breedte/(r.deur_aantal_staander_input+1)*se).toFixed(1));if(r.deur_aantal_staander_input>0&&r.asymmetrisch)for(let G=1;G<=r.deur_aantal;G++){let se=5,ee=r.deurbreedtevariabel?r.variabeledeurbreedte_maten[G]-5:r.breedte-5,ie=r.deurbreedtevariabel?r.variabeledeurbreedte_maten[G]:r.breedte;for(let H=1;H<=4;H++)if(r.deur_aantal_staander_input>=H){if(g.underInputStaanderDeur[G*100+H]="",(isNaN(Number(r.asymmetrisch_staander_maten_deur[G*100+H]))||r.asymmetrisch_staander_maten_deur[G*100+H]==0||u)&&(r.asymmetrisch_staander_maten_deur[G*100+H]=(ie/(r.deur_aantal_staander_input+1)*H).toFixed(1)),r.asymmetrisch_staander_maten_deur[G*100+H]=Number(r.asymmetrisch_staander_maten_deur[G*100+H]),p||m){let T=ie-r.asymmetrisch_staander_maten_deur[G*100+H];r.asymmetrisch_staander_maten_deur[G*100+H]=T}r.asymmetrisch_staander_maten_deur[G*100+H]<se&&(r.asymmetrisch_staander_maten_deur[G*100+H]=se,g.underInputStaanderDeur[G*100+H]=t("userMessages.minPosition",{limit:se})),r.asymmetrisch_staander_maten_deur[G*100+H]>ee&&(r.asymmetrisch_staander_maten_deur[G*100+H]=ee,g.underInputStaanderDeur[G*100+H]=t("userMessages.maxPosition",{limit:ee}))}}if(["vaste-wand","scharnierdeur"].includes(r.type)&&r.tienmmglas&&r.verbergtussenstaanders&&(r.deur_aantal_staander_input=0),["vouwwand"].includes(r.type)&&(r.deur_aantal_staander_input=0),r.deur_aantal_staanderVisible=!(r!=null&&r.roede_design_keuze)&&!(["vaste-wand","scharnierdeur"].includes(r.type)&&r.tienmmglas&&r.verbergtussenstaanders)&&!["vouwwand"].includes(r.type),r.deur_aantal_staander=r!=null&&r.roede_design_keuze?0:r.deur_aantal_staander_input,r.deur_aantal_ligger_input>0&&!r.asymmetrisch)for(let G=1;G<=4;G++)r.deur_aantal_ligger_input>=G?r.asymmetrisch_ligger_maten[G-1]=(r.hoogte/(r.deur_aantal_ligger_input+1)*G).toFixed(1):r.asymmetrisch_ligger_maten[G-1]=0;if(r.asymmetrisch){let G=5,se=r.hoogte-5,ee=r.hoogte;for(let ie=1;ie<=4;ie++)g.underInputLiggerDeur[ie-1]="",r.deur_aantal_ligger_input>=ie?((isNaN(Number(r.asymmetrisch_ligger_maten[ie-1]))||Number(r.asymmetrisch_ligger_maten[ie-1])==0||c)&&(r.asymmetrisch_ligger_maten[ie-1]=(ee/(r.deur_aantal_ligger_input+1)*ie).toFixed(1)),r.asymmetrisch_ligger_maten[ie-1]=Number(r.asymmetrisch_ligger_maten[ie-1]),r.asymmetrisch_ligger_maten[ie-1]<G&&(r.asymmetrisch_ligger_maten[ie-1]=G,g.underInputLiggerDeur[ie-1]=t("userMessages.minPosition",{limit:G})),r.asymmetrisch_ligger_maten[ie-1]>se&&(r.asymmetrisch_ligger_maten[ie-1]=se,g.underInputLiggerDeur[ie-1]=t("userMessages.maxPosition",{limit:se}))):r.asymmetrisch_ligger_maten[ie-1]=0}if(["vaste-wand","scharnierdeur"].includes(r.type)&&r.tienmmglas&&r.verbergtussenstaanders&&(r.deur_aantal_ligger_input=0),r.deur_aantal_liggerVisible=!(r!=null&&r.roede_design_keuze)&&!(["vaste-wand","scharnierdeur"].includes(r.type)&&r.tienmmglas&&r.verbergtussenstaanders),r.deur_aantal_ligger=r!=null&&r.roede_design_keuze?0:r.deur_aantal_ligger_input,r.zijpaneel_aantal_staander>0&&!r.asymmetrisch){for(let G=1;G<=4;G++)r.zijpaneel_aantal_staander>=G?r.asymmetrisch_staander_maten_zijpaneel[100+G]=(r.zijpaneel_breedte_links[0]/(r.zijpaneel_aantal_staander+1)*G).toFixed(1):r.asymmetrisch_staander_maten_zijpaneel[100+G]=0,r.asymmetrisch_staander_maten_zijpaneel[100+G]=Number(r.asymmetrisch_staander_maten_zijpaneel[100+G]);for(let G=1;G<=4;G++)r.zijpaneel_aantal_staander>=G?r.asymmetrisch_staander_maten_zijpaneel[200+G]=(r.zijpaneel_breedte_rechts[0]/(r.zijpaneel_aantal_staander+1)*G).toFixed(1):r.asymmetrisch_staander_maten_zijpaneel[200+G]=0,r.asymmetrisch_staander_maten_zijpaneel[200+G]=Number(r.asymmetrisch_staander_maten_zijpaneel[200+G])}if(r.zijpaneel_aantal_staander>0&&r.asymmetrisch){for(let G=1;G<=4;G++)r.zijpaneel_aantal_staander>=G&&(isNaN(Number(r.asymmetrisch_staander_maten_zijpaneel[100+G]))||Number(r.asymmetrisch_staander_maten_zijpaneel[100+G])==0||d)&&(r.asymmetrisch_staander_maten_zijpaneel[100+G]=(r.zijpaneel_breedte_links[0]/(r.zijpaneel_aantal_staander+1)*G).toFixed(1)),r.asymmetrisch_staander_maten_zijpaneel[100+G]=Number(r.asymmetrisch_staander_maten_zijpaneel[100+G]);for(let G=1;G<=4;G++)r.zijpaneel_aantal_staander>=G&&(isNaN(Number(r.asymmetrisch_staander_maten_zijpaneel[200+G]))||Number(r.asymmetrisch_staander_maten_zijpaneel[200+G])==0||d)&&(r.asymmetrisch_staander_maten_zijpaneel[200+G]=(r.zijpaneel_breedte_rechts[0]/(r.zijpaneel_aantal_staander+1)*G).toFixed(1)),r.asymmetrisch_staander_maten_zijpaneel[200+G]=Number(r.asymmetrisch_staander_maten_zijpaneel[200+G])}if(r.zijpaneel_aantal_staanderVisible=(r.zijpaneel_aantal_links>0||r.zijpaneel_aantal_rechts>0)&&!(r.tienmmglas&&r.verbergtussenstaanders),r.zijpaneel_aantal_staander=r.zijpaneel_aantal_staanderVisible?r.zijpaneel_aantal_staander:0,r.typeroedeVisible=!r.roede_design_keuze&&!["vouwwand"].includes(r.type)&&(r.deur_aantal_ligger>0||r.deur_aantal_staander>0||r.zijpaneel_aantal_staander>0||r.bovenlicht&&r.deur_aantal>1&&!r.bovenlicht_verberg_tussenstijl||r.bovenlicht&&(r.zijpaneel_aantal_links>0||r.zijpaneel_aantal_rechts>0)&&r.bovenlicht_stijl_zijpaneel),["vouwwand"].includes(r.type)&&(r.typeroede="PLATTE_ROEDE"),r.kleur_materiaal=r.kleur_materiaal||"KLEUR_ALUMINIUM_ZWART",["opdekdeur","vouwwand"].includes(r.type)&&r.kleur_materiaal.includes("FINEER")&&(r.kleur_materiaal="KLEUR_ALUMINIUM_ZWART"),["vouwwand"].includes(r.type)&&(r.kleur_materiaal="KLEUR_ALUMINIUM_ZWART"),!uj(r.kleur_materiaal))if(r.kleur_materiaal=="KLEUR_ALUMINIUM_GRIJS")r.kleur_materiaal="KLEUR_ALUMINIUM_RAL",r.kleur_ral=7006,r.ral_opmerking="KLEUR_ALUMINIUM_GRIJS";else{r.ral_opmerking=r.kleur_materiaal;let G=r.kleur_materiaal;const se=G.match(/\d+/);r.kleur_ral=se?Number(se[0]):G,r.kleur_materiaal="KLEUR_ALUMINIUM_RAL"}!cj(r.kleur_materiaal,r.type)&&r.kleur_materiaal.includes("FINEER")&&(r.kleur_materiaal="FINEER_RM_21_NATURAL"),!lj(r.kleur_materiaal,r.type)&&!r.kleur_materiaal.includes("FINEER")&&(r.kleur_materiaal="KLEUR_ALUMINIUM_ZWART"),r.kleur_materiaal=r.kleur_materiaal||"KLEUR_ALUMINIUM_ZWART",dj(r.kleur_glas,r.type)||(r.kleur_glas="GLAS_BLANK"),r.kleur_materiaal=="KLEUR_ALUMINIUM_RAL"&&r.kleur_ral_type==""&&(r.kleur_ral_type="ntb"),r.deur_aantal!=1&&(r.draairichting="DRAAI_NTB"),r.draairichting!="DRAAI_NTB"&&r.draairichting!="DRAAI_LINKS"&&r.draairichting!="DRAAI_RECHTS"&&(r.draairichting="DRAAI_NTB"),r.kleur_materiaal.includes("FINEER")||(Mf(r.handgreep,r.type)&&(r.type_handgreep="aluminium"),Mf(r.handgreep,r.type)||(r.handgreep="HANDGREEP_HOEK",r.type_handgreep="aluminium")),r.kleur_materiaal.includes("FINEER")?(uA(r.handgreep,r.type)||(r.handgreep="HANDGREEP_HOEK",r.type_handgreep="aluminium"),["aluminium","hout"].includes(r.type_handgreep)||(Mf(r.handgreep,r.type)?r.type_handgreep="aluminium":uA(r.handgreep,r.type)?r.type_handgreep="hout":(r.handgreep="HANDGREEP_HOEK",r.type_handgreep="aluminium"))):r.type_handgreep="aluminium",h&&(r.handgreep="FINEER_HANDGREEP_HOEKGREEP",r.type_handgreep="hout"),r.type_handgreep=="aluminium"&&!Mf(r.handgreep,r.type)&&(r.handgreep="HANDGREEP_HOEK",r.type_handgreep="aluminium"),r.type_handgreep=="hout"&&!uA(r.handgreep,r.type)&&(r.handgreep="FINEER_HANDGREEP_HOEKGREEP",r.type_handgreep="hout"),r.type=="vouwwand"&&(Mf(r.handgreep,r.type)||(r.handgreep="HANDGREEP_KLINK_1")),r.type=="opdekdeur"&&(r.handgreep="HANDGREEP_KLINK_1"),r.kleur_materiaal=="KLEUR_ALUMINIUM_RAL"&&(r.kleur_ral<1e3||r.kleur_ral>9999)?g.underRalColorNumberInput=t("userMessages.ralColorRange"):g.underRalColorNumberInput="",r.draairichtingVisible=["taatsdeur","scharnierdeur","opdekdeur"].includes(r.type)&&r.deur_aantal==1,r.draairichtingVisible||(r.draairichting="DRAAI_NTB"),r.actievedeurVisible=["scharnierdeur"].includes(r.type)&&r.deur_aantal>1,r.actievedeurVisible||(r.actievedeur="ACTIEVEDEUR_NTB"),r.actievedeurVisible&&r.actievedeur==""&&(r.actievedeur="ACTIEVEDEUR_NTB"),r.type_vergrendelingVisible=["scharnierdeur","opdekdeur"].includes(r.type)&&(r.handgreep=="HANDGREEP_KLINK_1"||r.handgreep=="HANDGREEP_KLINK_2")||["vouwwand"].includes(r.type)&&r.handgreep=="HANDGREEP_KLINK_1",r.type_vergrendelingVisible||(r.type_vergrendeling="geen");let re=[];return["vouwwand"].includes(r.type)?re=[{label:t("step3.lock_none"),value:"geen"},{label:t("step3.lock_cylinder"),value:"cilinder"}]:re=[{label:t("step3.lock_none"),value:"geen"},{label:t("step3.lock_cylinder"),value:"cilinder"},{label:t("step3.lock_occupied_free"),value:"vrijbezet"}],r.type_vergrendelingOptions=re,r.cilinder=(r.type_vergrendeling=="cilinder"&&r.type_vergrendelingVisible)??!1,r.vrijbezet=(r.type_vergrendeling=="vrijbezet"&&r.type_vergrendelingVisible)??!1,r.tienmmglasVisible=["vaste-wand","scharnierdeur"].includes(r.type)&&!r.kleur_materiaal.includes("FINEER")&&!r.hogeonderdorpel,r.tienmmglas=r.tienmmglasVisible&&r.tienmmglas,r.verbergtussenstaandersVisible=r.tienmmglas&&(["vaste-wand"].includes(r.type)||["scharnierdeur"].includes(r.type)&&(r.zijpaneel_aantal_links>=2||r.zijpaneel_aantal_rechts>=2)),r.verbergtussenstaanders=r.verbergtussenstaandersVisible&&r.verbergtussenstaanders,r.valdorpelVisible=["scharnierdeur"].includes(r.type)&&!r.hogeonderdorpel&&r.breedte>=Ve.scharnierDeurValdorpelBreedteMinCm&&r.breedte<=Ve.scharnierDeurValdorpelBreedteMaxCm,["scharnierdeur"].includes(r.type)&&r.valdorpel&&r.breedte>Ve.scharnierDeurValdorpelBreedteMaxCm&&(r.valdorpel=!1),["scharnierdeur"].includes(r.type)&&r.valdorpel&&r.breedte<Ve.scharnierDeurValdorpelBreedteMinCm&&(r.valdorpel=!1),r.valdorpel=r.hogeonderdorpel?!1:r.valdorpel&&r.valdorpelVisible,r.hogeonderdorpelVisible=(["vaste-wand","scharnierdeur"].includes(r.type)&&!r.tienmmglas||["opdekdeur"].includes(r.type))&&!r.valdorpel,r.hogeonderdorpel=r.valdorpel?!1:r.hogeonderdorpel&&r.hogeonderdorpelVisible,r.ondergeleidingVisible=["schuifdeur"].includes(r.type),r.ondergeleiding=r.ondergeleidingVisible&&r.ondergeleiding,r.verberg_rail_in_wandVisible=r.type=="schuifdeur",r.verberg_rail_in_wand=r.verberg_rail_in_wandVisible&&r.verberg_rail_in_wand,r.softcloseVisible=["schuifdeur"].includes(r.type),r.softclose=r.softcloseVisible&&r.softclose&&!r.softclose_dubbel,r.softclose_dubbelVisible=["schuifdeur"].includes(r.type)&&r.breedte>=80,r.softclose_dubbel=r.softclose_dubbelVisible&&r.softclose_dubbel&&!r.softclose,r.fineer=r.kleur_materiaal.startsWith("FINEER_"),r.userMessages=g,{...r}}function cT(n,e,t,r){let o=!1,i=t.roede_design_roedes_doorlopen_zijlicht_bovenlicht??!0,a=r&&typeof r=="object"&&r.hasOwnProperty(t.roede_configuratie)?r[t.roede_configuratie]:[],s=[];return e=="Links"&&(s=a.Links),e=="Rechts"&&(parseInt(t.deur_aantal)>1?s=a.Links:s=a.Rechts),e=="Boven"&&(s=a.Boven??void 0),s&&s[n]!==void 0&&i&&(o=!0),o}function Mf(n,e){return e?!!cA.find(r=>r.value===n&&r.visible.includes(e)):!1}function uA(n,e){if(!e)return!1;const t=cA.find(o=>o.value===n&&o.visible.includes(e)),r=tT.find(o=>o.value===n&&o.visible.includes(e));return!!t||!!r}function lj(n,e){return e?!!sA.find(r=>r.value===n&&r.visible.includes(e)):!1}function cj(n,e){return e?!!lA.find(r=>r.value===n&&r.visible.includes(e)):!1}function uj(n){const e=sA.find(r=>r.value===n),t=lA.find(r=>r.value===n);return!!e||!!t}function dj(n,e){return e?!!eT.find(r=>r.value===n&&r.visible.includes(e)):!1}let dA="/apii";Gt.defaults.withCredentials=!0,Gt.defaults.headers.common["X-Requested-With"]="XMLHttpRequest",Gt.defaults.headers.common.Accept="application/json",Gt.defaults.xsrfCookieName="XSRF-TOKEN",Gt.defaults.xsrfHeaderName="X-XSRF-TOKEN";function fj(){const n=document.cookie.match(/XSRF-TOKEN=([^;]+)/);return n?decodeURIComponent(n[1]):null}function hj(){return document.cookie.split(";").some(n=>n.trim().startsWith("XSRF-TOKEN="))}async function pj(){if(!hj())try{await Gt.get(`${dA}/sanctum/csrf-cookie`,{withCredentials:!0})}catch(n){console.error("Failed to fetch CSRF cookie:",n)}}Gt.interceptors.request.use(n=>{const e=fj();return e&&(n.headers["X-XSRF-TOKEN"]=e),n});const hr={setApiUrl:function(n){dA=n},getApiUrl:function(){return dA},doGet:function(n,e,t=null,r=null){var o=this;Gt.get(n,r).then(i=>{o.handleMessages(i)==!0?typeof e<"u"&&e!=null&&e(i):typeof t<"u"&&t!=null&&t(i)}).catch(function(i){console.log(i),o.handleException(i,o),typeof t<"u"&&t!=null&&t(i)})},doDelete:function(n,e,t=null,r=null){var o=this;Gt.delete(n,r).then(i=>{o.handleMessages(i)==!0?typeof e<"u"&&e!=null&&e(i):typeof t<"u"&&t!=null&&t(i)}).catch(function(i){console.log(i),o.handleException(i,o),typeof t<"u"&&t!=null&&t(i)})},doPost:function(n,e,t,r=null,o=null){var i=this;Gt.post(n,e,o).then(a=>{i.handleMessages(a)==!0?typeof t<"u"&&t!=null&&t(a):typeof r<"u"&&r!=null&&r()}).catch(function(a){console.log(a),i.handleException(a,i),typeof r<"u"&&r!=null&&r()})},doPut:function(n,e,t,r=null,o=null){var i=this;Gt.put(n,e,o).then(a=>{i.handleMessages(a)==!0?typeof t<"u"&&t!=null&&t(a):typeof r<"u"&&r!=null&&r()}).catch(function(a){console.log(a),i.handleException(a,i),typeof r<"u"&&r!=null&&r(a)})},doLog:function(n,e){this.doPost(n,e,null,null,{headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}})},handleMessages:function(n){if(typeof n.data.message<"u")if(typeof n.data.success<"u")if(n.data.success==!0)this.notify("success",n.data.message),Sentry.captureMessage(n.data.message,"success");else return this.notify("error",n.data.message),Sentry.captureMessage(n.data.message,"error"),!1;else this.notify("info",n.data.message),Sentry.captureMessage(n.data.message,"info");return!0},handleException:function(n,e){typeof n.response<"u"&&typeof n.response.data.message<"u"?n.response.status==419?location.reload():this.notify("error",n.response.data.message):typeof n.message<"u"?this.notify("error",n.message):this.notify("error",trans("base.error"))},notify:function(n,e){typeof e<"u"&&e!=null&&console.log(typeof e=="object"?Object.values(e)+" - "+n:e+" - "+n)},formatCurrencyFormat:function(n){return new Intl.NumberFormat("nl-NL",{style:"currency",currency:"EUR"}).format(n)},generateUUID:function(){return typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx-cust".replace(/[xy]/g,function(n){const e=Math.random()*16|0;return(n==="x"?e:e&3|8).toString(16)})},checkDeviceId:function(){try{let n=localStorage.getItem("configuratorUuid");if(!n){const e=this.generateUUID();return localStorage.setItem("configuratorUuid",e),e}return String(n)}catch{return this.generateUUID()}},versionedUrl:function(n){if(!n)return n;const e=n.includes("?")?"&":"?";return`${n}${e}v=mlaxicsg`},ensureCsrfCookie:pj};async function mj({apiUrl:n,templateId:e,configData:t,description:r,state:o}){o.updateToBackendActive=!0,await hr.ensureCsrfCookie();const i=JSON.stringify(t);hr.doPost(n+"/api/update-template/"+e,{templateData:i,description:r||(t==null?void 0:t.name)||"Template"},a=>{o.updateToBackendActive=!1,a.data.success?alert("Template saved successfully."):(console.error("Failed to save template:",a.data.error),alert("Failed to save template. Please try again."))},()=>{o.updateToBackendActive=!1,alert("Failed to save template. Please try again.")})}function gj({apiUrl:n,templateId:e}){return new Promise((t,r)=>{hr.doPost(n+"/api/template/"+e,{},o=>{if(o.data.success&&o.data.templateData)try{const i=JSON.parse(o.data.templateData);t({data:i,description:o.data.description||""})}catch(i){console.error("Failed to parse template data:",i),r(i)}else console.error("Failed to load template:",o.data.error),r(new Error(o.data.error||"Failed to load template"))},o=>{console.error("Failed to load template:",o),r(o)})})}let Im=null;function Rm(){if(Im)return Im;let n=window.location.origin,e=window.location.origin,t=window.location.hostname;window.location.href.includes("aluwdoors.com")?n="https://configurator.aluwdoors.com":window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"?n=window.location.origin:n="https://aluwdoors.aronex.dev",window.location.href.includes("aluwdoors.com")?e="https://configurator-api.aluwdoors.com":window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"?e="http://localhost:8123":e="https://aluwdoors-api.aronex.dev",t=t.replace("www.",""),t=t.replace("configurator.aluwdoors.com","aluwdoors.com"),t=t.replace("aluwdoors.aronex.dev","aluwdoors.gaat.live"),t=t.replace("aluwdoors.devtof3.nl","aluwdoors.gaat.live"),t=t.replace("localhost","aluwdoors.gaat.live");const r=document.getElementById("configurator");return r&&r.dataset.baseUrl&&(n=r.dataset.baseUrl),r&&r.dataset.apiUrl&&(e=r.dataset.apiUrl),Im={baseUrl:n,apiUrl:e,domain:t},Im}function Lm(n,e){const{apiUrl:t}=Rm();n&&typeof n.setApiUrl=="function"&&n.setApiUrl(t),e&&typeof e.setApiUrl=="function"&&e.setApiUrl(t)}const _j={key:0,class:"tf-configurator fixed inset-0 z-99999"},vj={class:"bg-white rounded-2xl shadow-lg p-8 max-w-md w-full relative cursor-default"},Aj={class:"text-center mb-8"},yj={class:"text-2xl font-bold text-gray-800 mb-2"},bj={class:"text-gray-600"},xj={key:0,class:"mb-6 bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-xl"},Ej={for:"modal-email",class:"block text-sm font-medium text-gray-700 mb-1"},Cj=["disabled","placeholder"],Sj={for:"modal-password",class:"block text-sm font-medium text-gray-700 mb-1"},wj=["disabled","placeholder"],Mj={class:"flex items-center"},Tj=["disabled"],Ij={for:"modal-remember",class:"ml-2 block text-sm text-gray-700"},Rj=["disabled"],Lj={key:0,class:"flex items-center justify-center"},Pj={key:1},fA=zi({__name:"LoginModal",props:{show:{type:Boolean,default:!1}},emits:["login-success","close"],setup(n,{emit:e}){const t=n,r=e,o=vt(""),i=vt(""),a=vt(!1),s=vt(!1),l=vt(null);dr(()=>t.show,u=>{u&&(o.value="",i.value="",a.value=!1,l.value=null)});async function c(){s.value=!0,l.value=null;const u=await bn.login(o.value,i.value,a.value);s.value=!1,u.success?r("login-success"):l.value=u.error}return(u,d)=>(he(),gt(Oc,{to:"body"},[Be(Ll,{name:"modal",appear:""},{default:ot(()=>[n.show?(he(),ye("div",_j,[K("div",{class:"w-full h-full p-3 md:p-6 lg:p-10 bg-[#1B2221]/94 flex justify-center items-center cursor-pointer",onClick:d[4]||(d[4]=ja(f=>r("close"),["self"]))},[K("div",vj,[K("button",{type:"button",onClick:d[0]||(d[0]=f=>r("close")),class:"absolute top-4 right-4 text-gray-400 hover:text-gray-600 transition-colors cursor-pointer","aria-label":"Close"},[...d[5]||(d[5]=[K("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[K("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])]),K("div",Aj,[K("h1",yj,Ae(u.$t("auth.loginTitle")),1),K("p",bj,Ae(u.$t("auth.loginSubtitle")),1)]),l.value?(he(),ye("div",xj,Ae(l.value),1)):Pe("",!0),K("form",{onSubmit:ja(c,["prevent"]),class:"space-y-6"},[K("div",null,[K("label",Ej,Ae(u.$t("auth.email")),1),Kn(K("input",{id:"modal-email","onUpdate:modelValue":d[1]||(d[1]=f=>o.value=f),type:"email",required:"",autocomplete:"email",disabled:s.value,class:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all disabled:opacity-50",placeholder:u.$t("auth.emailPlaceholder")},null,8,Cj),[[Rr,o.value]])]),K("div",null,[K("label",Sj,Ae(u.$t("auth.password")),1),Kn(K("input",{id:"modal-password","onUpdate:modelValue":d[2]||(d[2]=f=>i.value=f),type:"password",required:"",autocomplete:"current-password",disabled:s.value,class:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all disabled:opacity-50",placeholder:u.$t("auth.passwordPlaceholder")},null,8,wj),[[Rr,i.value]])]),K("div",Mj,[Kn(K("input",{id:"modal-remember","onUpdate:modelValue":d[3]||(d[3]=f=>a.value=f),type:"checkbox",disabled:s.value,class:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"},null,8,Tj),[[$7,a.value]]),K("label",Ij,Ae(u.$t("auth.rememberMe")),1)]),K("button",{type:"submit",disabled:s.value,class:"w-full py-3 px-4 bg-blue-600 text-white font-semibold rounded-xl hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"},[s.value?(he(),ye("span",Lj,[d[6]||(d[6]=K("svg",{class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[K("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),K("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)),Ye(" "+Ae(u.$t("loading")),1)])):(he(),ye("span",Pj,Ae(u.$t("auth.loginButton")),1))],8,Rj)],32)])])])):Pe("",!0)]),_:1})]))}},[["__scopeId","data-v-fa265bc6"]]),Dj=["value"],Bj=["value"],Nj={key:0,class:"bg-background-light fixed md:static w-full h-max"},Oj={key:0,class:"relative max-w-[1450px] mx-auto px-2.5 w-full"},kj={class:"bg-primary-green rounded-xl pl-2 pr-8 md:pl-4 md:pr-12 py-2 text-secondary-green flex items-center justify-center w-full h-full text-left text-base font-medium"},Fj={class:"flex flex-col md:flex-row max-w-[1450px] mx-auto rounded-xl"},Vj={ref:"configuratorLeftPanel",class:"flex-0 md:flex-1 transition-all sticky top-0 h-fit"},Uj={class:"relative px-2.5 mt-2.5 xl:mt-5 w-full h-50 md:h-100 lg:h-120 text-black"},zj={class:"absolute top-2 md:top-4 right-6 flex space-x-2"},Gj={class:"px-2.5 mt-2.5 xl:mt-5 w-full max-md:hidden"},Hj={class:"w-full md:w-[310px] lg:w-[420px] md:shrink-0 mt-2.5 xl:mt-5 px-2.5 2xl:ml-4",id:"userInputDiv"},Wj={key:3},jj={key:0,class:"mb-4 mt-4 mx-2"},Qj={class:"block text-sm font-medium text-gray-700 mb-1"},$j=["placeholder"],Yj={class:"flex justify-center gap-4"},Xj={class:"w-full md:hidden"},qj={key:1,style:{height:"100%"},class:"overflow-hidden w-full h-screen"},Kj={class:"w-full h-screen"},Zj=0,ga={__name:"Configurator",setup(n){const e=b8(()=>Promise.resolve().then(()=>C3e)),t=vt(null),{top:r}=bF(t,{windowScroll:!0,windowResize:!0}),{height:o}=xF(),i=bt(()=>Math.max(0,o.value-r.value-Zj));Wz();const a=Lo("CUtils"),s=aF(),{locale:l,t:c}=cf(),u=s.params.lang!==""?s.params.lang:"nl";let d=s.params.configHash??"";const f=s.params.versionId??"",h=!!s.params.companyInternalEdit,p=vt(!1),m=s.params.indexKey??"",g=String(s.params.fullScreen??"").length>0,_=String(s.params.edit??"").length>0,A=s.params.templateId??"",y=vt(!1),b=vt(!1),E=vt(!0),x=vt(""),w=vt(0),L=vt(""),C=vt(""),P=vt(""),D=vt(""),Q=vt(""),re=vt(""),G=vt(""),se=vt(!1),ee=vt(!1),ie=vt(null);dr(p,pe=>{JM.internalOverrideLimits=pe},{immediate:!0});const H=bt(()=>{var Te;return((Te=z==null?void 0:z.data)==null?void 0:Te.name)??"Configuratie*"}),T=vt(0),R=Zr({popup:!1,editNameInput:""}),O=Zr({popup:!1,actualName:""}),W=Zr({wijzigenPopup:!1,popup:!1,typeOpdracht:"particulier",woonplaatsMontage:"",klantkeuzeMontage:"laten_inmeten_en_monteren",bedrijfsnaam:"",referentie:"",aanhef:"",voornaam:"",achternaam:"",telefoonnummer:"",emailadres:"",opmerkingen:"",errors:[],updateToBackendActive:!1,updateToBackendSkipMailChecked:!1,companyInternalEdit:!1,updateToBackendDone:!1}),ae=Zr({popup:!1,updateToBackendActive:!1,customerData:{voornaam:"",achternaam:"",email:""},errors:[]}),ne=Zr({updateToBackendActive:!1}),oe=vt(""),F=bt(()=>U.conf&&U.conf.length>0&&T.value<U.conf.length?U.conf[T.value].price??"?":"?"),k=bt(()=>{const pe=[];return U.conf&&U.conf.length>0&&U.conf.forEach((Te,Ce)=>{pe.push({type:"configuration",name:Te.name||`Configuratie ${Ce+1}`,price:Te.price??0})}),pe.push({type:"extra",name:c("footer.measuring"),price:c("footer.request_quote")}),pe.push({type:"extra",name:c("footer.assembly"),price:c("footer.request_quote")}),pe}),q=Zr({updateCount:0,parameters:Ve}),j=Zr(q),U=Zr({active:0,environment:"binnen",labels:!0,conf:[],tabOpen:re.value,actualUserOptionsVersion:w.value,companyInternalOverrideLimits:p.value}),z=Zr({data:null,dataPrev:null,index:null});function v(pe=null){pe?typeof pe=="object"&&pe!==null&&(q.type=pe.type,q.data=pe):typeof z.data=="object"&&z.data!==null&&(q.type=z.data.type,q.data=z.data),q.updateCount+=1,q.parameters.appAPIUrl=D.value,q.parameters.baseUrl=P.value,q.roedeConfiguratieDetails=aA,Va(()=>{var Te=new Event("change"),Ce=document.getElementById("configJSON");Ce.dispatchEvent(Te)})}function M(){if(typeof z.data=="object"&&z.data!==null)if(T.value<U.conf.length){const Te={...U.conf[T.value],...z.data};U.conf.splice(T.value,1,Te)}else console.log("Index bestaat niet");String(d).length>30||_||localStorage.setItem("configuratorActualConfig",JSON.stringify(U))}const S=wF(()=>{a.doPost(D.value+"/api/get-price",{config:JSON.stringify(U),configHash:String(d),deviceUuid:G.value,priceCalculatorVersion:x.value},pe=>{var Te;pe.data.success&&(pe.data.calcPrice.forEach((Ce,Zt)=>{U.conf[Zt].price=Ce.LineAmount,U.conf[Zt].vat=Ce.LineAmount*.21}),(Te=pe==null?void 0:pe.data)!=null&&Te.priceCalculatorVersion&&(x.value=pe.data.priceCalculatorVersion))},pe=>{console.log(pe)},null)},200);function I(pe=!1){pe?z.data.maatvoering_weergeven&&(z.data.maatvoering_weergeven=!1,Lr.emit("configuratorUserInput")):(z.data.maatvoering_weergeven=!z.data.maatvoering_weergeven,Lr.emit("configuratorUserInput"))}function J(){U.conf.push(JSON.parse(JSON.stringify(Xz))),V(U.conf.length-1),z.data.name="Configuratie "+U.conf.length,z.indexKey=""}function $(){U.conf.length!==0&&(O.actualName=U.conf[T.value].name,O.popup=!0)}function B(){if(O.popup=!1,U.conf.length!==0)if(U.conf.splice(T.value,1),U.conf.length>0){const pe=Math.max(0,T.value-1);V(pe)}else te()}function V(pe){typeof pe<"u"&&(T.value=pe,U.active=pe,z.data=JSON.parse(JSON.stringify(U.conf[pe])),delete z.data.price,delete z.data.vat,z.dataPrev=JSON.parse(JSON.stringify(z.data)),je())}function Y(){W.companyInternalEdit=h,h||(W.updateToBackendSkipMailChecked=!1),W.updateToBackendActive=!1,W.updateToBackendDone=!1,y.value&&String(f).length==0&&!b.value?(W.popup=!0,W.wijzigenPopup=!0):(W.popup=!0,W.wijzigenPopup=!1)}function le(){W.updateToBackendActive=!0,U.actualUserOptionsVersion=w.value,U.companyInternalOverrideLimits=p.value;const pe={adsdata:[],attachments:[],code:"offerte-aanvragen",configHash:String(d).length>30?String(d):"",configuration:U,customer:{city:W.woonplaatsMontage,company:W.bedrijfsnaam,countrycode:"NLD",email:W.emailadres,firstname:W.voornaam,lastname:W.achternaam,phone:W.telefoonnummer,reference:W.referentie,region:1,remark:W.opmerkingen,salutation:W.aanhef},domain:Q.value,install_delivery:W.klantkeuzeMontage,skipmail:W.updateToBackendSkipMailChecked,typeRequest:"deur",deviceUuid:G.value,priceCalculatorVersion:x.value};a.doPost(D.value+"/api/create-or-update-configuration",{data:JSON.stringify(pe)},Te=>{W.updateToBackendActive=!1,W.wijzigenPopup=!1,h?(W.popup=!1,W.updateToBackendDone=!1):W.updateToBackendDone=!0,String(d).length>30||(window.dataLayer=window.dataLayer||[],window.dataLayer.push({event:"offerte_aanvraag_configurator",userEmail:W.emailadres})),Te.data.configHash&&(d=Te.data.configHash,y.value=!0)},Te=>{W.updateToBackendActive=!1},null)}function me(){ae.popup=!0,ae.updateToBackendActive=!1}function fe(){ae.updateToBackendActive=!0;const pe={code:"configuratie-opslaan",configHash:String(d).length>30?String(d):"",configuration:U,customer:{city:null,company:null,countrycode:"NLD",email:ae.customerData.email,firstname:ae.customerData.voornaam,lastname:ae.customerData.achternaam,phone:null,reference:null,region:1,remark:null,salutation:null},domain:Q.value,deviceUuid:G.value};console.log(pe),a.doPost(D.value+"/api/save-configuration",{data:JSON.stringify(pe)},Te=>{console.log(Te),ae.updateToBackendActive=!1,ae.popup=!1},Te=>{console.log(Te),ae.updateToBackendActive=!1},null)}function te(){U.conf.length==0&&J()}function de(){var pe;R.editNameInput=((pe=U.conf[T.value])==null?void 0:pe.name)||"Configuratie",R.popup=!0}function we(){z.data.name=R.editNameInput||"Configuratie",R.popup=!1,je()}function Ie(pe=null){if(x.value="latest",w.value=Pr,pe||(pe=localStorage.getItem("configuratorActualConfig")),pe)try{const Te=JSON.parse(pe);typeof Te=="object"&&Te!==null&&typeof Te.conf=="object"&&Te.conf!==null&&(U.active=Te.active??0,U.environment=Te.environment,U.labels=Te.labels,U.conf=Te.conf,T.value=U.active,V(T.value),re.value=Te.tabOpen,re.value==""&&(re.value="1"))}catch(Te){console.log("loadFromStorage error: "+Te)}}async function Ne(){x.value="??";let pe="";String(f).length>10?pe=D.value+"/api/get-configuration/"+Q.value+"/"+d+"/"+f:pe=D.value+"/api/get-configuration/"+Q.value+"/"+d,await a.doPost(pe,{deviceUuid:G.value},Te=>{if(Te.data.success)try{const Ce=JSON.parse(Te.data.configData);b.value=Te.data.isOnlyConfigStore??!1,L.value=Te.data.number??"",E.value=Te.data.editConfiguration??!1,x.value=Te.data.priceCalculatorVersion??"V0",w.value=Ce.actualUserOptionsVersion??0,p.value=Ce.companyInternalOverrideLimits??!1,typeof Ce=="object"&&Ce!==null&&typeof Ce.conf=="object"&&Ce.conf!==null&&(U.active=0,U.environment=Ce.environment,U.labels=Ce.labels,U.conf=Ce.conf,String(m).length>0?U.conf.forEach((Zt,rt)=>{Zt.indexKey==String(m)&&V(rt)}):V(U.active),re.value==""&&(re.value="1"),W.aanhef=Te.data.customerData.Salutation??"",W.voornaam=Te.data.customerData.FirstName??"",W.achternaam=Te.data.customerData.LastName??"",W.telefoonnummer=Te.data.customerData.Phone??"",W.emailadres=Te.data.customerData.Email??"",W.bedrijfsnaam=Te.data.customerData.CompanyName??"",W.referentie=Te.data.customerData.CustReference??"",W.opmerkingen=Te.data.customerData.Notes??"",W.woonplaatsMontage=Te.data.customerData.City??"",W.typeOpdracht=Te.data.customerData.CompanyName??""?"zakelijk":"particulier",W.klantkeuzeMontage="laten_inmeten_en_monteren",Te.data.Measuring=="Customer"&&Te.data.deliveryChoice=="PickUpByCustomer"&&Te.data.installationChoice=="InstallationByCustomer"&&(W.klantkeuzeMontage="zelf_inmeten_en_afhalen"),Te.data.Measuring=="Customer"&&Te.data.deliveryChoice=="DeliveryByUs"&&Te.data.installationChoice=="InstallationByCustomer"&&(W.klantkeuzeMontage="zelf_inmeten_en_afleveren"),Te.data.Measuring=="AluxDoors"&&Te.data.deliveryChoice=="DeliveryByUs"&&Te.data.installationChoice=="InstallationByCustomer"&&(W.klantkeuzeMontage="laten_inmeten_en_afleveren"),v())}catch(Ce){console.log("loadFromAPI error: "+Ce)}},Te=>{console.log(Te)},null)}function He(){var Te;console.log("loadFromJobParams");const pe=(Te=ie.value)==null?void 0:Te.value;v(pe)}const je=async()=>{await Va(),z.data=sj(z.data,z.dataPrev,c),z.dataPrev=JSON.parse(JSON.stringify(z.data)),M(),v(),g||S()},ct=async()=>{await Va(),await je(),g||S()};function Vt(){mj({apiUrl:D.value,templateId:A,configData:JSON.stringify(U),description:oe.value,state:ne})}async function En(){x.value="latest",w.value=Pr;const pe=await gj({apiUrl:D.value,templateId:A});if(oe.value=pe.description||"",!pe.data||Object.keys(pe.data).length===0)throw new Error("Template data is invalid: data is missing or empty");Ie(pe.data),v()}$o(async()=>{G.value=a.checkDeviceId();const pe=Rm();if(P.value=pe.baseUrl,D.value=pe.apiUrl,Q.value=pe.domain,Lm(a,bn),_&&(bn.state.isLoading&&await bn.init(),!bn.state.isAuthenticated)){ee.value=!0;return}if(C.value=P.value+"/fonts/Satoshi-Bold.woff",["nl","en"].includes(u)?l.value=u:l.value="nl",String(A).length>0){y.value=!1;try{await En(),je()}catch{te(),je()}}else String(d).length>30?(y.value=!0,Ne()):(y.value=!1,Ie(),te(),je());Lr.on("configuratorUserInput",je),Lr.on("configuratorLoaded",ct),window.addEventListener("jobJsonConfigDataLoaded",He)});async function Rt(){if(ee.value=!1,String(A).length>0)try{await En(),je()}catch(pe){console.error("Failed to load template:",pe)}}return Fc(()=>{Lr.off("configuratorUserInput",je),Lr.off("configuratorLoaded",ct),window.removeEventListener("jobJsonConfigDataLoaded",He)}),(pe,Te)=>{var Zt;const Ce=Yt("FooterPrice");return he(),ye(Nt,null,[Be(fA,{show:ee.value,onLoginSuccess:Rt,onClose:Te[0]||(Te[0]=rt=>ee.value=!1)},null,8,["show"]),ee.value?Pe("",!0):(he(),ye(Nt,{key:0},[K("input",{type:"hidden",id:"configJSON",name:"configJSON",class:"configJSON",value:JSON.stringify(j)},null,8,Dj),Te[28]||(Te[28]=K("input",{type:"hidden",id:"triggerRenderImage",name:"triggerRenderImage",class:"triggerRenderImage"},null,-1)),K("input",{type:"hidden",id:"jobJsonConfigData",name:"jobJsonConfigData",ref_key:"jobJsonConfigData",ref:ie,class:"jobJsonConfigData"},null,512),K("input",{type:"hidden",id:"actualUserOptionsVersion",name:"actualUserOptionsVersion",class:"actualUserOptionsVersion",value:w.value},null,8,Bj),Ct(g)?Pe("",!0):(he(),ye("div",Nj,[Be(wW,{popupData:W,baseUrl:P.value,onSubmit:le},null,8,["popupData","baseUrl"]),Be(WW,{popupData:ae,baseUrl:P.value,onSubmit:fe},null,8,["popupData","baseUrl"]),Be(ZW,{popupData:R,baseUrl:P.value,onSubmit:we},null,8,["popupData","baseUrl"]),Be(aj,{popupData:O,baseUrl:P.value,onSubmit:B},null,8,["popupData","baseUrl"]),L.value?(he(),ye("div",Oj,[K("div",kj,[Ye(Ae(pe.$t("quotation_loaded",{index:L.value}))+" ",1),E.value?(he(),ye(Nt,{key:0},[Ye(Ae(pe.$t("quotation_notification_editable")),1)],64)):(he(),ye(Nt,{key:1},[Ye(Ae(pe.$t("quotation_notification_not_editable")),1)],64))]),K("div",{class:"absolute bottom-3 right-5 bg-primary-green text-secondary-green rounded-full w-8 h-8 flex items-center justify-center cursor-pointer shadow-md shadow-secondary-green",onClick:Te[1]||(Te[1]=rt=>L.value=null)},[...Te[23]||(Te[23]=[K("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[K("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])])):Pe("",!0),K("div",Fj,[K("div",Vj,[Be(VH,{configuratorActualConfig:U,activeConfigName:H.value,companyInternalEdit:Ct(h),companyInternalOverrideLimits:p.value,"onUpdate:companyInternalOverrideLimits":Te[2]||(Te[2]=rt=>p.value=rt),onEditName:de,onAddConfig:J,onDeleteConfig:Te[3]||(Te[3]=rt=>$()),onActivateConfiguration:V,onShowLogin:Te[4]||(Te[4]=rt=>ee.value=!0)},null,8,["configuratorActualConfig","activeConfigName","companyInternalEdit","companyInternalOverrideLimits"]),K("div",Uj,[Be(Ct(e),{baseUrl:P.value,apiUrl:D.value,deviceUuid:G.value,fullScreen:Ct(g),fullScreenTemplate:!1,fontUrl:C.value},null,8,["baseUrl","apiUrl","deviceUuid","fullScreen","fontUrl"]),K("div",zj,[se.value?(he(),ye("button",{key:0,class:"w-8.5 h-8.5 md:w-10 md:h-10 bg-background-light text-secondary-green rounded-full shadow flex items-center justify-center hover:bg-secondary-green hover:text-white transition-colors duration-200 focus:outline-hidden",onClick:Te[5]||(Te[5]=rt=>me())},[...Te[24]||(Te[24]=[K("svg",{width:"16",height:"17",viewBox:"0 0 16 17",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},[K("path",{d:"M1.25 16.125H0.125V15V1.5V0.375H1.25H11.9375L15.875 4.3125V15V16.125H14.75H1.25ZM14.75 15V4.80469L11.4453 1.5H11.375V5.4375V6H10.8125H2.9375H2.375V5.4375V1.5H1.25V15H14.75ZM3.5 1.5V4.875H10.25V1.5H3.5ZM6.3125 10.5C6.3125 11.1328 6.62891 11.6602 7.15625 11.9766C7.64844 12.293 8.31641 12.293 8.84375 11.9766C9.33594 11.6602 9.6875 11.1328 9.6875 10.5C9.6875 9.90234 9.33594 9.375 8.84375 9.05859C8.31641 8.74219 7.64844 8.74219 7.15625 9.05859C6.62891 9.375 6.3125 9.90234 6.3125 10.5ZM8 13.3125C6.98047 13.3125 6.06641 12.7852 5.53906 11.9062C5.04688 11.0625 5.04688 9.97266 5.53906 9.09375C6.06641 8.25 6.98047 7.6875 8 7.6875C8.98438 7.6875 9.89844 8.25 10.4258 9.09375C10.918 9.97266 10.918 11.0625 10.4258 11.9062C9.89844 12.7852 8.98438 13.3125 8 13.3125Z"})],-1)])])):Pe("",!0),K("button",{id:"btnDimensions",class:Qt(["w-8.5 h-8.5 md:w-10 md:h-10 rounded-full shadow flex items-center justify-center hover:text-background-light hover:bg-tertiary-green transition-colors duration-200 focus:outline-hidden",(Zt=z==null?void 0:z.data)!=null&&Zt.maatvoering_weergeven?"bg-secondary-green text-background-light":"bg-background-light text-secondary-green"]),onClick:Te[6]||(Te[6]=rt=>I())},[...Te[25]||(Te[25]=[K("svg",{width:"18",height:"19",viewBox:"0 0 18 19",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},[K("path",{d:"M1.125 1.375V17.125H16.875V17.0547L15.0469 15.2266L14.4492 15.8594L14.0625 16.2461L13.2539 15.4375L13.6406 15.0508L14.2734 14.4531L12.2344 12.4141L11.6367 13.0469L11.25 13.4336L10.4414 12.625L10.8281 12.2383L11.4609 11.6406L9.42188 9.60156L8.82422 10.2344L8.4375 10.6211L7.62891 9.8125L8.01562 9.42578L8.64844 8.82812L6.60938 6.78906L6.01172 7.42188L5.625 7.80859L4.81641 7L5.20312 6.61328L5.83594 6.01562L3.79688 3.97656L3.19922 4.60938L2.8125 4.99609L2.00391 4.1875L2.39062 3.80078L3.02344 3.20312L1.19531 1.375H1.125ZM1.6875 0.25L18 16.5625V17.125V18.25H16.875H1.125H0V17.125V1.375V0.25H1.125H1.6875ZM3.9375 7.91406L4.88672 8.86328L9.38672 13.3633L10.3359 14.3125H9H4.5H3.9375V13.75V9.25V7.91406ZM5.0625 10.6211V13.2227H7.62891L5.0625 10.6211Z"})],-1)])],2),K("button",{id:"btnCamera",class:"w-8.5 h-8.5 md:w-10 md:h-10 bg-background-light text-secondary-green rounded-full shadow flex items-center justify-center hover:bg-secondary-green hover:text-white transition-colors duration-200 focus:outline-hidden",onClick:Te[7]||(Te[7]=rt=>I(!0))},[...Te[26]||(Te[26]=[K("svg",{width:"19",height:"17",viewBox:"0 0 19 17",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},[K("path",{d:"M6.125 0.375H12.875L13.6133 2.625H17.375H18.5V3.75V15V16.125H17.375H1.625H0.5V15V3.75V2.625H1.625H5.35156L6.125 0.375ZM13.6133 3.75H12.8047L12.5586 3.01172L12.0312 1.5H6.93359L6.44141 3.01172L6.16016 3.75H5.35156H1.625V15H17.375V3.75H13.6133ZM6.125 9.9375H8.375H8.9375V11.0625H8.375H7.46094L7.95312 11.5898C8.375 11.9766 8.90234 12.1875 9.5 12.1875C10.4492 12.1875 11.3281 11.6953 11.8203 10.957L12.7695 11.5547C12.0664 12.6445 10.8711 13.3125 9.5 13.3125C8.62109 13.3125 7.77734 12.9961 7.17969 12.3633L6.6875 11.8711V12.75V13.3125H5.5625V12.75V10.5V9.9375H6.125ZM13.4375 8.8125H12.875H10.625H10.0625V7.6875H10.625H11.5039L11.0117 7.19531C10.5898 6.80859 10.0625 6.5625 9.5 6.5625C8.51562 6.5625 7.63672 7.08984 7.14453 7.82812L6.19531 7.23047C6.89844 6.14062 8.12891 5.4375 9.5 5.4375C10.3438 5.4375 11.1875 5.78906 11.7852 6.42188L12.3125 6.91406V6V5.4375H13.4375V6V8.25V8.8125Z"})],-1)])])])]),K("div",Gj,[Be(Ce,{buttonQuoteVisible:E.value,buttonSaveVisible:se.value,buttonQuoteRequestOrUpdate:y.value&&String(Ct(f)).length==0&&!b.value,existingConfig:y.value&&String(Ct(f)).length==0&&!b.value,baseUrl:P.value,priceItems:k.value,onClickQuoteButton:Te[8]||(Te[8]=rt=>Y()),onClickSaveButton:Te[9]||(Te[9]=rt=>me())},AE({_:2},[F.value?{name:"price",fn:ot(()=>[Ye(Ae(Ct(a).formatCurrencyFormat(F.value)),1)]),key:"0"}:void 0,F.value?{name:"priceInclVat",fn:ot(()=>[Ye(Ae(Ct(a).formatCurrencyFormat(F.value*1.21)),1)]),key:"1"}:void 0]),1032,["buttonQuoteVisible","buttonSaveVisible","buttonQuoteRequestOrUpdate","existingConfig","baseUrl","priceItems"])])],512),K("div",Hj,[K("div",{ref_key:"startDiv",ref:t,class:"overflow-y-scroll md:overflow-hidden h-[var(--content-h)] md:h-auto",style:Rd({"--content-h":i.value+"px"})},[z.data?(he(),gt(iA,{key:0,label:pe.$t("step1.choose_product"),modelValue:re.value,"onUpdate:modelValue":Te[12]||(Te[12]=rt=>re.value=rt),tabNumber:"1"},{default:ot(()=>[Be(gG,{modelValue:z.data,"onUpdate:modelValue":Te[10]||(Te[10]=rt=>z.data=rt),baseUrl:P.value,onSetTabValue:Te[11]||(Te[11]=rt=>re.value=rt)},null,8,["modelValue","baseUrl"])]),_:1},8,["label","modelValue"])):Pe("",!0),z.data?(he(),gt(iA,{key:1,label:pe.$t("step2.choose_layout"),modelValue:re.value,"onUpdate:modelValue":Te[15]||(Te[15]=rt=>re.value=rt),tabNumber:"2"},{default:ot(()=>[Be(UG,{modelValue:z.data,"onUpdate:modelValue":Te[13]||(Te[13]=rt=>z.data=rt),baseUrl:P.value,onSetTabValue:Te[14]||(Te[14]=rt=>re.value=rt)},null,8,["modelValue","baseUrl"])]),_:1},8,["label","modelValue"])):Pe("",!0),z.data?(he(),gt(iA,{key:2,label:pe.$t("step3.choose_detailing"),modelValue:re.value,"onUpdate:modelValue":Te[19]||(Te[19]=rt=>re.value=rt),tabNumber:"3"},{default:ot(()=>[Be(_H,{modelValue:z.data,"onUpdate:modelValue":Te[16]||(Te[16]=rt=>z.data=rt),baseUrl:P.value,onSetTabValue:Te[17]||(Te[17]=rt=>re.value=rt),buttonQuoteVisible:E.value,companyInternalEdit:Ct(h),buttonQuoteRequestOrUpdate:y.value&&String(Ct(f)).length==0&&!b.value,actualUserOptionsVersion:w.value,onClickQuoteButton:Te[18]||(Te[18]=rt=>Y())},null,8,["modelValue","baseUrl","buttonQuoteVisible","companyInternalEdit","buttonQuoteRequestOrUpdate","actualUserOptionsVersion"])]),_:1},8,["label","modelValue"])):Pe("",!0),Ct(_)?(he(),ye("div",Wj,[Te[27]||(Te[27]=K("div",{class:"border-t border-horizontal-line -mx-10"},null,-1)),Ct(A)?(he(),ye("div",jj,[K("label",Qj,Ae(pe.$t("templateName")),1),Kn(K("input",{"onUpdate:modelValue":Te[20]||(Te[20]=rt=>oe.value=rt),type:"text",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-secondary-green focus:border-transparent",placeholder:pe.$t("templateNamePlaceholder")},null,8,$j),[[Rr,oe.value]])])):Pe("",!0),K("div",Yj,[Ct(_)&&Ct(A)?(he(),gt(Tm,{key:0,label:pe.$t("saveTemplate"),loading:ne.updateToBackendActive,onClick:Vt,disabled:ne.updateToBackendActive},null,8,["label","loading","disabled"])):Pe("",!0)])])):Pe("",!0),K("div",Xj,[Be(Ce,{buttonQuoteVisible:E.value,buttonSaveVisible:se.value,buttonQuoteRequestOrUpdate:y.value&&String(Ct(f)).length==0&&!b.value,existingConfig:y.value&&String(Ct(f)).length==0&&!b.value,baseUrl:P.value,priceItems:k.value,onClickQuoteButton:Te[21]||(Te[21]=rt=>Y()),onClickSaveButton:Te[22]||(Te[22]=rt=>me())},AE({_:2},[F.value?{name:"price",fn:ot(()=>[Ye(Ae(Ct(a).formatCurrencyFormat(F.value)),1)]),key:"0"}:void 0,F.value?{name:"priceInclVat",fn:ot(()=>[Ye(Ae(Ct(a).formatCurrencyFormat(F.value*1.21)),1)]),key:"1"}:void 0]),1032,["buttonQuoteVisible","buttonSaveVisible","buttonQuoteRequestOrUpdate","existingConfig","baseUrl","priceItems"])])],4)])])])),Ct(g)?(he(),ye("div",qj,[K("div",Kj,[Be(Ct(e),{baseUrl:P.value,apiUrl:D.value,deviceUuid:G.value,fullScreen:Ct(g),fullScreenTemplate:String(Ct(A)).length>0,fontUrl:C.value},null,8,["baseUrl","apiUrl","deviceUuid","fullScreen","fullScreenTemplate","fontUrl"])])])):Pe("",!0)],64))],64)}}},Jj={class:"tf-configurator min-h-screen bg-background-light"},eQ={key:0,class:"max-w-[1200px] mx-auto px-4 py-8"},tQ={class:"mb-8 flex justify-between items-start"},nQ={class:"text-3xl font-bold text-secondary-green mb-2"},rQ={class:"text-gray-600"},oQ={key:0,class:"text-sm text-gray-500 mt-1"},iQ={class:"flex gap-2"},aQ=["disabled"],sQ={key:0,xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},lQ={key:1,class:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"},cQ={key:0,class:"flex justify-center items-center py-20"},uQ={key:1,class:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-xl"},dQ={key:2,class:"text-center py-20 text-gray-500"},fQ={key:3,class:"grid gap-4"},hQ={class:"shrink-0 w-full md:w-48 h-32 bg-gray-100 rounded-lg overflow-hidden"},pQ=["src","alt"],mQ={key:1,class:"w-full h-full flex items-center justify-center text-gray-400"},gQ={class:"flex-1"},_Q={class:"font-semibold text-secondary-green text-lg"},vQ={class:"text-sm text-gray-500 mt-1"},AQ={class:"bg-gray-100 px-2 py-0.5 rounded text-xs"},yQ={class:"text-sm text-gray-400 mt-1"},bQ={class:"text-sm text-gray-400 mt-1"},xQ={class:"flex gap-2 shrink-0"},EQ=["onClick"],CQ=["href"],SQ=["href"],wQ=["onClick"],MQ={key:4,class:"flex justify-center items-center gap-2 mt-6"},TQ=["disabled"],IQ={class:"flex gap-1"},RQ=["onClick"],LQ=["disabled"],PQ={key:0,class:"tf-configurator fixed inset-0 z-99999"},DQ={class:"w-full h-full p-3 md:p-6 lg:p-10 bg-[#1B2221]/94 flex justify-center items-center"},BQ={class:"bg-white rounded-2xl p-6 max-w-md w-full"},NQ={class:"text-xl font-bold text-secondary-green mb-4"},OQ={class:"text-gray-600 mb-6"},kQ={class:"flex gap-3 justify-end"},FQ=["disabled"],VQ={key:0},UQ={key:1},hA=10,zQ=zi({__name:"TemplateIndex",setup(n){const e=vt(!0),t=vt(null),r=vt([]),o=vt(!1),i=vt(1),a=bt(()=>{const E=(i.value-1)*hA,x=E+hA;return r.value.slice(E,x)}),s=bt(()=>Math.ceil(r.value.length/hA)),l=vt(!1),c=vt({show:!1,template:null,loading:!1}),u=vt("");$o(async()=>{const E=Rm();u.value=E.apiUrl,Lm(hr,bn),bn.state.isLoading&&await bn.init(),bn.state.isAuthenticated?h():(o.value=!0,e.value=!1)});function d(){o.value=!1,h()}async function f(){await bn.logout(),r.value=[],o.value=!0}function h(){e.value=!0,t.value=null,hr.doGet(`${u.value}/api/templates`,E=>{E.data.success?(r.value=E.data.templates,i.value=1):t.value=E.data.error||"Failed to load templates",e.value=!1},E=>{var x;((x=E==null?void 0:E.response)==null?void 0:x.status)===401?o.value=!0:t.value=(E==null?void 0:E.message)||"Failed to load templates",e.value=!1})}function p(){l.value=!0,t.value=null;const E=JSON.stringify({});hr.doPost(`${u.value}/api/store-template`,{templateData:E,description:"Template"},x=>{if(l.value=!1,x.data.success&&x.data.templateKey){const w=m(x.data.templateKey);window.open(w,"_blank"),h()}else t.value=x.data.error||"Failed to create template"},x=>{var w;l.value=!1,((w=x==null?void 0:x.response)==null?void 0:w.status)===401?o.value=!0:t.value=(x==null?void 0:x.message)||"Failed to create template"})}function m(E){return`${window.location.origin}/configurator/templates/${E}/edit`}function g(E){return`${window.location.origin}/configurator/${E}`}function _(E){return E?new Date(E).toLocaleDateString("nl-NL",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):"-"}function A(E){c.value={show:!0,template:E,loading:!1}}async function y(E){try{const x=await Gt.get(`${u.value}/api/templates/${E.TemplateKey}/preview`,{responseType:"blob",withCredentials:!0}),w=x.headers["content-type"];let L="jpg";if(w){const G=w.match(/image\/(\w+)/);G&&(L=G[1])}const D=`${(E.Description||"Template").replace(/[<>:"/\\|?*]/g,"").replace(/\s+/g,"_")}_${E.TemplateKey}.${L}`,Q=URL.createObjectURL(x.data),re=document.createElement("a");re.href=Q,re.download=D,document.body.appendChild(re),re.click(),document.body.removeChild(re),URL.revokeObjectURL(Q)}catch(x){console.error("Failed to download image:",x),t.value="Failed to download image"}}function b(){c.value.template&&(c.value.loading=!0,hr.doDelete(`${u.value}/api/templates/${c.value.template.TemplateKey}`,E=>{E.data.success?(r.value=r.value.filter(x=>x.id!==c.value.template.id),i.value>1&&a.value.length===0&&(i.value=i.value-1),c.value.show=!1):t.value=E.data.error||"Failed to delete template",c.value.loading=!1},E=>{var x;((x=E==null?void 0:E.response)==null?void 0:x.status)===401?o.value=!0:t.value="Failed to delete template",c.value.loading=!1}))}return(E,x)=>(he(),ye("div",Jj,[Be(fA,{show:o.value,onLoginSuccess:d,onClose:x[0]||(x[0]=w=>o.value=!1)},null,8,["show"]),o.value?Pe("",!0):(he(),ye("div",eQ,[K("div",tQ,[K("div",null,[K("h1",nQ,Ae(E.$t("templates.title")),1),K("p",rQ,Ae(E.$t("templates.description")),1),Ct(bn).state.user?(he(),ye("p",oQ,Ae(E.$t("auth.loggedInAs"))+": "+Ae(Ct(bn).state.user.email),1)):Pe("",!0)]),K("div",iQ,[K("button",{onClick:p,disabled:l.value,class:"inline-flex items-center gap-2 px-4 py-2 bg-secondary-green text-white rounded-lg hover:bg-tertiary-green transition-colors disabled:opacity-50 cursor-pointer"},[l.value?(he(),ye("div",lQ)):(he(),ye("svg",sQ,[...x[4]||(x[4]=[K("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"},null,-1)])])),Ye(" "+Ae(E.$t("templates.create")),1)],8,aQ),K("button",{onClick:f,class:"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors cursor-pointer"},Ae(E.$t("auth.logout")),1)])]),e.value?(he(),ye("div",cQ,[...x[5]||(x[5]=[K("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-secondary-green"},null,-1)])])):t.value?(he(),ye("div",uQ,Ae(t.value),1)):r.value.length===0?(he(),ye("div",dQ,Ae(E.$t("templates.empty")),1)):(he(),ye("div",fQ,[(he(!0),ye(Nt,null,Xn(a.value,w=>(he(),ye("div",{key:w.id,class:"bg-white rounded-xl shadow-sm border border-gray-200 p-6 flex flex-col md:flex-row md:items-start justify-between gap-4"},[K("div",hQ,[w.previewUrl?(he(),ye("img",{key:0,src:w.previewUrl,alt:w.Description||"Template preview",class:"w-full h-full object-cover"},null,8,pQ)):(he(),ye("div",mQ,[...x[6]||(x[6]=[K("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-12 w-12",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[K("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)])]))]),K("div",gQ,[K("h3",_Q,Ae(w.Description||E.$t("templates.noDescription")),1),K("p",vQ,[Ye(Ae(E.$t("templates.templateKey"))+": ",1),K("code",AQ,Ae(w.TemplateKey),1)]),K("p",yQ,Ae(E.$t("templates.createdAt"))+": "+Ae(_(w.created_at)),1),K("p",bQ,Ae(E.$t("templates.updatedAt"))+": "+Ae(_(w.updated_at)),1)]),K("div",xQ,[w.previewUrl?(he(),ye("button",{key:0,onClick:L=>y(w),class:"h-10 inline-flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors cursor-pointer"},[...x[7]||(x[7]=[K("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[K("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})],-1)])],8,EQ)):Pe("",!0),K("a",{href:g(w.TemplateKey),target:"_blank",class:"h-10 inline-flex items-center gap-2 px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors"},[...x[8]||(x[8]=[K("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[K("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),K("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})],-1)])],8,CQ),K("a",{href:m(w.TemplateKey),target:"_blank",class:"h-10 inline-flex items-center gap-2 px-4 py-2 bg-secondary-green text-white rounded-lg hover:bg-tertiary-green transition-colors"},[...x[9]||(x[9]=[K("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[K("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1)])],8,SQ),K("button",{onClick:L=>A(w),class:"h-10 inline-flex items-center gap-2 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors cursor-pointer"},[...x[10]||(x[10]=[K("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[K("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])],8,wQ)])]))),128))])),s.value>1?(he(),ye("div",MQ,[K("button",{onClick:x[1]||(x[1]=w=>i.value=i.value-1),disabled:i.value===1,class:"px-3 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"},[...x[11]||(x[11]=[K("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[K("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)])],8,TQ),K("div",IQ,[(he(!0),ye(Nt,null,Xn(s.value,w=>(he(),ye("button",{key:w,onClick:L=>i.value=w,class:Qt(["px-3 py-2 rounded-lg transition-colors",i.value===w?"bg-secondary-green text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"])},Ae(w),11,RQ))),128))]),K("button",{onClick:x[2]||(x[2]=w=>i.value=i.value+1),disabled:i.value===s.value,class:"px-3 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"},[...x[12]||(x[12]=[K("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[K("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)])],8,LQ)])):Pe("",!0)])),(he(),gt(Oc,{to:"body"},[Be(Ll,{name:"popup",appear:""},{default:ot(()=>{var w;return[c.value.show?(he(),ye("div",PQ,[K("div",DQ,[K("div",BQ,[K("h3",NQ,Ae(E.$t("templates.confirmDeleteTitle")),1),K("p",OQ,[Ye(Ae(E.$t("templates.confirmDeleteMessage"))+" ",1),x[13]||(x[13]=K("br",null,null,-1)),x[14]||(x[14]=K("br",null,null,-1)),K("strong",null,Ae(((w=c.value.template)==null?void 0:w.Description)||E.$t("templates.noDescription")),1)]),K("div",kQ,[K("button",{onClick:x[3]||(x[3]=L=>c.value.show=!1),class:"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors"},Ae(E.$t("templates.cancel")),1),K("button",{onClick:b,disabled:c.value.loading,class:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors disabled:opacity-50"},[c.value.loading?(he(),ye("span",VQ,Ae(E.$t("loading")),1)):(he(),ye("span",UQ,Ae(E.$t("templates.delete")),1))],8,FQ)])])])])):Pe("",!0)]}),_:1})]))]))}},[["__scopeId","data-v-14cdbcf1"]]),GQ={class:"tf-configurator min-h-screen bg-background-light"},HQ={key:0,class:"max-w-[1200px] mx-auto px-4 py-8"},WQ={class:"mb-8 flex justify-between items-start"},jQ={class:"text-3xl font-bold text-secondary-green mb-2"},QQ={class:"text-gray-600"},$Q={key:0,class:"text-sm text-gray-500 mt-1"},YQ={class:"ml-2 px-2 py-0.5 rounded text-xs bg-secondary-green text-white"},XQ={class:"flex gap-2"},qQ={key:0,class:"bg-yellow-100 border border-yellow-400 text-yellow-700 px-4 py-3 rounded-xl"},KQ={key:1,class:"flex justify-center items-center py-20"},ZQ={key:2,class:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-xl"},JQ={key:3,class:"text-center py-20 text-gray-500"},e$={key:4,class:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden"},t$={class:"w-full"},n$={class:"bg-gray-50"},r$={class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},o$={class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},i$={class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},a$={class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},s$={class:"divide-y divide-gray-200"},l$={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},c$={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},u$={class:"px-6 py-4 whitespace-nowrap"},d$={class:"px-6 py-4 whitespace-nowrap text-right text-sm"},f$=["onClick"],h$=["onClick","disabled"],p$={key:0,class:"tf-configurator fixed inset-0 z-99999"},m$={class:"w-full h-full p-3 md:p-6 lg:p-10 bg-[#1B2221]/94 flex justify-center items-center"},g$={class:"bg-white rounded-2xl p-6 max-w-md w-full"},_$={class:"text-xl font-bold text-secondary-green mb-4"},v$={class:"block text-sm font-medium text-gray-700 mb-1"},A$={class:"block text-sm font-medium text-gray-700 mb-1"},y$={class:"block text-sm font-medium text-gray-700 mb-1"},b$={key:0,class:"text-gray-400 font-normal"},x$=["required"],E$={class:"block text-sm font-medium text-gray-700 mb-1"},C$={value:"admin"},S$={value:"superadmin"},w$={key:0,class:"text-red-600 text-sm"},M$={class:"flex gap-3 justify-end pt-4"},T$=["disabled"],I$={key:0},R$={key:1},L$={key:0,class:"tf-configurator fixed inset-0 z-99999"},P$={class:"w-full h-full p-3 md:p-6 lg:p-10 bg-[#1B2221]/94 flex justify-center items-center"},D$={class:"bg-white rounded-2xl p-6 max-w-md w-full"},B$={class:"text-xl font-bold text-secondary-green mb-4"},N$={class:"text-gray-600 mb-6"},O$={class:"flex gap-3 justify-end"},k$=["disabled"],F$={key:0},V$={key:1},U$=[{path:"/:lang([a-z]{2})?/:configurator(configurator)?/templates/admin",name:"Template Index",component:zQ,meta:{requiresAuth:!0}},{path:"/:lang([a-z]{2})?/:configurator(configurator)?/users/admin",name:"User Management",component:zi({__name:"UserManagement",setup(n){const e=vt(!0),t=vt(null),r=vt([]),o=vt(!1),i=vt(""),a=bt(()=>{var _;return((_=bn.state.user)==null?void 0:_.role)==="superadmin"}),s=vt({show:!1,isEdit:!1,loading:!1,error:null,user:null,form:{name:"",email:"",password:"",role:"admin"}}),l=vt({show:!1,user:null,loading:!1});$o(async()=>{const _=Rm();i.value=_.apiUrl,Lm(hr,bn),bn.state.isLoading&&await bn.init(),bn.state.isAuthenticated?d():(o.value=!0,e.value=!1)});function c(){o.value=!1,d()}async function u(){await bn.logout(),r.value=[],o.value=!0}function d(){if(!a.value){e.value=!1;return}e.value=!0,t.value=null,hr.doGet(`${i.value}/api/users`,_=>{_.data.success?r.value=_.data.users:t.value=_.data.error||"Failed to load users",e.value=!1},_=>{var A,y;((A=_==null?void 0:_.response)==null?void 0:A.status)===401?o.value=!0:((y=_==null?void 0:_.response)==null?void 0:y.status)===403?t.value="You are not authorized to view users":t.value=(_==null?void 0:_.message)||"Failed to load users",e.value=!1})}function f(){s.value={show:!0,isEdit:!1,loading:!1,error:null,user:null,form:{name:"",email:"",password:"",role:"admin"}}}function h(_){s.value={show:!0,isEdit:!0,loading:!1,error:null,user:_,form:{name:_.name,email:_.email,password:"",role:_.role}}}function p(){s.value.loading=!0,s.value.error=null;const _={name:s.value.form.name,email:s.value.form.email,role:s.value.form.role};s.value.form.password&&(_.password=s.value.form.password),s.value.isEdit?hr.doPut(`${i.value}/api/users/${s.value.user.id}`,_,A=>{if(A.data.success){const y=r.value.findIndex(b=>b.id===s.value.user.id);y!==-1&&(r.value[y]=A.data.user),s.value.show=!1}else s.value.error=A.data.error||"Failed to update user";s.value.loading=!1},A=>{var y,b;s.value.error=((b=(y=A==null?void 0:A.response)==null?void 0:y.data)==null?void 0:b.message)||"Failed to update user",s.value.loading=!1}):(_.password=s.value.form.password,hr.doPost(`${i.value}/api/users`,_,A=>{A.data.success?(r.value.push(A.data.user),s.value.show=!1):s.value.error=A.data.error||"Failed to create user",s.value.loading=!1},A=>{var y,b;s.value.error=((b=(y=A==null?void 0:A.response)==null?void 0:y.data)==null?void 0:b.message)||"Failed to create user",s.value.loading=!1}))}function m(_){l.value={show:!0,user:_,loading:!1}}function g(){l.value.user&&(l.value.loading=!0,hr.doDelete(`${i.value}/api/users/${l.value.user.id}`,_=>{_.data.success?(r.value=r.value.filter(A=>A.id!==l.value.user.id),l.value.show=!1):t.value=_.data.error||"Failed to delete user",l.value.loading=!1},_=>{var A,y,b;((A=_==null?void 0:_.response)==null?void 0:A.status)===401?o.value=!0:t.value=((b=(y=_==null?void 0:_.response)==null?void 0:y.data)==null?void 0:b.error)||"Failed to delete user",l.value.loading=!1}))}return(_,A)=>(he(),ye("div",GQ,[Be(fA,{show:o.value,onLoginSuccess:c,onClose:A[0]||(A[0]=y=>o.value=!1)},null,8,["show"]),o.value?Pe("",!0):(he(),ye("div",HQ,[K("div",WQ,[K("div",null,[K("h1",jQ,Ae(_.$t("users.title")),1),K("p",QQ,Ae(_.$t("users.description")),1),Ct(bn).state.user?(he(),ye("p",$Q,[Ye(Ae(_.$t("auth.loggedInAs"))+": "+Ae(Ct(bn).state.user.email)+" ",1),K("span",YQ,Ae(Ct(bn).state.user.role),1)])):Pe("",!0)]),K("div",XQ,[a.value?(he(),ye("button",{key:0,onClick:f,class:"inline-flex items-center gap-2 px-4 py-2 bg-secondary-green text-white rounded-lg hover:bg-tertiary-green transition-colors cursor-pointer"},[A[7]||(A[7]=K("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[K("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1)),Ye(" "+Ae(_.$t("users.create")),1)])):Pe("",!0),K("button",{onClick:u,class:"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors cursor-pointer"},Ae(_.$t("auth.logout")),1)])]),a.value?e.value?(he(),ye("div",KQ,[...A[8]||(A[8]=[K("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-secondary-green"},null,-1)])])):t.value?(he(),ye("div",ZQ,Ae(t.value),1)):r.value.length===0?(he(),ye("div",JQ,Ae(_.$t("users.empty")),1)):(he(),ye("div",e$,[K("table",t$,[K("thead",n$,[K("tr",null,[K("th",r$,Ae(_.$t("users.name")),1),K("th",o$,Ae(_.$t("users.email")),1),K("th",i$,Ae(_.$t("users.role")),1),K("th",a$,Ae(_.$t("users.actions")),1)])]),K("tbody",s$,[(he(!0),ye(Nt,null,Xn(r.value,y=>{var b,E;return he(),ye("tr",{key:y.id},[K("td",l$,Ae(y.name),1),K("td",c$,Ae(y.email),1),K("td",u$,[K("span",{class:Qt(["px-2 py-1 text-xs rounded-full",y.role==="superadmin"?"bg-purple-100 text-purple-800":"bg-blue-100 text-blue-800"])},Ae(y.role==="superadmin"?_.$t("users.superadmin"):_.$t("users.admin")),3)]),K("td",d$,[K("button",{onClick:x=>h(y),class:"text-secondary-green hover:text-tertiary-green mr-3"},Ae(_.$t("users.edit")),9,f$),K("button",{onClick:x=>m(y),disabled:y.id===((b=Ct(bn).state.user)==null?void 0:b.id),class:Qt(["text-red-600 hover:text-red-800",y.id===((E=Ct(bn).state.user)==null?void 0:E.id)?"opacity-50 cursor-not-allowed":""])},Ae(_.$t("users.delete")),11,h$)])])}),128))])])])):(he(),ye("div",qQ,Ae(_.$t("users.notAuthorized")),1))])),(he(),gt(Oc,{to:"body"},[Be(Ll,{name:"popup",appear:""},{default:ot(()=>[s.value.show?(he(),ye("div",p$,[K("div",m$,[K("div",g$,[K("h3",_$,Ae(s.value.isEdit?_.$t("users.editUser"):_.$t("users.createUser")),1),K("form",{onSubmit:ja(p,["prevent"]),class:"space-y-4"},[K("div",null,[K("label",v$,Ae(_.$t("users.name")),1),Kn(K("input",{"onUpdate:modelValue":A[1]||(A[1]=y=>s.value.form.name=y),type:"text",required:"",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-secondary-green focus:border-transparent"},null,512),[[Rr,s.value.form.name]])]),K("div",null,[K("label",A$,Ae(_.$t("users.email")),1),Kn(K("input",{"onUpdate:modelValue":A[2]||(A[2]=y=>s.value.form.email=y),type:"email",required:"",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-secondary-green focus:border-transparent"},null,512),[[Rr,s.value.form.email]])]),K("div",null,[K("label",y$,[Ye(Ae(_.$t("users.password"))+" ",1),s.value.isEdit?(he(),ye("span",b$,"("+Ae(_.$t("users.leaveBlank"))+")",1)):Pe("",!0)]),Kn(K("input",{"onUpdate:modelValue":A[3]||(A[3]=y=>s.value.form.password=y),type:"password",required:!s.value.isEdit,minlength:"8",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-secondary-green focus:border-transparent"},null,8,x$),[[Rr,s.value.form.password]])]),K("div",null,[K("label",E$,Ae(_.$t("users.role")),1),Kn(K("select",{"onUpdate:modelValue":A[4]||(A[4]=y=>s.value.form.role=y),required:"",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-secondary-green focus:border-transparent"},[K("option",C$,Ae(_.$t("users.admin")),1),K("option",S$,Ae(_.$t("users.superadmin")),1)],512),[[Y7,s.value.form.role]])]),s.value.error?(he(),ye("div",w$,Ae(s.value.error),1)):Pe("",!0),K("div",M$,[K("button",{type:"button",onClick:A[5]||(A[5]=y=>s.value.show=!1),class:"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors"},Ae(_.$t("users.cancel")),1),K("button",{type:"submit",disabled:s.value.loading,class:"px-4 py-2 bg-secondary-green text-white rounded-lg hover:bg-tertiary-green transition-colors disabled:opacity-50"},[s.value.loading?(he(),ye("span",I$,Ae(_.$t("loading")),1)):(he(),ye("span",R$,Ae(s.value.isEdit?_.$t("users.save"):_.$t("users.create")),1))],8,T$)])],32)])])])):Pe("",!0)]),_:1})])),(he(),gt(Oc,{to:"body"},[Be(Ll,{name:"popup",appear:""},{default:ot(()=>{var y,b;return[l.value.show?(he(),ye("div",L$,[K("div",P$,[K("div",D$,[K("h3",B$,Ae(_.$t("users.confirmDeleteTitle")),1),K("p",N$,[Ye(Ae(_.$t("users.confirmDeleteMessage"))+" ",1),A[9]||(A[9]=K("br",null,null,-1)),A[10]||(A[10]=K("br",null,null,-1)),K("strong",null,Ae((y=l.value.user)==null?void 0:y.name),1),Ye(" ("+Ae((b=l.value.user)==null?void 0:b.email)+") ",1)]),K("div",O$,[K("button",{onClick:A[6]||(A[6]=E=>l.value.show=!1),class:"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors"},Ae(_.$t("users.cancel")),1),K("button",{onClick:g,disabled:l.value.loading,class:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors disabled:opacity-50"},[l.value.loading?(he(),ye("span",F$,Ae(_.$t("loading")),1)):(he(),ye("span",V$,Ae(_.$t("users.delete")),1))],8,k$)])])])])):Pe("",!0)]}),_:1})]))]))}},[["__scopeId","data-v-ffabc70a"]]),meta:{requiresAuth:!0}},{path:"/:lang(en)?/:configHash(\\w{30,80})?/v/:versionId(\\w{16})?/i/:indexKey(\\w{20})?/:fullScreen(\\w{10})?",name:"Configurator generate image configHash / versionId / indexKey",component:ga},{path:"/:lang(en)?/:configHash(\\w{30,80})?/:fullScreen(\\w{10})?",name:"Configurator",component:ga},{path:"/:lang(en)?/configurator/:configHash(\\w{30,80})?/:companyInternalEdit(\\w{20})?/:fullScreen(\\w{10})?",name:"Configurator configurator/hash80/companyInternalEdit20",component:ga},{path:"/:lang(en)?/configurator/:configHash(\\w{30,80})?/:companyInternalEdit(\\w{20})?/v/:versionId(\\w{16})?",name:"Configurator configurator/configHash(80)/companyInternalEdit(20)/v/versionId(16)",component:ga},{path:"/:lang(en)?/:configHash(\\w{30,80})?/:companyInternalEdit(\\w{20})?",name:"Configurator configHash(80)/companyInternalEdit(20)/",component:ga},{path:"/:lang(en)?/:configHash(\\w{30,80})?/:companyInternalEdit(\\w{20})?/v/:versionId(\\w{16})?",name:"Configurator configHash(80)/companyInternalEdit(20)/v/versionId(16)",component:ga},{path:"/:lang(en)?/:configHash(\\w{30,80})?/v/:versionId(\\w{16})?/:fullScreen(\\w{10})?",name:"Configurator with version",component:ga},{path:"/:lang([a-z]{2})?/:configurator(configurator)?/:templates(templates)/:templateId([\\w-]{36})?/:edit(edit)/:fullScreen(\\w{10})?",name:"Configurator templates (editable)",component:ga,meta:{requiresAuth:!0}},{path:"/:lang([a-z]{2})?/:configurator(configurator)?/:templateId([\\w-]{36})/:fullScreen(\\w{10})?",name:"Configurator templates (website view)",component:ga},{path:"/:lang(en)?/:pathMatch(.*)*",name:"NotFound",component:ga}],uT=iF({history:Vk("/"),routes:U$});let dT=!1,fT=!1;uT.beforeEach(async(n,e,t)=>{dT||(Lm(hr,bn),dT=!0);const r=n.matched.some(i=>i.meta.requiresAuth),o=n.matched.some(i=>i.meta.guest);if(!fT&&r&&(fT=!0,await bn.init()),r||o){const i=bn.state.isAuthenticated;if(o&&i){const a=n.params.lang||"nl";return t(`/${a}/templates/admin`)}}t()});const wt=typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__,hn=globalThis,zl="9.46.0";function eu(){return Pm(hn),hn}function Pm(n){const e=n.__SENTRY__=n.__SENTRY__||{};return e.version=e.version||zl,e[zl]=e[zl]||{}}function Tf(n,e,t=hn){const r=t.__SENTRY__=t.__SENTRY__||{},o=r[zl]=r[zl]||{};return o[n]||(o[n]=e())}const z$=["debug","info","warn","error","log","assert","trace"],G$="Sentry Logger ",Dm={};function Ja(n){if(!("console"in hn))return n();const e=hn.console,t={},r=Object.keys(Dm);r.forEach(o=>{const i=Dm[o];t[o]=e[o],e[o]=i});try{return n()}finally{r.forEach(o=>{e[o]=t[o]})}}function H$(){mA().enabled=!0}function W$(){mA().enabled=!1}function hT(){return mA().enabled}function j$(...n){pA("log",...n)}function Q$(...n){pA("warn",...n)}function $$(...n){pA("error",...n)}function pA(n,...e){wt&&hT()&&Ja(()=>{hn.console[n](`${G$}[${n}]:`,...e)})}function mA(){return wt?Tf("loggerSettings",()=>({enabled:!1})):{enabled:!1}}const lt={enable:H$,disable:W$,isEnabled:hT,log:j$,warn:Q$,error:$$},pT=50,Gl="?",mT=/\(error: (.*)\)/,gT=/captureMessage|captureException/;function _T(...n){const e=n.sort((t,r)=>t[0]-r[0]).map(t=>t[1]);return(t,r=0,o=0)=>{const i=[],a=t.split(`
`);for(let s=r;s<a.length;s++){const l=a[s];if(l.length>1024)continue;const c=mT.test(l)?l.replace(mT,"$1"):l;if(!c.match(/\S*Error: /)){for(const u of e){const d=u(c);if(d){i.push(d);break}}if(i.length>=pT+o)break}}return X$(i.slice(o))}}function Y$(n){return Array.isArray(n)?_T(...n):n}function X$(n){if(!n.length)return[];const e=Array.from(n);return/sentryWrapped/.test(Bm(e).function||"")&&e.pop(),e.reverse(),gT.test(Bm(e).function||"")&&(e.pop(),gT.test(Bm(e).function||"")&&e.pop()),e.slice(0,pT).map(t=>({...t,filename:t.filename||Bm(e).filename,function:t.function||Gl}))}function Bm(n){return n[n.length-1]||{}}const gA="<anonymous>";function es(n){try{return!n||typeof n!="function"?gA:n.name||gA}catch{return gA}}function vT(n){const e=n.exception;if(e){const t=[];try{return e.values.forEach(r=>{r.stacktrace.frames&&t.push(...r.stacktrace.frames)}),t}catch{return}}}const Nm={},AT={};function Hl(n,e){Nm[n]=Nm[n]||[],Nm[n].push(e)}function Wl(n,e){if(!AT[n]){AT[n]=!0;try{e()}catch(t){wt&&lt.error(`Error while instrumenting ${n}`,t)}}}function Gi(n,e){const t=n&&Nm[n];if(t)for(const r of t)try{r(e)}catch(o){wt&&lt.error(`Error while triggering instrumentation handler.
Type: ${n}
Name: ${es(r)}
Error:`,o)}}let _A=null;function q$(n){const e="error";Hl(e,n),Wl(e,K$)}function K$(){_A=hn.onerror,hn.onerror=function(n,e,t,r,o){return Gi("error",{column:r,error:o,line:t,msg:n,url:e}),_A?_A.apply(this,arguments):!1},hn.onerror.__SENTRY_INSTRUMENTED__=!0}let vA=null;function Z$(n){const e="unhandledrejection";Hl(e,n),Wl(e,J$)}function J$(){vA=hn.onunhandledrejection,hn.onunhandledrejection=function(n){return Gi("unhandledrejection",n),vA?vA.apply(this,arguments):!0},hn.onunhandledrejection.__SENTRY_INSTRUMENTED__=!0}const yT=Object.prototype.toString;function AA(n){switch(yT.call(n)){case"[object Error]":case"[object Exception]":case"[object DOMException]":case"[object WebAssembly.Exception]":return!0;default:return $s(n,Error)}}function tu(n,e){return yT.call(n)===`[object ${e}]`}function bT(n){return tu(n,"ErrorEvent")}function xT(n){return tu(n,"DOMError")}function eY(n){return tu(n,"DOMException")}function ts(n){return tu(n,"String")}function yA(n){return typeof n=="object"&&n!==null&&"__sentry_template_string__"in n&&"__sentry_template_values__"in n}function bA(n){return n===null||yA(n)||typeof n!="object"&&typeof n!="function"}function If(n){return tu(n,"Object")}function Om(n){return typeof Event<"u"&&$s(n,Event)}function tY(n){return typeof Element<"u"&&$s(n,Element)}function nY(n){return tu(n,"RegExp")}function km(n){return!!(n!=null&&n.then&&typeof n.then=="function")}function rY(n){return If(n)&&"nativeEvent"in n&&"preventDefault"in n&&"stopPropagation"in n}function $s(n,e){try{return n instanceof e}catch{return!1}}function ET(n){return!!(typeof n=="object"&&n!==null&&(n.__isVue||n._isVue))}function oY(n){return typeof Request<"u"&&$s(n,Request)}const xA=hn,iY=80;function Fm(n,e={}){if(!n)return"<unknown>";try{let t=n;const r=5,o=[];let i=0,a=0;const s=" > ",l=s.length;let c;const u=Array.isArray(e)?e:e.keyAttrs,d=!Array.isArray(e)&&e.maxStringLength||iY;for(;t&&i++<r&&(c=aY(t,u),!(c==="html"||i>1&&a+o.length*l+c.length>=d));)o.push(c),a+=c.length,t=t.parentNode;return o.reverse().join(s)}catch{return"<unknown>"}}function aY(n,e){const t=n,r=[];if(!(t!=null&&t.tagName))return"";if(xA.HTMLElement&&t instanceof HTMLElement&&t.dataset){if(t.dataset.sentryComponent)return t.dataset.sentryComponent;if(t.dataset.sentryElement)return t.dataset.sentryElement}r.push(t.tagName.toLowerCase());const o=e!=null&&e.length?e.filter(a=>t.getAttribute(a)).map(a=>[a,t.getAttribute(a)]):null;if(o!=null&&o.length)o.forEach(a=>{r.push(`[${a[0]}="${a[1]}"]`)});else{t.id&&r.push(`#${t.id}`);const a=t.className;if(a&&ts(a)){const s=a.split(/\s+/);for(const l of s)r.push(`.${l}`)}}const i=["aria-label","type","name","title","alt"];for(const a of i){const s=t.getAttribute(a);s&&r.push(`[${a}="${s}"]`)}return r.join("")}function Vm(){try{return xA.document.location.href}catch{return""}}function sY(n){if(!xA.HTMLElement)return null;let e=n;const t=5;for(let r=0;r<t;r++){if(!e)return null;if(e instanceof HTMLElement){if(e.dataset.sentryComponent)return e.dataset.sentryComponent;if(e.dataset.sentryElement)return e.dataset.sentryElement}e=e.parentNode}return null}function Um(n,e=0){return typeof n!="string"||e===0||n.length<=e?n:`${n.slice(0,e)}...`}function CT(n,e){if(!Array.isArray(n))return"";const t=[];for(let r=0;r<n.length;r++){const o=n[r];try{ET(o)?t.push("[VueViewModel]"):t.push(String(o))}catch{t.push("[value cannot be serialized]")}}return t.join(e)}function lY(n,e,t=!1){return ts(n)?nY(e)?e.test(n):ts(e)?t?n===e:n.includes(e):!1:!1}function Rf(n,e=[],t=!1){return e.some(r=>lY(n,r,t))}function Oo(n,e,t){if(!(e in n))return;const r=n[e];if(typeof r!="function")return;const o=t(r);typeof o=="function"&&ST(o,r);try{n[e]=o}catch{wt&&lt.log(`Failed to replace method "${e}" in object`,n)}}function Ai(n,e,t){try{Object.defineProperty(n,e,{value:t,writable:!0,configurable:!0})}catch{wt&&lt.log(`Failed to add non-enumerable property "${e}" to object`,n)}}function ST(n,e){try{const t=e.prototype||{};n.prototype=e.prototype=t,Ai(n,"__sentry_original__",e)}catch{}}function EA(n){return n.__sentry_original__}function wT(n){if(AA(n))return{message:n.message,name:n.name,stack:n.stack,...TT(n)};if(Om(n)){const e={type:n.type,target:MT(n.target),currentTarget:MT(n.currentTarget),...TT(n)};return typeof CustomEvent<"u"&&$s(n,CustomEvent)&&(e.detail=n.detail),e}else return n}function MT(n){try{return tY(n)?Fm(n):Object.prototype.toString.call(n)}catch{return"<unknown>"}}function TT(n){if(typeof n=="object"&&n!==null){const e={};for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t]);return e}else return{}}function cY(n,e=40){const t=Object.keys(wT(n));t.sort();const r=t[0];if(!r)return"[object has no keys]";if(r.length>=e)return Um(r,e);for(let o=t.length;o>0;o--){const i=t.slice(0,o).join(", ");if(!(i.length>e))return o===t.length?i:Um(i,e)}return""}function uY(){const n=hn;return n.crypto||n.msCrypto}function Ko(n=uY()){let e=()=>Math.random()*16;try{if(n!=null&&n.randomUUID)return n.randomUUID().replace(/-/g,"");n!=null&&n.getRandomValues&&(e=()=>{const t=new Uint8Array(1);return n.getRandomValues(t),t[0]})}catch{}return("10000000100040008000"+1e11).replace(/[018]/g,t=>(t^(e()&15)>>t/4).toString(16))}function IT(n){var e,t;return(t=(e=n.exception)==null?void 0:e.values)==null?void 0:t[0]}function jl(n){const{message:e,event_id:t}=n;if(e)return e;const r=IT(n);return r?r.type&&r.value?`${r.type}: ${r.value}`:r.type||r.value||t||"<unknown>":t||"<unknown>"}function CA(n,e,t){const r=n.exception=n.exception||{},o=r.values=r.values||[],i=o[0]=o[0]||{};i.value||(i.value=e||""),i.type||(i.type="Error")}function nu(n,e){const t=IT(n);if(!t)return;const r={type:"generic",handled:!0},o=t.mechanism;if(t.mechanism={...r,...o,...e},e&&"data"in e){const i={...o==null?void 0:o.data,...e.data};t.mechanism.data=i}}function RT(n){if(dY(n))return!0;try{Ai(n,"__sentry_captured__",!0)}catch{}return!1}function dY(n){try{return n.__sentry_captured__}catch{}}const LT=1e3;function Lf(){return Date.now()/LT}function fY(){const{performance:n}=hn;if(!(n!=null&&n.now)||!n.timeOrigin)return Lf;const e=n.timeOrigin;return()=>(e+n.now())/LT}let PT;function ko(){return(PT??(PT=fY()))()}let SA;function hY(){var u;const{performance:n}=hn;if(!(n!=null&&n.now))return[void 0,"none"];const e=3600*1e3,t=n.now(),r=Date.now(),o=n.timeOrigin?Math.abs(n.timeOrigin+t-r):e,i=o<e,a=(u=n.timing)==null?void 0:u.navigationStart,l=typeof a=="number"?Math.abs(a+t-r):e,c=l<e;return i||c?o<=l?[n.timeOrigin,"timeOrigin"]:[a,"navigationStart"]:[r,"dateNow"]}function pY(){return SA||(SA=hY()),SA[0]}function mY(n){const e=ko(),t={sid:Ko(),init:!0,timestamp:e,started:e,duration:0,status:"ok",errors:0,ignoreDuration:!1,toJSON:()=>_Y(t)};return n&&ru(t,n),t}function ru(n,e={}){if(e.user&&(!n.ipAddress&&e.user.ip_address&&(n.ipAddress=e.user.ip_address),!n.did&&!e.did&&(n.did=e.user.id||e.user.email||e.user.username)),n.timestamp=e.timestamp||ko(),e.abnormal_mechanism&&(n.abnormal_mechanism=e.abnormal_mechanism),e.ignoreDuration&&(n.ignoreDuration=e.ignoreDuration),e.sid&&(n.sid=e.sid.length===32?e.sid:Ko()),e.init!==void 0&&(n.init=e.init),!n.did&&e.did&&(n.did=`${e.did}`),typeof e.started=="number"&&(n.started=e.started),n.ignoreDuration)n.duration=void 0;else if(typeof e.duration=="number")n.duration=e.duration;else{const t=n.timestamp-n.started;n.duration=t>=0?t:0}e.release&&(n.release=e.release),e.environment&&(n.environment=e.environment),!n.ipAddress&&e.ipAddress&&(n.ipAddress=e.ipAddress),!n.userAgent&&e.userAgent&&(n.userAgent=e.userAgent),typeof e.errors=="number"&&(n.errors=e.errors),e.status&&(n.status=e.status)}function gY(n,e){let t={};n.status==="ok"&&(t={status:"exited"}),ru(n,t)}function _Y(n){return{sid:`${n.sid}`,init:n.init,started:new Date(n.started*1e3).toISOString(),timestamp:new Date(n.timestamp*1e3).toISOString(),status:n.status,errors:n.errors,did:typeof n.did=="number"||typeof n.did=="string"?`${n.did}`:void 0,duration:n.duration,abnormal_mechanism:n.abnormal_mechanism,attrs:{release:n.release,environment:n.environment,ip_address:n.ipAddress,user_agent:n.userAgent}}}function Pf(n,e,t=2){if(!e||typeof e!="object"||t<=0)return e;if(n&&Object.keys(e).length===0)return n;const r={...n};for(const o in e)Object.prototype.hasOwnProperty.call(e,o)&&(r[o]=Pf(r[o],e[o],t-1));return r}function zm(){return Ko()}function Gm(){return Ko().substring(16)}const wA="_sentrySpan";function MA(n,e){e?Ai(n,wA,e):delete n[wA]}function Hm(n){return n[wA]}const vY=100;class _a{constructor(){this._notifyingListeners=!1,this._scopeListeners=[],this._eventProcessors=[],this._breadcrumbs=[],this._attachments=[],this._user={},this._tags={},this._extra={},this._contexts={},this._sdkProcessingMetadata={},this._propagationContext={traceId:zm(),sampleRand:Math.random()}}clone(){const e=new _a;return e._breadcrumbs=[...this._breadcrumbs],e._tags={...this._tags},e._extra={...this._extra},e._contexts={...this._contexts},this._contexts.flags&&(e._contexts.flags={values:[...this._contexts.flags.values]}),e._user=this._user,e._level=this._level,e._session=this._session,e._transactionName=this._transactionName,e._fingerprint=this._fingerprint,e._eventProcessors=[...this._eventProcessors],e._attachments=[...this._attachments],e._sdkProcessingMetadata={...this._sdkProcessingMetadata},e._propagationContext={...this._propagationContext},e._client=this._client,e._lastEventId=this._lastEventId,MA(e,Hm(this)),e}setClient(e){this._client=e}setLastEventId(e){this._lastEventId=e}getClient(){return this._client}lastEventId(){return this._lastEventId}addScopeListener(e){this._scopeListeners.push(e)}addEventProcessor(e){return this._eventProcessors.push(e),this}setUser(e){return this._user=e||{email:void 0,id:void 0,ip_address:void 0,username:void 0},this._session&&ru(this._session,{user:e}),this._notifyScopeListeners(),this}getUser(){return this._user}setTags(e){return this._tags={...this._tags,...e},this._notifyScopeListeners(),this}setTag(e,t){return this._tags={...this._tags,[e]:t},this._notifyScopeListeners(),this}setExtras(e){return this._extra={...this._extra,...e},this._notifyScopeListeners(),this}setExtra(e,t){return this._extra={...this._extra,[e]:t},this._notifyScopeListeners(),this}setFingerprint(e){return this._fingerprint=e,this._notifyScopeListeners(),this}setLevel(e){return this._level=e,this._notifyScopeListeners(),this}setTransactionName(e){return this._transactionName=e,this._notifyScopeListeners(),this}setContext(e,t){return t===null?delete this._contexts[e]:this._contexts[e]=t,this._notifyScopeListeners(),this}setSession(e){return e?this._session=e:delete this._session,this._notifyScopeListeners(),this}getSession(){return this._session}update(e){if(!e)return this;const t=typeof e=="function"?e(this):e,r=t instanceof _a?t.getScopeData():If(t)?e:void 0,{tags:o,extra:i,user:a,contexts:s,level:l,fingerprint:c=[],propagationContext:u}=r||{};return this._tags={...this._tags,...o},this._extra={...this._extra,...i},this._contexts={...this._contexts,...s},a&&Object.keys(a).length&&(this._user=a),l&&(this._level=l),c.length&&(this._fingerprint=c),u&&(this._propagationContext=u),this}clear(){return this._breadcrumbs=[],this._tags={},this._extra={},this._user={},this._contexts={},this._level=void 0,this._transactionName=void 0,this._fingerprint=void 0,this._session=void 0,MA(this,void 0),this._attachments=[],this.setPropagationContext({traceId:zm(),sampleRand:Math.random()}),this._notifyScopeListeners(),this}addBreadcrumb(e,t){var i;const r=typeof t=="number"?t:vY;if(r<=0)return this;const o={timestamp:Lf(),...e,message:e.message?Um(e.message,2048):e.message};return this._breadcrumbs.push(o),this._breadcrumbs.length>r&&(this._breadcrumbs=this._breadcrumbs.slice(-r),(i=this._client)==null||i.recordDroppedEvent("buffer_overflow","log_item")),this._notifyScopeListeners(),this}getLastBreadcrumb(){return this._breadcrumbs[this._breadcrumbs.length-1]}clearBreadcrumbs(){return this._breadcrumbs=[],this._notifyScopeListeners(),this}addAttachment(e){return this._attachments.push(e),this}clearAttachments(){return this._attachments=[],this}getScopeData(){return{breadcrumbs:this._breadcrumbs,attachments:this._attachments,contexts:this._contexts,tags:this._tags,extra:this._extra,user:this._user,level:this._level,fingerprint:this._fingerprint||[],eventProcessors:this._eventProcessors,propagationContext:this._propagationContext,sdkProcessingMetadata:this._sdkProcessingMetadata,transactionName:this._transactionName,span:Hm(this)}}setSDKProcessingMetadata(e){return this._sdkProcessingMetadata=Pf(this._sdkProcessingMetadata,e,2),this}setPropagationContext(e){return this._propagationContext=e,this}getPropagationContext(){return this._propagationContext}captureException(e,t){const r=(t==null?void 0:t.event_id)||Ko();if(!this._client)return wt&&lt.warn("No client configured on scope - will not capture exception!"),r;const o=new Error("Sentry syntheticException");return this._client.captureException(e,{originalException:e,syntheticException:o,...t,event_id:r},this),r}captureMessage(e,t,r){const o=(r==null?void 0:r.event_id)||Ko();if(!this._client)return wt&&lt.warn("No client configured on scope - will not capture message!"),o;const i=new Error(e);return this._client.captureMessage(e,t,{originalException:e,syntheticException:i,...r,event_id:o},this),o}captureEvent(e,t){const r=(t==null?void 0:t.event_id)||Ko();return this._client?(this._client.captureEvent(e,{...t,event_id:r},this),r):(wt&&lt.warn("No client configured on scope - will not capture event!"),r)}_notifyScopeListeners(){this._notifyingListeners||(this._notifyingListeners=!0,this._scopeListeners.forEach(e=>{e(this)}),this._notifyingListeners=!1)}}function AY(){return Tf("defaultCurrentScope",()=>new _a)}function yY(){return Tf("defaultIsolationScope",()=>new _a)}class bY{constructor(e,t){let r;e?r=e:r=new _a;let o;t?o=t:o=new _a,this._stack=[{scope:r}],this._isolationScope=o}withScope(e){const t=this._pushScope();let r;try{r=e(t)}catch(o){throw this._popScope(),o}return km(r)?r.then(o=>(this._popScope(),o),o=>{throw this._popScope(),o}):(this._popScope(),r)}getClient(){return this.getStackTop().client}getScope(){return this.getStackTop().scope}getIsolationScope(){return this._isolationScope}getStackTop(){return this._stack[this._stack.length-1]}_pushScope(){const e=this.getScope().clone();return this._stack.push({client:this.getClient(),scope:e}),e}_popScope(){return this._stack.length<=1?!1:!!this._stack.pop()}}function ou(){const n=eu(),e=Pm(n);return e.stack=e.stack||new bY(AY(),yY())}function xY(n){return ou().withScope(n)}function EY(n,e){const t=ou();return t.withScope(()=>(t.getStackTop().scope=n,e(n)))}function DT(n){return ou().withScope(()=>n(ou().getIsolationScope()))}function CY(){return{withIsolationScope:DT,withScope:xY,withSetScope:EY,withSetIsolationScope:(n,e)=>DT(e),getCurrentScope:()=>ou().getScope(),getIsolationScope:()=>ou().getIsolationScope()}}function Df(n){const e=Pm(n);return e.acs?e.acs:CY()}function Zo(){const n=eu();return Df(n).getCurrentScope()}function ns(){const n=eu();return Df(n).getIsolationScope()}function SY(){return Tf("globalScope",()=>new _a)}function TA(...n){const e=eu(),t=Df(e);if(n.length===2){const[r,o]=n;return r?t.withSetScope(r,o):t.withScope(o)}return t.withScope(n[0])}function Pn(){return Zo().getClient()}function wY(n){const e=n.getPropagationContext(),{traceId:t,parentSpanId:r,propagationSpanId:o}=e,i={trace_id:t,span_id:o||Gm()};return r&&(i.parent_span_id=r),i}const Bf="sentry.source",BT="sentry.sample_rate",MY="sentry.previous_trace_sample_rate",IA="sentry.op",Nf="sentry.origin",TY="sentry.measurement_unit",IY="sentry.measurement_value",NT="sentry.custom_span_name",RA="sentry.profile_id",LA="sentry.exclusive_time",RY=0,LY=1,OT="_sentryScope",kT="_sentryIsolationScope";function PY(n,e,t){n&&(Ai(n,kT,t),Ai(n,OT,e))}function Wm(n){return{scope:n[OT],isolationScope:n[kT]}}const DY="sentry-",BY=/^sentry-/;function NY(n){const e=OY(n);if(!e)return;const t=Object.entries(e).reduce((r,[o,i])=>{if(o.match(BY)){const a=o.slice(DY.length);r[a]=i}return r},{});if(Object.keys(t).length>0)return t}function OY(n){if(!(!n||!ts(n)&&!Array.isArray(n)))return Array.isArray(n)?n.reduce((e,t)=>{const r=FT(t);return Object.entries(r).forEach(([o,i])=>{e[o]=i}),e},{}):FT(n)}function FT(n){return n.split(",").map(e=>e.split("=").map(t=>{try{return decodeURIComponent(t.trim())}catch{return}})).reduce((e,[t,r])=>(t&&r&&(e[t]=r),e),{})}function Of(n){if(typeof n=="boolean")return Number(n);const e=typeof n=="string"?parseFloat(n):n;if(!(typeof e!="number"||isNaN(e)||e<0||e>1))return e}const VT=0,PA=1;let UT=!1;function kY(n){const{spanId:e,traceId:t}=n.spanContext(),{data:r,op:o,parent_span_id:i,status:a,origin:s,links:l}=Jo(n);return{parent_span_id:i,span_id:e,trace_id:t,data:r,op:o,status:a,origin:s,links:l}}function FY(n){const{spanId:e,traceId:t,isRemote:r}=n.spanContext(),o=r?e:Jo(n).parent_span_id,i=Wm(n).scope,a=r?(i==null?void 0:i.getPropagationContext().propagationSpanId)||Gm():e;return{parent_span_id:o,span_id:a,trace_id:t}}function zT(n){if(n&&n.length>0)return n.map(({context:{spanId:e,traceId:t,traceFlags:r,...o},attributes:i})=>({span_id:e,trace_id:t,sampled:r===PA,attributes:i,...o}))}function iu(n){return typeof n=="number"?GT(n):Array.isArray(n)?n[0]+n[1]/1e9:n instanceof Date?GT(n.getTime()):ko()}function GT(n){return n>9999999999?n/1e3:n}function Jo(n){var r;if(UY(n))return n.getSpanJSON();const{spanId:e,traceId:t}=n.spanContext();if(VY(n)){const{attributes:o,startTime:i,name:a,endTime:s,status:l,links:c}=n,u="parentSpanId"in n?n.parentSpanId:"parentSpanContext"in n?(r=n.parentSpanContext)==null?void 0:r.spanId:void 0;return{span_id:e,trace_id:t,data:o,description:a,parent_span_id:u,start_timestamp:iu(i),timestamp:iu(s)||void 0,status:HT(l),op:o[IA],origin:o[Nf],links:zT(c)}}return{span_id:e,trace_id:t,start_timestamp:0,data:{}}}function VY(n){const e=n;return!!e.attributes&&!!e.startTime&&!!e.name&&!!e.endTime&&!!e.status}function UY(n){return typeof n.getSpanJSON=="function"}function kf(n){const{traceFlags:e}=n.spanContext();return e===PA}function HT(n){if(!(!n||n.code===RY))return n.code===LY?"ok":n.message||"unknown_error"}const Ff="_sentryChildSpans",DA="_sentryRootSpan";function WT(n,e){const t=n[DA]||n;Ai(e,DA,t),n[Ff]?n[Ff].add(e):Ai(n,Ff,new Set([e]))}function zY(n){const e=new Set;function t(r){if(!e.has(r)&&kf(r)){e.add(r);const o=r[Ff]?Array.from(r[Ff]):[];for(const i of o)t(i)}}return t(n),Array.from(e)}function rs(n){return n[DA]||n}function BA(){const n=eu(),e=Df(n);return e.getActiveSpan?e.getActiveSpan():Hm(Zo())}function NA(){UT||(Ja(()=>{console.warn("[Sentry] Returning null from `beforeSendSpan` is disallowed. To drop certain spans, configure the respective integrations directly.")}),UT=!0)}function jm(n){var t;if(typeof __SENTRY_TRACING__=="boolean"&&!__SENTRY_TRACING__)return!1;const e=n||((t=Pn())==null?void 0:t.getOptions());return!!e&&(e.tracesSampleRate!=null||!!e.tracesSampler)}const OA="production",GY=/^o(\d+)\./,HY=/^(?:(\w+):)\/\/(?:(\w+)(?::(\w+)?)?@)([\w.-]+)(?::(\d+))?\/(.+)/;function WY(n){return n==="http"||n==="https"}function Vf(n,e=!1){const{host:t,path:r,pass:o,port:i,projectId:a,protocol:s,publicKey:l}=n;return`${s}://${l}${e&&o?`:${o}`:""}@${t}${i?`:${i}`:""}/${r&&`${r}/`}${a}`}function jY(n){const e=HY.exec(n);if(!e){Ja(()=>{console.error(`Invalid Sentry Dsn: ${n}`)});return}const[t,r,o="",i="",a="",s=""]=e.slice(1);let l="",c=s;const u=c.split("/");if(u.length>1&&(l=u.slice(0,-1).join("/"),c=u.pop()),c){const d=c.match(/^\d+/);d&&(c=d[0])}return jT({host:i,pass:o,path:l,projectId:c,port:a,protocol:t,publicKey:r})}function jT(n){return{protocol:n.protocol,publicKey:n.publicKey||"",pass:n.pass||"",host:n.host,port:n.port||"",path:n.path||"",projectId:n.projectId}}function QY(n){if(!wt)return!0;const{port:e,projectId:t,protocol:r}=n;return["protocol","publicKey","host","projectId"].find(a=>n[a]?!1:(lt.error(`Invalid Sentry Dsn: ${a} missing`),!0))?!1:t.match(/^\d+$/)?WY(r)?e&&isNaN(parseInt(e,10))?(lt.error(`Invalid Sentry Dsn: Invalid port ${e}`),!1):!0:(lt.error(`Invalid Sentry Dsn: Invalid protocol ${r}`),!1):(lt.error(`Invalid Sentry Dsn: Invalid projectId ${t}`),!1)}function $Y(n){const e=n.match(GY);return e==null?void 0:e[1]}function YY(n){const e=typeof n=="string"?jY(n):jT(n);if(!(!e||!QY(e)))return e}const QT="_frozenDsc";function kA(n,e){Ai(n,QT,e)}function $T(n,e){const t=e.getOptions(),{publicKey:r,host:o}=e.getDsn()||{};let i;t.orgId?i=String(t.orgId):o&&(i=$Y(o));const a={environment:t.environment||OA,release:t.release,public_key:r,trace_id:n,org_id:i};return e.emit("createDsc",a),a}function XY(n,e){const t=e.getPropagationContext();return t.dsc||$T(t.traceId,n)}function au(n){var p;const e=Pn();if(!e)return{};const t=rs(n),r=Jo(t),o=r.data,i=t.spanContext().traceState,a=(i==null?void 0:i.get("sentry.sample_rate"))??o[BT]??o[MY];function s(m){return(typeof a=="number"||typeof a=="string")&&(m.sample_rate=`${a}`),m}const l=t[QT];if(l)return s(l);const c=i==null?void 0:i.get("sentry.dsc"),u=c&&NY(c);if(u)return s(u);const d=$T(n.spanContext().traceId,e),f=o[Bf],h=r.description;return f!=="url"&&h&&(d.transaction=h),jm()&&(d.sampled=String(kf(t)),d.sample_rand=(i==null?void 0:i.get("sentry.sample_rand"))??((p=Wm(t).scope)==null?void 0:p.getPropagationContext().sampleRand.toString())),s(d),e.emit("createDsc",d,t),d}class FA{constructor(e={}){this._traceId=e.traceId||zm(),this._spanId=e.spanId||Gm()}spanContext(){return{spanId:this._spanId,traceId:this._traceId,traceFlags:VT}}end(e){}setAttribute(e,t){return this}setAttributes(e){return this}setStatus(e){return this}updateName(e){return this}isRecording(){return!1}addEvent(e,t,r){return this}addLink(e){return this}addLinks(e){return this}recordException(e,t){}}function Hi(n,e=100,t=1/0){try{return VA("",n,e,t)}catch(r){return{ERROR:`**non-serializable** (${r})`}}}function YT(n,e=3,t=100*1024){const r=Hi(n,e);return JY(r)>t?YT(n,e-1,t):r}function VA(n,e,t=1/0,r=1/0,o=eX()){const[i,a]=o;if(e==null||["boolean","string"].includes(typeof e)||typeof e=="number"&&Number.isFinite(e))return e;const s=qY(n,e);if(!s.startsWith("[object "))return s;if(e.__sentry_skip_normalization__)return e;const l=typeof e.__sentry_override_normalization_depth__=="number"?e.__sentry_override_normalization_depth__:t;if(l===0)return s.replace("object ","");if(i(e))return"[Circular ~]";const c=e;if(c&&typeof c.toJSON=="function")try{const h=c.toJSON();return VA("",h,l-1,r,o)}catch{}const u=Array.isArray(e)?[]:{};let d=0;const f=wT(e);for(const h in f){if(!Object.prototype.hasOwnProperty.call(f,h))continue;if(d>=r){u[h]="[MaxProperties ~]";break}const p=f[h];u[h]=VA(h,p,l-1,r,o),d++}return a(e),u}function qY(n,e){try{if(n==="domain"&&e&&typeof e=="object"&&e._events)return"[Domain]";if(n==="domainEmitter")return"[DomainEmitter]";if(typeof global<"u"&&e===global)return"[Global]";if(typeof window<"u"&&e===window)return"[Window]";if(typeof document<"u"&&e===document)return"[Document]";if(ET(e))return"[VueViewModel]";if(rY(e))return"[SyntheticEvent]";if(typeof e=="number"&&!Number.isFinite(e))return`[${e}]`;if(typeof e=="function")return`[Function: ${es(e)}]`;if(typeof e=="symbol")return`[${String(e)}]`;if(typeof e=="bigint")return`[BigInt: ${String(e)}]`;const t=KY(e);return/^HTML(\w*)Element$/.test(t)?`[HTMLElement: ${t}]`:`[object ${t}]`}catch(t){return`**non-serializable** (${t})`}}function KY(n){const e=Object.getPrototypeOf(n);return e!=null&&e.constructor?e.constructor.name:"null prototype"}function ZY(n){return~-encodeURI(n).split(/%..|./).length}function JY(n){return ZY(JSON.stringify(n))}function eX(){const n=new WeakSet;function e(r){return n.has(r)?!0:(n.add(r),!1)}function t(r){n.delete(r)}return[e,t]}function Ql(n,e=[]){return[n,e]}function tX(n,e){const[t,r]=n;return[t,[...r,e]]}function XT(n,e){const t=n[1];for(const r of t){const o=r[0].type;if(e(r,o))return!0}return!1}function UA(n){const e=Pm(hn);return e.encodePolyfill?e.encodePolyfill(n):new TextEncoder().encode(n)}function nX(n){const[e,t]=n;let r=JSON.stringify(e);function o(i){typeof r=="string"?r=typeof i=="string"?r+i:[UA(r),i]:r.push(typeof i=="string"?UA(i):i)}for(const i of t){const[a,s]=i;if(o(`
${JSON.stringify(a)}
`),typeof s=="string"||s instanceof Uint8Array)o(s);else{let l;try{l=JSON.stringify(s)}catch{l=JSON.stringify(Hi(s))}o(l)}}return typeof r=="string"?r:rX(r)}function rX(n){const e=n.reduce((o,i)=>o+i.length,0),t=new Uint8Array(e);let r=0;for(const o of n)t.set(o,r),r+=o.length;return t}function oX(n){return[{type:"span"},n]}function iX(n){const e=typeof n.data=="string"?UA(n.data):n.data;return[{type:"attachment",length:e.length,filename:n.filename,content_type:n.contentType,attachment_type:n.attachmentType},e]}const aX={session:"session",sessions:"session",attachment:"attachment",transaction:"transaction",event:"error",client_report:"internal",user_report:"default",profile:"profile",profile_chunk:"profile",replay_event:"replay",replay_recording:"replay",check_in:"monitor",feedback:"feedback",span:"span",raw_security:"security",log:"log_item"};function qT(n){return aX[n]}function zA(n){if(!(n!=null&&n.sdk))return;const{name:e,version:t}=n.sdk;return{name:e,version:t}}function KT(n,e,t,r){var i;const o=(i=n.sdkProcessingMetadata)==null?void 0:i.dynamicSamplingContext;return{event_id:n.event_id,sent_at:new Date().toISOString(),...e&&{sdk:e},...!!t&&r&&{dsn:Vf(r)},...o&&{trace:o}}}function sX(n,e){return e&&(n.sdk=n.sdk||{},n.sdk.name=n.sdk.name||e.name,n.sdk.version=n.sdk.version||e.version,n.sdk.integrations=[...n.sdk.integrations||[],...e.integrations||[]],n.sdk.packages=[...n.sdk.packages||[],...e.packages||[]]),n}function lX(n,e,t,r){const o=zA(t),i={sent_at:new Date().toISOString(),...o&&{sdk:o},...!!r&&e&&{dsn:Vf(e)}},a="aggregates"in n?[{type:"sessions"},n]:[{type:"session"},n.toJSON()];return Ql(i,[a])}function cX(n,e,t,r){const o=zA(t),i=n.type&&n.type!=="replay_event"?n.type:"event";sX(n,t==null?void 0:t.sdk);const a=KT(n,o,r,e);return delete n.sdkProcessingMetadata,Ql(a,[[{type:i},n]])}function uX(n,e){function t(u){return!!u.trace_id&&!!u.public_key}const r=au(n[0]),o=e==null?void 0:e.getDsn(),i=e==null?void 0:e.getOptions().tunnel,a={sent_at:new Date().toISOString(),...t(r)&&{trace:r},...!!i&&o&&{dsn:Vf(o)}},s=e==null?void 0:e.getOptions().beforeSendSpan,l=s?u=>{const d=Jo(u),f=s(d);return f||(NA(),d)}:Jo,c=[];for(const u of n){const d=l(u);d&&c.push(oX(d))}return Ql(a,c)}function dX(n){if(!wt)return;const{description:e="< unknown name >",op:t="< unknown op >",parent_span_id:r}=Jo(n),{spanId:o}=n.spanContext(),i=kf(n),a=rs(n),s=a===n,l=`[Tracing] Starting ${i?"sampled":"unsampled"} ${s?"root ":""}span`,c=[`op: ${t}`,`name: ${e}`,`ID: ${o}`];if(r&&c.push(`parent ID: ${r}`),!s){const{op:u,description:d}=Jo(a);c.push(`root ID: ${a.spanContext().spanId}`),u&&c.push(`root op: ${u}`),d&&c.push(`root description: ${d}`)}lt.log(`${l}
  ${c.join(`
  `)}`)}function fX(n){if(!wt)return;const{description:e="< unknown name >",op:t="< unknown op >"}=Jo(n),{spanId:r}=n.spanContext(),i=rs(n)===n,a=`[Tracing] Finishing "${t}" ${i?"root ":""}span "${e}" with ID ${r}`;lt.log(a)}function ZT(n){if(!n||n.length===0)return;const e={};return n.forEach(t=>{const r=t.attributes||{},o=r[TY],i=r[IY];typeof o=="string"&&typeof i=="number"&&(e[t.name]={value:i,unit:o})}),e}const JT=1e3;class GA{constructor(e={}){this._traceId=e.traceId||zm(),this._spanId=e.spanId||Gm(),this._startTime=e.startTimestamp||ko(),this._links=e.links,this._attributes={},this.setAttributes({[Nf]:"manual",[IA]:e.op,...e.attributes}),this._name=e.name,e.parentSpanId&&(this._parentSpanId=e.parentSpanId),"sampled"in e&&(this._sampled=e.sampled),e.endTimestamp&&(this._endTime=e.endTimestamp),this._events=[],this._isStandaloneSpan=e.isStandalone,this._endTime&&this._onSpanEnded()}addLink(e){return this._links?this._links.push(e):this._links=[e],this}addLinks(e){return this._links?this._links.push(...e):this._links=e,this}recordException(e,t){}spanContext(){const{_spanId:e,_traceId:t,_sampled:r}=this;return{spanId:e,traceId:t,traceFlags:r?PA:VT}}setAttribute(e,t){return t===void 0?delete this._attributes[e]:this._attributes[e]=t,this}setAttributes(e){return Object.keys(e).forEach(t=>this.setAttribute(t,e[t])),this}updateStartTime(e){this._startTime=iu(e)}setStatus(e){return this._status=e,this}updateName(e){return this._name=e,this.setAttribute(Bf,"custom"),this}end(e){this._endTime||(this._endTime=iu(e),fX(this),this._onSpanEnded())}getSpanJSON(){return{data:this._attributes,description:this._name,op:this._attributes[IA],parent_span_id:this._parentSpanId,span_id:this._spanId,start_timestamp:this._startTime,status:HT(this._status),timestamp:this._endTime,trace_id:this._traceId,origin:this._attributes[Nf],profile_id:this._attributes[RA],exclusive_time:this._attributes[LA],measurements:ZT(this._events),is_segment:this._isStandaloneSpan&&rs(this)===this||void 0,segment_id:this._isStandaloneSpan?rs(this).spanContext().spanId:void 0,links:zT(this._links)}}isRecording(){return!this._endTime&&!!this._sampled}addEvent(e,t,r){wt&&lt.log("[Tracing] Adding an event to span:",e);const o=eI(t)?t:r||ko(),i=eI(t)?{}:t||{},a={name:e,time:iu(o),attributes:i};return this._events.push(a),this}isStandaloneSpan(){return!!this._isStandaloneSpan}_onSpanEnded(){const e=Pn();if(e&&e.emit("spanEnd",this),!(this._isStandaloneSpan||this===rs(this)))return;if(this._isStandaloneSpan){this._sampled?pX(uX([this],e)):(wt&&lt.log("[Tracing] Discarding standalone span because its trace was not chosen to be sampled."),e&&e.recordDroppedEvent("sample_rate","span"));return}const r=this._convertSpanToTransaction();r&&(Wm(this).scope||Zo()).captureEvent(r)}_convertSpanToTransaction(){var u;if(!tI(Jo(this)))return;this._name||(wt&&lt.warn("Transaction has no name, falling back to `<unlabeled transaction>`."),this._name="<unlabeled transaction>");const{scope:e,isolationScope:t}=Wm(this),r=(u=e==null?void 0:e.getScopeData().sdkProcessingMetadata)==null?void 0:u.normalizedRequest;if(this._sampled!==!0)return;const i=zY(this).filter(d=>d!==this&&!hX(d)).map(d=>Jo(d)).filter(tI),a=this._attributes[Bf];delete this._attributes[NT],i.forEach(d=>{delete d.data[NT]});const s={contexts:{trace:kY(this)},spans:i.length>JT?i.sort((d,f)=>d.start_timestamp-f.start_timestamp).slice(0,JT):i,start_timestamp:this._startTime,timestamp:this._endTime,transaction:this._name,type:"transaction",sdkProcessingMetadata:{capturedSpanScope:e,capturedSpanIsolationScope:t,dynamicSamplingContext:au(this)},request:r,...a&&{transaction_info:{source:a}}},l=ZT(this._events);return l&&Object.keys(l).length&&(wt&&lt.log("[Measurements] Adding measurements to transaction event",JSON.stringify(l,void 0,2)),s.measurements=l),s}}function eI(n){return n&&typeof n=="number"||n instanceof Date||Array.isArray(n)}function tI(n){return!!n.start_timestamp&&!!n.timestamp&&!!n.span_id&&!!n.trace_id}function hX(n){return n instanceof GA&&n.isStandaloneSpan()}function pX(n){const e=Pn();if(!e)return;const t=n[1];if(!t||t.length===0){e.recordDroppedEvent("before_send","span");return}e.sendEnvelope(n)}function mX(n,e,t){if(!jm(n))return[!1];let r,o;typeof n.tracesSampler=="function"?(o=n.tracesSampler({...e,inheritOrSampleWith:s=>typeof e.parentSampleRate=="number"?e.parentSampleRate:typeof e.parentSampled=="boolean"?Number(e.parentSampled):s}),r=!0):e.parentSampled!==void 0?o=e.parentSampled:typeof n.tracesSampleRate<"u"&&(o=n.tracesSampleRate,r=!0);const i=Of(o);if(i===void 0)return wt&&lt.warn(`[Tracing] Discarding root span because of invalid sample rate. Sample rate must be a boolean or a number between 0 and 1. Got ${JSON.stringify(o)} of type ${JSON.stringify(typeof o)}.`),[!1];if(!i)return wt&&lt.log(`[Tracing] Discarding transaction because ${typeof n.tracesSampler=="function"?"tracesSampler returned 0 or false":"a negative sampling decision was inherited or tracesSampleRate is set to 0"}`),[!1,i,r];const a=t<i;return a||wt&&lt.log(`[Tracing] Discarding transaction because it's not included in the random sample (sampling rate = ${Number(o)})`),[a,i,r]}const nI="__SENTRY_SUPPRESS_TRACING__";function rI(n){const e=oI();if(e.startInactiveSpan)return e.startInactiveSpan(n);const t=vX(n),{forceTransaction:r,parentSpan:o}=n;return(n.scope?a=>TA(n.scope,a):o!==void 0?a=>gX(o,a):a=>a())(()=>{const a=Zo(),s=yX(a,o);return n.onlyIfParent&&!s?new FA:_X({parentSpan:s,spanArguments:t,forceTransaction:r,scope:a})})}function gX(n,e){const t=oI();return t.withActiveSpan?t.withActiveSpan(n,e):TA(r=>(MA(r,n||void 0),e(r)))}function _X({parentSpan:n,spanArguments:e,forceTransaction:t,scope:r}){if(!jm()){const a=new FA;if(t||!n){const s={sampled:"false",sample_rate:"0",transaction:e.name,...au(a)};kA(a,s)}return a}const o=ns();let i;if(n&&!t)i=AX(n,r,e),WT(n,i);else if(n){const a=au(n),{traceId:s,spanId:l}=n.spanContext(),c=kf(n);i=iI({traceId:s,parentSpanId:l,...e},r,c),kA(i,a)}else{const{traceId:a,dsc:s,parentSpanId:l,sampled:c}={...o.getPropagationContext(),...r.getPropagationContext()};i=iI({traceId:a,parentSpanId:l,...e},r,c),s&&kA(i,s)}return dX(i),PY(i,r,o),i}function vX(n){const t={isStandalone:(n.experimental||{}).standalone,...n};if(n.startTime){const r={...t};return r.startTimestamp=iu(n.startTime),delete r.startTime,r}return t}function oI(){const n=eu();return Df(n)}function iI(n,e,t){var p;const r=Pn(),o=(r==null?void 0:r.getOptions())||{},{name:i=""}=n,a={spanAttributes:{...n.attributes},spanName:i,parentSampled:t};r==null||r.emit("beforeSampling",a,{decision:!1});const s=a.parentSampled??t,l=a.spanAttributes,c=e.getPropagationContext(),[u,d,f]=e.getScopeData().sdkProcessingMetadata[nI]?[!1]:mX(o,{name:i,parentSampled:s,attributes:l,parentSampleRate:Of((p=c.dsc)==null?void 0:p.sample_rate)},c.sampleRand),h=new GA({...n,attributes:{[Bf]:"custom",[BT]:d!==void 0&&f?d:void 0,...l},sampled:u});return!u&&r&&(wt&&lt.log("[Tracing] Discarding root span because its trace was not chosen to be sampled."),r.recordDroppedEvent("sample_rate","transaction")),r&&r.emit("spanStart",h),h}function AX(n,e,t){const{spanId:r,traceId:o}=n.spanContext(),i=e.getScopeData().sdkProcessingMetadata[nI]?!1:kf(n),a=i?new GA({...t,parentSpanId:r,traceId:o,sampled:i}):new FA({traceId:o});WT(n,a);const s=Pn();return s&&(s.emit("spanStart",a),t.endTimestamp&&s.emit("spanEnd",a)),a}function yX(n,e){if(e)return e;if(e===null)return;const t=Hm(n);if(!t)return;const r=Pn();return(r?r.getOptions():{}).parentSpanIsAlwaysRootSpan?rs(t):t}const HA=0,aI=1,sI=2;function os(n){return new Ys(e=>{e(n)})}function Qm(n){return new Ys((e,t)=>{t(n)})}class Ys{constructor(e){this._state=HA,this._handlers=[],this._runExecutor(e)}then(e,t){return new Ys((r,o)=>{this._handlers.push([!1,i=>{if(!e)r(i);else try{r(e(i))}catch(a){o(a)}},i=>{if(!t)o(i);else try{r(t(i))}catch(a){o(a)}}]),this._executeHandlers()})}catch(e){return this.then(t=>t,e)}finally(e){return new Ys((t,r)=>{let o,i;return this.then(a=>{i=!1,o=a,e&&e()},a=>{i=!0,o=a,e&&e()}).then(()=>{if(i){r(o);return}t(o)})})}_executeHandlers(){if(this._state===HA)return;const e=this._handlers.slice();this._handlers=[],e.forEach(t=>{t[0]||(this._state===aI&&t[1](this._value),this._state===sI&&t[2](this._value),t[0]=!0)})}_runExecutor(e){const t=(i,a)=>{if(this._state===HA){if(km(a)){a.then(r,o);return}this._state=i,this._value=a,this._executeHandlers()}},r=i=>{t(aI,i)},o=i=>{t(sI,i)};try{e(r,o)}catch(i){o(i)}}}function WA(n,e,t,r=0){return new Ys((o,i)=>{const a=n[r];if(e===null||typeof a!="function")o(e);else{const s=a({...e},t);wt&&a.id&&s===null&&lt.log(`Event processor "${a.id}" dropped event`),km(s)?s.then(l=>WA(n,l,t,r+1).then(o)).then(null,i):WA(n,s,t,r+1).then(o).then(null,i)}})}function bX(n,e){const{fingerprint:t,span:r,breadcrumbs:o,sdkProcessingMetadata:i}=e;xX(n,e),r&&SX(n,r),wX(n,t),EX(n,o),CX(n,i)}function lI(n,e){const{extra:t,tags:r,user:o,contexts:i,level:a,sdkProcessingMetadata:s,breadcrumbs:l,fingerprint:c,eventProcessors:u,attachments:d,propagationContext:f,transactionName:h,span:p}=e;$m(n,"extra",t),$m(n,"tags",r),$m(n,"user",o),$m(n,"contexts",i),n.sdkProcessingMetadata=Pf(n.sdkProcessingMetadata,s,2),a&&(n.level=a),h&&(n.transactionName=h),p&&(n.span=p),l.length&&(n.breadcrumbs=[...n.breadcrumbs,...l]),c.length&&(n.fingerprint=[...n.fingerprint,...c]),u.length&&(n.eventProcessors=[...n.eventProcessors,...u]),d.length&&(n.attachments=[...n.attachments,...d]),n.propagationContext={...n.propagationContext,...f}}function $m(n,e,t){n[e]=Pf(n[e],t,1)}function xX(n,e){const{extra:t,tags:r,user:o,contexts:i,level:a,transactionName:s}=e;Object.keys(t).length&&(n.extra={...t,...n.extra}),Object.keys(r).length&&(n.tags={...r,...n.tags}),Object.keys(o).length&&(n.user={...o,...n.user}),Object.keys(i).length&&(n.contexts={...i,...n.contexts}),a&&(n.level=a),s&&n.type!=="transaction"&&(n.transaction=s)}function EX(n,e){const t=[...n.breadcrumbs||[],...e];n.breadcrumbs=t.length?t:void 0}function CX(n,e){n.sdkProcessingMetadata={...n.sdkProcessingMetadata,...e}}function SX(n,e){n.contexts={trace:FY(e),...n.contexts},n.sdkProcessingMetadata={dynamicSamplingContext:au(e),...n.sdkProcessingMetadata};const t=rs(e),r=Jo(t).description;r&&!n.transaction&&n.type==="transaction"&&(n.transaction=r)}function wX(n,e){n.fingerprint=n.fingerprint?Array.isArray(n.fingerprint)?n.fingerprint:[n.fingerprint]:[],e&&(n.fingerprint=n.fingerprint.concat(e)),n.fingerprint.length||delete n.fingerprint}let Ym,cI,Xm;function MX(n){const e=hn._sentryDebugIds;if(!e)return{};const t=Object.keys(e);return Xm&&t.length===cI||(cI=t.length,Xm=t.reduce((r,o)=>{Ym||(Ym={});const i=Ym[o];if(i)r[i[0]]=i[1];else{const a=n(o);for(let s=a.length-1;s>=0;s--){const l=a[s],c=l==null?void 0:l.filename,u=e[o];if(c&&u){r[c]=u,Ym[o]=[c,u];break}}}return r},{})),Xm}function uI(n,e,t,r,o,i){const{normalizeDepth:a=3,normalizeMaxBreadth:s=1e3}=n,l={...e,event_id:e.event_id||t.event_id||Ko(),timestamp:e.timestamp||Lf()},c=t.integrations||n.integrations.map(g=>g.name);TX(l,n),LX(l,c),o&&o.emit("applyFrameMetadata",e),e.type===void 0&&IX(l,n.stackParser);const u=DX(r,t.captureContext);t.mechanism&&nu(l,t.mechanism);const d=o?o.getEventProcessors():[],f=SY().getScopeData();if(i){const g=i.getScopeData();lI(f,g)}if(u){const g=u.getScopeData();lI(f,g)}const h=[...t.attachments||[],...f.attachments];h.length&&(t.attachments=h),bX(l,f);const p=[...d,...f.eventProcessors];return WA(p,l,t).then(g=>(g&&RX(g),typeof a=="number"&&a>0?PX(g,a,s):g))}function TX(n,e){const{environment:t,release:r,dist:o,maxValueLength:i=250}=e;n.environment=n.environment||t||OA,!n.release&&r&&(n.release=r),!n.dist&&o&&(n.dist=o);const a=n.request;a!=null&&a.url&&(a.url=Um(a.url,i))}function IX(n,e){var r,o;const t=MX(e);(o=(r=n.exception)==null?void 0:r.values)==null||o.forEach(i=>{var a,s;(s=(a=i.stacktrace)==null?void 0:a.frames)==null||s.forEach(l=>{l.filename&&(l.debug_id=t[l.filename])})})}function RX(n){var r,o;const e={};if((o=(r=n.exception)==null?void 0:r.values)==null||o.forEach(i=>{var a,s;(s=(a=i.stacktrace)==null?void 0:a.frames)==null||s.forEach(l=>{l.debug_id&&(l.abs_path?e[l.abs_path]=l.debug_id:l.filename&&(e[l.filename]=l.debug_id),delete l.debug_id)})}),Object.keys(e).length===0)return;n.debug_meta=n.debug_meta||{},n.debug_meta.images=n.debug_meta.images||[];const t=n.debug_meta.images;Object.entries(e).forEach(([i,a])=>{t.push({type:"sourcemap",code_file:i,debug_id:a})})}function LX(n,e){e.length>0&&(n.sdk=n.sdk||{},n.sdk.integrations=[...n.sdk.integrations||[],...e])}function PX(n,e,t){var o,i;if(!n)return null;const r={...n,...n.breadcrumbs&&{breadcrumbs:n.breadcrumbs.map(a=>({...a,...a.data&&{data:Hi(a.data,e,t)}}))},...n.user&&{user:Hi(n.user,e,t)},...n.contexts&&{contexts:Hi(n.contexts,e,t)},...n.extra&&{extra:Hi(n.extra,e,t)}};return(o=n.contexts)!=null&&o.trace&&r.contexts&&(r.contexts.trace=n.contexts.trace,n.contexts.trace.data&&(r.contexts.trace.data=Hi(n.contexts.trace.data,e,t))),n.spans&&(r.spans=n.spans.map(a=>({...a,...a.data&&{data:Hi(a.data,e,t)}}))),(i=n.contexts)!=null&&i.flags&&r.contexts&&(r.contexts.flags=Hi(n.contexts.flags,3,t)),r}function DX(n,e){if(!e)return n;const t=n?n.clone():new _a;return t.update(e),t}function BX(n){if(n)return NX(n)?{captureContext:n}:kX(n)?{captureContext:n}:n}function NX(n){return n instanceof _a||typeof n=="function"}const OX=["user","level","extra","contexts","tags","fingerprint","propagationContext"];function kX(n){return Object.keys(n).some(e=>OX.includes(e))}function jA(n,e){return Zo().captureException(n,BX(e))}function dI(n,e){return Zo().captureEvent(n,e)}function FX(n,e){ns().setContext(n,e)}function VX(n){ns().addEventProcessor(n)}function fI(n){const e=ns(),t=Zo(),{userAgent:r}=hn.navigator||{},o=mY({user:t.getUser()||e.getUser(),...r&&{userAgent:r},...n}),i=e.getSession();return(i==null?void 0:i.status)==="ok"&&ru(i,{status:"exited"}),hI(),e.setSession(o),o}function hI(){const n=ns(),t=Zo().getSession()||n.getSession();t&&gY(t),pI(),n.setSession()}function pI(){const n=ns(),e=Pn(),t=n.getSession();t&&e&&e.captureSession(t)}function mI(n=!1){if(n){hI();return}pI()}const UX="7";function zX(n){const e=n.protocol?`${n.protocol}:`:"",t=n.port?`:${n.port}`:"";return`${e}//${n.host}${t}${n.path?`/${n.path}`:""}/api/`}function GX(n){return`${zX(n)}${n.projectId}/envelope/`}function HX(n,e){const t={sentry_version:UX};return n.publicKey&&(t.sentry_key=n.publicKey),e&&(t.sentry_client=`${e.name}/${e.version}`),new URLSearchParams(t).toString()}function WX(n,e,t){return e||`${GX(n)}?${HX(n,t)}`}const gI=[];function jX(n){const e={};return n.forEach(t=>{const{name:r}=t,o=e[r];o&&!o.isDefaultInstance&&t.isDefaultInstance||(e[r]=t)}),Object.values(e)}function QX(n){const e=n.defaultIntegrations||[],t=n.integrations;e.forEach(o=>{o.isDefaultInstance=!0});let r;if(Array.isArray(t))r=[...e,...t];else if(typeof t=="function"){const o=t(e);r=Array.isArray(o)?o:[o]}else r=e;return jX(r)}function $X(n,e){const t={};return e.forEach(r=>{r&&vI(n,r,t)}),t}function _I(n,e){for(const t of e)t!=null&&t.afterAllSetup&&t.afterAllSetup(n)}function vI(n,e,t){if(t[e.name]){wt&&lt.log(`Integration skipped because it was already installed: ${e.name}`);return}if(t[e.name]=e,gI.indexOf(e.name)===-1&&typeof e.setupOnce=="function"&&(e.setupOnce(),gI.push(e.name)),e.setup&&typeof e.setup=="function"&&e.setup(n),typeof e.preprocessEvent=="function"){const r=e.preprocessEvent.bind(e);n.on("preprocessEvent",(o,i)=>r(o,i,n))}if(typeof e.processEvent=="function"){const r=e.processEvent.bind(e),o=Object.assign((i,a)=>r(i,a,n),{id:e.name});n.addEventProcessor(o)}wt&&lt.log(`Integration installed: ${e.name}`)}function DEe(n){return n}function YX(n,e,t){const r=[{type:"client_report"},{timestamp:Lf(),discarded_events:n}];return Ql(e?{dsn:e}:{},[r])}function AI(n){const e=[];n.message&&e.push(n.message);try{const t=n.exception.values[n.exception.values.length-1];t!=null&&t.value&&(e.push(t.value),t.type&&e.push(`${t.type}: ${t.value}`))}catch{}return e}function XX(n){var l;const{trace_id:e,parent_span_id:t,span_id:r,status:o,origin:i,data:a,op:s}=((l=n.contexts)==null?void 0:l.trace)??{};return{data:a??{},description:n.transaction,op:s,parent_span_id:t,span_id:r??"",start_timestamp:n.start_timestamp??0,status:o,timestamp:n.timestamp,trace_id:e??"",origin:i,profile_id:a==null?void 0:a[RA],exclusive_time:a==null?void 0:a[LA],measurements:n.measurements,is_segment:!0}}function qX(n){return{type:"transaction",timestamp:n.timestamp,start_timestamp:n.start_timestamp,transaction:n.description,contexts:{trace:{trace_id:n.trace_id,span_id:n.span_id,parent_span_id:n.parent_span_id,op:n.op,status:n.status,origin:n.origin,data:{...n.data,...n.profile_id&&{[RA]:n.profile_id},...n.exclusive_time&&{[LA]:n.exclusive_time}}}},measurements:n.measurements}}const yI="Not capturing exception because it's already been captured.",bI="Discarded session because of missing or non-string release",xI=Symbol.for("SentryInternalError"),EI=Symbol.for("SentryDoNotSendEventError");function qm(n){return{message:n,[xI]:!0}}function QA(n){return{message:n,[EI]:!0}}function CI(n){return!!n&&typeof n=="object"&&xI in n}function SI(n){return!!n&&typeof n=="object"&&EI in n}class KX{constructor(e){if(this._options=e,this._integrations={},this._numProcessing=0,this._outcomes={},this._hooks={},this._eventProcessors=[],e.dsn?this._dsn=YY(e.dsn):wt&&lt.warn("No DSN provided, client will not send events."),this._dsn){const t=WX(this._dsn,e.tunnel,e._metadata?e._metadata.sdk:void 0);this._transport=e.transport({tunnel:this._options.tunnel,recordDroppedEvent:this.recordDroppedEvent.bind(this),...e.transportOptions,url:t})}}captureException(e,t,r){const o=Ko();if(RT(e))return wt&&lt.log(yI),o;const i={event_id:o,...t};return this._process(this.eventFromException(e,i).then(a=>this._captureEvent(a,i,r))),i.event_id}captureMessage(e,t,r,o){const i={event_id:Ko(),...r},a=yA(e)?e:String(e),s=bA(e)?this.eventFromMessage(a,t,i):this.eventFromException(e,i);return this._process(s.then(l=>this._captureEvent(l,i,o))),i.event_id}captureEvent(e,t,r){const o=Ko();if(t!=null&&t.originalException&&RT(t.originalException))return wt&&lt.log(yI),o;const i={event_id:o,...t},a=e.sdkProcessingMetadata||{},s=a.capturedSpanScope,l=a.capturedSpanIsolationScope;return this._process(this._captureEvent(e,i,s||r,l)),i.event_id}captureSession(e){this.sendSession(e),ru(e,{init:!1})}getDsn(){return this._dsn}getOptions(){return this._options}getSdkMetadata(){return this._options._metadata}getTransport(){return this._transport}flush(e){const t=this._transport;return t?(this.emit("flush"),this._isClientDoneProcessing(e).then(r=>t.flush(e).then(o=>r&&o))):os(!0)}close(e){return this.flush(e).then(t=>(this.getOptions().enabled=!1,this.emit("close"),t))}getEventProcessors(){return this._eventProcessors}addEventProcessor(e){this._eventProcessors.push(e)}init(){(this._isEnabled()||this._options.integrations.some(({name:e})=>e.startsWith("Spotlight")))&&this._setupIntegrations()}getIntegrationByName(e){return this._integrations[e]}addIntegration(e){const t=this._integrations[e.name];vI(this,e,this._integrations),t||_I(this,[e])}sendEvent(e,t={}){this.emit("beforeSendEvent",e,t);let r=cX(e,this._dsn,this._options._metadata,this._options.tunnel);for(const i of t.attachments||[])r=tX(r,iX(i));const o=this.sendEnvelope(r);o&&o.then(i=>this.emit("afterSendEvent",e,i),null)}sendSession(e){const{release:t,environment:r=OA}=this._options;if("aggregates"in e){const i=e.attrs||{};if(!i.release&&!t){wt&&lt.warn(bI);return}i.release=i.release||t,i.environment=i.environment||r,e.attrs=i}else{if(!e.release&&!t){wt&&lt.warn(bI);return}e.release=e.release||t,e.environment=e.environment||r}this.emit("beforeSendSession",e);const o=lX(e,this._dsn,this._options._metadata,this._options.tunnel);this.sendEnvelope(o)}recordDroppedEvent(e,t,r=1){if(this._options.sendClientReports){const o=`${e}:${t}`;wt&&lt.log(`Recording outcome: "${o}"${r>1?` (${r} times)`:""}`),this._outcomes[o]=(this._outcomes[o]||0)+r}}on(e,t){const r=this._hooks[e]=this._hooks[e]||[];return r.push(t),()=>{const o=r.indexOf(t);o>-1&&r.splice(o,1)}}emit(e,...t){const r=this._hooks[e];r&&r.forEach(o=>o(...t))}sendEnvelope(e){return this.emit("beforeEnvelope",e),this._isEnabled()&&this._transport?this._transport.send(e).then(null,t=>(wt&&lt.error("Error while sending envelope:",t),t)):(wt&&lt.error("Transport disabled"),os({}))}_setupIntegrations(){const{integrations:e}=this._options;this._integrations=$X(this,e),_I(this,e)}_updateSessionFromEvent(e,t){var l;let r=t.level==="fatal",o=!1;const i=(l=t.exception)==null?void 0:l.values;if(i){o=!0;for(const c of i){const u=c.mechanism;if((u==null?void 0:u.handled)===!1){r=!0;break}}}const a=e.status==="ok";(a&&e.errors===0||a&&r)&&(ru(e,{...r&&{status:"crashed"},errors:e.errors||Number(o||r)}),this.captureSession(e))}_isClientDoneProcessing(e){return new Ys(t=>{let r=0;const o=1,i=setInterval(()=>{this._numProcessing==0?(clearInterval(i),t(!0)):(r+=o,e&&r>=e&&(clearInterval(i),t(!1)))},o)})}_isEnabled(){return this.getOptions().enabled!==!1&&this._transport!==void 0}_prepareEvent(e,t,r,o){const i=this.getOptions(),a=Object.keys(this._integrations);return!t.integrations&&(a!=null&&a.length)&&(t.integrations=a),this.emit("preprocessEvent",e,t),e.type||o.setLastEventId(e.event_id||t.event_id),uI(i,e,t,r,this,o).then(s=>{if(s===null)return s;this.emit("postprocessEvent",s,t),s.contexts={trace:wY(r),...s.contexts};const l=XY(this,r);return s.sdkProcessingMetadata={dynamicSamplingContext:l,...s.sdkProcessingMetadata},s})}_captureEvent(e,t={},r=Zo(),o=ns()){return wt&&$A(e)&&lt.log(`Captured error event \`${AI(e)[0]||"<unknown>"}\``),this._processEvent(e,t,r,o).then(i=>i.event_id,i=>{wt&&(SI(i)?lt.log(i.message):CI(i)?lt.warn(i.message):lt.warn(i))})}_processEvent(e,t,r,o){const i=this.getOptions(),{sampleRate:a}=i,s=wI(e),l=$A(e),c=e.type||"error",u=`before send for type \`${c}\``,d=typeof a>"u"?void 0:Of(a);if(l&&typeof d=="number"&&Math.random()>d)return this.recordDroppedEvent("sample_rate","error"),Qm(QA(`Discarding event because it's not included in the random sample (sampling rate = ${a})`));const f=c==="replay_event"?"replay":c;return this._prepareEvent(e,t,r,o).then(h=>{if(h===null)throw this.recordDroppedEvent("event_processor",f),QA("An event processor returned `null`, will not send event.");if(t.data&&t.data.__sentry__===!0)return h;const m=JX(this,i,h,t);return ZX(m,u)}).then(h=>{var g;if(h===null){if(this.recordDroppedEvent("before_send",f),s){const A=1+(e.spans||[]).length;this.recordDroppedEvent("before_send","span",A)}throw QA(`${u} returned \`null\`, will not send event.`)}const p=r.getSession()||o.getSession();if(l&&p&&this._updateSessionFromEvent(p,h),s){const _=((g=h.sdkProcessingMetadata)==null?void 0:g.spanCountBeforeProcessing)||0,A=h.spans?h.spans.length:0,y=_-A;y>0&&this.recordDroppedEvent("before_send","span",y)}const m=h.transaction_info;if(s&&m&&h.transaction!==e.transaction){const _="custom";h.transaction_info={...m,source:_}}return this.sendEvent(h,t),h}).then(null,h=>{throw SI(h)||CI(h)?h:(this.captureException(h,{data:{__sentry__:!0},originalException:h}),qm(`Event processing pipeline threw an error, original event will not be sent. Details have been sent as a new event.
Reason: ${h}`))})}_process(e){this._numProcessing++,e.then(t=>(this._numProcessing--,t),t=>(this._numProcessing--,t))}_clearOutcomes(){const e=this._outcomes;return this._outcomes={},Object.entries(e).map(([t,r])=>{const[o,i]=t.split(":");return{reason:o,category:i,quantity:r}})}_flushOutcomes(){wt&&lt.log("Flushing outcomes...");const e=this._clearOutcomes();if(e.length===0){wt&&lt.log("No outcomes to send");return}if(!this._dsn){wt&&lt.log("No dsn provided, will not send outcomes");return}wt&&lt.log("Sending outcomes:",e);const t=YX(e,this._options.tunnel&&Vf(this._dsn));this.sendEnvelope(t)}}function ZX(n,e){const t=`${e} must return \`null\` or a valid event.`;if(km(n))return n.then(r=>{if(!If(r)&&r!==null)throw qm(t);return r},r=>{throw qm(`${e} rejected with ${r}`)});if(!If(n)&&n!==null)throw qm(t);return n}function JX(n,e,t,r){const{beforeSend:o,beforeSendTransaction:i,beforeSendSpan:a}=e;let s=t;if($A(s)&&o)return o(s,r);if(wI(s)){if(a){const l=a(XX(s));if(l?s=Pf(t,qX(l)):NA(),s.spans){const c=[];for(const u of s.spans){const d=a(u);d?c.push(d):(NA(),c.push(u))}s.spans=c}}if(i){if(s.spans){const l=s.spans.length;s.sdkProcessingMetadata={...t.sdkProcessingMetadata,spanCountBeforeProcessing:l}}return i(s,r)}}return s}function $A(n){return n.type===void 0}function wI(n){return n.type==="transaction"}function eq(n){return[{type:"log",item_count:n.length,content_type:"application/vnd.sentry.items.log+json"},{items:n}]}function tq(n,e,t,r){const o={};return e!=null&&e.sdk&&(o.sdk={name:e.sdk.name,version:e.sdk.version}),t&&r&&(o.dsn=Vf(r)),Ql(o,[eq(n)])}function YA(n,e){const t=nq(n)??[];if(t.length===0)return;const r=n.getOptions(),o=tq(t,r._metadata,r.tunnel,n.getDsn());MI().set(n,[]),n.emit("flushLogs"),n.sendEnvelope(o)}function nq(n){return MI().get(n)}function MI(){return Tf("clientToLogBufferMap",()=>new WeakMap)}function rq(n,e){e.debug===!0&&(wt?lt.enable():Ja(()=>{console.warn("[Sentry] Cannot initialize SDK with `debug` option using a non-debug bundle.")})),Zo().update(e.initialScope);const r=new n(e);return oq(r),r.init(),r}function oq(n){Zo().setClient(n)}const TI=Symbol.for("SentryBufferFullError");function iq(n){const e=[];function t(){return n===void 0||e.length<n}function r(a){return e.splice(e.indexOf(a),1)[0]||Promise.resolve(void 0)}function o(a){if(!t())return Qm(TI);const s=a();return e.indexOf(s)===-1&&e.push(s),s.then(()=>r(s)).then(null,()=>r(s).then(null,()=>{})),s}function i(a){return new Ys((s,l)=>{let c=e.length;if(!c)return s(!0);const u=setTimeout(()=>{a&&a>0&&s(!1)},a);e.forEach(d=>{os(d).then(()=>{--c||(clearTimeout(u),s(!0))},l)})})}return{$:e,add:o,drain:i}}const aq=60*1e3;function sq(n,e=Date.now()){const t=parseInt(`${n}`,10);if(!isNaN(t))return t*1e3;const r=Date.parse(`${n}`);return isNaN(r)?aq:r-e}function lq(n,e){return n[e]||n.all||0}function II(n,e,t=Date.now()){return lq(n,e)>t}function RI(n,{statusCode:e,headers:t},r=Date.now()){const o={...n},i=t==null?void 0:t["x-sentry-rate-limits"],a=t==null?void 0:t["retry-after"];if(i)for(const s of i.trim().split(",")){const[l,c,,,u]=s.split(":",5),d=parseInt(l,10),f=(isNaN(d)?60:d)*1e3;if(!c)o.all=r+f;else for(const h of c.split(";"))h==="metric_bucket"?(!u||u.split(";").includes("custom"))&&(o[h]=r+f):o[h]=r+f}else a?o.all=r+sq(a,r):e===429&&(o.all=r+60*1e3);return o}const cq=64;function uq(n,e,t=iq(n.bufferSize||cq)){let r={};const o=a=>t.drain(a);function i(a){const s=[];if(XT(a,(d,f)=>{const h=qT(f);II(r,h)?n.recordDroppedEvent("ratelimit_backoff",h):s.push(d)}),s.length===0)return os({});const l=Ql(a[0],s),c=d=>{XT(l,(f,h)=>{n.recordDroppedEvent(d,qT(h))})},u=()=>e({body:nX(l)}).then(d=>(d.statusCode!==void 0&&(d.statusCode<200||d.statusCode>=300)&&wt&&lt.warn(`Sentry responded with status code ${d.statusCode} to sent event.`),r=RI(r,d),d),d=>{throw c("network_error"),wt&&lt.error("Encountered error running transport request:",d),d});return t.add(u).then(d=>d,d=>{if(d===TI)return wt&&lt.error("Skipped sending event because buffer is full."),c("queue_overflow"),os({});throw d})}return{send:i,flush:o}}function dq(n,e){const t=e==null?void 0:e.getDsn(),r=e==null?void 0:e.getOptions().tunnel;return hq(n,t)||fq(n,r)}function fq(n,e){return e?LI(n)===LI(e):!1}function hq(n,e){return e?n.includes(e.host):!1}function LI(n){return n[n.length-1]==="/"?n.slice(0,-1):n}function pq(n){var e;((e=n.user)==null?void 0:e.ip_address)===void 0&&(n.user={...n.user,ip_address:"{{auto}}"})}function mq(n){var e;"aggregates"in n?((e=n.attrs)==null?void 0:e.ip_address)===void 0&&(n.attrs={...n.attrs,ip_address:"{{auto}}"}):n.ipAddress===void 0&&(n.ipAddress="{{auto}}")}function PI(n,e,t=[e],r="npm"){const o=n._metadata||{};o.sdk||(o.sdk={name:`sentry.javascript.${e}`,packages:t.map(i=>({name:`${r}:@sentry/${i}`,version:zl})),version:zl}),n._metadata=o}function gq(n,e,t){let r,o,i;const a=t!=null&&t.maxWait?Math.max(t.maxWait,e):0,s=(t==null?void 0:t.setTimeoutImpl)||setTimeout;function l(){return c(),r=n(),r}function c(){o!==void 0&&clearTimeout(o),i!==void 0&&clearTimeout(i),o=i=void 0}function u(){return o!==void 0||i!==void 0?l():r}function d(){return o&&clearTimeout(o),o=s(l,e),a&&i===void 0&&(i=s(l,a)),r}return d.cancel=c,d.flush=u,d}const _q=100;function Xs(n,e){const t=Pn(),r=ns();if(!t)return;const{beforeBreadcrumb:o=null,maxBreadcrumbs:i=_q}=t.getOptions();if(i<=0)return;const s={timestamp:Lf(),...n},l=o?Ja(()=>o(s,e)):s;l!==null&&(t.emit&&t.emit("beforeAddBreadcrumb",l,e),r.addBreadcrumb(l,i))}let DI;const vq="FunctionToString",BI=new WeakMap,Aq=(()=>({name:vq,setupOnce(){DI=Function.prototype.toString;try{Function.prototype.toString=function(...n){const e=EA(this),t=BI.has(Pn())&&e!==void 0?e:this;return DI.apply(t,n)}}catch{}},setup(n){BI.set(n,!0)}})),yq=[/^Script error\.?$/,/^Javascript error: Script error\.? on line 0$/,/^ResizeObserver loop completed with undelivered notifications.$/,/^Cannot redefine property: googletag$/,/^Can't find variable: gmo$/,/^undefined is not an object \(evaluating 'a\.[A-Z]'\)$/,`can't redefine non-configurable property "solana"`,"vv().getRestrictions is not a function. (In 'vv().getRestrictions(1,a)', 'vv().getRestrictions' is undefined)","Can't find variable: _AutofillCallbackHandler",/^Non-Error promise rejection captured with value: Object Not Found Matching Id:\d+, MethodName:simulateEvent, ParamCount:\d+$/,/^Java exception was raised during method invocation$/],bq="EventFilters",xq=(n={})=>{let e;return{name:bq,setup(t){const r=t.getOptions();e=NI(n,r)},processEvent(t,r,o){if(!e){const i=o.getOptions();e=NI(n,i)}return Cq(t,e)?null:t}}},Eq=((n={})=>({...xq(n),name:"InboundFilters"}));function NI(n={},e={}){return{allowUrls:[...n.allowUrls||[],...e.allowUrls||[]],denyUrls:[...n.denyUrls||[],...e.denyUrls||[]],ignoreErrors:[...n.ignoreErrors||[],...e.ignoreErrors||[],...n.disableErrorDefaults?[]:yq],ignoreTransactions:[...n.ignoreTransactions||[],...e.ignoreTransactions||[]]}}function Cq(n,e){if(n.type){if(n.type==="transaction"&&wq(n,e.ignoreTransactions))return wt&&lt.warn(`Event dropped due to being matched by \`ignoreTransactions\` option.
Event: ${jl(n)}`),!0}else{if(Sq(n,e.ignoreErrors))return wt&&lt.warn(`Event dropped due to being matched by \`ignoreErrors\` option.
Event: ${jl(n)}`),!0;if(Rq(n))return wt&&lt.warn(`Event dropped due to not having an error message, error type or stacktrace.
Event: ${jl(n)}`),!0;if(Mq(n,e.denyUrls))return wt&&lt.warn(`Event dropped due to being matched by \`denyUrls\` option.
Event: ${jl(n)}.
Url: ${Km(n)}`),!0;if(!Tq(n,e.allowUrls))return wt&&lt.warn(`Event dropped due to not being matched by \`allowUrls\` option.
Event: ${jl(n)}.
Url: ${Km(n)}`),!0}return!1}function Sq(n,e){return e!=null&&e.length?AI(n).some(t=>Rf(t,e)):!1}function wq(n,e){if(!(e!=null&&e.length))return!1;const t=n.transaction;return t?Rf(t,e):!1}function Mq(n,e){if(!(e!=null&&e.length))return!1;const t=Km(n);return t?Rf(t,e):!1}function Tq(n,e){if(!(e!=null&&e.length))return!0;const t=Km(n);return t?Rf(t,e):!0}function Iq(n=[]){for(let e=n.length-1;e>=0;e--){const t=n[e];if(t&&t.filename!=="<anonymous>"&&t.filename!=="[native code]")return t.filename||null}return null}function Km(n){var e,t;try{const r=[...((e=n.exception)==null?void 0:e.values)??[]].reverse().find(i=>{var a,s,l;return((a=i.mechanism)==null?void 0:a.parent_id)===void 0&&((l=(s=i.stacktrace)==null?void 0:s.frames)==null?void 0:l.length)}),o=(t=r==null?void 0:r.stacktrace)==null?void 0:t.frames;return o?Iq(o):null}catch{return wt&&lt.error(`Cannot extract url for event ${jl(n)}`),null}}function Rq(n){var e,t;return(t=(e=n.exception)==null?void 0:e.values)!=null&&t.length?!n.message&&!n.exception.values.some(r=>r.stacktrace||r.type&&r.type!=="Error"||r.value):!1}function Lq(n,e,t,r,o,i){var s;if(!((s=o.exception)!=null&&s.values)||!i||!$s(i.originalException,Error))return;const a=o.exception.values.length>0?o.exception.values[o.exception.values.length-1]:void 0;a&&(o.exception.values=XA(n,e,r,i.originalException,t,o.exception.values,a,0))}function XA(n,e,t,r,o,i,a,s){if(i.length>=t+1)return i;let l=[...i];if($s(r[o],Error)){OI(a,s);const c=n(e,r[o]),u=l.length;kI(c,o,u,s),l=XA(n,e,t,r[o],o,[c,...l],c,u)}return Array.isArray(r.errors)&&r.errors.forEach((c,u)=>{if($s(c,Error)){OI(a,s);const d=n(e,c),f=l.length;kI(d,`errors[${u}]`,f,s),l=XA(n,e,t,c,o,[d,...l],d,f)}}),l}function OI(n,e){n.mechanism=n.mechanism||{type:"generic",handled:!0},n.mechanism={...n.mechanism,...n.type==="AggregateError"&&{is_exception_group:!0},exception_id:e}}function kI(n,e,t,r){n.mechanism=n.mechanism||{type:"generic",handled:!0},n.mechanism={...n.mechanism,type:"chained",source:e,exception_id:t,parent_id:r}}function Pq(n){const e="console";Hl(e,n),Wl(e,Dq)}function Dq(){"console"in hn&&z$.forEach(function(n){n in hn.console&&Oo(hn.console,n,function(e){return Dm[n]=e,function(...t){Gi("console",{args:t,level:n});const o=Dm[n];o==null||o.apply(hn.console,t)}})})}function FI(n){return n==="warn"?"warning":["fatal","error","warning","log","info","debug"].includes(n)?n:"log"}const Bq="Dedupe",Nq=(()=>{let n;return{name:Bq,processEvent(e){if(e.type)return e;try{if(Oq(e,n))return wt&&lt.warn("Event dropped due to being a duplicate of previously captured event."),null}catch{}return n=e}}});function Oq(n,e){return e?!!(kq(n,e)||Fq(n,e)):!1}function kq(n,e){const t=n.message,r=e.message;return!(!t&&!r||t&&!r||!t&&r||t!==r||!UI(n,e)||!VI(n,e))}function Fq(n,e){const t=zI(e),r=zI(n);return!(!t||!r||t.type!==r.type||t.value!==r.value||!UI(n,e)||!VI(n,e))}function VI(n,e){let t=vT(n),r=vT(e);if(!t&&!r)return!0;if(t&&!r||!t&&r||(t=t,r=r,r.length!==t.length))return!1;for(let o=0;o<r.length;o++){const i=r[o],a=t[o];if(i.filename!==a.filename||i.lineno!==a.lineno||i.colno!==a.colno||i.function!==a.function)return!1}return!0}function UI(n,e){let t=n.fingerprint,r=e.fingerprint;if(!t&&!r)return!0;if(t&&!r||!t&&r)return!1;t=t,r=r;try{return t.join("")===r.join("")}catch{return!1}}function zI(n){var e,t;return(t=(e=n.exception)==null?void 0:e.values)==null?void 0:t[0]}function qA(n){if(!n)return{};const e=n.match(/^(([^:/?#]+):)?(\/\/([^/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?$/);if(!e)return{};const t=e[6]||"",r=e[8]||"";return{host:e[4],path:e[5],protocol:e[2],search:t,hash:r,relative:e[5]+t+r}}function GI(n){if(n!==void 0)return n>=400&&n<500?"warning":n>=500?"error":void 0}const Uf=hn;function Vq(){return"history"in Uf&&!!Uf.history}function Uq(){if(!("fetch"in Uf))return!1;try{return new Headers,new Request("http://www.example.com"),new Response,!0}catch{return!1}}function KA(n){return n&&/^function\s+\w+\(\)\s+\{\s+\[native code\]\s+\}$/.test(n.toString())}function zq(){var t;if(typeof EdgeRuntime=="string")return!0;if(!Uq())return!1;if(KA(Uf.fetch))return!0;let n=!1;const e=Uf.document;if(e&&typeof e.createElement=="function")try{const r=e.createElement("iframe");r.hidden=!0,e.head.appendChild(r),(t=r.contentWindow)!=null&&t.fetch&&(n=KA(r.contentWindow.fetch)),e.head.removeChild(r)}catch(r){wt&&lt.warn("Could not create sandbox iframe for pure fetch check, bailing to window.fetch: ",r)}return n}function Gq(n,e){const t="fetch";Hl(t,n),Wl(t,()=>Hq(void 0,e))}function Hq(n,e=!1){e&&!zq()||Oo(hn,"fetch",function(t){return function(...r){const o=new Error,{method:i,url:a}=Wq(r),s={args:r,fetchData:{method:i,url:a},startTimestamp:ko()*1e3,virtualError:o,headers:jq(r)};return Gi("fetch",{...s}),t.apply(hn,r).then(async l=>(Gi("fetch",{...s,endTimestamp:ko()*1e3,response:l}),l),l=>{if(Gi("fetch",{...s,endTimestamp:ko()*1e3,error:l}),AA(l)&&l.stack===void 0&&(l.stack=o.stack,Ai(l,"framesToPop",1)),l instanceof TypeError&&(l.message==="Failed to fetch"||l.message==="Load failed"||l.message==="NetworkError when attempting to fetch resource."))try{const c=new URL(s.fetchData.url);l.message=`${l.message} (${c.host})`}catch{}throw l})}})}function ZA(n,e){return!!n&&typeof n=="object"&&!!n[e]}function HI(n){return typeof n=="string"?n:n?ZA(n,"url")?n.url:n.toString?n.toString():"":""}function Wq(n){if(n.length===0)return{method:"GET",url:""};if(n.length===2){const[t,r]=n;return{url:HI(t),method:ZA(r,"method")?String(r.method).toUpperCase():"GET"}}const e=n[0];return{url:HI(e),method:ZA(e,"method")?String(e.method).toUpperCase():"GET"}}function jq(n){const[e,t]=n;try{if(typeof t=="object"&&t!==null&&"headers"in t&&t.headers)return new Headers(t.headers);if(oY(e))return new Headers(e.headers)}catch{}}function Qq(){return typeof __SENTRY_BROWSER_BUNDLE__<"u"&&!!__SENTRY_BROWSER_BUNDLE__}function $q(){return"npm"}function Yq(){return!Qq()&&Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]"}function WI(){return typeof window<"u"&&(!Yq()||Xq())}function Xq(){const n=hn.process;return(n==null?void 0:n.type)==="renderer"}const sr=hn;let JA=0;function jI(){return JA>0}function qq(){JA++,setTimeout(()=>{JA--})}function su(n,e={}){function t(o){return typeof o=="function"}if(!t(n))return n;try{const o=n.__sentry_wrapped__;if(o)return typeof o=="function"?o:n;if(EA(n))return n}catch{return n}const r=function(...o){try{const i=o.map(a=>su(a,e));return n.apply(this,i)}catch(i){throw qq(),TA(a=>{a.addEventProcessor(s=>(e.mechanism&&(CA(s,void 0),nu(s,e.mechanism)),s.extra={...s.extra,arguments:o},s)),jA(i)}),i}};try{for(const o in n)Object.prototype.hasOwnProperty.call(n,o)&&(r[o]=n[o])}catch{}ST(r,n),Ai(n,"__sentry_wrapped__",r);try{Object.getOwnPropertyDescriptor(r,"name").configurable&&Object.defineProperty(r,"name",{get(){return n.name}})}catch{}return r}function Kq(){const n=Vm(),{referrer:e}=sr.document||{},{userAgent:t}=sr.navigator||{},r={...e&&{Referer:e},...t&&{"User-Agent":t}};return{url:n,headers:r}}function ey(n,e){const t=ny(n,e),r={type:nK(e),value:rK(e)};return t.length&&(r.stacktrace={frames:t}),r.type===void 0&&r.value===""&&(r.value="Unrecoverable error caught"),r}function Zq(n,e,t,r){const o=Pn(),i=o==null?void 0:o.getOptions().normalizeDepth,a=lK(e),s={__serialized__:YT(e,i)};if(a)return{exception:{values:[ey(n,a)]},extra:s};const l={exception:{values:[{type:Om(e)?e.constructor.name:r?"UnhandledRejection":"Error",value:aK(e,{isUnhandledRejection:r})}]},extra:s};if(t){const c=ny(n,t);c.length&&(l.exception.values[0].stacktrace={frames:c})}return l}function ty(n,e){return{exception:{values:[ey(n,e)]}}}function ny(n,e){const t=e.stacktrace||e.stack||"",r=eK(e),o=tK(e);try{return n(t,r,o)}catch{}return[]}const Jq=/Minified React error #\d+;/i;function eK(n){return n&&Jq.test(n.message)?1:0}function tK(n){return typeof n.framesToPop=="number"?n.framesToPop:0}function QI(n){return typeof WebAssembly<"u"&&typeof WebAssembly.Exception<"u"?n instanceof WebAssembly.Exception:!1}function nK(n){const e=n==null?void 0:n.name;return!e&&QI(n)?n.message&&Array.isArray(n.message)&&n.message.length==2?n.message[0]:"WebAssembly.Exception":e}function rK(n){const e=n==null?void 0:n.message;return QI(n)?Array.isArray(n.message)&&n.message.length==2?n.message[1]:"wasm exception":e?e.error&&typeof e.error.message=="string"?e.error.message:e:"No error message"}function oK(n,e,t,r){const o=(t==null?void 0:t.syntheticException)||void 0,i=ry(n,e,o,r);return nu(i),i.level="error",t!=null&&t.event_id&&(i.event_id=t.event_id),os(i)}function iK(n,e,t="info",r,o){const i=(r==null?void 0:r.syntheticException)||void 0,a=oy(n,e,i,o);return a.level=t,r!=null&&r.event_id&&(a.event_id=r.event_id),os(a)}function ry(n,e,t,r,o){let i;if(bT(e)&&e.error)return ty(n,e.error);if(xT(e)||eY(e)){const a=e;if("stack"in e)i=ty(n,e);else{const s=a.name||(xT(a)?"DOMError":"DOMException"),l=a.message?`${s}: ${a.message}`:s;i=oy(n,l,t,r),CA(i,l)}return"code"in a&&(i.tags={...i.tags,"DOMException.code":`${a.code}`}),i}return AA(e)?ty(n,e):If(e)||Om(e)?(i=Zq(n,e,t,o),nu(i,{synthetic:!0}),i):(i=oy(n,e,t,r),CA(i,`${e}`),nu(i,{synthetic:!0}),i)}function oy(n,e,t,r){const o={};if(r&&t){const i=ny(n,t);i.length&&(o.exception={values:[{value:e,stacktrace:{frames:i}}]}),nu(o,{synthetic:!0})}if(yA(e)){const{__sentry_template_string__:i,__sentry_template_values__:a}=e;return o.logentry={message:i,params:a},o}return o.message=e,o}function aK(n,{isUnhandledRejection:e}){const t=cY(n),r=e?"promise rejection":"exception";return bT(n)?`Event \`ErrorEvent\` captured as ${r} with message \`${n.message}\``:Om(n)?`Event \`${sK(n)}\` (type=${n.type}) captured as ${r}`:`Object captured as ${r} with keys: ${t}`}function sK(n){try{const e=Object.getPrototypeOf(n);return e?e.constructor.name:void 0}catch{}}function lK(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e)){const t=n[e];if(t instanceof Error)return t}}const cK=5e3;class uK extends KX{constructor(e){const t=dK(e),r=sr.SENTRY_SDK_SOURCE||$q();PI(t,"browser",["browser"],r),super(t);const{sendDefaultPii:o,sendClientReports:i,enableLogs:a,_experiments:s}=this._options,l=a??(s==null?void 0:s.enableLogs);sr.document&&(i||l)&&sr.document.addEventListener("visibilitychange",()=>{sr.document.visibilityState==="hidden"&&(i&&this._flushOutcomes(),l&&YA(this))}),l&&(this.on("flush",()=>{YA(this)}),this.on("afterCaptureLog",()=>{this._logFlushIdleTimeout&&clearTimeout(this._logFlushIdleTimeout),this._logFlushIdleTimeout=setTimeout(()=>{YA(this)},cK)})),o&&(this.on("postprocessEvent",pq),this.on("beforeSendSession",mq))}eventFromException(e,t){return oK(this._options.stackParser,e,t,this._options.attachStacktrace)}eventFromMessage(e,t="info",r){return iK(this._options.stackParser,e,t,r,this._options.attachStacktrace)}_prepareEvent(e,t,r,o){return e.platform=e.platform||"javascript",super._prepareEvent(e,t,r,o)}}function dK(n){var e;return{release:typeof __SENTRY_RELEASE__=="string"?__SENTRY_RELEASE__:(e=sr.SENTRY_RELEASE)==null?void 0:e.id,sendClientReports:!0,parentSpanIsAlwaysRootSpan:!0,...n}}const Zm=typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__,qt=hn,fK=(n,e)=>n>e[1]?"poor":n>e[0]?"needs-improvement":"good",zf=(n,e,t,r)=>{let o,i;return a=>{e.value>=0&&(a||r)&&(i=e.value-(o??0),(i||o===void 0)&&(o=e.value,e.delta=i,e.rating=fK(e.value,t),n(e)))}},hK=()=>`v5-${Date.now()}-${Math.floor(Math.random()*(9e12-1))+1e12}`,$I=(n=!0)=>{var t,r;const e=(r=(t=qt.performance)==null?void 0:t.getEntriesByType)==null?void 0:r.call(t,"navigation")[0];if(!n||e&&e.responseStart>0&&e.responseStart<performance.now())return e},Jm=()=>{const n=$I();return(n==null?void 0:n.activationStart)??0},Gf=(n,e=-1)=>{var i,a;const t=$I();let r="navigate";return t&&((i=qt.document)!=null&&i.prerendering||Jm()>0?r="prerender":(a=qt.document)!=null&&a.wasDiscarded?r="restore":t.type&&(r=t.type.replace(/_/g,"-"))),{name:n,value:e,rating:"good",delta:0,entries:[],id:hK(),navigationType:r}},iy=new WeakMap;function ay(n,e){return iy.get(n)||iy.set(n,new e),iy.get(n)}class eg{constructor(){eg.prototype.__init.call(this),eg.prototype.__init2.call(this)}__init(){this._sessionValue=0}__init2(){this._sessionEntries=[]}_processEntry(e){var o;if(e.hadRecentInput)return;const t=this._sessionEntries[0],r=this._sessionEntries[this._sessionEntries.length-1];this._sessionValue&&t&&r&&e.startTime-r.startTime<1e3&&e.startTime-t.startTime<5e3?(this._sessionValue+=e.value,this._sessionEntries.push(e)):(this._sessionValue=e.value,this._sessionEntries=[e]),(o=this._onAfterProcessingUnexpectedShift)==null||o.call(this,e)}}const $l=(n,e,t={})=>{try{if(PerformanceObserver.supportedEntryTypes.includes(n)){const r=new PerformanceObserver(o=>{Promise.resolve().then(()=>{e(o.getEntries())})});return r.observe({type:n,buffered:!0,...t}),r}}catch{}},tg=n=>{let e=!1;return()=>{e||(n(),e=!0)}};let Hf=-1;const pK=()=>{var n,e;return((n=qt.document)==null?void 0:n.visibilityState)==="hidden"&&!((e=qt.document)!=null&&e.prerendering)?0:1/0},ng=n=>{qt.document.visibilityState==="hidden"&&Hf>-1&&(Hf=n.type==="visibilitychange"?n.timeStamp:0,gK())},mK=()=>{addEventListener("visibilitychange",ng,!0),addEventListener("prerenderingchange",ng,!0)},gK=()=>{removeEventListener("visibilitychange",ng,!0),removeEventListener("prerenderingchange",ng,!0)},sy=()=>{var n;if(qt.document&&Hf<0){const e=Jm();Hf=(qt.document.prerendering||(n=globalThis.performance.getEntriesByType("visibility-state").filter(r=>r.name==="hidden"&&r.startTime>e)[0])==null?void 0:n.startTime)??pK(),mK()}return{get firstHiddenTime(){return Hf}}},rg=n=>{var e;(e=qt.document)!=null&&e.prerendering?addEventListener("prerenderingchange",()=>n(),!0):n()},_K=[1800,3e3],vK=(n,e={})=>{rg(()=>{const t=sy(),r=Gf("FCP");let o;const a=$l("paint",s=>{for(const l of s)l.name==="first-contentful-paint"&&(a.disconnect(),l.startTime<t.firstHiddenTime&&(r.value=Math.max(l.startTime-Jm(),0),r.entries.push(l),o(!0)))});a&&(o=zf(n,r,_K,e.reportAllChanges))})},AK=[.1,.25],yK=(n,e={})=>{vK(tg(()=>{var s,l;const t=Gf("CLS",0);let r;const o=ay(e,eg),i=c=>{for(const u of c)o._processEntry(u);o._sessionValue>t.value&&(t.value=o._sessionValue,t.entries=o._sessionEntries,r())},a=$l("layout-shift",i);a&&(r=zf(n,t,AK,e.reportAllChanges),(s=qt.document)==null||s.addEventListener("visibilitychange",()=>{var c;((c=qt.document)==null?void 0:c.visibilityState)==="hidden"&&(i(a.takeRecords()),r(!0))}),(l=qt==null?void 0:qt.setTimeout)==null||l.call(qt,r))}))},ly=n=>{const e=t=>{var r;(t.type==="pagehide"||((r=qt.document)==null?void 0:r.visibilityState)==="hidden")&&n(t)};qt.document&&(addEventListener("visibilitychange",e,!0),addEventListener("pagehide",e,!0))},bK=[100,300],xK=(n,e={})=>{rg(()=>{const t=sy(),r=Gf("FID");let o;const i=l=>{l.startTime<t.firstHiddenTime&&(r.value=l.processingStart-l.startTime,r.entries.push(l),o(!0))},a=l=>{l.forEach(i)},s=$l("first-input",a);o=zf(n,r,bK,e.reportAllChanges),s&&ly(tg(()=>{a(s.takeRecords()),s.disconnect()}))})};let YI=0,cy=1/0,og=0;const EK=n=>{n.forEach(e=>{e.interactionId&&(cy=Math.min(cy,e.interactionId),og=Math.max(og,e.interactionId),YI=og?(og-cy)/7+1:0)})};let uy;const XI=()=>uy?YI:performance.interactionCount||0,CK=()=>{"interactionCount"in performance||uy||(uy=$l("event",EK,{type:"event",buffered:!0,durationThreshold:0}))},dy=10;let qI=0;const SK=()=>XI()-qI;class ig{constructor(){ig.prototype.__init.call(this),ig.prototype.__init2.call(this)}__init(){this._longestInteractionList=[]}__init2(){this._longestInteractionMap=new Map}_resetInteractions(){qI=XI(),this._longestInteractionList.length=0,this._longestInteractionMap.clear()}_estimateP98LongestInteraction(){const e=Math.min(this._longestInteractionList.length-1,Math.floor(SK()/50));return this._longestInteractionList[e]}_processEntry(e){var o,i;if((o=this._onBeforeProcessingEntry)==null||o.call(this,e),!(e.interactionId||e.entryType==="first-input"))return;const t=this._longestInteractionList.at(-1);let r=this._longestInteractionMap.get(e.interactionId);if(r||this._longestInteractionList.length<dy||e.duration>t._latency){if(r?e.duration>r._latency?(r.entries=[e],r._latency=e.duration):e.duration===r._latency&&e.startTime===r.entries[0].startTime&&r.entries.push(e):(r={id:e.interactionId,entries:[e],_latency:e.duration},this._longestInteractionMap.set(r.id,r),this._longestInteractionList.push(r)),this._longestInteractionList.sort((a,s)=>s._latency-a._latency),this._longestInteractionList.length>dy){const a=this._longestInteractionList.splice(dy);for(const s of a)this._longestInteractionMap.delete(s.id)}(i=this._onAfterProcessingINPCandidate)==null||i.call(this,r)}}}const KI=n=>{var t;const e=qt.requestIdleCallback||qt.setTimeout;((t=qt.document)==null?void 0:t.visibilityState)==="hidden"?n():(n=tg(n),e(n),ly(n))},wK=[200,500],MK=40,TK=(n,e={})=>{globalThis.PerformanceEventTiming&&"interactionId"in PerformanceEventTiming.prototype&&rg(()=>{CK();const t=Gf("INP");let r;const o=ay(e,ig),i=s=>{KI(()=>{for(const c of s)o._processEntry(c);const l=o._estimateP98LongestInteraction();l&&l._latency!==t.value&&(t.value=l._latency,t.entries=l.entries,r())})},a=$l("event",i,{durationThreshold:e.durationThreshold??MK});r=zf(n,t,wK,e.reportAllChanges),a&&(a.observe({type:"first-input",buffered:!0}),ly(()=>{i(a.takeRecords()),r(!0)}))})};class IK{_processEntry(e){var t;(t=this._onBeforeProcessingEntry)==null||t.call(this,e)}}const RK=[2500,4e3],LK=(n,e={})=>{rg(()=>{const t=sy(),r=Gf("LCP");let o;const i=ay(e,IK),a=l=>{e.reportAllChanges||(l=l.slice(-1));for(const c of l)i._processEntry(c),c.startTime<t.firstHiddenTime&&(r.value=Math.max(c.startTime-Jm(),0),r.entries=[c],o())},s=$l("largest-contentful-paint",a);if(s){o=zf(n,r,RK,e.reportAllChanges);const l=tg(()=>{a(s.takeRecords()),s.disconnect(),o(!0)});for(const c of["keydown","click","visibilitychange"])qt.document&&addEventListener(c,()=>KI(l),{capture:!0,once:!0})}})},Wf={},ag={};let ZI,JI,e4,t4;function PK(n,e=!1){return sg("cls",n,kK,ZI,e)}function DK(n,e=!1){return sg("lcp",n,VK,e4,e)}function BK(n){return sg("fid",n,FK,JI)}function NK(n){return sg("inp",n,UK,t4)}function OK(n,e){return n4(n,e),ag[n]||(zK(n),ag[n]=!0),r4(n,e)}function jf(n,e){const t=Wf[n];if(t!=null&&t.length)for(const r of t)try{r(e)}catch(o){Zm&&lt.error(`Error while triggering instrumentation handler.
Type: ${n}
Name: ${es(r)}
Error:`,o)}}function kK(){return yK(n=>{jf("cls",{metric:n}),ZI=n},{reportAllChanges:!0})}function FK(){return xK(n=>{jf("fid",{metric:n}),JI=n})}function VK(){return LK(n=>{jf("lcp",{metric:n}),e4=n},{reportAllChanges:!0})}function UK(){return TK(n=>{jf("inp",{metric:n}),t4=n})}function sg(n,e,t,r,o=!1){n4(n,e);let i;return ag[n]||(i=t(),ag[n]=!0),r&&e({metric:r}),r4(n,e,o?i:void 0)}function zK(n){const e={};n==="event"&&(e.durationThreshold=0),$l(n,t=>{jf(n,{entries:t})},e)}function n4(n,e){Wf[n]=Wf[n]||[],Wf[n].push(e)}function r4(n,e,t){return()=>{t&&t();const r=Wf[n];if(!r)return;const o=r.indexOf(e);o!==-1&&r.splice(o,1)}}const GK=1e3;let o4,fy,hy;function i4(n){Hl("dom",n),Wl("dom",HK)}function HK(){if(!qt.document)return;const n=Gi.bind(null,"dom"),e=a4(n,!0);qt.document.addEventListener("click",e,!1),qt.document.addEventListener("keypress",e,!1),["EventTarget","Node"].forEach(t=>{var i,a;const o=(i=qt[t])==null?void 0:i.prototype;(a=o==null?void 0:o.hasOwnProperty)!=null&&a.call(o,"addEventListener")&&(Oo(o,"addEventListener",function(s){return function(l,c,u){if(l==="click"||l=="keypress")try{const d=this.__sentry_instrumentation_handlers__=this.__sentry_instrumentation_handlers__||{},f=d[l]=d[l]||{refCount:0};if(!f.handler){const h=a4(n);f.handler=h,s.call(this,l,h,u)}f.refCount++}catch{}return s.call(this,l,c,u)}}),Oo(o,"removeEventListener",function(s){return function(l,c,u){if(l==="click"||l=="keypress")try{const d=this.__sentry_instrumentation_handlers__||{},f=d[l];f&&(f.refCount--,f.refCount<=0&&(s.call(this,l,f.handler,u),f.handler=void 0,delete d[l]),Object.keys(d).length===0&&delete this.__sentry_instrumentation_handlers__)}catch{}return s.call(this,l,c,u)}}))})}function WK(n){if(n.type!==fy)return!1;try{if(!n.target||n.target._sentryId!==hy)return!1}catch{}return!0}function jK(n,e){return n!=="keypress"?!1:e!=null&&e.tagName?!(e.tagName==="INPUT"||e.tagName==="TEXTAREA"||e.isContentEditable):!0}function a4(n,e=!1){return t=>{if(!t||t._sentryCaptured)return;const r=QK(t);if(jK(t.type,r))return;Ai(t,"_sentryCaptured",!0),r&&!r._sentryId&&Ai(r,"_sentryId",Ko());const o=t.type==="keypress"?"input":t.type;WK(t)||(n({event:t,name:o,global:e}),fy=t.type,hy=r?r._sentryId:void 0),clearTimeout(o4),o4=qt.setTimeout(()=>{hy=void 0,fy=void 0},GK)}}function QK(n){try{return n.target}catch{return null}}let lg;function py(n){const e="history";Hl(e,n),Wl(e,$K)}function $K(){if(qt.addEventListener("popstate",()=>{const e=qt.location.href,t=lg;if(lg=e,t===e)return;Gi("history",{from:t,to:e})}),!Vq())return;function n(e){return function(...t){const r=t.length>2?t[2]:void 0;if(r){const o=lg,i=YK(String(r));if(lg=i,o===i)return e.apply(this,t);Gi("history",{from:o,to:i})}return e.apply(this,t)}}Oo(qt.history,"pushState",n),Oo(qt.history,"replaceState",n)}function YK(n){try{return new URL(n,qt.location.origin).toString()}catch{return n}}const cg={};function s4(n){const e=cg[n];if(e)return e;let t=qt[n];if(KA(t))return cg[n]=t.bind(qt);const r=qt.document;if(r&&typeof r.createElement=="function")try{const o=r.createElement("iframe");o.hidden=!0,r.head.appendChild(o);const i=o.contentWindow;i!=null&&i[n]&&(t=i[n]),r.head.removeChild(o)}catch(o){Zm&&lt.warn(`Could not create sandbox iframe for ${n} check, bailing to window.${n}: `,o)}return t&&(cg[n]=t.bind(qt))}function l4(n){cg[n]=void 0}function Qf(...n){return s4("setTimeout")(...n)}const lu="__sentry_xhr_v3__";function XK(n){Hl("xhr",n),Wl("xhr",qK)}function qK(){if(!qt.XMLHttpRequest)return;const n=XMLHttpRequest.prototype;n.open=new Proxy(n.open,{apply(e,t,r){const o=new Error,i=ko()*1e3,a=ts(r[0])?r[0].toUpperCase():void 0,s=KK(r[1]);if(!a||!s)return e.apply(t,r);t[lu]={method:a,url:s,request_headers:{}},a==="POST"&&s.match(/sentry_key/)&&(t.__sentry_own_request__=!0);const l=()=>{const c=t[lu];if(c&&t.readyState===4){try{c.status_code=t.status}catch{}const u={endTimestamp:ko()*1e3,startTimestamp:i,xhr:t,virtualError:o};Gi("xhr",u)}};return"onreadystatechange"in t&&typeof t.onreadystatechange=="function"?t.onreadystatechange=new Proxy(t.onreadystatechange,{apply(c,u,d){return l(),c.apply(u,d)}}):t.addEventListener("readystatechange",l),t.setRequestHeader=new Proxy(t.setRequestHeader,{apply(c,u,d){const[f,h]=d,p=u[lu];return p&&ts(f)&&ts(h)&&(p.request_headers[f.toLowerCase()]=h),c.apply(u,d)}}),e.apply(t,r)}}),n.send=new Proxy(n.send,{apply(e,t,r){const o=t[lu];if(!o)return e.apply(t,r);r[0]!==void 0&&(o.body=r[0]);const i={startTimestamp:ko()*1e3,xhr:t};return Gi("xhr",i),e.apply(t,r)}})}function KK(n){if(ts(n))return n;try{return n.toString()}catch{}}function c4(n){return new URLSearchParams(n).toString()}function u4(n,e=lt){try{if(typeof n=="string")return[n];if(n instanceof URLSearchParams)return[n.toString()];if(n instanceof FormData)return[c4(n)];if(!n)return[void 0]}catch(t){return Zm&&e.error(t,"Failed to serialize body",n),[void 0,"BODY_PARSE_ERROR"]}return Zm&&e.log("Skipping network body because of body type",n),[void 0,"UNPARSEABLE_BODY_TYPE"]}function d4(n=[]){if(!(n.length!==2||typeof n[1]!="object"))return n[1].body}function ZK(n,e=s4("fetch")){let t=0,r=0;function o(i){const a=i.body.length;t+=a,r++;const s={body:i.body,method:"POST",referrerPolicy:"strict-origin",headers:n.headers,keepalive:t<=6e4&&r<15,...n.fetchOptions};if(!e)return l4("fetch"),Qm("No fetch implementation available");try{return e(n.url,s).then(l=>(t-=a,r--,{statusCode:l.status,headers:{"x-sentry-rate-limits":l.headers.get("X-Sentry-Rate-Limits"),"retry-after":l.headers.get("Retry-After")}}))}catch(l){return l4("fetch"),t-=a,r--,Qm(l)}}return uq(n,o)}const JK=30,eZ=50;function my(n,e,t,r){const o={filename:n,function:e==="<anonymous>"?Gl:e,in_app:!0};return t!==void 0&&(o.lineno=t),r!==void 0&&(o.colno=r),o}const tZ=/^\s*at (\S+?)(?::(\d+))(?::(\d+))\s*$/i,nZ=/^\s*at (?:(.+?\)(?: \[.+\])?|.*?) ?\((?:address at )?)?(?:async )?((?:<anonymous>|[-a-z]+:|.*bundle|\/)?.*?)(?::(\d+))?(?::(\d+))?\)?\s*$/i,rZ=/\((\S*)(?::(\d+))(?::(\d+))\)/,oZ=[JK,n=>{const e=tZ.exec(n);if(e){const[,r,o,i]=e;return my(r,Gl,+o,+i)}const t=nZ.exec(n);if(t){if(t[2]&&t[2].indexOf("eval")===0){const a=rZ.exec(t[2]);a&&(t[2]=a[1],t[3]=a[2],t[4]=a[3])}const[o,i]=f4(t[1]||Gl,t[2]);return my(i,o,t[3]?+t[3]:void 0,t[4]?+t[4]:void 0)}}],iZ=/^\s*(.*?)(?:\((.*?)\))?(?:^|@)?((?:[-a-z]+)?:\/.*?|\[native code\]|[^@]*(?:bundle|\d+\.js)|\/[\w\-. /=]+)(?::(\d+))?(?::(\d+))?\s*$/i,aZ=/(\S+) line (\d+)(?: > eval line \d+)* > eval/i,sZ=_T(...[oZ,[eZ,n=>{const e=iZ.exec(n);if(e){if(e[3]&&e[3].indexOf(" > eval")>-1){const i=aZ.exec(e[3]);i&&(e[1]=e[1]||"eval",e[3]=i[1],e[4]=i[2],e[5]="")}let r=e[3],o=e[1]||Gl;return[o,r]=f4(o,r),my(r,o,e[4]?+e[4]:void 0,e[5]?+e[5]:void 0)}}]]),f4=(n,e)=>{const t=n.indexOf("safari-extension")!==-1,r=n.indexOf("safari-web-extension")!==-1;return t||r?[n.indexOf("@")!==-1?n.split("@")[0]:Gl,t?`safari-extension:${e}`:`safari-web-extension:${e}`]:[n,e]},ug=typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__,dg=1024,lZ="Breadcrumbs",cZ=((n={})=>{const e={console:!0,dom:!0,fetch:!0,history:!0,sentry:!0,xhr:!0,...n};return{name:lZ,setup(t){e.console&&Pq(fZ(t)),e.dom&&i4(dZ(t,e.dom)),e.xhr&&XK(hZ(t)),e.fetch&&Gq(pZ(t)),e.history&&py(mZ(t)),e.sentry&&t.on("beforeSendEvent",uZ(t))}}});function uZ(n){return function(t){Pn()===n&&Xs({category:`sentry.${t.type==="transaction"?"transaction":"event"}`,event_id:t.event_id,level:t.level,message:jl(t)},{event:t})}}function dZ(n,e){return function(r){if(Pn()!==n)return;let o,i,a=typeof e=="object"?e.serializeAttribute:void 0,s=typeof e=="object"&&typeof e.maxStringLength=="number"?e.maxStringLength:void 0;s&&s>dg&&(ug&&lt.warn(`\`dom.maxStringLength\` cannot exceed ${dg}, but a value of ${s} was configured. Sentry will use ${dg} instead.`),s=dg),typeof a=="string"&&(a=[a]);try{const c=r.event,u=gZ(c)?c.target:c;o=Fm(u,{keyAttrs:a,maxStringLength:s}),i=sY(u)}catch{o="<unknown>"}if(o.length===0)return;const l={category:`ui.${r.name}`,message:o};i&&(l.data={"ui.component_name":i}),Xs(l,{event:r.event,name:r.name,global:r.global})}}function fZ(n){return function(t){if(Pn()!==n)return;const r={category:"console",data:{arguments:t.args,logger:"console"},level:FI(t.level),message:CT(t.args," ")};if(t.level==="assert")if(t.args[0]===!1)r.message=`Assertion failed: ${CT(t.args.slice(1)," ")||"console.assert"}`,r.data.arguments=t.args.slice(1);else return;Xs(r,{input:t.args,level:t.level})}}function hZ(n){return function(t){if(Pn()!==n)return;const{startTimestamp:r,endTimestamp:o}=t,i=t.xhr[lu];if(!r||!o||!i)return;const{method:a,url:s,status_code:l,body:c}=i,u={method:a,url:s,status_code:l},d={xhr:t.xhr,input:c,startTimestamp:r,endTimestamp:o},f={category:"xhr",data:u,type:"http",level:GI(l)};n.emit("beforeOutgoingRequestBreadcrumb",f,d),Xs(f,d)}}function pZ(n){return function(t){if(Pn()!==n)return;const{startTimestamp:r,endTimestamp:o}=t;if(o&&!(t.fetchData.url.match(/sentry_key/)&&t.fetchData.method==="POST"))if(t.fetchData.method,t.fetchData.url,t.error){const i=t.fetchData,a={data:t.error,input:t.args,startTimestamp:r,endTimestamp:o},s={category:"fetch",data:i,level:"error",type:"http"};n.emit("beforeOutgoingRequestBreadcrumb",s,a),Xs(s,a)}else{const i=t.response,a={...t.fetchData,status_code:i==null?void 0:i.status};t.fetchData.request_body_size,t.fetchData.response_body_size,i==null||i.status;const s={input:t.args,response:i,startTimestamp:r,endTimestamp:o},l={category:"fetch",data:a,type:"http",level:GI(a.status_code)};n.emit("beforeOutgoingRequestBreadcrumb",l,s),Xs(l,s)}}}function mZ(n){return function(t){if(Pn()!==n)return;let r=t.from,o=t.to;const i=qA(sr.location.href);let a=r?qA(r):void 0;const s=qA(o);a!=null&&a.path||(a=i),i.protocol===s.protocol&&i.host===s.host&&(o=s.relative),i.protocol===a.protocol&&i.host===a.host&&(r=a.relative),Xs({category:"navigation",data:{from:r,to:o}})}}function gZ(n){return!!n&&!!n.target}const _Z=["EventTarget","Window","Node","ApplicationCache","AudioTrackList","BroadcastChannel","ChannelMergerNode","CryptoOperation","EventSource","FileReader","HTMLUnknownElement","IDBDatabase","IDBRequest","IDBTransaction","KeyOperation","MediaController","MessagePort","ModalWindow","Notification","SVGElementInstance","Screen","SharedWorker","TextTrack","TextTrackCue","TextTrackList","WebSocket","WebSocketWorker","Worker","XMLHttpRequest","XMLHttpRequestEventTarget","XMLHttpRequestUpload"],vZ="BrowserApiErrors",AZ=((n={})=>{const e={XMLHttpRequest:!0,eventTarget:!0,requestAnimationFrame:!0,setInterval:!0,setTimeout:!0,unregisterOriginalCallbacks:!1,...n};return{name:vZ,setupOnce(){e.setTimeout&&Oo(sr,"setTimeout",h4),e.setInterval&&Oo(sr,"setInterval",h4),e.requestAnimationFrame&&Oo(sr,"requestAnimationFrame",yZ),e.XMLHttpRequest&&"XMLHttpRequest"in sr&&Oo(XMLHttpRequest.prototype,"send",bZ);const t=e.eventTarget;t&&(Array.isArray(t)?t:_Z).forEach(o=>xZ(o,e))}}});function h4(n){return function(...e){const t=e[0];return e[0]=su(t,{mechanism:{data:{function:es(n)},handled:!1,type:"instrument"}}),n.apply(this,e)}}function yZ(n){return function(e){return n.apply(this,[su(e,{mechanism:{data:{function:"requestAnimationFrame",handler:es(n)},handled:!1,type:"instrument"}})])}}function bZ(n){return function(...e){const t=this;return["onload","onerror","onprogress","onreadystatechange"].forEach(o=>{o in t&&typeof t[o]=="function"&&Oo(t,o,function(i){const a={mechanism:{data:{function:o,handler:es(i)},handled:!1,type:"instrument"}},s=EA(i);return s&&(a.mechanism.data.handler=es(s)),su(i,a)})}),n.apply(this,e)}}function xZ(n,e){var o,i;const r=(o=sr[n])==null?void 0:o.prototype;(i=r==null?void 0:r.hasOwnProperty)!=null&&i.call(r,"addEventListener")&&(Oo(r,"addEventListener",function(a){return function(s,l,c){try{EZ(l)&&(l.handleEvent=su(l.handleEvent,{mechanism:{data:{function:"handleEvent",handler:es(l),target:n},handled:!1,type:"instrument"}}))}catch{}return e.unregisterOriginalCallbacks&&CZ(this,s,l),a.apply(this,[s,su(l,{mechanism:{data:{function:"addEventListener",handler:es(l),target:n},handled:!1,type:"instrument"}}),c])}}),Oo(r,"removeEventListener",function(a){return function(s,l,c){try{const u=l.__sentry_wrapped__;u&&a.call(this,s,u,c)}catch{}return a.call(this,s,l,c)}}))}function EZ(n){return typeof n.handleEvent=="function"}function CZ(n,e,t){n&&typeof n=="object"&&"removeEventListener"in n&&typeof n.removeEventListener=="function"&&n.removeEventListener(e,t)}const SZ=()=>({name:"BrowserSession",setupOnce(){if(typeof sr.document>"u"){ug&&lt.warn("Using the `browserSessionIntegration` in non-browser environments is not supported.");return}fI({ignoreDuration:!0}),mI(),py(({from:n,to:e})=>{n!==void 0&&n!==e&&(fI({ignoreDuration:!0}),mI())})}}),wZ="GlobalHandlers",MZ=((n={})=>{const e={onerror:!0,onunhandledrejection:!0,...n};return{name:wZ,setupOnce(){Error.stackTraceLimit=50},setup(t){e.onerror&&(TZ(t),p4("onerror")),e.onunhandledrejection&&(IZ(t),p4("onunhandledrejection"))}}});function TZ(n){q$(e=>{const{stackParser:t,attachStacktrace:r}=m4();if(Pn()!==n||jI())return;const{msg:o,url:i,line:a,column:s,error:l}=e,c=PZ(ry(t,l||o,void 0,r,!1),i,a,s);c.level="error",dI(c,{originalException:l,mechanism:{handled:!1,type:"onerror"}})})}function IZ(n){Z$(e=>{const{stackParser:t,attachStacktrace:r}=m4();if(Pn()!==n||jI())return;const o=RZ(e),i=bA(o)?LZ(o):ry(t,o,void 0,r,!0);i.level="error",dI(i,{originalException:o,mechanism:{handled:!1,type:"onunhandledrejection"}})})}function RZ(n){if(bA(n))return n;try{if("reason"in n)return n.reason;if("detail"in n&&"reason"in n.detail)return n.detail.reason}catch{}return n}function LZ(n){return{exception:{values:[{type:"UnhandledRejection",value:`Non-Error promise rejection captured with value: ${String(n)}`}]}}}function PZ(n,e,t,r){const o=n.exception=n.exception||{},i=o.values=o.values||[],a=i[0]=i[0]||{},s=a.stacktrace=a.stacktrace||{},l=s.frames=s.frames||[],c=r,u=t,d=ts(e)&&e.length>0?e:Vm();return l.length===0&&l.push({colno:c,filename:d,function:Gl,in_app:!0,lineno:u}),n}function p4(n){ug&&lt.log(`Global Handler attached: ${n}`)}function m4(){const n=Pn();return(n==null?void 0:n.getOptions())||{stackParser:()=>[],attachStacktrace:!1}}const DZ=()=>({name:"HttpContext",preprocessEvent(n){var r;if(!sr.navigator&&!sr.location&&!sr.document)return;const e=Kq(),t={...e.headers,...(r=n.request)==null?void 0:r.headers};n.request={...e,...n.request,headers:t}}}),BZ="cause",NZ=5,OZ="LinkedErrors",kZ=((n={})=>{const e=n.limit||NZ,t=n.key||BZ;return{name:OZ,preprocessEvent(r,o,i){const a=i.getOptions();Lq(ey,a.stackParser,t,e,r,o)}}});function FZ(){return VZ()?(ug&&Ja(()=>{console.error("[Sentry] You cannot use Sentry.init() in a browser extension, see: https://docs.sentry.io/platforms/javascript/best-practices/browser-extensions/")}),!0):!1}function VZ(){var i;if(typeof sr.window>"u")return!1;const n=sr;if(n.nw)return!1;const e=n.chrome||n.browser;if(!((i=e==null?void 0:e.runtime)!=null&&i.id))return!1;const t=Vm(),r=["chrome-extension","moz-extension","ms-browser-extension","safari-web-extension"];return!(sr===sr.top&&r.some(a=>t.startsWith(`${a}://`)))}function g4(n){return[Eq(),Aq(),AZ(),cZ(),MZ(),kZ(),Nq(),DZ(),SZ()]}function UZ(n={}){const e=!n.skipBrowserExtensionCheck&&FZ(),t={...n,enabled:e?!1:n.enabled,stackParser:Y$(n.stackParser||sZ),integrations:QX({integrations:n.integrations,defaultIntegrations:n.defaultIntegrations==null?g4():n.defaultIntegrations}),transport:n.transport||ZK};return rq(uK,t)}const On=hn,gy="sentryReplaySession",zZ="replay_event",_y="Unable to send Replay",GZ=3e5,HZ=9e5,WZ=5e3,jZ=5500,QZ=6e4,$Z=5e3,YZ=3,_4=15e4,fg=5e3,XZ=3e3,qZ=300,vy=2e7,KZ=4999,ZZ=15e3,v4=36e5;var JZ=Object.defineProperty,eJ=(n,e,t)=>e in n?JZ(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,A4=(n,e,t)=>eJ(n,typeof e!="symbol"?e+"":e,t),Dr=(n=>(n[n.Document=0]="Document",n[n.DocumentType=1]="DocumentType",n[n.Element=2]="Element",n[n.Text=3]="Text",n[n.CDATA=4]="CDATA",n[n.Comment=5]="Comment",n))(Dr||{});function tJ(n){return n.nodeType===n.ELEMENT_NODE}function $f(n){const e=n==null?void 0:n.host;return(e==null?void 0:e.shadowRoot)===n}function Yf(n){return Object.prototype.toString.call(n)==="[object ShadowRoot]"}function nJ(n){return n.includes(" background-clip: text;")&&!n.includes(" -webkit-background-clip: text;")&&(n=n.replace(/\sbackground-clip:\s*text;/g," -webkit-background-clip: text; background-clip: text;")),n}function rJ(n){const{cssText:e}=n;if(e.split('"').length<3)return e;const t=["@import",`url(${JSON.stringify(n.href)})`];return n.layerName===""?t.push("layer"):n.layerName&&t.push(`layer(${n.layerName})`),n.supportsText&&t.push(`supports(${n.supportsText})`),n.media.length&&t.push(n.media.mediaText),t.join(" ")+";"}function hg(n){try{const e=n.rules||n.cssRules;return e?nJ(Array.from(e,y4).join("")):null}catch{return null}}function oJ(n){let e="";for(let t=0;t<n.style.length;t++){const r=n.style,o=r[t],i=r.getPropertyPriority(o);e+=`${o}:${r.getPropertyValue(o)}${i?" !important":""};`}return`${n.selectorText} { ${e} }`}function y4(n){let e;if(aJ(n))try{e=hg(n.styleSheet)||rJ(n)}catch{}else if(sJ(n)){let t=n.cssText;const r=n.selectorText.includes(":"),o=typeof n.style.all=="string"&&n.style.all;if(o&&(t=oJ(n)),r&&(t=iJ(t)),r||o)return t}return e||n.cssText}function iJ(n){const e=/(\[(?:[\w-]+)[^\\])(:(?:[\w-]+)\])/gm;return n.replace(e,"$1\\$2")}function aJ(n){return"styleSheet"in n}function sJ(n){return"selectorText"in n}let b4=class{constructor(){A4(this,"idNodeMap",new Map),A4(this,"nodeMetaMap",new WeakMap)}getId(e){var r;return e?((r=this.getMeta(e))==null?void 0:r.id)??-1:-1}getNode(e){return this.idNodeMap.get(e)||null}getIds(){return Array.from(this.idNodeMap.keys())}getMeta(e){return this.nodeMetaMap.get(e)||null}removeNodeFromMap(e){const t=this.getId(e);this.idNodeMap.delete(t),e.childNodes&&e.childNodes.forEach(r=>this.removeNodeFromMap(r))}has(e){return this.idNodeMap.has(e)}hasNode(e){return this.nodeMetaMap.has(e)}add(e,t){const r=t.id;this.idNodeMap.set(r,e),this.nodeMetaMap.set(e,t)}replace(e,t){const r=this.getNode(e);if(r){const o=this.nodeMetaMap.get(r);o&&this.nodeMetaMap.set(t,o)}this.idNodeMap.set(e,t)}reset(){this.idNodeMap=new Map,this.nodeMetaMap=new WeakMap}};function lJ(){return new b4}function pg({maskInputOptions:n,tagName:e,type:t}){return e==="OPTION"&&(e="SELECT"),!!(n[e.toLowerCase()]||t&&n[t]||t==="password"||e==="INPUT"&&!t&&n.text)}function Xf({isMasked:n,element:e,value:t,maskInputFn:r}){let o=t||"";return n?(r&&(o=r(o,e)),"*".repeat(o.length)):o}function cu(n){return n.toLowerCase()}function Ay(n){return n.toUpperCase()}const x4="__rrweb_original__";function cJ(n){const e=n.getContext("2d");if(!e)return!0;const t=50;for(let r=0;r<n.width;r+=t)for(let o=0;o<n.height;o+=t){const i=e.getImageData,a=x4 in i?i[x4]:i;if(new Uint32Array(a.call(e,r,o,Math.min(t,n.width-r),Math.min(t,n.height-o)).data.buffer).some(l=>l!==0))return!1}return!0}function yy(n){const e=n.type;return n.hasAttribute("data-rr-is-password")?"password":e?cu(e):null}function mg(n,e,t){return e==="INPUT"&&(t==="radio"||t==="checkbox")?n.getAttribute("value")||"":n.value}function E4(n,e){let t;try{t=new URL(n,e??window.location.href)}catch{return null}const r=/\.([0-9a-z]+)(?:$)/i,o=t.pathname.match(r);return(o==null?void 0:o[1])??null}const C4={};function S4(n){const e=C4[n];if(e)return e;const t=window.document;let r=window[n];if(t&&typeof t.createElement=="function")try{const o=t.createElement("iframe");o.hidden=!0,t.head.appendChild(o);const i=o.contentWindow;i&&i[n]&&(r=i[n]),t.head.removeChild(o)}catch{}return C4[n]=r.bind(window)}function by(...n){return S4("setTimeout")(...n)}function w4(...n){return S4("clearTimeout")(...n)}function M4(n){try{return n.contentDocument}catch{}}let uJ=1;const dJ=new RegExp("[^a-z0-9-_:]"),qf=-2;function xy(){return uJ++}function fJ(n){if(n instanceof HTMLFormElement)return"form";const e=cu(n.tagName);return dJ.test(e)?"div":e}function hJ(n){let e="";return n.indexOf("//")>-1?e=n.split("/").slice(0,3).join("/"):e=n.split("/")[0],e=e.split("?")[0],e}let uu,T4;const pJ=/url\((?:(')([^']*)'|(")(.*?)"|([^)]*))\)/gm,mJ=/^(?:[a-z+]+:)?\/\//i,gJ=/^www\..*/i,_J=/^(data:)([^,]*),(.*)/i;function gg(n,e){return(n||"").replace(pJ,(t,r,o,i,a,s)=>{const l=o||a||s,c=r||i||"";if(!l)return t;if(mJ.test(l)||gJ.test(l))return`url(${c}${l}${c})`;if(_J.test(l))return`url(${c}${l}${c})`;if(l[0]==="/")return`url(${c}${hJ(e)+l}${c})`;const u=e.split("/"),d=l.split("/");u.pop();for(const f of d)f!=="."&&(f===".."?u.pop():u.push(f));return`url(${c}${u.join("/")}${c})`})}const vJ=/^[^ \t\n\r\u000c]+/,AJ=/^[, \t\n\r\u000c]+/;function yJ(n,e){if(e.trim()==="")return e;let t=0;function r(i){let a;const s=i.exec(e.substring(t));return s?(a=s[0],t+=a.length,a):""}const o=[];for(;r(AJ),!(t>=e.length);){let i=r(vJ);if(i.slice(-1)===",")i=du(n,i.substring(0,i.length-1)),o.push(i);else{let a="";i=du(n,i);let s=!1;for(;;){const l=e.charAt(t);if(l===""){o.push((i+a).trim());break}else if(s)l===")"&&(s=!1);else if(l===","){t+=1,o.push((i+a).trim());break}else l==="("&&(s=!0);a+=l,t+=1}}}return o.join(", ")}const I4=new WeakMap;function du(n,e){return!e||e.trim()===""?e:_g(n,e)}function bJ(n){return!!(n.tagName==="svg"||n.ownerSVGElement)}function _g(n,e){let t=I4.get(n);if(t||(t=n.createElement("a"),I4.set(n,t)),!e)e="";else if(e.startsWith("blob:")||e.startsWith("data:"))return e;return t.setAttribute("href",e),t.href}function R4(n,e,t,r,o,i){return r&&(t==="src"||t==="href"&&!(e==="use"&&r[0]==="#")||t==="xlink:href"&&r[0]!=="#"||t==="background"&&(e==="table"||e==="td"||e==="th")?du(n,r):t==="srcset"?yJ(n,r):t==="style"?gg(r,_g(n)):e==="object"&&t==="data"?du(n,r):typeof i=="function"?i(t,r,o):r)}function L4(n,e,t){return(n==="video"||n==="audio")&&e==="autoplay"}function P4(n,e,t,r){try{if(r&&n.matches(r))return!1;if(typeof e=="string"){if(n.classList.contains(e))return!0}else for(let o=n.classList.length;o--;){const i=n.classList[o];if(e.test(i))return!0}if(t)return n.matches(t)}catch{}return!1}function xJ(n,e){for(let t=n.classList.length;t--;){const r=n.classList[t];if(e.test(r))return!0}return!1}function Yl(n,e,t=1/0,r=0){return!n||n.nodeType!==n.ELEMENT_NODE||r>t?-1:e(n)?r:Yl(n.parentNode,e,t,r+1)}function fu(n,e){return t=>{const r=t;if(r===null)return!1;try{if(n){if(typeof n=="string"){if(r.matches(`.${n}`))return!0}else if(xJ(r,n))return!0}return!!(e&&r.matches(e))}catch{return!1}}}function hu(n,e,t,r,o,i){try{const a=n.nodeType===n.ELEMENT_NODE?n:n.parentElement;if(a===null)return!1;if(a.tagName==="INPUT"){const c=a.getAttribute("autocomplete");if(["current-password","new-password","cc-number","cc-exp","cc-exp-month","cc-exp-year","cc-csc"].includes(c))return!0}let s=-1,l=-1;if(i){if(l=Yl(a,fu(r,o)),l<0)return!0;s=Yl(a,fu(e,t),l>=0?l:1/0)}else{if(s=Yl(a,fu(e,t)),s<0)return!1;l=Yl(a,fu(r,o),s>=0?s:1/0)}return s>=0?l>=0?s<=l:!0:l>=0?!1:!!i}catch{}return!!i}function EJ(n,e,t){const r=n.contentWindow;if(!r)return;let o=!1,i;try{i=r.document.readyState}catch{return}if(i!=="complete"){const s=by(()=>{o||(e(),o=!0)},t);n.addEventListener("load",()=>{w4(s),o=!0,e()});return}const a="about:blank";if(r.location.href!==a||n.src===a||n.src==="")return by(e,0),n.addEventListener("load",e);n.addEventListener("load",e)}function CJ(n,e,t){let r=!1,o;try{o=n.sheet}catch{return}if(o)return;const i=by(()=>{r||(e(),r=!0)},t);n.addEventListener("load",()=>{w4(i),r=!0,e()})}function SJ(n,e){const{doc:t,mirror:r,blockClass:o,blockSelector:i,unblockSelector:a,maskAllText:s,maskAttributeFn:l,maskTextClass:c,unmaskTextClass:u,maskTextSelector:d,unmaskTextSelector:f,inlineStylesheet:h,maskInputOptions:p={},maskTextFn:m,maskInputFn:g,dataURLOptions:_={},inlineImages:A,recordCanvas:y,keepIframeSrcFn:b,newlyAddedElement:E=!1}=e,x=wJ(t,r);switch(n.nodeType){case n.DOCUMENT_NODE:return n.compatMode!=="CSS1Compat"?{type:Dr.Document,childNodes:[],compatMode:n.compatMode}:{type:Dr.Document,childNodes:[]};case n.DOCUMENT_TYPE_NODE:return{type:Dr.DocumentType,name:n.name,publicId:n.publicId,systemId:n.systemId,rootId:x};case n.ELEMENT_NODE:return TJ(n,{doc:t,blockClass:o,blockSelector:i,unblockSelector:a,inlineStylesheet:h,maskAttributeFn:l,maskInputOptions:p,maskInputFn:g,dataURLOptions:_,inlineImages:A,recordCanvas:y,keepIframeSrcFn:b,newlyAddedElement:E,rootId:x,maskTextClass:c,unmaskTextClass:u,maskTextSelector:d,unmaskTextSelector:f});case n.TEXT_NODE:return MJ(n,{doc:t,maskAllText:s,maskTextClass:c,unmaskTextClass:u,maskTextSelector:d,unmaskTextSelector:f,maskTextFn:m,maskInputOptions:p,maskInputFn:g,rootId:x});case n.CDATA_SECTION_NODE:return{type:Dr.CDATA,textContent:"",rootId:x};case n.COMMENT_NODE:return{type:Dr.Comment,textContent:n.textContent||"",rootId:x};default:return!1}}function wJ(n,e){if(!e.hasNode(n))return;const t=e.getId(n);return t===1?void 0:t}function MJ(n,e){var _;const{maskAllText:t,maskTextClass:r,unmaskTextClass:o,maskTextSelector:i,unmaskTextSelector:a,maskTextFn:s,maskInputOptions:l,maskInputFn:c,rootId:u}=e,d=n.parentNode&&n.parentNode.tagName;let f=n.textContent;const h=d==="STYLE"?!0:void 0,p=d==="SCRIPT"?!0:void 0,m=d==="TEXTAREA"?!0:void 0;if(h&&f){try{n.nextSibling||n.previousSibling||(_=n.parentNode.sheet)!=null&&_.cssRules&&(f=hg(n.parentNode.sheet))}catch(A){console.warn(`Cannot get CSS styles from text's parentNode. Error: ${A}`,n)}f=gg(f,_g(e.doc))}p&&(f="SCRIPT_PLACEHOLDER");const g=hu(n,r,i,o,a,t);if(!h&&!p&&!m&&f&&g&&(f=s?s(f,n.parentElement):f.replace(/[\S]/g,"*")),m&&f&&(l.textarea||g)&&(f=c?c(f,n.parentNode):f.replace(/[\S]/g,"*")),d==="OPTION"&&f){const A=pg({type:null,tagName:d,maskInputOptions:l});f=Xf({isMasked:hu(n,r,i,o,a,A),element:n,value:f,maskInputFn:c})}return{type:Dr.Text,textContent:f||"",isStyle:h,rootId:u}}function TJ(n,e){const{doc:t,blockClass:r,blockSelector:o,unblockSelector:i,inlineStylesheet:a,maskInputOptions:s={},maskAttributeFn:l,maskInputFn:c,dataURLOptions:u={},inlineImages:d,recordCanvas:f,keepIframeSrcFn:h,newlyAddedElement:p=!1,rootId:m,maskTextClass:g,unmaskTextClass:_,maskTextSelector:A,unmaskTextSelector:y}=e,b=P4(n,r,o,i),E=fJ(n);let x={};const w=n.attributes.length;for(let C=0;C<w;C++){const P=n.attributes[C];P.name&&!L4(E,P.name,P.value)&&(x[P.name]=R4(t,E,cu(P.name),P.value,n,l))}if(E==="link"&&a){const C=Array.from(t.styleSheets).find(D=>D.href===n.href);let P=null;C&&(P=hg(C)),P&&(x.rel=null,x.href=null,x.crossorigin=null,x._cssText=gg(P,C.href))}if(E==="style"&&n.sheet&&!(n.innerText||n.textContent||"").trim().length){const C=hg(n.sheet);C&&(x._cssText=gg(C,_g(t)))}if(E==="input"||E==="textarea"||E==="select"||E==="option"){const C=n,P=yy(C),D=mg(C,Ay(E),P),Q=C.checked;if(P!=="submit"&&P!=="button"&&D){const re=hu(C,g,A,_,y,pg({type:P,tagName:Ay(E),maskInputOptions:s}));x.value=Xf({isMasked:re,element:C,value:D,maskInputFn:c})}Q&&(x.checked=Q)}if(E==="option"&&(n.selected&&!s.select?x.selected=!0:delete x.selected),E==="canvas"&&f){if(n.__context==="2d")cJ(n)||(x.rr_dataURL=n.toDataURL(u.type,u.quality));else if(!("__context"in n)){const C=n.toDataURL(u.type,u.quality),P=t.createElement("canvas");P.width=n.width,P.height=n.height;const D=P.toDataURL(u.type,u.quality);C!==D&&(x.rr_dataURL=C)}}if(E==="img"&&d){uu||(uu=t.createElement("canvas"),T4=uu.getContext("2d"));const C=n,P=C.currentSrc||C.getAttribute("src")||"<unknown-src>",D=C.crossOrigin,Q=()=>{C.removeEventListener("load",Q);try{uu.width=C.naturalWidth,uu.height=C.naturalHeight,T4.drawImage(C,0,0),x.rr_dataURL=uu.toDataURL(u.type,u.quality)}catch(re){if(C.crossOrigin!=="anonymous"){C.crossOrigin="anonymous",C.complete&&C.naturalWidth!==0?Q():C.addEventListener("load",Q);return}else console.warn(`Cannot inline img src=${P}! Error: ${re}`)}C.crossOrigin==="anonymous"&&(D?x.crossOrigin=D:C.removeAttribute("crossorigin"))};C.complete&&C.naturalWidth!==0?Q():C.addEventListener("load",Q)}if((E==="audio"||E==="video")&&(x.rr_mediaState=n.paused?"paused":"played",x.rr_mediaCurrentTime=n.currentTime),p||(n.scrollLeft&&(x.rr_scrollLeft=n.scrollLeft),n.scrollTop&&(x.rr_scrollTop=n.scrollTop)),b){const{width:C,height:P}=n.getBoundingClientRect();x={class:x.class,rr_width:`${C}px`,rr_height:`${P}px`}}E==="iframe"&&!h(x.src)&&(!b&&!M4(n)&&(x.rr_src=x.src),delete x.src);let L;try{customElements.get(E)&&(L=!0)}catch{}return{type:Dr.Element,tagName:E,attributes:x,childNodes:[],isSVG:bJ(n)||void 0,needBlock:b,rootId:m,isCustom:L}}function kn(n){return n==null?"":n.toLowerCase()}function IJ(n,e){if(e.comment&&n.type===Dr.Comment)return!0;if(n.type===Dr.Element){if(e.script&&(n.tagName==="script"||n.tagName==="link"&&(n.attributes.rel==="preload"||n.attributes.rel==="modulepreload")||n.tagName==="link"&&n.attributes.rel==="prefetch"&&typeof n.attributes.href=="string"&&E4(n.attributes.href)==="js"))return!0;if(e.headFavicon&&(n.tagName==="link"&&n.attributes.rel==="shortcut icon"||n.tagName==="meta"&&(kn(n.attributes.name).match(/^msapplication-tile(image|color)$/)||kn(n.attributes.name)==="application-name"||kn(n.attributes.rel)==="icon"||kn(n.attributes.rel)==="apple-touch-icon"||kn(n.attributes.rel)==="shortcut icon")))return!0;if(n.tagName==="meta"){if(e.headMetaDescKeywords&&kn(n.attributes.name).match(/^description|keywords$/))return!0;if(e.headMetaSocial&&(kn(n.attributes.property).match(/^(og|twitter|fb):/)||kn(n.attributes.name).match(/^(og|twitter):/)||kn(n.attributes.name)==="pinterest"))return!0;if(e.headMetaRobots&&(kn(n.attributes.name)==="robots"||kn(n.attributes.name)==="googlebot"||kn(n.attributes.name)==="bingbot"))return!0;if(e.headMetaHttpEquiv&&n.attributes["http-equiv"]!==void 0)return!0;if(e.headMetaAuthorship&&(kn(n.attributes.name)==="author"||kn(n.attributes.name)==="generator"||kn(n.attributes.name)==="framework"||kn(n.attributes.name)==="publisher"||kn(n.attributes.name)==="progid"||kn(n.attributes.property).match(/^article:/)||kn(n.attributes.property).match(/^product:/)))return!0;if(e.headMetaVerification&&(kn(n.attributes.name)==="google-site-verification"||kn(n.attributes.name)==="yandex-verification"||kn(n.attributes.name)==="csrf-token"||kn(n.attributes.name)==="p:domain_verify"||kn(n.attributes.name)==="verify-v1"||kn(n.attributes.name)==="verification"||kn(n.attributes.name)==="shopify-checkout-api-token"))return!0}}return!1}function pu(n,e){const{doc:t,mirror:r,blockClass:o,blockSelector:i,unblockSelector:a,maskAllText:s,maskTextClass:l,unmaskTextClass:c,maskTextSelector:u,unmaskTextSelector:d,skipChild:f=!1,inlineStylesheet:h=!0,maskInputOptions:p={},maskAttributeFn:m,maskTextFn:g,maskInputFn:_,slimDOMOptions:A,dataURLOptions:y={},inlineImages:b=!1,recordCanvas:E=!1,onSerialize:x,onIframeLoad:w,iframeLoadTimeout:L=5e3,onStylesheetLoad:C,stylesheetLoadTimeout:P=5e3,keepIframeSrcFn:D=()=>!1,newlyAddedElement:Q=!1}=e;let{preserveWhiteSpace:re=!0}=e;const G=SJ(n,{doc:t,mirror:r,blockClass:o,blockSelector:i,maskAllText:s,unblockSelector:a,maskTextClass:l,unmaskTextClass:c,maskTextSelector:u,unmaskTextSelector:d,inlineStylesheet:h,maskInputOptions:p,maskAttributeFn:m,maskTextFn:g,maskInputFn:_,dataURLOptions:y,inlineImages:b,recordCanvas:E,keepIframeSrcFn:D,newlyAddedElement:Q});if(!G)return console.warn(n,"not serialized"),null;let se;r.hasNode(n)?se=r.getId(n):IJ(G,A)||!re&&G.type===Dr.Text&&!G.isStyle&&!G.textContent.replace(/^\s+|\s+$/gm,"").length?se=qf:se=xy();const ee=Object.assign(G,{id:se});if(r.add(n,ee),se===qf)return null;x&&x(n);let ie=!f;if(ee.type===Dr.Element){ie=ie&&!ee.needBlock,delete ee.needBlock;const H=n.shadowRoot;H&&Yf(H)&&(ee.isShadowHost=!0)}if((ee.type===Dr.Document||ee.type===Dr.Element)&&ie){A.headWhitespace&&ee.type===Dr.Element&&ee.tagName==="head"&&(re=!1);const H={doc:t,mirror:r,blockClass:o,blockSelector:i,maskAllText:s,unblockSelector:a,maskTextClass:l,unmaskTextClass:c,maskTextSelector:u,unmaskTextSelector:d,skipChild:f,inlineStylesheet:h,maskInputOptions:p,maskAttributeFn:m,maskTextFn:g,maskInputFn:_,slimDOMOptions:A,dataURLOptions:y,inlineImages:b,recordCanvas:E,preserveWhiteSpace:re,onSerialize:x,onIframeLoad:w,iframeLoadTimeout:L,onStylesheetLoad:C,stylesheetLoadTimeout:P,keepIframeSrcFn:D};for(const T of Array.from(n.childNodes)){const R=pu(T,H);R&&ee.childNodes.push(R)}if(tJ(n)&&n.shadowRoot)for(const T of Array.from(n.shadowRoot.childNodes)){const R=pu(T,H);R&&(Yf(n.shadowRoot)&&(R.isShadow=!0),ee.childNodes.push(R))}}return n.parentNode&&$f(n.parentNode)&&Yf(n.parentNode)&&(ee.isShadow=!0),ee.type===Dr.Element&&ee.tagName==="iframe"&&!P4(n,o,i,a)&&EJ(n,()=>{const H=M4(n);if(H&&w){const T=pu(H,{doc:H,mirror:r,blockClass:o,blockSelector:i,unblockSelector:a,maskAllText:s,maskTextClass:l,unmaskTextClass:c,maskTextSelector:u,unmaskTextSelector:d,skipChild:!1,inlineStylesheet:h,maskInputOptions:p,maskAttributeFn:m,maskTextFn:g,maskInputFn:_,slimDOMOptions:A,dataURLOptions:y,inlineImages:b,recordCanvas:E,preserveWhiteSpace:re,onSerialize:x,onIframeLoad:w,iframeLoadTimeout:L,onStylesheetLoad:C,stylesheetLoadTimeout:P,keepIframeSrcFn:D});T&&w(n,T)}},L),ee.type===Dr.Element&&ee.tagName==="link"&&typeof ee.attributes.rel=="string"&&(ee.attributes.rel==="stylesheet"||ee.attributes.rel==="preload"&&typeof ee.attributes.href=="string"&&E4(ee.attributes.href)==="css")&&CJ(n,()=>{if(C){const H=pu(n,{doc:t,mirror:r,blockClass:o,blockSelector:i,unblockSelector:a,maskAllText:s,maskTextClass:l,unmaskTextClass:c,maskTextSelector:u,unmaskTextSelector:d,skipChild:!1,inlineStylesheet:h,maskInputOptions:p,maskAttributeFn:m,maskTextFn:g,maskInputFn:_,slimDOMOptions:A,dataURLOptions:y,inlineImages:b,recordCanvas:E,preserveWhiteSpace:re,onSerialize:x,onIframeLoad:w,iframeLoadTimeout:L,onStylesheetLoad:C,stylesheetLoadTimeout:P,keepIframeSrcFn:D});H&&C(n,H)}},P),ee}function RJ(n,e){const{mirror:t=new b4,blockClass:r="rr-block",blockSelector:o=null,unblockSelector:i=null,maskAllText:a=!1,maskTextClass:s="rr-mask",unmaskTextClass:l=null,maskTextSelector:c=null,unmaskTextSelector:u=null,inlineStylesheet:d=!0,inlineImages:f=!1,recordCanvas:h=!1,maskAllInputs:p=!1,maskAttributeFn:m,maskTextFn:g,maskInputFn:_,slimDOM:A=!1,dataURLOptions:y,preserveWhiteSpace:b,onSerialize:E,onIframeLoad:x,iframeLoadTimeout:w,onStylesheetLoad:L,stylesheetLoadTimeout:C,keepIframeSrcFn:P=()=>!1}=e||{};return pu(n,{doc:n,mirror:t,blockClass:r,blockSelector:o,unblockSelector:i,maskAllText:a,maskTextClass:s,unmaskTextClass:l,maskTextSelector:c,unmaskTextSelector:u,skipChild:!1,inlineStylesheet:d,maskInputOptions:p===!0?{color:!0,date:!0,"datetime-local":!0,email:!0,month:!0,number:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0,textarea:!0,select:!0}:p===!1?{}:p,maskAttributeFn:m,maskTextFn:g,maskInputFn:_,slimDOMOptions:A===!0||A==="all"?{script:!0,comment:!0,headFavicon:!0,headWhitespace:!0,headMetaDescKeywords:A==="all",headMetaSocial:!0,headMetaRobots:!0,headMetaHttpEquiv:!0,headMetaAuthorship:!0,headMetaVerification:!0}:A===!1?{}:A,dataURLOptions:y,inlineImages:f,recordCanvas:h,preserveWhiteSpace:b,onSerialize:E,onIframeLoad:x,iframeLoadTimeout:w,onStylesheetLoad:L,stylesheetLoadTimeout:C,keepIframeSrcFn:P,newlyAddedElement:!1})}function mo(n,e,t=document){const r={capture:!0,passive:!0};return t.addEventListener(n,e,r),()=>t.removeEventListener(n,e,r)}const mu=`Please stop import mirror directly. Instead of that,\r
now you can use replayer.getMirror() to access the mirror instance of a replayer,\r
or you can use record.mirror to access the mirror instance during recording.`;let D4={map:{},getId(){return console.error(mu),-1},getNode(){return console.error(mu),null},removeNodeFromMap(){console.error(mu)},has(){return console.error(mu),!1},reset(){console.error(mu)}};typeof window<"u"&&window.Proxy&&window.Reflect&&(D4=new Proxy(D4,{get(n,e,t){return e==="map"&&console.error(mu),Reflect.get(n,e,t)}}));function Kf(n,e,t={}){let r=null,o=0;return function(...i){const a=Date.now();!o&&t.leading===!1&&(o=a);const s=e-(a-o),l=this;s<=0||s>e?(r&&(kJ(r),r=null),o=a,n.apply(l,i)):!r&&t.trailing!==!1&&(r=Ag(()=>{o=t.leading===!1?0:Date.now(),r=null,n.apply(l,i)},s))}}function B4(n,e,t,r,o=window){const i=o.Object.getOwnPropertyDescriptor(n,e);return o.Object.defineProperty(n,e,r?t:{set(a){Ag(()=>{t.set.call(this,a)},0),i&&i.set&&i.set.call(this,a)}}),()=>B4(n,e,i||{},!0)}function Ey(n,e,t){try{if(!(e in n))return()=>{};const r=n[e],o=t(r);return typeof o=="function"&&(o.prototype=o.prototype||{},Object.defineProperties(o,{__rrweb_original__:{enumerable:!1,value:r}})),n[e]=o,()=>{n[e]=r}}catch{return()=>{}}}let vg=Date.now;/[1-9][0-9]{12}/.test(Date.now().toString())||(vg=()=>new Date().getTime());function N4(n){var t,r,o,i,a,s;const e=n.document;return{left:e.scrollingElement?e.scrollingElement.scrollLeft:n.pageXOffset!==void 0?n.pageXOffset:(e==null?void 0:e.documentElement.scrollLeft)||((r=(t=e==null?void 0:e.body)==null?void 0:t.parentElement)==null?void 0:r.scrollLeft)||((o=e==null?void 0:e.body)==null?void 0:o.scrollLeft)||0,top:e.scrollingElement?e.scrollingElement.scrollTop:n.pageYOffset!==void 0?n.pageYOffset:(e==null?void 0:e.documentElement.scrollTop)||((a=(i=e==null?void 0:e.body)==null?void 0:i.parentElement)==null?void 0:a.scrollTop)||((s=e==null?void 0:e.body)==null?void 0:s.scrollTop)||0}}function O4(){return window.innerHeight||document.documentElement&&document.documentElement.clientHeight||document.body&&document.body.clientHeight}function k4(){return window.innerWidth||document.documentElement&&document.documentElement.clientWidth||document.body&&document.body.clientWidth}function F4(n){if(!n)return null;try{return n.nodeType===n.ELEMENT_NODE?n:n.parentElement}catch{return null}}function ei(n,e,t,r,o){if(!n)return!1;const i=F4(n);if(!i)return!1;const a=fu(e,t);if(!o){const c=r&&i.matches(r);return a(i)&&!c}const s=Yl(i,a);let l=-1;return s<0?!1:(r&&(l=Yl(i,fu(null,r))),s>-1&&l<0?!0:s<l)}function LJ(n,e){return e.getId(n)!==-1}function Cy(n,e){return e.getId(n)===qf}function V4(n,e){if($f(n))return!1;const t=e.getId(n);return e.has(t)?n.parentNode&&n.parentNode.nodeType===n.DOCUMENT_NODE?!1:n.parentNode?V4(n.parentNode,e):!0:!0}function Sy(n){return!!n.changedTouches}function PJ(n=window){"NodeList"in n&&!n.NodeList.prototype.forEach&&(n.NodeList.prototype.forEach=Array.prototype.forEach),"DOMTokenList"in n&&!n.DOMTokenList.prototype.forEach&&(n.DOMTokenList.prototype.forEach=Array.prototype.forEach),Node.prototype.contains||(Node.prototype.contains=(...e)=>{let t=e[0];if(!(0 in e))throw new TypeError("1 argument is required");do if(this===t)return!0;while(t=t&&t.parentNode);return!1})}function U4(n,e){return!!(n.nodeName==="IFRAME"&&e.getMeta(n))}function z4(n,e){return!!(n.nodeName==="LINK"&&n.nodeType===n.ELEMENT_NODE&&n.getAttribute&&n.getAttribute("rel")==="stylesheet"&&e.getMeta(n))}function wy(n){return!!(n!=null&&n.shadowRoot)}class DJ{constructor(){this.id=1,this.styleIDMap=new WeakMap,this.idStyleMap=new Map}getId(e){return this.styleIDMap.get(e)??-1}has(e){return this.styleIDMap.has(e)}add(e,t){if(this.has(e))return this.getId(e);let r;return t===void 0?r=this.id++:r=t,this.styleIDMap.set(e,r),this.idStyleMap.set(r,e),r}getStyle(e){return this.idStyleMap.get(e)||null}reset(){this.styleIDMap=new WeakMap,this.idStyleMap=new Map,this.id=1}generateId(){return this.id++}}function G4(n){var t,r;let e=null;return((r=(t=n.getRootNode)==null?void 0:t.call(n))==null?void 0:r.nodeType)===Node.DOCUMENT_FRAGMENT_NODE&&n.getRootNode().host&&(e=n.getRootNode().host),e}function BJ(n){let e=n,t;for(;t=G4(e);)e=t;return e}function NJ(n){const e=n.ownerDocument;if(!e)return!1;const t=BJ(n);return e.contains(t)}function H4(n){const e=n.ownerDocument;return e?e.contains(n)||NJ(n):!1}const W4={};function My(n){const e=W4[n];if(e)return e;const t=window.document;let r=window[n];if(t&&typeof t.createElement=="function")try{const o=t.createElement("iframe");o.hidden=!0,t.head.appendChild(o);const i=o.contentWindow;i&&i[n]&&(r=i[n]),t.head.removeChild(o)}catch{}return W4[n]=r.bind(window)}function OJ(...n){return My("requestAnimationFrame")(...n)}function Ag(...n){return My("setTimeout")(...n)}function kJ(...n){return My("clearTimeout")(...n)}var Wt=(n=>(n[n.DomContentLoaded=0]="DomContentLoaded",n[n.Load=1]="Load",n[n.FullSnapshot=2]="FullSnapshot",n[n.IncrementalSnapshot=3]="IncrementalSnapshot",n[n.Meta=4]="Meta",n[n.Custom=5]="Custom",n[n.Plugin=6]="Plugin",n))(Wt||{}),Ot=(n=>(n[n.Mutation=0]="Mutation",n[n.MouseMove=1]="MouseMove",n[n.MouseInteraction=2]="MouseInteraction",n[n.Scroll=3]="Scroll",n[n.ViewportResize=4]="ViewportResize",n[n.Input=5]="Input",n[n.TouchMove=6]="TouchMove",n[n.MediaInteraction=7]="MediaInteraction",n[n.StyleSheetRule=8]="StyleSheetRule",n[n.CanvasMutation=9]="CanvasMutation",n[n.Font=10]="Font",n[n.Log=11]="Log",n[n.Drag=12]="Drag",n[n.StyleDeclaration=13]="StyleDeclaration",n[n.Selection=14]="Selection",n[n.AdoptedStyleSheet=15]="AdoptedStyleSheet",n[n.CustomElement=16]="CustomElement",n))(Ot||{}),go=(n=>(n[n.MouseUp=0]="MouseUp",n[n.MouseDown=1]="MouseDown",n[n.Click=2]="Click",n[n.ContextMenu=3]="ContextMenu",n[n.DblClick=4]="DblClick",n[n.Focus=5]="Focus",n[n.Blur=6]="Blur",n[n.TouchStart=7]="TouchStart",n[n.TouchMove_Departed=8]="TouchMove_Departed",n[n.TouchEnd=9]="TouchEnd",n[n.TouchCancel=10]="TouchCancel",n))(go||{}),is=(n=>(n[n.Mouse=0]="Mouse",n[n.Pen=1]="Pen",n[n.Touch=2]="Touch",n))(is||{}),gu=(n=>(n[n.Play=0]="Play",n[n.Pause=1]="Pause",n[n.Seeked=2]="Seeked",n[n.VolumeChange=3]="VolumeChange",n[n.RateChange=4]="RateChange",n))(gu||{});function Ty(n){try{return n.contentDocument}catch{}}function FJ(n){try{return n.contentWindow}catch{}}function j4(n){return"__ln"in n}class VJ{constructor(){this.length=0,this.head=null,this.tail=null}get(e){if(e>=this.length)throw new Error("Position outside of list range");let t=this.head;for(let r=0;r<e;r++)t=(t==null?void 0:t.next)||null;return t}addNode(e){const t={value:e,previous:null,next:null};if(e.__ln=t,e.previousSibling&&j4(e.previousSibling)){const r=e.previousSibling.__ln.next;t.next=r,t.previous=e.previousSibling.__ln,e.previousSibling.__ln.next=t,r&&(r.previous=t)}else if(e.nextSibling&&j4(e.nextSibling)&&e.nextSibling.__ln.previous){const r=e.nextSibling.__ln.previous;t.previous=r,t.next=e.nextSibling.__ln,e.nextSibling.__ln.previous=t,r&&(r.next=t)}else this.head&&(this.head.previous=t),t.next=this.head,this.head=t;t.next===null&&(this.tail=t),this.length++}removeNode(e){const t=e.__ln;this.head&&(t.previous?(t.previous.next=t.next,t.next?t.next.previous=t.previous:this.tail=t.previous):(this.head=t.next,this.head?this.head.previous=null:this.tail=null),e.__ln&&delete e.__ln,this.length--)}}const Q4=(n,e)=>`${n}@${e}`;class UJ{constructor(){this.frozen=!1,this.locked=!1,this.texts=[],this.attributes=[],this.attributeMap=new WeakMap,this.removes=[],this.mapRemoves=[],this.movedMap={},this.addedSet=new Set,this.movedSet=new Set,this.droppedSet=new Set,this.processMutations=e=>{e.forEach(this.processMutation),this.emit()},this.emit=()=>{if(this.frozen||this.locked)return;const e=[],t=new Set,r=new VJ,o=l=>{let c=l,u=qf;for(;u===qf;)c=c&&c.nextSibling,u=c&&this.mirror.getId(c);return u},i=l=>{if(!l.parentNode||!H4(l))return;const c=$f(l.parentNode)?this.mirror.getId(G4(l)):this.mirror.getId(l.parentNode),u=o(l);if(c===-1||u===-1)return r.addNode(l);const d=pu(l,{doc:this.doc,mirror:this.mirror,blockClass:this.blockClass,blockSelector:this.blockSelector,maskAllText:this.maskAllText,unblockSelector:this.unblockSelector,maskTextClass:this.maskTextClass,unmaskTextClass:this.unmaskTextClass,maskTextSelector:this.maskTextSelector,unmaskTextSelector:this.unmaskTextSelector,skipChild:!0,newlyAddedElement:!0,inlineStylesheet:this.inlineStylesheet,maskInputOptions:this.maskInputOptions,maskAttributeFn:this.maskAttributeFn,maskTextFn:this.maskTextFn,maskInputFn:this.maskInputFn,slimDOMOptions:this.slimDOMOptions,dataURLOptions:this.dataURLOptions,recordCanvas:this.recordCanvas,inlineImages:this.inlineImages,onSerialize:f=>{U4(f,this.mirror)&&!ei(f,this.blockClass,this.blockSelector,this.unblockSelector,!1)&&this.iframeManager.addIframe(f),z4(f,this.mirror)&&this.stylesheetManager.trackLinkElement(f),wy(l)&&this.shadowDomManager.addShadowRoot(l.shadowRoot,this.doc)},onIframeLoad:(f,h)=>{ei(f,this.blockClass,this.blockSelector,this.unblockSelector,!1)||(this.iframeManager.attachIframe(f,h),f.contentWindow&&this.canvasManager.addWindow(f.contentWindow),this.shadowDomManager.observeAttachShadow(f))},onStylesheetLoad:(f,h)=>{this.stylesheetManager.attachLinkElement(f,h)}});d&&(e.push({parentId:c,nextId:u,node:d}),t.add(d.id))};for(;this.mapRemoves.length;)this.mirror.removeNodeFromMap(this.mapRemoves.shift());for(const l of this.movedSet)$4(this.removes,l,this.mirror)&&!this.movedSet.has(l.parentNode)||i(l);for(const l of this.addedSet)!Y4(this.droppedSet,l)&&!$4(this.removes,l,this.mirror)||Y4(this.movedSet,l)?i(l):this.droppedSet.add(l);let a=null;for(;r.length;){let l=null;if(a){const c=this.mirror.getId(a.value.parentNode),u=o(a.value);c!==-1&&u!==-1&&(l=a)}if(!l){let c=r.tail;for(;c;){const u=c;if(c=c.previous,u){const d=this.mirror.getId(u.value.parentNode);if(o(u.value)===-1)continue;if(d!==-1){l=u;break}else{const h=u.value;if(h.parentNode&&h.parentNode.nodeType===Node.DOCUMENT_FRAGMENT_NODE){const p=h.parentNode.host;if(this.mirror.getId(p)!==-1){l=u;break}}}}}}if(!l){for(;r.head;)r.removeNode(r.head.value);break}a=l.previous,r.removeNode(l.value),i(l.value)}const s={texts:this.texts.map(l=>({id:this.mirror.getId(l.node),value:l.value})).filter(l=>!t.has(l.id)).filter(l=>this.mirror.has(l.id)),attributes:this.attributes.map(l=>{const{attributes:c}=l;if(typeof c.style=="string"){const u=JSON.stringify(l.styleDiff),d=JSON.stringify(l._unchangedStyles);u.length<c.style.length&&(u+d).split("var(").length===c.style.split("var(").length&&(c.style=l.styleDiff)}return{id:this.mirror.getId(l.node),attributes:c}}).filter(l=>!t.has(l.id)).filter(l=>this.mirror.has(l.id)),removes:this.removes,adds:e};!s.texts.length&&!s.attributes.length&&!s.removes.length&&!s.adds.length||(this.texts=[],this.attributes=[],this.attributeMap=new WeakMap,this.removes=[],this.addedSet=new Set,this.movedSet=new Set,this.droppedSet=new Set,this.movedMap={},this.mutationCb(s))},this.processMutation=e=>{if(!Cy(e.target,this.mirror))switch(e.type){case"characterData":{const t=e.target.textContent;!ei(e.target,this.blockClass,this.blockSelector,this.unblockSelector,!1)&&t!==e.oldValue&&this.texts.push({value:hu(e.target,this.maskTextClass,this.maskTextSelector,this.unmaskTextClass,this.unmaskTextSelector,this.maskAllText)&&t?this.maskTextFn?this.maskTextFn(t,F4(e.target)):t.replace(/[\S]/g,"*"):t,node:e.target});break}case"attributes":{const t=e.target;let r=e.attributeName,o=e.target.getAttribute(r);if(r==="value"){const a=yy(t),s=t.tagName;o=mg(t,s,a);const l=pg({maskInputOptions:this.maskInputOptions,tagName:s,type:a}),c=hu(e.target,this.maskTextClass,this.maskTextSelector,this.unmaskTextClass,this.unmaskTextSelector,l);o=Xf({isMasked:c,element:t,value:o,maskInputFn:this.maskInputFn})}if(ei(e.target,this.blockClass,this.blockSelector,this.unblockSelector,!1)||o===e.oldValue)return;let i=this.attributeMap.get(e.target);if(t.tagName==="IFRAME"&&r==="src"&&!this.keepIframeSrcFn(o))if(!Ty(t))r="rr_src";else return;if(i||(i={node:e.target,attributes:{},styleDiff:{},_unchangedStyles:{}},this.attributes.push(i),this.attributeMap.set(e.target,i)),r==="type"&&t.tagName==="INPUT"&&(e.oldValue||"").toLowerCase()==="password"&&t.setAttribute("data-rr-is-password","true"),!L4(t.tagName,r)&&(i.attributes[r]=R4(this.doc,cu(t.tagName),cu(r),o,t,this.maskAttributeFn),r==="style")){if(!this.unattachedDoc)try{this.unattachedDoc=document.implementation.createHTMLDocument()}catch{this.unattachedDoc=this.doc}const a=this.unattachedDoc.createElement("span");e.oldValue&&a.setAttribute("style",e.oldValue);for(const s of Array.from(t.style)){const l=t.style.getPropertyValue(s),c=t.style.getPropertyPriority(s);l!==a.style.getPropertyValue(s)||c!==a.style.getPropertyPriority(s)?c===""?i.styleDiff[s]=l:i.styleDiff[s]=[l,c]:i._unchangedStyles[s]=[l,c]}for(const s of Array.from(a.style))t.style.getPropertyValue(s)===""&&(i.styleDiff[s]=!1)}break}case"childList":{if(ei(e.target,this.blockClass,this.blockSelector,this.unblockSelector,!0))return;e.addedNodes.forEach(t=>this.genAdds(t,e.target)),e.removedNodes.forEach(t=>{const r=this.mirror.getId(t),o=$f(e.target)?this.mirror.getId(e.target.host):this.mirror.getId(e.target);ei(e.target,this.blockClass,this.blockSelector,this.unblockSelector,!1)||Cy(t,this.mirror)||!LJ(t,this.mirror)||(this.addedSet.has(t)?(Iy(this.addedSet,t),this.droppedSet.add(t)):this.addedSet.has(e.target)&&r===-1||V4(e.target,this.mirror)||(this.movedSet.has(t)&&this.movedMap[Q4(r,o)]?Iy(this.movedSet,t):this.removes.push({parentId:o,id:r,isShadow:$f(e.target)&&Yf(e.target)?!0:void 0})),this.mapRemoves.push(t))});break}}},this.genAdds=(e,t)=>{if(!this.processedNodeManager.inOtherBuffer(e,this)&&!(this.addedSet.has(e)||this.movedSet.has(e))){if(this.mirror.hasNode(e)){if(Cy(e,this.mirror))return;this.movedSet.add(e);let r=null;t&&this.mirror.hasNode(t)&&(r=this.mirror.getId(t)),r&&r!==-1&&(this.movedMap[Q4(this.mirror.getId(e),r)]=!0)}else this.addedSet.add(e),this.droppedSet.delete(e);ei(e,this.blockClass,this.blockSelector,this.unblockSelector,!1)||(e.childNodes.forEach(r=>this.genAdds(r)),wy(e)&&e.shadowRoot.childNodes.forEach(r=>{this.processedNodeManager.add(r,this),this.genAdds(r,e)}))}}}init(e){["mutationCb","blockClass","blockSelector","unblockSelector","maskAllText","maskTextClass","unmaskTextClass","maskTextSelector","unmaskTextSelector","inlineStylesheet","maskInputOptions","maskAttributeFn","maskTextFn","maskInputFn","keepIframeSrcFn","recordCanvas","inlineImages","slimDOMOptions","dataURLOptions","doc","mirror","iframeManager","stylesheetManager","shadowDomManager","canvasManager","processedNodeManager"].forEach(t=>{this[t]=e[t]})}freeze(){this.frozen=!0,this.canvasManager.freeze()}unfreeze(){this.frozen=!1,this.canvasManager.unfreeze(),this.emit()}isFrozen(){return this.frozen}lock(){this.locked=!0,this.canvasManager.lock()}unlock(){this.locked=!1,this.canvasManager.unlock(),this.emit()}reset(){this.shadowDomManager.reset(),this.canvasManager.reset()}}function Iy(n,e){n.delete(e),e.childNodes.forEach(t=>Iy(n,t))}function $4(n,e,t){return n.length===0?!1:zJ(n,e,t)}function zJ(n,e,t){let r=e.parentNode;for(;r;){const o=t.getId(r);if(n.some(i=>i.id===o))return!0;r=r.parentNode}return!1}function Y4(n,e){return n.size===0?!1:X4(n,e)}function X4(n,e){const{parentNode:t}=e;return t?n.has(t)?!0:X4(n,t):!1}let Zf;function GJ(n){Zf=n}function HJ(){Zf=void 0}const an=n=>Zf?(...t)=>{try{return n(...t)}catch(r){if(Zf&&Zf(r)===!0)return()=>{};throw r}}:n,_u=[];function Jf(n){try{if("composedPath"in n){const e=n.composedPath();if(e.length)return e[0]}else if("path"in n&&n.path.length)return n.path[0]}catch{}return n&&n.target}function q4(n,e){var a,s;const t=new UJ;_u.push(t),t.init(n);let r=window.MutationObserver||window.__rrMutationObserver;const o=(s=(a=window==null?void 0:window.Zone)==null?void 0:a.__symbol__)==null?void 0:s.call(a,"MutationObserver");o&&window[o]&&(r=window[o]);const i=new r(an(l=>{n.onMutation&&n.onMutation(l)===!1||t.processMutations.bind(t)(l)}));return i.observe(e,{attributes:!0,attributeOldValue:!0,characterData:!0,characterDataOldValue:!0,childList:!0,subtree:!0}),i}function WJ({mousemoveCb:n,sampling:e,doc:t,mirror:r}){if(e.mousemove===!1)return()=>{};const o=typeof e.mousemove=="number"?e.mousemove:50,i=typeof e.mousemoveCallback=="number"?e.mousemoveCallback:500;let a=[],s;const l=Kf(an(d=>{const f=Date.now()-s;n(a.map(h=>(h.timeOffset-=f,h)),d),a=[],s=null}),i),c=an(Kf(an(d=>{const f=Jf(d),{clientX:h,clientY:p}=Sy(d)?d.changedTouches[0]:d;s||(s=vg()),a.push({x:h,y:p,id:r.getId(f),timeOffset:vg()-s}),l(typeof DragEvent<"u"&&d instanceof DragEvent?Ot.Drag:d instanceof MouseEvent?Ot.MouseMove:Ot.TouchMove)}),o,{trailing:!1})),u=[mo("mousemove",c,t),mo("touchmove",c,t),mo("drag",c,t)];return an(()=>{u.forEach(d=>d())})}function jJ({mouseInteractionCb:n,doc:e,mirror:t,blockClass:r,blockSelector:o,unblockSelector:i,sampling:a}){if(a.mouseInteraction===!1)return()=>{};const s=a.mouseInteraction===!0||a.mouseInteraction===void 0?{}:a.mouseInteraction,l=[];let c=null;const u=d=>f=>{const h=Jf(f);if(ei(h,r,o,i,!0))return;let p=null,m=d;if("pointerType"in f){switch(f.pointerType){case"mouse":p=is.Mouse;break;case"touch":p=is.Touch;break;case"pen":p=is.Pen;break}p===is.Touch?go[d]===go.MouseDown?m="TouchStart":go[d]===go.MouseUp&&(m="TouchEnd"):is.Pen}else Sy(f)&&(p=is.Touch);p!==null?(c=p,(m.startsWith("Touch")&&p===is.Touch||m.startsWith("Mouse")&&p===is.Mouse)&&(p=null)):go[d]===go.Click&&(p=c,c=null);const g=Sy(f)?f.changedTouches[0]:f;if(!g)return;const _=t.getId(h),{clientX:A,clientY:y}=g;an(n)({type:go[m],id:_,x:A,y,...p!==null&&{pointerType:p}})};return Object.keys(go).filter(d=>Number.isNaN(Number(d))&&!d.endsWith("_Departed")&&s[d]!==!1).forEach(d=>{let f=cu(d);const h=u(d);if(window.PointerEvent)switch(go[d]){case go.MouseDown:case go.MouseUp:f=f.replace("mouse","pointer");break;case go.TouchStart:case go.TouchEnd:return}l.push(mo(f,h,e))}),an(()=>{l.forEach(d=>d())})}function K4({scrollCb:n,doc:e,mirror:t,blockClass:r,blockSelector:o,unblockSelector:i,sampling:a}){const s=an(Kf(an(l=>{const c=Jf(l);if(!c||ei(c,r,o,i,!0))return;const u=t.getId(c);if(c===e&&e.defaultView){const d=N4(e.defaultView);n({id:u,x:d.left,y:d.top})}else n({id:u,x:c.scrollLeft,y:c.scrollTop})}),a.scroll||100));return mo("scroll",s,e)}function QJ({viewportResizeCb:n},{win:e}){let t=-1,r=-1;const o=an(Kf(an(()=>{const i=O4(),a=k4();(t!==i||r!==a)&&(n({width:Number(a),height:Number(i)}),t=i,r=a)}),200));return mo("resize",o,e)}const $J=["INPUT","TEXTAREA","SELECT"],Z4=new WeakMap;function YJ({inputCb:n,doc:e,mirror:t,blockClass:r,blockSelector:o,unblockSelector:i,ignoreClass:a,ignoreSelector:s,maskInputOptions:l,maskInputFn:c,sampling:u,userTriggeredOnInput:d,maskTextClass:f,unmaskTextClass:h,maskTextSelector:p,unmaskTextSelector:m}){function g(w){let L=Jf(w);const C=w.isTrusted,P=L&&Ay(L.tagName);if(P==="OPTION"&&(L=L.parentElement),!L||!P||$J.indexOf(P)<0||ei(L,r,o,i,!0))return;const D=L;if(D.classList.contains(a)||s&&D.matches(s))return;const Q=yy(L);let re=mg(D,P,Q),G=!1;const se=pg({maskInputOptions:l,tagName:P,type:Q}),ee=hu(L,f,p,h,m,se);(Q==="radio"||Q==="checkbox")&&(G=L.checked),re=Xf({isMasked:ee,element:L,value:re,maskInputFn:c}),_(L,d?{text:re,isChecked:G,userTriggered:C}:{text:re,isChecked:G});const ie=L.name;Q==="radio"&&ie&&G&&e.querySelectorAll(`input[type="radio"][name="${ie}"]`).forEach(H=>{if(H!==L){const T=Xf({isMasked:ee,element:H,value:mg(H,P,Q),maskInputFn:c});_(H,d?{text:T,isChecked:!G,userTriggered:!1}:{text:T,isChecked:!G})}})}function _(w,L){const C=Z4.get(w);if(!C||C.text!==L.text||C.isChecked!==L.isChecked){Z4.set(w,L);const P=t.getId(w);an(n)({...L,id:P})}}const y=(u.input==="last"?["change"]:["input","change"]).map(w=>mo(w,an(g),e)),b=e.defaultView;if(!b)return()=>{y.forEach(w=>w())};const E=b.Object.getOwnPropertyDescriptor(b.HTMLInputElement.prototype,"value"),x=[[b.HTMLInputElement.prototype,"value"],[b.HTMLInputElement.prototype,"checked"],[b.HTMLSelectElement.prototype,"value"],[b.HTMLTextAreaElement.prototype,"value"],[b.HTMLSelectElement.prototype,"selectedIndex"],[b.HTMLOptionElement.prototype,"selected"]];return E&&E.set&&y.push(...x.map(w=>B4(w[0],w[1],{set(){an(g)({target:this,isTrusted:!1})}},!1,b))),an(()=>{y.forEach(w=>w())})}function yg(n){const e=[];function t(r,o){if(bg("CSSGroupingRule")&&r.parentRule instanceof CSSGroupingRule||bg("CSSMediaRule")&&r.parentRule instanceof CSSMediaRule||bg("CSSSupportsRule")&&r.parentRule instanceof CSSSupportsRule||bg("CSSConditionRule")&&r.parentRule instanceof CSSConditionRule){const a=Array.from(r.parentRule.cssRules).indexOf(r);o.unshift(a)}else if(r.parentStyleSheet){const a=Array.from(r.parentStyleSheet.cssRules).indexOf(r);o.unshift(a)}return o}return t(n,e)}function qs(n,e,t){let r,o;return n?(n.ownerNode?r=e.getId(n.ownerNode):o=t.getId(n),{styleId:o,id:r}):{}}function XJ({styleSheetRuleCb:n,mirror:e,stylesheetManager:t},{win:r}){if(!r.CSSStyleSheet||!r.CSSStyleSheet.prototype)return()=>{};const o=r.CSSStyleSheet.prototype.insertRule;r.CSSStyleSheet.prototype.insertRule=new Proxy(o,{apply:an((u,d,f)=>{const[h,p]=f,{id:m,styleId:g}=qs(d,e,t.styleMirror);return(m&&m!==-1||g&&g!==-1)&&n({id:m,styleId:g,adds:[{rule:h,index:p}]}),u.apply(d,f)})});const i=r.CSSStyleSheet.prototype.deleteRule;r.CSSStyleSheet.prototype.deleteRule=new Proxy(i,{apply:an((u,d,f)=>{const[h]=f,{id:p,styleId:m}=qs(d,e,t.styleMirror);return(p&&p!==-1||m&&m!==-1)&&n({id:p,styleId:m,removes:[{index:h}]}),u.apply(d,f)})});let a;r.CSSStyleSheet.prototype.replace&&(a=r.CSSStyleSheet.prototype.replace,r.CSSStyleSheet.prototype.replace=new Proxy(a,{apply:an((u,d,f)=>{const[h]=f,{id:p,styleId:m}=qs(d,e,t.styleMirror);return(p&&p!==-1||m&&m!==-1)&&n({id:p,styleId:m,replace:h}),u.apply(d,f)})}));let s;r.CSSStyleSheet.prototype.replaceSync&&(s=r.CSSStyleSheet.prototype.replaceSync,r.CSSStyleSheet.prototype.replaceSync=new Proxy(s,{apply:an((u,d,f)=>{const[h]=f,{id:p,styleId:m}=qs(d,e,t.styleMirror);return(p&&p!==-1||m&&m!==-1)&&n({id:p,styleId:m,replaceSync:h}),u.apply(d,f)})}));const l={};xg("CSSGroupingRule")?l.CSSGroupingRule=r.CSSGroupingRule:(xg("CSSMediaRule")&&(l.CSSMediaRule=r.CSSMediaRule),xg("CSSConditionRule")&&(l.CSSConditionRule=r.CSSConditionRule),xg("CSSSupportsRule")&&(l.CSSSupportsRule=r.CSSSupportsRule));const c={};return Object.entries(l).forEach(([u,d])=>{c[u]={insertRule:d.prototype.insertRule,deleteRule:d.prototype.deleteRule},d.prototype.insertRule=new Proxy(c[u].insertRule,{apply:an((f,h,p)=>{const[m,g]=p,{id:_,styleId:A}=qs(h.parentStyleSheet,e,t.styleMirror);return(_&&_!==-1||A&&A!==-1)&&n({id:_,styleId:A,adds:[{rule:m,index:[...yg(h),g||0]}]}),f.apply(h,p)})}),d.prototype.deleteRule=new Proxy(c[u].deleteRule,{apply:an((f,h,p)=>{const[m]=p,{id:g,styleId:_}=qs(h.parentStyleSheet,e,t.styleMirror);return(g&&g!==-1||_&&_!==-1)&&n({id:g,styleId:_,removes:[{index:[...yg(h),m]}]}),f.apply(h,p)})})}),an(()=>{r.CSSStyleSheet.prototype.insertRule=o,r.CSSStyleSheet.prototype.deleteRule=i,a&&(r.CSSStyleSheet.prototype.replace=a),s&&(r.CSSStyleSheet.prototype.replaceSync=s),Object.entries(l).forEach(([u,d])=>{d.prototype.insertRule=c[u].insertRule,d.prototype.deleteRule=c[u].deleteRule})})}function J4({mirror:n,stylesheetManager:e},t){var a,s,l;let r=null;t.nodeName==="#document"?r=n.getId(t):r=n.getId(t.host);const o=t.nodeName==="#document"?(a=t.defaultView)==null?void 0:a.Document:(l=(s=t.ownerDocument)==null?void 0:s.defaultView)==null?void 0:l.ShadowRoot,i=o!=null&&o.prototype?Object.getOwnPropertyDescriptor(o==null?void 0:o.prototype,"adoptedStyleSheets"):void 0;return r===null||r===-1||!o||!i?()=>{}:(Object.defineProperty(t,"adoptedStyleSheets",{configurable:i.configurable,enumerable:i.enumerable,get(){var c;return(c=i.get)==null?void 0:c.call(this)},set(c){var d;const u=(d=i.set)==null?void 0:d.call(this,c);if(r!==null&&r!==-1)try{e.adoptStyleSheets(c,r)}catch{}return u}}),an(()=>{Object.defineProperty(t,"adoptedStyleSheets",{configurable:i.configurable,enumerable:i.enumerable,get:i.get,set:i.set})}))}function qJ({styleDeclarationCb:n,mirror:e,ignoreCSSAttributes:t,stylesheetManager:r},{win:o}){const i=o.CSSStyleDeclaration.prototype.setProperty;o.CSSStyleDeclaration.prototype.setProperty=new Proxy(i,{apply:an((s,l,c)=>{var m;const[u,d,f]=c;if(t.has(u))return i.apply(l,[u,d,f]);const{id:h,styleId:p}=qs((m=l.parentRule)==null?void 0:m.parentStyleSheet,e,r.styleMirror);return(h&&h!==-1||p&&p!==-1)&&n({id:h,styleId:p,set:{property:u,value:d,priority:f},index:yg(l.parentRule)}),s.apply(l,c)})});const a=o.CSSStyleDeclaration.prototype.removeProperty;return o.CSSStyleDeclaration.prototype.removeProperty=new Proxy(a,{apply:an((s,l,c)=>{var h;const[u]=c;if(t.has(u))return a.apply(l,[u]);const{id:d,styleId:f}=qs((h=l.parentRule)==null?void 0:h.parentStyleSheet,e,r.styleMirror);return(d&&d!==-1||f&&f!==-1)&&n({id:d,styleId:f,remove:{property:u},index:yg(l.parentRule)}),s.apply(l,c)})}),an(()=>{o.CSSStyleDeclaration.prototype.setProperty=i,o.CSSStyleDeclaration.prototype.removeProperty=a})}function KJ({mediaInteractionCb:n,blockClass:e,blockSelector:t,unblockSelector:r,mirror:o,sampling:i,doc:a}){const s=an(c=>Kf(an(u=>{const d=Jf(u);if(!d||ei(d,e,t,r,!0))return;const{currentTime:f,volume:h,muted:p,playbackRate:m}=d;n({type:c,id:o.getId(d),currentTime:f,volume:h,muted:p,playbackRate:m})}),i.media||500)),l=[mo("play",s(gu.Play),a),mo("pause",s(gu.Pause),a),mo("seeked",s(gu.Seeked),a),mo("volumechange",s(gu.VolumeChange),a),mo("ratechange",s(gu.RateChange),a)];return an(()=>{l.forEach(c=>c())})}function ZJ({fontCb:n,doc:e}){const t=e.defaultView;if(!t)return()=>{};const r=[],o=new WeakMap,i=t.FontFace;t.FontFace=function(l,c,u){const d=new i(l,c,u);return o.set(d,{family:l,buffer:typeof c!="string",descriptors:u,fontSource:typeof c=="string"?c:JSON.stringify(Array.from(new Uint8Array(c)))}),d};const a=Ey(e.fonts,"add",function(s){return function(l){return Ag(an(()=>{const c=o.get(l);c&&(n(c),o.delete(l))}),0),s.apply(this,[l])}});return r.push(()=>{t.FontFace=i}),r.push(a),an(()=>{r.forEach(s=>s())})}function JJ(n){const{doc:e,mirror:t,blockClass:r,blockSelector:o,unblockSelector:i,selectionCb:a}=n;let s=!0;const l=an(()=>{const c=e.getSelection();if(!c||s&&(c!=null&&c.isCollapsed))return;s=c.isCollapsed||!1;const u=[],d=c.rangeCount||0;for(let f=0;f<d;f++){const h=c.getRangeAt(f),{startContainer:p,startOffset:m,endContainer:g,endOffset:_}=h;ei(p,r,o,i,!0)||ei(g,r,o,i,!0)||u.push({start:t.getId(p),startOffset:m,end:t.getId(g),endOffset:_})}a({ranges:u})});return l(),mo("selectionchange",l)}function eee({doc:n,customElementCb:e}){const t=n.defaultView;return!t||!t.customElements?()=>{}:Ey(t.customElements,"define",function(o){return function(i,a,s){try{e({define:{name:i}})}catch{}return o.apply(this,[i,a,s])}})}function tee(n,e={}){const t=n.doc.defaultView;if(!t)return()=>{};let r;n.recordDOM&&(r=q4(n,n.doc));const o=WJ(n),i=jJ(n),a=K4(n),s=QJ(n,{win:t}),l=YJ(n),c=KJ(n);let u=()=>{},d=()=>{},f=()=>{},h=()=>{};n.recordDOM&&(u=XJ(n,{win:t}),d=J4(n,n.doc),f=qJ(n,{win:t}),n.collectFonts&&(h=ZJ(n)));const p=JJ(n),m=eee(n),g=[];for(const _ of n.plugins)g.push(_.observer(_.callback,t,_.options));return an(()=>{_u.forEach(_=>_.reset()),r==null||r.disconnect(),o(),i(),a(),s(),l(),c(),u(),d(),f(),h(),p(),m(),g.forEach(_=>_())})}function bg(n){return typeof window[n]<"u"}function xg(n){return!!(typeof window[n]<"u"&&window[n].prototype&&"insertRule"in window[n].prototype&&"deleteRule"in window[n].prototype)}class Ry{constructor(e){this.generateIdFn=e,this.iframeIdToRemoteIdMap=new WeakMap,this.iframeRemoteIdToIdMap=new WeakMap}getId(e,t,r,o){const i=r||this.getIdToRemoteIdMap(e),a=o||this.getRemoteIdToIdMap(e);let s=i.get(t);return s||(s=this.generateIdFn(),i.set(t,s),a.set(s,t)),s}getIds(e,t){const r=this.getIdToRemoteIdMap(e),o=this.getRemoteIdToIdMap(e);return t.map(i=>this.getId(e,i,r,o))}getRemoteId(e,t,r){const o=r||this.getRemoteIdToIdMap(e);if(typeof t!="number")return t;const i=o.get(t);return i||-1}getRemoteIds(e,t){const r=this.getRemoteIdToIdMap(e);return t.map(o=>this.getRemoteId(e,o,r))}reset(e){if(!e){this.iframeIdToRemoteIdMap=new WeakMap,this.iframeRemoteIdToIdMap=new WeakMap;return}this.iframeIdToRemoteIdMap.delete(e),this.iframeRemoteIdToIdMap.delete(e)}getIdToRemoteIdMap(e){let t=this.iframeIdToRemoteIdMap.get(e);return t||(t=new Map,this.iframeIdToRemoteIdMap.set(e,t)),t}getRemoteIdToIdMap(e){let t=this.iframeRemoteIdToIdMap.get(e);return t||(t=new Map,this.iframeRemoteIdToIdMap.set(e,t)),t}}class nee{constructor(){this.crossOriginIframeMirror=new Ry(xy),this.crossOriginIframeRootIdMap=new WeakMap}addIframe(){}addLoadListener(){}attachIframe(){}}class ree{constructor(e){this.iframes=new WeakMap,this.crossOriginIframeMap=new WeakMap,this.crossOriginIframeMirror=new Ry(xy),this.crossOriginIframeRootIdMap=new WeakMap,this.mutationCb=e.mutationCb,this.wrappedEmit=e.wrappedEmit,this.stylesheetManager=e.stylesheetManager,this.recordCrossOriginIframes=e.recordCrossOriginIframes,this.crossOriginIframeStyleMirror=new Ry(this.stylesheetManager.styleMirror.generateId.bind(this.stylesheetManager.styleMirror)),this.mirror=e.mirror,this.recordCrossOriginIframes&&window.addEventListener("message",this.handleMessage.bind(this))}addIframe(e){this.iframes.set(e,!0),e.contentWindow&&this.crossOriginIframeMap.set(e.contentWindow,e)}addLoadListener(e){this.loadListener=e}attachIframe(e,t){var o,i;this.mutationCb({adds:[{parentId:this.mirror.getId(e),nextId:null,node:t}],removes:[],texts:[],attributes:[],isAttachIframe:!0}),this.recordCrossOriginIframes&&((o=e.contentWindow)==null||o.addEventListener("message",this.handleMessage.bind(this))),(i=this.loadListener)==null||i.call(this,e);const r=Ty(e);r&&r.adoptedStyleSheets&&r.adoptedStyleSheets.length>0&&this.stylesheetManager.adoptStyleSheets(r.adoptedStyleSheets,this.mirror.getId(r))}handleMessage(e){const t=e;if(t.data.type!=="rrweb"||t.origin!==t.data.origin||!e.source)return;const o=this.crossOriginIframeMap.get(e.source);if(!o)return;const i=this.transformCrossOriginEvent(o,t.data.event);i&&this.wrappedEmit(i,t.data.isCheckout)}transformCrossOriginEvent(e,t){var r;switch(t.type){case Wt.FullSnapshot:{this.crossOriginIframeMirror.reset(e),this.crossOriginIframeStyleMirror.reset(e),this.replaceIdOnNode(t.data.node,e);const o=t.data.node.id;return this.crossOriginIframeRootIdMap.set(e,o),this.patchRootIdOnNode(t.data.node,o),{timestamp:t.timestamp,type:Wt.IncrementalSnapshot,data:{source:Ot.Mutation,adds:[{parentId:this.mirror.getId(e),nextId:null,node:t.data.node}],removes:[],texts:[],attributes:[],isAttachIframe:!0}}}case Wt.Meta:case Wt.Load:case Wt.DomContentLoaded:return!1;case Wt.Plugin:return t;case Wt.Custom:return this.replaceIds(t.data.payload,e,["id","parentId","previousId","nextId"]),t;case Wt.IncrementalSnapshot:switch(t.data.source){case Ot.Mutation:return t.data.adds.forEach(o=>{this.replaceIds(o,e,["parentId","nextId","previousId"]),this.replaceIdOnNode(o.node,e);const i=this.crossOriginIframeRootIdMap.get(e);i&&this.patchRootIdOnNode(o.node,i)}),t.data.removes.forEach(o=>{this.replaceIds(o,e,["parentId","id"])}),t.data.attributes.forEach(o=>{this.replaceIds(o,e,["id"])}),t.data.texts.forEach(o=>{this.replaceIds(o,e,["id"])}),t;case Ot.Drag:case Ot.TouchMove:case Ot.MouseMove:return t.data.positions.forEach(o=>{this.replaceIds(o,e,["id"])}),t;case Ot.ViewportResize:return!1;case Ot.MediaInteraction:case Ot.MouseInteraction:case Ot.Scroll:case Ot.CanvasMutation:case Ot.Input:return this.replaceIds(t.data,e,["id"]),t;case Ot.StyleSheetRule:case Ot.StyleDeclaration:return this.replaceIds(t.data,e,["id"]),this.replaceStyleIds(t.data,e,["styleId"]),t;case Ot.Font:return t;case Ot.Selection:return t.data.ranges.forEach(o=>{this.replaceIds(o,e,["start","end"])}),t;case Ot.AdoptedStyleSheet:return this.replaceIds(t.data,e,["id"]),this.replaceStyleIds(t.data,e,["styleIds"]),(r=t.data.styles)==null||r.forEach(o=>{this.replaceStyleIds(o,e,["styleId"])}),t}}return!1}replace(e,t,r,o){for(const i of o)!Array.isArray(t[i])&&typeof t[i]!="number"||(Array.isArray(t[i])?t[i]=e.getIds(r,t[i]):t[i]=e.getId(r,t[i]));return t}replaceIds(e,t,r){return this.replace(this.crossOriginIframeMirror,e,t,r)}replaceStyleIds(e,t,r){return this.replace(this.crossOriginIframeStyleMirror,e,t,r)}replaceIdOnNode(e,t){this.replaceIds(e,t,["id","rootId"]),"childNodes"in e&&e.childNodes.forEach(r=>{this.replaceIdOnNode(r,t)})}patchRootIdOnNode(e,t){e.type!==Dr.Document&&!e.rootId&&(e.rootId=t),"childNodes"in e&&e.childNodes.forEach(r=>{this.patchRootIdOnNode(r,t)})}}class oee{init(){}addShadowRoot(){}observeAttachShadow(){}reset(){}}class iee{constructor(e){this.shadowDoms=new WeakSet,this.restoreHandlers=[],this.mutationCb=e.mutationCb,this.scrollCb=e.scrollCb,this.bypassOptions=e.bypassOptions,this.mirror=e.mirror,this.init()}init(){this.reset(),this.patchAttachShadow(Element,document)}addShadowRoot(e,t){if(!Yf(e)||this.shadowDoms.has(e))return;this.shadowDoms.add(e),this.bypassOptions.canvasManager.addShadowRoot(e);const r=q4({...this.bypassOptions,doc:t,mutationCb:this.mutationCb,mirror:this.mirror,shadowDomManager:this},e);this.restoreHandlers.push(()=>r.disconnect()),this.restoreHandlers.push(K4({...this.bypassOptions,scrollCb:this.scrollCb,doc:e,mirror:this.mirror})),Ag(()=>{e.adoptedStyleSheets&&e.adoptedStyleSheets.length>0&&this.bypassOptions.stylesheetManager.adoptStyleSheets(e.adoptedStyleSheets,this.mirror.getId(e.host)),this.restoreHandlers.push(J4({mirror:this.mirror,stylesheetManager:this.bypassOptions.stylesheetManager},e))},0)}observeAttachShadow(e){const t=Ty(e),r=FJ(e);!t||!r||this.patchAttachShadow(r.Element,t)}patchAttachShadow(e,t){const r=this;this.restoreHandlers.push(Ey(e.prototype,"attachShadow",function(o){return function(i){const a=o.call(this,i);return this.shadowRoot&&H4(this)&&r.addShadowRoot(this.shadowRoot,t),a}}))}reset(){this.restoreHandlers.forEach(e=>{try{e()}catch{}}),this.restoreHandlers=[],this.shadowDoms=new WeakSet,this.bypassOptions.canvasManager.resetShadowRoots()}}for(var e5="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",aee=typeof Uint8Array>"u"?[]:new Uint8Array(256),Eg=0;Eg<e5.length;Eg++)aee[e5.charCodeAt(Eg)]=Eg;class t5{reset(){}freeze(){}unfreeze(){}lock(){}unlock(){}snapshot(){}addWindow(){}addShadowRoot(){}resetShadowRoots(){}}class see{constructor(e){this.trackedLinkElements=new WeakSet,this.styleMirror=new DJ,this.mutationCb=e.mutationCb,this.adoptedStyleSheetCb=e.adoptedStyleSheetCb}attachLinkElement(e,t){"_cssText"in t.attributes&&this.mutationCb({adds:[],removes:[],texts:[],attributes:[{id:t.id,attributes:t.attributes}]}),this.trackLinkElement(e)}trackLinkElement(e){this.trackedLinkElements.has(e)||(this.trackedLinkElements.add(e),this.trackStylesheetInLinkElement(e))}adoptStyleSheets(e,t){if(e.length===0)return;const r={id:t,styleIds:[]},o=[];for(const i of e){let a;this.styleMirror.has(i)?a=this.styleMirror.getId(i):(a=this.styleMirror.add(i),o.push({styleId:a,rules:Array.from(i.rules||CSSRule,(s,l)=>({rule:y4(s),index:l}))})),r.styleIds.push(a)}o.length>0&&(r.styles=o),this.adoptedStyleSheetCb(r)}reset(){this.styleMirror.reset(),this.trackedLinkElements=new WeakSet}trackStylesheetInLinkElement(e){}}class lee{constructor(){this.nodeMap=new WeakMap,this.active=!1}inOtherBuffer(e,t){const r=this.nodeMap.get(e);return r&&Array.from(r).some(o=>o!==t)}add(e,t){this.active||(this.active=!0,OJ(()=>{this.nodeMap=new WeakMap,this.active=!1})),this.nodeMap.set(e,(this.nodeMap.get(e)||new Set).add(t))}destroy(){}}let er,Cg;try{if(Array.from([1],n=>n*2)[0]!==2){const n=document.createElement("iframe");document.body.appendChild(n),Array.from=((AN=n.contentWindow)==null?void 0:AN.Array.from)||Array.from,document.body.removeChild(n)}}catch(n){console.debug("Unable to override Array.from",n)}const Wi=lJ();function as(n={}){const{emit:e,checkoutEveryNms:t,checkoutEveryNth:r,blockClass:o="rr-block",blockSelector:i=null,unblockSelector:a=null,ignoreClass:s="rr-ignore",ignoreSelector:l=null,maskAllText:c=!1,maskTextClass:u="rr-mask",unmaskTextClass:d=null,maskTextSelector:f=null,unmaskTextSelector:h=null,inlineStylesheet:p=!0,maskAllInputs:m,maskInputOptions:g,slimDOMOptions:_,maskAttributeFn:A,maskInputFn:y,maskTextFn:b,maxCanvasSize:E=null,packFn:x,sampling:w={},dataURLOptions:L={},mousemoveWait:C,recordDOM:P=!0,recordCanvas:D=!1,recordCrossOriginIframes:Q=!1,recordAfter:re=n.recordAfter==="DOMContentLoaded"?n.recordAfter:"load",userTriggeredOnInput:G=!1,collectFonts:se=!1,inlineImages:ee=!1,plugins:ie,keepIframeSrcFn:H=()=>!1,ignoreCSSAttributes:T=new Set([]),errorHandler:R,onMutation:O,getCanvasManager:W}=n;GJ(R);const ae=Q?window.parent===window:!0;let ne=!1;if(!ae)try{window.parent.document&&(ne=!1)}catch{ne=!0}if(ae&&!e)throw new Error("emit function is required");if(!ae&&!ne)return()=>{};C!==void 0&&w.mousemove===void 0&&(w.mousemove=C),Wi.reset();const oe=m===!0?{color:!0,date:!0,"datetime-local":!0,email:!0,month:!0,number:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0,textarea:!0,select:!0,radio:!0,checkbox:!0}:g!==void 0?g:{},F=_===!0||_==="all"?{script:!0,comment:!0,headFavicon:!0,headWhitespace:!0,headMetaSocial:!0,headMetaRobots:!0,headMetaHttpEquiv:!0,headMetaVerification:!0,headMetaAuthorship:_==="all",headMetaDescKeywords:_==="all"}:_||{};PJ();let k,q=0;const j=Y=>{for(const le of ie||[])le.eventProcessor&&(Y=le.eventProcessor(Y));return x&&!ne&&(Y=x(Y)),Y};er=(Y,le)=>{var fe;const me=Y;if(me.timestamp=vg(),(fe=_u[0])!=null&&fe.isFrozen()&&me.type!==Wt.FullSnapshot&&!(me.type===Wt.IncrementalSnapshot&&me.data.source===Ot.Mutation)&&_u.forEach(te=>te.unfreeze()),ae)e==null||e(j(me),le);else if(ne){const te={type:"rrweb",event:j(me),origin:window.location.origin,isCheckout:le};window.parent.postMessage(te,"*")}if(me.type===Wt.FullSnapshot)k=me,q=0;else if(me.type===Wt.IncrementalSnapshot){if(me.data.source===Ot.Mutation&&me.data.isAttachIframe)return;q++;const te=r&&q>=r,de=t&&k&&me.timestamp-k.timestamp>t;(te||de)&&V(!0)}};const U=Y=>{er({type:Wt.IncrementalSnapshot,data:{source:Ot.Mutation,...Y}})},z=Y=>er({type:Wt.IncrementalSnapshot,data:{source:Ot.Scroll,...Y}}),v=Y=>er({type:Wt.IncrementalSnapshot,data:{source:Ot.CanvasMutation,...Y}}),M=Y=>er({type:Wt.IncrementalSnapshot,data:{source:Ot.AdoptedStyleSheet,...Y}}),S=new see({mutationCb:U,adoptedStyleSheetCb:M}),I=typeof __RRWEB_EXCLUDE_IFRAME__=="boolean"&&__RRWEB_EXCLUDE_IFRAME__?new nee:new ree({mirror:Wi,mutationCb:U,stylesheetManager:S,recordCrossOriginIframes:Q,wrappedEmit:er});for(const Y of ie||[])Y.getMirror&&Y.getMirror({nodeMirror:Wi,crossOriginIframeMirror:I.crossOriginIframeMirror,crossOriginIframeStyleMirror:I.crossOriginIframeStyleMirror});const J=new lee,$=uee(W,{mirror:Wi,win:window,mutationCb:Y=>er({type:Wt.IncrementalSnapshot,data:{source:Ot.CanvasMutation,...Y}}),recordCanvas:D,blockClass:o,blockSelector:i,unblockSelector:a,maxCanvasSize:E,sampling:w.canvas,dataURLOptions:L,errorHandler:R}),B=typeof __RRWEB_EXCLUDE_SHADOW_DOM__=="boolean"&&__RRWEB_EXCLUDE_SHADOW_DOM__?new oee:new iee({mutationCb:U,scrollCb:z,bypassOptions:{onMutation:O,blockClass:o,blockSelector:i,unblockSelector:a,maskAllText:c,maskTextClass:u,unmaskTextClass:d,maskTextSelector:f,unmaskTextSelector:h,inlineStylesheet:p,maskInputOptions:oe,dataURLOptions:L,maskAttributeFn:A,maskTextFn:b,maskInputFn:y,recordCanvas:D,inlineImages:ee,sampling:w,slimDOMOptions:F,iframeManager:I,stylesheetManager:S,canvasManager:$,keepIframeSrcFn:H,processedNodeManager:J},mirror:Wi}),V=(Y=!1)=>{if(!P)return;er({type:Wt.Meta,data:{href:window.location.href,width:k4(),height:O4()}},Y),S.reset(),B.init(),_u.forEach(me=>me.lock());const le=RJ(document,{mirror:Wi,blockClass:o,blockSelector:i,unblockSelector:a,maskAllText:c,maskTextClass:u,unmaskTextClass:d,maskTextSelector:f,unmaskTextSelector:h,inlineStylesheet:p,maskAllInputs:oe,maskAttributeFn:A,maskInputFn:y,maskTextFn:b,slimDOM:F,dataURLOptions:L,recordCanvas:D,inlineImages:ee,onSerialize:me=>{U4(me,Wi)&&I.addIframe(me),z4(me,Wi)&&S.trackLinkElement(me),wy(me)&&B.addShadowRoot(me.shadowRoot,document)},onIframeLoad:(me,fe)=>{I.attachIframe(me,fe),me.contentWindow&&$.addWindow(me.contentWindow),B.observeAttachShadow(me)},onStylesheetLoad:(me,fe)=>{S.attachLinkElement(me,fe)},keepIframeSrcFn:H});if(!le)return console.warn("Failed to snapshot the document");er({type:Wt.FullSnapshot,data:{node:le,initialOffset:N4(window)}}),_u.forEach(me=>me.unlock()),document.adoptedStyleSheets&&document.adoptedStyleSheets.length>0&&S.adoptStyleSheets(document.adoptedStyleSheets,Wi.getId(document))};Cg=V;try{const Y=[],le=fe=>{var te;return an(tee)({onMutation:O,mutationCb:U,mousemoveCb:(de,we)=>er({type:Wt.IncrementalSnapshot,data:{source:we,positions:de}}),mouseInteractionCb:de=>er({type:Wt.IncrementalSnapshot,data:{source:Ot.MouseInteraction,...de}}),scrollCb:z,viewportResizeCb:de=>er({type:Wt.IncrementalSnapshot,data:{source:Ot.ViewportResize,...de}}),inputCb:de=>er({type:Wt.IncrementalSnapshot,data:{source:Ot.Input,...de}}),mediaInteractionCb:de=>er({type:Wt.IncrementalSnapshot,data:{source:Ot.MediaInteraction,...de}}),styleSheetRuleCb:de=>er({type:Wt.IncrementalSnapshot,data:{source:Ot.StyleSheetRule,...de}}),styleDeclarationCb:de=>er({type:Wt.IncrementalSnapshot,data:{source:Ot.StyleDeclaration,...de}}),canvasMutationCb:v,fontCb:de=>er({type:Wt.IncrementalSnapshot,data:{source:Ot.Font,...de}}),selectionCb:de=>{er({type:Wt.IncrementalSnapshot,data:{source:Ot.Selection,...de}})},customElementCb:de=>{er({type:Wt.IncrementalSnapshot,data:{source:Ot.CustomElement,...de}})},blockClass:o,ignoreClass:s,ignoreSelector:l,maskAllText:c,maskTextClass:u,unmaskTextClass:d,maskTextSelector:f,unmaskTextSelector:h,maskInputOptions:oe,inlineStylesheet:p,sampling:w,recordDOM:P,recordCanvas:D,inlineImages:ee,userTriggeredOnInput:G,collectFonts:se,doc:fe,maskAttributeFn:A,maskInputFn:y,maskTextFn:b,keepIframeSrcFn:H,blockSelector:i,unblockSelector:a,slimDOMOptions:F,dataURLOptions:L,mirror:Wi,iframeManager:I,stylesheetManager:S,shadowDomManager:B,processedNodeManager:J,canvasManager:$,ignoreCSSAttributes:T,plugins:((te=ie==null?void 0:ie.filter(de=>de.observer))==null?void 0:te.map(de=>({observer:de.observer,options:de.options,callback:we=>er({type:Wt.Plugin,data:{plugin:de.name,payload:we}})})))||[]},{})};I.addLoadListener(fe=>{try{Y.push(le(fe.contentDocument))}catch(te){console.warn(te)}});const me=()=>{V(),Y.push(le(document))};return document.readyState==="interactive"||document.readyState==="complete"?me():(Y.push(mo("DOMContentLoaded",()=>{er({type:Wt.DomContentLoaded,data:{}}),re==="DOMContentLoaded"&&me()})),Y.push(mo("load",()=>{er({type:Wt.Load,data:{}}),re==="load"&&me()},window))),()=>{Y.forEach(fe=>fe()),J.destroy(),Cg=void 0,HJ()}}catch(Y){console.warn(Y)}}function cee(n){if(!Cg)throw new Error("please take full snapshot after start recording");Cg(n)}as.mirror=Wi,as.takeFullSnapshot=cee;function uee(n,e){try{return n?n(e):new t5}catch{return console.warn("Unable to initialize CanvasManager"),new t5}}var n5;(function(n){n[n.NotStarted=0]="NotStarted",n[n.Running=1]="Running",n[n.Stopped=2]="Stopped"})(n5||(n5={}));const dee=3,fee=5;function Ly(n){return n>9999999999?n:n*1e3}function Py(n){return n>9999999999?n/1e3:n}function eh(n,e){e.category!=="sentry.transaction"&&(["ui.click","ui.input"].includes(e.category)?n.triggerUserActivity():n.checkAndHandleExpiredSession(),n.addUpdate(()=>(n.throttledAddEvent({type:Wt.Custom,timestamp:(e.timestamp||0)*1e3,data:{tag:"breadcrumb",payload:Hi(e,10,1e3)}}),e.category==="console")))}const hee="button,a";function r5(n){return n.closest(hee)||n}function o5(n){const e=i5(n);return!e||!(e instanceof Element)?e:r5(e)}function i5(n){return pee(n)?n.target:n}function pee(n){return typeof n=="object"&&!!n&&"target"in n}let Ks;function mee(n){return Ks||(Ks=[],gee()),Ks.push(n),()=>{const e=Ks?Ks.indexOf(n):-1;e>-1&&Ks.splice(e,1)}}function gee(){Oo(On,"open",function(n){return function(...e){if(Ks)try{Ks.forEach(t=>t())}catch{}return n.apply(On,e)}})}const _ee=new Set([Ot.Mutation,Ot.StyleSheetRule,Ot.StyleDeclaration,Ot.AdoptedStyleSheet,Ot.CanvasMutation,Ot.Selection,Ot.MediaInteraction]);function vee(n,e,t){n.handleClick(e,t)}class Aee{constructor(e,t,r=eh){this._lastMutation=0,this._lastScroll=0,this._clicks=[],this._timeout=t.timeout/1e3,this._threshold=t.threshold/1e3,this._scrollTimeout=t.scrollTimeout/1e3,this._replay=e,this._ignoreSelector=t.ignoreSelector,this._addBreadcrumbEvent=r}addListeners(){const e=mee(()=>{this._lastMutation=a5()});this._teardown=()=>{e(),this._clicks=[],this._lastMutation=0,this._lastScroll=0}}removeListeners(){this._teardown&&this._teardown(),this._checkClickTimeout&&clearTimeout(this._checkClickTimeout)}handleClick(e,t){if(bee(t,this._ignoreSelector)||!xee(e))return;const r={timestamp:Py(e.timestamp),clickBreadcrumb:e,clickCount:0,node:t};this._clicks.some(o=>o.node===r.node&&Math.abs(o.timestamp-r.timestamp)<1)||(this._clicks.push(r),this._clicks.length===1&&this._scheduleCheckClicks())}registerMutation(e=Date.now()){this._lastMutation=Py(e)}registerScroll(e=Date.now()){this._lastScroll=Py(e)}registerClick(e){const t=r5(e);this._handleMultiClick(t)}_handleMultiClick(e){this._getClicks(e).forEach(t=>{t.clickCount++})}_getClicks(e){return this._clicks.filter(t=>t.node===e)}_checkClicks(){const e=[],t=a5();this._clicks.forEach(r=>{!r.mutationAfter&&this._lastMutation&&(r.mutationAfter=r.timestamp<=this._lastMutation?this._lastMutation-r.timestamp:void 0),!r.scrollAfter&&this._lastScroll&&(r.scrollAfter=r.timestamp<=this._lastScroll?this._lastScroll-r.timestamp:void 0),r.timestamp+this._timeout<=t&&e.push(r)});for(const r of e){const o=this._clicks.indexOf(r);o>-1&&(this._generateBreadcrumbs(r),this._clicks.splice(o,1))}this._clicks.length&&this._scheduleCheckClicks()}_generateBreadcrumbs(e){const t=this._replay,r=e.scrollAfter&&e.scrollAfter<=this._scrollTimeout,o=e.mutationAfter&&e.mutationAfter<=this._threshold,i=!r&&!o,{clickCount:a,clickBreadcrumb:s}=e;if(i){const l=Math.min(e.mutationAfter||this._timeout,this._timeout)*1e3,c=l<this._timeout*1e3?"mutation":"timeout",u={type:"default",message:s.message,timestamp:s.timestamp,category:"ui.slowClickDetected",data:{...s.data,url:On.location.href,route:t.getCurrentRoute(),timeAfterClickMs:l,endReason:c,clickCount:a||1}};this._addBreadcrumbEvent(t,u);return}if(a>1){const l={type:"default",message:s.message,timestamp:s.timestamp,category:"ui.multiClick",data:{...s.data,url:On.location.href,route:t.getCurrentRoute(),clickCount:a,metric:!0}};this._addBreadcrumbEvent(t,l)}}_scheduleCheckClicks(){this._checkClickTimeout&&clearTimeout(this._checkClickTimeout),this._checkClickTimeout=Qf(()=>this._checkClicks(),1e3)}}const yee=["A","BUTTON","INPUT"];function bee(n,e){return!!(!yee.includes(n.tagName)||n.tagName==="INPUT"&&!["submit","button"].includes(n.getAttribute("type")||"")||n.tagName==="A"&&(n.hasAttribute("download")||n.hasAttribute("target")&&n.getAttribute("target")!=="_self")||e&&n.matches(e))}function xee(n){return!!(n.data&&typeof n.data.nodeId=="number"&&n.timestamp)}function a5(){return Date.now()/1e3}function Eee(n,e){try{if(!Cee(e))return;const{source:t}=e.data;if(_ee.has(t)&&n.registerMutation(e.timestamp),t===Ot.Scroll&&n.registerScroll(e.timestamp),See(e)){const{type:r,id:o}=e.data,i=as.mirror.getNode(o);i instanceof HTMLElement&&r===go.Click&&n.registerClick(i)}}catch{}}function Cee(n){return n.type===dee}function See(n){return n.data.source===Ot.MouseInteraction}function va(n){return{timestamp:Date.now()/1e3,type:"default",...n}}var Dy=(n=>(n[n.Document=0]="Document",n[n.DocumentType=1]="DocumentType",n[n.Element=2]="Element",n[n.Text=3]="Text",n[n.CDATA=4]="CDATA",n[n.Comment=5]="Comment",n))(Dy||{});const wee=new Set(["id","class","aria-label","role","name","alt","title","data-test-id","data-testid","disabled","aria-disabled","data-sentry-component"]);function Mee(n){const e={};!n["data-sentry-component"]&&n["data-sentry-element"]&&(n["data-sentry-component"]=n["data-sentry-element"]);for(const t in n)if(wee.has(t)){let r=t;(t==="data-testid"||t==="data-test-id")&&(r="testId"),e[r]=n[t]}return e}const Tee=n=>e=>{if(!n.isEnabled())return;const t=Iee(e);if(!t)return;const r=e.name==="click",o=r?e.event:void 0;r&&n.clickDetector&&(o!=null&&o.target)&&!o.altKey&&!o.metaKey&&!o.ctrlKey&&!o.shiftKey&&vee(n.clickDetector,t,o5(e.event)),eh(n,t)};function s5(n,e){const t=as.mirror.getId(n),r=t&&as.mirror.getNode(t),o=r&&as.mirror.getMeta(r),i=o&&Lee(o)?o:null;return{message:e,data:i?{nodeId:t,node:{id:t,tagName:i.tagName,textContent:Array.from(i.childNodes).map(a=>a.type===Dy.Text&&a.textContent).filter(Boolean).map(a=>a.trim()).join(""),attributes:Mee(i.attributes)}}:{}}}function Iee(n){const{target:e,message:t}=Ree(n);return va({category:`ui.${n.name}`,...s5(e,t)})}function Ree(n){const e=n.name==="click";let t,r=null;try{r=e?o5(n.event):i5(n.event),t=Fm(r,{maxStringLength:200})||"<unknown>"}catch{t="<unknown>"}return{target:r,message:t}}function Lee(n){return n.type===Dy.Element}function Pee(n,e){if(!n.isEnabled())return;n.updateUserActivity();const t=Dee(e);t&&eh(n,t)}function Dee(n){const{metaKey:e,shiftKey:t,ctrlKey:r,altKey:o,key:i,target:a}=n;if(!a||Bee(a)||!i)return null;const s=e||r||o,l=i.length===1;if(!s&&l)return null;const c=Fm(a,{maxStringLength:200})||"<unknown>",u=s5(a,c);return va({category:"ui.keyDown",message:c,data:{...u.data,metaKey:e,shiftKey:t,ctrlKey:r,altKey:o,key:i}})}function Bee(n){return n.tagName==="INPUT"||n.tagName==="TEXTAREA"||n.isContentEditable}const Nee={resource:Uee,paint:Fee,navigation:Vee};function Sg(n,e){return({metric:t})=>void e.replayPerformanceEntries.push(n(t))}function Oee(n){return n.map(kee).filter(Boolean)}function kee(n){const e=Nee[n.entryType];return e?e(n):null}function vu(n){return((pY()||On.performance.timeOrigin)+n)/1e3}function Fee(n){const{duration:e,entryType:t,name:r,startTime:o}=n,i=vu(o);return{type:t,name:r,start:i,end:i+e,data:void 0}}function Vee(n){const{entryType:e,name:t,decodedBodySize:r,duration:o,domComplete:i,encodedBodySize:a,domContentLoadedEventStart:s,domContentLoadedEventEnd:l,domInteractive:c,loadEventStart:u,loadEventEnd:d,redirectCount:f,startTime:h,transferSize:p,type:m}=n;return o===0?null:{type:`${e}.${m}`,start:vu(h),end:vu(i),name:t,data:{size:p,decodedBodySize:r,encodedBodySize:a,duration:o,domInteractive:c,domContentLoadedEventStart:s,domContentLoadedEventEnd:l,loadEventStart:u,loadEventEnd:d,domComplete:i,redirectCount:f}}}function Uee(n){const{entryType:e,initiatorType:t,name:r,responseEnd:o,startTime:i,decodedBodySize:a,encodedBodySize:s,responseStatus:l,transferSize:c}=n;return["fetch","xmlhttprequest"].includes(t)?null:{type:`${e}.${t}`,start:vu(i),end:vu(o),name:r,data:{size:c,statusCode:l,decodedBodySize:a,encodedBodySize:s}}}function zee(n){const e=n.entries[n.entries.length-1],t=e!=null&&e.element?[e.element]:void 0;return wg(n,"largest-contentful-paint",t)}function Gee(n){return n.sources!==void 0}function Hee(n){const e=[],t=[];for(const r of n.entries)if(Gee(r)){const o=[];for(const i of r.sources)if(i.node){t.push(i.node);const a=as.mirror.getId(i.node);a&&o.push(a)}e.push({value:r.value,nodeIds:o.length?o:void 0})}return wg(n,"cumulative-layout-shift",t,e)}function Wee(n){const e=n.entries[n.entries.length-1],t=e!=null&&e.target?[e.target]:void 0;return wg(n,"first-input-delay",t)}function jee(n){const e=n.entries[n.entries.length-1],t=e!=null&&e.target?[e.target]:void 0;return wg(n,"interaction-to-next-paint",t)}function wg(n,e,t,r){const o=n.value,i=n.rating,a=vu(o);return{type:"web-vital",name:e,start:a,end:a,data:{value:o,size:o,rating:i,nodeIds:t?t.map(s=>as.mirror.getId(s)):void 0,attributions:r}}}function Qee(n){function e(o){n.performanceEntries.includes(o)||n.performanceEntries.push(o)}function t({entries:o}){o.forEach(e)}const r=[];return["navigation","paint","resource"].forEach(o=>{r.push(OK(o,t))}),r.push(DK(Sg(zee,n)),PK(Sg(Hee,n)),BK(Sg(Wee,n)),NK(Sg(jee,n))),()=>{r.forEach(o=>o())}}const Pt=typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__,$ee='var t=Uint8Array,n=Uint16Array,r=Int32Array,e=new t([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),i=new t([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),s=new t([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),a=function(t,e){for(var i=new n(31),s=0;s<31;++s)i[s]=e+=1<<t[s-1];var a=new r(i[30]);for(s=1;s<30;++s)for(var o=i[s];o<i[s+1];++o)a[o]=o-i[s]<<5|s;return{b:i,r:a}},o=a(e,2),h=o.b,f=o.r;h[28]=258,f[258]=28;for(var l=a(i,0).r,u=new n(32768),c=0;c<32768;++c){var v=(43690&c)>>1|(21845&c)<<1;v=(61680&(v=(52428&v)>>2|(13107&v)<<2))>>4|(3855&v)<<4,u[c]=((65280&v)>>8|(255&v)<<8)>>1}var d=function(t,r,e){for(var i=t.length,s=0,a=new n(r);s<i;++s)t[s]&&++a[t[s]-1];var o,h=new n(r);for(s=1;s<r;++s)h[s]=h[s-1]+a[s-1]<<1;if(e){o=new n(1<<r);var f=15-r;for(s=0;s<i;++s)if(t[s])for(var l=s<<4|t[s],c=r-t[s],v=h[t[s]-1]++<<c,d=v|(1<<c)-1;v<=d;++v)o[u[v]>>f]=l}else for(o=new n(i),s=0;s<i;++s)t[s]&&(o[s]=u[h[t[s]-1]++]>>15-t[s]);return o},p=new t(288);for(c=0;c<144;++c)p[c]=8;for(c=144;c<256;++c)p[c]=9;for(c=256;c<280;++c)p[c]=7;for(c=280;c<288;++c)p[c]=8;var g=new t(32);for(c=0;c<32;++c)g[c]=5;var w=d(p,9,0),y=d(g,5,0),m=function(t){return(t+7)/8|0},b=function(n,r,e){return(null==e||e>n.length)&&(e=n.length),new t(n.subarray(r,e))},M=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],E=function(t,n,r){var e=new Error(n||M[t]);if(e.code=t,Error.captureStackTrace&&Error.captureStackTrace(e,E),!r)throw e;return e},z=function(t,n,r){r<<=7&n;var e=n/8|0;t[e]|=r,t[e+1]|=r>>8},_=function(t,n,r){r<<=7&n;var e=n/8|0;t[e]|=r,t[e+1]|=r>>8,t[e+2]|=r>>16},x=function(r,e){for(var i=[],s=0;s<r.length;++s)r[s]&&i.push({s:s,f:r[s]});var a=i.length,o=i.slice();if(!a)return{t:F,l:0};if(1==a){var h=new t(i[0].s+1);return h[i[0].s]=1,{t:h,l:1}}i.sort(function(t,n){return t.f-n.f}),i.push({s:-1,f:25001});var f=i[0],l=i[1],u=0,c=1,v=2;for(i[0]={s:-1,f:f.f+l.f,l:f,r:l};c!=a-1;)f=i[i[u].f<i[v].f?u++:v++],l=i[u!=c&&i[u].f<i[v].f?u++:v++],i[c++]={s:-1,f:f.f+l.f,l:f,r:l};var d=o[0].s;for(s=1;s<a;++s)o[s].s>d&&(d=o[s].s);var p=new n(d+1),g=A(i[c-1],p,0);if(g>e){s=0;var w=0,y=g-e,m=1<<y;for(o.sort(function(t,n){return p[n.s]-p[t.s]||t.f-n.f});s<a;++s){var b=o[s].s;if(!(p[b]>e))break;w+=m-(1<<g-p[b]),p[b]=e}for(w>>=y;w>0;){var M=o[s].s;p[M]<e?w-=1<<e-p[M]++-1:++s}for(;s>=0&&w;--s){var E=o[s].s;p[E]==e&&(--p[E],++w)}g=e}return{t:new t(p),l:g}},A=function(t,n,r){return-1==t.s?Math.max(A(t.l,n,r+1),A(t.r,n,r+1)):n[t.s]=r},D=function(t){for(var r=t.length;r&&!t[--r];);for(var e=new n(++r),i=0,s=t[0],a=1,o=function(t){e[i++]=t},h=1;h<=r;++h)if(t[h]==s&&h!=r)++a;else{if(!s&&a>2){for(;a>138;a-=138)o(32754);a>2&&(o(a>10?a-11<<5|28690:a-3<<5|12305),a=0)}else if(a>3){for(o(s),--a;a>6;a-=6)o(8304);a>2&&(o(a-3<<5|8208),a=0)}for(;a--;)o(s);a=1,s=t[h]}return{c:e.subarray(0,i),n:r}},T=function(t,n){for(var r=0,e=0;e<n.length;++e)r+=t[e]*n[e];return r},k=function(t,n,r){var e=r.length,i=m(n+2);t[i]=255&e,t[i+1]=e>>8,t[i+2]=255^t[i],t[i+3]=255^t[i+1];for(var s=0;s<e;++s)t[i+s+4]=r[s];return 8*(i+4+e)},U=function(t,r,a,o,h,f,l,u,c,v,m){z(r,m++,a),++h[256];for(var b=x(h,15),M=b.t,E=b.l,A=x(f,15),U=A.t,C=A.l,F=D(M),I=F.c,S=F.n,L=D(U),O=L.c,j=L.n,q=new n(19),B=0;B<I.length;++B)++q[31&I[B]];for(B=0;B<O.length;++B)++q[31&O[B]];for(var G=x(q,7),H=G.t,J=G.l,K=19;K>4&&!H[s[K-1]];--K);var N,P,Q,R,V=v+5<<3,W=T(h,p)+T(f,g)+l,X=T(h,M)+T(f,U)+l+14+3*K+T(q,H)+2*q[16]+3*q[17]+7*q[18];if(c>=0&&V<=W&&V<=X)return k(r,m,t.subarray(c,c+v));if(z(r,m,1+(X<W)),m+=2,X<W){N=d(M,E,0),P=M,Q=d(U,C,0),R=U;var Y=d(H,J,0);z(r,m,S-257),z(r,m+5,j-1),z(r,m+10,K-4),m+=14;for(B=0;B<K;++B)z(r,m+3*B,H[s[B]]);m+=3*K;for(var Z=[I,O],$=0;$<2;++$){var tt=Z[$];for(B=0;B<tt.length;++B){var nt=31&tt[B];z(r,m,Y[nt]),m+=H[nt],nt>15&&(z(r,m,tt[B]>>5&127),m+=tt[B]>>12)}}}else N=w,P=p,Q=y,R=g;for(B=0;B<u;++B){var rt=o[B];if(rt>255){_(r,m,N[(nt=rt>>18&31)+257]),m+=P[nt+257],nt>7&&(z(r,m,rt>>23&31),m+=e[nt]);var et=31&rt;_(r,m,Q[et]),m+=R[et],et>3&&(_(r,m,rt>>5&8191),m+=i[et])}else _(r,m,N[rt]),m+=P[rt]}return _(r,m,N[256]),m+P[256]},C=new r([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),F=new t(0),I=function(){for(var t=new Int32Array(256),n=0;n<256;++n){for(var r=n,e=9;--e;)r=(1&r&&-306674912)^r>>>1;t[n]=r}return t}(),S=function(){var t=1,n=0;return{p:function(r){for(var e=t,i=n,s=0|r.length,a=0;a!=s;){for(var o=Math.min(a+2655,s);a<o;++a)i+=e+=r[a];e=(65535&e)+15*(e>>16),i=(65535&i)+15*(i>>16)}t=e,n=i},d:function(){return(255&(t%=65521))<<24|(65280&t)<<8|(255&(n%=65521))<<8|n>>8}}},L=function(s,a,o,h,u){if(!u&&(u={l:1},a.dictionary)){var c=a.dictionary.subarray(-32768),v=new t(c.length+s.length);v.set(c),v.set(s,c.length),s=v,u.w=c.length}return function(s,a,o,h,u,c){var v=c.z||s.length,d=new t(h+v+5*(1+Math.ceil(v/7e3))+u),p=d.subarray(h,d.length-u),g=c.l,w=7&(c.r||0);if(a){w&&(p[0]=c.r>>3);for(var y=C[a-1],M=y>>13,E=8191&y,z=(1<<o)-1,_=c.p||new n(32768),x=c.h||new n(z+1),A=Math.ceil(o/3),D=2*A,T=function(t){return(s[t]^s[t+1]<<A^s[t+2]<<D)&z},F=new r(25e3),I=new n(288),S=new n(32),L=0,O=0,j=c.i||0,q=0,B=c.w||0,G=0;j+2<v;++j){var H=T(j),J=32767&j,K=x[H];if(_[J]=K,x[H]=J,B<=j){var N=v-j;if((L>7e3||q>24576)&&(N>423||!g)){w=U(s,p,0,F,I,S,O,q,G,j-G,w),q=L=O=0,G=j;for(var P=0;P<286;++P)I[P]=0;for(P=0;P<30;++P)S[P]=0}var Q=2,R=0,V=E,W=J-K&32767;if(N>2&&H==T(j-W))for(var X=Math.min(M,N)-1,Y=Math.min(32767,j),Z=Math.min(258,N);W<=Y&&--V&&J!=K;){if(s[j+Q]==s[j+Q-W]){for(var $=0;$<Z&&s[j+$]==s[j+$-W];++$);if($>Q){if(Q=$,R=W,$>X)break;var tt=Math.min(W,$-2),nt=0;for(P=0;P<tt;++P){var rt=j-W+P&32767,et=rt-_[rt]&32767;et>nt&&(nt=et,K=rt)}}}W+=(J=K)-(K=_[J])&32767}if(R){F[q++]=268435456|f[Q]<<18|l[R];var it=31&f[Q],st=31&l[R];O+=e[it]+i[st],++I[257+it],++S[st],B=j+Q,++L}else F[q++]=s[j],++I[s[j]]}}for(j=Math.max(j,B);j<v;++j)F[q++]=s[j],++I[s[j]];w=U(s,p,g,F,I,S,O,q,G,j-G,w),g||(c.r=7&w|p[w/8|0]<<3,w-=7,c.h=x,c.p=_,c.i=j,c.w=B)}else{for(j=c.w||0;j<v+g;j+=65535){var at=j+65535;at>=v&&(p[w/8|0]=g,at=v),w=k(p,w+1,s.subarray(j,at))}c.i=v}return b(d,0,h+m(w)+u)}(s,null==a.level?6:a.level,null==a.mem?u.l?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(s.length)))):20:12+a.mem,o,h,u)},O=function(t,n,r){for(;r;++n)t[n]=r,r>>>=8},j=function(){function n(n,r){if("function"==typeof n&&(r=n,n={}),this.ondata=r,this.o=n||{},this.s={l:0,i:32768,w:32768,z:32768},this.b=new t(98304),this.o.dictionary){var e=this.o.dictionary.subarray(-32768);this.b.set(e,32768-e.length),this.s.i=32768-e.length}}return n.prototype.p=function(t,n){this.ondata(L(t,this.o,0,0,this.s),n)},n.prototype.push=function(n,r){this.ondata||E(5),this.s.l&&E(4);var e=n.length+this.s.z;if(e>this.b.length){if(e>2*this.b.length-32768){var i=new t(-32768&e);i.set(this.b.subarray(0,this.s.z)),this.b=i}var s=this.b.length-this.s.z;this.b.set(n.subarray(0,s),this.s.z),this.s.z=this.b.length,this.p(this.b,!1),this.b.set(this.b.subarray(-32768)),this.b.set(n.subarray(s),32768),this.s.z=n.length-s+32768,this.s.i=32766,this.s.w=32768}else this.b.set(n,this.s.z),this.s.z+=n.length;this.s.l=1&r,(this.s.z>this.s.w+8191||r)&&(this.p(this.b,r||!1),this.s.w=this.s.i,this.s.i-=2)},n.prototype.flush=function(){this.ondata||E(5),this.s.l&&E(4),this.p(this.b,!1),this.s.w=this.s.i,this.s.i-=2},n}();function q(t,n){n||(n={});var r=function(){var t=-1;return{p:function(n){for(var r=t,e=0;e<n.length;++e)r=I[255&r^n[e]]^r>>>8;t=r},d:function(){return~t}}}(),e=t.length;r.p(t);var i,s=L(t,n,10+((i=n).filename?i.filename.length+1:0),8),a=s.length;return function(t,n){var r=n.filename;if(t[0]=31,t[1]=139,t[2]=8,t[8]=n.level<2?4:9==n.level?2:0,t[9]=3,0!=n.mtime&&O(t,4,Math.floor(new Date(n.mtime||Date.now())/1e3)),r){t[3]=8;for(var e=0;e<=r.length;++e)t[e+10]=r.charCodeAt(e)}}(s,n),O(s,a-8,r.d()),O(s,a-4,e),s}var B=function(){function t(t,n){this.c=S(),this.v=1,j.call(this,t,n)}return t.prototype.push=function(t,n){this.c.p(t),j.prototype.push.call(this,t,n)},t.prototype.p=function(t,n){var r=L(t,this.o,this.v&&(this.o.dictionary?6:2),n&&4,this.s);this.v&&(function(t,n){var r=n.level,e=0==r?0:r<6?1:9==r?3:2;if(t[0]=120,t[1]=e<<6|(n.dictionary&&32),t[1]|=31-(t[0]<<8|t[1])%31,n.dictionary){var i=S();i.p(n.dictionary),O(t,2,i.d())}}(r,this.o),this.v=0),n&&O(r,r.length-4,this.c.d()),this.ondata(r,n)},t.prototype.flush=function(){j.prototype.flush.call(this)},t}(),G="undefined"!=typeof TextEncoder&&new TextEncoder,H="undefined"!=typeof TextDecoder&&new TextDecoder;try{H.decode(F,{stream:!0})}catch(t){}var J=function(){function t(t){this.ondata=t}return t.prototype.push=function(t,n){this.ondata||E(5),this.d&&E(4),this.ondata(K(t),this.d=n||!1)},t}();function K(n,r){if(G)return G.encode(n);for(var e=n.length,i=new t(n.length+(n.length>>1)),s=0,a=function(t){i[s++]=t},o=0;o<e;++o){if(s+5>i.length){var h=new t(s+8+(e-o<<1));h.set(i),i=h}var f=n.charCodeAt(o);f<128||r?a(f):f<2048?(a(192|f>>6),a(128|63&f)):f>55295&&f<57344?(a(240|(f=65536+(1047552&f)|1023&n.charCodeAt(++o))>>18),a(128|f>>12&63),a(128|f>>6&63),a(128|63&f)):(a(224|f>>12),a(128|f>>6&63),a(128|63&f))}return b(i,0,s)}const N=new class{constructor(){this._init()}clear(){this._init()}addEvent(t){if(!t)throw new Error("Adding invalid event");const n=this._hasEvents?",":"";this.stream.push(n+t),this._hasEvents=!0}finish(){this.stream.push("]",!0);const t=function(t){let n=0;for(const r of t)n+=r.length;const r=new Uint8Array(n);for(let n=0,e=0,i=t.length;n<i;n++){const i=t[n];r.set(i,e),e+=i.length}return r}(this._deflatedData);return this._init(),t}_init(){this._hasEvents=!1,this._deflatedData=[],this.deflate=new B,this.deflate.ondata=(t,n)=>{this._deflatedData.push(t)},this.stream=new J((t,n)=>{this.deflate.push(t,n)}),this.stream.push("[")}},P={clear:()=>{N.clear()},addEvent:t=>N.addEvent(t),finish:()=>N.finish(),compress:t=>function(t){return q(K(t))}(t)};addEventListener("message",function(t){const n=t.data.method,r=t.data.id,e=t.data.arg;if(n in P&&"function"==typeof P[n])try{const t=P[n](e);postMessage({id:r,method:n,success:!0,response:t})}catch(t){postMessage({id:r,method:n,success:!1,response:t.message}),console.error(t)}}),postMessage({id:void 0,method:"init",success:!0,response:void 0});';function Yee(){const n=new Blob([$ee]);return URL.createObjectURL(n)}const l5=["log","warn","error"],Mg="[Replay] ";function By(n,e="info"){Xs({category:"console",data:{logger:"replay"},level:e,message:`${Mg}${n}`},{level:e})}function Xee(){let n=!1,e=!1;const t={exception:()=>{},infoTick:()=>{},setConfig:r=>{n=!!r.captureExceptions,e=!!r.traceInternals}};return Pt?(l5.forEach(r=>{t[r]=(...o)=>{lt[r](Mg,...o),e&&By(o.join(""),FI(r))}}),t.exception=(r,...o)=>{o.length&&t.error&&t.error(...o),lt.error(Mg,r),n?jA(r):e&&By(r,"error")},t.infoTick=(...r)=>{lt.log(Mg,...r),e&&setTimeout(()=>By(r[0]),0)}):l5.forEach(r=>{t[r]=()=>{}}),t}const Dt=Xee();class Ny extends Error{constructor(){super(`Event buffer exceeded maximum size of ${vy}.`)}}class c5{constructor(){this.events=[],this._totalSize=0,this.hasCheckout=!1,this.waitForCheckout=!1}get hasEvents(){return this.events.length>0}get type(){return"sync"}destroy(){this.events=[]}async addEvent(e){const t=JSON.stringify(e).length;if(this._totalSize+=t,this._totalSize>vy)throw new Ny;this.events.push(e)}finish(){return new Promise(e=>{const t=this.events;this.clear(),e(JSON.stringify(t))})}clear(){this.events=[],this._totalSize=0,this.hasCheckout=!1}getEarliestTimestamp(){const e=this.events.map(t=>t.timestamp).sort()[0];return e?Ly(e):null}}class qee{constructor(e){this._worker=e,this._id=0}ensureReady(){return this._ensureReadyPromise?this._ensureReadyPromise:(this._ensureReadyPromise=new Promise((e,t)=>{this._worker.addEventListener("message",({data:r})=>{r.success?e():t()},{once:!0}),this._worker.addEventListener("error",r=>{t(r)},{once:!0})}),this._ensureReadyPromise)}destroy(){Pt&&Dt.log("Destroying compression worker"),this._worker.terminate()}postMessage(e,t){const r=this._getAndIncrementId();return new Promise((o,i)=>{const a=({data:s})=>{const l=s;if(l.method===e&&l.id===r){if(this._worker.removeEventListener("message",a),!l.success){Pt&&Dt.error("Error in compression worker: ",l.response),i(new Error("Error in compression worker"));return}o(l.response)}};this._worker.addEventListener("message",a),this._worker.postMessage({id:r,method:e,arg:t})})}_getAndIncrementId(){return this._id++}}class Kee{constructor(e){this._worker=new qee(e),this._earliestTimestamp=null,this._totalSize=0,this.hasCheckout=!1,this.waitForCheckout=!1}get hasEvents(){return!!this._earliestTimestamp}get type(){return"worker"}ensureReady(){return this._worker.ensureReady()}destroy(){this._worker.destroy()}addEvent(e){const t=Ly(e.timestamp);(!this._earliestTimestamp||t<this._earliestTimestamp)&&(this._earliestTimestamp=t);const r=JSON.stringify(e);return this._totalSize+=r.length,this._totalSize>vy?Promise.reject(new Ny):this._sendEventToWorker(r)}finish(){return this._finishRequest()}clear(){this._earliestTimestamp=null,this._totalSize=0,this.hasCheckout=!1,this._worker.postMessage("clear").then(null,e=>{Pt&&Dt.exception(e,'Sending "clear" message to worker failed',e)})}getEarliestTimestamp(){return this._earliestTimestamp}_sendEventToWorker(e){return this._worker.postMessage("addEvent",e)}async _finishRequest(){const e=await this._worker.postMessage("finish");return this._earliestTimestamp=null,this._totalSize=0,e}}class Zee{constructor(e){this._fallback=new c5,this._compression=new Kee(e),this._used=this._fallback,this._ensureWorkerIsLoadedPromise=this._ensureWorkerIsLoaded()}get waitForCheckout(){return this._used.waitForCheckout}get type(){return this._used.type}get hasEvents(){return this._used.hasEvents}get hasCheckout(){return this._used.hasCheckout}set hasCheckout(e){this._used.hasCheckout=e}set waitForCheckout(e){this._used.waitForCheckout=e}destroy(){this._fallback.destroy(),this._compression.destroy()}clear(){return this._used.clear()}getEarliestTimestamp(){return this._used.getEarliestTimestamp()}addEvent(e){return this._used.addEvent(e)}async finish(){return await this.ensureWorkerIsLoaded(),this._used.finish()}ensureWorkerIsLoaded(){return this._ensureWorkerIsLoadedPromise}async _ensureWorkerIsLoaded(){try{await this._compression.ensureReady()}catch(e){Pt&&Dt.exception(e,"Failed to load the compression worker, falling back to simple buffer");return}await this._switchToCompressionWorker()}async _switchToCompressionWorker(){const{events:e,hasCheckout:t,waitForCheckout:r}=this._fallback,o=[];for(const i of e)o.push(this._compression.addEvent(i));this._compression.hasCheckout=t,this._compression.waitForCheckout=r,this._used=this._compression;try{await Promise.all(o),this._fallback.clear()}catch(i){Pt&&Dt.exception(i,"Failed to add events when switching buffers.")}}}function Jee({useCompression:n,workerUrl:e}){if(n&&window.Worker){const t=ete(e);if(t)return t}return Pt&&Dt.log("Using simple buffer"),new c5}function ete(n){try{const e=n||tte();if(!e)return;Pt&&Dt.log(`Using compression worker${n?` from ${n}`:""}`);const t=new Worker(e);return new Zee(t)}catch(e){Pt&&Dt.exception(e,"Failed to create compression worker")}}function tte(){return typeof __SENTRY_EXCLUDE_REPLAY_WORKER__>"u"||!__SENTRY_EXCLUDE_REPLAY_WORKER__?Yee():""}function Oy(){try{return"sessionStorage"in On&&!!On.sessionStorage}catch{return!1}}function nte(n){rte(),n.session=void 0}function rte(){if(Oy())try{On.sessionStorage.removeItem(gy)}catch{}}function u5(n){return n===void 0?!1:Math.random()<n}function ky(n){if(Oy())try{On.sessionStorage.setItem(gy,JSON.stringify(n))}catch{}}function d5(n){const e=Date.now(),t=n.id||Ko(),r=n.started||e,o=n.lastActivity||e,i=n.segmentId||0,a=n.sampled,s=n.previousSessionId;return{id:t,started:r,lastActivity:o,segmentId:i,sampled:a,previousSessionId:s}}function ote(n,e){return u5(n)?"session":e?"buffer":!1}function f5({sessionSampleRate:n,allowBuffering:e,stickySession:t=!1},{previousSessionId:r}={}){const o=ote(n,e),i=d5({sampled:o,previousSessionId:r});return t&&ky(i),i}function ite(){if(!Oy())return null;try{const n=On.sessionStorage.getItem(gy);if(!n)return null;const e=JSON.parse(n);return Pt&&Dt.infoTick("Loading existing session"),d5(e)}catch{return null}}function Fy(n,e,t=+new Date){return n===null||e===void 0||e<0?!0:e===0?!1:n+e<=t}function h5(n,{maxReplayDuration:e,sessionIdleExpire:t,targetTime:r=Date.now()}){return Fy(n.started,e,r)||Fy(n.lastActivity,t,r)}function p5(n,{sessionIdleExpire:e,maxReplayDuration:t}){return!(!h5(n,{sessionIdleExpire:e,maxReplayDuration:t})||n.sampled==="buffer"&&n.segmentId===0)}function Vy({sessionIdleExpire:n,maxReplayDuration:e,previousSessionId:t},r){const o=r.stickySession&&ite();return o?p5(o,{sessionIdleExpire:n,maxReplayDuration:e})?(Pt&&Dt.infoTick("Session in sessionStorage is expired, creating new one..."),f5(r,{previousSessionId:o.id})):o:(Pt&&Dt.infoTick("Creating new session"),f5(r,{previousSessionId:t}))}function ate(n){return n.type===Wt.Custom}function Uy(n,e,t){return g5(n,e)?(m5(n,e,t),!0):!1}function ste(n,e,t){return g5(n,e)?m5(n,e,t):Promise.resolve(null)}async function m5(n,e,t){const{eventBuffer:r}=n;if(!r||r.waitForCheckout&&!t)return null;const o=n.recordingMode==="buffer";try{t&&o&&r.clear(),t&&(r.hasCheckout=!0,r.waitForCheckout=!1);const i=n.getOptions(),a=lte(e,i.beforeAddRecordingEvent);return a?await r.addEvent(a):void 0}catch(i){const a=i&&i instanceof Ny,s=a?"addEventSizeExceeded":"addEvent";if(a&&o)return r.clear(),r.waitForCheckout=!0,null;n.handleException(i),await n.stop({reason:s});const l=Pn();l&&l.recordDroppedEvent("internal_sdk_error","replay")}}function g5(n,e){if(!n.eventBuffer||n.isPaused()||!n.isEnabled())return!1;const t=Ly(e.timestamp);return t+n.timeouts.sessionIdlePause<Date.now()?!1:t>n.getContext().initialTimestamp+n.getOptions().maxReplayDuration?(Pt&&Dt.infoTick(`Skipping event with timestamp ${t} because it is after maxReplayDuration`),!1):!0}function lte(n,e){try{if(typeof e=="function"&&ate(n))return e(n)}catch(t){return Pt&&Dt.exception(t,"An error occurred in the `beforeAddRecordingEvent` callback, skipping the event..."),null}return n}function zy(n){return!n.type}function Gy(n){return n.type==="transaction"}function cte(n){return n.type==="replay_event"}function _5(n){return n.type==="feedback"}function ute(n){return(e,t)=>{if(!n.isEnabled()||!zy(e)&&!Gy(e))return;const r=t==null?void 0:t.statusCode;if(!(!r||r<200||r>=300)){if(Gy(e)){dte(n,e);return}fte(n,e)}}}function dte(n,e){var r,o;const t=n.getContext();(o=(r=e.contexts)==null?void 0:r.trace)!=null&&o.trace_id&&t.traceIds.size<100&&t.traceIds.add(e.contexts.trace.trace_id)}function fte(n,e){const t=n.getContext();if(e.event_id&&t.errorIds.size<100&&t.errorIds.add(e.event_id),n.recordingMode!=="buffer"||!e.tags||!e.tags.replayId)return;const{beforeErrorSampling:r}=n.getOptions();typeof r=="function"&&!r(e)||Qf(async()=>{try{await n.sendBufferedReplayOrFlush()}catch(o){n.handleException(o)}})}function hte(n){return e=>{!n.isEnabled()||!zy(e)||pte(n,e)}}function pte(n,e){var r,o,i;const t=(i=(o=(r=e.exception)==null?void 0:r.values)==null?void 0:o[0])==null?void 0:i.value;if(typeof t=="string"&&(t.match(/(reactjs\.org\/docs\/error-decoder\.html\?invariant=|react\.dev\/errors\/)(418|419|422|423|425)/)||t.match(/(does not match server-rendered HTML|Hydration failed because)/i))){const a=va({category:"replay.hydrate-error",data:{url:Vm()}});eh(n,a)}}function mte(n){const e=Pn();e&&e.on("beforeAddBreadcrumb",t=>gte(n,t))}function gte(n,e){if(!n.isEnabled()||!v5(e))return;const t=_te(e);t&&eh(n,t)}function _te(n){return!v5(n)||["fetch","xhr","sentry.event","sentry.transaction"].includes(n.category)||n.category.startsWith("ui.")?null:n.category==="console"?vte(n):va(n)}function vte(n){var o;const e=(o=n.data)==null?void 0:o.arguments;if(!Array.isArray(e)||e.length===0)return va(n);let t=!1;const r=e.map(i=>{if(!i)return i;if(typeof i=="string")return i.length>fg?(t=!0,`${i.slice(0,fg)}`):i;if(typeof i=="object")try{const a=Hi(i,7);return JSON.stringify(a).length>fg?(t=!0,`${JSON.stringify(a,null,2).slice(0,fg)}`):a}catch{}return i});return va({...n,data:{...n.data,arguments:r,...t?{_meta:{warnings:["CONSOLE_ARG_TRUNCATED"]}}:{}}})}function v5(n){return!!n.category}function Ate(n,e){var t,r,o;return n.type||!((r=(t=n.exception)==null?void 0:t.values)!=null&&r.length)?!1:!!((o=e.originalException)!=null&&o.__rrweb__)}function A5(){const n=Zo().getPropagationContext().dsc;n&&delete n.replay_id;const e=BA();if(e){const t=au(e);delete t.replay_id}}function yte(n,e){n.triggerUserActivity(),n.addUpdate(()=>e.timestamp?(n.throttledAddEvent({type:Wt.Custom,timestamp:e.timestamp*1e3,data:{tag:"breadcrumb",payload:{timestamp:e.timestamp,type:"default",category:"sentry.feedback",data:{feedbackId:e.event_id}}}}),!1):!0)}function bte(n,e){return n.recordingMode!=="buffer"||e.message===_y||!e.exception||e.type?!1:u5(n.getOptions().errorSampleRate)}function xte(n){return Object.assign((e,t)=>!n.isEnabled()||n.isPaused()?e:cte(e)?(delete e.breadcrumbs,e):!zy(e)&&!Gy(e)&&!_5(e)?e:n.checkAndHandleExpiredSession()?_5(e)?(n.flush(),e.contexts.feedback.replay_id=n.getSessionId(),yte(n,e),e):Ate(e,t)&&!n.getOptions()._experiments.captureExceptions?(Pt&&Dt.log("Ignoring error from rrweb internals",e),null):((bte(n,e)||n.recordingMode==="session")&&(e.tags={...e.tags,replayId:n.getSessionId()}),e):(A5(),e),{id:"Replay"})}function Tg(n,e){return e.map(({type:t,start:r,end:o,name:i,data:a})=>{const s=n.throttledAddEvent({type:Wt.Custom,timestamp:r,data:{tag:"performanceSpan",payload:{op:t,description:i,startTimestamp:r,endTimestamp:o,data:a}}});return typeof s=="string"?Promise.resolve(null):s})}function Ete(n){const{from:e,to:t}=n,r=Date.now()/1e3;return{type:"navigation.push",start:r,end:r,name:t,data:{previous:e}}}function Cte(n){return e=>{if(!n.isEnabled())return;const t=Ete(e);t!==null&&(n.getContext().urls.push(t.name),n.triggerUserActivity(),n.addUpdate(()=>(Tg(n,[t]),!1)))}}function Ste(n,e){return Pt&&n.getOptions()._experiments.traceInternals?!1:dq(e,Pn())}function y5(n,e){n.isEnabled()&&e!==null&&(Ste(n,e.name)||n.addUpdate(()=>(Tg(n,[e]),!0)))}function Ig(n){if(!n)return;const e=new TextEncoder;try{if(typeof n=="string")return e.encode(n).length;if(n instanceof URLSearchParams)return e.encode(n.toString()).length;if(n instanceof FormData){const t=c4(n);return e.encode(t).length}if(n instanceof Blob)return n.size;if(n instanceof ArrayBuffer)return n.byteLength}catch{}}function b5(n){if(!n)return;const e=parseInt(n,10);return isNaN(e)?void 0:e}function Rg(n,e){if(!n)return{headers:{},size:void 0,_meta:{warnings:[e]}};const t={...n._meta},r=t.warnings||[];return t.warnings=[...r,e],n._meta=t,n}function x5(n,e){if(!e)return null;const{startTimestamp:t,endTimestamp:r,url:o,method:i,statusCode:a,request:s,response:l}=e;return{type:n,start:t/1e3,end:r/1e3,name:o,data:{method:i,statusCode:a,request:s,response:l}}}function th(n){return{headers:{},size:n,_meta:{warnings:["URL_SKIPPED"]}}}function Zs(n,e,t){if(!e&&Object.keys(n).length===0)return;if(!e)return{headers:n};if(!t)return{headers:n,size:e};const r={headers:n,size:e},{body:o,warnings:i}=wte(t);return r.body=o,i!=null&&i.length&&(r._meta={warnings:i}),r}function Hy(n,e){return Object.entries(n).reduce((t,[r,o])=>{const i=r.toLowerCase();return e.includes(i)&&n[r]&&(t[i]=o),t},{})}function wte(n){if(!n||typeof n!="string")return{body:n};const e=n.length>_4,t=Mte(n);if(e){const r=n.slice(0,_4);return t?{body:r,warnings:["MAYBE_JSON_TRUNCATED"]}:{body:`${r}`,warnings:["TEXT_TRUNCATED"]}}if(t)try{return{body:JSON.parse(n)}}catch{}return{body:n}}function Mte(n){const e=n[0],t=n[n.length-1];return e==="["&&t==="]"||e==="{"&&t==="}"}function Lg(n,e){const t=Tte(n);return Rf(t,e)}function Tte(n,e=On.document.baseURI){if(n.startsWith("http://")||n.startsWith("https://")||n.startsWith(On.location.origin))return n;const t=new URL(n,e);if(t.origin!==new URL(e).origin)return n;const r=t.href;return!n.endsWith("/")&&r.endsWith("/")?r.slice(0,-1):r}async function Ite(n,e,t){try{const r=await Lte(n,e,t),o=x5("resource.fetch",r);y5(t.replay,o)}catch(r){Pt&&Dt.exception(r,"Failed to capture fetch breadcrumb")}}function Rte(n,e){const{input:t,response:r}=e,o=t?d4(t):void 0,i=Ig(o),a=r?b5(r.headers.get("content-length")):void 0;i!==void 0&&(n.data.request_body_size=i),a!==void 0&&(n.data.response_body_size=a)}async function Lte(n,e,t){const r=Date.now(),{startTimestamp:o=r,endTimestamp:i=r}=e,{url:a,method:s,status_code:l=0,request_body_size:c,response_body_size:u}=n.data,d=Lg(a,t.networkDetailAllowUrls)&&!Lg(a,t.networkDetailDenyUrls),f=d?Pte(t,e.input,c):th(c),h=await Dte(d,t,e.response,u);return{startTimestamp:o,endTimestamp:i,url:a,method:s,statusCode:l,request:f,response:h}}function Pte({networkCaptureBodies:n,networkRequestHeaders:e},t,r){const o=t?Ote(t,e):{};if(!n)return Zs(o,r,void 0);const i=d4(t),[a,s]=u4(i,Dt),l=Zs(o,r,a);return s?Rg(l,s):l}async function Dte(n,{networkCaptureBodies:e,networkResponseHeaders:t},r,o){if(!n&&o!==void 0)return th(o);const i=r?E5(r.headers,t):{};if(!r||!e&&o!==void 0)return Zs(i,o,void 0);const[a,s]=await Nte(r),l=Bte(a,{networkCaptureBodies:e,responseBodySize:o,captureDetails:n,headers:i});return s?Rg(l,s):l}function Bte(n,{networkCaptureBodies:e,responseBodySize:t,captureDetails:r,headers:o}){try{const i=n!=null&&n.length&&t===void 0?Ig(n):t;return r?e?Zs(o,i,n):Zs(o,i,void 0):th(i)}catch(i){return Pt&&Dt.exception(i,"Failed to serialize response body"),Zs(o,t,void 0)}}async function Nte(n){const e=kte(n);if(!e)return[void 0,"BODY_PARSE_ERROR"];try{return[await Fte(e)]}catch(t){return t instanceof Error&&t.message.indexOf("Timeout")>-1?(Pt&&Dt.warn("Parsing text body from response timed out"),[void 0,"BODY_PARSE_TIMEOUT"]):(Pt&&Dt.exception(t,"Failed to get text body from response"),[void 0,"BODY_PARSE_ERROR"])}}function E5(n,e){const t={};return e.forEach(r=>{n.get(r)&&(t[r]=n.get(r))}),t}function Ote(n,e){return n.length===1&&typeof n[0]!="string"?C5(n[0],e):n.length===2?C5(n[1],e):{}}function C5(n,e){if(!n)return{};const t=n.headers;return t?t instanceof Headers?E5(t,e):Array.isArray(t)?{}:Hy(t,e):{}}function kte(n){try{return n.clone()}catch(e){Pt&&Dt.exception(e,"Failed to clone response body")}}function Fte(n){return new Promise((e,t)=>{const r=Qf(()=>t(new Error("Timeout while trying to read response body")),500);Vte(n).then(o=>e(o),o=>t(o)).finally(()=>clearTimeout(r))})}async function Vte(n){return await n.text()}async function Ute(n,e,t){try{const r=Gte(n,e,t),o=x5("resource.xhr",r);y5(t.replay,o)}catch(r){Pt&&Dt.exception(r,"Failed to capture xhr breadcrumb")}}function zte(n,e){const{xhr:t,input:r}=e;if(!t)return;const o=Ig(r),i=t.getResponseHeader("content-length")?b5(t.getResponseHeader("content-length")):Qte(t.response,t.responseType);o!==void 0&&(n.data.request_body_size=o),i!==void 0&&(n.data.response_body_size=i)}function Gte(n,e,t){const r=Date.now(),{startTimestamp:o=r,endTimestamp:i=r,input:a,xhr:s}=e,{url:l,method:c,status_code:u=0,request_body_size:d,response_body_size:f}=n.data;if(!l)return null;if(!s||!Lg(l,t.networkDetailAllowUrls)||Lg(l,t.networkDetailDenyUrls)){const x=th(d),w=th(f);return{startTimestamp:o,endTimestamp:i,url:l,method:c,statusCode:u,request:x,response:w}}const h=s[lu],p=h?Hy(h.request_headers,t.networkRequestHeaders):{},m=Hy(Hte(s),t.networkResponseHeaders),[g,_]=t.networkCaptureBodies?u4(a,Dt):[void 0],[A,y]=t.networkCaptureBodies?Wte(s):[void 0],b=Zs(p,d,g),E=Zs(m,f,A);return{startTimestamp:o,endTimestamp:i,url:l,method:c,statusCode:u,request:_?Rg(b,_):b,response:y?Rg(E,y):E}}function Hte(n){const e=n.getAllResponseHeaders();return e?e.split(`\r
`).reduce((t,r)=>{const[o,i]=r.split(": ");return i&&(t[o.toLowerCase()]=i),t},{}):{}}function Wte(n){const e=[];try{return[n.responseText]}catch(t){e.push(t)}try{return jte(n.response,n.responseType)}catch(t){e.push(t)}return Pt&&Dt.warn("Failed to get xhr response body",...e),[void 0]}function jte(n,e){try{if(typeof n=="string")return[n];if(n instanceof Document)return[n.body.outerHTML];if(e==="json"&&n&&typeof n=="object")return[JSON.stringify(n)];if(!n)return[void 0]}catch(t){return Pt&&Dt.exception(t,"Failed to serialize body",n),[void 0,"BODY_PARSE_ERROR"]}return Pt&&Dt.log("Skipping network body because of body type",n),[void 0,"UNPARSEABLE_BODY_TYPE"]}function Qte(n,e){try{const t=e==="json"&&n&&typeof n=="object"?JSON.stringify(n):n;return Ig(t)}catch{return}}function $te(n){const e=Pn();try{const{networkDetailAllowUrls:t,networkDetailDenyUrls:r,networkCaptureBodies:o,networkRequestHeaders:i,networkResponseHeaders:a}=n.getOptions(),s={replay:n,networkDetailAllowUrls:t,networkDetailDenyUrls:r,networkCaptureBodies:o,networkRequestHeaders:i,networkResponseHeaders:a};e&&e.on("beforeAddBreadcrumb",(l,c)=>Yte(s,l,c))}catch{}}function Yte(n,e,t){if(e.data)try{Xte(e)&&Kte(t)&&(zte(e,t),Ute(e,t,n)),qte(e)&&Zte(t)&&(Rte(e,t),Ite(e,t,n))}catch(r){Pt&&Dt.exception(r,"Error when enriching network breadcrumb")}}function Xte(n){return n.category==="xhr"}function qte(n){return n.category==="fetch"}function Kte(n){return n==null?void 0:n.xhr}function Zte(n){return n==null?void 0:n.response}function Jte(n){const e=Pn();i4(Tee(n)),py(Cte(n)),mte(n),$te(n);const t=xte(n);VX(t),e&&(e.on("beforeSendEvent",hte(n)),e.on("afterSendEvent",ute(n)),e.on("createDsc",r=>{const o=n.getSessionId();o&&n.isEnabled()&&n.recordingMode==="session"&&n.checkAndHandleExpiredSession()&&(r.replay_id=o)}),e.on("spanStart",r=>{n.lastActiveSpan=r}),e.on("spanEnd",r=>{n.lastActiveSpan=r}),e.on("beforeSendFeedback",async(r,o)=>{var a;const i=n.getSessionId();o!=null&&o.includeReplay&&n.isEnabled()&&i&&((a=r.contexts)!=null&&a.feedback)&&(r.contexts.feedback.source==="api"&&await n.sendBufferedReplayOrFlush(),r.contexts.feedback.replay_id=i)}),e.on("openFeedbackWidget",async()=>{await n.sendBufferedReplayOrFlush()}))}async function ene(n){try{return Promise.all(Tg(n,[tne(On.performance.memory)]))}catch{return[]}}function tne(n){const{jsHeapSizeLimit:e,totalJSHeapSize:t,usedJSHeapSize:r}=n,o=Date.now()/1e3;return{type:"memory",name:"memory",start:o,end:o,data:{memory:{jsHeapSizeLimit:e,totalJSHeapSize:t,usedJSHeapSize:r}}}}function nne(n,e,t){return gq(n,e,{...t,setTimeoutImpl:Qf})}const yi=hn.navigator;function rne(){return/iPhone|iPad|iPod/i.test((yi==null?void 0:yi.userAgent)??"")||/Macintosh/i.test((yi==null?void 0:yi.userAgent)??"")&&(yi!=null&&yi.maxTouchPoints)&&(yi==null?void 0:yi.maxTouchPoints)>1?{sampling:{mousemove:!1}}:{}}function one(n){let e=!1;return(t,r)=>{if(!n.checkAndHandleExpiredSession()){Pt&&Dt.warn("Received replay event after session expired.");return}const o=r||!e;e=!0,n.clickDetector&&Eee(n.clickDetector,t),n.addUpdate(()=>{if(n.recordingMode==="buffer"&&o&&n.setInitialState(),!Uy(n,t,o))return!0;if(!o)return!1;const i=n.session;if(ane(n,o),n.recordingMode==="buffer"&&i&&n.eventBuffer){const a=n.eventBuffer.getEarliestTimestamp();a&&(Pt&&Dt.log(`Updating session start time to earliest event in buffer to ${new Date(a)}`),i.started=a,n.getOptions().stickySession&&ky(i))}return i!=null&&i.previousSessionId||n.recordingMode==="session"&&n.flush(),!0})}}function ine(n){const e=n.getOptions();return{type:Wt.Custom,timestamp:Date.now(),data:{tag:"options",payload:{shouldRecordCanvas:n.isRecordingCanvas(),sessionSampleRate:e.sessionSampleRate,errorSampleRate:e.errorSampleRate,useCompressionOption:e.useCompression,blockAllMedia:e.blockAllMedia,maskAllText:e.maskAllText,maskAllInputs:e.maskAllInputs,useCompression:n.eventBuffer?n.eventBuffer.type==="worker":!1,networkDetailHasUrls:e.networkDetailAllowUrls.length>0,networkCaptureBodies:e.networkCaptureBodies,networkRequestHasHeaders:e.networkRequestHeaders.length>0,networkResponseHasHeaders:e.networkResponseHeaders.length>0}}}}function ane(n,e){!e||!n.session||n.session.segmentId!==0||Uy(n,ine(n),!1)}function sne(n){if(!n)return null;try{return n.nodeType===n.ELEMENT_NODE?n:n.parentElement}catch{return null}}function lne(n,e,t,r){return Ql(KT(n,zA(n),r,t),[[{type:"replay_event"},n],[{type:"replay_recording",length:typeof e=="string"?new TextEncoder().encode(e).length:e.length},e]])}function cne({recordingData:n,headers:e}){let t;const r=`${JSON.stringify(e)}
`;if(typeof n=="string")t=`${r}${n}`;else{const i=new TextEncoder().encode(r);t=new Uint8Array(i.length+n.length),t.set(i),t.set(n,i.length)}return t}async function une({client:n,scope:e,replayId:t,event:r}){const o=typeof n._integrations=="object"&&n._integrations!==null&&!Array.isArray(n._integrations)?Object.keys(n._integrations):void 0,i={event_id:t,integrations:o};n.emit("preprocessEvent",r,i);const a=await uI(n.getOptions(),r,i,e,n,ns());if(!a)return null;n.emit("postprocessEvent",a,i),a.platform=a.platform||"javascript";const s=n.getSdkMetadata(),{name:l,version:c}=(s==null?void 0:s.sdk)||{};return a.sdk={...a.sdk,name:l||"sentry.javascript.unknown",version:c||"0.0.0"},a}async function dne({recordingData:n,replayId:e,segmentId:t,eventContext:r,timestamp:o,session:i}){const a=cne({recordingData:n,headers:{segment_id:t}}),{urls:s,errorIds:l,traceIds:c,initialTimestamp:u}=r,d=Pn(),f=Zo(),h=d==null?void 0:d.getTransport(),p=d==null?void 0:d.getDsn();if(!d||!h||!p||!i.sampled)return os({});const m={type:zZ,replay_start_timestamp:u/1e3,timestamp:o/1e3,error_ids:l,trace_ids:c,urls:s,replay_id:e,segment_id:t,replay_type:i.sampled},g=await une({scope:f,client:d,replayId:e,event:m});if(!g)return d.recordDroppedEvent("event_processor","replay"),Pt&&Dt.log("An event processor returned `null`, will not send event."),os({});delete g.sdkProcessingMetadata;const _=lne(g,a,p,d.getOptions().tunnel);let A;try{A=await h.send(_)}catch(b){const E=new Error(_y);try{E.cause=b}catch{}throw E}if(typeof A.statusCode=="number"&&(A.statusCode<200||A.statusCode>=300))throw new S5(A.statusCode);const y=RI({},A);if(II(y,"replay"))throw new Wy(y);return A}class S5 extends Error{constructor(e){super(`Transport returned status code ${e}`)}}class Wy extends Error{constructor(e){super("Rate limit hit"),this.rateLimits=e}}async function w5(n,e={count:0,interval:$Z}){const{recordingData:t,onError:r}=n;if(t.length)try{return await dne(n),!0}catch(o){if(o instanceof S5||o instanceof Wy)throw o;if(FX("Replays",{_retryCount:e.count}),r&&r(o),e.count>=YZ){const i=new Error(`${_y} - max retries exceeded`);try{i.cause=o}catch{}throw i}return e.interval*=++e.count,new Promise((i,a)=>{Qf(async()=>{try{await w5(n,e),i(!0)}catch(s){a(s)}},e.interval)})}}const M5="__THROTTLED",fne="__SKIPPED";function hne(n,e,t){const r=new Map,o=s=>{const l=s-t;r.forEach((c,u)=>{u<l&&r.delete(u)})},i=()=>[...r.values()].reduce((s,l)=>s+l,0);let a=!1;return(...s)=>{const l=Math.floor(Date.now()/1e3);if(o(l),i()>=e){const u=a;return a=!0,u?fne:M5}a=!1;const c=r.get(l)||0;return r.set(l,c+1),n(...s)}}class pne{constructor({options:e,recordingOptions:t}){this.eventBuffer=null,this.performanceEntries=[],this.replayPerformanceEntries=[],this.recordingMode="session",this.timeouts={sessionIdlePause:GZ,sessionIdleExpire:HZ},this._lastActivity=Date.now(),this._isEnabled=!1,this._isPaused=!1,this._requiresManualStart=!1,this._hasInitializedCoreListeners=!1,this._context={errorIds:new Set,traceIds:new Set,urls:[],initialTimestamp:Date.now(),initialUrl:""},this._recordingOptions=t,this._options=e,this._debouncedFlush=nne(()=>this._flush(),this._options.flushMinDelay,{maxWait:this._options.flushMaxDelay}),this._throttledAddEvent=hne((a,s)=>ste(this,a,s),300,5);const{slowClickTimeout:r,slowClickIgnoreSelectors:o}=this.getOptions(),i=r?{threshold:Math.min(XZ,r),timeout:r,scrollTimeout:qZ,ignoreSelector:o?o.join(","):""}:void 0;if(i&&(this.clickDetector=new Aee(this,i)),Pt){const a=e._experiments;Dt.setConfig({captureExceptions:!!a.captureExceptions,traceInternals:!!a.traceInternals})}this._handleVisibilityChange=()=>{On.document.visibilityState==="visible"?this._doChangeToForegroundTasks():this._doChangeToBackgroundTasks()},this._handleWindowBlur=()=>{const a=va({category:"ui.blur"});this._doChangeToBackgroundTasks(a)},this._handleWindowFocus=()=>{const a=va({category:"ui.focus"});this._doChangeToForegroundTasks(a)},this._handleKeyboardEvent=a=>{Pee(this,a)}}getContext(){return this._context}isEnabled(){return this._isEnabled}isPaused(){return this._isPaused}isRecordingCanvas(){return!!this._canvas}getOptions(){return this._options}handleException(e){Pt&&Dt.exception(e),this._options.onError&&this._options.onError(e)}initializeSampling(e){const{errorSampleRate:t,sessionSampleRate:r}=this._options,o=t<=0&&r<=0;if(this._requiresManualStart=o,!o){if(this._initializeSessionForSampling(e),!this.session){Pt&&Dt.exception(new Error("Unable to initialize and create session"));return}this.session.sampled!==!1&&(this.recordingMode=this.session.sampled==="buffer"&&this.session.segmentId===0?"buffer":"session",Pt&&Dt.infoTick(`Starting replay in ${this.recordingMode} mode`),this._initializeRecording())}}start(){if(this._isEnabled&&this.recordingMode==="session"){Pt&&Dt.log("Recording is already in progress");return}if(this._isEnabled&&this.recordingMode==="buffer"){Pt&&Dt.log("Buffering is in progress, call `flush()` to save the replay");return}Pt&&Dt.infoTick("Starting replay in session mode"),this._updateUserActivity();const e=Vy({maxReplayDuration:this._options.maxReplayDuration,sessionIdleExpire:this.timeouts.sessionIdleExpire},{stickySession:this._options.stickySession,sessionSampleRate:1,allowBuffering:!1});this.session=e,this.recordingMode="session",this._initializeRecording()}startBuffering(){if(this._isEnabled){Pt&&Dt.log("Buffering is in progress, call `flush()` to save the replay");return}Pt&&Dt.infoTick("Starting replay in buffer mode");const e=Vy({sessionIdleExpire:this.timeouts.sessionIdleExpire,maxReplayDuration:this._options.maxReplayDuration},{stickySession:this._options.stickySession,sessionSampleRate:0,allowBuffering:!0});this.session=e,this.recordingMode="buffer",this._initializeRecording()}startRecording(){try{const e=this._canvas;this._stopRecording=as({...this._recordingOptions,...this.recordingMode==="buffer"?{checkoutEveryNms:QZ}:this._options._experiments.continuousCheckout&&{checkoutEveryNms:Math.max(36e4,this._options._experiments.continuousCheckout)},emit:one(this),...rne(),onMutation:this._onMutationHandler.bind(this),...e?{recordCanvas:e.recordCanvas,getCanvasManager:e.getCanvasManager,sampling:e.sampling,dataURLOptions:e.dataURLOptions}:{}})}catch(e){this.handleException(e)}}stopRecording(){try{return this._stopRecording&&(this._stopRecording(),this._stopRecording=void 0),!0}catch(e){return this.handleException(e),!1}}async stop({forceFlush:e=!1,reason:t}={}){var r;if(this._isEnabled){this._isEnabled=!1,this.recordingMode="buffer";try{Pt&&Dt.log(`Stopping Replay${t?` triggered by ${t}`:""}`),A5(),this._removeListeners(),this.stopRecording(),this._debouncedFlush.cancel(),e&&await this._flush({force:!0}),(r=this.eventBuffer)==null||r.destroy(),this.eventBuffer=null,nte(this)}catch(o){this.handleException(o)}}}pause(){this._isPaused||(this._isPaused=!0,this.stopRecording(),Pt&&Dt.log("Pausing replay"))}resume(){!this._isPaused||!this._checkSession()||(this._isPaused=!1,this.startRecording(),Pt&&Dt.log("Resuming replay"))}async sendBufferedReplayOrFlush({continueRecording:e=!0}={}){if(this.recordingMode==="session")return this.flushImmediate();const t=Date.now();Pt&&Dt.log("Converting buffer to session"),await this.flushImmediate();const r=this.stopRecording();!e||!r||this.recordingMode!=="session"&&(this.recordingMode="session",this.session&&(this._updateUserActivity(t),this._updateSessionActivity(t),this._maybeSaveSession()),this.startRecording())}addUpdate(e){const t=e();this.recordingMode==="buffer"||!this._isEnabled||t!==!0&&this._debouncedFlush()}triggerUserActivity(){if(this._updateUserActivity(),!this._stopRecording){if(!this._checkSession())return;this.resume();return}this.checkAndHandleExpiredSession(),this._updateSessionActivity()}updateUserActivity(){this._updateUserActivity(),this._updateSessionActivity()}conditionalFlush(){return this.recordingMode==="buffer"?Promise.resolve():this.flushImmediate()}flush(){return this._debouncedFlush()}flushImmediate(){return this._debouncedFlush(),this._debouncedFlush.flush()}cancelFlush(){this._debouncedFlush.cancel()}getSessionId(){var e;return(e=this.session)==null?void 0:e.id}checkAndHandleExpiredSession(){if(this._lastActivity&&Fy(this._lastActivity,this.timeouts.sessionIdlePause)&&this.session&&this.session.sampled==="session"){this.pause();return}return!!this._checkSession()}setInitialState(){const e=`${On.location.pathname}${On.location.hash}${On.location.search}`,t=`${On.location.origin}${e}`;this.performanceEntries=[],this.replayPerformanceEntries=[],this._clearContext(),this._context.initialUrl=t,this._context.initialTimestamp=Date.now(),this._context.urls.push(t)}throttledAddEvent(e,t){const r=this._throttledAddEvent(e,t);if(r===M5){const o=va({category:"replay.throttled"});this.addUpdate(()=>!Uy(this,{type:fee,timestamp:o.timestamp||0,data:{tag:"breadcrumb",payload:o,metric:!0}}))}return r}getCurrentRoute(){const e=this.lastActiveSpan||BA(),t=e&&rs(e),o=(t&&Jo(t).data||{})[Bf];if(!(!t||!o||!["route","custom"].includes(o)))return Jo(t).description}_initializeRecording(){this.setInitialState(),this._updateSessionActivity(),this.eventBuffer=Jee({useCompression:this._options.useCompression,workerUrl:this._options.workerUrl}),this._removeListeners(),this._addListeners(),this._isEnabled=!0,this._isPaused=!1,this.startRecording()}_initializeSessionForSampling(e){const t=this._options.errorSampleRate>0,r=Vy({sessionIdleExpire:this.timeouts.sessionIdleExpire,maxReplayDuration:this._options.maxReplayDuration,previousSessionId:e},{stickySession:this._options.stickySession,sessionSampleRate:this._options.sessionSampleRate,allowBuffering:t});this.session=r}_checkSession(){if(!this.session)return!1;const e=this.session;return p5(e,{sessionIdleExpire:this.timeouts.sessionIdleExpire,maxReplayDuration:this._options.maxReplayDuration})?(this._refreshSession(e),!1):!0}async _refreshSession(e){this._isEnabled&&(await this.stop({reason:"refresh session"}),this.initializeSampling(e.id))}_addListeners(){try{On.document.addEventListener("visibilitychange",this._handleVisibilityChange),On.addEventListener("blur",this._handleWindowBlur),On.addEventListener("focus",this._handleWindowFocus),On.addEventListener("keydown",this._handleKeyboardEvent),this.clickDetector&&this.clickDetector.addListeners(),this._hasInitializedCoreListeners||(Jte(this),this._hasInitializedCoreListeners=!0)}catch(e){this.handleException(e)}this._performanceCleanupCallback=Qee(this)}_removeListeners(){try{On.document.removeEventListener("visibilitychange",this._handleVisibilityChange),On.removeEventListener("blur",this._handleWindowBlur),On.removeEventListener("focus",this._handleWindowFocus),On.removeEventListener("keydown",this._handleKeyboardEvent),this.clickDetector&&this.clickDetector.removeListeners(),this._performanceCleanupCallback&&this._performanceCleanupCallback()}catch(e){this.handleException(e)}}_doChangeToBackgroundTasks(e){!this.session||h5(this.session,{maxReplayDuration:this._options.maxReplayDuration,sessionIdleExpire:this.timeouts.sessionIdleExpire})||(e&&this._createCustomBreadcrumb(e),this.conditionalFlush())}_doChangeToForegroundTasks(e){if(!this.session)return;if(!this.checkAndHandleExpiredSession()){Pt&&Dt.log("Document has become active, but session has expired");return}e&&this._createCustomBreadcrumb(e)}_updateUserActivity(e=Date.now()){this._lastActivity=e}_updateSessionActivity(e=Date.now()){this.session&&(this.session.lastActivity=e,this._maybeSaveSession())}_createCustomBreadcrumb(e){this.addUpdate(()=>{this.throttledAddEvent({type:Wt.Custom,timestamp:e.timestamp||0,data:{tag:"breadcrumb",payload:e}})})}_addPerformanceEntries(){let e=Oee(this.performanceEntries).concat(this.replayPerformanceEntries);if(this.performanceEntries=[],this.replayPerformanceEntries=[],this._requiresManualStart){const t=this._context.initialTimestamp/1e3;e=e.filter(r=>r.start>=t)}return Promise.all(Tg(this,e))}_clearContext(){this._context.errorIds.clear(),this._context.traceIds.clear(),this._context.urls=[]}_updateInitialTimestampFromEventBuffer(){const{session:e,eventBuffer:t}=this;if(!e||!t||this._requiresManualStart||e.segmentId)return;const r=t.getEarliestTimestamp();r&&r<this._context.initialTimestamp&&(this._context.initialTimestamp=r)}_popEventContext(){const e={initialTimestamp:this._context.initialTimestamp,initialUrl:this._context.initialUrl,errorIds:Array.from(this._context.errorIds),traceIds:Array.from(this._context.traceIds),urls:this._context.urls};return this._clearContext(),e}async _runFlush(){var t;const e=this.getSessionId();if(!this.session||!this.eventBuffer||!e){Pt&&Dt.error("No session or eventBuffer found to flush.");return}if(await this._addPerformanceEntries(),!!((t=this.eventBuffer)!=null&&t.hasEvents)&&(await ene(this),!!this.eventBuffer&&e===this.getSessionId()))try{this._updateInitialTimestampFromEventBuffer();const r=Date.now();if(r-this._context.initialTimestamp>this._options.maxReplayDuration+3e4)throw new Error("Session is too long, not sending replay");const o=this._popEventContext(),i=this.session.segmentId++;this._maybeSaveSession();const a=await this.eventBuffer.finish();await w5({replayId:e,recordingData:a,segmentId:i,eventContext:o,session:this.session,timestamp:r,onError:s=>this.handleException(s)})}catch(r){this.handleException(r),this.stop({reason:"sendReplay"});const o=Pn();if(o){const i=r instanceof Wy?"ratelimit_backoff":"send_error";o.recordDroppedEvent(i,"replay")}}}async _flush({force:e=!1}={}){if(!this._isEnabled&&!e)return;if(!this.checkAndHandleExpiredSession()){Pt&&Dt.error("Attempting to finish replay event after session expired.");return}if(!this.session)return;const t=this.session.started,o=Date.now()-t;this._debouncedFlush.cancel();const i=o<this._options.minReplayDuration,a=o>this._options.maxReplayDuration+5e3;if(i||a){Pt&&Dt.log(`Session duration (${Math.floor(o/1e3)}s) is too ${i?"short":"long"}, not sending replay.`),i&&this._debouncedFlush();return}const s=this.eventBuffer;s&&this.session.segmentId===0&&!s.hasCheckout&&Pt&&Dt.log("Flushing initial segment without checkout.");const l=!!this._flushLock;this._flushLock||(this._flushLock=this._runFlush());try{await this._flushLock}catch(c){this.handleException(c)}finally{this._flushLock=void 0,l&&this._debouncedFlush()}}_maybeSaveSession(){this.session&&this._options.stickySession&&ky(this.session)}_onMutationHandler(e){const{ignoreMutations:t}=this._options._experiments;if(t!=null&&t.length&&e.some(s=>{const l=sne(s.target),c=t.join(",");return l==null?void 0:l.matches(c)}))return!1;const r=e.length,o=this._options.mutationLimit,i=this._options.mutationBreadcrumbLimit,a=o&&r>o;if(r>i||a){const s=va({category:"replay.mutations",data:{count:r,limit:a}});this._createCustomBreadcrumb(s)}return a?(this.stop({reason:"mutationLimit",forceFlush:this.recordingMode==="session"}),!1):!0}}function nh(n,e){return[...n,...e].join(",")}function mne({mask:n,unmask:e,block:t,unblock:r,ignore:o}){const i=["base","iframe[srcdoc]:not([src])"],a=nh(n,[".sentry-mask","[data-sentry-mask]"]),s=nh(e,[]);return{maskTextSelector:a,unmaskTextSelector:s,blockSelector:nh(t,[".sentry-block","[data-sentry-block]",...i]),unblockSelector:nh(r,[]),ignoreSelector:nh(o,[".sentry-ignore","[data-sentry-ignore]",'input[type="file"]'])}}function gne({el:n,key:e,maskAttributes:t,maskAllText:r,privacyOptions:o,value:i}){return!r||o.unmaskTextSelector&&n.matches(o.unmaskTextSelector)?i:t.includes(e)||e==="value"&&n.tagName==="INPUT"&&["submit","button"].includes(n.getAttribute("type")||"")?i.replace(/[\S]/g,"*"):i}const T5='img,image,svg,video,object,picture,embed,map,audio,link[rel="icon"],link[rel="apple-touch-icon"]',_ne=["content-length","content-type","accept"];let I5=!1;const vne=(n=>new Ane(n));class Ane{constructor({flushMinDelay:e=WZ,flushMaxDelay:t=jZ,minReplayDuration:r=KZ,maxReplayDuration:o=v4,stickySession:i=!0,useCompression:a=!0,workerUrl:s,_experiments:l={},maskAllText:c=!0,maskAllInputs:u=!0,blockAllMedia:d=!0,mutationBreadcrumbLimit:f=750,mutationLimit:h=1e4,slowClickTimeout:p=7e3,slowClickIgnoreSelectors:m=[],networkDetailAllowUrls:g=[],networkDetailDenyUrls:_=[],networkCaptureBodies:A=!0,networkRequestHeaders:y=[],networkResponseHeaders:b=[],mask:E=[],maskAttributes:x=["title","placeholder","aria-label"],unmask:w=[],block:L=[],unblock:C=[],ignore:P=[],maskFn:D,beforeAddRecordingEvent:Q,beforeErrorSampling:re,onError:G}={}){this.name="Replay";const se=mne({mask:E,unmask:w,block:L,unblock:C,ignore:P});if(this._recordingOptions={maskAllInputs:u,maskAllText:c,maskInputOptions:{password:!0},maskTextFn:D,maskInputFn:D,maskAttributeFn:(ee,ie,H)=>gne({maskAttributes:x,maskAllText:c,privacyOptions:se,key:ee,value:ie,el:H}),...se,slimDOMOptions:"all",inlineStylesheet:!0,inlineImages:!1,collectFonts:!0,errorHandler:ee=>{try{ee.__rrweb__=!0}catch{}},recordCrossOriginIframes:!!l.recordCrossOriginIframes},this._initialOptions={flushMinDelay:e,flushMaxDelay:t,minReplayDuration:Math.min(r,ZZ),maxReplayDuration:Math.min(o,v4),stickySession:i,useCompression:a,workerUrl:s,blockAllMedia:d,maskAllInputs:u,maskAllText:c,mutationBreadcrumbLimit:f,mutationLimit:h,slowClickTimeout:p,slowClickIgnoreSelectors:m,networkDetailAllowUrls:g,networkDetailDenyUrls:_,networkCaptureBodies:A,networkRequestHeaders:R5(y),networkResponseHeaders:R5(b),beforeAddRecordingEvent:Q,beforeErrorSampling:re,onError:G,_experiments:l},this._initialOptions.blockAllMedia&&(this._recordingOptions.blockSelector=this._recordingOptions.blockSelector?`${this._recordingOptions.blockSelector},${T5}`:T5),this._isInitialized&&WI())throw new Error("Multiple Sentry Session Replay instances are not supported");this._isInitialized=!0}get _isInitialized(){return I5}set _isInitialized(e){I5=e}afterAllSetup(e){!WI()||this._replay||(this._setup(e),this._initialize(e))}start(){this._replay&&this._replay.start()}startBuffering(){this._replay&&this._replay.startBuffering()}stop(){return this._replay?this._replay.stop({forceFlush:this._replay.recordingMode==="session"}):Promise.resolve()}flush(e){return this._replay?this._replay.isEnabled()?this._replay.sendBufferedReplayOrFlush(e):(this._replay.start(),Promise.resolve()):Promise.resolve()}getReplayId(){var e;if((e=this._replay)!=null&&e.isEnabled())return this._replay.getSessionId()}getRecordingMode(){var e;if((e=this._replay)!=null&&e.isEnabled())return this._replay.recordingMode}_initialize(e){this._replay&&(this._maybeLoadFromReplayCanvasIntegration(e),this._replay.initializeSampling())}_setup(e){const t=yne(this._initialOptions,e);this._replay=new pne({options:t,recordingOptions:this._recordingOptions})}_maybeLoadFromReplayCanvasIntegration(e){try{const t=e.getIntegrationByName("ReplayCanvas");if(!t)return;this._replay._canvas=t.getOptions()}catch{}}}function yne(n,e){const t=e.getOptions(),r={sessionSampleRate:0,errorSampleRate:0,...n},o=Of(t.replaysSessionSampleRate),i=Of(t.replaysOnErrorSampleRate);return o==null&&i==null&&Ja(()=>{console.warn("Replay is disabled because neither `replaysSessionSampleRate` nor `replaysOnErrorSampleRate` are set.")}),o!=null&&(r.sessionSampleRate=o),i!=null&&(r.errorSampleRate=i),r}function R5(n){return[..._ne,...n.map(e=>e.toLowerCase())]}var bne=Object.defineProperty,xne=(n,e,t)=>e in n?bne(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,L5=(n,e,t)=>xne(n,typeof e!="symbol"?e+"":e,t);class Ene{constructor(){L5(this,"idNodeMap",new Map),L5(this,"nodeMetaMap",new WeakMap)}getId(e){var r;return e?((r=this.getMeta(e))==null?void 0:r.id)??-1:-1}getNode(e){return this.idNodeMap.get(e)||null}getIds(){return Array.from(this.idNodeMap.keys())}getMeta(e){return this.nodeMetaMap.get(e)||null}removeNodeFromMap(e){const t=this.getId(e);this.idNodeMap.delete(t),e.childNodes&&e.childNodes.forEach(r=>this.removeNodeFromMap(r))}has(e){return this.idNodeMap.has(e)}hasNode(e){return this.nodeMetaMap.has(e)}add(e,t){const r=t.id;this.idNodeMap.set(r,e),this.nodeMetaMap.set(e,t)}replace(e,t){const r=this.getNode(e);if(r){const o=this.nodeMetaMap.get(r);o&&this.nodeMetaMap.set(t,o)}this.idNodeMap.set(e,t)}reset(){this.idNodeMap=new Map,this.nodeMetaMap=new WeakMap}}function Cne(){return new Ene}function Sne(n,e){for(let t=n.classList.length;t--;){const r=n.classList[t];if(e.test(r))return!0}return!1}function jy(n,e,t=1/0,r=0){return!n||n.nodeType!==n.ELEMENT_NODE||r>t?-1:e(n)?r:jy(n.parentNode,e,t,r+1)}function P5(n,e){return t=>{const r=t;if(r===null)return!1;try{if(n){if(typeof n=="string"){if(r.matches(`.${n}`))return!0}else if(Sne(r,n))return!0}return!!(e&&r.matches(e))}catch{return!1}}}const Au=`Please stop import mirror directly. Instead of that,\r
now you can use replayer.getMirror() to access the mirror instance of a replayer,\r
or you can use record.mirror to access the mirror instance during recording.`;let D5={map:{},getId(){return console.error(Au),-1},getNode(){return console.error(Au),null},removeNodeFromMap(){console.error(Au)},has(){return console.error(Au),!1},reset(){console.error(Au)}};typeof window<"u"&&window.Proxy&&window.Reflect&&(D5=new Proxy(D5,{get(n,e,t){return e==="map"&&console.error(Au),Reflect.get(n,e,t)}}));function Qy(n,e,t,r,o=window){const i=o.Object.getOwnPropertyDescriptor(n,e);return o.Object.defineProperty(n,e,r?t:{set(a){O5(()=>{t.set.call(this,a)},0),i&&i.set&&i.set.call(this,a)}}),()=>Qy(n,e,i||{},!0)}function $y(n,e,t){try{if(!(e in n))return()=>{};const r=n[e],o=t(r);return typeof o=="function"&&(o.prototype=o.prototype||{},Object.defineProperties(o,{__rrweb_original__:{enumerable:!1,value:r}})),n[e]=o,()=>{n[e]=r}}catch{return()=>{}}}Date.now().toString();function wne(n){if(!n)return null;try{return n.nodeType===n.ELEMENT_NODE?n:n.parentElement}catch{return null}}function Pg(n,e,t,r,o){if(!n)return!1;const i=wne(n);if(!i)return!1;const a=P5(e,t),s=jy(i,a);let l=-1;return s<0?!1:(r&&(l=jy(i,P5(null,r))),s>-1&&l<0?!0:s<l)}const B5={};function N5(n){const e=B5[n];if(e)return e;const t=window.document;let r=window[n];if(t&&typeof t.createElement=="function")try{const o=t.createElement("iframe");o.hidden=!0,t.head.appendChild(o);const i=o.contentWindow;i&&i[n]&&(r=i[n]),t.head.removeChild(o)}catch{}return B5[n]=r.bind(window)}function Xl(...n){return N5("requestAnimationFrame")(...n)}function O5(...n){return N5("setTimeout")(...n)}var yu=(n=>(n[n["2D"]=0]="2D",n[n.WebGL=1]="WebGL",n[n.WebGL2=2]="WebGL2",n))(yu||{});let Dg;function Mne(n){Dg=n}const Yy=n=>Dg?(...t)=>{try{return n(...t)}catch(r){if(Dg&&Dg(r)===!0)return()=>{};throw r}}:n;for(var bu="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Tne=typeof Uint8Array>"u"?[]:new Uint8Array(256),Bg=0;Bg<bu.length;Bg++)Tne[bu.charCodeAt(Bg)]=Bg;var Ine=function(n){var e=new Uint8Array(n),t,r=e.length,o="";for(t=0;t<r;t+=3)o+=bu[e[t]>>2],o+=bu[(e[t]&3)<<4|e[t+1]>>4],o+=bu[(e[t+1]&15)<<2|e[t+2]>>6],o+=bu[e[t+2]&63];return r%3===2?o=o.substring(0,o.length-1)+"=":r%3===1&&(o=o.substring(0,o.length-2)+"=="),o};const k5=new Map;function Rne(n,e){let t=k5.get(n);return t||(t=new Map,k5.set(n,t)),t.has(e)||t.set(e,[]),t.get(e)}const F5=(n,e,t)=>{if(!n||!(U5(n,e)||typeof n=="object"))return;const r=n.constructor.name,o=Rne(t,r);let i=o.indexOf(n);return i===-1&&(i=o.length,o.push(n)),i};function Ng(n,e,t){if(n instanceof Array)return n.map(r=>Ng(r,e,t));if(n===null)return n;if(n instanceof Float32Array||n instanceof Float64Array||n instanceof Int32Array||n instanceof Uint32Array||n instanceof Uint8Array||n instanceof Uint16Array||n instanceof Int16Array||n instanceof Int8Array||n instanceof Uint8ClampedArray)return{rr_type:n.constructor.name,args:[Object.values(n)]};if(n instanceof ArrayBuffer){const r=n.constructor.name,o=Ine(n);return{rr_type:r,base64:o}}else{if(n instanceof DataView)return{rr_type:n.constructor.name,args:[Ng(n.buffer,e,t),n.byteOffset,n.byteLength]};if(n instanceof HTMLImageElement){const r=n.constructor.name,{src:o}=n;return{rr_type:r,src:o}}else if(n instanceof HTMLCanvasElement){const r="HTMLImageElement",o=n.toDataURL();return{rr_type:r,src:o}}else{if(n instanceof ImageData)return{rr_type:n.constructor.name,args:[Ng(n.data,e,t),n.width,n.height]};if(U5(n,e)||typeof n=="object"){const r=n.constructor.name,o=F5(n,e,t);return{rr_type:r,index:o}}}}return n}const V5=(n,e,t)=>n.map(r=>Ng(r,e,t)),U5=(n,e)=>!!["WebGLActiveInfo","WebGLBuffer","WebGLFramebuffer","WebGLProgram","WebGLRenderbuffer","WebGLShader","WebGLShaderPrecisionFormat","WebGLTexture","WebGLUniformLocation","WebGLVertexArrayObject","WebGLVertexArrayObjectOES"].filter(o=>typeof e[o]=="function").find(o=>n instanceof e[o]);function Lne(n,e,t,r,o){const i=[],a=Object.getOwnPropertyNames(e.CanvasRenderingContext2D.prototype);for(const s of a)try{if(typeof e.CanvasRenderingContext2D.prototype[s]!="function")continue;const l=$y(e.CanvasRenderingContext2D.prototype,s,function(c){return function(...u){return Pg(this.canvas,t,r,o,!0)||O5(()=>{const d=V5(u,e,this);n(this.canvas,{type:yu["2D"],property:s,args:d})},0),c.apply(this,u)}});i.push(l)}catch{const l=Qy(e.CanvasRenderingContext2D.prototype,s,{set(c){n(this.canvas,{type:yu["2D"],property:s,args:[c],setter:!0})}});i.push(l)}return()=>{i.forEach(s=>s())}}function Pne(n){return n==="experimental-webgl"?"webgl":n}function z5(n,e,t,r,o){const i=[];try{const a=$y(n.HTMLCanvasElement.prototype,"getContext",function(s){return function(l,...c){if(!Pg(this,e,t,r,!0)){const u=Pne(l);if("__context"in this||(this.__context=u),o&&["webgl","webgl2"].includes(u))if(c[0]&&typeof c[0]=="object"){const d=c[0];d.preserveDrawingBuffer||(d.preserveDrawingBuffer=!0)}else c.splice(0,1,{preserveDrawingBuffer:!0})}return s.apply(this,[l,...c])}});i.push(a)}catch{console.error("failed to patch HTMLCanvasElement.prototype.getContext")}return()=>{i.forEach(a=>a())}}function G5(n,e,t,r,o,i,a,s){const l=[],c=Object.getOwnPropertyNames(n);for(const u of c)if(!["isContextLost","canvas","drawingBufferWidth","drawingBufferHeight"].includes(u))try{if(typeof n[u]!="function")continue;const d=$y(n,u,function(f){return function(...h){const p=f.apply(this,h);if(F5(p,s,this),"tagName"in this.canvas&&!Pg(this.canvas,r,o,i,!0)){const m=V5(h,s,this),g={type:e,property:u,args:m};t(this.canvas,g)}return p}});l.push(d)}catch{const d=Qy(n,u,{set(f){t(this.canvas,{type:e,property:u,args:[f],setter:!0})}});l.push(d)}return l}function Dne(n,e,t,r,o,i){const a=[];return a.push(...G5(e.WebGLRenderingContext.prototype,yu.WebGL,n,t,r,o,i,e)),typeof e.WebGL2RenderingContext<"u"&&a.push(...G5(e.WebGL2RenderingContext.prototype,yu.WebGL2,n,t,r,o,i,e)),()=>{a.forEach(s=>s())}}const Bne='for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",t="undefined"==typeof Uint8Array?[]:new Uint8Array(256),a=0;a<64;a++)t[e.charCodeAt(a)]=a;var n=function(t){var a,n=new Uint8Array(t),r=n.length,s="";for(a=0;a<r;a+=3)s+=e[n[a]>>2],s+=e[(3&n[a])<<4|n[a+1]>>4],s+=e[(15&n[a+1])<<2|n[a+2]>>6],s+=e[63&n[a+2]];return r%3==2?s=s.substring(0,s.length-1)+"=":r%3==1&&(s=s.substring(0,s.length-2)+"=="),s};const r=new Map,s=new Map;const i=self;i.onmessage=async function(e){if(!("OffscreenCanvas"in globalThis))return i.postMessage({id:e.data.id});{const{id:t,bitmap:a,width:o,height:f,maxCanvasSize:c,dataURLOptions:g}=e.data,u=async function(e,t,a){const r=e+"-"+t;if("OffscreenCanvas"in globalThis){if(s.has(r))return s.get(r);const i=new OffscreenCanvas(e,t);i.getContext("2d");const o=await i.convertToBlob(a),f=await o.arrayBuffer(),c=n(f);return s.set(r,c),c}return""}(o,f,g),[h,d]=function(e,t,a){if(!a)return[e,t];const[n,r]=a;if(e<=n&&t<=r)return[e,t];let s=e,i=t;return s>n&&(i=Math.floor(n*t/e),s=n),i>r&&(s=Math.floor(r*e/t),i=r),[s,i]}(o,f,c),l=new OffscreenCanvas(h,d),w=l.getContext("bitmaprenderer"),p=h===o&&d===f?a:await createImageBitmap(a,{resizeWidth:h,resizeHeight:d,resizeQuality:"low"});w.transferFromImageBitmap(p),a.close();const y=await l.convertToBlob(g),v=y.type,b=await y.arrayBuffer(),m=n(b);if(p.close(),!r.has(t)&&await u===m)return r.set(t,m),i.postMessage({id:t});if(r.get(t)===m)return i.postMessage({id:t});i.postMessage({id:t,type:v,base64:m,width:o,height:f}),r.set(t,m)}};';function Nne(){const n=new Blob([Bne]);return URL.createObjectURL(n)}class One{constructor(e){this.pendingCanvasMutations=new Map,this.rafStamps={latestId:0,invokeId:null},this.shadowDoms=new Set,this.windowsSet=new WeakSet,this.windows=[],this.restoreHandlers=[],this.frozen=!1,this.locked=!1,this.snapshotInProgressMap=new Map,this.worker=null,this.lastSnapshotTime=0,this.processMutation=(d,f)=>{(this.rafStamps.invokeId&&this.rafStamps.latestId!==this.rafStamps.invokeId||!this.rafStamps.invokeId)&&(this.rafStamps.invokeId=this.rafStamps.latestId),this.pendingCanvasMutations.has(d)||this.pendingCanvasMutations.set(d,[]),this.pendingCanvasMutations.get(d).push(f)};const{sampling:t="all",win:r,blockClass:o,blockSelector:i,unblockSelector:a,maxCanvasSize:s,recordCanvas:l,dataURLOptions:c,errorHandler:u}=e;this.mutationCb=e.mutationCb,this.mirror=e.mirror,this.options=e,u&&Mne(u),(l&&typeof t=="number"||e.enableManualSnapshot)&&(this.worker=this.initFPSWorker()),this.addWindow(r),!e.enableManualSnapshot&&Yy(()=>{l&&t==="all"&&(this.startRAFTimestamping(),this.startPendingCanvasMutationFlusher()),l&&typeof t=="number"&&this.initCanvasFPSObserver(t,o,i,a,s,{dataURLOptions:c})})()}reset(){var e;this.pendingCanvasMutations.clear(),this.restoreHandlers.forEach(t=>{try{t()}catch{}}),this.restoreHandlers=[],this.windowsSet=new WeakSet,this.windows=[],this.shadowDoms=new Set,(e=this.worker)==null||e.terminate(),this.worker=null,this.snapshotInProgressMap=new Map}freeze(){this.frozen=!0}unfreeze(){this.frozen=!1}lock(){this.locked=!0}unlock(){this.locked=!1}addWindow(e){const{sampling:t="all",blockClass:r,blockSelector:o,unblockSelector:i,recordCanvas:a,enableManualSnapshot:s}=this.options;if(!this.windowsSet.has(e)){if(s){this.windowsSet.add(e),this.windows.push(new WeakRef(e));return}Yy(()=>{if(a&&t==="all"&&this.initCanvasMutationObserver(e,r,o,i),a&&typeof t=="number"){const l=z5(e,r,o,i,!0);this.restoreHandlers.push(()=>{l()})}})(),this.windowsSet.add(e),this.windows.push(new WeakRef(e))}}addShadowRoot(e){this.shadowDoms.add(new WeakRef(e))}resetShadowRoots(){this.shadowDoms=new Set}initFPSWorker(){const e=new Worker(Nne());return e.onmessage=t=>{const r=t.data,{id:o}=r;if(this.snapshotInProgressMap.set(o,!1),!("base64"in r))return;const{base64:i,type:a,width:s,height:l}=r;this.mutationCb({id:o,type:yu["2D"],commands:[{property:"clearRect",args:[0,0,s,l]},{property:"drawImage",args:[{rr_type:"ImageBitmap",args:[{rr_type:"Blob",data:[{rr_type:"ArrayBuffer",base64:i}],type:a}]},0,0,s,l]}]})},e}initCanvasFPSObserver(e,t,r,o,i,a){const s=this.takeSnapshot(!1,e,t,r,o,i,a.dataURLOptions);this.restoreHandlers.push(()=>{cancelAnimationFrame(s)})}initCanvasMutationObserver(e,t,r,o){const i=z5(e,t,r,o,!1),a=Lne(this.processMutation.bind(this),e,t,r,o),s=Dne(this.processMutation.bind(this),e,t,r,o,this.mirror);this.restoreHandlers.push(()=>{i(),a(),s()})}snapshot(e){const{options:t}=this,r=this.takeSnapshot(!0,t.sampling==="all"?2:t.sampling||2,t.blockClass,t.blockSelector,t.unblockSelector,t.maxCanvasSize,t.dataURLOptions,e);this.restoreHandlers.push(()=>{cancelAnimationFrame(r)})}takeSnapshot(e,t,r,o,i,a,s,l){const c=1e3/t;let u;const d=h=>{if(h)return[h];const p=[],m=g=>{g.querySelectorAll("canvas").forEach(_=>{Pg(_,r,o,i)||p.push(_)})};for(const g of this.windows){const _=g.deref();let A;try{A=_&&_.document}catch{}A&&m(A)}for(const g of this.shadowDoms){const _=g.deref();_&&m(_)}return p},f=h=>{if(this.windows.length){if(this.lastSnapshotTime&&h-this.lastSnapshotTime<c){u=Xl(f);return}this.lastSnapshotTime=h,d(l).forEach(p=>{var g;if(!this.mirror.hasNode(p))return;const m=this.mirror.getId(p);if(!this.snapshotInProgressMap.get(m)&&!(!p.width||!p.height)){if(this.snapshotInProgressMap.set(m,!0),!e&&["webgl","webgl2"].includes(p.__context)){const _=p.getContext(p.__context);((g=_==null?void 0:_.getContextAttributes())==null?void 0:g.preserveDrawingBuffer)===!1&&_.clear(_.COLOR_BUFFER_BIT)}createImageBitmap(p).then(_=>{var A;(A=this.worker)==null||A.postMessage({id:m,bitmap:_,width:p.width,height:p.height,dataURLOptions:s,maxCanvasSize:a},[_])}).catch(_=>{Yy(()=>{throw _})()})}}),e||(u=Xl(f))}};return u=Xl(f),u}startPendingCanvasMutationFlusher(){Xl(()=>this.flushPendingCanvasMutations())}startRAFTimestamping(){const e=t=>{this.rafStamps.latestId=t,Xl(e)};Xl(e)}flushPendingCanvasMutations(){this.pendingCanvasMutations.forEach((e,t)=>{const r=this.mirror.getId(t);this.flushPendingCanvasMutationFor(t,r)}),Xl(()=>this.flushPendingCanvasMutations())}flushPendingCanvasMutationFor(e,t){if(this.frozen||this.locked)return;const r=this.pendingCanvasMutations.get(e);if(!r||t===-1)return;const o=r.map(a=>{const{type:s,...l}=a;return l}),{type:i}=r[0];this.mutationCb({id:t,type:i,commands:o}),this.pendingCanvasMutations.delete(e)}}try{if(Array.from([1],n=>n*2)[0]!==2){const n=document.createElement("iframe");document.body.appendChild(n),Array.from=((yN=n.contentWindow)==null?void 0:yN.Array.from)||Array.from,document.body.removeChild(n)}}catch(n){console.debug("Unable to override Array.from",n)}Cne();var H5;(function(n){n[n.NotStarted=0]="NotStarted",n[n.Running=1]="Running",n[n.Stopped=2]="Stopped"})(H5||(H5={}));const W5={low:{sampling:{canvas:1},dataURLOptions:{type:"image/webp",quality:.25}},medium:{sampling:{canvas:2},dataURLOptions:{type:"image/webp",quality:.4}},high:{sampling:{canvas:4},dataURLOptions:{type:"image/webp",quality:.5}}},kne="ReplayCanvas",Og=1280,Fne=((n={})=>{const[e,t]=n.maxCanvasSize||[],r={quality:n.quality||"medium",enableManualSnapshot:n.enableManualSnapshot,maxCanvasSize:[e?Math.min(e,Og):Og,t?Math.min(t,Og):Og]};let o;const i=new Promise(a=>o=a);return{name:kne,getOptions(){const{quality:a,enableManualSnapshot:s,maxCanvasSize:l}=r;return{enableManualSnapshot:s,recordCanvas:!0,getCanvasManager:c=>{const u=new One({...c,enableManualSnapshot:s,maxCanvasSize:l,errorHandler:d=>{try{typeof d=="object"&&(d.__rrweb__=!0)}catch{}}});return o(u),u},...W5[a]||W5.medium}},async snapshot(a){(await i).snapshot(a)}}}),j5=["activate","mount"],Q5=typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__,Vne=/(?:^|[-_])(\w)/g,Une=n=>n.replace(Vne,e=>e.toUpperCase()).replace(/[-_]/g,""),zne="<Root>",Xy="<Anonymous>",Gne=(n,e)=>n.repeat(e),rh=(n,e)=>{if(!n)return Xy;if(n.$root===n)return zne;if(!n.$options)return Xy;const t=n.$options;let r=t.name||t._componentTag||t.__name;const o=t.__file;if(!r&&o){const i=o.match(/([^/\\]+)\.vue$/);i&&(r=i[1])}return(r?`<${Une(r)}>`:Xy)+(o&&e!==!1?` at ${o}`:"")},Hne=n=>{if(n&&(n._isVue||n.__isVue)&&n.$parent){const e=[];let t=0;for(;n;){if(e.length>0){const o=e[e.length-1];if(o.constructor===n.constructor){t++,n=n.$parent;continue}else t>0&&(e[e.length-1]=[o,t],t=0)}e.push(n),n=n.$parent}return`

found in

${e.map((o,i)=>`${(i===0?"---> ":Gne(" ",5+i*2))+(Array.isArray(o)?`${rh(o[0])}... (${o[1]} recursive calls)`:rh(o))}`).join(`
`)}`}return`

(found in ${rh(n)})`},Wne=(n,e)=>{const{errorHandler:t}=n.config;n.config.errorHandler=(r,o,i)=>{var c;const a=rh(o,!1),s=o?Hne(o):"",l={componentName:a,lifecycleHook:i,trace:s};if(e.attachProps&&o&&((c=o.$options)!=null&&c.propsData?l.propsData=o.$options.propsData:o.$props&&(l.propsData=o.$props)),setTimeout(()=>{jA(r,{captureContext:{contexts:{vue:l}},mechanism:{handled:!!t,type:"vue"}})}),typeof t=="function"&&n.config.errorHandler)t.call(n,r,o,i);else throw r}},$5="ui.vue",jne={activate:["activated","deactivated"],create:["beforeCreate","created"],unmount:["beforeUnmount","unmounted"],destroy:["beforeDestroy","destroyed"],mount:["beforeMount","mounted"],update:["beforeUpdate","updated"]};function qy(n,e,t){n.$_sentryRootComponentSpanTimer&&clearTimeout(n.$_sentryRootComponentSpanTimer),n.$_sentryRootComponentSpanTimer=setTimeout(()=>{var r;(r=n.$root)!=null&&r.$_sentryRootComponentSpan&&(n.$root.$_sentryRootComponentSpan.end(e),n.$root.$_sentryRootComponentSpan=void 0)},t)}function Qne(n,e){function t(o){return o.replace(/^<([^\s]*)>(?: at [^\s]*)?$/,"$1")}return n.some(o=>t(e)===t(o))}const $ne=(n={})=>{const e=(n.hooks||[]).concat(j5).filter((o,i,a)=>a.indexOf(o)===i),t={},r=n.timeout||2e3;for(const o of e){const i=jne[o];if(!i){Q5&&lt.warn(`Unknown hook: ${o}`);continue}for(const a of i)t[a]=function(){var f;const s=this.$root===this;s&&(this.$_sentryRootComponentSpan=this.$_sentryRootComponentSpan||rI({name:"Application Render",op:`${$5}.render`,attributes:{[Nf]:"auto.ui.vue"},onlyIfParent:!0}),qy(this,ko(),r));const l=rh(this,!1);if(!(s||(Array.isArray(n.trackComponents)?Qne(n.trackComponents,l):n.trackComponents))){qy(this,ko(),r);return}this.$_sentryComponentSpans=this.$_sentryComponentSpans||{};const u=a===i[0],d=((f=this.$root)==null?void 0:f.$_sentryRootComponentSpan)||BA();if(u){if(d){const h=this.$_sentryComponentSpans[o];h&&h.end(),this.$_sentryComponentSpans[o]=rI({name:`Vue ${l}`,op:`${$5}.${o}`,attributes:{[Nf]:"auto.ui.vue"},onlyIfParent:!0})}}else{const h=this.$_sentryComponentSpans[o];if(!h)return;h.end(),qy(this,ko(),r)}}}return t},Yne={Vue:hn.Vue,attachProps:!0,attachErrorHandler:!0,tracingOptions:{hooks:j5,timeout:2e3,trackComponents:!1}},Xne="Vue",qne=(n={})=>({name:Xne,setup(e){const t={...Yne,...e.getOptions(),...n};if(!t.Vue&&!t.app){Ja(()=>{console.warn("[@sentry/vue]: Misconfigured SDK. Vue specific errors will not be captured. Update your `Sentry.init` call with an appropriate config option: `app` (Application Instance - Vue 3) or `Vue` (Vue Constructor - Vue 2).")});return}t.app?(Array.isArray(t.app)?t.app:[t.app]).forEach(o=>Y5(o,t)):t.Vue&&Y5(t.Vue,t)}}),Y5=(n,e)=>{var t;Q5&&((t=n._instance)==null?void 0:t.isMounted)===!0&&Ja(()=>{console.warn("[@sentry/vue]: Misconfigured SDK. Vue app is already mounted. Make sure to call `app.mount()` after `Sentry.init()`.")}),e.attachErrorHandler&&Wne(n,e),jm(e)&&n.mixin($ne(e.tracingOptions))};function Kne(n={}){const e={defaultIntegrations:[...g4(),qne()],...n};return PI(e,"vue"),UZ(e)}const Zne={class:"flex items-center cursor-pointer justify-between"},Jne={key:0,width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"},ere={key:1,width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"},tre={class:"text-[15px] md:text-base font-normal leading-loose ms-3","data-label":""},nre={class:"flex items-center"},rre={__name:"FormRadioButton",props:{setValueOnClick:{type:[String,Number],default:""},labelDescription:{type:String,default:""},tooltipTitle:{type:String,default:""},tooltipDescription:{type:String,default:""},tooltipImage:{type:String,default:""},modelValue:String},emits:["update:modelValue"],setup(n,{emit:e}){const t=e;function r(o){t("update:modelValue",o),Lr.emit("configuratorUserInput")}return(o,i)=>{const a=Yt("InfoPopup");return he(),ye("div",Zne,[K("div",{class:"flex items-center",onClick:i[0]||(i[0]=s=>r(n.setValueOnClick))},[n.modelValue==n.setValueOnClick?(he(),ye("svg",Jne,[...i[1]||(i[1]=[K("rect",{x:"0.5",y:"0.5",width:"15",height:"15",rx:"7.5",fill:"#F0F3F3",stroke:"#2B3937"},null,-1),K("rect",{x:"3",y:"3",width:"10",height:"10",rx:"5",fill:"#2B3937"},null,-1)])])):(he(),ye("svg",ere,[...i[2]||(i[2]=[K("rect",{x:"0.5",y:"0.5",width:"15",height:"15",rx:"7.5",fill:"#F0F3F3",stroke:"#E1E5E5"},null,-1)])])),K("span",tre,Ae(n.labelDescription),1)]),K("div",nre,[Be(a,{title:n.tooltipTitle,text:n.tooltipDescription,imageSrc:n.tooltipImage},null,8,["title","text","imageSrc"])])])}}},ore=["data-option"],ire={class:"text-secundary-green transition-colors duration-300 relative inline-block"},are=["data-value","src","alt","title"],sre={key:0,class:"absolute inset-0 rounded-md pointer-events-none border-[3px] border-[rgba(0,0,0,0.4)]"},lre={key:0,width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"},cre={key:1,width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"},ure={class:"ml-2 text-tertiary-green text-[15px] font-normal"},dre={__name:"FormRadioButtonImage",props:{setValueOnClick:{type:[String,Number],default:""},labelDescription:{type:String,default:""},tooltipDescription:{type:String,default:""},imageSrc:{type:String,default:""},imageRatio:{type:String,default:""},visible:{type:Boolean,default:!0},active:{type:Boolean,default:!0},tooltipTitle:{type:String,default:null},tooltipImage:{type:String,default:null},index:{type:Number,default:0},modelValue:String},emits:["update:modelValue"],setup(n,{emit:e}){const t=n,r=e;function o(l){r("update:modelValue",l),Lr.emit("configuratorUserInput")}const i=bt(()=>{if(t.index===0)return"left";const l=t.index%3;return l===1?"right":l===2?"bottom":"left"}),a=bt(()=>hr.versionedUrl(t.imageSrc)),s=bt(()=>hr.versionedUrl(t.tooltipImage));return(l,c)=>{const u=Yt("InfoPopup");return n.visible&&n.active?(he(),ye("div",{key:0,class:"cursor-pointer","data-option":n.setValueOnClick},[K("div",{onClick:c[1]||(c[1]=d=>o(n.setValueOnClick))},[K("div",ire,[K("img",{class:Qt(["rounded-md block",[n.imageRatio!==""?n.imageRatio:""]]),"data-value":n.setValueOnClick,src:a.value,alt:n.labelDescription,title:n.labelDescription},null,10,are),n.modelValue==n.setValueOnClick?(he(),ye("div",sre)):Pe("",!0)]),K("label",{class:"flex items-center cursor-pointer py-1",onClick:c[0]||(c[0]=d=>o(n.setValueOnClick))},[n.modelValue==n.setValueOnClick?(he(),ye("svg",lre,[...c[2]||(c[2]=[K("rect",{x:"0.5",y:"0.5",width:"15",height:"15",rx:"7.5",fill:"#F0F3F3",stroke:"#2B3937"},null,-1),K("rect",{x:"3",y:"3",width:"10",height:"10",rx:"5",fill:"#2B3937"},null,-1)])])):(he(),ye("svg",cre,[...c[3]||(c[3]=[K("rect",{x:"0.5",y:"0.5",width:"15",height:"15",rx:"7.5",fill:"#F0F3F3",stroke:"#E1E5E5"},null,-1)])])),K("span",ure,Ae(n.labelDescription),1)])]),n.tooltipTitle?(he(),gt(u,{key:0,title:n.tooltipTitle,text:n.tooltipDescription,imageSrc:s.value,tooltipPosition:i.value},null,8,["title","text","imageSrc","tooltipPosition"])):Pe("",!0)],8,ore)):Pe("",!0)}}},fre=["data-value"],hre=["for"],pre={class:"col-sm-12"},mre=["type","value"],gre={__name:"FormInput",props:{dataName:{type:String,default:""},labelDescription:{type:String,default:""},inputType:{type:String,default:"number"},modelValue:[Number,String]},emits:["update:modelValue"],setup(n,{emit:e}){const t=e;function r(o){t("update:modelValue",o),Lr.emit("configuratorUserInput")}return(o,i)=>(he(),ye("div",{class:"row FormInput","data-value":n.dataName},[K("label",{for:n.dataName,class:"col-sm-12 col-form-label"},Ae(n.labelDescription),9,hre),K("div",pre,[K("input",{type:n.inputType,class:"border-0 w-full rounded-sm bg-background-light p-2 text-[15px] lg:text-base font-normal focus:outline-hidden",value:n.modelValue,onInput:i[0]||(i[0]=a=>r(a.target.value))},null,40,mre)])],8,fre))}},_re={class:"font-normal text-base leading-[2]"},vre={class:"flex"},Are=["min","max","value"],yre={__name:"FormInputCm",props:bE({labelDescription:{type:String,default:""},min:{type:Number,default:-1/0},max:{type:Number,default:1/0}},{modelValue:{type:[String,Number]},modelModifiers:{}}),emits:bE(["update:modelValue"],["update:modelValue"]),setup(n,{emit:e}){const t=t7(n,"modelValue"),r=e,o=vt(t.value??"");dr(()=>t.value,a=>{o.value=a??""});function i(a){a!==t.value&&(r("update:modelValue",a),Lr.emit("configuratorUserInput"))}return(a,s)=>(he(),ye("div",null,[K("div",_re,Ae(n.labelDescription),1),K("div",vre,[K("input",{type:"number",class:"h-11 lg:h-12 rounded-none rounded-s-sm bg-background-light border-0 text-secondary-green block flex-1 min-w-0 w-full p-1 px-4 text-[15px] lg:text-base font-normal focus:outline-hidden",min:n.min,max:n.max,step:"1",value:o.value,onChange:s[0]||(s[0]=l=>i(l.target.value))},null,40,Are),s[1]||(s[1]=K("span",{class:"flex h-11 w-10 lg:h-12 lg:w-15 items-center justify-center text-center rounded-s-0 border-0 rounded-e-sm bg-[#E0E5E5] text-secondary-green text-[15px] lg:text-base font-normal"}," cm ",-1))])]))}},bre={class:"mb-3"},xre=["id","name","placeholder","value"],Ere={__name:"FormInputTextarea",props:{dataName:{type:String,default:""},labelDescription:{type:String,default:""},modelValue:[Number,String]},emits:["update:modelValue"],setup(n,{emit:e}){const t=e;function r(o){t("update:modelValue",o),Lr.emit("configuratorUserInput")}return(o,i)=>(he(),ye("div",bre,[K("textarea",{class:"border-0 w-full rounded-sm bg-background-light p-2 text-[15px] lg:text-base font-normal focus:outline-hidden",id:n.dataName,name:n.dataName,placeholder:n.labelDescription,value:n.modelValue,onInput:i[0]||(i[0]=a=>r(a.target.value))},null,40,xre)]))}},Cre={key:0,class:"inline-flex rounded-md bg-background-light",role:"group","aria-label":""},Sre=["onClick"],wre={__name:"FormButtonGroupQuantity",props:{minCount:{type:Number,default:1},maxCount:{type:Number,default:1},modelValue:[String,Number]},emits:["update:modelValue"],setup(n,{emit:e}){const t=n,r=e;function o(a){a<t.minCount?a=t.minCount:a>t.maxCount&&(a=t.maxCount),r("update:modelValue",a),Lr.emit("configuratorUserInput")}function i(a,s){return Array.from({length:s-a+1},(l,c)=>a+c)}return(a,s)=>{const l=Yt("Tooltip");return n.maxCount>=1&&n.maxCount>=n.minCount?(he(),ye("div",Cre,[(he(!0),ye(Nt,null,Xn(i(n.minCount,n.maxCount),c=>(he(),ye("div",null,[Be(l,{title:"",position:"bottom"},{default:ot(()=>[K("button",{class:Qt(["cursor-pointer w-buttonwidth-sm md:w-buttonwidth-md lg:w-buttonwidth-lg h-buttonheight-sm md:h-buttonheight-md lg:h-buttonheight-lg rounded-md hover:bg-secondary-green hover:text-white transition text-base font-normal",c==n.modelValue?"bg-button-active-dark text-white":"bg-background-light text-tertiary-green"]),onClick:u=>o(c)},Ae(c),11,Sre)]),_:2},1024)]))),256))])):Pe("",!0)}}},Mre={key:0,class:"inline-flex rounded-md bg-background-light"},Tre=["onClick"],Ire={__name:"FormButtonGroupChoice",props:{options:{type:Array,default:[]},modelValue:[String,Number]},emits:["update:modelValue"],setup(n,{emit:e}){const t=n,r=e;function o(i){r("update:modelValue",i),Lr.emit("configuratorUserInput")}return dr(()=>t.modelValue,(i,a)=>{}),(i,a)=>{const s=Yt("Tooltip");return n.options.length?(he(),ye("div",Mre,[(he(!0),ye(Nt,null,Xn(n.options,(l,c)=>(he(),ye("div",{key:c},[Be(s,{title:l.tooltip??"",position:"bottom"},{default:ot(()=>[K("button",{class:Qt(["cursor-pointer w-buttonwidth-sm md:w-buttonwidth-md lg:w-buttonwidth-lg h-buttonheight-sm md:h-buttonheight-md lg:h-buttonheight-lg rounded-md hover:bg-secondary-green hover:text-white transition text-base font-normal",l.value==n.modelValue?"bg-button-active-dark text-white":"bg-background-light text-tertiary-green"]),onClick:u=>o(l.value)},Ae(l.label),11,Tre)]),_:2},1032,["title"])]))),128))])):Pe("",!0)}}},Rre={},Lre={class:"font-medium text-base leading-[1.2] pb-4"};function Pre(n,e){return he(),ye("div",Lre,[Ro(n.$slots,"default")])}const Dre=zi(Rre,[["render",Pre]]),Bre={__name:"FormDefaultValue",props:{defaultValue:{type:[Number,String,Boolean]},modelValue:[Number,String,Boolean]},emits:["update:modelValue"],setup(n,{emit:e}){const t=n;$o(()=>{r("update:modelValue",t.defaultValue)});const r=e;return(o,i)=>null}},Nre={class:"text-base font-normal truncate"},Ore=["onClick"],kre={class:"text-base font-normal"},Fre=zi({__name:"FormDropdown",props:{options:{type:Array,required:!0},modelValue:{type:[Number,String,Object],required:!0},mode:{type:String,default:"light",validator:n=>["light","dark"].includes(n)}},emits:["update:modelValue"],setup(n,{emit:e}){const t=n,r=e,o=bt(()=>t.options.find(m=>{var g;return typeof t.modelValue=="object"?m.value===((g=t.modelValue)==null?void 0:g.value):m.value===t.modelValue})),i=vt(!1),a=vt(null),s=bt(()=>t.mode==="dark"),l=bt(()=>["pl-4 pr-2 py-2 cursor-pointer select-none flex items-center justify-between w-full h-12 sm:h-12",i.value?"rounded-t-md":"rounded-md",s.value?(i.value,"bg-popup-input text-white"):i.value?"bg-background-light text-tertiary-green border border-gray-200":"bg-white text-tertiary-green border border-gray-200"]),c=bt(()=>["absolute top-full z-50 w-full rounded-b-md shadow-lg overflow-auto max-h-60",s.value?"bg-popup-input":"bg-white border"]),u=bt(()=>["items-center h-full",s.value?"text-white":"text-tertiary-green"]),d=bt(()=>["flex px-5 h-12 cursor-pointer items-center justify-between",s.value?"hover:bg-background-light hover:text-tertiary-green":"hover:bg-gray-100"]),f=m=>{i.value=!i.value,m==null||m.preventDefault(),console.log("Dropdown toggled:",i.value)},h=m=>{a.value&&!a.value.contains(m.target)&&(i.value=!1)},p=m=>{i.value=!1,Va(()=>{r("update:modelValue",m.value),Lr.emit("configuratorUserInput")})};return $o(()=>document.addEventListener("click",h)),Fc(()=>document.removeEventListener("click",h)),(m,g)=>{var _;return he(),ye("div",{class:"relative",ref_key:"dropdown",ref:a},[K("button",{class:Qt(l.value),onPointerdown:ja(f,["stop","prevent"]),id:"dropdownButton"},[K("span",Nre,Ae(((_=o.value)==null?void 0:_.label)||"Selecteer een optie"),1),(he(),ye("svg",{class:Qt(["w-4 h-4 mx-2 transition-transform duration-800",{"rotate-180":i.value}]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...g[0]||(g[0]=[K("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)])],2))],34),Be(Ll,{name:"dropdown-fade"},{default:ot(()=>[i.value?(he(),ye("div",{key:0,id:"dropdownMenu",class:Qt(c.value)},[K("ul",{class:Qt(u.value)},[(he(!0),ye(Nt,null,Xn(n.options,(A,y)=>(he(),ye("li",{key:y,class:Qt(d.value),onClick:ja(b=>p(A),["stop"])},[K("span",kre,Ae(A.label),1)],10,Ore))),128))],2)],2)):Pe("",!0)]),_:1})],512)}}},[["__scopeId","data-v-1c0bf501"]]),Vre=["title"],Ure={__name:"FormButtonImageSvg",props:{setValueOnClick:{type:[String,Number],default:""},labelDescription:{type:String,default:""},tooltipDescription:{type:String,default:""},imageSrc:{type:String,default:""},modelValue:String},emits:["update:modelValue"],setup(n,{emit:e}){const t=e;function r(o){t("update:modelValue",o),Lr.emit("configuratorUserInput")}return UE(()=>{}),$o(()=>{}),(o,i)=>(he(),ye("div",{class:Qt(["flex-none rounded-md w-[50px] h-[75px] hover:text-background-light hover:bg-tertiary-green transition-colors duration-300 items-center justify-center cursor-pointer",n.setValueOnClick==n.modelValue?"bg-tertiary-green text-background-light":"bg-background-light text-tertiary-green"]),onClick:i[0]||(i[0]=a=>r(n.setValueOnClick)),title:n.labelDescription},[Ro(o.$slots,"default")],10,Vre))}},zre={class:"inline-flex rounded-md bg-background-light"},Gre=["onClick"],Hre={__name:"FormSegmentedControl",props:{options:{type:Object,required:!0},modelValue:[String,Number,Boolean]},emits:["update:modelValue"],setup(n,{emit:e}){const t=e;function r(o){t("update:modelValue",o),Lr.emit("configuratorUserInput")}return(o,i)=>{const a=Yt("Tooltip");return he(),ye("div",zre,[(he(!0),ye(Nt,null,Xn(n.options,(s,l)=>(he(),ye("div",{key:l},[Be(a,{title:s.tooltip??"",position:"bottom"},{default:ot(()=>[K("button",{class:Qt(["cursor-pointer h-buttonheight-sm md:h-buttonheight-md lg:h-buttonheight-lg rounded-md px-4 py-2 hover:bg-dropdown-open hover:text-white transition text-base font-normal",s.value==n.modelValue?"bg-secondary-green text-white":"bg-background-light text-tertiary-green"]),onClick:c=>r(s.value)},Ae(s.label),11,Gre)]),_:2},1032,["title"])]))),128))])}}},Wre={class:"flex flex-col-reverse md:flex-col"},jre={key:0,class:"flex text-white"},Qre={class:"text-white text-base font-normal mr-2"},$re={class:"text-white text-[26px] md:text-[28px] xl:text-[32px] font-bold"},Yre={class:"hidden md:inline-block text-xs font-normal ms-2"},Xre={class:"inline-block md:hidden text-xs font-normal ms-1"},qre={class:"block md:hidden text-xs font-normal ms-0"},Kre={class:"flex flex-row space-x-2 min-[400px]:space-x-4"},Zre={class:"ml-2 mr-4 text-base font-normal"},Jre={class:"hidden min-[450px]:block ml-2 mr-4 text-base font-normal"},eoe={class:"hidden md:inline"},toe={class:"md:hidden"},noe={class:"ml-2 mr-4 text-base font-normal"},roe={class:"hidden min-[650px]:block"},ooe={class:"min-[650px]:hidden"},ioe={class:"p-2 md:px-6 md:py-4"},aoe={class:"flex justify-between text-white text-lg py-1 border-t border-white/20 mt-2 pt-2 font-bold"},soe={class:"text-sm font-normal"},loe={class:"flex justify-between text-white text-sm py-1 mt-1 font-bold"},coe={class:"font-normal"},uoe={class:"flex flex-wrap items-center justify-center mt-4 mb-4 space-x-3 text-[#868c8b] text-sm font-normal"},doe={__name:"FooterPrice",props:{buttonQuoteVisible:{type:Boolean,default:!1},buttonSaveVisible:{type:Boolean,default:!1},buttonQuoteRequestOrUpdate:{type:Boolean,default:!1},existingConfig:{type:Boolean,default:!1},baseUrl:String,priceItems:{type:Array,default:()=>[]}},emits:["clickQuoteButton","clickSaveButton"],setup(n,{emit:e}){const t=e,r=n,o=Lo("CUtils"),i=vt(!1),a=vt(!1),s=vt(null),l=vt(0),c=bt(()=>r.priceItems.filter(p=>p.type==="configuration").length),u=bt(()=>(i.value||a.value)&&c.value>0&&!r.existingConfig),d=bt(()=>r.priceItems.reduce((p,m)=>p+(typeof m.price=="number"?m.price:0),0)),f=bt(()=>d.value*1.21);function h(){!i.value&&s.value&&(l.value=s.value.scrollHeight),a.value=!0,i.value=!i.value,setTimeout(()=>{a.value=!1},800)}return dr(()=>r.priceItems,async()=>{i.value&&s.value&&(await Va(),l.value=s.value.scrollHeight)},{deep:!0}),(p,m)=>{const g=Yt("InfoPopup");return he(),ye(Nt,null,[K("div",{class:Qt(["bg-tertiary-green p-2 md:px-6 md:py-4 flex items-center justify-between",u.value?"rounded-t-lg lg:rounded-t-xl":"rounded-lg lg:rounded-xl"])},[K("div",Wre,[n.existingConfig?(he(),ye("div",jre,[K("div",Qre,Ae(p.$t("footer.product_price")),1),Be(g,{title:p.$t("footer.product_price_title"),text:p.$t("footer.product_price_explain"),imageSrc:n.baseUrl+"/Uploads/aluwdoors-popup.png"},null,8,["title","text","imageSrc"])])):Pe("",!0),K("div",$re,[Ro(p.$slots,"price"),K("div",Yre,[Ye(Ae(p.$t("footer.excl_vat_assembly_transport")),1),m[2]||(m[2]=K("br",null,null,-1)),Ro(p.$slots,"priceInclVat"),Ye(" "+Ae(p.$t("footer.incl_vat")),1)]),K("div",Xre,Ae(p.$t("footer.excl_vat")),1),K("div",qre,[Ro(p.$slots,"priceInclVat"),Ye(" "+Ae(p.$t("footer.incl_vat")),1)])])]),K("div",Kre,[n.buttonSaveVisible?(he(),ye("button",{key:0,class:"h-10.5 md:h-11 xl:h-13 max-lg:hidden flex items-center justify-center text-center py-2 border border-white bg-tertiary-green rounded text-white hover:bg-secondary-green hover:text-white transition-colors duration-200 focus:outline-hidden cursor-pointer",onClick:m[0]||(m[0]=_=>t("clickSaveButton"))},[m[3]||(m[3]=K("svg",{class:"ml-4 mr-2",width:"14",height:"14",viewBox:"0 0 14 14",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},[K("path",{d:"M1 14H0V13V1V0H1H10.5L14 3.5V13V14H13H1ZM13 13V3.9375L10.0625 1H10V4.5V5H9.5H2.5H2V4.5V1H1V13H13ZM3 1V4H9V1H3ZM5.5 9C5.5 9.5625 5.78125 10.0312 6.25 10.3125C6.6875 10.5938 7.28125 10.5938 7.75 10.3125C8.1875 10.0312 8.5 9.5625 8.5 9C8.5 8.46875 8.1875 8 7.75 7.71875C7.28125 7.4375 6.6875 7.4375 6.25 7.71875C5.78125 8 5.5 8.46875 5.5 9ZM7 11.5C6.09375 11.5 5.28125 11.0312 4.8125 10.25C4.375 9.5 4.375 8.53125 4.8125 7.75C5.28125 7 6.09375 6.5 7 6.5C7.875 6.5 8.6875 7 9.15625 7.75C9.59375 8.53125 9.59375 9.5 9.15625 10.25C8.6875 11.0312 7.875 11.5 7 11.5Z"})],-1)),K("div",Zre,Ae(p.$t("buttons.save_configuration")),1)])):Pe("",!0),n.existingConfig?Pe("",!0):(he(),ye("button",{key:1,class:"h-10.5 md:h-11 xl:h-13 flex items-center justify-center text-center py-2 px-3 min-[450px]:py-2 min-[450px]:px-0 border border-white bg-tertiary-green rounded text-white hover:bg-secondary-green hover:text-white focus:outline-hidden transition-all duration-500 ease-[cubic-bezier(0.42,0,0.58,1)] cursor-pointer",onClick:h},[(he(),ye("svg",{class:Qt(["min-[450px]:ml-4 transition-transform rotate-180",{"rotate-0!":i.value}]),style:{"transition-duration":"800ms"},width:"12",height:"8",viewBox:"0 0 12 8",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},[...m[4]||(m[4]=[K("path",{d:"M6 0.5L12 6.5L10.59 7.91L6 3.33L1.41 7.91L0 6.5L6 0.5Z"},null,-1)])],2)),K("div",Jre,[K("span",eoe,Ae(p.$t("footer.total_price")),1),K("span",toe,Ae(p.$t("footer.total")),1)])])),n.buttonQuoteVisible?(he(),ye("button",{key:2,class:"h-10.5 md:h-11 xl:h-13 flex items-center justify-center text-center py-2 bg-primary-green rounded text-tertiary-green hover:bg-button-hover-green transition-colors duration-200 focus:outline-hidden cursor-pointer",onClick:m[1]||(m[1]=_=>t("clickQuoteButton",n.buttonQuoteRequestOrUpdate))},[m[5]||(m[5]=K("svg",{class:"ml-4 mr-2",width:"12",height:"16",viewBox:"0 0 12 16",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},[K("path",{d:"M1 15H11V6H6.5H6V5.5V1H1V15ZM7 1.1875V5H10.8125L7 1.1875ZM7.25 0L12 4.75V15V16H11H1H0V15V1V0H1H7.25ZM2 2H2.5H4.5H5V3H4.5H2.5H2V2ZM2 4H2.5H4.5H5V5H4.5H2.5H2V4ZM7 14V13H7.5H9.5H10V14H9.5H7.5H7ZM9 10.5V8.5H3V10.5H9ZM3 7.5H9H10V8.5V10.5V11.5H9H3H2V10.5V8.5V7.5H3Z"})],-1)),K("div",noe,[K("span",roe,Ae(n.buttonQuoteRequestOrUpdate?p.$t("editQuote"):p.$t("requestQuote")),1),K("span",ooe,Ae((n.buttonQuoteRequestOrUpdate,p.$t("quote"))),1)])])):Pe("",!0)])],2),K("div",{ref_key:"priceListRef",ref:s,class:Qt(["bg-secondary-green overflow-hidden transition-all ease-in-out",u.value&&i.value?"rounded-b-lg lg:rounded-b-xl border-t border-white/20":u.value?"rounded-b-lg lg:rounded-b-xl":""]),style:Rd({maxHeight:i.value?l.value+"px":"0px",transitionDuration:"800ms"})},[K("div",ioe,[(he(!0),ye(Nt,null,Xn(n.priceItems,(_,A)=>{var y;return he(),ye("div",{key:A,class:Qt(["flex justify-between text-white text-sm py-1",{"border-t border-white/20 mt-2 pt-2":_.type==="extra"&&((y=n.priceItems[A-1])==null?void 0:y.type)==="configuration"}])},[K("span",null,Ae(_.name),1),K("span",null,Ae(typeof _.price=="string"?_.price:Ct(o).formatCurrencyFormat(_.price)+" "+p.$t("footer.excl_vat")),1)],2)}),128)),K("div",aoe,[K("span",null,Ae(p.$t("footer.total_price")),1),K("span",null,[Ye(Ae(Ct(o).formatCurrencyFormat(d.value))+" ",1),K("span",soe,Ae(p.$t("footer.excl_vat")),1)])]),K("div",loe,[m[6]||(m[6]=K("span",null,null,-1)),K("span",null,[Ye(Ae(Ct(o).formatCurrencyFormat(f.value))+" ",1),K("span",coe,Ae(p.$t("footer.incl_vat")),1)])])])],6),K("div",uoe,[K("span",null,Ae(p.$t("footer.questions_contact")),1),m[7]||(m[7]=XE('<svg width="10" height="15" viewBox="0 0 10 15" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8.75 1.125H1.75V9H8.75V1.125ZM8.75 9.875H1.75V13.375H8.75V9.875ZM1.75 0.25H8.75H9.625V1.125V13.375V14.25H8.75H1.75H0.875V13.375V1.125V0.25H1.75ZM5.90625 11.625C5.90625 12.0078 5.60547 12.2812 5.25 12.2812C4.86719 12.2812 4.59375 12.0078 4.59375 11.625C4.59375 11.2695 4.86719 10.9688 5.25 10.9688C5.60547 10.9688 5.90625 11.2695 5.90625 11.625Z" fill="#868c8b"></path></svg><a href="tel:0851301965" class="hover:underline">085 - 1301 965</a><svg width="14" height="15" viewBox="0 0 14 15" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M0 8.125L0.957031 7.60547L13.043 0.796875L14 0.25L13.8359 1.34375L12.3594 12.5L12.25 13.375L11.4023 13.0195L6.125 10.7773V11.6523V12.9922L6.61719 13.1836L7.71094 11.4336L8.50391 11.7891L7 14.25L5.25 13.5938V11.625V10.3945L1.01172 8.5625L0 8.125ZM6.53516 9.98438L11.5117 12.1172L12.7969 2.65625L6.53516 9.98438ZM11.7578 2.51953L1.96875 8.04297L5.6875 9.62891L11.7578 2.51953Z" fill="#868c8b"></path></svg><a href="mailto:sales@aluwdoors.com" class="hover:underline">sales@aluwdoors.com</a>',4))])],64)}}},foe={},hoe={class:"flex items-center w-full justify-between"},poe={class:"w-1/2"};function moe(n,e){return he(),ye("div",hoe,[K("div",null,[Ro(n.$slots,"label")]),K("div",poe,[Ro(n.$slots,"input")])])}const goe=zi(foe,[["render",moe]]),_oe={class:"flex items-center"},voe={key:0,class:"tf-configurator fixed left-0 right-0 top-0 bottom-0 z-99999"},Aoe={class:"md:w-[440px] rounded-lg overflow-hidden shadow-lg h-full! max-h-100! sm:max-h-full!"},yoe=["src","alt"],boe={class:"relative w-full md:w-[645px] bg-secondary-green text-white rounded-xl p-6 md:p-8 shadow-xl"},xoe={class:"text-2xl font-semibold mb-4 mr-12"},Eoe={class:"text-sm text-gray-300 leading-relaxed whitespace-pre-line"},Coe=zi({__name:"InfoPopup",props:{title:{type:String,required:!0},text:{type:String,required:!0},imageSrc:{type:String,default:""},imageAlt:{type:String,default:"Popup afbeelding"},tooltipPosition:{type:String,default:"left"}},setup(n){const e=n,t=vt(!1),r=bt(()=>hr.versionedUrl(e.imageSrc));return(o,i)=>{const a=Yt("Tooltip");return he(),ye(Nt,null,[K("div",_oe,[Be(a,{title:n.text,position:n.tooltipPosition},{default:ot(()=>[(he(),ye("svg",{class:"flex",width:"18",height:"16",viewBox:"0 0 18 16",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",onClick:i[0]||(i[0]=s=>t.value=!0)},[...i[4]||(i[4]=[K("path",{d:"M9 1C6.46875 1 4.1875 2.34375 2.9375 4.5C1.65625 6.6875 1.65625 9.34375 2.9375 11.5C4.1875 13.6875 6.46875 15 9 15C11.5 15 13.7812 13.6875 15.0312 11.5C16.3125 9.34375 16.3125 6.6875 15.0312 4.5C13.7812 2.34375 11.5 1 9 1ZM9 16C6.125 16 3.5 14.5 2.0625 12C0.625 9.53125 0.625 6.5 2.0625 4C3.5 1.53125 6.125 0 9 0C11.8438 0 14.4688 1.53125 15.9062 4C17.3438 6.5 17.3438 9.53125 15.9062 12C14.4688 14.5 11.8438 16 9 16ZM7 11H7.5H8.5V8H7.75H7.25V7H7.75H9H9.5V7.5V11H10.5H11V12H10.5H7.5H7V11ZM9.75 5.75H8.25V4.25H9.75V5.75Z"},null,-1)])]))]),_:1},8,["title","position"])]),(he(),gt(Oc,{to:"body"},[Be(Ll,{name:"popup",appear:""},{default:ot(()=>[t.value?(he(),ye("div",voe,[K("div",{class:"w-full h-full bg-[#1b2221]/95 flex items-center justify-center px-4 py-8 cursor-pointer",onClick:i[3]||(i[3]=s=>t.value=!1)},[K("div",{class:"flex flex-col-reverse sm:flex-row max-w-4xl w-full gap-4 md:gap-6 items-stretch cursor-default",onClick:i[2]||(i[2]=ja(()=>{},["stop"]))},[K("div",Aoe,[K("img",{src:r.value,alt:e.title,class:"w-full h-100 object-cover"},null,8,yoe)]),K("div",boe,[K("button",{class:"cursor-pointer absolute top-4 right-4 w-15 h-12 rounded-md bg-tertiary-green text-white hover:bg-primary-green hover:text-tertiary-green transition-all ease-in-out duration-500 flex items-center justify-center",onClick:i[1]||(i[1]=s=>t.value=!1)},[...i[5]||(i[5]=[K("span",{class:"item-center justify-center"},[K("svg",{width:"13",height:"13",viewBox:"0 0 13 13",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[K("path",{d:"M6.58261 5.64062L11.7389 0.445312L12.6373 1.34375L7.44198 6.5L12.6373 11.6953L11.7389 12.5938L6.58261 7.39844L1.3873 12.5938L0.488859 11.6953L5.68417 6.5L0.488859 1.34375L1.3873 0.445312L6.58261 5.64062Z",fill:"currentColor"})])],-1)])]),K("div",null,[K("h2",xoe,Ae(n.title),1),K("span",Eoe,Ae(n.text),1)])])])])])):Pe("",!0)]),_:1})]))],64)}}},[["__scopeId","data-v-f37eef27"]]),Soe={key:0,name:"configurator_popup-holder",appear:"",class:"tf-configurator fixed inset-0 z-99999"},woe={name:"configurator_popup-inner",class:"z-99999 relative w-full h-full flex justify-center items-center gap-6 flex-col-reverse md:flex-row"},Moe=["src"],Toe=zi({__name:"ConfirmDlg",props:{imageSrc:{type:String,default:""},imageAlt:{type:String,default:"Popup afbeelding"},modelValue:{type:Boolean,default:!1}},emits:["update:modelValue","submit"],setup(n,{emit:e}){const t=n,r=e;function o(){r("update:modelValue",!1)}function i(s){s.key==="Escape"&&o()}const a=bt(()=>hr.versionedUrl(t.imageSrc));return dr(()=>t.modelValue,s=>{s?(document.addEventListener("keydown",i),document.body.style.overflow="hidden"):(document.removeEventListener("keydown",i),document.body.style.overflow="")}),Wd(()=>{document.removeEventListener("keydown",i),document.body.style.overflow=""}),(s,l)=>(he(),gt(Oc,{to:"body"},[Be(Ll,{name:"popup",appear:""},{default:ot(()=>[n.modelValue?(he(),ye("div",Soe,[K("div",{class:"w-full h-full p-3 md:p-6 lg:p-10 bg-[#1B2221]/94 flex justify-center items-center cursor-pointer",onClick:o},[K("div",woe,[K("div",{name:"configurator_popup_img",class:"cursor-pointer [@media(max-height:800px)]:hidden h-full! max-h-50! md:max-h-full! w-full md:max-w-60 lg:max-w-100 rounded-2xl",onClick:l[0]||(l[0]=ja(()=>{},["stop"]))},[K("img",{src:a.value,alt:"Hoogwaardige stalen deuren en wanden op maat.",class:"h-full! max-h-50! md:max-h-full! w-full rounded-2xl object-cover",loading:"lazy",onClick:o},null,8,Moe)]),K("div",{name:"configurator_popup_box",class:"cursor-default relative flex overflow-x-clip overflow-y-auto rounded-2xl md:max-w-150 max-h-full bg-secondary-green text-white w-full h-full p-6 sm:p-8",onClick:l[1]||(l[1]=ja(()=>{},["stop"]))},[K("button",{class:"cursor-pointer absolute top-4 right-4 w-15 h-12 rounded-md bg-tertiary-green text-white hover:bg-primary-green hover:text-tertiary-green transition-all ease-in-out duration-500 flex items-center justify-center",onClick:o},[...l[2]||(l[2]=[K("span",{class:"item-center justify-center"},[K("svg",{width:"13",height:"13",viewBox:"0 0 13 13",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[K("path",{d:"M6.58261 5.64062L11.7389 0.445312L12.6373 1.34375L7.44198 6.5L12.6373 11.6953L11.7389 12.5938L6.58261 7.39844L1.3873 12.5938L0.488859 11.6953L5.68417 6.5L0.488859 1.34375L1.3873 0.445312L6.58261 5.64062Z",fill:"currentColor"})])],-1)])]),Ro(s.$slots,"default",{},void 0,!0)])])])])):Pe("",!0)]),_:3})]))}},[["__scopeId","data-v-b139d0fd"]]),Ioe={class:"relative group"},Roe={class:"relative bg-secondary-green text-white text-sm px-3 py-1 rounded w-50 z-99999"},Loe={__name:"Tooltip",props:{title:{type:String,required:!0,default:""},position:{type:String,default:"left"}},setup(n){const e={left:"right-full top-1/2 -translate-y-1/2 mr-2",right:"left-full top-1/2 -translate-y-1/2 ml-2",top:"bottom-full left-1/2 -translate-x-1/2 mb-2 text-center",bottom:"top-full left-1/2 -translate-x-1/2 mt-2 text-center"},t={left:"absolute top-1/2 -translate-y-1/2 -right-1.5 w-3 h-3 bg-secondary-green rotate-45",right:"absolute top-1/2 -translate-y-1/2 -left-1.5 w-3 h-3 bg-secondary-green rotate-45",top:"absolute left-1/2 -translate-x-1/2 -bottom-1.5 w-3 h-3 bg-secondary-green rotate-45",bottom:"absolute left-1/2 -translate-x-1/2 -top-1.5 w-3 h-3 bg-secondary-green rotate-45"};return(r,o)=>(he(),ye("div",Ioe,[Ro(r.$slots,"default"),n.title!==""?(he(),ye("div",{key:0,class:Qt(["absolute z-99999 hidden group-hover:block",e[n.position]])},[K("div",Roe,[Ye(Ae(n.title)+" ",1),K("div",{class:Qt(t[n.position])},null,2)])],2)):Pe("",!0)]))}},Poe={__name:"UserMessage",props:{modelValue:{type:[String],default:[]}},emits:["update:modelValue"],setup(n,{emit:e}){const t=e;function r(){t("update:modelValue","")}return(o,i)=>n.modelValue?(he(),ye("div",{key:0,class:"text-red-500",onClick:r},Ae(n.modelValue),1)):Pe("",!0)}},Doe=HO({legacy:!1,locale:"nl",fallbackLocale:"nl",messages:{nl:JO,en:ek,de:tk}}),Qn=J7(sF);Kne({app:Qn,dsn:"https://17b84166baaa55030829603dfbf308eb@o4508674974023680.ingest.de.sentry.io/4509321955901520",sendDefaultPii:!0,integrations:[vne({maskAllText:!1,blockAllMedia:!1}),Fne()],replaysSessionSampleRate:.1,replaysOnErrorSampleRate:1}),Qn.provide("CUtils",hr),Qn.use(uT),Qn.component("FormRadioButton",rre),Qn.component("FormRadioButtonImage",dre),Qn.component("FormInput",gre),Qn.component("FormInputCm",yre),Qn.component("FormInputTextarea",Ere),Qn.component("FormButtonGroupQuantity",wre),Qn.component("FormButtonGroupChoice",Ire),Qn.component("FormInputCheckbox",lT),Qn.component("FormHeader",Dre),Qn.component("FormDefaultValue",Bre),Qn.component("FormDropdown",Fre),Qn.component("FooterPrice",doe),Qn.component("FormButtonImageSvg",Ure),Qn.component("FormSegmentedControl",Hre),Qn.component("InfoPopup",Coe),Qn.component("ConfirmDlg",Toe),Qn.component("Tooltip",Loe),Qn.component("UserMessage",Poe),Qn.component("GroupFormInputCmWithLabel",goe),Qn.use(Doe);const Boe=()=>{Qn.mount("#configurator")};window.mountConfigurator={mount:Boe};const Noe="4.10.0",ql={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},Ooe={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},koe=0,Foe=1,Voe=2,Uoe=3,zoe=0,Goe=1,Hoe=2,Woe=3,joe=0,Qoe=1,$oe=2,Yoe=3,Xoe=0,qoe=1,Koe=2,Zoe=3,Joe=4,eie=5,X5=100,q5=101,K5=102,tie=103,nie=104,Z5=200,J5=201,eR=202,tR=203,nR=204,rR=205,oR=206,iR=207,aR=208,sR=209,lR=210,rie=0,oie=1,iie=2,aie=3,sie=4,lie=5,cie=6,uie=7,die=0,fie=1,hie=2,pie=0,mie=1,gie=2,_ie=3,vie=4,Aie=5,yie=6,bie=7,xie=8,Eie=9,Cie=10,Sie=0,wie=1,Mie=300,Tie=301,Iie=302,Rie=303,Lie=304,Pie=306,cR=1e3,uR=1001,dR=1002,fR=1003,hR=1004,Die=1004,pR=1005,Bie=1005,mR=1006,gR=1007,Nie=1007,_R=1008,Oie=1008,kie=1009,Fie=1010,Vie=1011,Uie=1012,zie=1013,Gie=1014,Hie=1015,Wie=1016,jie=1017,Qie=1018,$ie=1020,Yie=1021,vR=1023,Xie=1024,qie=1025,AR=1026,Kie=1027,Zie=1028,Jie=1029,yR=1030,eae=1031,tae=1033,bR=33776,nae=33777,rae=33778,xR=33779,ER=35840,oae=35841,CR=35842,iae=35843,SR=36196,wR=37492,MR=37496,TR=37808,aae=37809,sae=37810,lae=37811,cae=37812,uae=37813,dae=37814,fae=37815,hae=37816,pae=37817,mae=37818,gae=37819,_ae=37820,vae=37821,IR=36492,Aae=2200,yae=2201,bae=2202,xae=2300,Eae=2301,Cae=2302,Sae=2400,wae=2401,Mae=2402,Tae=2500,Iae=2501,Rae=0,Lae=1,Pae=2,Dae=3e3,Bae=3001,Nae=3200,Oae=3201,kae=3202,Fae=3301,Vae=3302,Uae=0,zae=1,Gae="",Ky="srgb",Zy="srgb-linear",Hae=0,Wae=7680,jae=7681,Qae=7682,$ae=7683,Yae=34055,Xae=34056,qae=5386,Kae=512,Zae=513,Jae=514,ese=515,tse=516,nse=517,rse=518,ose=519,ise=35044,ase=35048,sse=35040,lse=35045,cse=35049,use=35041,dse=35046,fse=35050,hse=35042,pse="100",Jy="300 es",mse=1035,gse="ALL",kg="__V3DL__4533c15f09",_se=0,vse=1,Ase=2,yse=3,bse=4,xse=5,Ese=0,Cse=1,Sse=2,wse=0,Mse=1,Tse=0,Ise=1,Rse=2,Lse=0,Pse=1,Dse=0,Bse=1,Nse=2;class ti{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const r=this._listeners;r[e]===void 0&&(r[e]=[]),r[e].indexOf(t)===-1&&r[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;const r=this._listeners;return r[e]!==void 0&&r[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;const r=this._listeners[e];if(r!==void 0){const o=r.indexOf(t);o!==-1&&r.splice(o,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const t=this._listeners[e.type];if(t!==void 0){e.target=this;const r=t.slice(0);for(let o=0,i=r.length;o<i;o++)r[o].call(this,e);e.target=null}}}const Ose=new RegExp("^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$"),ss=Math.PI/180,xu=180/Math.PI,oo=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let RR=1234567;function ji(){const n=4294967295*Math.random()|0,e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,r=4294967295*Math.random()|0;return(oo[255&n]+oo[n>>8&255]+oo[n>>16&255]+oo[n>>24&255]+"-"+oo[255&e]+oo[e>>8&255]+"-"+oo[e>>16&15|64]+oo[e>>24&255]+"-"+oo[63&t|128]+oo[t>>8&255]+"-"+oo[t>>16&255]+oo[t>>24&255]+oo[255&r]+oo[r>>8&255]+oo[r>>16&255]+oo[r>>24&255]).toLowerCase()}function oh(n){return Ose.test(n)}function Ht(n,e=0,t=1){return Math.max(e,Math.min(t,n))}function e2(n,e){return(n%e+e)%e}function kse(n,e,t,r,o){return r+(n-e)*(o-r)/(t-e)}function Fse(n,e,t){return n!==e?(t-n)/(e-n):0}function Aa(n,e,t){return(1-t)*n+t*e}function Vse(n,e,t,r){return Aa(n,e,1-Math.exp(-t*r))}function Use(n,e=1){return e-Math.abs(e2(n,2*e)-e)}function zse(n,e,t){return n<=e?0:n>=t?1:(n=(n-e)/(t-e))*n*(3-2*n)}function t2(n,e,t){return n<=e?0:n>=t?1:(n=(n-e)/(t-e))*n*n*(n*(6*n-15)+10)}function Gse(n,e){return n+Math.floor(Math.random()*(e-n+1))}function Hse(n,e){return n+Math.random()*(e-n)}function Wse(n){return n*(.5-Math.random())}function jse(n){n!==void 0&&(RR=n);let e=RR+=1831565813;return e=Math.imul(e^e>>>15,1|e),e^=e+Math.imul(e^e>>>7,61|e),((e^e>>>14)>>>0)/4294967296}function ih(n){return n*ss}function Fg(n){return n*xu}function n2(n){return!(n&n-1)&&n!==0}function LR(n){return Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))}function Vg(n){return Math.pow(2,Math.floor(Math.log(n)/Math.LN2))}function Qse(n,e,t,r,o){const i=Math.cos,a=Math.sin,s=i(t/2),l=a(t/2),c=i((e+r)/2),u=a((e+r)/2),d=i((e-r)/2),f=a((e-r)/2),h=i((r-e)/2),p=a((r-e)/2);switch(o){case"XYX":n.set(s*u,l*d,l*f,s*c);break;case"YZY":n.set(l*f,s*u,l*d,s*c);break;case"ZXZ":n.set(l*d,l*f,s*u,s*c);break;case"XZX":n.set(s*u,l*p,l*h,s*c);break;case"YXY":n.set(l*h,s*u,l*p,s*c);break;case"ZYZ":n.set(l*p,l*h,s*u,s*c);break;default:console.warn("v3d.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+o)}}function ah(n,e){switch(e.constructor){case Float32Array:return n;case Uint16Array:return n/65535;case Uint8Array:return n/255;case Int16Array:return Math.max(n/32767,-1);case Int8Array:return Math.max(n/127,-1);default:throw new Error("Invalid component type.")}}function io(n,e){switch(e.constructor){case Float32Array:return n;case Uint16Array:return Math.round(65535*n);case Uint8Array:return Math.round(255*n);case Int16Array:return Math.round(32767*n);case Int8Array:return Math.round(127*n);default:throw new Error("Invalid component type.")}}function Eu(n){let e=5381,t=n.length;for(;t;)e=33*e^n.charCodeAt(--t);return e>>>0}function PR(n,e,t,r){let o=Math.exp(-t/r);return n*o+(1-o)*e}function Cr(n,e,t,r,o){let i=PR(n,e,t,r);return Math.abs(n-e)<o&&(i=e),i}function sh(n){return Ht(n-2*Math.PI*Math.floor(n/(2*Math.PI)),0,2*Math.PI)}function Ug(n){let e=n+Math.PI;return e%=2*Math.PI,e+=2*Math.PI,e%=2*Math.PI,e-=Math.PI,e}function r2(n,e,t){let r=sh(n-e),o=sh(t-e);return r>o&&(r=r<o/2+Math.PI?o:0),r+e}var $se=Object.freeze({__proto__:null,DEG2RAD:ss,RAD2DEG:xu,angleToRange_0_2Pi:sh,angleToRange_mPi_Pi:Ug,ceilPowerOfTwo:LR,checkUUID:oh,clamp:Ht,clampAngle:r2,damp:Vse,degToRad:ih,denormalize:ah,euclideanModulo:e2,expAverage:PR,expAverageClamp:Cr,floorPowerOfTwo:Vg,generateUUID:ji,hashString:Eu,inverseLerp:Fse,isPowerOfTwo:n2,lerp:Aa,mapLinear:kse,normalize:io,pingpong:Use,radToDeg:Fg,randFloat:Hse,randFloatSpread:Wse,randInt:Gse,seededRandom:jse,setQuaternionFromProperEuler:Qse,smootherstep:t2,smoothstep:zse});class be{constructor(e=0,t=0){be.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,r=this.y,o=e.elements;return this.x=o[0]*t+o[3]*r+o[6],this.y=o[1]*t+o[4]*r+o[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,r=this.y-e.y;return t*t+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,r){return this.x=e.x+(t.x-e.x)*r,this.y=e.y+(t.y-e.y)*r,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const r=Math.cos(t),o=Math.sin(t),i=this.x-e.x,a=this.y-e.y;return this.x=i*r-a*o+e.x,this.y=i*o+a*r+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class ao{constructor(){ao.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1]}set(e,t,r,o,i,a,s,l,c){const u=this.elements;return u[0]=e,u[1]=o,u[2]=s,u[3]=t,u[4]=i,u[5]=l,u[6]=r,u[7]=a,u[8]=c,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,r=e.elements;return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],this}extractBasis(e,t,r){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),r.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const r=e.elements,o=t.elements,i=this.elements,a=r[0],s=r[3],l=r[6],c=r[1],u=r[4],d=r[7],f=r[2],h=r[5],p=r[8],m=o[0],g=o[3],_=o[6],A=o[1],y=o[4],b=o[7],E=o[2],x=o[5],w=o[8];return i[0]=a*m+s*A+l*E,i[3]=a*g+s*y+l*x,i[6]=a*_+s*b+l*w,i[1]=c*m+u*A+d*E,i[4]=c*g+u*y+d*x,i[7]=c*_+u*b+d*w,i[2]=f*m+h*A+p*E,i[5]=f*g+h*y+p*x,i[8]=f*_+h*b+p*w,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],r=e[1],o=e[2],i=e[3],a=e[4],s=e[5],l=e[6],c=e[7],u=e[8];return t*a*u-t*s*c-r*i*u+r*s*l+o*i*c-o*a*l}invert(){const e=this.elements,t=e[0],r=e[1],o=e[2],i=e[3],a=e[4],s=e[5],l=e[6],c=e[7],u=e[8],d=u*a-s*c,f=s*l-u*i,h=c*i-a*l,p=t*d+r*f+o*h;if(p===0)return this.set(0,0,0,0,0,0,0,0,0);const m=1/p;return e[0]=d*m,e[1]=(o*c-u*r)*m,e[2]=(s*r-o*a)*m,e[3]=f*m,e[4]=(u*t-o*l)*m,e[5]=(o*i-s*t)*m,e[6]=h*m,e[7]=(r*l-c*t)*m,e[8]=(a*t-r*i)*m,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,r,o,i,a,s){const l=Math.cos(i),c=Math.sin(i);return this.set(r*l,r*c,-r*(l*a+c*s)+a+e,-o*c,o*l,-o*(-c*a+l*s)+s+t,0,0,1),this}scale(e,t){return this.premultiply(o2.makeScale(e,t)),this}rotate(e){return this.premultiply(o2.makeRotation(-e)),this}translate(e,t){return this.premultiply(o2.makeTranslation(e,t)),this}makeTranslation(e,t){return this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),r=Math.sin(e);return this.set(t,-r,0,r,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,r=e.elements;for(let o=0;o<9;o++)if(t[o]!==r[o])return!1;return!0}fromArray(e,t=0){for(let r=0;r<9;r++)this.elements[r]=e[r+t];return this}toArray(e=[],t=0){const r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const o2=new ao;function Yse(n){if(n.length===0)return 1/0;let e=n[0];for(let t=1,r=n.length;t<r;++t)n[t]<e&&(e=n[t]);return e}function DR(n){if(n.length===0)return-1/0;let e=n[0];for(let t=1,r=n.length;t<r;++t)n[t]>e&&(e=n[t]);return e}function BR(n){for(let e=n.length-1;e>=0;--e)if(n[e]>=65535)return!0;return!1}function lh(n){return document.createElementNS("http://www.w3.org/1999/xhtml",n)}function Xse(n,e,t){return new Promise((function(r,o){setTimeout((function i(){switch(n.clientWaitSync(e,1,0)){case 37149:o();break;case 37147:setTimeout(i,t);break;default:r()}}),t)}))}function _e(n){return n!==void 0}function NR(n,e,t){for(let r=0;r<n.length;r++)n[r]=Ht(n[r],e,t);return n}function zg(n){return n.charAt(0).toUpperCase()+n.slice(1).toLowerCase()}function OR(n){return n.toLowerCase().replace(/_([a-zA-Z])/g,(function(e){return e[1].toUpperCase()}))}function qse(){return"Ultimate"}function kR(n){const e=n.match(/^[a-zA-Z38 ]*(\d+).(\d+).(\d+)(?: (.*))?$/)??[];let t=Number(e[1]),r=Number(e[2]),o=Number(e[3]);return t=Number.isNaN(t)?0:t,r=Number.isNaN(r)?0:r,o=Number.isNaN(o)?0:o,{major:t,minor:r,patch:o,pre:e[4]??""}}function FR(n){if(n==="")return 1/0;const e=n.match(/^pre(\d+)$/)??[];let t=Number(e[1]);return t=Number.isNaN(t)?0:t,t}function VR(n,e,t=3){const r=kR(n),o=kR(e);let i=o.major-r.major;return i===0&&t>1&&(i=o.minor-r.minor,i===0&&t>2&&(i=o.patch-r.patch,i===0&&t>3&&(i=FR(o.pre)-FR(r.pre),isNaN(i)&&(i=0)))),Math.sign(i)}function Js(n){return`${n%1?n:`${n}.0`}`}function ch(){return typeof window<"u"?window:typeof self<"u"?self:global}const Kl={};function Gg(n=""){const e=document.getElementsByTagName("script");let t=n;for(let r=e.length-1;r>=0;--r){const o=e[r].src,i=o.search(/\/v3d[\w.]+js/);i>-1&&(t=o.substr(0,i)+"/"+n)}return t}function i2(n,e=function(r){},t=function(r){}){Kl[n]=Kl[n]||{status:0,loadCallbacks:[],errorCallbacks:[]};const r=Kl[n];if(r.status==4)return void e(n);if(r.loadCallbacks.push(e),r.errorCallbacks.push(t),r.status>0)return;let o=Gg(n);const i=document.createElement("script");i.type="text/javascript",i.src=o,(function(a){i.onload=function(){Kl[a].loadCallbacks.forEach((function(s){s(a)})),Kl[a].status=4},i.onerror=function(){Kl[a].errorCallbacks.forEach((function(s){s(a)})),Kl[a].status=0}})(n),document.getElementsByTagName("head")[0].appendChild(i),r.status=3}function Kse(n,e,t=0){const r=function(i,a,s,l){const c=performance.now();return e(i,a,s),c-l>t?(l=c,new Promise((function(u){setTimeout((function(){u(l)}),1)}))):l};let o=Promise.resolve(performance.now());return n.forEach((function(i,a,s){o=o.then(r.bind(null,i,a,s))})),o}function Zl(n){return n<.04045?.0773993808*n:Math.pow(.9478672986*n+.0521327014,2.4)}function Hg(n){return n<.0031308?12.92*n:1.055*Math.pow(n,.41666)-.055}const a2={[Ky]:{[Zy]:Zl},[Zy]:{[Ky]:Hg}},Wr={legacyMode:!0,get workingColorSpace(){return"srgb-linear"},set workingColorSpace(n){console.warn("v3d.ColorManagement: .workingColorSpace is readonly.")},convert:function(n,e,t){if(this.legacyMode||e===t||!e||!t)return n;if(a2[e]&&a2[e][t]!==void 0){const r=a2[e][t];return n.r=r(n.r),n.g=r(n.g),n.b=r(n.b),n}throw new Error("Unsupported color space conversion.")},fromWorkingColorSpace:function(n,e){return this.convert(n,this.workingColorSpace,e)},toWorkingColorSpace:function(n,e){return this.convert(n,e,this.workingColorSpace)}},UR={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Sr={r:0,g:0,b:0},Qi={h:0,s:0,l:0},Wg={h:0,s:0,l:0};function s2(n,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?n+6*(e-n)*t:t<.5?e:t<2/3?n+6*(e-n)*(2/3-t):n}function jg(n,e){return e.r=n.r,e.g=n.g,e.b=n.b,e}class Ge{constructor(e,t,r){return this.isColor=!0,this.r=1,this.g=1,this.b=1,t===void 0&&r===void 0?this.set(e):this.setRGB(e,t,r)}set(e){return e&&e.isColor?this.copy(e):typeof e=="number"?this.setHex(e):typeof e=="string"&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t="srgb"){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,Wr.toWorkingColorSpace(this,t),this}setRGB(e,t,r,o=Wr.workingColorSpace){return this.r=e,this.g=t,this.b=r,Wr.toWorkingColorSpace(this,o),this}setHSL(e,t,r,o=Wr.workingColorSpace){if(e=e2(e,1),t=Ht(t,0,1),r=Ht(r,0,1),t===0)this.r=this.g=this.b=r;else{const i=r<=.5?r*(1+t):r+t-r*t,a=2*r-i;this.r=s2(a,i,e+1/3),this.g=s2(a,i,e),this.b=s2(a,i,e-1/3)}return Wr.toWorkingColorSpace(this,o),this}setStyle(e,t="srgb"){function r(i){i!==void 0&&parseFloat(i)<1&&console.warn("v3d.Color: Alpha component of "+e+" will be ignored.")}let o;if(o=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(e)){let i;const a=o[1],s=o[2];switch(a){case"rgb":case"rgba":if(i=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return this.r=Math.min(255,parseInt(i[1],10))/255,this.g=Math.min(255,parseInt(i[2],10))/255,this.b=Math.min(255,parseInt(i[3],10))/255,Wr.toWorkingColorSpace(this,t),r(i[4]),this;if(i=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return this.r=Math.min(100,parseInt(i[1],10))/100,this.g=Math.min(100,parseInt(i[2],10))/100,this.b=Math.min(100,parseInt(i[3],10))/100,Wr.toWorkingColorSpace(this,t),r(i[4]),this;break;case"hsl":case"hsla":if(i=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s)){const l=parseFloat(i[1])/360,c=parseFloat(i[2])/100,u=parseFloat(i[3])/100;return r(i[4]),this.setHSL(l,c,u,t)}}}else if(o=/^\#([A-Fa-f\d]+)$/.exec(e)){const i=o[1],a=i.length;if(a===3)return this.r=parseInt(i.charAt(0)+i.charAt(0),16)/255,this.g=parseInt(i.charAt(1)+i.charAt(1),16)/255,this.b=parseInt(i.charAt(2)+i.charAt(2),16)/255,Wr.toWorkingColorSpace(this,t),this;if(a===6)return this.r=parseInt(i.charAt(0)+i.charAt(1),16)/255,this.g=parseInt(i.charAt(2)+i.charAt(3),16)/255,this.b=parseInt(i.charAt(4)+i.charAt(5),16)/255,Wr.toWorkingColorSpace(this,t),this}return e&&e.length>0?this.setColorName(e,t):this}setColorName(e,t="srgb"){const r=UR[e.toLowerCase()];return r!==void 0?this.setHex(r,t):console.warn("v3d.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=Zl(e.r),this.g=Zl(e.g),this.b=Zl(e.b),this}copyLinearToSRGB(e){return this.r=Hg(e.r),this.g=Hg(e.g),this.b=Hg(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e="srgb"){return Wr.fromWorkingColorSpace(jg(this,Sr),e),Ht(255*Sr.r,0,255)<<16^Ht(255*Sr.g,0,255)<<8^Ht(255*Sr.b,0,255)}getHexString(e="srgb"){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=Wr.workingColorSpace){Wr.fromWorkingColorSpace(jg(this,Sr),t);const r=Sr.r,o=Sr.g,i=Sr.b,a=Math.max(r,o,i),s=Math.min(r,o,i);let l,c;const u=(s+a)/2;if(s===a)l=0,c=0;else{const d=a-s;switch(c=u<=.5?d/(a+s):d/(2-a-s),a){case r:l=(o-i)/d+(o<i?6:0);break;case o:l=(i-r)/d+2;break;case i:l=(r-o)/d+4}l/=6}return e.h=l,e.s=c,e.l=u,e}getRGB(e,t=Wr.workingColorSpace){return Wr.fromWorkingColorSpace(jg(this,Sr),t),e.r=Sr.r,e.g=Sr.g,e.b=Sr.b,e}getStyle(e="srgb"){return Wr.fromWorkingColorSpace(jg(this,Sr),e),e!=="srgb"?`color(${e} ${Sr.r} ${Sr.g} ${Sr.b})`:`rgb(${255*Sr.r|0},${255*Sr.g|0},${255*Sr.b|0})`}offsetHSL(e,t,r){return this.getHSL(Qi),Qi.h+=e,Qi.s+=t,Qi.l+=r,this.setHSL(Qi.h,Qi.s,Qi.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,r){return this.r=e.r+(t.r-e.r)*r,this.g=e.g+(t.g-e.g)*r,this.b=e.b+(t.b-e.b)*r,this}lerpHSL(e,t){this.getHSL(Qi),e.getHSL(Wg);const r=Aa(Qi.h,Wg.h,t),o=Aa(Qi.s,Wg.s,t),i=Aa(Qi.l,Wg.l,t);return this.setHSL(r,o,i),this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}let Cu;Ge.NAMES=UR;class zR{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{Cu===void 0&&(Cu=lh("canvas")),Cu.width=e.width,Cu.height=e.height;const r=Cu.getContext("2d");e instanceof ImageData?r.putImageData(e,0,0):r.drawImage(e,0,0,e.width,e.height),t=Cu}return t.width>2048||t.height>2048?(console.warn("v3d.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const t=lh("canvas");t.width=e.width,t.height=e.height;const r=t.getContext("2d");r.drawImage(e,0,0,e.width,e.height);const o=r.getImageData(0,0,e.width,e.height),i=o.data;for(let a=0;a<i.length;a++)i[a]=255*Zl(i[a]/255);return r.putImageData(o,0,0),t}if(e.data){const t=e.data.slice(0);for(let r=0;r<t.length;r++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[r]=Math.floor(255*Zl(t[r]/255)):t[r]=Zl(t[r]);return{data:t,width:e.width,height:e.height}}return console.warn("v3d.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let Zse=0;class Qg{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:Zse++}),this.uuid=ji(),this.data=e,this.version=0}set needsUpdate(e){e===!0&&this.version++}}let Jse=0;class $n extends ti{constructor(e=$n.DEFAULT_IMAGE,t=$n.DEFAULT_MAPPING,r=1001,o=1001,i=1006,a=1008,s=1023,l=1009,c=$n.DEFAULT_ANISOTROPY,u=3e3){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:Jse++}),this.uuid=ji(),this.name="",this.source=new Qg(e),this.mipmaps=[],this.mapping=t,this.wrapS=r,this.wrapT=o,this.magFilter=i,this.minFilter=a,this.anisotropy=c,this.format=s,this.internalFormat=null,this.type=l,this.offset=new be(0,0),this.repeat=new be(1,1),this.center=new be(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new ao,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=u,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==300)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case 1e3:e.x=e.x-Math.floor(e.x);break;case 1001:e.x=e.x<0?0:1;break;case 1002:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case 1e3:e.y=e.y-Math.floor(e.y);break;case 1001:e.y=e.y<0?0:1;break;case 1002:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}}$n.DEFAULT_IMAGE=null,$n.DEFAULT_MAPPING=300,$n.DEFAULT_ANISOTROPY=1;class pt{constructor(e=0,t=0,r=0,o=1){pt.prototype.isVector4=!0,this.x=e,this.y=t,this.z=r,this.w=o}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,r,o){return this.x=e,this.y=t,this.z=r,this.w=o,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,r=this.y,o=this.z,i=this.w,a=e.elements;return this.x=a[0]*t+a[4]*r+a[8]*o+a[12]*i,this.y=a[1]*t+a[5]*r+a[9]*o+a[13]*i,this.z=a[2]*t+a[6]*r+a[10]*o+a[14]*i,this.w=a[3]*t+a[7]*r+a[11]*o+a[15]*i,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,r,o,i;const l=e.elements,c=l[0],u=l[4],d=l[8],f=l[1],h=l[5],p=l[9],m=l[2],g=l[6],_=l[10];if(Math.abs(u-f)<.01&&Math.abs(d-m)<.01&&Math.abs(p-g)<.01){if(Math.abs(u+f)<.1&&Math.abs(d+m)<.1&&Math.abs(p+g)<.1&&Math.abs(c+h+_-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const y=(c+1)/2,b=(h+1)/2,E=(_+1)/2,x=(u+f)/4,w=(d+m)/4,L=(p+g)/4;return y>b&&y>E?y<.01?(r=0,o=.707106781,i=.707106781):(r=Math.sqrt(y),o=x/r,i=w/r):b>E?b<.01?(r=.707106781,o=0,i=.707106781):(o=Math.sqrt(b),r=x/o,i=L/o):E<.01?(r=.707106781,o=.707106781,i=0):(i=Math.sqrt(E),r=w/i,o=L/i),this.set(r,o,i,t),this}let A=Math.sqrt((g-p)*(g-p)+(d-m)*(d-m)+(f-u)*(f-u));return Math.abs(A)<.001&&(A=1),this.x=(g-p)/A,this.y=(d-m)/A,this.z=(f-u)/A,this.w=Math.acos((c+h+_-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,r){return this.x=e.x+(t.x-e.x)*r,this.y=e.y+(t.y-e.y)*r,this.z=e.z+(t.z-e.z)*r,this.w=e.w+(t.w-e.w)*r,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class nn extends ti{constructor(e=1,t=1,r={}){super(),this.isWebGLRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new pt(0,0,e,t),this.scissorTest=!1,this.viewport=new pt(0,0,e,t);const o={width:e,height:t,depth:1};this.texture=new $n(o,r.mapping,r.wrapS,r.wrapT,r.magFilter,r.minFilter,r.format,r.type,r.anisotropy,r.encoding),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=r.generateMipmaps!==void 0&&r.generateMipmaps,this.texture.internalFormat=r.internalFormat!==void 0?r.internalFormat:null,this.texture.minFilter=r.minFilter!==void 0?r.minFilter:1006,this.depthBuffer=r.depthBuffer===void 0||r.depthBuffer,this.stencilBuffer=r.stencilBuffer!==void 0&&r.stencilBuffer,this.depthTexture=r.depthTexture!==void 0?r.depthTexture:null,this.samples=r.samples!==void 0?r.samples:0}setSize(e,t,r=1){this.width===e&&this.height===t&&this.depth===r||(this.width=e,this.height=t,this.depth=r,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=r,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.isRenderTargetTexture=!0;const t=Object.assign({},e.texture.image);return this.texture.source=new Qg(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class $g extends $n{constructor(e=null,t=1,r=1,o=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:r,depth:o},this.magFilter=1003,this.minFilter=1003,this.wrapR=1001,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class ele extends nn{constructor(e=1,t=1,r=1){super(e,t),this.isWebGLArrayRenderTarget=!0,this.depth=r,this.texture=new $g(null,e,t,r),this.texture.isRenderTargetTexture=!0}}class l2 extends $n{constructor(e=null,t=1,r=1,o=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:r,depth:o},this.magFilter=1003,this.minFilter=1003,this.wrapR=1001,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class tle extends nn{constructor(e=1,t=1,r=1){super(e,t),this.isWebGL3DRenderTarget=!0,this.depth=r,this.texture=new l2(null,e,t,r),this.texture.isRenderTargetTexture=!0}}class c2 extends nn{constructor(e=1,t=1,r=1,o={}){super(e,t,o),this.isWebGLMultipleRenderTargets=!0;const i=this.texture;this.texture=[];for(let a=0;a<r;a++)this.texture[a]=i.clone(),this.texture[a].isRenderTargetTexture=!0}setSize(e,t,r=1){if(this.width!==e||this.height!==t||this.depth!==r){this.width=e,this.height=t,this.depth=r;for(let o=0,i=this.texture.length;o<i;o++)this.texture[o].image.width=e,this.texture[o].image.height=t,this.texture[o].image.depth=r;this.dispose()}return this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t),this}copy(e){this.dispose(),this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.texture.length=0;for(let t=0,r=e.texture.length;t<r;t++)this.texture[t]=e.texture[t].clone(),this.texture[t].isRenderTargetTexture=!0;return this}}class It{constructor(e=0,t=0,r=0,o=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=r,this._w=o}static slerpFlat(e,t,r,o,i,a,s){let l=r[o+0],c=r[o+1],u=r[o+2],d=r[o+3];const f=i[a+0],h=i[a+1],p=i[a+2],m=i[a+3];if(s===0)return e[t+0]=l,e[t+1]=c,e[t+2]=u,void(e[t+3]=d);if(s===1)return e[t+0]=f,e[t+1]=h,e[t+2]=p,void(e[t+3]=m);if(d!==m||l!==f||c!==h||u!==p){let g=1-s;const _=l*f+c*h+u*p+d*m,A=_>=0?1:-1,y=1-_*_;if(y>Number.EPSILON){const E=Math.sqrt(y),x=Math.atan2(E,_*A);g=Math.sin(g*x)/E,s=Math.sin(s*x)/E}const b=s*A;if(l=l*g+f*b,c=c*g+h*b,u=u*g+p*b,d=d*g+m*b,g===1-s){const E=1/Math.sqrt(l*l+c*c+u*u+d*d);l*=E,c*=E,u*=E,d*=E}}e[t]=l,e[t+1]=c,e[t+2]=u,e[t+3]=d}static multiplyQuaternionsFlat(e,t,r,o,i,a){const s=r[o],l=r[o+1],c=r[o+2],u=r[o+3],d=i[a],f=i[a+1],h=i[a+2],p=i[a+3];return e[t]=s*p+u*d+l*h-c*f,e[t+1]=l*p+u*f+c*d-s*h,e[t+2]=c*p+u*h+s*f-l*d,e[t+3]=u*p-s*d-l*f-c*h,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,r,o){return this._x=e,this._y=t,this._z=r,this._w=o,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){const r=e._x,o=e._y,i=e._z,a=e._order,s=Math.cos,l=Math.sin,c=s(r/2),u=s(o/2),d=s(i/2),f=l(r/2),h=l(o/2),p=l(i/2);switch(a){case"XYZ":this._x=f*u*d+c*h*p,this._y=c*h*d-f*u*p,this._z=c*u*p+f*h*d,this._w=c*u*d-f*h*p;break;case"YXZ":this._x=f*u*d+c*h*p,this._y=c*h*d-f*u*p,this._z=c*u*p-f*h*d,this._w=c*u*d+f*h*p;break;case"ZXY":this._x=f*u*d-c*h*p,this._y=c*h*d+f*u*p,this._z=c*u*p+f*h*d,this._w=c*u*d-f*h*p;break;case"ZYX":this._x=f*u*d-c*h*p,this._y=c*h*d+f*u*p,this._z=c*u*p-f*h*d,this._w=c*u*d+f*h*p;break;case"YZX":this._x=f*u*d+c*h*p,this._y=c*h*d+f*u*p,this._z=c*u*p-f*h*d,this._w=c*u*d-f*h*p;break;case"XZY":this._x=f*u*d-c*h*p,this._y=c*h*d-f*u*p,this._z=c*u*p+f*h*d,this._w=c*u*d+f*h*p;break;default:console.warn("v3d.Quaternion: .setFromEuler() encountered an unknown order: "+a)}return t!==!1&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const r=t/2,o=Math.sin(r);return this._x=e.x*o,this._y=e.y*o,this._z=e.z*o,this._w=Math.cos(r),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,r=t[0],o=t[4],i=t[8],a=t[1],s=t[5],l=t[9],c=t[2],u=t[6],d=t[10],f=r+s+d;if(f>0){const h=.5/Math.sqrt(f+1);this._w=.25/h,this._x=(u-l)*h,this._y=(i-c)*h,this._z=(a-o)*h}else if(r>s&&r>d){const h=2*Math.sqrt(1+r-s-d);this._w=(u-l)/h,this._x=.25*h,this._y=(o+a)/h,this._z=(i+c)/h}else if(s>d){const h=2*Math.sqrt(1+s-r-d);this._w=(i-c)/h,this._x=(o+a)/h,this._y=.25*h,this._z=(l+u)/h}else{const h=2*Math.sqrt(1+d-r-s);this._w=(a-o)/h,this._x=(i+c)/h,this._y=(l+u)/h,this._z=.25*h}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let r=e.dot(t)+1;return r<Number.EPSILON?(r=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=r):(this._x=0,this._y=-e.z,this._z=e.y,this._w=r)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=r),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Ht(this.dot(e),-1,1)))}rotateTowards(e,t){const r=this.angleTo(e);if(r===0)return this;const o=Math.min(1,t/r);return this.slerp(e,o),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const r=e._x,o=e._y,i=e._z,a=e._w,s=t._x,l=t._y,c=t._z,u=t._w;return this._x=r*u+a*s+o*c-i*l,this._y=o*u+a*l+i*s-r*c,this._z=i*u+a*c+r*l-o*s,this._w=a*u-r*s-o*l-i*c,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);const r=this._x,o=this._y,i=this._z,a=this._w;let s=a*e._w+r*e._x+o*e._y+i*e._z;if(s<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,s=-s):this.copy(e),s>=1)return this._w=a,this._x=r,this._y=o,this._z=i,this;const l=1-s*s;if(l<=Number.EPSILON){const h=1-t;return this._w=h*a+t*this._w,this._x=h*r+t*this._x,this._y=h*o+t*this._y,this._z=h*i+t*this._z,this.normalize(),this._onChangeCallback(),this}const c=Math.sqrt(l),u=Math.atan2(c,s),d=Math.sin((1-t)*u)/c,f=Math.sin(t*u)/c;return this._w=a*d+this._w*f,this._x=r*d+this._x*f,this._y=o*d+this._y*f,this._z=i*d+this._z*f,this._onChangeCallback(),this}slerpQuaternions(e,t,r){return this.copy(e).slerp(t,r)}random(){const e=Math.random(),t=Math.sqrt(1-e),r=Math.sqrt(e),o=2*Math.PI*Math.random(),i=2*Math.PI*Math.random();return this.set(t*Math.cos(o),r*Math.sin(i),r*Math.cos(i),t*Math.sin(o))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class N{constructor(e=0,t=0,r=0){N.prototype.isVector3=!0,this.x=e,this.y=t,this.z=r}set(e,t,r){return r===void 0&&(r=this.z),this.x=e,this.y=t,this.z=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(GR.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(GR.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,r=this.y,o=this.z,i=e.elements;return this.x=i[0]*t+i[3]*r+i[6]*o,this.y=i[1]*t+i[4]*r+i[7]*o,this.z=i[2]*t+i[5]*r+i[8]*o,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,r=this.y,o=this.z,i=e.elements,a=1/(i[3]*t+i[7]*r+i[11]*o+i[15]);return this.x=(i[0]*t+i[4]*r+i[8]*o+i[12])*a,this.y=(i[1]*t+i[5]*r+i[9]*o+i[13])*a,this.z=(i[2]*t+i[6]*r+i[10]*o+i[14])*a,this}applyQuaternion(e){const t=this.x,r=this.y,o=this.z,i=e.x,a=e.y,s=e.z,l=e.w,c=l*t+a*o-s*r,u=l*r+s*t-i*o,d=l*o+i*r-a*t,f=-i*t-a*r-s*o;return this.x=c*l+f*-i+u*-s-d*-a,this.y=u*l+f*-a+d*-i-c*-s,this.z=d*l+f*-s+c*-a-u*-i,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,r=this.y,o=this.z,i=e.elements;return this.x=i[0]*t+i[4]*r+i[8]*o,this.y=i[1]*t+i[5]*r+i[9]*o,this.z=i[2]*t+i[6]*r+i[10]*o,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,r){return this.x=e.x+(t.x-e.x)*r,this.y=e.y+(t.y-e.y)*r,this.z=e.z+(t.z-e.z)*r,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const r=e.x,o=e.y,i=e.z,a=t.x,s=t.y,l=t.z;return this.x=o*l-i*s,this.y=i*a-r*l,this.z=r*s-o*a,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const r=e.dot(this)/t;return this.copy(e).multiplyScalar(r)}projectOnPlane(e){return u2.copy(this).projectOnVector(e),this.sub(u2)}reflect(e){return this.sub(u2.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const r=this.dot(e)/t;return Math.acos(Ht(r,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,r=this.y-e.y,o=this.z-e.z;return t*t+r*r+o*o}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,r){const o=Math.sin(t)*e;return this.x=o*Math.sin(r),this.y=Math.cos(t)*e,this.z=o*Math.cos(r),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,r){return this.x=e*Math.sin(t),this.y=r,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),r=this.setFromMatrixColumn(e,1).length(),o=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=r,this.z=o,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=2*(Math.random()-.5),t=Math.random()*Math.PI*2,r=Math.sqrt(1-e**2);return this.x=r*Math.cos(t),this.y=r*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const u2=new N,GR=new It;class Tn{constructor(e=new N(1/0,1/0,1/0),t=new N(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){let t=1/0,r=1/0,o=1/0,i=-1/0,a=-1/0,s=-1/0;for(let l=0,c=e.length;l<c;l+=3){const u=e[l],d=e[l+1],f=e[l+2];u<t&&(t=u),d<r&&(r=d),f<o&&(o=f),u>i&&(i=u),d>a&&(a=d),f>s&&(s=f)}return this.min.set(t,r,o),this.max.set(i,a,s),this}setFromBufferAttribute(e){let t=1/0,r=1/0,o=1/0,i=-1/0,a=-1/0,s=-1/0;for(let l=0,c=e.count;l<c;l++){const u=e.getX(l),d=e.getY(l),f=e.getZ(l);u<t&&(t=u),d<r&&(r=d),f<o&&(o=f),u>i&&(i=u),d>a&&(a=d),f>s&&(s=f)}return this.min.set(t,r,o),this.max.set(i,a,s),this}setFromPoints(e){this.makeEmpty();for(let t=0,r=e.length;t<r;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const r=Jl.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const r=e.geometry;if(r!==void 0)if(t&&r.attributes!=null&&r.attributes.position!==void 0){const i=r.attributes.position;for(let a=0,s=i.count;a<s;a++)Jl.fromBufferAttribute(i,a).applyMatrix4(e.matrixWorld),this.expandByPoint(Jl)}else r.boundingBox===null&&r.computeBoundingBox(),d2.copy(r.boundingBox),d2.applyMatrix4(e.matrixWorld),this.union(d2);const o=e.children;for(let i=0,a=o.length;i<a;i++)this.expandByObject(o[i],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,Jl),Jl.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,r;return e.normal.x>0?(t=e.normal.x*this.min.x,r=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,r=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,r+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,r+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,r+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,r+=e.normal.z*this.min.z),t<=-e.constant&&r>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(cs),nl.subVectors(this.max,cs),Su.subVectors(e.a,cs),wu.subVectors(e.b,cs),Mu.subVectors(e.c,cs),el.subVectors(wu,Su),tl.subVectors(Mu,wu),ec.subVectors(Su,Mu);let t=[0,-el.z,el.y,0,-tl.z,tl.y,0,-ec.z,ec.y,el.z,0,-el.x,tl.z,0,-tl.x,ec.z,0,-ec.x,-el.y,el.x,0,-tl.y,tl.x,0,-ec.y,ec.x,0];return!!f2(t,Su,wu,Mu,nl)&&(t=[1,0,0,0,1,0,0,0,1],!!f2(t,Su,wu,Mu,nl)&&(Yg.crossVectors(el,tl),t=[Yg.x,Yg.y,Yg.z],f2(t,Su,wu,Mu,nl)))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return Jl.copy(e).clamp(this.min,this.max).sub(e).length()}getBoundingSphere(e){return this.getCenter(e.center),e.radius=.5*this.getSize(Jl).length(),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()||(ls[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),ls[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),ls[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),ls[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),ls[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),ls[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),ls[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),ls[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(ls)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}scale(e){return this.getCenter(cs),nl.subVectors(this.max,cs),nl.multiply(e),this.min.copy(cs).sub(nl),this.max.copy(cs).add(nl),this}}const ls=[new N,new N,new N,new N,new N,new N,new N,new N],Jl=new N,d2=new Tn,Su=new N,wu=new N,Mu=new N,el=new N,tl=new N,ec=new N,cs=new N,nl=new N,Yg=new N,tc=new N;function f2(n,e,t,r,o){for(let i=0,a=n.length-3;i<=a;i+=3){tc.fromArray(n,i);const s=o.x*Math.abs(tc.x)+o.y*Math.abs(tc.y)+o.z*Math.abs(tc.z),l=e.dot(tc),c=t.dot(tc),u=r.dot(tc);if(Math.max(-Math.max(l,c,u),Math.min(l,c,u))>s)return!1}return!0}const nle=new Tn,uh=new N,h2=new N;class ni{constructor(e=new N,t=-1){this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const r=this.center;t!==void 0?r.copy(t):nle.setFromPoints(e).getCenter(r);let o=0;for(let i=0,a=e.length;i<a;i++)o=Math.max(o,r.distanceToSquared(e[i]));return this.radius=Math.sqrt(o),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const r=this.center.distanceToSquared(e);return t.copy(e),r>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;uh.subVectors(e,this.center);const t=uh.lengthSq();if(t>this.radius*this.radius){const r=Math.sqrt(t),o=.5*(r-this.radius);this.center.addScaledVector(uh,o/r),this.radius+=o}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(h2.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(uh.copy(e.center).add(h2)),this.expandByPoint(uh.copy(e.center).sub(h2))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}}const us=new N,p2=new N,Xg=new N,rl=new N,m2=new N,qg=new N,g2=new N;class Tu{constructor(e=new N,t=new N(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.direction).multiplyScalar(e).add(this.origin)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,us)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const r=t.dot(this.direction);return r<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(r).add(this.origin)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=us.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(us.copy(this.direction).multiplyScalar(t).add(this.origin),us.distanceToSquared(e))}distanceSqToSegment(e,t,r,o){p2.copy(e).add(t).multiplyScalar(.5),Xg.copy(t).sub(e).normalize(),rl.copy(this.origin).sub(p2);const i=.5*e.distanceTo(t),a=-this.direction.dot(Xg),s=rl.dot(this.direction),l=-rl.dot(Xg),c=rl.lengthSq(),u=Math.abs(1-a*a);let d,f,h,p;if(u>0)if(d=a*l-s,f=a*s-l,p=i*u,d>=0)if(f>=-p)if(f<=p){const m=1/u;d*=m,f*=m,h=d*(d+a*f+2*s)+f*(a*d+f+2*l)+c}else f=i,d=Math.max(0,-(a*f+s)),h=-d*d+f*(f+2*l)+c;else f=-i,d=Math.max(0,-(a*f+s)),h=-d*d+f*(f+2*l)+c;else f<=-p?(d=Math.max(0,-(-a*i+s)),f=d>0?-i:Math.min(Math.max(-i,-l),i),h=-d*d+f*(f+2*l)+c):f<=p?(d=0,f=Math.min(Math.max(-i,-l),i),h=f*(f+2*l)+c):(d=Math.max(0,-(a*i+s)),f=d>0?i:Math.min(Math.max(-i,-l),i),h=-d*d+f*(f+2*l)+c);else f=a>0?-i:i,d=Math.max(0,-(a*f+s)),h=-d*d+f*(f+2*l)+c;return r&&r.copy(this.direction).multiplyScalar(d).add(this.origin),o&&o.copy(Xg).multiplyScalar(f).add(p2),h}intersectSphere(e,t){us.subVectors(e.center,this.origin);const r=us.dot(this.direction),o=us.dot(us)-r*r,i=e.radius*e.radius;if(o>i)return null;const a=Math.sqrt(i-o),s=r-a,l=r+a;return s<0&&l<0?null:s<0?this.at(l,t):this.at(s,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;const r=-(this.origin.dot(e.normal)+e.constant)/t;return r>=0?r:null}intersectPlane(e,t){const r=this.distanceToPlane(e);return r===null?null:this.at(r,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return t===0?!0:e.normal.dot(this.direction)*t<0}intersectBox(e,t){let r,o,i,a,s,l;const c=1/this.direction.x,u=1/this.direction.y,d=1/this.direction.z,f=this.origin;return c>=0?(r=(e.min.x-f.x)*c,o=(e.max.x-f.x)*c):(r=(e.max.x-f.x)*c,o=(e.min.x-f.x)*c),u>=0?(i=(e.min.y-f.y)*u,a=(e.max.y-f.y)*u):(i=(e.max.y-f.y)*u,a=(e.min.y-f.y)*u),r>a||i>o?null:((i>r||isNaN(r))&&(r=i),(a<o||isNaN(o))&&(o=a),d>=0?(s=(e.min.z-f.z)*d,l=(e.max.z-f.z)*d):(s=(e.max.z-f.z)*d,l=(e.min.z-f.z)*d),r>l||s>o?null:((s>r||r!=r)&&(r=s),(l<o||o!=o)&&(o=l),o<0?null:this.at(r>=0?r:o,t)))}intersectsBox(e){return this.intersectBox(e,us)!==null}intersectTriangle(e,t,r,o,i){m2.subVectors(t,e),qg.subVectors(r,e),g2.crossVectors(m2,qg);let a,s=this.direction.dot(g2);if(s>0){if(o)return null;a=1}else{if(!(s<0))return null;a=-1,s=-s}rl.subVectors(this.origin,e);const l=a*this.direction.dot(qg.crossVectors(rl,qg));if(l<0)return null;const c=a*this.direction.dot(m2.cross(rl));if(c<0||l+c>s)return null;const u=-a*rl.dot(g2);return u<0?null:this.at(u/s,i)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class Ue{constructor(){Ue.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}set(e,t,r,o,i,a,s,l,c,u,d,f,h,p,m,g){const _=this.elements;return _[0]=e,_[4]=t,_[8]=r,_[12]=o,_[1]=i,_[5]=a,_[9]=s,_[13]=l,_[2]=c,_[6]=u,_[10]=d,_[14]=f,_[3]=h,_[7]=p,_[11]=m,_[15]=g,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new Ue().fromArray(this.elements)}copy(e){const t=this.elements,r=e.elements;return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],t[9]=r[9],t[10]=r[10],t[11]=r[11],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15],this}copyPosition(e){const t=this.elements,r=e.elements;return t[12]=r[12],t[13]=r[13],t[14]=r[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,r){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),r.setFromMatrixColumn(this,2),this}makeBasis(e,t,r){return this.set(e.x,t.x,r.x,0,e.y,t.y,r.y,0,e.z,t.z,r.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,r=e.elements,o=1/ds.setFromMatrixColumn(e,0).length(),i=1/ds.setFromMatrixColumn(e,1).length(),a=1/ds.setFromMatrixColumn(e,2).length();return t[0]=r[0]*o,t[1]=r[1]*o,t[2]=r[2]*o,t[3]=0,t[4]=r[4]*i,t[5]=r[5]*i,t[6]=r[6]*i,t[7]=0,t[8]=r[8]*a,t[9]=r[9]*a,t[10]=r[10]*a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,r=e.x,o=e.y,i=e.z,a=Math.cos(r),s=Math.sin(r),l=Math.cos(o),c=Math.sin(o),u=Math.cos(i),d=Math.sin(i);if(e.order==="XYZ"){const f=a*u,h=a*d,p=s*u,m=s*d;t[0]=l*u,t[4]=-l*d,t[8]=c,t[1]=h+p*c,t[5]=f-m*c,t[9]=-s*l,t[2]=m-f*c,t[6]=p+h*c,t[10]=a*l}else if(e.order==="YXZ"){const f=l*u,h=l*d,p=c*u,m=c*d;t[0]=f+m*s,t[4]=p*s-h,t[8]=a*c,t[1]=a*d,t[5]=a*u,t[9]=-s,t[2]=h*s-p,t[6]=m+f*s,t[10]=a*l}else if(e.order==="ZXY"){const f=l*u,h=l*d,p=c*u,m=c*d;t[0]=f-m*s,t[4]=-a*d,t[8]=p+h*s,t[1]=h+p*s,t[5]=a*u,t[9]=m-f*s,t[2]=-a*c,t[6]=s,t[10]=a*l}else if(e.order==="ZYX"){const f=a*u,h=a*d,p=s*u,m=s*d;t[0]=l*u,t[4]=p*c-h,t[8]=f*c+m,t[1]=l*d,t[5]=m*c+f,t[9]=h*c-p,t[2]=-c,t[6]=s*l,t[10]=a*l}else if(e.order==="YZX"){const f=a*l,h=a*c,p=s*l,m=s*c;t[0]=l*u,t[4]=m-f*d,t[8]=p*d+h,t[1]=d,t[5]=a*u,t[9]=-s*u,t[2]=-c*u,t[6]=h*d+p,t[10]=f-m*d}else if(e.order==="XZY"){const f=a*l,h=a*c,p=s*l,m=s*c;t[0]=l*u,t[4]=-d,t[8]=c*u,t[1]=f*d+m,t[5]=a*u,t[9]=h*d-p,t[2]=p*d-h,t[6]=s*u,t[10]=m*d+f}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(rle,e,ole)}lookAt(e,t,r){const o=this.elements;return ri.subVectors(e,t),ri.lengthSq()===0&&(ri.z=1),ri.normalize(),ol.crossVectors(r,ri),ol.lengthSq()===0&&(Math.abs(r.z)===1?ri.x+=1e-4:ri.z+=1e-4,ri.normalize(),ol.crossVectors(r,ri)),ol.normalize(),Kg.crossVectors(ri,ol),o[0]=ol.x,o[4]=Kg.x,o[8]=ri.x,o[1]=ol.y,o[5]=Kg.y,o[9]=ri.y,o[2]=ol.z,o[6]=Kg.z,o[10]=ri.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const r=e.elements,o=t.elements,i=this.elements,a=r[0],s=r[4],l=r[8],c=r[12],u=r[1],d=r[5],f=r[9],h=r[13],p=r[2],m=r[6],g=r[10],_=r[14],A=r[3],y=r[7],b=r[11],E=r[15],x=o[0],w=o[4],L=o[8],C=o[12],P=o[1],D=o[5],Q=o[9],re=o[13],G=o[2],se=o[6],ee=o[10],ie=o[14],H=o[3],T=o[7],R=o[11],O=o[15];return i[0]=a*x+s*P+l*G+c*H,i[4]=a*w+s*D+l*se+c*T,i[8]=a*L+s*Q+l*ee+c*R,i[12]=a*C+s*re+l*ie+c*O,i[1]=u*x+d*P+f*G+h*H,i[5]=u*w+d*D+f*se+h*T,i[9]=u*L+d*Q+f*ee+h*R,i[13]=u*C+d*re+f*ie+h*O,i[2]=p*x+m*P+g*G+_*H,i[6]=p*w+m*D+g*se+_*T,i[10]=p*L+m*Q+g*ee+_*R,i[14]=p*C+m*re+g*ie+_*O,i[3]=A*x+y*P+b*G+E*H,i[7]=A*w+y*D+b*se+E*T,i[11]=A*L+y*Q+b*ee+E*R,i[15]=A*C+y*re+b*ie+E*O,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],r=e[4],o=e[8],i=e[12],a=e[1],s=e[5],l=e[9],c=e[13],u=e[2],d=e[6],f=e[10],h=e[14];return e[3]*(+i*l*d-o*c*d-i*s*f+r*c*f+o*s*h-r*l*h)+e[7]*(+t*l*h-t*c*f+i*a*f-o*a*h+o*c*u-i*l*u)+e[11]*(+t*c*d-t*s*h-i*a*d+r*a*h+i*s*u-r*c*u)+e[15]*(-o*s*u-t*l*d+t*s*f+o*a*d-r*a*f+r*l*u)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,r){const o=this.elements;return e.isVector3?(o[12]=e.x,o[13]=e.y,o[14]=e.z):(o[12]=e,o[13]=t,o[14]=r),this}invert(){const e=this.elements,t=e[0],r=e[1],o=e[2],i=e[3],a=e[4],s=e[5],l=e[6],c=e[7],u=e[8],d=e[9],f=e[10],h=e[11],p=e[12],m=e[13],g=e[14],_=e[15],A=d*g*c-m*f*c+m*l*h-s*g*h-d*l*_+s*f*_,y=p*f*c-u*g*c-p*l*h+a*g*h+u*l*_-a*f*_,b=u*m*c-p*d*c+p*s*h-a*m*h-u*s*_+a*d*_,E=p*d*l-u*m*l-p*s*f+a*m*f+u*s*g-a*d*g,x=t*A+r*y+o*b+i*E;if(x===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const w=1/x;return e[0]=A*w,e[1]=(m*f*i-d*g*i-m*o*h+r*g*h+d*o*_-r*f*_)*w,e[2]=(s*g*i-m*l*i+m*o*c-r*g*c-s*o*_+r*l*_)*w,e[3]=(d*l*i-s*f*i-d*o*c+r*f*c+s*o*h-r*l*h)*w,e[4]=y*w,e[5]=(u*g*i-p*f*i+p*o*h-t*g*h-u*o*_+t*f*_)*w,e[6]=(p*l*i-a*g*i-p*o*c+t*g*c+a*o*_-t*l*_)*w,e[7]=(a*f*i-u*l*i+u*o*c-t*f*c-a*o*h+t*l*h)*w,e[8]=b*w,e[9]=(p*d*i-u*m*i-p*r*h+t*m*h+u*r*_-t*d*_)*w,e[10]=(a*m*i-p*s*i+p*r*c-t*m*c-a*r*_+t*s*_)*w,e[11]=(u*s*i-a*d*i-u*r*c+t*d*c+a*r*h-t*s*h)*w,e[12]=E*w,e[13]=(u*m*o-p*d*o+p*r*f-t*m*f-u*r*g+t*d*g)*w,e[14]=(p*s*o-a*m*o-p*r*l+t*m*l+a*r*g-t*s*g)*w,e[15]=(a*d*o-u*s*o+u*r*l-t*d*l-a*r*f+t*s*f)*w,this}scale(e){const t=this.elements,r=e.x,o=e.y,i=e.z;return t[0]*=r,t[4]*=o,t[8]*=i,t[1]*=r,t[5]*=o,t[9]*=i,t[2]*=r,t[6]*=o,t[10]*=i,t[3]*=r,t[7]*=o,t[11]*=i,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],r=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],o=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,r,o))}makeTranslation(e,t,r){return this.set(1,0,0,e,0,1,0,t,0,0,1,r,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),r=Math.sin(e);return this.set(1,0,0,0,0,t,-r,0,0,r,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),r=Math.sin(e);return this.set(t,0,r,0,0,1,0,0,-r,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),r=Math.sin(e);return this.set(t,-r,0,0,r,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const r=Math.cos(t),o=Math.sin(t),i=1-r,a=e.x,s=e.y,l=e.z,c=i*a,u=i*s;return this.set(c*a+r,c*s-o*l,c*l+o*s,0,c*s+o*l,u*s+r,u*l-o*a,0,c*l-o*s,u*l+o*a,i*l*l+r,0,0,0,0,1),this}makeScale(e,t,r){return this.set(e,0,0,0,0,t,0,0,0,0,r,0,0,0,0,1),this}makeShear(e,t,r,o,i,a){return this.set(1,r,i,0,e,1,a,0,t,o,1,0,0,0,0,1),this}compose(e,t,r){const o=this.elements,i=t._x,a=t._y,s=t._z,l=t._w,c=i+i,u=a+a,d=s+s,f=i*c,h=i*u,p=i*d,m=a*u,g=a*d,_=s*d,A=l*c,y=l*u,b=l*d,E=r.x,x=r.y,w=r.z;return o[0]=(1-(m+_))*E,o[1]=(h+b)*E,o[2]=(p-y)*E,o[3]=0,o[4]=(h-b)*x,o[5]=(1-(f+_))*x,o[6]=(g+A)*x,o[7]=0,o[8]=(p+y)*w,o[9]=(g-A)*w,o[10]=(1-(f+m))*w,o[11]=0,o[12]=e.x,o[13]=e.y,o[14]=e.z,o[15]=1,this}decompose(e,t,r){const o=this.elements;let i=ds.set(o[0],o[1],o[2]).length();const a=ds.set(o[4],o[5],o[6]).length(),s=ds.set(o[8],o[9],o[10]).length();this.determinant()<0&&(i=-i),e.x=o[12],e.y=o[13],e.z=o[14],tr.copy(this);const l=1/i,c=1/a,u=1/s;return tr.elements[0]*=l,tr.elements[1]*=l,tr.elements[2]*=l,tr.elements[4]*=c,tr.elements[5]*=c,tr.elements[6]*=c,tr.elements[8]*=u,tr.elements[9]*=u,tr.elements[10]*=u,t.setFromRotationMatrix(tr),r.x=i,r.y=a,r.z=s,this}makePerspective(e,t,r,o,i,a){const s=this.elements,l=2*i/(t-e),c=2*i/(r-o),u=(t+e)/(t-e),d=(r+o)/(r-o),f=-(a+i)/(a-i),h=-2*a*i/(a-i);return s[0]=l,s[4]=0,s[8]=u,s[12]=0,s[1]=0,s[5]=c,s[9]=d,s[13]=0,s[2]=0,s[6]=0,s[10]=f,s[14]=h,s[3]=0,s[7]=0,s[11]=-1,s[15]=0,this}makeOrthographic(e,t,r,o,i,a){const s=this.elements,l=1/(t-e),c=1/(r-o),u=1/(a-i),d=(t+e)*l,f=(r+o)*c,h=(a+i)*u;return s[0]=2*l,s[4]=0,s[8]=0,s[12]=-d,s[1]=0,s[5]=2*c,s[9]=0,s[13]=-f,s[2]=0,s[6]=0,s[10]=-2*u,s[14]=-h,s[3]=0,s[7]=0,s[11]=0,s[15]=1,this}equals(e){const t=this.elements,r=e.elements;for(let o=0;o<16;o++)if(t[o]!==r[o])return!1;return!0}fromArray(e,t=0){for(let r=0;r<16;r++)this.elements[r]=e[r+t];return this}toArray(e=[],t=0){const r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e[t+9]=r[9],e[t+10]=r[10],e[t+11]=r[11],e[t+12]=r[12],e[t+13]=r[13],e[t+14]=r[14],e[t+15]=r[15],e}composeE(e,t,r){const o=this.elements;this.makeRotationFromEuler(t);const i=r.x,a=r.y,s=r.z;return o[0]*=i,o[1]*=i,o[2]*=i,o[3]=0,o[4]*=a,o[5]*=a,o[6]*=a,o[7]=0,o[8]*=s,o[9]*=s,o[10]*=s,o[11]=0,o[12]=e.x,o[13]=e.y,o[14]=e.z,o[15]=1,this}decomposeE(e,t,r,o=t.order){const i=this.elements;let a=ds.set(i[0],i[1],i[2]).length();const s=ds.set(i[4],i[5],i[6]).length(),l=ds.set(i[8],i[9],i[10]).length();this.determinant()<0&&(a=-a),e.x=i[12],e.y=i[13],e.z=i[14],tr.copy(this);const c=1/a,u=1/s,d=1/l;return tr.elements[0]*=c,tr.elements[1]*=c,tr.elements[2]*=c,tr.elements[4]*=u,tr.elements[5]*=u,tr.elements[6]*=u,tr.elements[8]*=d,tr.elements[9]*=d,tr.elements[10]*=d,t.setFromRotationMatrix(tr,o),r.x=a,r.y=s,r.z=l,this}}const ds=new N,tr=new Ue,rle=new N(0,0,0),ole=new N(1,1,1),ol=new N,Kg=new N,ri=new N,HR=new Ue,WR=new It;class $i{constructor(e=0,t=0,r=0,o=$i.DefaultOrder){this.isEuler=!0,this._x=e,this._y=t,this._z=r,this._order=o}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,r,o=this._order){return this._x=e,this._y=t,this._z=r,this._order=o,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,r=!0){const o=e.elements,i=o[0],a=o[4],s=o[8],l=o[1],c=o[5],u=o[9],d=o[2],f=o[6],h=o[10];switch(t){case"XYZ":this._y=Math.asin(Ht(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(-u,h),this._z=Math.atan2(-a,i)):(this._x=Math.atan2(f,c),this._z=0);break;case"YXZ":this._x=Math.asin(-Ht(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(s,h),this._z=Math.atan2(l,c)):(this._y=Math.atan2(-d,i),this._z=0);break;case"ZXY":this._x=Math.asin(Ht(f,-1,1)),Math.abs(f)<.9999999?(this._y=Math.atan2(-d,h),this._z=Math.atan2(-a,c)):(this._y=0,this._z=Math.atan2(l,i));break;case"ZYX":this._y=Math.asin(-Ht(d,-1,1)),Math.abs(d)<.9999999?(this._x=Math.atan2(f,h),this._z=Math.atan2(l,i)):(this._x=0,this._z=Math.atan2(-a,c));break;case"YZX":this._z=Math.asin(Ht(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-u,c),this._y=Math.atan2(-d,i)):(this._x=0,this._y=Math.atan2(s,h));break;case"XZY":this._z=Math.asin(-Ht(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(f,c),this._y=Math.atan2(s,i)):(this._x=Math.atan2(-u,h),this._y=0);break;default:console.warn("v3d.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,r===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,r){return HR.makeRotationFromQuaternion(e),this.setFromRotationMatrix(HR,t,r)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return WR.setFromEuler(this),this.setFromQuaternion(WR,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}toVector3(e){return console.warn("v3d.Euler: .toVector3() has been removed. Use Vector3.setFromEuler() instead"),e?e.set(this._x,this._y,this._z):new N(this._x,this._y,this._z)}makeAlternative(){var e=this._order[1]==="X"?-1:1,t=this._order[1]==="Y"?-1:1,r=this._order[1]==="Z"?-1:1;return this._x=Ug(e*(this._x+Math.PI)),this._y=Ug(t*(this._y+Math.PI)),this._z=Ug(r*(this._z+Math.PI)),this}equalsEps(e,t){return Math.abs(this._x-e._x)<t&&Math.abs(this._y-e._y)<t&&Math.abs(this._z-e._z)<t&&this._order===e._order}}$i.DefaultOrder="XYZ",$i.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class Iu{constructor(){this.mask=1}set(e){this.mask=1<<e>>>0}enable(e){this.mask|=1<<e}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e}disable(e){this.mask&=~(1<<e)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return!!(this.mask&1<<e)}}let ile=0;const jR=new N,Ru=new It,oi=new Ue,il=new N,fs=new N,QR=new N,ale=new It,$R=new N(1,0,0),YR=new N(0,1,0),XR=new N(0,0,1),sle={type:"added"},qR={type:"removed"};class kt extends ti{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:ile++}),this.uuid=ji(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=kt.DefaultUp.clone();const e=new N,t=new $i,r=new It,o=new N(1,1,1);t._onChange((function(){r.setFromEuler(t,!1)})),r._onChange((function(){t.setFromQuaternion(r,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:r},scale:{configurable:!0,enumerable:!0,value:o},modelViewMatrix:{value:new Ue},normalMatrix:{value:new ao}}),this.matrix=new Ue,this.matrixWorld=new Ue,this.matrixAutoUpdate=kt.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=kt.DefaultMatrixWorldAutoUpdate,this.layers=new Iu,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={},this.internVisible=!0,this.externVisible=!0,this.constraints=[],this.disableChildRendering=!1,this.hidpiCompositing=!1,this.groupNames=[],this.objectIndex=0,this.objectColor=new Ge,this.objectAlpha=1}set visible(e){this.externVisible=e}get visible(){return this.internVisible&&this.externVisible}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return Ru.setFromAxisAngle(e,t),this.quaternion.multiply(Ru),this}rotateOnWorldAxis(e,t){return Ru.setFromAxisAngle(e,t),this.quaternion.premultiply(Ru),this}rotateX(e){return this.rotateOnAxis($R,e)}rotateY(e){return this.rotateOnAxis(YR,e)}rotateZ(e){return this.rotateOnAxis(XR,e)}translateOnAxis(e,t){return jR.copy(e).applyQuaternion(this.quaternion),this.position.add(jR.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis($R,e)}translateY(e){return this.translateOnAxis(YR,e)}translateZ(e){return this.translateOnAxis(XR,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(oi.copy(this.matrixWorld).invert())}lookAt(e,t,r){e.isVector3?il.copy(e):il.set(e,t,r);const o=this.parent;this.updateWorldMatrix(!0,!1),fs.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?oi.lookAt(fs,il,this.up):oi.lookAt(il,fs,this.up),this.quaternion.setFromRotationMatrix(oi),o&&(oi.extractRotation(o.matrixWorld),Ru.setFromRotationMatrix(oi),this.quaternion.premultiply(Ru.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("v3d.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.parent!==null&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(sle)):console.error("v3d.Object3D.add: object not an instance of v3d.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let r=0;r<arguments.length;r++)this.remove(arguments[r]);return this}const t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(qR)),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){for(let e=0;e<this.children.length;e++){const t=this.children[e];t.parent=null,t.dispatchEvent(qR)}return this.children.length=0,this}attach(e){return this.updateWorldMatrix(!0,!1),oi.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),oi.multiply(e.parent.matrixWorld)),e.applyMatrix4(oi),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let r=0,o=this.children.length;r<o;r++){const i=this.children[r].getObjectByProperty(e,t);if(i!==void 0)return i}}getObjectsByProperty(e,t){let r=[];this[e]===t&&r.push(this);for(let o=0,i=this.children.length;o<i;o++){const a=this.children[o].getObjectsByProperty(e,t);a.length>0&&(r=r.concat(a))}return r}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(fs,e,QR),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(fs,ale,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[4],t[5],t[6]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let r=0,o=t.length;r<o;r++)t[r].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const t=this.children;for(let r=0,o=t.length;r<o;r++)t[r].traverseVisible(e)}traverseAncestors(e){const t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.updateConstraints(),this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let r=0,o=t.length;r<o;r++){const i=t[r];i.matrixWorldAutoUpdate!==!0&&e!==!0||i.updateMatrixWorld(e)}}updateWorldMatrix(e,t){const r=this.parent;if(e===!0&&r!==null&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),t===!0){const o=this.children;for(let i=0,a=o.length;i<a;i++)o[i].updateWorldMatrix(!1,!0)}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.disableChildRendering=e.disableChildRendering,this.hidpiCompositing=e.hidpiCompositing,this.objectIndex=e.objectIndex,this.objectColor.copy(e.objectColor),this.objectAlpha=e.objectAlpha,this.constraints=[];for(let r=0;r<e.constraints.length;r++)this.constraints.push(e.constraints[r].clone());if(this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let r=0;r<e.children.length;r++){const o=e.children[r];this.add(o.clone())}return this}copyTransform(e){this.matrix.copy(e.matrixWorld),this.parent&&this.matrix.multiplyMatrices(oi.copy(this.parent.matrixWorld).invert(),this.matrix),this.matrix.decompose(this.position,this.quaternion,this.scale)}isVisible(){return this.visible}updateConstraints(){for(let e=0;e<this.constraints.length;e++)this.constraints[e].update(this)}getWorldPositionNU(e){return e.setFromMatrixPosition(this.matrixWorld)}getLocalDirection(e){const t=this.matrix.elements;return this.isCamera||this.isLight?e.set(-t[8],-t[9],-t[10]).normalize():e.set(t[8],t[9],t[10]).normalize()}lookAtLocal(e,t,r){e.isVector3?il.copy(e):il.set(e,t,r),fs.setFromMatrixPosition(this.matrix),this.isCamera||this.isLight?oi.lookAt(fs,il,this.up):oi.lookAt(il,fs,this.up),this.quaternion.setFromRotationMatrix(oi)}findRoot(){let e=this;return this.traverseAncestors((function(t){e=t})),e}resolveMultiMaterial(){const e=[];for(let t=0;t<this.children.length;t++){const r=this.children[t];r.isMesh&&r.isMaterialGeneratedMesh&&e.push(r)}return e.length||e.push(this),e}getAuxClippingMeshes(){const e=[];for(let t=0;t<this.children.length;t++){const r=this.children[t];r.isMesh&&r.isAuxClippingMesh&&e.push(r)}return e}getWorldEuler(e,t=e._order){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decomposeE(fs,e,QR,t),e}}kt.DefaultUp=new N(0,1,0),kt.DefaultMatrixAutoUpdate=!0,kt.DefaultMatrixWorldAutoUpdate=!0;const Yi=new N,hs=new N,_2=new N,ps=new N,Lu=new N,Pu=new N,KR=new N,v2=new N,A2=new N,y2=new N,b2=new pt,x2=new pt,E2=new pt;class Br{constructor(e=new N,t=new N,r=new N){this.a=e,this.b=t,this.c=r}static getNormal(e,t,r,o){o.subVectors(r,t),Yi.subVectors(e,t),o.cross(Yi);const i=o.lengthSq();return i>0?o.multiplyScalar(1/Math.sqrt(i)):o.set(0,0,0)}static getBarycoord(e,t,r,o,i){Yi.subVectors(o,t),hs.subVectors(r,t),_2.subVectors(e,t);const a=Yi.dot(Yi),s=Yi.dot(hs),l=Yi.dot(_2),c=hs.dot(hs),u=hs.dot(_2),d=a*c-s*s;if(d===0)return i.set(0,0,0),null;const f=1/d,h=(c*l-s*u)*f,p=(a*u-s*l)*f;return i.set(1-h-p,p,h)}static containsPoint(e,t,r,o){return this.getBarycoord(e,t,r,o,ps)!==null&&ps.x>=0&&ps.y>=0&&ps.x+ps.y<=1}static getInterpolation(e,t,r,o,i,a,s,l){return this.getBarycoord(e,t,r,o,ps)===null?(l.x=0,l.y=0,"z"in l&&(l.z=0),"w"in l&&(l.w=0),null):(l.setScalar(0),l.addScaledVector(i,ps.x),l.addScaledVector(a,ps.y),l.addScaledVector(s,ps.z),l)}static getInterpolatedAttribute(e,t,r,o,i,a){return b2.setScalar(0),x2.setScalar(0),E2.setScalar(0),b2.fromBufferAttribute(e,t),x2.fromBufferAttribute(e,r),E2.fromBufferAttribute(e,o),a.setScalar(0),a.addScaledVector(b2,i.x),a.addScaledVector(x2,i.y),a.addScaledVector(E2,i.z),a}static isFrontFacing(e,t,r,o){return Yi.subVectors(r,t),hs.subVectors(e,t),Yi.cross(hs).dot(o)<0}set(e,t,r){return this.a.copy(e),this.b.copy(t),this.c.copy(r),this}setFromPointsAndIndices(e,t,r,o){return this.a.copy(e[t]),this.b.copy(e[r]),this.c.copy(e[o]),this}setFromAttributeAndIndices(e,t,r,o){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,r),this.c.fromBufferAttribute(e,o),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return Yi.subVectors(this.c,this.b),hs.subVectors(this.a,this.b),.5*Yi.cross(hs).length()}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Br.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return Br.getBarycoord(e,this.a,this.b,this.c,t)}getInterpolation(e,t,r,o,i){return Br.getInterpolation(e,this.a,this.b,this.c,t,r,o,i)}containsPoint(e){return Br.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Br.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const r=this.a,o=this.b,i=this.c;let a,s;Lu.subVectors(o,r),Pu.subVectors(i,r),v2.subVectors(e,r);const l=Lu.dot(v2),c=Pu.dot(v2);if(l<=0&&c<=0)return t.copy(r);A2.subVectors(e,o);const u=Lu.dot(A2),d=Pu.dot(A2);if(u>=0&&d<=u)return t.copy(o);const f=l*d-u*c;if(f<=0&&l>=0&&u<=0)return a=l/(l-u),t.copy(r).addScaledVector(Lu,a);y2.subVectors(e,i);const h=Lu.dot(y2),p=Pu.dot(y2);if(p>=0&&h<=p)return t.copy(i);const m=h*c-l*p;if(m<=0&&c>=0&&p<=0)return s=c/(c-p),t.copy(r).addScaledVector(Pu,s);const g=u*p-h*d;if(g<=0&&d-u>=0&&h-p>=0)return KR.subVectors(i,o),s=(d-u)/(d-u+(h-p)),t.copy(o).addScaledVector(KR,s);const _=1/(g+m+f);return a=m*_,s=f*_,t.copy(r).addScaledVector(Lu,a).addScaledVector(Pu,s)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}let lle=0;class Nr extends ti{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:lle++}),this.uuid=ji(),this.name="",this.type="Material",this.blending=1,this.side=0,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=100,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=7680,this.stencilZFail=7680,this.stencilZPass=7680,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=0,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0,this.depthPrepass=!1,this.receiveShadow=!1,this.castShadow=!1,this.profile="",this.defines={},this.definesFragOnly=new Set,this.DefaultEnvMapAutoAssign=!0,this.envMapAutoAssign=this.DefaultEnvMapAutoAssign,this.gtaoVisible=!0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const t in e){const r=e[t];if(r===void 0){console.warn("v3d.Material: '"+t+"' parameter is undefined.");continue}const o=this[t];o!==void 0?o&&o.isColor?o.set(r):o&&o.isVector3&&r&&r.isVector3?o.copy(r):this[t]=r:console.warn("v3d."+this.type+": '"+t+"' is not a property of this material.")}}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let r=null;if(t!==null){const o=t.length;r=new Array(o);for(let i=0;i!==o;++i)r[i]=t[i].clone()}return this.clippingPlanes=r,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this.depthPrepass=e.depthPrepass,this.defines=Object.assign({},e.defines),this.definesFragOnly=new Set(e.definesFragOnly),this.receiveShadow=e.receiveShadow,this.castShadow=e.castShadow,this.profile=e.profile,this.envMapAutoAssign=e.envMapAutoAssign,this.gtaoVisible=e.gtaoVisible,this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}get needsUpdate(){return this.version!=0}}class pr extends Nr{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Ge(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this}}const mr=new N,Zg=new be;class Xe{constructor(e,t,r=!1){if(Array.isArray(e))throw new TypeError("v3d.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=r,this.usage=35044,this.updateRange={offset:0,count:-1},this.gpuType=1015,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,r){e*=this.itemSize,r*=t.itemSize;for(let o=0,i=this.itemSize;o<i;o++)this.array[e+o]=t.array[r+o];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,r=this.count;t<r;t++)Zg.fromBufferAttribute(this,t),Zg.applyMatrix3(e),this.setXY(t,Zg.x,Zg.y);else if(this.itemSize===3)for(let t=0,r=this.count;t<r;t++)mr.fromBufferAttribute(this,t),mr.applyMatrix3(e),this.setXYZ(t,mr.x,mr.y,mr.z);return this}applyMatrix4(e){for(let t=0,r=this.count;t<r;t++)mr.fromBufferAttribute(this,t),mr.applyMatrix4(e),this.setXYZ(t,mr.x,mr.y,mr.z);return this}applyNormalMatrix(e){for(let t=0,r=this.count;t<r;t++)mr.fromBufferAttribute(this,t),mr.applyNormalMatrix(e),this.setXYZ(t,mr.x,mr.y,mr.z);return this}transformDirection(e){for(let t=0,r=this.count;t<r;t++)mr.fromBufferAttribute(this,t),mr.transformDirection(e),this.setXYZ(t,mr.x,mr.y,mr.z);return this}set(e,t=0){return this.array.set(e,t),this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=ah(t,this.array)),t}setX(e,t){return this.normalized&&(t=io(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=ah(t,this.array)),t}setY(e,t){return this.normalized&&(t=io(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=ah(t,this.array)),t}setZ(e,t){return this.normalized&&(t=io(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=ah(t,this.array)),t}setW(e,t){return this.normalized&&(t=io(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,r){return e*=this.itemSize,this.normalized&&(t=io(t,this.array),r=io(r,this.array)),this.array[e+0]=t,this.array[e+1]=r,this}setXYZ(e,t,r,o){return e*=this.itemSize,this.normalized&&(t=io(t,this.array),r=io(r,this.array),o=io(o,this.array)),this.array[e+0]=t,this.array[e+1]=r,this.array[e+2]=o,this}setXYZW(e,t,r,o,i){return e*=this.itemSize,this.normalized&&(t=io(t,this.array),r=io(r,this.array),o=io(o,this.array),i=io(i,this.array)),this.array[e+0]=t,this.array[e+1]=r,this.array[e+2]=o,this.array[e+3]=i,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}}class cle extends Xe{constructor(e,t,r){super(new Int8Array(e),t,r)}}class ule extends Xe{constructor(e,t,r){super(new Uint8Array(e),t,r)}}class dle extends Xe{constructor(e,t,r){super(new Uint8ClampedArray(e),t,r)}}class fle extends Xe{constructor(e,t,r){super(new Int16Array(e),t,r)}}class ZR extends Xe{constructor(e,t,r){super(new Uint16Array(e),t,r)}}class hle extends Xe{constructor(e,t,r){super(new Int32Array(e),t,r)}}class JR extends Xe{constructor(e,t,r){super(new Uint32Array(e),t,r)}}class ple extends Xe{constructor(e,t,r){super(new Uint16Array(e),t,r),this.isFloat16BufferAttribute=!0}}class mt extends Xe{constructor(e,t,r){super(new Float32Array(e),t,r)}}class mle extends Xe{constructor(e,t,r){super(new Float64Array(e),t,r)}}let gle=0;const bi=new Ue,C2=new kt,Du=new N,ii=new Tn,dh=new Tn,Or=new N;class At extends ti{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:gle++}),this.uuid=ji(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.boundsTree=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new Xe(new(BR(e)?Uint32Array:Uint16Array)(e),1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,r=0){this.groups.push({start:e,count:t,materialIndex:r})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);const r=this.attributes.normal;if(r!==void 0){const i=new ao().getNormalMatrix(e);r.applyNormalMatrix(i),r.needsUpdate=!0}const o=this.attributes.tangent;return o!==void 0&&(o.transformDirection(e),o.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return bi.makeRotationFromQuaternion(e),this.applyMatrix4(bi),this}rotateX(e){return bi.makeRotationX(e),this.applyMatrix4(bi),this}rotateY(e){return bi.makeRotationY(e),this.applyMatrix4(bi),this}rotateZ(e){return bi.makeRotationZ(e),this.applyMatrix4(bi),this}translate(e,t,r){return bi.makeTranslation(e,t,r),this.applyMatrix4(bi),this}scale(e,t,r){return bi.makeScale(e,t,r),this.applyMatrix4(bi),this}lookAt(e){return C2.lookAt(e),C2.updateMatrix(),this.applyMatrix4(C2.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Du).negate(),this.translate(Du.x,Du.y,Du.z),this}setFromPoints(e){const t=[];for(let r=0,o=e.length;r<o;r++){const i=e[r];t.push(i.x,i.y,i.z||0)}return this.setAttribute("position",new mt(t,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Tn);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('v3d.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new N(-1/0,-1/0,-1/0),new N(1/0,1/0,1/0));if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let r=0,o=t.length;r<o;r++){const i=t[r];ii.setFromBufferAttribute(i),this.morphTargetsRelative?(Or.addVectors(this.boundingBox.min,ii.min),this.boundingBox.expandByPoint(Or),Or.addVectors(this.boundingBox.max,ii.max),this.boundingBox.expandByPoint(Or)):(this.boundingBox.expandByPoint(ii.min),this.boundingBox.expandByPoint(ii.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('v3d.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new ni);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('v3d.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new N,1/0);if(e){const r=this.boundingSphere.center;if(ii.setFromBufferAttribute(e),t)for(let i=0,a=t.length;i<a;i++){const s=t[i];dh.setFromBufferAttribute(s),this.morphTargetsRelative?(Or.addVectors(ii.min,dh.min),ii.expandByPoint(Or),Or.addVectors(ii.max,dh.max),ii.expandByPoint(Or)):(ii.expandByPoint(dh.min),ii.expandByPoint(dh.max))}ii.getCenter(r);let o=0;for(let i=0,a=e.count;i<a;i++)Or.fromBufferAttribute(e,i),o=Math.max(o,r.distanceToSquared(Or));if(t)for(let i=0,a=t.length;i<a;i++){const s=t[i],l=this.morphTargetsRelative;for(let c=0,u=s.count;c<u;c++)Or.fromBufferAttribute(s,c),l&&(Du.fromBufferAttribute(e,c),Or.add(Du)),o=Math.max(o,r.distanceToSquared(Or))}this.boundingSphere.radius=Math.sqrt(o),isNaN(this.boundingSphere.radius)&&console.error('v3d.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0)return void console.error("v3d.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const r=e.array,o=t.position.array,i=t.normal.array,a=t.uv.array,s=o.length/3;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new Xe(new Float32Array(4*s),4));const l=this.getAttribute("tangent").array,c=[],u=[];for(let P=0;P<s;P++)c[P]=new N,u[P]=new N;const d=new N,f=new N,h=new N,p=new be,m=new be,g=new be,_=new N,A=new N;function y(P,D,Q){d.fromArray(o,3*P),f.fromArray(o,3*D),h.fromArray(o,3*Q),p.fromArray(a,2*P),m.fromArray(a,2*D),g.fromArray(a,2*Q),f.sub(d),h.sub(d),m.sub(p),g.sub(p);const re=1/(m.x*g.y-g.x*m.y);isFinite(re)&&(_.copy(f).multiplyScalar(g.y).addScaledVector(h,-m.y).multiplyScalar(re),A.copy(h).multiplyScalar(m.x).addScaledVector(f,-g.x).multiplyScalar(re),c[P].add(_),c[D].add(_),c[Q].add(_),u[P].add(A),u[D].add(A),u[Q].add(A))}let b=this.groups;b.length===0&&(b=[{start:0,count:r.length}]);for(let P=0,D=b.length;P<D;++P){const Q=b[P],re=Q.start;for(let G=re,se=re+Q.count;G<se;G+=3)y(r[G+0],r[G+1],r[G+2])}const E=new N,x=new N,w=new N,L=new N;function C(P){w.fromArray(i,3*P),L.copy(w);const D=c[P];E.copy(D),E.sub(w.multiplyScalar(w.dot(D))).normalize(),x.crossVectors(L,D);const Q=x.dot(u[P])<0?-1:1;l[4*P]=E.x,l[4*P+1]=E.y,l[4*P+2]=E.z,l[4*P+3]=Q}for(let P=0,D=b.length;P<D;++P){const Q=b[P],re=Q.start;for(let G=re,se=re+Q.count;G<se;G+=3)C(r[G+0]),C(r[G+1]),C(r[G+2])}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(t!==void 0){let r=this.getAttribute("normal");if(r===void 0)r=new Xe(new Float32Array(3*t.count),3),this.setAttribute("normal",r);else for(let f=0,h=r.count;f<h;f++)r.setXYZ(f,0,0,0);const o=new N,i=new N,a=new N,s=new N,l=new N,c=new N,u=new N,d=new N;if(e)for(let f=0,h=e.count;f<h;f+=3){const p=e.getX(f+0),m=e.getX(f+1),g=e.getX(f+2);o.fromBufferAttribute(t,p),i.fromBufferAttribute(t,m),a.fromBufferAttribute(t,g),u.subVectors(a,i),d.subVectors(o,i),u.cross(d),s.fromBufferAttribute(r,p),l.fromBufferAttribute(r,m),c.fromBufferAttribute(r,g),s.add(u),l.add(u),c.add(u),r.setXYZ(p,s.x,s.y,s.z),r.setXYZ(m,l.x,l.y,l.z),r.setXYZ(g,c.x,c.y,c.z)}else for(let f=0,h=t.count;f<h;f+=3)o.fromBufferAttribute(t,f+0),i.fromBufferAttribute(t,f+1),a.fromBufferAttribute(t,f+2),u.subVectors(a,i),d.subVectors(o,i),u.cross(d),r.setXYZ(f+0,u.x,u.y,u.z),r.setXYZ(f+1,u.x,u.y,u.z),r.setXYZ(f+2,u.x,u.y,u.z);this.normalizeNormals(),r.needsUpdate=!0}}merge(){return console.error("v3d.BufferGeometry.merge() has been removed. Use v3d.BufferGeometryUtils.mergeBufferGeometries() instead."),this}normalizeNormals(){const e=this.attributes.normal;for(let t=0,r=e.count;t<r;t++)Or.fromBufferAttribute(e,t),Or.normalize(),e.setXYZ(t,Or.x,Or.y,Or.z)}toNonIndexed(){function e(s,l){const c=s.array,u=s.itemSize,d=s.normalized,f=new c.constructor(l.length*u);let h=0,p=0;for(let m=0,g=l.length;m<g;m++){h=l[m]*u;for(let _=0;_<u;_++)f[p++]=c[h++]}return new Xe(f,u,d)}if(this.index===null)return console.warn("v3d.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new At,r=this.index.array,o=this.attributes;for(const s in o){const l=e(o[s],r);t.setAttribute(s,l)}const i=this.morphAttributes;for(const s in i){const l=[],c=i[s];for(let u=0,d=c.length;u<d;u++){const f=e(c[u],r);l.push(f)}t.morphAttributes[s]=l}t.morphTargetsRelative=this.morphTargetsRelative;const a=this.groups;for(let s=0,l=a.length;s<l;s++){const c=a[s];t.addGroup(c.start,c.count,c.materialIndex)}return t}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const r=e.index;r!==null&&this.setIndex(r.clone(t));const o=e.attributes;for(const c in o){const u=o[c];this.setAttribute(c,u.clone(t))}const i=e.morphAttributes;for(const c in i){const u=[],d=i[c];for(let f=0,h=d.length;f<h;f++)u.push(d[f].clone(t));this.morphAttributes[c]=u}this.morphTargetsRelative=e.morphTargetsRelative;const a=e.groups;for(let c=0,u=a.length;c<u;c++){const d=a[c];this.addGroup(d.start,d.count,d.materialIndex)}const s=e.boundingBox;s!==null&&(this.boundingBox=s.clone());const l=e.boundingSphere;return l!==null&&(this.boundingSphere=l.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,e.parameters!==void 0&&(this.parameters=Object.assign({},e.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}}const eL=new Ue,Bu=new Tu,S2=new ni,al=new N,sl=new N,ll=new N,Nu=new N,w2=new N,M2=new N,cl=new N,Jg=new N,e0=new N,t0=new be,n0=new be,r0=new be,T2=new N,o0=new N;class Mt extends kt{constructor(e=new At,t=new pr){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets(),this.isMaterialGeneratedMesh=!1,this.isAuxClippingMesh=!1}copy(e,t){return super.copy(e,t),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this.isMaterialGeneratedMesh=e.isMaterialGeneratedMesh,this}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const r=e[t[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let o=0,i=r.length;o<i;o++){const a=r[o].name||String(o);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=o}}}}getVertexPosition(e,t){const r=this.geometry,o=r.attributes.position,i=r.morphAttributes.position,a=r.morphTargetsRelative;t.fromBufferAttribute(o,e);const s=this.morphTargetInfluences;if(i&&s){cl.set(0,0,0);for(let l=0,c=i.length;l<c;l++){const u=s[l],d=i[l];u!==0&&(Nu.fromBufferAttribute(d,e),a?cl.addScaledVector(Nu,u):cl.addScaledVector(Nu.sub(t),u))}t.add(cl)}return this.isSkinnedMesh&&this.boneTransform(e,t),t}raycast(e,t){if(this.isAuxClippingMesh)return;const r=this.geometry,o=this.material,i=this.matrixWorld;if(o===void 0||(r.boundingSphere===null&&r.computeBoundingSphere(),S2.copy(r.boundingSphere),S2.applyMatrix4(i),e.ray.intersectsSphere(S2)===!1)||(eL.copy(i).invert(),Bu.copy(e.ray).applyMatrix4(eL),r.boundingBox!==null&&Bu.intersectsBox(r.boundingBox)===!1))return;let a;const s=r.index,l=r.attributes.position,c=r.morphAttributes.position,u=r.morphTargetsRelative,d=r.attributes.uv,f=r.attributes.uv2,h=r.groups,p=r.drawRange;if(s!==null)if(Array.isArray(o))for(let m=0,g=h.length;m<g;m++){const _=h[m],A=o[_.materialIndex];for(let y=Math.max(_.start,p.start),b=Math.min(s.count,Math.min(_.start+_.count,p.start+p.count));y<b;y+=3){const E=s.getX(y),x=s.getX(y+1),w=s.getX(y+2);a=i0(this,A,e,Bu,l,c,u,d,f,E,x,w),a&&(a.faceIndex=Math.floor(y/3),a.face.materialIndex=_.materialIndex,t.push(a))}}else for(let m=Math.max(0,p.start),g=Math.min(s.count,p.start+p.count);m<g;m+=3){const _=s.getX(m),A=s.getX(m+1),y=s.getX(m+2);a=i0(this,o,e,Bu,l,c,u,d,f,_,A,y),a&&(a.faceIndex=Math.floor(m/3),t.push(a))}else if(l!==void 0)if(Array.isArray(o))for(let m=0,g=h.length;m<g;m++){const _=h[m],A=o[_.materialIndex];for(let y=Math.max(_.start,p.start),b=Math.min(l.count,Math.min(_.start+_.count,p.start+p.count));y<b;y+=3)a=i0(this,A,e,Bu,l,c,u,d,f,y,y+1,y+2),a&&(a.faceIndex=Math.floor(y/3),a.face.materialIndex=_.materialIndex,t.push(a))}else for(let m=Math.max(0,p.start),g=Math.min(l.count,p.start+p.count);m<g;m+=3)a=i0(this,o,e,Bu,l,c,u,d,f,m,m+1,m+2),a&&(a.faceIndex=Math.floor(m/3),t.push(a))}clone(){return new this.constructor(this.geometry,this.material).copy(this)}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}isVisible(){return this.isMaterialGeneratedMesh&&this.parent?this.visible&&this.parent.visible:this.visible}}function _le(n,e,t,r,o,i,a,s){let l;if(l=e.side===1?r.intersectTriangle(a,i,o,!0,s):r.intersectTriangle(o,i,a,e.side===0,s),l===null)return null;o0.copy(s),o0.applyMatrix4(n.matrixWorld);const c=t.ray.origin.distanceTo(o0);return c<t.near||c>t.far?null:{distance:c,point:o0.clone(),object:n}}function i0(n,e,t,r,o,i,a,s,l,c,u,d){al.fromBufferAttribute(o,c),sl.fromBufferAttribute(o,u),ll.fromBufferAttribute(o,d);const f=n.morphTargetInfluences;if(i&&f){cl.set(0,0,0),Jg.set(0,0,0),e0.set(0,0,0);for(let p=0,m=i.length;p<m;p++){const g=f[p],_=i[p];g!==0&&(Nu.fromBufferAttribute(_,c),w2.fromBufferAttribute(_,u),M2.fromBufferAttribute(_,d),a?(cl.addScaledVector(Nu,g),Jg.addScaledVector(w2,g),e0.addScaledVector(M2,g)):(cl.addScaledVector(Nu.sub(al),g),Jg.addScaledVector(w2.sub(sl),g),e0.addScaledVector(M2.sub(ll),g)))}al.add(cl),sl.add(Jg),ll.add(e0)}n.isSkinnedMesh&&(n.boneTransform(c,al),n.boneTransform(u,sl),n.boneTransform(d,ll));const h=_le(n,e,t,r,al,sl,ll,T2);if(h){s&&(t0.fromBufferAttribute(s,c),n0.fromBufferAttribute(s,u),r0.fromBufferAttribute(s,d),h.uv=Br.getInterpolation(T2,al,sl,ll,t0,n0,r0,new be)),l&&(t0.fromBufferAttribute(l,c),n0.fromBufferAttribute(l,u),r0.fromBufferAttribute(l,d),h.uv2=Br.getInterpolation(T2,al,sl,ll,t0,n0,r0,new be));const p={a:c,b:u,c:d,normal:new N,materialIndex:0};Br.getNormal(al,sl,ll,p.normal),h.face=p}return h}class nc extends At{constructor(e=1,t=1,r=1,o=1,i=1,a=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:r,widthSegments:o,heightSegments:i,depthSegments:a};const s=this;o=Math.floor(o),i=Math.floor(i),a=Math.floor(a);const l=[],c=[],u=[],d=[];let f=0,h=0;function p(m,g,_,A,y,b,E,x,w,L,C){const P=b/w,D=E/L,Q=b/2,re=E/2,G=x/2,se=w+1,ee=L+1;let ie=0,H=0;const T=new N;for(let R=0;R<ee;R++){const O=R*D-re;for(let W=0;W<se;W++){const ae=W*P-Q;T[m]=ae*A,T[g]=O*y,T[_]=G,c.push(T.x,T.y,T.z),T[m]=0,T[g]=0,T[_]=x>0?1:-1,u.push(T.x,T.y,T.z),d.push(W/w),d.push(1-R/L),ie+=1}}for(let R=0;R<L;R++)for(let O=0;O<w;O++){const W=f+O+se*R,ae=f+O+se*(R+1),ne=f+(O+1)+se*(R+1),oe=f+(O+1)+se*R;l.push(W,ae,oe),l.push(ae,ne,oe),H+=6}s.addGroup(h,H,C),h+=H,f+=ie}p("z","y","x",-1,-1,r,t,e,a,i,0),p("z","y","x",1,-1,r,t,-e,a,i,1),p("x","z","y",1,1,e,r,t,o,a,2),p("x","z","y",1,-1,e,r,-t,o,a,3),p("x","y","z",1,-1,e,t,r,o,i,4),p("x","y","z",-1,-1,e,t,-r,o,i,5),this.setIndex(l),this.setAttribute("position",new Xe(new Float32Array(c),3)),this.setAttribute("normal",new Xe(new Float32Array(u),3)),this.setAttribute("uv",new Xe(new Float32Array(d),2))}}function Ou(n){const e={};for(const t in n){e[t]={};for(const r in n[t]){const o=n[t][r];o&&(o.isColor||o.isMatrix3||o.isMatrix4||o.isVector2||o.isVector3||o.isVector4||o.isTexture||o.isQuaternion)?e[t][r]=o.clone():Array.isArray(o)?e[t][r]=o.slice():e[t][r]=o}}return e}function Fo(n){const e={};for(let t=0;t<n.length;t++){const r=Ou(n[t]);for(const o in r)e[o]=r[o]}return e}function vle(n){const e=[];for(let t=0;t<n.length;t++)e.push(n[t].clone());return e}function tL(n){return n.getRenderTarget()===null&&n.outputEncoding===3001?"srgb":"srgb-linear"}const _o={clone:Ou,merge:Fo};var Ale=`void main(){
gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.0);
}`,yle=`void main(){
gl_FragColor=vec4(1.0,0.0,0.0,1.0);
}`;class Dn extends Nr{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.customPrepTokens={},this.vertexShader=Ale,this.fragmentShader=yle,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Ou(e.uniforms),this.uniformsGroups=vle(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.customPrepTokens=Object.assign({},e.customPrepTokens),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}}class fh extends kt{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Ue,this.projectionMatrix=new Ue,this.projectionMatrixInverse=new Ue,this.controlSettings=null,this.viewportFit={type:0,initialAspect:1},this.ignoreShadowLayers=!1}get controls(){return console.warn("v3d.Camera.controls replaced by v3d.Camera.controlSettings"),this.controlSettings}set controls(e){console.warn("v3d.Camera.controls replaced by v3d.Camera.controlSettings"),this.controlSettings=e}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),e.controlSettings&&(this.controlSettings=e.controlSettings.clone()),this.viewportFit.type=e.viewportFit.type,this.viewportFit.initialAspect=e.viewportFit.initialAspect,this.ignoreShadowLayers=e.ignoreShadowLayers,this}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(e){return new this.constructor().copy(this,e)}}class gr extends fh{constructor(e=50,t=1,r=.1,o=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=r,this.far=o,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=2*xu*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(.5*ss*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return 2*xu*Math.atan(Math.tan(.5*ss*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,r,o,i,a){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=r,this.view.offsetY=o,this.view.width=i,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(.5*ss*this.fov)/this.zoom,r=2*t,o=this.aspect*r,i=-.5*o;const a=this.view;if(this.view!==null&&this.view.enabled){const l=a.fullWidth,c=a.fullHeight;i+=a.offsetX*o/l,t-=a.offsetY*r/c,o*=a.width/l,r*=a.height/c}const s=this.filmOffset;s!==0&&(i+=e*s/this.getFilmWidth()),this.projectionMatrix.makePerspective(i,i+o,t,t-r,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}}class a0 extends kt{constructor(e,t,r){super(),this.type="CubeCamera",this.renderTarget=r;const o=new gr(-90,1,e,t);o.layers=this.layers,o.up.set(0,1,0),o.lookAt(1,0,0),this.add(o);const i=new gr(-90,1,e,t);i.layers=this.layers,i.up.set(0,1,0),i.lookAt(-1,0,0),this.add(i);const a=new gr(-90,1,e,t);a.layers=this.layers,a.up.set(0,0,-1),a.lookAt(0,1,0),this.add(a);const s=new gr(-90,1,e,t);s.layers=this.layers,s.up.set(0,0,1),s.lookAt(0,-1,0),this.add(s);const l=new gr(-90,1,e,t);l.layers=this.layers,l.up.set(0,1,0),l.lookAt(0,0,1),this.add(l);const c=new gr(-90,1,e,t);c.layers=this.layers,c.up.set(0,1,0),c.lookAt(0,0,-1),this.add(c)}update(e,t){this.parent===null&&this.updateMatrixWorld();const r=this.renderTarget,[o,i,a,s,l,c]=this.children,u=e.getRenderTarget(),d=e.toneMapping,f=e.xr.enabled;e.toneMapping=0,e.xr.enabled=!1;const h=r.texture.generateMipmaps;r.texture.generateMipmaps=!1,e.setRenderTarget(r,0),e.render(t,o),e.setRenderTarget(r,1),e.render(t,i),e.setRenderTarget(r,2),e.render(t,a),e.setRenderTarget(r,3),e.render(t,s),e.setRenderTarget(r,4),e.render(t,l),r.texture.generateMipmaps=h,e.setRenderTarget(r,5),e.render(t,c),e.setRenderTarget(u),e.toneMapping=d,e.xr.enabled=f,r.texture.needsPMREMUpdate=!0}}class s0 extends $n{constructor(e,t,r,o,i,a,s,l,c,u){super(e=e!==void 0?e:[],t=t!==void 0?t:301,r,o,i,a,s,l,c,u),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.source.data}set images(e){this.source.data=e}}class hh extends nn{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const r={width:e,height:e,depth:1},o=[r,r,r,r,r,r];this.texture=new s0(o,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=t.generateMipmaps!==void 0&&t.generateMipmaps,this.texture.minFilter=t.minFilter!==void 0?t.minFilter:1006}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const r={uniforms:{tEquirect:{value:null}},vertexShader:`

                varying vec3 vWorldDirection;

                vec3 transformDirection(in vec3 dir, in mat4 matrix) {

                    return normalize((matrix * vec4(dir, 0.0)).xyz);

                }

                void main() {

                    vWorldDirection = transformDirection(position, modelMatrix);

                    #include <begin_vertex>
                    #include <project_vertex>

                }
            `,fragmentShader:`

                uniform sampler2D tEquirect;

                varying vec3 vWorldDirection;

                #include <common>

                void main() {

                    vec3 direction = normalize(vWorldDirection);

                    vec2 sampleUV = equirectUv(direction);

                    gl_FragColor = texture2D(tEquirect, sampleUV);

                }
            `},o=new nc(5,5,5),i=new Dn({name:"CubemapFromEquirect",uniforms:Ou(r.uniforms),vertexShader:r.vertexShader,fragmentShader:r.fragmentShader,side:1,blending:0});i.uniforms.tEquirect.value=t;const a=new Mt(o,i),s=t.minFilter;return t.minFilter===1008&&(t.minFilter=1006),new a0(1,10,this).update(e,a),t.minFilter=s,a.geometry.dispose(),a.material.dispose(),this}clear(e,t,r,o){const i=e.getRenderTarget();for(let a=0;a<6;a++)e.setRenderTarget(this,a),e.clear(t,r,o);e.setRenderTarget(i)}}const nr={checkWebGL:function(){try{const n=document.createElement("canvas");return!(!window.WebGLRenderingContext||!n.getContext("webgl"))}catch{return!1}},checkWebGL2:function(){try{const n=document.createElement("canvas");return!(!window.WebGL2RenderingContext||!n.getContext("webgl2"))}catch{return!1}},checkWorkers:function(){return!!window.Worker},checkFileAPI:function(){return window.File&&window.FileReader&&window.FileList&&window.Blob},genWebGLErrorMessage:function(n){const e=document.createElement("div");e.setAttribute("class","v3d-webgl-error-container");const t=document.createElement("div");t.setAttribute("class","v3d-webgl-error-image"),e.appendChild(t);const r=document.createElement("div");return r.setAttribute("class","v3d-webgl-error"),r.innerHTML=n,e.appendChild(r),e},showWebGLErrorMessage:function(n,e){(n=n||document.body).appendChild(nr.genWebGLErrorMessage(e));const t=document.getElementById("v3d_preloader_container");t&&(t.style.visibility="hidden")},checkIOS:function(){return(/iPad|iPhone|iPod/.test(navigator.platform)||navigator.platform==="MacIntel"&&navigator.maxTouchPoints>1)&&!window.MSStream},checkAndroid:function(){return!!navigator.userAgent.match(/Android/i)},checkSafari:function(){return/Safari/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)},checkFloatTex:function(n,e){const t=n.getContext();return!(!n.capabilities.isWebGL2||!t.getExtension("EXT_color_buffer_float")||e&&!t.getExtension("OES_texture_float_linear"))||!(n.capabilities.isWebGL2||!t.getExtension("OES_texture_float")||e&&!t.getExtension("OES_texture_float_linear"))},checkHalfFloatTex:function(n,e){const t=n.getContext();return!(!n.capabilities.isWebGL2||!t.getExtension("EXT_color_buffer_float"))||!(n.capabilities.isWebGL2||!t.getExtension("OES_texture_half_float")||e&&!t.getExtension("OES_texture_half_float_linear"))},checkHalfFloatReadPixels:function(n){const e=n.getContext(),t=n.capabilities;return!/Firefox/.test(navigator.userAgent)&&!!(e.getExtension("EXT_color_buffer_half_float")||t.isWebGL2&&e.getExtension("EXT_color_buffer_float"))},checkFloatReadPixels:function(n){const e=n.getContext();return!!(n.capabilities.isWebGL2||e.getExtension("OES_texture_float")||e.getExtension("WEBGL_color_buffer_float"))},checkDepthTex:function(n){const e=n.getContext();return!(!n.capabilities.isWebGL2&&!e.getExtension("WEBGL_depth_texture"))},getGPUVendor:function(n){const e=n?n.getContext():document.createElement("canvas").getContext("webgl");if(/Firefox/.test(navigator.userAgent))return e.getParameter(7936);{const t=e.getExtension("WEBGL_debug_renderer_info");return t!=null?e.getParameter(t.UNMASKED_VENDOR_WEBGL):""}},getGPUModel:function(n){const e=n?n.getContext():document.createElement("canvas").getContext("webgl");if(/Firefox/.test(navigator.userAgent))return e.getParameter(7937);{const t=e.getExtension("WEBGL_debug_renderer_info");return t!=null?e.getParameter(t.UNMASKED_RENDERER_WEBGL):""}},checkWebXR:function(n,e,t){"xr"in navigator&&navigator.xr.isSessionSupported?navigator.xr.isSessionSupported(n).then((function(r){r?e():t()})).catch(t):t()},checkNativeWebXR:function(){return!1},checkCardboard:function(){return!1},checkSwiftShader:function(n){return this.getGPUModel(n)=="Google SwiftShader"},checkWebAudio:function(){return(window.AudioContext||window.webkitAudioContext)!==void 0},isSafariWithMultisamplingBug:function(){const n=navigator.userAgent;return!(!this.checkSafari()&&!n.match("MicroMessenger"))&&(n.match("Version/15.4")||n.match(/CPU (OS|iPhone OS) (15_4|15_4_1|15_4_2|15_4_3) like Mac OS X/))},isSafariWithUint16Bug:function(){const n=navigator.userAgent;return!(!this.checkSafari()&&!n.match("MicroMessenger"))&&n.match(/CPU (OS|iPhone OS) (11_[0-9][0-9_]*|12_[0-9][0-9_]*) like Mac OS X/)},isTouchDevice:function(){return"ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0}},I2=new N,ble=new N,xle=new ao;class Vo{constructor(e=new N(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,r,o){return this.normal.set(e,t,r),this.constant=o,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,r){const o=I2.subVectors(r,t).cross(ble.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(o,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}intersectLine(e,t){const r=e.delta(I2),o=this.normal.dot(r);if(o===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;const i=-(e.start.dot(this.normal)+this.constant)/o;return i<0||i>1?null:t.copy(r).multiplyScalar(i).add(e.start)}intersectsLine(e){const t=this.distanceToPoint(e.start),r=this.distanceToPoint(e.end);return t<0&&r>0||r<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const r=t||xle.getNormalMatrix(e),o=this.coplanarPoint(I2).applyMatrix4(e),i=this.normal.applyMatrix3(r).normalize();return this.constant=-o.dot(i),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}const ku=new ni,l0=new N;class ph{constructor(e=new Vo,t=new Vo,r=new Vo,o=new Vo,i=new Vo,a=new Vo){this.planes=[e,t,r,o,i,a]}set(e,t,r,o,i,a){const s=this.planes;return s[0].copy(e),s[1].copy(t),s[2].copy(r),s[3].copy(o),s[4].copy(i),s[5].copy(a),this}copy(e){const t=this.planes;for(let r=0;r<6;r++)t[r].copy(e.planes[r]);return this}setFromProjectionMatrix(e){const t=this.planes,r=e.elements,o=r[0],i=r[1],a=r[2],s=r[3],l=r[4],c=r[5],u=r[6],d=r[7],f=r[8],h=r[9],p=r[10],m=r[11],g=r[12],_=r[13],A=r[14],y=r[15];return t[0].setComponents(s-o,d-l,m-f,y-g).normalize(),t[1].setComponents(s+o,d+l,m+f,y+g).normalize(),t[2].setComponents(s+i,d+c,m+h,y+_).normalize(),t[3].setComponents(s-i,d-c,m-h,y-_).normalize(),t[4].setComponents(s-a,d-u,m-p,y-A).normalize(),t[5].setComponents(s+a,d+u,m+p,y+A).normalize(),this}intersectsObject(e){const t=e.geometry;return t.boundingSphere===null&&t.computeBoundingSphere(),ku.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(ku)}intersectsSprite(e){return ku.center.set(0,0,0),ku.radius=.7071067811865476,ku.applyMatrix4(e.matrixWorld),this.intersectsSphere(ku)}intersectsSphere(e){const t=this.planes,r=e.center,o=-e.radius;for(let i=0;i<6;i++)if(t[i].distanceToPoint(r)<o)return!1;return!0}intersectsBox(e){const t=this.planes;for(let r=0;r<6;r++){const o=t[r];if(l0.x=o.normal.x>0?e.max.x:e.min.x,l0.y=o.normal.y>0?e.max.y:e.min.y,l0.z=o.normal.z>0?e.max.z:e.min.z,o.distanceToPoint(l0)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let r=0;r<6;r++)if(t[r].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}class jr extends kt{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.overrideMaterial=null,this.backgroundToneMapped=!0,this.postprocessing=[],this.worldMaterial=null,this.worldEnvMapProbe=null,typeof __V3D_DEVTOOLS__<"u"&&__V3D_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundToneMapped=e.backgroundToneMapped,e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}dispose(){this.dispatchEvent({type:"dispose"})}}function nL(){let n=null,e=!1,t=null,r=null;function o(i,a){t(i,a),r=n.requestAnimationFrame(o)}return{start:function(){e!==!0&&t!==null&&(r=n.requestAnimationFrame(o),e=!0)},stop:function(){n.cancelAnimationFrame(r),e=!1},setAnimationLoop:function(i){t=i},setContext:function(i){n=i}}}function Ele(n,e){const t=e.isWebGL2;let r=new WeakMap;return{get:function(o){return r.get(o)},remove:function(o){const i=r.get(o);i&&(n.deleteBuffer(i.buffer),r.delete(o))},update:function(o,i){if(o.isGLBufferAttribute){const s=r.get(o);return void((!s||s.version<o.version)&&r.set(o,{buffer:o.buffer,type:o.type,bytesPerElement:o.elementSize,version:o.version}))}const a=r.get(o);a===void 0?r.set(o,(function(s,l){const c=s.array,u=s.usage,d=n.createBuffer();let f;if(n.bindBuffer(l,d),n.bufferData(l,c,u),s.onUploadCallback(),c instanceof Float32Array)f=5126;else if(c instanceof Uint16Array)if(s.isFloat16BufferAttribute){if(!t)throw new Error("v3d.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");f=5131}else f=5123;else if(c instanceof Int16Array)f=5122;else if(c instanceof Uint32Array)f=5125;else if(c instanceof Int32Array)f=5124;else if(c instanceof Int8Array)f=5120;else if(c instanceof Uint8Array)f=5121;else{if(!(c instanceof Uint8ClampedArray))throw new Error("v3d.WebGLAttributes: Unsupported buffer data format: "+c);f=5121}return{buffer:d,type:f,bytesPerElement:c.BYTES_PER_ELEMENT,version:s.version}})(o,i)):a.version<o.version&&((function(s,l,c){const u=l.array,d=l.updateRange;n.bindBuffer(c,s),d.count===-1?n.bufferSubData(c,0,u):(t?n.bufferSubData(c,d.offset*u.BYTES_PER_ELEMENT,u,d.offset,d.count):n.bufferSubData(c,d.offset*u.BYTES_PER_ELEMENT,u.subarray(d.offset,d.offset+d.count)),d.count=-1),l.onUploadCallback()})(a.buffer,o,i),a.version=o.version)},dispose:function(){r=new WeakMap}}}class ms extends At{constructor(e=1,t=1,r=1,o=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:r,heightSegments:o};const i=e/2,a=t/2,s=Math.floor(r),l=Math.floor(o),c=s+1,u=l+1,d=e/s,f=t/l,h=[],p=[],m=[],g=[];for(let _=0;_<u;_++){const A=_*f-a;for(let y=0;y<c;y++){const b=y*d-i;p.push(b,-A,0),m.push(0,0,1),g.push(y/s),g.push(1-_/l)}}for(let _=0;_<l;_++)for(let A=0;A<s;A++){const y=A+c*_,b=A+c*(_+1),E=A+1+c*(_+1),x=A+1+c*_;h.push(y,b,x),h.push(b,E,x)}this.setIndex(h),this.setAttribute("position",new Xe(new Float32Array(p),3)),this.setAttribute("normal",new Xe(new Float32Array(m),3)),this.setAttribute("uv",new Xe(new Float32Array(g),2))}}var Cle=`#ifdef USE_ALPHAMAP
diffuseColor.a*=texture2D(alphaMap,vUv).g;
#endif`,Sle=`#ifdef USE_ALPHAMAP
uniform sampler2D alphaMap;
#endif`,wle=`#ifdef USE_ALPHATEST
if (diffuseColor.a<alphaTest)
discard;
else
diffuseColor.a=1.0;
#endif`,Mle=`#ifdef USE_ALPHATEST
uniform float alphaTest;
#endif`,Tle=`#ifdef USE_AOMAP
float ambientOcclusion=(texture2D(aoMap,vUv2).r-1.0)*aoMapIntensity+1.0;
reflectedLight.indirectDiffuse*=ambientOcclusion;
#if defined(USE_ENVMAP)&&defined(STANDARD)
float dotNV=saturate(dot(geometry.normal,geometry.viewDir));
reflectedLight.indirectSpecular*=computeSpecularOcclusion(dotNV,ambientOcclusion,material.roughness);
#endif
#endif`,Ile=`#ifdef USE_AOMAP
uniform sampler2D aoMap;
uniform float aoMapIntensity;
#endif`,Rle="vec3 transformed=vec3(position);",Lle=`vec3 objectNormal=vec3(normal);
#ifdef USE_TANGENT
vec3 objectTangent=vec3(tangent.xyz);
#endif`,Ple=`vec3 BRDF_Lambert(const in vec3 diffuseColor){
return RECIPROCAL_PI*diffuseColor;
}
vec3 F_Schlick(const in vec3 f0,const in float f90,const in float dotVH){
float fresnel=exp2((-5.55473*dotVH-6.98316)*dotVH);
return f0*(1.0-fresnel)+(f90*fresnel);
}
float V_GGX_SmithCorrelated(const in float alpha,const in float dotNL,const in float dotNV){
float a2=pow2(alpha);
float gv=dotNL*sqrt(a2+(1.0-a2)*pow2(dotNV));
float gl=dotNV*sqrt(a2+(1.0-a2)*pow2(dotNL));
return 0.5/max(gv+gl,EPSILON);
}
float D_GGX(const in float alpha,const in float dotNH){
float a2=pow2(alpha);
float denom=pow2(dotNH)*(a2-1.0)+1.0;
return RECIPROCAL_PI*a2/pow2(denom);
}
vec3 BRDF_GGX(const in vec3 lightDir,const in vec3 viewDir,const in vec3 normal,const in vec3 f0,const in float f90,const in float roughness){
float alpha=pow2(clamp(roughness,0.04,1.0));
vec3 halfDir=normalize(lightDir+viewDir);
float dotNL=saturate(dot(normal,lightDir));
float dotNV=saturate(dot(normal,viewDir));
float dotNH=saturate(dot(normal,halfDir));
float dotVH=saturate(dot(viewDir,halfDir));
vec3 F=F_Schlick(f0,f90,dotVH);
float V=V_GGX_SmithCorrelated(alpha,dotNL,dotNV);
float D=D_GGX(alpha,dotNH);
return F*(V*D);
}
vec2 LTC_Uv(const in vec3 N,const in vec3 V,const in float roughness){
const float LUT_SIZE=64.0;
const float LUT_SCALE=(LUT_SIZE-1.0)/LUT_SIZE;
const float LUT_BIAS=0.5/LUT_SIZE;
float dotNV=saturate(dot(N,V));
vec2 uv=vec2(roughness,sqrt(1.0-dotNV));
uv=uv*LUT_SCALE+LUT_BIAS;
return uv;
}
float LTC_ClippedSphereFormFactor(const in vec3 f){
float l=length(f);
return max((l*l+f.z)/(l+1.0),0.0);
}
vec3 LTC_EdgeVectorFormFactor(const in vec3 v1,const in vec3 v2){
float x=dot(v1,v2);
float y=abs(x);
float a=0.8543985+(0.4965155+0.0145206*y)*y;
float b=3.4175940+(4.1616724+y)*y;
float v=a/b;
float theta_sintheta=(x>0.0)?v:0.5*inversesqrt(max(1.0-x*x,1e-7))-v;
return cross(v1,v2)*theta_sintheta;
}
vec3 LTC_Evaluate(const in vec3 N,const in vec3 V,const in vec3 P,const in mat3 mInv,const in vec3 rectCoords[4]){
vec3 v1=rectCoords[1]-rectCoords[0];
vec3 v2=rectCoords[3]-rectCoords[0];
vec3 lightNormal=cross(v1,v2);
if(dot(lightNormal,P-rectCoords[0])<0.0)return vec3(0.0);
vec3 T1,T2;
T1=normalize(V-N*dot(V,N));
T2=-cross(N,T1);
mat3 mat=mInv*transposeMat3(mat3(T1,T2,N));
vec3 coords[4];
coords[0]=mat*(rectCoords[0]-P);
coords[1]=mat*(rectCoords[1]-P);
coords[2]=mat*(rectCoords[2]-P);
coords[3]=mat*(rectCoords[3]-P);
coords[0]=normalize(coords[0]);
coords[1]=normalize(coords[1]);
coords[2]=normalize(coords[2]);
coords[3]=normalize(coords[3]);
vec3 vectorFormFactor=vec3(0.0);
vectorFormFactor+=LTC_EdgeVectorFormFactor(coords[0],coords[1]);
vectorFormFactor+=LTC_EdgeVectorFormFactor(coords[1],coords[2]);
vectorFormFactor+=LTC_EdgeVectorFormFactor(coords[2],coords[3]);
vectorFormFactor+=LTC_EdgeVectorFormFactor(coords[3],coords[0]);
float result=LTC_ClippedSphereFormFactor(vectorFormFactor);
return vec3(result);
}
vec2 integrateSpecularBRDF(const in float dotNV,const in float roughness){
const vec4 c0=vec4(-1,-0.0275,-0.572,0.022);
const vec4 c1=vec4(1,0.0425,1.04,-0.04);
vec4 r=roughness*c0+c1;
float a004=min(r.x*r.x,exp2(-9.28*dotNV))*r.x+r.y;
return vec2(-1.04,1.04)*a004+r.zw;
}
vec3 BRDF_Specular_GGX_Environment(const in vec3 viewDir,const in vec3 normal,const in vec3 specularColor,const in vec3 specularColor90,const in float roughness){
float dotNV=saturate(dot(normal,viewDir));
vec2 brdf=integrateSpecularBRDF(dotNV,roughness);
return specularColor*brdf.x+specularColor90*brdf.y;
}
#if defined(USE_SHEEN)
float D_Charlie(float roughness,float dotNH){
float alpha=pow2(roughness);
float invAlpha=1.0/alpha;
float cos2h=dotNH*dotNH;
float sin2h=max(1.0-cos2h,0.0078125);
return (2.0+invAlpha)*pow(sin2h,invAlpha*0.5)/(2.0*PI);
}
float V_Neubelt(float dotNV,float dotNL){
return saturate(1.0/(4.0*(dotNL+dotNV-dotNL*dotNV)));
}
vec3 BRDF_Sheen(const in vec3 lightDir,const in vec3 viewDir,const in vec3 normal,vec3 sheenColor,const in float sheenRoughness){
vec3 halfDir=normalize(lightDir+viewDir);
float dotNL=saturate(dot(normal,lightDir));
float dotNV=saturate(dot(normal,viewDir));
float dotNH=saturate(dot(normal,halfDir));
float D=D_Charlie(sheenRoughness,dotNH);
float V=V_Neubelt(dotNV,dotNL);
return sheenColor*(D*V);
}
#endif`,Dle=`#ifdef USE_BUMPMAP
uniform sampler2D bumpMap;
uniform float bumpScale;
vec2 dHdxy_fwd(){
vec2 dSTdx=dFdx(vUv);
vec2 dSTdy=dFdy(vUv);
float Hll=bumpScale*texture2D(bumpMap,vUv).x;
float dBx=bumpScale*texture2D(bumpMap,vUv+dSTdx).x-Hll;
float dBy=bumpScale*texture2D(bumpMap,vUv+dSTdy).x-Hll;
return vec2(dBx,dBy);
}
vec3 perturbNormalArb(vec3 surf_pos,vec3 surf_norm,vec2 dHdxy,float faceDirection){
vec3 vSigmaX=dFdx(surf_pos.xyz);
vec3 vSigmaY=dFdy(surf_pos.xyz);
vec3 vN=surf_norm;
vec3 R1=cross(vSigmaY,vN);
vec3 R2=cross(vN,vSigmaX);
float fDet=dot(vSigmaX,R1)*faceDirection;
vec3 vGrad=sign(fDet)*(dHdxy.x*R1+dHdxy.y*R2);
return normalize(abs(fDet)*surf_norm-vGrad);
}
#endif`,Ble=`#if NUM_CLIPPING_PLANES>0
vec4 plane;
#pragma unroll_loop
for (int i=0;i<UNION_CLIPPING_PLANES;i++){
plane=clippingPlanes[i];
if (dot(vClipPosition,plane.xyz)>plane.w)discard;
}
#if UNION_CLIPPING_PLANES<NUM_CLIPPING_PLANES
bool clipped=true;
#pragma unroll_loop
for (int i=UNION_CLIPPING_PLANES;i<NUM_CLIPPING_PLANES;i++){
plane=clippingPlanes[i];
clipped=(dot(vClipPosition,plane.xyz)>plane.w)&&clipped;
}
if (clipped)discard;
#endif
#endif`,Nle=`#if NUM_CLIPPING_PLANES>0
varying vec3 vClipPosition;
uniform vec4 clippingPlanes[NUM_CLIPPING_PLANES];
#endif`,Ole=`#if NUM_CLIPPING_PLANES>0
varying vec3 vClipPosition;
#endif`,kle=`#if NUM_CLIPPING_PLANES>0
vClipPosition=-mvPosition.xyz;
#endif`,Fle=`#if defined(USE_COLOR_ALPHA)
diffuseColor*=vColor;
#elif defined(USE_COLOR)
diffuseColor.rgb*=vColor;
#endif`,Vle=`#if defined(USE_COLOR_ALPHA)
varying vec4 vColor;
#elif defined(USE_COLOR)
varying vec3 vColor;
#endif`,Ule=`#if defined(USE_COLOR_ALPHA)
varying vec4 vColor;
#elif defined(USE_COLOR)||defined(USE_INSTANCING_COLOR)
varying vec3 vColor;
#endif`,zle=`#if defined(USE_COLOR_ALPHA)
vColor=vec4(1.0);
#elif defined(USE_COLOR)||defined(USE_INSTANCING_COLOR)
vColor=vec3(1.0);
#endif
#ifdef USE_COLOR
vColor*=color;
#endif
#ifdef USE_INSTANCING_COLOR
vColor.xyz*=instanceColor.xyz;
#endif`,Gle=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate(a)clamp(a,0.0,1.0)
#endif
float pow2(const in float x){return x*x;}
vec3 pow2(const in vec3 x){return x*x;}
float pow3(const in float x){return x*x*x;}
float pow4(const in float x){float x2=x*x;return x2*x2;}
float max3(const in vec3 v){return max(max(v.x,v.y),v.z);}
float average(const in vec3 v){return dot(v,vec3(0.3333333));}
highp float rand(const in vec2 uv){
const highp float a=12.9898,b=78.233,c=43758.5453;
highp float dt=dot(uv.xy,vec2(a,b)),sn=mod(dt,PI);
return fract(sin(sn)*c);
}
struct IncidentLight {
vec3 color;
vec3 direction;
bool visible;
};
struct ReflectedLight {
vec3 directDiffuse;
vec3 directSpecular;
vec3 indirectDiffuse;
vec3 indirectSpecular;
};
struct GeometricContext {
vec3 position;
vec3 normal;
vec3 viewDir;
vec3 probeNormal;
#ifdef USE_CLEARCOAT
vec3 clearcoatNormal;
#endif
};
vec3 transformDirection(in vec3 dir,in mat4 matrix){
return normalize((matrix*vec4(dir,0.0)).xyz);
}
vec3 inverseTransformDirection(in vec3 dir,in mat4 matrix){
return normalize((vec4(dir,0.0)*matrix).xyz);
}
mat3 transposeMat3(const in mat3 m){
mat3 tmp;
tmp[0]=vec3(m[0].x,m[1].x,m[2].x);
tmp[1]=vec3(m[0].y,m[1].y,m[2].y);
tmp[2]=vec3(m[0].z,m[1].z,m[2].z);
return tmp;
}
float linearToRelativeLuminance(const in vec3 color){
const vec3 weights=vec3(0.2126729,0.7151522,0.0721750);
return dot(weights,color.rgb);
}
bool isPerspectiveMatrix(mat4 m){
return m[2][3]==-1.0;
}
vec2 equirectUv(in vec3 dir){
float u=atan(dir.z,dir.x)*RECIPROCAL_PI2+0.5;
float v=asin(clamp(dir.y,-1.0,1.0))*RECIPROCAL_PI+0.5;
return vec2(u,v);
}
vec3 octUVToCubeVec(vec2 octUV,vec2 texelSize){
octUV=(1.0+2.0*texelSize)*octUV-texelSize;
octUV=octUV*2.0-1.0;
float x=octUV.x;
float z=-octUV.y;
float absX=abs(x);
float absZ=abs(z);
vec3 cubeVec=vec3(x,1.0-absX-absZ,z);
if (absX+absZ>1.0){
cubeVec.xz=-(vec2(absZ,absX)-1.0)*sign(vec2(x,z));
}
return cubeVec;
}
vec2 cubeVecToOctUV(vec3 cubeVec,vec2 texelSize){
cubeVec/=dot(vec3(1.0),abs(cubeVec));
vec2 octUV=vec2(cubeVec.x,-cubeVec.z);
if (cubeVec.y<0.0){
octUV=sign(octUV)*(1.0-abs(octUV.ts));
}
octUV=(octUV+1.0)/2.0;
octUV=(1.0-2.0*texelSize)*octUV+texelSize;
return octUV;
}
vec3 vec3RotateAxisAngle(vec3 vector,vec3 axis,float angle){
vec3 axisNorm=normalize(axis);
float x=axisNorm.x,y=axisNorm.y,z=axisNorm.z;
float s=sin(angle),c=cos(angle);
return mat3(x*x*(1.0-c)+c,x*y*(1.0-c)+z*s,x*z*(1.0-c)-y*s,x*y*(1.0-c)-z*s,y*y*(1.0-c)+c,y*z*(1.0-c)+x*s,x*z*(1.0-c)+y*s,y*z*(1.0-c)-x*s,z*z*(1.0-c)+c
)*vector;
}`,Hle=`#ifdef ENVMAP_TYPE_CUBE_UV
float getFace(vec3 direction){
vec3 absDirection=abs(direction);
float face=-1.0;
if (absDirection.x>absDirection.z){
if (absDirection.x>absDirection.y){
face=direction.x>0.0?0.0:3.0;
} else {
face=direction.y>0.0?1.0:4.0;
}
} else {
if (absDirection.z>absDirection.y){
face=direction.z>0.0?2.0:5.0;
} else {
face=direction.y>0.0?1.0:4.0;
}
}
return face;
}
vec2 getUV(vec3 direction,float face){
vec2 uv;
if (face==0.0){
uv=vec2(-direction.z,direction.y)/abs(direction.x);
} else if (face==1.0){
uv=vec2(direction.x,-direction.z)/abs(direction.y);
} else if (face==2.0){
uv=direction.xy/abs(direction.z);
} else if (face==3.0){
uv=vec2(direction.z,direction.y)/abs(direction.x);
} else if (face==4.0){
uv=direction.xz/abs(direction.y);
} else {
uv=vec2(-direction.x,direction.y)/abs(direction.z);
}
return 0.5*(uv+1.0);
}
#ifndef cubeUV_maxTileSize
#define cubeUV_maxTileSize 256.0
#endif
#define cubeUV_lodIdxMin 0.0
#define cubeUV_lodIdxLastDownscaled 4.0
#define cubeUV_lodIdxMax 10.0
#define cubeUV_minTileSize (cubeUV_maxTileSize/exp2(cubeUV_lodIdxLastDownscaled))
float getLodTileSize(float lodIdx){
return cubeUV_maxTileSize/exp2(min(lodIdx,cubeUV_lodIdxLastDownscaled));
}
float getLodFilterLevel(float lodIdx){
return max(lodIdx-cubeUV_lodIdxLastDownscaled,0.0);
}
vec2 fixCubeUVSeams(vec2 uv,float faceSize){
float BORDER_WIDTH_PX=max(cubeUV_maxTileSize/256.0-1.0,0.0);
float scale=(faceSize-BORDER_WIDTH_PX)/faceSize;
float offset=0.5*BORDER_WIDTH_PX/faceSize;
return uv*scale+offset;
}
vec2 getUVPixels(vec3 direction,float lodIdx){
float face=getFace(direction);
float faceSize=getLodTileSize(lodIdx);
float filterLevel=getLodFilterLevel(lodIdx);
vec2 uv=getUV(direction,face);
uv=fixCubeUVSeams(uv,faceSize);
uv*=(faceSize-1.0);
if (face>2.0){
uv.y+=faceSize;
face-=3.0;
}
uv.x+=face*faceSize;
if (lodIdx>0.0){
uv.y+=2.0*cubeUV_maxTileSize;
}
uv.y+=filterLevel*2.0*cubeUV_minTileSize;
uv.x+=3.0*max(0.0,cubeUV_maxTileSize-2.0*faceSize);
return uv;
}
vec3 bilinearCubeUV(sampler2D envMap,vec3 direction,float lodIdx){
float texelSize=1.0/(3.0*cubeUV_maxTileSize);
vec2 uv=getUVPixels(direction,lodIdx);
vec2 f=fract(uv);
uv+=0.5-f;
uv*=texelSize;
vec3 tl=texture2D(envMap,uv).rgb;
uv.x+=texelSize;
vec3 tr=texture2D(envMap,uv).rgb;
uv.y+=texelSize;
vec3 br=texture2D(envMap,uv).rgb;
uv.x-=texelSize;
vec3 bl=texture2D(envMap,uv).rgb;
vec3 tm=mix(tl,tr,f.x);
vec3 bm=mix(bl,br,f.x);
return mix(tm,bm,f.y);
}
vec3 sampleCubeUV(sampler2D envMap,vec3 direction,float lodIdx){
float texelSize=1.0/(3.0*cubeUV_maxTileSize);
vec2 uv=getUVPixels(direction,lodIdx);
uv+=0.5;
uv*=texelSize;
return texture2D(envMap,uv).rgb;
}
float roughnessToMip(float roughness){
float r=roughness;
float r2=r*r;
float r3=r2*r;
roughness=-1.20278049*r3+1.86860137*r2+0.32478081*r+0.0098139;
return roughness*(cubeUV_lodIdxMax-cubeUV_lodIdxMin);
}
vec4 textureCubeUV(sampler2D envMap,vec3 sampleDir,float roughness){
float lodIdx=clamp(roughnessToMip(roughness),cubeUV_lodIdxMin,cubeUV_lodIdxMax);
float lodIdxF=fract(lodIdx);
float lodIdxI=floor(lodIdx);
vec3 color0=sampleCubeUV(envMap,sampleDir,lodIdxI);
if (lodIdxF==0.0){
return vec4(color0,1.0);
} else {
vec3 color1=sampleCubeUV(envMap,sampleDir,lodIdxI+1.0);
return vec4(mix(color0,color1,lodIdxF),1.0);
}
}
#endif`,Wle=`vec3 transformedNormal=objectNormal;
#ifdef USE_INSTANCING
mat3 m=mat3(instanceMatrix);
transformedNormal/=vec3(dot(m[0],m[0]),dot(m[1],m[1]),dot(m[2],m[2]));
transformedNormal=m*transformedNormal;
#endif
transformedNormal=normalMatrix*transformedNormal;
#ifdef FLIP_SIDED
transformedNormal=-transformedNormal;
#endif
#ifdef USE_TANGENT
vec3 transformedTangent=(modelViewMatrix*vec4(objectTangent,0.0)).xyz;
#ifdef FLIP_SIDED
transformedTangent=-transformedTangent;
#endif
#endif`,jle=`#ifdef USE_DISPLACEMENTMAP
uniform sampler2D displacementMap;
uniform float displacementScale;
uniform float displacementBias;
#endif`,Qle=`#ifdef USE_DISPLACEMENTMAP
transformed+=normalize(objectNormal)*(texture2D(displacementMap,vUv).x*displacementScale+displacementBias);
#endif`,$le=`#ifdef USE_EMISSIVEMAP
vec4 emissiveColor=texture2D(emissiveMap,vUv);
totalEmissiveRadiance*=emissiveColor.rgb;
#endif`,Yle=`#ifdef USE_EMISSIVEMAP
uniform sampler2D emissiveMap;
#endif`,Xle="gl_FragColor=linearToOutputTexel(gl_FragColor);",qle=`vec4 LinearToLinear(in vec4 value){
return value;
}
vec4 LinearTosRGB(in vec4 value){
return vec4(mix(pow(value.rgb,vec3(0.41666))*1.055-vec3(0.055),value.rgb*12.92,vec3(lessThanEqual(value.rgb,vec3(0.0031308)))),value.a);
}`,Kle=`#ifdef USE_ENVMAP
#ifdef ENV_WORLDPOS
vec3 cameraToFrag;
if (isOrthographic){
cameraToFrag=normalize(vec3(-viewMatrix[0][2],-viewMatrix[1][2],-viewMatrix[2][2]));
} else {
cameraToFrag=normalize(vWorldPosition-cameraPosition);
}
vec3 worldNormal=inverseTransformDirection(normal,viewMatrix);
#ifdef ENVMAP_MODE_REFLECTION
vec3 reflectVec=reflect(cameraToFrag,worldNormal);
#else
vec3 reflectVec=refract(cameraToFrag,worldNormal,refractionRatio);
#endif
#else
vec3 reflectVec=vReflect;
#endif
#ifdef ENVMAP_TYPE_CUBE
vec4 envColor=textureCube(envMap,vec3(flipEnvMap*reflectVec.x,reflectVec.yz));
#else
vec4 envColor=vec4(0.0);
#endif
#ifdef ENVMAP_BLENDING_MULTIPLY
outgoingLight=mix(outgoingLight,outgoingLight*envColor.xyz,specularStrength*reflectivity);
#elif defined(ENVMAP_BLENDING_MIX)
outgoingLight=mix(outgoingLight,envColor.xyz,specularStrength*reflectivity);
#elif defined(ENVMAP_BLENDING_ADD)
outgoingLight+=envColor.xyz*specularStrength*reflectivity;
#endif
#endif`,Zle=`#ifdef USE_ENVMAP
uniform float envMapIntensity;
uniform float flipEnvMap;
#ifdef ENVMAP_TYPE_CUBE
uniform samplerCube envMap;
#else
uniform sampler2D envMap;
#endif
#if defined(ENVMAP_TYPE_CUBE)&&defined(NODE)||defined(ENVMAP_TYPE_CUBE_UV)
float calcGeometryRoughness(vec3 geometryNormal){
vec3 dxy=max(abs(dFdx(geometryNormal)),abs(dFdy(geometryNormal)));
return max(max(dxy.x,dxy.y),dxy.z);
}
float calcCubeUVAdjustedRoughness(float origRoughness,float geomRoughness){
return min(max(origRoughness,0.0525)+geomRoughness,1.0);
}
#endif
#endif`,Jle=`#ifdef USE_ENVMAP
uniform float reflectivity;
#if defined(USE_BUMPMAP)||defined(USE_NORMALMAP)||defined(LAMBERT)
#define ENV_WORLDPOS
#endif
#ifdef ENV_WORLDPOS
varying vec3 vWorldPosition;
uniform float refractionRatio;
#else
varying vec3 vReflect;
#endif
#endif`,ece=`#ifdef USE_ENVMAP
#if defined(USE_BUMPMAP)||defined(USE_NORMALMAP)||defined(LAMBERT)
#define ENV_WORLDPOS
#endif
#ifdef ENV_WORLDPOS
varying vec3 vWorldPosition;
#else
varying vec3 vReflect;
uniform float refractionRatio;
#endif
#endif`,tce=`#ifdef USE_ENVMAP
#ifdef ENV_WORLDPOS
vWorldPosition=worldPosition.xyz;
#else
vec3 cameraToVertex;
if (isOrthographic){
cameraToVertex=normalize(vec3(-viewMatrix[0][2],-viewMatrix[1][2],-viewMatrix[2][2]));
} else {
cameraToVertex=normalize(worldPosition.xyz-cameraPosition);
}
vec3 worldNormal=inverseTransformDirection(transformedNormal,viewMatrix);
#ifdef ENVMAP_MODE_REFLECTION
vReflect=reflect(cameraToVertex,worldNormal);
#else
vReflect=refract(cameraToVertex,worldNormal,refractionRatio);
#endif
#endif
#endif`,nce=`#ifdef USE_FOG
vFogDepth=-mvPosition.z;
#endif`,rce=`#ifdef USE_FOG
varying float vFogDepth;
#endif`,oce=`#ifdef USE_FOG
#ifdef FOG_EXP2
float fogFactor=1.0-exp(-fogDensity*fogDensity*vFogDepth*vFogDepth);
#else
float fogFactor=smoothstep(fogNear,fogFar,vFogDepth);
#endif
gl_FragColor.rgb=mix(gl_FragColor.rgb,fogColor,fogFactor);
#endif`,ice=`#ifdef USE_FOG
uniform vec3 fogColor;
varying float vFogDepth;
#ifdef FOG_EXP2
uniform float fogDensity;
#else
uniform float fogNear;
uniform float fogFar;
#endif
#endif`,ace=`#ifdef USE_LIGHTMAP
vec4 lightMapTexel=texture2D(lightMap,vUv2);
vec3 lightMapIrradiance=lightMapTexel.rgb*lightMapIntensity;
reflectedLight.indirectDiffuse+=lightMapIrradiance;
#endif`,sce=`#ifdef USE_LIGHTMAP
uniform sampler2D lightMap;
uniform float lightMapIntensity;
#endif`,lce=`LambertMaterial material;
material.diffuseColor=diffuseColor.rgb;
material.specularStrength=specularStrength;`,cce=`varying vec3 vViewPosition;
struct LambertMaterial {
vec3 diffuseColor;
float specularStrength;
};
void RE_Direct_Lambert(const in IncidentLight directLight,const in GeometricContext geometry,const in LambertMaterial material,inout ReflectedLight reflectedLight){
float dotNL=saturate(dot(geometry.normal,directLight.direction));
vec3 irradiance=dotNL*directLight.color;
reflectedLight.directDiffuse+=irradiance*BRDF_Lambert(material.diffuseColor);
}
void RE_IndirectDiffuse_Lambert(const in vec3 irradiance,const in GeometricContext geometry,const in LambertMaterial material,inout ReflectedLight reflectedLight){
reflectedLight.indirectDiffuse+=irradiance*BRDF_Lambert(material.diffuseColor);
}
#define RE_Direct RE_Direct_Lambert
#define RE_IndirectDiffuse RE_IndirectDiffuse_Lambert`,uce=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[9];
vec3 shGetIrradianceAt(in vec3 normal,in vec3 shCoefficients[9]){
float x=normal.x,y=normal.y,z=normal.z;
vec3 result=shCoefficients[0]*0.886227;
result+=shCoefficients[1]*2.0*0.511664*y;
result+=shCoefficients[2]*2.0*0.511664*z;
result+=shCoefficients[3]*2.0*0.511664*x;
result+=shCoefficients[4]*2.0*0.429043*x*y;
result+=shCoefficients[5]*2.0*0.429043*y*z;
result+=shCoefficients[6]*(0.743125*z*z-0.247708);
result+=shCoefficients[7]*2.0*0.429043*x*z;
result+=shCoefficients[8]*0.429043*(x*x-y*y);
return result;
}
vec3 getLightProbeIrradiance(const in vec3 lightProbe[9],const in vec3 normal){
vec3 worldNormal=inverseTransformDirection(normal,viewMatrix);
vec3 irradiance=shGetIrradianceAt(worldNormal,lightProbe);
return irradiance;
}
vec3 getAmbientLightIrradiance(const in vec3 ambientLightColor){
vec3 irradiance=ambientLightColor;
return irradiance;
}
float getDistanceAttenuation(float lightDistance,const in float cutoffDistance,const in float decayExponent){
lightDistance=UNITS_SCALE_FACTOR*lightDistance;
#ifdef MT_MAYA
float distanceFalloff=1.0/pow(lightDistance+1.0,decayExponent);
#else
float distanceFalloff=1.0/max(pow(lightDistance,decayExponent),0.01);
#endif
if (cutoffDistance>0.0){
distanceFalloff*=pow2(saturate(1.0-pow4(lightDistance/(UNITS_SCALE_FACTOR*cutoffDistance))));
}
return distanceFalloff;
}
float getSpotAttenuation(const in float coneCosine,const in float penumbraCosine,const in float angleCosine){
return smoothstep(coneCosine,penumbraCosine,angleCosine);
}
#if NUM_DIR_LIGHTS>0
struct DirectionalLight {
vec3 direction;
vec3 color;
};
uniform DirectionalLight directionalLights[NUM_DIR_LIGHTS];
void getDirectionalLightInfo(const in DirectionalLight directionalLight,const in GeometricContext geometry,out IncidentLight light){
light.color=directionalLight.color;
light.direction=directionalLight.direction;
light.visible=true;
}
#endif
#if NUM_POINT_LIGHTS>0
struct PointLight {
vec3 position;
vec3 color;
float distance;
float decay;
};
uniform PointLight pointLights[NUM_POINT_LIGHTS];
void getPointLightInfo(const in PointLight pointLight,const in GeometricContext geometry,out IncidentLight light){
vec3 lVector=pointLight.position-geometry.position;
light.direction=normalize(lVector);
float lightDistance=length(lVector);
light.color=pointLight.color;
light.color*=getDistanceAttenuation(lightDistance,pointLight.distance,pointLight.decay);
light.visible=(light.color != vec3(0.0));
}
#endif
#if NUM_SPOT_LIGHTS>0
struct SpotLight {
vec3 position;
vec3 direction;
vec3 color;
float distance;
float decay;
float coneCos;
float penumbraCos;
};
uniform SpotLight spotLights[NUM_SPOT_LIGHTS];
void getSpotLightInfo(const in SpotLight spotLight,const in GeometricContext geometry,out IncidentLight light){
vec3 lVector=spotLight.position-geometry.position;
light.direction=normalize(lVector);
float angleCos=dot(light.direction,spotLight.direction);
#if defined(MT_MAX)
float coneCosDecayed=2.0*spotLight.coneCos-spotLight.penumbraCos;
if (angleCos>coneCosDecayed){
float spotAttenuation=pow(max(angleCos,0.0),log(0.5)/log(spotLight.penumbraCos)-1.0);
if (angleCos<spotLight.coneCos){
float decayFac=1.0+(spotLight.coneCos-angleCos)
/ (spotLight.coneCos-spotLight.penumbraCos);
spotAttenuation*=pow2(decayFac)*(3.0-2.0*decayFac);
}
float lightDistance=length(lVector);
light.color=spotLight.color*spotAttenuation;
light.color*=getDistanceAttenuation(lightDistance,spotLight.distance,spotLight.decay);
light.visible=true;
} else {
light.color=vec3(0.0);
light.visible=false;
}
#else
float spotAttenuation=getSpotAttenuation(spotLight.coneCos,spotLight.penumbraCos,angleCos);
if (spotAttenuation>0.0){
float lightDistance=length(lVector);
light.color=spotLight.color*spotAttenuation;
light.color*=getDistanceAttenuation(lightDistance,spotLight.distance,spotLight.decay);
light.visible=true;
} else {
light.color=vec3(0.0);
light.visible=false;
}
#endif
}
#endif
#if NUM_RECT_AREA_LIGHTS>0
struct RectAreaLight {
vec3 color;
vec3 position;
vec3 halfWidth;
vec3 halfHeight;
};
uniform sampler2D ltc_1;
uniform sampler2D ltc_2;
uniform RectAreaLight rectAreaLights[NUM_RECT_AREA_LIGHTS];
#endif
#if NUM_HEMI_LIGHTS>0
struct HemisphereLight {
vec3 direction;
vec3 skyColor;
vec3 groundColor;
};
uniform HemisphereLight hemisphereLights[NUM_HEMI_LIGHTS];
vec3 getHemisphereLightIrradiance(const in HemisphereLight hemiLight,const in vec3 normal){
float dotNL=dot(normal,hemiLight.direction);
float hemiDiffuseWeight=0.5*dotNL+0.5;
vec3 irradiance=mix(hemiLight.groundColor,hemiLight.skyColor,hemiDiffuseWeight);
return irradiance;
}
#endif`,dce=`#if defined(USE_ENVMAP)
#define ENVMAP_PARALLAX_INFINITE 0
#define ENVMAP_PARALLAX_SPHERE 1
#define ENVMAP_PARALLAX_BOX 2
uniform int envMapParallaxType;
uniform mat4 envMapParallaxMatrix;
uniform mat4 envMapParallaxMatrixInv;
vec3 correctParallax(vec3 directionVecWorld,vec3 posWorld,int parallaxType){
vec3 posProbe=(envMapParallaxMatrix*vec4(posWorld,1.0)).xyz;
vec3 reflectVecProbe=transformDirection(directionVecWorld,envMapParallaxMatrix);
if (parallaxType==ENVMAP_PARALLAX_SPHERE){
float b=2.0*dot(reflectVecProbe,posProbe);
float c=dot(posProbe,posProbe)-1.0;
float D=b*b-4.0*c;
if (D>=0.0){
float x=(sqrt(D)-b)/2.0;
reflectVecProbe=posProbe+x*reflectVecProbe;
}
} else if (parallaxType==ENVMAP_PARALLAX_BOX){
vec3 scalePos=(vec3(1.0)-posProbe)/reflectVecProbe;
vec3 scaleNeg=(vec3(-1.0)-posProbe)/reflectVecProbe;
vec3 scalePosNeg=mix(scaleNeg,scalePos,step(vec3(0.0),reflectVecProbe));
float x=min(scalePosNeg.x,min(scalePosNeg.y,scalePosNeg.z));
reflectVecProbe=posProbe+x*reflectVecProbe;
}
vec3 directionVecWorldCorrected=transformDirection(reflectVecProbe,envMapParallaxMatrixInv);
return directionVecWorldCorrected;
}
vec3 getIBLIrradiance(const in vec3 normal){
#if defined(ENVMAP_TYPE_CUBE_UV)
vec3 worldNormal=inverseTransformDirection(normal,viewMatrix);
vec4 envMapColor=textureCubeUV(envMap,worldNormal,1.0);
return PI*envMapColor.rgb*envMapIntensity;
#else
return vec3(0.0);
#endif
}
vec3 getIBLRadiance(const in vec3 viewDir,const in vec3 normal,const in float roughness,vec3 position){
#if defined(ENVMAP_TYPE_CUBE_UV)
vec3 reflectVec=reflect(-viewDir,normal);
reflectVec=inverseTransformDirection(reflectVec,viewMatrix);
if (envMapParallaxType != ENVMAP_PARALLAX_INFINITE){
vec3 posWorld=(invViewMatrix*vec4(position,1.0)).xyz;
reflectVec=correctParallax(reflectVec,posWorld,envMapParallaxType);
}
vec4 envMapColor=textureCubeUV(envMap,reflectVec,roughness);
return envMapColor.rgb*envMapIntensity;
#else
return vec3(0.0);
#endif
}
vec3 getIBLRefraction(const in vec3 viewDir,const in vec3 normal,const in float roughness,const float refrRatio,vec3 position){
#if defined(ENVMAP_TYPE_CUBE_UV)
vec3 refractVec=refract(-viewDir,normal,refrRatio);
refractVec=inverseTransformDirection(refractVec,viewMatrix);
if (envMapParallaxType != ENVMAP_PARALLAX_INFINITE){
vec3 posWorld=(invViewMatrix*vec4(position,1.0)).xyz;
refractVec=correctParallax(refractVec,posWorld,envMapParallaxType);
}
vec4 envMapColor=textureCubeUV(envMap,refractVec,roughness);
return envMapColor.rgb*envMapIntensity;
#else
return vec3(0.0);
#endif
}
#endif`,fce=`PhysicalMaterial material;
material.diffuseColor=diffuseColor.rgb*(1.0-metalnessFactor);
vec3 dxy=max(abs(dFdx(geometryNormal)),abs(dFdy(geometryNormal)));
float geometryRoughness=max(max(dxy.x,dxy.y),dxy.z);
material.roughness=max(roughnessFactor,0.0525);
material.roughness+=geometryRoughness;
material.roughness=min(material.roughness,1.0);
#ifdef IOR
material.ior=ior;
#ifdef SPECULAR
float specularIntensityFactor=specularIntensity;
vec3 specularColorFactor=specularColor;
#ifdef USE_SPECULARINTENSITYMAP
specularIntensityFactor*=texture2D(specularIntensityMap,vUv).a;
#endif
#ifdef USE_SPECULARCOLORMAP
specularColorFactor*=texture2D(specularColorMap,vUv).rgb;
#endif
material.specularF90=mix(specularIntensityFactor,1.0,metalnessFactor);
#else
float specularIntensityFactor=1.0;
vec3 specularColorFactor=vec3(1.0);
material.specularF90=1.0;
#endif
material.specularColor=mix(min(pow2((material.ior-1.0)/(material.ior+1.0))*specularColorFactor,vec3(1.0))*specularIntensityFactor,diffuseColor.rgb,metalnessFactor);
#else
material.specularColor=mix(vec3(0.04),diffuseColor.rgb,metalnessFactor);
material.specularF90=1.0;
#endif
#ifdef USE_CLEARCOAT
material.clearcoat=clearcoat;
material.clearcoatRoughness=clearcoatRoughness;
material.clearcoatF0=vec3(0.04);
material.clearcoatF90=1.0;
#ifdef USE_CLEARCOATMAP
material.clearcoat*=texture2D(clearcoatMap,vUv).x;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
material.clearcoatRoughness*=texture2D(clearcoatRoughnessMap,vUv).y;
#endif
material.clearcoat=saturate(material.clearcoat);
material.clearcoatRoughness=max(material.clearcoatRoughness,0.0525);
material.clearcoatRoughness+=geometryRoughness;
material.clearcoatRoughness=min(material.clearcoatRoughness,1.0);
#endif`,hce=`struct PhysicalMaterial {
vec3 diffuseColor;
float roughness;
vec3 specularColor;
float specularF90;
#ifdef USE_CLEARCOAT
float clearcoat;
float clearcoatRoughness;
vec3 clearcoatF0;
float clearcoatF90;
#endif
#ifdef IOR
float ior;
#endif
#ifdef USE_TRANSMISSION
float transmission;
float transmissionAlpha;
float thickness;
float attenuationDistance;
vec3 attenuationColor;
#endif
};
vec3 clearcoatSpecular=vec3(0.0);
vec2 DFGApprox(const in vec3 normal,const in vec3 viewDir,const in float roughness){
float dotNV=saturate(dot(normal,viewDir));
const vec4 c0=vec4(- 1,-0.0275,-0.572,0.022);
const vec4 c1=vec4(1,0.0425,1.04,-0.04);
vec4 r=roughness*c0+c1;
float a004=min(r.x*r.x,exp2(- 9.28*dotNV))*r.x+r.y;
vec2 fab=vec2(- 1.04,1.04)*a004+r.zw;
return fab;
}
vec3 EnvironmentBRDF(const in vec3 normal,const in vec3 viewDir,const in vec3 specularColor,const in float specularF90,const in float roughness){
vec2 fab=DFGApprox(normal,viewDir,roughness);
return specularColor*fab.x+specularF90*fab.y;
}
void computeMultiscattering(const in vec3 normal,const in vec3 viewDir,const in vec3 specularColor,const in float specularF90,const in float roughness,inout vec3 singleScatter,inout vec3 multiScatter){
vec2 fab=DFGApprox(normal,viewDir,roughness);
vec3 Fr=specularColor;
vec3 FssEss=Fr*fab.x+specularF90*fab.y;
float Ess=fab.x+fab.y;
float Ems=1.0-Ess;
vec3 Favg=Fr+(1.0-Fr)*0.047619;
vec3 Fms=FssEss*Favg/(1.0-Ems*Favg);
singleScatter+=FssEss;
multiScatter+=Fms*Ems;
}
#if NUM_RECT_AREA_LIGHTS>0
void RE_Direct_RectArea_Physical(const in RectAreaLight rectAreaLight,const in GeometricContext geometry,const in PhysicalMaterial material,inout ReflectedLight reflectedLight){
vec3 normal=geometry.normal;
vec3 viewDir=geometry.viewDir;
vec3 position=geometry.position;
vec3 lightPos=rectAreaLight.position;
vec3 halfWidth=rectAreaLight.halfWidth;
vec3 halfHeight=rectAreaLight.halfHeight;
vec3 lightColor=rectAreaLight.color;
float roughness=material.roughness;
vec3 rectCoords[4];
rectCoords[0]=lightPos+halfWidth-halfHeight;
rectCoords[1]=lightPos-halfWidth-halfHeight;
rectCoords[2]=lightPos-halfWidth+halfHeight;
rectCoords[3]=lightPos+halfWidth+halfHeight;
vec2 uv=LTC_Uv(normal,viewDir,roughness);
vec4 t1=texture2D(ltc_1,uv);
vec4 t2=texture2D(ltc_2,uv);
mat3 mInv=mat3(vec3(t1.x,0,t1.y),vec3( 0,1,0),vec3(t1.z,0,t1.w)
);
vec3 fresnel=(material.specularColor*t2.x+(vec3(1.0)-material.specularColor)*t2.y);
reflectedLight.directSpecular+=lightColor*fresnel*LTC_Evaluate(normal,viewDir,position,mInv,rectCoords);
reflectedLight.directDiffuse+=lightColor*material.diffuseColor*LTC_Evaluate(normal,viewDir,position,mat3(1.0),rectCoords);
}
#endif
void RE_Direct_Physical(const in IncidentLight directLight,const in GeometricContext geometry,const in PhysicalMaterial material,inout ReflectedLight reflectedLight){
float dotNL=saturate(dot(geometry.normal,directLight.direction));
vec3 irradiance=dotNL*directLight.color;
#ifdef USE_CLEARCOAT
float dotNLcc=saturate(dot(geometry.clearcoatNormal,directLight.direction));
vec3 ccIrradiance=dotNLcc*directLight.color;
clearcoatSpecular+=ccIrradiance*BRDF_GGX(directLight.direction,geometry.viewDir,geometry.clearcoatNormal,material.clearcoatF0,material.clearcoatF90,material.clearcoatRoughness);
#endif
reflectedLight.directSpecular+=irradiance*BRDF_GGX(directLight.direction,geometry.viewDir,geometry.normal,material.specularColor,material.specularF90,material.roughness);
reflectedLight.directDiffuse+=irradiance*BRDF_Lambert(material.diffuseColor);
}
void RE_IndirectDiffuse_Physical(const in vec3 irradiance,const in GeometricContext geometry,const in PhysicalMaterial material,inout ReflectedLight reflectedLight){
reflectedLight.indirectDiffuse+=irradiance*BRDF_Lambert(material.diffuseColor);
}
void RE_IndirectSpecular_Physical(const in vec3 radiance,const in vec3 irradiance,const in vec3 clearcoatRadiance,const in GeometricContext geometry,const in PhysicalMaterial material,inout ReflectedLight reflectedLight){
#ifdef USE_CLEARCOAT
clearcoatSpecular+=clearcoatRadiance*EnvironmentBRDF(geometry.clearcoatNormal,geometry.viewDir,material.clearcoatF0,material.clearcoatF90,material.clearcoatRoughness);
#endif
vec3 singleScattering=vec3(0.0);
vec3 multiScattering=vec3(0.0);
vec3 cosineWeightedIrradiance=irradiance*RECIPROCAL_PI;
computeMultiscattering(geometry.normal,geometry.viewDir,material.specularColor,material.specularF90,material.roughness,singleScattering,multiScattering);
vec3 totalScattering=singleScattering+multiScattering;
vec3 diffuse=material.diffuseColor*(1.0-max(max(totalScattering.r,totalScattering.g),totalScattering.b));
reflectedLight.indirectSpecular+=radiance*singleScattering;
reflectedLight.indirectSpecular+=multiScattering*cosineWeightedIrradiance;
reflectedLight.indirectDiffuse+=diffuse*cosineWeightedIrradiance;
}
#define RE_Direct RE_Direct_Physical
#define RE_Direct_RectArea RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular RE_IndirectSpecular_Physical
float computeSpecularOcclusion(const in float dotNV,const in float ambientOcclusion,const in float roughness){
return saturate(pow(abs(dotNV+ambientOcclusion),exp2(- 16.0*roughness-1.0))-1.0+ambientOcclusion);
}`,pce=`
GeometricContext geometry;
geometry.position=-vViewPosition;
geometry.normal=normal;
geometry.viewDir=(isOrthographic)?vec3(0,0,1):normalize(vViewPosition);
#ifdef USE_CLEARCOAT
geometry.clearcoatNormal=clearcoatNormal;
#endif
#ifdef PROBE_NORMAL
geometry.probeNormal=PROBE_NORMAL;
#else
geometry.probeNormal=normal;
#endif
IncidentLight directLight;
#if (NUM_POINT_LIGHTS>0)&&defined(RE_Direct)
PointLight pointLight;
#if defined(USE_SHADOWMAP)&&NUM_POINT_LIGHT_SHADOWS>0
PointLightShadow pointLightShadow;
#endif
#pragma unroll_loop
for (int i=0;i<NUM_POINT_LIGHTS;i++){
pointLight=pointLights[i];
getPointLightInfo(pointLight,geometry,directLight);
#if defined(USE_SHADOWMAP)&&((i)<NUM_POINT_LIGHT_SHADOWS)
pointLightShadow=pointLightShadows[i];
directLight.color*=(directLight.visible&&receiveShadow)?getPointShadow(pointLightShadow,pointShadowMap[i],vPointShadowCoord[i]):1.0;
#endif
RE_Direct(directLight,geometry,material,reflectedLight);
}
#endif
#if (NUM_SPOT_LIGHTS>0)&&defined(RE_Direct)
SpotLight spotLight;
#if defined(USE_SHADOWMAP)&&NUM_SPOT_LIGHT_SHADOWS>0
SpotLightShadow spotLightShadow;
#endif
#pragma unroll_loop
for (int i=0;i<NUM_SPOT_LIGHTS;i++){
spotLight=spotLights[i];
getSpotLightInfo(spotLight,geometry,directLight);
#if defined(USE_SHADOWMAP)&&((i)<NUM_SPOT_LIGHT_SHADOWS)
spotLightShadow=spotLightShadows[i];
if (directLight.visible&&receiveShadow){
if (spotLightShadow.shadow==1){
float distWorld=0.0;
#if defined(SHADOWMAP_TYPE_ESM)
distWorld=length((invViewMatrix*vec4(spotLight.position
- geometry.position,0.0)).xyz);
#endif
directLight.color*=getSpotShadow(spotLightShadow,spotShadowMap[i],vSpotShadowCoord[i],distWorld);
} else if (spotLightShadow.shadow==2){
directLight.color*=getSpotOmniShadow(spotLightShadow,spotShadowMap[i],vSpotShadowCoord[i]);
}
}
#endif
RE_Direct(directLight,geometry,material,reflectedLight);
}
#endif
#if (NUM_DIR_LIGHTS>0)&&defined(RE_Direct)
DirectionalLight directionalLight;
#if defined(USE_SHADOWMAP)&&NUM_DIR_LIGHT_SHADOWS_CSM>0
DirectionalLightShadowCSM directionalLightShadowCSM;
DirectionalLightShadowCascade dirShadowCascade;
vec2 cascade;
float cascadeCenter;
float closestEdge;
float margin;
float csmx,csmy;
float linearDepth;
int maxCascadeIdx;
#pragma unroll_loop
for (int i=0;i<NUM_DIR_LIGHT_SHADOW_CASCADES_CSM;i++){
dirShadowCascade=directionalLightShadowsCSMCascade[i];
#if defined(LUT_DIR_LIGHT_SHADOWS_CSM)
directionalLightShadowCSM=directionalLightShadowsCSM[LUT_DIR_LIGHT_SHADOWS_CSM[i]];
directionalLight=directionalLights[LUT_DIR_LIGHT_SHADOWS_CSM[i]];
getDirectionalLightInfo(directionalLight,geometry,directLight);
#else
if (dirShadowCascade.csmIdx==0){
directionalLightShadowCSM=directionalLightShadowsCSM[0];
directionalLight=directionalLights[0];
getDirectionalLightInfo(directionalLight,geometry,directLight);
}
#if NUM_DIR_LIGHT_SHADOWS_CSM>=2
else if (dirShadowCascade.csmIdx==1){
directionalLightShadowCSM=directionalLightShadowsCSM[1];
directionalLight=directionalLights[1];
getDirectionalLightInfo(directionalLight,geometry,directLight);
}
#endif
#if NUM_DIR_LIGHT_SHADOWS_CSM>=3
else if (dirShadowCascade.csmIdx==2){
directionalLightShadowCSM=directionalLightShadowsCSM[2];
directionalLight=directionalLights[2];
getDirectionalLightInfo(directionalLight,geometry,directLight);
}
#endif
#if NUM_DIR_LIGHT_SHADOWS_CSM>=4
else if (dirShadowCascade.csmIdx==3){
directionalLightShadowCSM=directionalLightShadowsCSM[3];
directionalLight=directionalLights[3];
getDirectionalLightInfo(directionalLight,geometry,directLight);
}
#endif
#if NUM_DIR_LIGHT_SHADOWS_CSM>=5
else if (dirShadowCascade.csmIdx==4){
directionalLightShadowCSM=directionalLightShadowsCSM[4];
directionalLight=directionalLights[4];
getDirectionalLightInfo(directionalLight,geometry,directLight);
}
#endif
#endif
maxCascadeIdx=directionalLightShadowCSM.cascadeIdxEnd;
linearDepth=(vViewPosition.z)/(directionalLightShadowCSM.shadowFar-directionalLightShadowCSM.cameraNear);
cascade=dirShadowCascade.cascade;
#if (i)<NUM_DIR_LIGHT_SHADOWS_CSM_WITH_FADE
cascadeCenter=(cascade.x+cascade.y)/2.0;
closestEdge=linearDepth<cascadeCenter?cascade.x:cascade.y;
margin=directionalLightShadowCSM.fade*pow(closestEdge,2.0);
csmx=cascade.x-margin/2.0;
csmy=cascade.y+margin/2.0;
if (linearDepth>=csmx&&(linearDepth<csmy||(i)==maxCascadeIdx-1)){
float dist=min(linearDepth-csmx,csmy-linearDepth);
float ratio=clamp(dist/margin,0.0,1.0);
vec3 prevColor=directLight.color;
float distWorld=0.0;
#if defined(SHADOWMAP_TYPE_ESM)
distWorld=length((invViewMatrix*vec4(dirShadowCascade.position
- directionalLight.direction*dirShadowCascade.shadowCameraNear
- geometry.position,0.0)).xyz);
#endif
directLight.color*=(directLight.visible&&receiveShadow)?
getDirShadowCSM(dirShadowCascade,directionalShadowCSMMap[i],vDirectionalShadowCSMCoord[i],distWorld)
: 1.0;
bool shouldFadeLastCascade=(i)==maxCascadeIdx-1&&linearDepth>cascadeCenter;
directLight.color=mix(prevColor,directLight.color,shouldFadeLastCascade?ratio:1.0);
ReflectedLight prevLight=reflectedLight;
RE_Direct(directLight,geometry,material,reflectedLight);
bool shouldBlend=(i)!= maxCascadeIdx-1||((i)==maxCascadeIdx-1&&linearDepth<cascadeCenter);
float blendRatio=shouldBlend?ratio:1.0;
reflectedLight.directDiffuse=mix(prevLight.directDiffuse,reflectedLight.directDiffuse,blendRatio);
reflectedLight.directSpecular=mix(prevLight.directSpecular,reflectedLight.directSpecular,blendRatio);
reflectedLight.indirectDiffuse=mix(prevLight.indirectDiffuse,reflectedLight.indirectDiffuse,blendRatio);
reflectedLight.indirectSpecular=mix(prevLight.indirectSpecular,reflectedLight.indirectSpecular,blendRatio);
}
#else
if (linearDepth>=cascade.x&&(linearDepth<cascade.y||(i)==maxCascadeIdx-1)){
if (directLight.visible&&receiveShadow){
float distWorld=0.0;
#if defined(SHADOWMAP_TYPE_ESM)
distWorld=length((invViewMatrix*vec4(dirShadowCascade.position
- directionalLight.direction*dirShadowCascade.shadowCameraNear
- geometry.position,0.0)).xyz);
#endif
directLight.color*=getDirShadowCSM(dirShadowCascade,directionalShadowCSMMap[i],vDirectionalShadowCSMCoord[i],distWorld);
}
RE_Direct(directLight,geometry,material,reflectedLight);
}
#endif
}
#endif
#pragma unroll_loop
for (int i=NUM_DIR_LIGHT_SHADOWS_CSM;i<NUM_DIR_LIGHTS;i++){
directionalLight=directionalLights[i];
getDirectionalLightInfo(directionalLight,geometry,directLight);
RE_Direct(directLight,geometry,material,reflectedLight);
}
#endif
#if (NUM_RECT_AREA_LIGHTS>0)&&defined(RE_Direct_RectArea)
RectAreaLight rectAreaLight;
#if defined(USE_SHADOWMAP)&&NUM_RECT_AREA_LIGHT_SHADOWS>0
RectAreaLightShadow rectAreaLightShadow;
#endif
#pragma unroll_loop
for (int i=0;i<NUM_RECT_AREA_LIGHTS;i++){
rectAreaLight=rectAreaLights[i];
#if defined(USE_SHADOWMAP)&&((i)<NUM_RECT_AREA_LIGHT_SHADOWS)
rectAreaLightShadow=rectAreaLightShadows[i];
rectAreaLight.color*=receiveShadow ?
getRectAreaShadow(rectAreaLightShadow,rectAreaShadowMap[i],vRectAreaShadowCoord[i]):1.0;
#endif
RE_Direct_RectArea(rectAreaLight,geometry,material,reflectedLight);
}
#endif
#if defined(RE_IndirectDiffuse)
vec3 iblIrradiance=vec3(0.0);
vec3 irradiance=getAmbientLightIrradiance(ambientLightColor);
irradiance+=getLightProbeIrradiance(lightProbe,geometry.probeNormal);
#if (NUM_HEMI_LIGHTS>0)
#pragma unroll_loop
for (int i=0;i<NUM_HEMI_LIGHTS;i++){
irradiance+=getHemisphereLightIrradiance(hemisphereLights[i],geometry.probeNormal);
}
#endif
#endif
#if defined(RE_IndirectSpecular)
vec3 radiance=vec3(0.0);
vec3 clearcoatRadiance=vec3(0.0);
#endif
#if defined(RE_Refraction)
vec3 refraction=vec3(0.0);
#endif`,mce=`#if defined(RE_IndirectDiffuse)
#ifdef USE_LIGHTMAP
vec4 lightMapTexel=texture2D(lightMap,vUv2);
vec3 lightMapIrradiance=lightMapTexel.rgb*lightMapIntensity;
irradiance+=lightMapIrradiance;
#endif
#if defined(USE_ENVMAP)&&(defined(STANDARD)||defined(NODE))&&defined(ENVMAP_TYPE_CUBE_UV)
iblIrradiance+=getIBLIrradiance(geometry.probeNormal);
#endif
#endif
#if defined(USE_ENVMAP)&&defined(RE_IndirectSpecular)
radiance+=getIBLRadiance(geometry.viewDir,geometry.normal,material.roughness,geometry.position);
#if defined(USE_SSR)&&!defined(USE_SSR_REFRACT)
radiance=computeSSR(radiance,geometry.normal,0.0);
#endif
#if defined(USE_PLANE_REFLECTION)
radiance=computePlaneReflection(radiance,material.roughness,geometry.position,geometry.normal,modelMatrix);
#endif
#ifdef USE_CLEARCOAT
clearcoatRadiance+=getIBLRadiance(geometry.viewDir,geometry.clearcoatNormal,material.clearcoatRoughness,geometry.position);
#endif
#endif
#if defined(USE_ENVMAP)&&defined(RE_Refraction)
refraction+=getIBLRefraction(geometry.viewDir,geometry.normal,material.refractionRoughness,1.0/material.refractionIOR,geometry.position);
#ifdef USE_SSR_REFRACT
refraction=computeSSR(refraction,geometry.normal,material.refractionIOR);
#endif
#endif`,gce=`#if defined(RE_IndirectDiffuse)
#ifdef NODE
irradiance+=iblIrradiance;
#endif
RE_IndirectDiffuse(irradiance,geometry,material,reflectedLight);
#endif
#if defined(RE_IndirectSpecular)
RE_IndirectSpecular(radiance,iblIrradiance,clearcoatRadiance,geometry,material,reflectedLight);
#endif
#if defined(RE_Refraction)
RE_Refraction(refraction,material,refractedLight);
#endif`,_ce=`#if defined(USE_LOGDEPTHBUF)&&defined(USE_LOGDEPTHBUF_EXT)
gl_FragDepthEXT=vIsPerspective==0.0?gl_FragCoord.z:log2(vFragDepth)*logDepthBufFC*0.5;
#endif`,vce=`#if defined(USE_LOGDEPTHBUF)&&defined(USE_LOGDEPTHBUF_EXT)
uniform float logDepthBufFC;
varying float vFragDepth;
varying float vIsPerspective;
#endif`,Ace=`#ifdef USE_LOGDEPTHBUF
#ifdef USE_LOGDEPTHBUF_EXT
varying float vFragDepth;
varying float vIsPerspective;
#else
uniform float logDepthBufFC;
#endif
#endif`,yce=`#ifdef USE_LOGDEPTHBUF
#ifdef USE_LOGDEPTHBUF_EXT
vFragDepth=1.0+gl_Position.w;
vIsPerspective=float(isPerspectiveMatrix(projectionMatrix));
#else
if (isPerspectiveMatrix(projectionMatrix)){
gl_Position.z=log2(max(EPSILON,gl_Position.w+1.0))*logDepthBufFC-1.0;
gl_Position.z*=gl_Position.w;
}
#endif
#endif`,bce=`#ifdef USE_MAP
vec4 sampledDiffuseColor=texture2D(map,vUv);
#ifdef DECODE_VIDEO_TEXTURE
sampledDiffuseColor=vec4(mix(pow(sampledDiffuseColor.rgb*0.9478672986+vec3(0.0521327014),vec3(2.4)),sampledDiffuseColor.rgb*0.0773993808,vec3(lessThanEqual(sampledDiffuseColor.rgb,vec3(0.04045)))),sampledDiffuseColor.w);
#endif
diffuseColor*=sampledDiffuseColor;
#endif`,xce=`#ifdef USE_MAP
uniform sampler2D map;
#endif`,Ece=`#if defined(USE_MAP)||defined(USE_ALPHAMAP)
vec2 uv=(uvTransform*vec3(gl_PointCoord.x,1.0-gl_PointCoord.y,1)).xy;
#endif
#ifdef USE_MAP
diffuseColor*=texture2D(map,uv);
#endif
#ifdef USE_ALPHAMAP
diffuseColor.a*=texture2D(alphaMap,uv).g;
#endif`,Cce=`#if defined(USE_MAP)||defined(USE_ALPHAMAP)
uniform mat3 uvTransform;
#endif
#ifdef USE_MAP
uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
uniform sampler2D alphaMap;
#endif`,Sce=`float metalnessFactor=metalness;
#ifdef USE_METALNESSMAP
vec4 texelMetalness=texture2D(metalnessMap,vUv);
metalnessFactor*=texelMetalness.b;
#endif`,wce=`#ifdef USE_METALNESSMAP
uniform sampler2D metalnessMap;
#endif`,Mce=`#if defined(USE_MORPHCOLORS)&&defined(MORPHTARGETS_TEXTURE)
vColor*=morphTargetBaseInfluence;
for (int i=0;i<MORPHTARGETS_COUNT;i++){
#if defined(USE_COLOR_ALPHA)
if (morphTargetInfluences[i] != 0.0)vColor+=getMorph(gl_VertexID,i,2)*morphTargetInfluences[i];
#elif defined(USE_COLOR)
if (morphTargetInfluences[i] != 0.0)vColor+=getMorph(gl_VertexID,i,2).rgb*morphTargetInfluences[i];
#endif
}
#endif`,Tce=`#ifdef USE_MORPHNORMALS
objectNormal*=morphTargetBaseInfluence;
#ifdef MORPHTARGETS_TEXTURE
for (int i=0;i<MORPHTARGETS_COUNT;i++){
if (morphTargetInfluences[i] != 0.0)objectNormal+=getMorph(gl_VertexID,i,1).xyz*morphTargetInfluences[i];
}
#else
#if MORPHTARGETS_COUNT>0
objectNormal+=morphNormal0*morphTargetInfluences[0];
#endif
#if MORPHTARGETS_COUNT>1
objectNormal+=morphNormal1*morphTargetInfluences[1];
#endif
#if MORPHTARGETS_COUNT>2
objectNormal+=morphNormal2*morphTargetInfluences[2];
#endif
#if MORPHTARGETS_COUNT>3
objectNormal+=morphNormal3*morphTargetInfluences[3];
#endif
#if MORPHTARGETS_COUNT>4
objectNormal+=morphNormal4*morphTargetInfluences[4];
#endif
#if MORPHTARGETS_COUNT>5
objectNormal+=morphNormal5*morphTargetInfluences[5];
#endif
#endif
#endif`,Ice=`#ifdef USE_MORPHTARGETS
uniform float morphTargetBaseInfluence;
#ifdef MORPHTARGETS_TEXTURE
uniform float morphTargetInfluences[MORPHTARGETS_COUNT];
uniform sampler2DArray morphTargetsTexture;
uniform ivec2 morphTargetsTextureSize;
vec4 getMorph(const in int vertexIndex,const in int morphTargetIndex,const in int offset){
int texelIndex=vertexIndex*MORPHTARGETS_TEXTURE_STRIDE+offset;
int y=texelIndex/morphTargetsTextureSize.x;
int x=texelIndex-y*morphTargetsTextureSize.x;
ivec3 morphUV=ivec3(x,y,morphTargetIndex);
return texelFetch(morphTargetsTexture,morphUV,0);
}
#else
#ifndef USE_MORPHNORMALS
uniform float morphTargetInfluences[12];
#else
uniform float morphTargetInfluences[6];
#endif
#endif
#endif`,Rce=`#ifdef USE_MORPHTARGETS
transformed*=morphTargetBaseInfluence;
#ifdef MORPHTARGETS_TEXTURE
for (int i=0;i<MORPHTARGETS_COUNT;i++){
if (morphTargetInfluences[i] != 0.0)transformed+=getMorph(gl_VertexID,i,0).xyz*morphTargetInfluences[i];
}
#else
#if MORPHTARGETS_COUNT>0
transformed+=morphTarget0*morphTargetInfluences[0];
#endif
#if MORPHTARGETS_COUNT>1
transformed+=morphTarget1*morphTargetInfluences[1];
#endif
#if MORPHTARGETS_COUNT>2
transformed+=morphTarget2*morphTargetInfluences[2];
#endif
#if MORPHTARGETS_COUNT>3
transformed+=morphTarget3*morphTargetInfluences[3];
#endif
#if MORPHTARGETS_COUNT>4
transformed+=morphTarget4*morphTargetInfluences[4];
#endif
#if MORPHTARGETS_COUNT>5
transformed+=morphTarget5*morphTargetInfluences[5];
#endif
#ifndef USE_MORPHNORMALS
#if MORPHTARGETS_COUNT>6
transformed+=morphTarget6*morphTargetInfluences[6];
#endif
#if MORPHTARGETS_COUNT>7
transformed+=morphTarget7*morphTargetInfluences[7];
#endif
#if MORPHTARGETS_COUNT>8
transformed+=morphTarget8*morphTargetInfluences[8];
#endif
#if MORPHTARGETS_COUNT>9
transformed+=morphTarget9*morphTargetInfluences[9];
#endif
#if MORPHTARGETS_COUNT>10
transformed+=morphTarget10*morphTargetInfluences[10];
#endif
#if MORPHTARGETS_COUNT>11
transformed+=morphTarget1*morphTargetInfluences[11];
#endif
#endif
#endif
#endif`,Lce=`float faceDirection=gl_FrontFacing?1.0:-1.0;
#ifdef FLAT_SHADED
vec3 fdx=dFdx(vViewPosition);
vec3 fdy=dFdy(vViewPosition);
vec3 normal=normalize(cross(fdx,fdy));
#else
vec3 normal=normalize(vNormal);
#ifdef DOUBLE_SIDED
normal=normal*faceDirection;
#endif
#ifdef USE_TANGENT
vec3 tangent=normalize(vTangent);
vec3 bitangent=normalize(vBitangent);
#ifdef DOUBLE_SIDED
tangent=tangent*faceDirection;
bitangent=bitangent*faceDirection;
#endif
#if defined(TANGENTSPACE_NORMALMAP)||defined(USE_CLEARCOAT_NORMALMAP)
mat3 vTBN=mat3(tangent,bitangent,normal);
#endif
#endif
#endif
vec3 geometryNormal=normal;`,Pce=`#ifdef OBJECTSPACE_NORMALMAP
normal=texture2D(normalMap,vUv).xyz*2.0-1.0;
#ifdef FLIP_SIDED
normal=-normal;
#endif
#ifdef DOUBLE_SIDED
normal=normal*faceDirection;
#endif
normal=normalize(normalMatrix*normal);
#elif defined(TANGENTSPACE_NORMALMAP)
vec3 mapN=texture2D(normalMap,vUv).xyz*2.0-1.0;
mapN.xy*=normalScale;
#ifdef USE_TANGENT
normal=normalize(vTBN*mapN);
#else
normal=perturbNormal2Arb(-vViewPosition,normal,mapN,faceDirection);
#endif
#elif defined(USE_BUMPMAP)
normal=perturbNormalArb(-vViewPosition,normal,dHdxy_fwd(),faceDirection);
#endif`,Dce=`#ifndef FLAT_SHADED
varying vec3 vNormal;
#ifdef USE_TANGENT
varying vec3 vTangent;
varying vec3 vBitangent;
#endif
#endif`,Bce=`#ifndef FLAT_SHADED
varying vec3 vNormal;
#ifdef USE_TANGENT
varying vec3 vTangent;
varying vec3 vBitangent;
#endif
#endif`,Nce=`#ifndef FLAT_SHADED
vNormal=normalize(transformedNormal);
#ifdef USE_TANGENT
vTangent=normalize(transformedTangent);
vBitangent=normalize(cross(vNormal,vTangent)*tangent.w);
#endif
#endif`,Oce=`#ifdef USE_NORMALMAP
uniform sampler2D normalMap;
uniform vec2 normalScale;
#endif
#ifdef OBJECTSPACE_NORMALMAP
uniform mat3 normalMatrix;
#endif
#if !defined (USE_TANGENT)&&(defined (TANGENTSPACE_NORMALMAP)||defined (USE_CLEARCOAT_NORMALMAP))
vec3 perturbNormal2Arb(vec3 eye_pos,vec3 surf_norm,vec3 mapN,float faceDirection){
vec3 q0=dFdx(eye_pos.xyz);
vec3 q1=dFdy(eye_pos.xyz);
vec2 st0=dFdx(vUv.st);
vec2 st1=dFdy(vUv.st);
vec3 N=surf_norm;
vec3 q1perp=cross(q1,N);
vec3 q0perp=cross(N,q0);
vec3 T=q1perp*st0.x+q0perp*st1.x;
vec3 B=q1perp*st0.y+q0perp*st1.y;
float det=max(dot(T,T),dot(B,B));
float scale=(det==0.0)?0.0:faceDirection*inversesqrt(det);
return normalize(T*(mapN.x*scale)+B*(mapN.y*scale)+N*mapN.z);
}
#endif`,kce=`#ifdef USE_CLEARCOAT
vec3 clearcoatNormal=geometryNormal;
#endif`,Fce=`#ifdef USE_CLEARCOAT_NORMALMAP
vec3 clearcoatMapN=texture2D(clearcoatNormalMap,vUv).xyz*2.0-1.0;
clearcoatMapN.xy*=clearcoatNormalScale;
#ifdef USE_TANGENT
clearcoatNormal=normalize(vTBN*clearcoatMapN);
#else
clearcoatNormal=perturbNormal2Arb(-vViewPosition,clearcoatNormal,clearcoatMapN,faceDirection);
#endif
#endif`,Vce=`#ifdef USE_CLEARCOATMAP
uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
uniform sampler2D clearcoatRoughnessMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
uniform sampler2D clearcoatNormalMap;
uniform vec2 clearcoatNormalScale;
#endif`,Uce=`#ifdef OPAQUE
diffuseColor.a=1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a*=material.transmissionAlpha+0.1;
#endif
gl_FragColor=vec4(outgoingLight,diffuseColor.a);`,zce=`vec3 packNormalToRGB(const in vec3 normal){
return normalize(normal)*0.5+0.5;
}
vec3 unpackRGBToNormal(const in vec3 rgb){
return 2.0*rgb.xyz-1.0;
}
const float PackUpscale=256./255.;
const float UnpackDownscale=255./256.;
const vec3 PackFactors=vec3(256.*256.*256.,256.*256.,256.);
const vec4 UnpackFactors=UnpackDownscale/vec4(PackFactors,1.);
const float ShiftRight8=1./256.;
vec4 packDepthToRGBA(const in float v){
vec4 r=vec4(fract(v*PackFactors),v);
r.yzw-=r.xyz*ShiftRight8;
return r*PackUpscale;
}
float unpackRGBAToDepth(const in vec4 v){
return dot(v,UnpackFactors);
}
vec2 packDepthToRG(in highp float v){
return packDepthToRGBA(v).yx;
}
float unpackRGToDepth(const in highp vec2 v){
return unpackRGBAToDepth(vec4(v.xy,0.0,0.0));
}
vec4 pack2HalfToRGBA(vec2 v){
vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));
return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);
}
vec2 unpackRGBATo2Half(vec4 v){
return vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));
}
float viewZToOrthographicDepth(const in float viewZ,const in float near,const in float far){
return (viewZ+near)/(near-far);
}
float orthographicDepthToViewZ(const in float linearClipZ,const in float near,const in float far){
return linearClipZ*(near-far)-near;
}
float viewZToPerspectiveDepth(const in float viewZ,const in float near,const in float far){
return ((near+viewZ)*far)/((far-near)*viewZ);
}
float perspectiveDepthToViewZ(const in float invClipZ,const in float near,const in float far){
return (near*far)/((far-near)*invClipZ-far);
}`,Gce=`#ifdef PREMULTIPLIED_ALPHA
gl_FragColor.rgb*=gl_FragColor.a;
#endif`,Hce=`vec4 mvPosition=vec4(transformed,1.0);
#ifdef USE_INSTANCING
mvPosition=instanceMatrix*mvPosition;
#endif
mvPosition=modelViewMatrix*mvPosition;
gl_Position=projectionMatrix*mvPosition;
#if defined(BACKGROUND_DEPTH)
gl_Position.z=gl_Position.w;
#endif`,Wce=`#ifdef DITHERING
gl_FragColor.rgb=dithering(gl_FragColor.rgb);
#endif`,jce=`#ifdef DITHERING
vec3 dithering(vec3 color){
float grid_position=rand(gl_FragCoord.xy);
vec3 dither_shift_RGB=vec3(0.25/255.0,-0.25/255.0,0.25/255.0);
dither_shift_RGB=mix(2.0*dither_shift_RGB,-2.0*dither_shift_RGB,grid_position);
return color+dither_shift_RGB;
}
#endif`,Qce=`float roughnessFactor=roughness;
#ifdef USE_ROUGHNESSMAP
vec4 texelRoughness=texture2D(roughnessMap,vUv);
roughnessFactor*=texelRoughness.g;
#endif`,$ce=`#ifdef USE_ROUGHNESSMAP
uniform sampler2D roughnessMap;
#endif`,Yce=`
#define BIAS_FRUSTUM_SCALE_COEFF 30.0
#define ESM_SPOT_SINGLE_BLUR_COEFF 0.25
#define PCF_POISSON_SPOT_OMNI_BLUR_COEFF 4.0
#define PCF_POISSON_POINT_BLUR_COEFF 2.5
#define ESM_BIAS_COEFF 100.0
#ifndef ESM_DISTANCE_SCALE
#define ESM_DISTANCE_SCALE 1.0
#endif
#ifdef USE_SHADOWMAP
#if NUM_SPOT_LIGHT_SHADOWS>0
uniform sampler2D spotShadowMap[NUM_SPOT_LIGHT_SHADOWS];
varying vec4 vSpotShadowCoord[NUM_SPOT_LIGHT_SHADOWS];
struct SpotLightShadow {
float shadowBias;
float shadowNormalBias;
float shadowRadius;
vec2 shadowMapSize;
int shadow;
float shadowCameraNear;
float shadowCameraFar;
float expBias;
};
uniform SpotLightShadow spotLightShadows[NUM_SPOT_LIGHT_SHADOWS];
#endif
#if NUM_POINT_LIGHT_SHADOWS>0
uniform sampler2D pointShadowMap[NUM_POINT_LIGHT_SHADOWS];
varying vec4 vPointShadowCoord[NUM_POINT_LIGHT_SHADOWS];
struct PointLightShadow {
float shadowBias;
float shadowNormalBias;
float shadowRadius;
vec2 shadowMapSize;
float shadowCameraNear;
float shadowCameraFar;
float expBias;
};
uniform PointLightShadow pointLightShadows[NUM_POINT_LIGHT_SHADOWS];
#endif
#if NUM_RECT_AREA_LIGHT_SHADOWS>0
uniform sampler2D rectAreaShadowMap[NUM_RECT_AREA_LIGHT_SHADOWS];
varying vec4 vRectAreaShadowCoord[NUM_RECT_AREA_LIGHT_SHADOWS];
struct RectAreaLightShadow {
float shadowBias;
float shadowNormalBias;
float shadowRadius;
vec2 shadowMapSize;
float shadowCameraNear;
float shadowCameraFar;
float expBias;
};
uniform RectAreaLightShadow rectAreaLightShadows[NUM_RECT_AREA_LIGHT_SHADOWS];
#endif
#if NUM_DIR_LIGHT_SHADOWS_CSM>0
uniform sampler2D directionalShadowCSMMap[NUM_DIR_LIGHT_SHADOW_CASCADES_CSM];
varying vec4 vDirectionalShadowCSMCoord[NUM_DIR_LIGHT_SHADOW_CASCADES_CSM];
struct DirectionalLightShadowCascade {
float shadowBias;
float shadowNormalBias;
float shadowRadius;
vec2 shadowMapSize;
float shadowCameraNear;
float shadowCameraFar;
vec2 cascade;
float expBias;
vec3 position;
int csmIdx;
};
struct DirectionalLightShadowCSM {
int cascadeIdxEnd;
float cameraNear;
float shadowFar;
float fade;
};
uniform DirectionalLightShadowCSM directionalLightShadowsCSM[NUM_DIR_LIGHT_SHADOWS_CSM];
uniform DirectionalLightShadowCascade directionalLightShadowsCSMCascade[NUM_DIR_LIGHT_SHADOW_CASCADES_CSM];
#endif
const vec3 PERMUTE_DIR_X=vec3(1.0,0.0,0.0);
const vec3 PERMUTE_DIR_Y=vec3(0.0,1.0,0.0);
const vec3 PERMUTE_DIR_Z=vec3(0.0,0.0,1.0);
const mat4 POISSON_DISK_0=mat4(0.954845,0.242214,-0.623893,-0.235473,-0.173288,0.799228,0.605969,-0.548050,-0.560406,0.327647,-0.448307,-0.774344,0.308258,0.417332,-0.125623,-0.056098
);
const mat4 POISSON_DISK_1=mat4(0.145585,-0.305634,0.264060,-0.661648,0.617942,0.652121,-0.041412,-0.893582,0.463911,0.039752,0.212664,0.810727,-0.955989,-0.014390,-0.652588,0.671204
);
float texture2DCompare(sampler2D depths,vec2 uv,float compare){
return step(compare,unpackRGBAToDepth(texture2D(depths,uv)));
}
float texture2DShadowLerp(sampler2D depths,vec2 size,vec2 uv,float compare){
const vec2 offset=vec2(0.0,1.0);
vec2 texelSize=vec2(1.0)/size;
vec2 centroidUV=floor(uv*size+0.5)/size;
float lb=texture2DCompare(depths,centroidUV+texelSize*offset.xx,compare);
float lt=texture2DCompare(depths,centroidUV+texelSize*offset.xy,compare);
float rb=texture2DCompare(depths,centroidUV+texelSize*offset.yx,compare);
float rt=texture2DCompare(depths,centroidUV+texelSize*offset.yy,compare);
vec2 f=fract(uv*size+0.5);
float a=mix(lb,lt,f.y);
float b=mix(rb,rt,f.y);
float c=mix(a,b,f.x);
return c;
}
vec2 cubeToUV(vec3 v,float texelSizeY){
vec3 absV=abs(v);
float scaleToCube=1.0/max(absV.x,max(absV.y,absV.z));
absV*=scaleToCube;
v*=scaleToCube*(1.0-2.0*texelSizeY);
vec2 planar=v.xy;
float almostATexel=1.5*texelSizeY;
float almostOne=1.0-almostATexel;
if (absV.z>=almostOne){
if (v.z>0.0)
planar.x=4.0-v.x;
} else if (absV.x>=almostOne){
float signX=sign(v.x);
planar.x=v.z*signX+2.0*signX;
} else if (absV.y>=almostOne){
float signY=sign(v.y);
planar.x=v.x+2.0*signY+2.0;
planar.y=v.z*signY-2.0;
}
return vec2(0.125,0.25)*planar+vec2(0.375,0.75);
}
float texture2DShadowAvgCube(sampler2D depths,vec2 size,vec3 bd3D,float compare){
vec2 texelSize=vec2(1.0)/size;
vec3 dirX=normalize(abs(bd3D.y)<0.99999?vec3(bd3D.z,0.0,-bd3D.x)
: vec3(0.0,-bd3D.z,bd3D.y));
vec3 dirY=cross(bd3D,dirX);
float theta=PI_HALF*texelSize.y;
vec3 sX=sin(theta)*dirX;
vec3 sY=sin(theta)*dirY;
float cosT=cos(theta);
vec3 sampleVec[4];
sampleVec[0]=bd3D;
sampleVec[1]=bd3D*cosT+sY;
sampleVec[2]=bd3D*cosT+sX;
sampleVec[3]=sampleVec[2]*cosT+sY;
float avg=0.0;
for (int i=0;i<4;i++){
avg+=texture2DCompare(depths,cubeToUV(sampleVec[i],texelSize.y),compare);
}
avg/=4.0;
return avg;
}
float getShadow(sampler2D shadowMap,vec2 shadowMapSize,float shadowBias,float shadowRadius,vec4 shadowCoord,float expBias,float distWorld){
float shadow=1.0;
shadowCoord.xyz/=shadowCoord.w;
bool inFrustum=shadowCoord.x>=0.0&&shadowCoord.x<=1.0&&shadowCoord.y>=0.0&&shadowCoord.y<=1.0;
bool frustumTest=inFrustum&&shadowCoord.z<=1.0&&shadowCoord.z>=0.0;
if (frustumTest){
#if defined(SHADOWMAP_TYPE_BILINEAR)
shadowCoord.z+=shadowBias;
shadow=texture2DShadowLerp(shadowMap,shadowMapSize,shadowCoord.xy,shadowCoord.z);
#elif defined(SHADOWMAP_TYPE_PCF)
shadowCoord.z+=shadowBias;
vec2 texelSize=vec2(1.0)/shadowMapSize;
float randAngle=rand(gl_FragCoord.xy)*PI2;
float c=cos(randAngle),s=sin(randAngle);
mat2 sampleMat=mat2(c,s,-s,c)
* mat2(shadowRadius*texelSize.x,0.0,0.0,shadowRadius*texelSize.y);
vec2 sampleVec[16];
sampleVec[0]=POISSON_DISK_0[0].xy;
sampleVec[1]=POISSON_DISK_0[0].zw;
sampleVec[2]=POISSON_DISK_0[1].xy;
sampleVec[3]=POISSON_DISK_0[1].zw;
sampleVec[4]=POISSON_DISK_0[2].xy;
sampleVec[5]=POISSON_DISK_0[2].zw;
sampleVec[6]=POISSON_DISK_0[3].xy;
sampleVec[7]=POISSON_DISK_0[3].zw;
sampleVec[8]=POISSON_DISK_1[0].xy;
sampleVec[9]=POISSON_DISK_1[0].zw;
sampleVec[10]=POISSON_DISK_1[1].xy;
sampleVec[11]=POISSON_DISK_1[1].zw;
sampleVec[12]=POISSON_DISK_1[2].xy;
sampleVec[13]=POISSON_DISK_1[2].zw;
sampleVec[14]=POISSON_DISK_1[3].xy;
sampleVec[15]=POISSON_DISK_1[3].zw;
shadow=0.0;
for (int i=0;i<16;i++){
shadow+=texture2DCompare(shadowMap,shadowCoord.xy
+ sampleMat*sampleVec[i],shadowCoord.z);
}
shadow/=16.0;
#elif defined(SHADOWMAP_TYPE_ESM)
shadow=saturate(exp(expBias*(texture2D(shadowMap,shadowCoord.xy).x
- length(distWorld)*ESM_DISTANCE_SCALE
- ESM_BIAS_COEFF*shadowBias)));
#else
shadowCoord.z+=shadowBias;
shadow=texture2DCompare(shadowMap,shadowCoord.xy,shadowCoord.z);
#endif
}
return shadow;
}
float getOmniShadow(sampler2D shadowMap,vec2 shadowMapSize,float shadowBias,float expBias,float shadowRadius,vec4 shadowCoord,float shadowCameraNear,float shadowCameraFar){
float shadow=1.0;
vec3 lightToPosition=shadowCoord.xyz;
float dp=(length(lightToPosition)-shadowCameraNear)
/ (shadowCameraFar-shadowCameraNear);
bool frustumTest=dp<=1.0&&dp>=0.0;
if (frustumTest){
float biasScaleCoeff=BIAS_FRUSTUM_SCALE_COEFF
/ (shadowCameraFar-shadowCameraNear);
dp+=shadowBias*biasScaleCoeff;
vec3 bd3D=normalize(lightToPosition);
vec2 texelSize=1.0/shadowMapSize;
#if defined(SHADOWMAP_TYPE_BILINEAR)
shadow=texture2DShadowAvgCube(shadowMap,shadowMapSize,bd3D,dp);
#elif defined(SHADOWMAP_TYPE_ESM)
shadow=saturate(exp(expBias*(texture2D(shadowMap,cubeVecToOctUV(bd3D,texelSize)).x
- length(lightToPosition)*ESM_DISTANCE_SCALE
- ESM_BIAS_COEFF*shadowBias)));
#elif defined(SHADOWMAP_TYPE_PCF)
float randAngle=rand(gl_FragCoord.xy)*PI2;
float c=cos(randAngle),s=sin(randAngle);
mat2 sampleMat=mat2(c,s,-s,c)
* mat2(shadowRadius*texelSize.y,0.0,0.0,shadowRadius*texelSize.y);
vec3 absBd3D=abs(bd3D);
absBd3D/=max(absBd3D.x,max(absBd3D.y,absBd3D.z));
bvec2 isPointingCubeFace=greaterThan(absBd3D.xy,vec2(0.999));
mat3 permuteMat=mat3(isPointingCubeFace.x?PERMUTE_DIR_Y:PERMUTE_DIR_X,isPointingCubeFace.x||isPointingCubeFace.y?PERMUTE_DIR_Z:PERMUTE_DIR_Y,isPointingCubeFace.x?PERMUTE_DIR_X:isPointingCubeFace.y?PERMUTE_DIR_Y:PERMUTE_DIR_Z
);
vec2 sampleVec[16];
sampleVec[0]=POISSON_DISK_0[0].xy;
sampleVec[1]=POISSON_DISK_0[0].zw;
sampleVec[2]=POISSON_DISK_0[1].xy;
sampleVec[3]=POISSON_DISK_0[1].zw;
sampleVec[4]=POISSON_DISK_0[2].xy;
sampleVec[5]=POISSON_DISK_0[2].zw;
sampleVec[6]=POISSON_DISK_0[3].xy;
sampleVec[7]=POISSON_DISK_0[3].zw;
sampleVec[8]=POISSON_DISK_1[0].xy;
sampleVec[9]=POISSON_DISK_1[0].zw;
sampleVec[10]=POISSON_DISK_1[1].xy;
sampleVec[11]=POISSON_DISK_1[1].zw;
sampleVec[12]=POISSON_DISK_1[2].xy;
sampleVec[13]=POISSON_DISK_1[2].zw;
sampleVec[14]=POISSON_DISK_1[3].xy;
sampleVec[15]=POISSON_DISK_1[3].zw;
shadow=0.0;
for (int i=0;i<16;i++){
shadow+=texture2DCompare(shadowMap,cubeToUV(bd3D+permuteMat*vec3(sampleMat*sampleVec[i],0.0),texelSize.y),dp);
}
shadow/=16.0;
#else
shadow=texture2DCompare(shadowMap,cubeToUV(bd3D,texelSize.y),dp);
#endif
}
return shadow;
}
#if NUM_POINT_LIGHT_SHADOWS>0
float getPointShadow(PointLightShadow light,sampler2D shadowMap,vec4 shadowCoord){
float shadowRadius=light.shadowRadius;
vec2 mapSize=light.shadowMapSize;
#if defined(SHADOWMAP_TYPE_ESM)
mapSize*=2.0;
#else
mapSize*=vec2(4.0,2.0);
#if defined(SHADOWMAP_TYPE_PCF)
shadowRadius*=PCF_POISSON_POINT_BLUR_COEFF;
#endif
#endif
return getOmniShadow(shadowMap,mapSize,light.shadowBias,light.expBias,shadowRadius,shadowCoord,light.shadowCameraNear,light.shadowCameraFar);
}
#endif
#if NUM_RECT_AREA_LIGHT_SHADOWS>0
float getRectAreaShadow(RectAreaLightShadow light,sampler2D shadowMap,vec4 shadowCoord){
float shadowRadius=light.shadowRadius;
vec2 mapSize=light.shadowMapSize;
#if defined(SHADOWMAP_TYPE_ESM)
mapSize*=2.0;
#else
mapSize*=vec2(4.0,2.0);
#if defined(SHADOWMAP_TYPE_PCF)
shadowRadius*=PCF_POISSON_POINT_BLUR_COEFF;
#endif
#endif
return getOmniShadow(shadowMap,mapSize,light.shadowBias,light.expBias,shadowRadius,shadowCoord,light.shadowCameraNear,light.shadowCameraFar);
}
#endif
#if NUM_SPOT_LIGHT_SHADOWS>0
float getSpotOmniShadow(SpotLightShadow light,sampler2D shadowMap,vec4 shadowCoord){
float shadowRadius=light.shadowRadius;
vec2 mapSize=light.shadowMapSize;
#if defined(SHADOWMAP_TYPE_ESM)
#else
mapSize*=vec2(4.0,2.0);
#if defined(SHADOWMAP_TYPE_PCF)
shadowRadius*=PCF_POISSON_SPOT_OMNI_BLUR_COEFF;
#endif
#endif
return getOmniShadow(shadowMap,mapSize,light.shadowBias,light.expBias,shadowRadius,shadowCoord,light.shadowCameraNear,light.shadowCameraFar);
}
float biasLinearNormalizedToNonlinear(float bias,float near,float far,float projZ,float projW){
return (bias*(far+near)+2.0*projZ)/(bias*(far-near)+2.0*projW)
- projZ/projW;
}
float getSpotShadow(SpotLightShadow light,sampler2D shadowMap,vec4 shadowCoord,float distWorld){
float shadowRadius=light.shadowRadius;
float shadowBias=light.shadowBias;
#if defined(SHADOWMAP_TYPE_ESM)
shadowRadius*=ESM_SPOT_SINGLE_BLUR_COEFF;
#endif
shadowBias*=BIAS_FRUSTUM_SCALE_COEFF
/ (light.shadowCameraFar-light.shadowCameraNear);
#if defined(SHADOWMAP_TYPE_BASIC)||defined(SHADOWMAP_TYPE_BILINEAR)||defined(SHADOWMAP_TYPE_PCF)
shadowBias=biasLinearNormalizedToNonlinear(shadowBias,light.shadowCameraNear,light.shadowCameraFar,shadowCoord.z,shadowCoord.w);
#endif
return getShadow(shadowMap,light.shadowMapSize,shadowBias,shadowRadius,shadowCoord,light.expBias,distWorld);
}
#endif
#if NUM_DIR_LIGHT_SHADOWS_CSM>0
float getDirShadowCSM(DirectionalLightShadowCascade light,sampler2D shadowMap,vec4 shadowCoord,float distWorld){
return getShadow(shadowMap,light.shadowMapSize,light.shadowBias,light.shadowRadius,shadowCoord,light.expBias,distWorld);
}
#endif
#endif`,Xce=`#ifdef USE_SHADOWMAP
#if NUM_SPOT_LIGHT_SHADOWS>0
uniform mat4 spotShadowMatrix[NUM_SPOT_LIGHT_SHADOWS];
varying vec4 vSpotShadowCoord[NUM_SPOT_LIGHT_SHADOWS];
struct SpotLightShadow {
float shadowBias;
float shadowNormalBias;
float shadowRadius;
vec2 shadowMapSize;
int shadow;
float shadowCameraNear;
float shadowCameraFar;
float expBias;
};
uniform SpotLightShadow spotLightShadows[NUM_SPOT_LIGHT_SHADOWS];
#endif
#if NUM_POINT_LIGHT_SHADOWS>0
uniform mat4 pointShadowMatrix[NUM_POINT_LIGHT_SHADOWS];
varying vec4 vPointShadowCoord[NUM_POINT_LIGHT_SHADOWS];
struct PointLightShadow {
float shadowBias;
float shadowNormalBias;
float shadowRadius;
vec2 shadowMapSize;
float shadowCameraNear;
float shadowCameraFar;
float expBias;
};
uniform PointLightShadow pointLightShadows[NUM_POINT_LIGHT_SHADOWS];
#endif
#if NUM_RECT_AREA_LIGHT_SHADOWS>0
uniform mat4 rectAreaShadowMatrix[NUM_RECT_AREA_LIGHT_SHADOWS];
varying vec4 vRectAreaShadowCoord[NUM_RECT_AREA_LIGHT_SHADOWS];
struct RectAreaLightShadow {
float shadowBias;
float shadowNormalBias;
float shadowRadius;
vec2 shadowMapSize;
float shadowCameraNear;
float shadowCameraFar;
float expBias;
};
uniform RectAreaLightShadow rectAreaLightShadows[NUM_RECT_AREA_LIGHT_SHADOWS];
#endif
#if NUM_DIR_LIGHT_SHADOWS_CSM>0
uniform mat4 directionalShadowCSMMatrix[NUM_DIR_LIGHT_SHADOW_CASCADES_CSM];
varying vec4 vDirectionalShadowCSMCoord[NUM_DIR_LIGHT_SHADOW_CASCADES_CSM];
struct DirectionalLightShadowCascade {
float shadowBias;
float shadowNormalBias;
float shadowRadius;
vec2 shadowMapSize;
float shadowCameraNear;
float shadowCameraFar;
vec2 cascade;
float expBias;
vec3 position;
int csmIdx;
};
struct DirectionalLightShadowCSM {
int cascadeIdxEnd;
float cameraNear;
float shadowFar;
float fade;
};
uniform DirectionalLightShadowCSM directionalLightShadowsCSM[NUM_DIR_LIGHT_SHADOWS_CSM];
uniform DirectionalLightShadowCascade directionalLightShadowsCSMCascade[NUM_DIR_LIGHT_SHADOW_CASCADES_CSM];
#endif
#endif`,qce=`#if defined(USE_SHADOWMAP)
#if NUM_SPOT_LIGHT_SHADOWS>0||NUM_POINT_LIGHT_SHADOWS>0||NUM_RECT_AREA_LIGHT_SHADOWS>0||NUM_DIR_LIGHT_SHADOWS_CSM>0
vec3 shadowWorldNormal=inverseTransformDirection(transformedNormal,viewMatrix);
vec4 shadowWorldPosition;
#endif
#if NUM_SPOT_LIGHT_SHADOWS>0
#pragma unroll_loop
for (int i=0;i<NUM_SPOT_LIGHT_SHADOWS;i++){
shadowWorldPosition=worldPosition+vec4(shadowWorldNormal*spotLightShadows[i].shadowNormalBias,0);
vSpotShadowCoord[i]=spotShadowMatrix[i]*shadowWorldPosition;
}
#endif
#if NUM_POINT_LIGHT_SHADOWS>0
#pragma unroll_loop
for (int i=0;i<NUM_POINT_LIGHT_SHADOWS;i++){
shadowWorldPosition=worldPosition+vec4(shadowWorldNormal*pointLightShadows[i].shadowNormalBias,0);
vPointShadowCoord[i]=pointShadowMatrix[i]*shadowWorldPosition;
}
#endif
#if NUM_RECT_AREA_LIGHT_SHADOWS>0
#pragma unroll_loop
for (int i=0;i<NUM_RECT_AREA_LIGHT_SHADOWS;i++){
shadowWorldPosition=worldPosition+vec4(shadowWorldNormal*rectAreaLightShadows[i].shadowNormalBias,0);
vRectAreaShadowCoord[i]=rectAreaShadowMatrix[i]*shadowWorldPosition;
}
#endif
#if NUM_DIR_LIGHT_SHADOWS_CSM>0
#pragma unroll_loop
for (int i=0;i<NUM_DIR_LIGHT_SHADOW_CASCADES_CSM;i++){
shadowWorldPosition=worldPosition+vec4(shadowWorldNormal*directionalLightShadowsCSMCascade[i].shadowNormalBias,0);
vDirectionalShadowCSMCoord[i]=directionalShadowCSMMatrix[i]*shadowWorldPosition;
}
#endif
#endif`,Kce=`float getShadowMask(){
float shadow=1.0;
#ifdef USE_SHADOWMAP
#if NUM_SPOT_LIGHT_SHADOWS>0
SpotLightShadow spotLight;
#pragma unroll_loop
for (int i=0;i<NUM_SPOT_LIGHT_SHADOWS;i++){
spotLight=spotLightShadows[i];
if (receiveShadow){
if (spotLight.shadow==1){
float distWorld=0.0;
#if defined(SHADOWMAP_TYPE_ESM)
distWorld=length((invViewMatrix*vec4(spotLight.position
+ vViewPosition,0.0)).xyz);
#endif
shadow*=getSpotShadow(spotLight,spotShadowMap[i],vSpotShadowCoord[i],distWorld);
} else if (spotLight.shadow==2){
shadow*=getSpotOmniShadow(spotLight,spotShadowMap[i],vSpotShadowCoord[i]);
}
}
}
#endif
#if NUM_POINT_LIGHT_SHADOWS>0
PointLightShadow pointLight;
#pragma unroll_loop
for (int i=0;i<NUM_POINT_LIGHT_SHADOWS;i++){
pointLight=pointLightShadows[i];
shadow*=receiveShadow?getPointShadow(pointLight,pointShadowMap[i],vPointShadowCoord[i]):1.0;
}
#endif
#if NUM_RECT_AREA_LIGHT_SHADOWS>0
RectAreaLightShadow rectAreaLight;
#pragma unroll_loop
for (int i=0;i<NUM_RECT_AREA_LIGHT_SHADOWS;i++){
rectAreaLight=rectAreaLightShadows[i];
shadow*=receiveShadow?getRectAreaShadow(rectAreaLight,rectAreaShadowMap[i],vRectAreaShadowCoord[i]):1.0;
}
#endif
#if NUM_DIR_LIGHT_SHADOWS_CSM>0
DirectionalLightShadowCascade dirShadowCascade;
#pragma unroll_loop
for (int i=0;i<NUM_DIR_LIGHT_SHADOW_CASCADES_CSM;i++){
dirShadowCascade=directionalLightShadowsCSMCascade[i];
float distWorld=0.0;
#if defined(SHADOWMAP_TYPE_ESM)
distWorld=length((invViewMatrix*vec4(dirShadowCascade.position
+ vViewPosition,0.0)).xyz);
#endif
shadow*=((vViewPosition.z<dirShadowCascade.shadowCameraFar)&&receiveShadow)?
getDirShadowCSM(dirShadowCascade,directionalShadowCSMMap[i],vDirectionalShadowCSMCoord[i],distWorld)
: 1.0;
}
#endif
#endif
return shadow;
}`,Zce=`#ifdef USE_SKINNING
mat4 boneMatX=getBoneMatrix(skinIndex.x);
mat4 boneMatY=getBoneMatrix(skinIndex.y);
mat4 boneMatZ=getBoneMatrix(skinIndex.z);
mat4 boneMatW=getBoneMatrix(skinIndex.w);
#endif`,Jce=`#ifdef USE_SKINNING
uniform mat4 bindMatrix;
uniform mat4 bindMatrixInverse;
uniform highp sampler2D boneTexture;
uniform int boneTextureSize;
mat4 getBoneMatrix(const in float i){
float j=i*4.0;
float x=mod(j,float(boneTextureSize));
float y=floor(j/float(boneTextureSize));
float dx=1.0/float(boneTextureSize);
float dy=1.0/float(boneTextureSize);
y=dy*(y+0.5);
vec4 v1=texture2D(boneTexture,vec2(dx*(x+0.5),y));
vec4 v2=texture2D(boneTexture,vec2(dx*(x+1.5),y));
vec4 v3=texture2D(boneTexture,vec2(dx*(x+2.5),y));
vec4 v4=texture2D(boneTexture,vec2(dx*(x+3.5),y));
mat4 bone=mat4(v1,v2,v3,v4);
return bone;
}
#endif`,eue=`#ifdef USE_SKINNING
vec4 skinVertex=bindMatrix*vec4(transformed,1.0);
vec4 skinned=vec4(0.0);
skinned+=boneMatX*skinVertex*skinWeight.x;
skinned+=boneMatY*skinVertex*skinWeight.y;
skinned+=boneMatZ*skinVertex*skinWeight.z;
skinned+=boneMatW*skinVertex*skinWeight.w;
transformed=(bindMatrixInverse*skinned).xyz;
#endif`,tue=`#ifdef USE_SKINNING
mat4 skinMatrix=mat4(0.0);
skinMatrix+=skinWeight.x*boneMatX;
skinMatrix+=skinWeight.y*boneMatY;
skinMatrix+=skinWeight.z*boneMatZ;
skinMatrix+=skinWeight.w*boneMatW;
skinMatrix=bindMatrixInverse*skinMatrix*bindMatrix;
objectNormal=vec4(skinMatrix*vec4(objectNormal,0.0)).xyz;
#ifdef USE_TANGENT
objectTangent=vec4(skinMatrix*vec4(objectTangent,0.0)).xyz;
#endif
#endif`,nue=`float specularStrength;
#ifdef USE_SPECULARMAP
vec4 texelSpecular=texture2D(specularMap,vUv);
specularStrength=texelSpecular.r;
#else
specularStrength=1.0;
#endif`,rue=`#ifdef USE_SPECULARMAP
uniform sampler2D specularMap;
#endif`,oue=`#if defined(TONE_MAPPING)
gl_FragColor.rgb=toneMapping(gl_FragColor.rgb);
#endif`,iue=`#ifndef saturate
#define saturate(a)clamp(a,0.0,1.0)
#endif
uniform float toneMappingExposure;
uniform float toneMappingMidTones;
uniform float toneMappingPhysicalScale;
uniform float toneMappingBrightness;
uniform float toneMappingContrast;
uniform bool toneMappingChromaticAdaptation;
uniform vec3 toneMappingWhiteColor;
uniform bool toneMappingColorDifferentiation;
uniform bool toneMappingExteriorDaylight;
uniform vec3 toneMappingWhiteBalance;
uniform float toneMappingHighlights;
uniform float toneMappingShadows;
uniform float toneMappingSaturation;
uniform float toneMappingAperture;
uniform float toneMappingShutter;
uniform float toneMappingISO;
uniform float toneMappingVignetting;
uniform vec2 toneMappingResolution;
const mat3 LINEAR_REC2020_TO_LINEAR_SRGB=mat3(vec3(1.6605,-0.1246,-0.0182),vec3(- 0.5876,1.1329,-0.1006),vec3(- 0.0728,-0.0083,1.1187)
);
const mat3 LINEAR_SRGB_TO_LINEAR_REC2020=mat3(vec3(0.6274,0.0691,0.0164),vec3(0.3293,0.9195,0.0880),vec3(0.0433,0.0113,0.8956)
);
#define TONE_MAPPING_LOOK_NONE 0
#define TONE_MAPPING_LOOK_AGX_PUNCHY 1
const float FILMIC_BLENDER_LOG_MIN=-12.473931188;
const float FILMIC_BLENDER_LOG_MAX=12.526068812;
const float FILMIC_BLENDER_EXPOSURE_LATITUDE_RATIO=0.66;
vec3 LinearToneMapping(vec3 color){
return toneMappingExposure*color;
}
vec3 ReinhardToneMapping(vec3 color){
color*=toneMappingExposure;
return saturate(color/(vec3(1.0)+color));
}
vec3 OptimizedCineonToneMapping(vec3 color){
color*=toneMappingExposure;
color=max(vec3(0.0),color-0.004);
return pow((color*(6.2*color+0.5))/(color*(6.2*color+1.7)+0.06),vec3(2.2));
}
vec3 RRTAndODTFit(vec3 v){
vec3 a=v*(v+0.0245786)-0.000090537;
vec3 b=v*(0.983729*v+0.4329510)+0.238081;
return a/b;
}
vec3 ACESFilmicToneMapping(vec3 color){
const mat3 ACESInputMat=mat3(vec3(0.59719,0.07600,0.02840),vec3(0.35458,0.90834,0.13383),vec3(0.04823,0.01566,0.83777)
);
const mat3 ACESOutputMat=mat3(vec3( 1.60475,-0.10208,-0.00327),vec3(-0.53108,1.10813,-0.07276),vec3(-0.07367,-0.00605,1.07602)
);
color*=toneMappingExposure/0.6;
color=ACESInputMat*color;
color=RRTAndODTFit(color);
color=ACESOutputMat*color;
return saturate(color);
}
vec3 agxDefaultContrastApprox(vec3 x){
vec3 x2=x*x;
vec3 x4=x2*x2;
return+15.5*x4*x2
-40.14*x4*x
+ 31.96*x4
-6.868*x2*x
+ 0.4298*x2
+ 0.1191*x
-0.00232;
}
vec3 toneMappingLook(vec3 color,int look){
if (look==TONE_MAPPING_LOOK_NONE){
return color;
}
const vec3 lw=vec3(0.2126,0.7152,0.0722);
float luma=dot(color,lw);
vec3 offset=vec3(0.0);
vec3 slope=vec3(1.0);
vec3 power=vec3(1.0);
float sat=1.0;
if (look==TONE_MAPPING_LOOK_AGX_PUNCHY){
slope=vec3(1.0);
power=vec3(1.35,1.35,1.35);
sat=1.4;
}
color=pow(color*slope+offset,power);
return luma+sat*(color-luma);
}
vec3 AgXToneMapping(vec3 color){
const mat3 AgXInsetMatrix=mat3(vec3(0.856627153315983,0.137318972929847,0.11189821299995),vec3(0.0951212405381588,0.761241990602591,0.0767994186031903),vec3(0.0482516061458583,0.101439036467562,0.811302368396859)
);
const mat3 AgXOutsetMatrix=mat3(vec3(1.1271005818144368,-0.1413297634984383,-0.14132976349843826),vec3(- 0.11060664309660323,1.157823702216272,-0.11060664309660294),vec3(- 0.016493938717834573,-0.016493938717834257,1.2519364065950405)
);
const float AgxMinEv=-12.47393;
const float AgxMaxEv=4.026069;
color*=toneMappingExposure;
color=LINEAR_SRGB_TO_LINEAR_REC2020*color;
color=AgXInsetMatrix*color;
color=max(color,1e-10);
color=log2(color);
color=(color-AgxMinEv)/(AgxMaxEv-AgxMinEv);
color=clamp(color,0.0,1.0);
color=agxDefaultContrastApprox(color);
color=toneMappingLook(color,TONE_MAPPING_LOOK);
color=AgXOutsetMatrix*color;
color=pow(max(vec3(0.0),color),vec3(2.2));
color=LINEAR_REC2020_TO_LINEAR_SRGB*color;
color=clamp(color,0.0,1.0);
return color;
}
vec3 CustomToneMapping(vec3 color){return color;}
#define ORDERS_OF_MAG 5.0
#define PI_TONE 3.14159265359
float toneCalcBrightness(in vec3 color)
{
return (abs(color.r)*0.263+abs(color.g)*0.655+abs(color.b)*0.082);
}
float toneApproximateScotopicLuminance(vec3 color)
{
return (0.062*color.r+0.608*color.g+0.330*color.b);
}
vec3 LogarithmicMaxToneMapping(vec3 color){
float inputScaleFactor=toneMappingPhysicalScale/PI_TONE;
float brightness=(toneMappingBrightness<0.0)?0.0:(toneMappingBrightness*0.7);
float powerBot=toneMappingExteriorDaylight?4.0:2.0;
float res=100.0/ORDERS_OF_MAG;
float mag=floor((50.0/res));
float power=((brightness/20.0-ORDERS_OF_MAG)-powerBot)+mag;
float stepsize=9.0/res;
float step=50.0-(mag*res);
float param_c=(0.02*toneMappingContrast)*2.0;
float param_b=pow(10.0,power)*(1.0+(stepsize*step));
float param_a=param_b*(1.0+param_c);
param_c/=pow(2.0,toneMappingMidTones-1.0);
param_b*=PI_TONE;
vec3 whiteConstancyFactor=toneMappingWhiteColor;
if (toneMappingChromaticAdaptation){
float luminance=toneCalcBrightness(whiteConstancyFactor);
whiteConstancyFactor.r=(whiteConstancyFactor.r>0.001)?luminance/whiteConstancyFactor.r:luminance/0.001;
whiteConstancyFactor.g=(whiteConstancyFactor.g>0.001)?luminance/whiteConstancyFactor.g:luminance/0.001;
whiteConstancyFactor.b=(whiteConstancyFactor.b>0.001)?luminance/whiteConstancyFactor.b:luminance/0.001;
}
vec3 outColor=inputScaleFactor*color;
if (toneMappingChromaticAdaptation){
outColor*=whiteConstancyFactor.rgb;
}
float luminance=toneCalcBrightness(outColor);
if (toneMappingColorDifferentiation&&(luminance<5.62)){
float sLuminance=toneApproximateScotopicLuminance(outColor);
if (luminance<=5.62e-3){
outColor=vec3(sLuminance);
} else {
float w=(luminance-5.62e-3)/5.61438;
outColor=outColor*w+sLuminance*(1.0-w);
}
}
outColor=outColor*(param_a/(param_b*outColor+param_c));
return outColor;
}
float maxExposurePhotographic(in vec4 color1,in vec4 color2)
{
return ((color1.r*color2.r)+(color1.g*color2.g))+(color1.b*color2.b);
}
vec3 PhysicalMaxToneMapping(vec3 color){
float vignettingInfluence=1.0;
if (toneMappingVignetting>0.0){
vec3 vignettingCoords=vec3(0.0,0.0,0.0);
float aspect=toneMappingResolution.x/toneMappingResolution.y;
vignettingCoords.x=gl_FragCoord.x/toneMappingResolution.x-0.5;
vignettingCoords.y=(gl_FragCoord.y/toneMappingResolution.y-0.5)/aspect;
vignettingCoords.z=1.0;
vignettingCoords=normalize(vignettingCoords);
vignettingInfluence=pow(vignettingCoords.z,toneMappingVignetting);
}
float inputScaleFactor=toneMappingPhysicalScale/PI_TONE;
float filmISO=toneMappingISO;
float camShutter=1.0/toneMappingShutter;
float fNumber=toneMappingAperture;
float cm2=1.0;
float burnHighlights=toneMappingHighlights;
float crushBlacks=toneMappingShadows;
float saturation=toneMappingSaturation;
vec3 whitePointInfluence=toneMappingWhiteBalance;
if (whitePointInfluence.r>0.0){
whitePointInfluence.r=1.0/whitePointInfluence.r;
} else {
whitePointInfluence.r=1.0;
}
if (whitePointInfluence.g>0.0){
whitePointInfluence.g=1.0/whitePointInfluence.g;
} else {
whitePointInfluence.g=1.0;
}
if (whitePointInfluence.b>0.0){
whitePointInfluence.b=1.0/whitePointInfluence.b;
} else {
whitePointInfluence.b=1.0;
}
vec4 lumFactor=vec4(0.212671,0.715160,0.072169,0.0);
float whiteLumFactor=maxExposurePhotographic(lumFactor,vec4(whitePointInfluence,0.0));
whitePointInfluence.r/=whiteLumFactor;
whitePointInfluence.g/=whiteLumFactor;
whitePointInfluence.b/=whiteLumFactor;
float isoInfluence=0.0;
float camShutterInv=1.0/camShutter;
if (filmISO>0.0){
isoInfluence=((cm2*0.169811)*(filmISO*camShutterInv))/((15.4*fNumber)*fNumber);
} else {
isoInfluence=cm2;
}
vec3 outColor=inputScaleFactor*color;
outColor.r=outColor.r*whitePointInfluence.r*isoInfluence*vignettingInfluence;
outColor.g=outColor.g*whitePointInfluence.g*isoInfluence*vignettingInfluence;
outColor.b=outColor.b*whitePointInfluence.b*isoInfluence*vignettingInfluence;
outColor.r=(outColor.r*(1.0+(outColor.r*burnHighlights)))/(1.0+outColor.r);
outColor.g=(outColor.g*(1.0+(outColor.g*burnHighlights)))/(1.0+outColor.g);
outColor.b=(outColor.b*(1.0+(outColor.b*burnHighlights)))/(1.0+outColor.b);
float lumFactor2=maxExposurePhotographic(lumFactor,vec4(outColor,0.0));
float tmpFloat=1.0-saturation;
outColor.r=outColor.r*saturation+lumFactor2*tmpFloat;
outColor.g=outColor.g*saturation+lumFactor2*tmpFloat;
outColor.b=outColor.b*saturation+lumFactor2*tmpFloat;
outColor=max(vec3(0.0),outColor);
float crushBlacksFac=crushBlacks*2.0+1.0;
float crushBlacksFac2=pow(maxExposurePhotographic(lumFactor,vec4(outColor,0.0)),0.5);
tmpFloat=(1.0-crushBlacksFac2);
if (crushBlacksFac2<1.0){
outColor.r=outColor.r*crushBlacksFac2+pow(outColor.r,crushBlacksFac)*tmpFloat;
outColor.g=outColor.g*crushBlacksFac2+pow(outColor.g,crushBlacksFac)*tmpFloat;
outColor.b=outColor.b*crushBlacksFac2+pow(outColor.b,crushBlacksFac)*tmpFloat;
}
return outColor;
}
float filmicBlenderDesaturationMinIntensity(vec3 color){
float maxChannel=max(color.r,max(color.g,color.b));
float x=max(maxChannel,0.6251);
return (1.2192868*x-0.63221059)
* ((x-0.65069831)/(abs(x-0.65069831)+0.00952982)+0.73015231);
}
vec3 filmicBlenderDesaturationTransform(vec3 color){
const float CURVE_SMOOTHNESS=0.03;
float minIntensity=filmicBlenderDesaturationMinIntensity(color);
vec4 x=vec4(color,1.0)-minIntensity;
x=pow(x,vec4(2.0))/(abs(x)+CURVE_SMOOTHNESS);
return (x.rgb-x.a+color+1.0)/2.0;
}
vec3 filmicBlenderDynamicRangeTransform(vec3 color){
return pow((0.28882259*color-0.15880336)
/ (pow(color-0.6229693,vec3(2.0))+0.16965022)
+ 0.20453365*color+0.37847142,vec3(3.0)
);
}
vec3 FilmicBlenderToneMapping(vec3 color){
color*=toneMappingExposure;
color=max(color,0.000175);
color=clamp((log2(color)-FILMIC_BLENDER_LOG_MIN)
/ (FILMIC_BLENDER_LOG_MAX-FILMIC_BLENDER_LOG_MIN),0.0,1.0);
color=filmicBlenderDesaturationTransform(color);
color=clamp(color/FILMIC_BLENDER_EXPOSURE_LATITUDE_RATIO,0.0,1.0);
color=filmicBlenderDynamicRangeTransform(color);
return color;
}
vec3 PbrNeutralToneMapping(vec3 color){
const float startCompression=0.8-0.04;
const float desaturation=0.15;
float x=min(color.r,min(color.g,color.b));
float offset=x<0.08?x-6.25*x*x:0.04;
color-=offset;
float peak=max(color.r,max(color.g,color.b));
if (peak<startCompression)
return color;
const float d=1.0-startCompression;
float newPeak=1.0-d*d/(peak+d-startCompression);
color*=newPeak/peak;
float g=1.0-1.0/(desaturation*(peak-newPeak)+1.);
return mix(color,newPeak*vec3(1,1,1),g);
}`,aue=`#ifdef USE_TRANSMISSION
material.transmission=transmission;
material.transmissionAlpha=1.0;
material.thickness=thickness;
material.attenuationDistance=attenuationDistance;
material.attenuationColor=attenuationColor;
#ifdef USE_TRANSMISSIONMAP
material.transmission*=texture2D(transmissionMap,vUv).r;
#endif
#ifdef USE_THICKNESSMAP
material.thickness*=texture2D(thicknessMap,vUv).g;
#endif
vec3 pos=vWorldPosition;
vec3 v=normalize(cameraPosition-pos);
vec3 n=inverseTransformDirection(normal,viewMatrix);
vec4 transmission=getIBLVolumeRefraction(n,v,material.roughness,material.diffuseColor,material.specularColor,material.specularF90,pos,modelMatrix,viewMatrix,projectionMatrix,material.ior,material.thickness,material.attenuationColor,material.attenuationDistance);
material.transmissionAlpha=mix(material.transmissionAlpha,transmission.a,material.transmission);
totalDiffuse=mix(totalDiffuse,transmission.rgb,material.transmission);
#endif`,sue=`#ifdef USE_TRANSMISSION
uniform float transmission;
uniform float thickness;
uniform float attenuationDistance;
uniform vec3 attenuationColor;
#ifdef USE_TRANSMISSIONMAP
uniform sampler2D transmissionMap;
#endif
#ifdef USE_THICKNESSMAP
uniform sampler2D thicknessMap;
#endif
uniform vec2 transmissionSamplerSize;
uniform sampler2D transmissionSamplerMap;
uniform mat4 modelMatrix;
uniform mat4 projectionMatrix;
varying vec3 vWorldPosition;
vec3 getVolumeTransmissionRay(const in vec3 n,const in vec3 v,const in float thickness,const in float ior,const in mat4 modelMatrix){
vec3 refractionVector=refract(- v,normalize(n),1.0/ior);
vec3 modelScale;
modelScale.x=length(vec3(modelMatrix[0].xyz));
modelScale.y=length(vec3(modelMatrix[1].xyz));
modelScale.z=length(vec3(modelMatrix[2].xyz));
return normalize(refractionVector)*thickness*modelScale;
}
float applyIorToRoughness(const in float roughness,const in float ior){
return roughness*clamp(ior*2.0-2.0,0.0,1.0);
}
vec4 getTransmissionSample(const in vec2 fragCoord,const in float roughness,const in float ior){
float framebufferLod=log2(transmissionSamplerSize.x)*applyIorToRoughness(roughness,ior);
#ifdef texture2DLodEXT
return texture2DLodEXT(transmissionSamplerMap,fragCoord.xy,framebufferLod);
#else
return texture2D(transmissionSamplerMap,fragCoord.xy,framebufferLod);
#endif
}
vec3 applyVolumeAttenuation(const in vec3 radiance,const in float transmissionDistance,const in vec3 attenuationColor,const in float attenuationDistance){
if (isinf(attenuationDistance)){
return radiance;
} else {
vec3 attenuationCoefficient=-log(attenuationColor)/attenuationDistance;
vec3 transmittance=exp(-attenuationCoefficient*transmissionDistance);
return transmittance*radiance;
}
}
vec4 getIBLVolumeRefraction(const in vec3 n,const in vec3 v,const in float roughness,const in vec3 diffuseColor,const in vec3 specularColor,const in float specularF90,const in vec3 position,const in mat4 modelMatrix,const in mat4 viewMatrix,const in mat4 projMatrix,const in float ior,const in float thickness,const in vec3 attenuationColor,const in float attenuationDistance){
vec3 transmissionRay=getVolumeTransmissionRay(n,v,thickness,ior,modelMatrix);
vec3 refractedRayExit=position+transmissionRay;
vec4 ndcPos=projMatrix*viewMatrix*vec4(refractedRayExit,1.0);
vec2 refractionCoords=ndcPos.xy/ndcPos.w;
refractionCoords+=1.0;
refractionCoords/=2.0;
vec4 transmittedLight=getTransmissionSample(refractionCoords,roughness,ior);
vec3 attenuatedColor=applyVolumeAttenuation(transmittedLight.rgb,length(transmissionRay),attenuationColor,attenuationDistance);
vec3 F=EnvironmentBRDF(n,v,specularColor,specularF90,roughness);
return vec4((1.0-F)*attenuatedColor*diffuseColor,transmittedLight.a);
}
#endif`,lue=`#if (defined(USE_UV)&&!defined(UVS_VERTEX_ONLY))
varying vec2 vUv;
#endif`,cue=`#ifdef USE_UV
#ifdef UVS_VERTEX_ONLY
vec2 vUv;
#else
varying vec2 vUv;
#endif
uniform mat3 uvTransform;
#endif`,uue=`#ifdef USE_UV
vUv=(uvTransform*vec3(uv,1)).xy;
#endif`,due=`#if defined(USE_LIGHTMAP)||defined(USE_AOMAP)
varying vec2 vUv2;
#endif`,fue=`#if defined(USE_LIGHTMAP)||defined(USE_AOMAP)
attribute vec2 uv2;
varying vec2 vUv2;
uniform mat3 uv2Transform;
#endif`,hue=`#if defined(USE_LIGHTMAP)||defined(USE_AOMAP)
vUv2=(uv2Transform*vec3(uv2,1)).xy;
#endif`,pue=`float cosh(float x){
return (exp(x)+exp(-x))/2.0;
}
vec2 cosh(vec2 x){
return (exp(x)+exp(-x))/2.0;
}
vec3 cosh(vec3 x){
return (exp(x)+exp(-x))/2.0;
}
vec4 cosh(vec4 x){
return (exp(x)+exp(-x))/2.0;
}
float sinh(float x){
return (exp(x)-exp(-x))/2.0;
}
vec2 sinh(vec2 x){
return (exp(x)-exp(-x))/2.0;
}
vec3 sinh(vec3 x){
return (exp(x)-exp(-x))/2.0;
}
vec4 sinh(vec4 x){
return (exp(x)-exp(-x))/2.0;
}
float tanh(float x){
float exp2x=exp(2.0*x);
return (exp2x-1.0)/(exp2x+1.0);
}
vec2 tanh(vec2 x){
vec2 exp2x=exp(2.0*x);
return (exp2x-1.0)/(exp2x+1.0);
}
vec3 tanh(vec3 x){
vec3 exp2x=exp(2.0*x);
return (exp2x-1.0)/(exp2x+1.0);
}
vec4 tanh(vec4 x){
vec4 exp2x=exp(2.0*x);
return (exp2x-1.0)/(exp2x+1.0);
}
float trunc(float x){
return floor(abs(x))*sign(x);
}
vec2 trunc(vec2 x){
return floor(abs(x))*sign(x);
}
vec3 trunc(vec3 x){
return floor(abs(x))*sign(x);
}
vec4 trunc(vec4 x){
return floor(abs(x))*sign(x);
}`,mue=`#if defined(USE_ENVMAP)||defined(DISTANCE)||defined (USE_SHADOWMAP)||defined (USE_TRANSMISSION)||defined(MASK)||defined(NODE)
vec4 worldPosition=vec4(transformed,1.0);
#ifdef USE_INSTANCING
worldPosition=instanceMatrix*worldPosition;
#endif
worldPosition=modelMatrix*worldPosition;
#endif`;const gue=`varying vec2 vUv;
uniform mat3 uvTransform;
void main(){
vUv=(uvTransform*vec3(uv,1)).xy;
gl_Position=vec4(position.xy,1.0,1.0);
}`,_ue=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main(){
vec4 texColor=texture2D(t2D,vUv);
#ifdef DECODE_VIDEO_TEXTURE
texColor=vec4(mix(pow(texColor.rgb*0.9478672986+vec3(0.0521327014),vec3(2.4)),texColor.rgb*0.0773993808,vec3(lessThanEqual(texColor.rgb,vec3(0.04045)))),texColor.w);
#endif
texColor.rgb*=backgroundIntensity;
gl_FragColor=texColor;
#include <tonemapping_fragment>
#include <encodings_fragment>
}`,vue=`varying vec3 vWorldDirection;
#include <common>
void main(){
vWorldDirection=transformDirection(position,modelMatrix);
#include <begin_vertex>
#include <project_vertex>
gl_Position.z=gl_Position.w;
}`,Aue=`#ifdef ENVMAP_TYPE_CUBE
uniform samplerCube envMap;
#elif defined(ENVMAP_TYPE_CUBE_UV)
uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main(){
#ifdef ENVMAP_TYPE_CUBE
vec4 texColor=textureCube(envMap,vec3(flipEnvMap*vWorldDirection.x,vWorldDirection.yz));
#elif defined(ENVMAP_TYPE_CUBE_UV)
vec4 texColor=textureCubeUV(envMap,vWorldDirection,backgroundBlurriness);
#else
vec4 texColor=vec4(0.0,0.0,0.0,1.0);
#endif
texColor.rgb*=backgroundIntensity;
gl_FragColor=texColor;
#include <tonemapping_fragment>
#include <encodings_fragment>
}`,yue=`varying vec3 vWorldDirection;
#include <common>
void main(){
vWorldDirection=transformDirection(position,modelMatrix);
#include <begin_vertex>
#include <project_vertex>
gl_Position.z=gl_Position.w;
}`,bue=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main(){
vec4 texColor=textureCube(tCube,vec3(tFlip*vWorldDirection.x,vWorldDirection.yz));
gl_FragColor=texColor;
gl_FragColor.a*=opacity;
#include <tonemapping_fragment>
#include <encodings_fragment>
}`,xue=`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec3 vViewPosition;
varying vec2 vProjectedPosZW;
void main(){
#include <uv_vertex>
#include <skinbase_vertex>
#ifdef USE_DISPLACEMENTMAP
#include <beginnormal_vertex>
#include <morphnormal_vertex>
#include <skinnormal_vertex>
#endif
#include <begin_vertex>
#include <morphtarget_vertex>
#include <skinning_vertex>
#include <displacementmap_vertex>
#include <project_vertex>
#include <logdepthbuf_vertex>
#include <clipping_planes_vertex>
vViewPosition=mvPosition.xyz;
vProjectedPosZW=mat2(projectionMatrix[2][2],projectionMatrix[2][3],projectionMatrix[3][2],projectionMatrix[3][3]
)*mvPosition.zw;
#ifdef PANCAKE_DEPTH
gl_Position.z=max(gl_Position.z,-1.0);
#endif
}`,Eue=`#if DEPTH_PACKING==3200
uniform float opacity;
#endif
#ifdef USE_SLOPE_SCALED_BIAS
uniform float slopeScaledBias;
const float ONE_MINUS_EPS=0.9999999;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec3 vViewPosition;
varying vec2 vProjectedPosZW;
void main(){
#include <clipping_planes_fragment>
vec4 diffuseColor=vec4(1.0);
#if DEPTH_PACKING==3200
diffuseColor.a=opacity;
#endif
#include <map_fragment>
#include <alphamap_fragment>
#include <alphatest_fragment>
#include <logdepthbuf_fragment>
#if DEPTH_PACKING != 3202
float depth=vProjectedPosZW.x/vProjectedPosZW.y;
depth=(depth+1.0)/2.0;
#ifdef PANCAKE_DEPTH
depth=max(depth,0.0);
#endif
#ifdef USE_SLOPE_SCALED_BIAS
vec2 dxdy=abs(vec2(dFdx(depth),dFdy(depth)));
float bias=slopeScaledBias*max(dxdy.x,dxdy.y);
depth=clamp(depth+max(bias,1e-6),0.0,ONE_MINUS_EPS);
#endif
#if DEPTH_PACKING==3200
gl_FragColor=vec4(vec3(1.0-depth),opacity);
#elif DEPTH_PACKING==3201
gl_FragColor=packDepthToRGBA(depth);
#endif
#else
gl_FragColor=vec4(vViewPosition.z);
#endif
}`,Cue=`#define DISTANCE
varying vec3 vWorldPosition;
#ifdef PANCAKE_DEPTH
varying vec4 vMVPPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main(){
#include <uv_vertex>
#include <skinbase_vertex>
#ifdef USE_DISPLACEMENTMAP
#include <beginnormal_vertex>
#include <morphnormal_vertex>
#include <skinnormal_vertex>
#endif
#include <begin_vertex>
#include <morphtarget_vertex>
#include <skinning_vertex>
#include <displacementmap_vertex>
#include <project_vertex>
#include <worldpos_vertex>
#include <clipping_planes_vertex>
vWorldPosition=worldPosition.xyz;
#ifdef PANCAKE_DEPTH
vec4 mvpPosition=projectionMatrix*mvPosition;
gl_Position.z=max(mvpPosition.z,-1.0);
vMVPPosition=mvpPosition;
#endif
}`,Sue=`#define DISTANCE
#ifdef USE_SLOPE_SCALED_BIAS
uniform float slopeScaledBias;
const float ONE_MINUS_EPS=0.9999999;
#endif
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#ifdef PANCAKE_DEPTH
varying vec4 vMVPPosition;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <clipping_planes_pars_fragment>
#ifndef DISTANCE_SCALE
#define DISTANCE_SCALE 1.0
#endif
void main (){
#include <clipping_planes_fragment>
vec4 diffuseColor=vec4(1.0);
#include <map_fragment>
#include <alphamap_fragment>
#include <alphatest_fragment>
float dist=length(vWorldPosition-referencePosition);
#if DISTANCE_PACKING==3301
dist=(dist-nearDistance)/(farDistance-nearDistance);
dist=saturate(dist);
#ifdef USE_SLOPE_SCALED_BIAS
vec2 dxdy=abs(vec2(dFdx(dist),dFdy(dist)));
float bias=slopeScaledBias*max(dxdy.x,dxdy.y);
dist=clamp(dist+bias,0.0,ONE_MINUS_EPS);
#endif
gl_FragColor=packDepthToRGBA(dist);
#elif DISTANCE_PACKING==3302
#ifdef USE_SLOPE_SCALED_BIAS
vec2 dxdy=abs(vec2(dFdx(dist),dFdy(dist)));
dist+=slopeScaledBias*max(dxdy.x,dxdy.y);
#endif
#ifdef PANCAKE_DEPTH
if (vMVPPosition.z<-1.0){
dist=length(vec3(vMVPPosition.x*CAM_WIDTH,vMVPPosition.y*CAM_HEIGHT,nearDistance));
}
#endif
gl_FragColor=vec4(dist*DISTANCE_SCALE,0.0,0.0,1.0);
#endif
}`,wue=`varying vec3 vWorldDirection;
#include <common>
void main(){
vWorldDirection=transformDirection(position,modelMatrix);
#include <begin_vertex>
#include <project_vertex>
}`,Mue=`uniform sampler2D tEquirect;
uniform bool invertU;
uniform float offsetU;
varying vec3 vWorldDirection;
#include <common>
void main(){
vec3 direction=normalize(vWorldDirection);
vec2 sampleUV=equirectUv(direction);
if (invertU)
sampleUV.x=1.0-sampleUV.x;
sampleUV.x+=offsetU;
gl_FragColor=texture2D(tEquirect,sampleUV);
#include <tonemapping_fragment>
#include <encodings_fragment>
}`,Tue=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main(){
vLineDistance=scale*lineDistance;
#include <color_vertex>
#include <morphcolor_vertex>
#include <begin_vertex>
#include <morphtarget_vertex>
#include <project_vertex>
#include <logdepthbuf_vertex>
#include <clipping_planes_vertex>
#include <fog_vertex>
}`,Iue=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main(){
#include <clipping_planes_fragment>
if (mod(vLineDistance,totalSize)>dashSize){
discard;
}
vec3 outgoingLight=vec3(0.0);
vec4 diffuseColor=vec4(diffuse,opacity);
#include <logdepthbuf_fragment>
#include <color_fragment>
outgoingLight=diffuseColor.rgb;
#include <output_fragment>
#include <tonemapping_fragment>
#include <encodings_fragment>
#include <fog_fragment>
#include <premultiplied_alpha_fragment>
}`,Rue=`#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main(){
#include <uv_vertex>
#include <uv2_vertex>
#include <color_vertex>
#include <morphcolor_vertex>
#if defined (USE_ENVMAP)||defined (USE_SKINNING)
#include <beginnormal_vertex>
#include <morphnormal_vertex>
#include <skinbase_vertex>
#include <skinnormal_vertex>
#include <defaultnormal_vertex>
#endif
#include <begin_vertex>
#include <morphtarget_vertex>
#include <skinning_vertex>
#include <project_vertex>
#include <logdepthbuf_vertex>
#include <clipping_planes_vertex>
#include <worldpos_vertex>
#include <envmap_vertex>
#include <fog_vertex>
}`,Lue=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main(){
#include <clipping_planes_fragment>
vec4 diffuseColor=vec4(diffuse,opacity);
#include <logdepthbuf_fragment>
#include <map_fragment>
#include <color_fragment>
#include <alphamap_fragment>
#include <alphatest_fragment>
#include <specularmap_fragment>
ReflectedLight reflectedLight=ReflectedLight(vec3(0.0),vec3(0.0),vec3(0.0),vec3(0.0));
#ifdef USE_LIGHTMAP
vec4 lightMapTexel=texture2D(lightMap,vUv2);
reflectedLight.indirectDiffuse+=lightMapTexel.rgb*lightMapIntensity*RECIPROCAL_PI;
#else
reflectedLight.indirectDiffuse+=vec3(1.0);
#endif
#include <aomap_fragment>
reflectedLight.indirectDiffuse*=diffuseColor.rgb;
vec3 outgoingLight=reflectedLight.indirectDiffuse;
#include <envmap_fragment>
#include <output_fragment>
#include <tonemapping_fragment>
#include <encodings_fragment>
#include <fog_fragment>
#include <premultiplied_alpha_fragment>
#include <dithering_fragment>
}`,Pue=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main(){
#include <uv_vertex>
#include <uv2_vertex>
#include <color_vertex>
#include <morphcolor_vertex>
#include <beginnormal_vertex>
#include <morphnormal_vertex>
#include <skinbase_vertex>
#include <skinnormal_vertex>
#include <defaultnormal_vertex>
#include <normal_vertex>
#include <begin_vertex>
#include <morphtarget_vertex>
#include <skinning_vertex>
#include <displacementmap_vertex>
#include <project_vertex>
#include <logdepthbuf_vertex>
#include <clipping_planes_vertex>
vViewPosition=-mvPosition.xyz;
#include <worldpos_vertex>
#include <envmap_vertex>
#include <shadowmap_vertex>
#include <fog_vertex>
}`,Due=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#if defined(SHADOWMAP_TYPE_ESM)||defined(USE_ENVMAP)
uniform mat4 invViewMatrix;
#endif
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main(){
#include <clipping_planes_fragment>
vec4 diffuseColor=vec4(diffuse,opacity);
ReflectedLight reflectedLight=ReflectedLight(vec3(0.0),vec3(0.0),vec3(0.0),vec3(0.0));
vec3 totalEmissiveRadiance=emissive;
#include <logdepthbuf_fragment>
#include <map_fragment>
#include <color_fragment>
#include <alphamap_fragment>
#include <alphatest_fragment>
#include <specularmap_fragment>
#include <normal_fragment_begin>
#include <normal_fragment_maps>
#include <emissivemap_fragment>
#include <lights_lambert_fragment>
#include <lights_fragment_begin>
#include <lights_fragment_maps>
#include <lights_fragment_end>
#include <aomap_fragment>
vec3 outgoingLight=reflectedLight.directDiffuse+reflectedLight.indirectDiffuse+totalEmissiveRadiance;
#include <envmap_fragment>
#include <output_fragment>
#include <tonemapping_fragment>
#include <encodings_fragment>
#include <fog_fragment>
#include <premultiplied_alpha_fragment>
#include <dithering_fragment>
}`,Bue=`#define NORMAL
#if defined(FLAT_SHADED)||defined(USE_BUMPMAP)||defined(TANGENTSPACE_NORMALMAP)
varying vec3 vViewPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main(){
#include <uv_vertex>
#include <beginnormal_vertex>
#include <morphnormal_vertex>
#include <skinbase_vertex>
#include <skinnormal_vertex>
#include <defaultnormal_vertex>
#include <normal_vertex>
#include <begin_vertex>
#include <morphtarget_vertex>
#include <skinning_vertex>
#include <displacementmap_vertex>
#include <project_vertex>
#include <logdepthbuf_vertex>
#include <clipping_planes_vertex>
#if defined(FLAT_SHADED)||defined(USE_BUMPMAP)||defined(TANGENTSPACE_NORMALMAP)
vViewPosition=-mvPosition.xyz;
#endif
}`,Nue=`#define NORMAL
uniform float opacity;
#if defined(FLAT_SHADED)||defined(USE_BUMPMAP)||defined(TANGENTSPACE_NORMALMAP)
varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main(){
#include <clipping_planes_fragment>
#include <logdepthbuf_fragment>
#include <normal_fragment_begin>
#include <normal_fragment_maps>
gl_FragColor=vec4(packNormalToRGB(normal),opacity);
#ifdef OPAQUE
gl_FragColor.a=1.0;
#endif
}`,Oue=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
varying vec3 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#include <plane_reflection_pars_vertex>
void main(){
#include <uv_vertex>
#include <uv2_vertex>
#include <color_vertex>
#include <morphcolor_vertex>
#include <beginnormal_vertex>
#include <morphnormal_vertex>
#include <skinbase_vertex>
#include <skinnormal_vertex>
#include <defaultnormal_vertex>
#include <normal_vertex>
#include <begin_vertex>
#include <morphtarget_vertex>
#include <skinning_vertex>
#include <displacementmap_vertex>
#include <project_vertex>
#include <plane_reflection_vertex>
#include <logdepthbuf_vertex>
#include <clipping_planes_vertex>
vViewPosition=-mvPosition.xyz;
#include <worldpos_vertex>
#include <shadowmap_vertex>
#include <fog_vertex>
#ifdef USE_TRANSMISSION
vWorldPosition=worldPosition.xyz;
#endif
}`,kue=`#define STANDARD
#ifdef PHYSICAL
#define IOR
#define SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
uniform float ior;
#endif
#ifdef SPECULAR
uniform float specularIntensity;
uniform vec3 specularColor;
#ifdef USE_SPECULARINTENSITYMAP
uniform sampler2D specularIntensityMap;
#endif
#ifdef USE_SPECULARCOLORMAP
uniform sampler2D specularColorMap;
#endif
#endif
#ifdef USE_CLEARCOAT
uniform float clearcoat;
uniform float clearcoatRoughness;
#endif
#if defined(SHADOWMAP_TYPE_ESM)||defined(USE_ENVMAP)
uniform mat4 invViewMatrix;
#endif
#if defined(USE_PLANE_REFLECTION)&&!defined(USE_TRANSMISSION)
uniform mat4 modelMatrix;
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <bsdfs>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
#include <plane_reflection_pars_fragment>
#include <oit_weighted_pars_fragment>
void main(){
#include <clipping_planes_fragment>
vec4 diffuseColor=vec4(diffuse,opacity);
ReflectedLight reflectedLight=ReflectedLight(vec3(0.0),vec3(0.0),vec3(0.0),vec3(0.0));
vec3 totalEmissiveRadiance=emissive;
#include <logdepthbuf_fragment>
#include <map_fragment>
#include <color_fragment>
#include <alphamap_fragment>
#include <alphatest_fragment>
#include <roughnessmap_fragment>
#include <metalnessmap_fragment>
#include <normal_fragment_begin>
#include <normal_fragment_maps>
#include <clearcoat_normal_fragment_begin>
#include <clearcoat_normal_fragment_maps>
#include <emissivemap_fragment>
#include <lights_physical_fragment>
#include <lights_fragment_begin>
#include <lights_fragment_maps>
#include <lights_fragment_end>
#include <aomap_fragment>
vec3 totalDiffuse=reflectedLight.directDiffuse+reflectedLight.indirectDiffuse;
vec3 totalSpecular=reflectedLight.directSpecular+reflectedLight.indirectSpecular;
#include <transmission_fragment>
vec3 outgoingLight=totalDiffuse+totalSpecular+totalEmissiveRadiance;
#ifdef USE_CLEARCOAT
float dotNVcc=saturate(dot(geometry.clearcoatNormal,geometry.viewDir));
vec3 Fcc=F_Schlick(material.clearcoatF0,material.clearcoatF90,dotNVcc);
outgoingLight=outgoingLight*(1.0-material.clearcoat*Fcc)+clearcoatSpecular*material.clearcoat;
#endif
#include <output_fragment>
#include <tonemapping_fragment>
#include <encodings_fragment>
#include <fog_fragment>
#include <premultiplied_alpha_fragment>
#include <dithering_fragment>
#include <oit_weighted_fragment>
}`,Fue=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main(){
#include <color_vertex>
#include <morphcolor_vertex>
#include <begin_vertex>
#include <morphtarget_vertex>
#include <project_vertex>
gl_PointSize=size;
#ifdef USE_SIZEATTENUATION
bool isPerspective=isPerspectiveMatrix(projectionMatrix);
if (isPerspective)gl_PointSize*=(scale/- mvPosition.z);
#endif
#include <logdepthbuf_vertex>
#include <clipping_planes_vertex>
#include <worldpos_vertex>
#include <fog_vertex>
}`,Vue=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main(){
#include <clipping_planes_fragment>
vec3 outgoingLight=vec3(0.0);
vec4 diffuseColor=vec4(diffuse,opacity);
#include <logdepthbuf_fragment>
#include <map_particle_fragment>
#include <color_fragment>
#include <alphatest_fragment>
outgoingLight=diffuseColor.rgb;
#include <output_fragment>
#include <tonemapping_fragment>
#include <encodings_fragment>
#include <fog_fragment>
#include <premultiplied_alpha_fragment>
}`,Uue=`#include <common>
#ifdef USE_SHADOWMAP
varying vec3 vViewPosition;
#endif
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
void main(){
#include <beginnormal_vertex>
#include <morphnormal_vertex>
#include <skinbase_vertex>
#include <skinnormal_vertex>
#include <defaultnormal_vertex>
#include <begin_vertex>
#include <morphtarget_vertex>
#include <skinning_vertex>
#include <project_vertex>
#include <worldpos_vertex>
#include <shadowmap_vertex>
#include <fog_vertex>
#ifdef USE_SHADOWMAP
vViewPosition=-mvPosition.xyz;
#endif
}`,zue=`uniform vec3 color;
uniform float opacity;
#ifdef USE_SHADOWMAP
varying vec3 vViewPosition;
#ifdef SHADOWMAP_TYPE_ESM
uniform mat4 invViewMatrix;
#endif
#endif
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main(){
gl_FragColor=vec4(color,opacity*(1.0-getShadowMask()));
#include <tonemapping_fragment>
#include <encodings_fragment>
#include <fog_fragment>
}`,Gue=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main(){
#include <uv_vertex>
vec4 mvPosition=modelViewMatrix*vec4(0.0,0.0,0.0,1.0);
vec2 scale;
scale.x=length(vec3(modelMatrix[0].x,modelMatrix[0].y,modelMatrix[0].z));
scale.y=length(vec3(modelMatrix[1].x,modelMatrix[1].y,modelMatrix[1].z));
#ifndef USE_SIZEATTENUATION
bool isPerspective=isPerspectiveMatrix(projectionMatrix);
if (isPerspective)scale*=-mvPosition.z;
#endif
vec2 alignedPosition=(position.xy-(center-vec2(0.5)))*scale;
vec2 rotatedPosition;
rotatedPosition.x=cos(rotation)*alignedPosition.x-sin(rotation)*alignedPosition.y;
rotatedPosition.y=sin(rotation)*alignedPosition.x+cos(rotation)*alignedPosition.y;
mvPosition.xy+=rotatedPosition;
gl_Position=projectionMatrix*mvPosition;
#include <logdepthbuf_vertex>
#include <clipping_planes_vertex>
#include <fog_vertex>
}`,Hue=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main(){
#include <clipping_planes_fragment>
vec3 outgoingLight=vec3(0.0);
vec4 diffuseColor=vec4(diffuse,opacity);
#include <logdepthbuf_fragment>
#include <map_fragment>
#include <alphamap_fragment>
#include <alphatest_fragment>
outgoingLight=diffuseColor.rgb;
#include <output_fragment>
#include <tonemapping_fragment>
#include <encodings_fragment>
#include <fog_fragment>
}`,Wue=`#define MASK
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
uniform mat4 textureMatrix;
varying vec3 vViewPosition;
varying vec4 projTexCoord;
void main(){
#include <uv_vertex>
#include <skinbase_vertex>
#ifdef USE_DISPLACEMENTMAP
#include <beginnormal_vertex>
#include <morphnormal_vertex>
#include <skinnormal_vertex>
#endif
#include <begin_vertex>
#include <morphtarget_vertex>
#include <skinning_vertex>
#include <displacementmap_vertex>
#include <project_vertex>
vViewPosition=-mvPosition.xyz;
#include <worldpos_vertex>
projTexCoord=textureMatrix*worldPosition;
#include <logdepthbuf_vertex>
#include <clipping_planes_vertex>
}`,jue=`#define MASK
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
uniform float opacity;
uniform sampler2D depthTexture;
uniform vec2 cameraNearFar;
varying vec3 vViewPosition;
varying vec4 projTexCoord;
void main(){
#include <clipping_planes_fragment>
vec4 diffuseColor=vec4(1.0);
diffuseColor.a=opacity;
#include <map_fragment>
#include <alphamap_fragment>
#include <alphatest_fragment>
#include <logdepthbuf_fragment>
float depth=unpackRGBAToDepth(texture2DProj(depthTexture,projTexCoord));
float viewZ;
if (isOrthographic)
viewZ=-orthographicDepthToViewZ(depth,cameraNearFar.x,cameraNearFar.y);
else
viewZ=-perspectiveDepthToViewZ(depth,cameraNearFar.x,cameraNearFar.y);
float depthTest=(vViewPosition.z>viewZ)?1.0:0.0;
gl_FragColor=vec4(0.0,depthTest,1.0,0.0);
}`,Que=`#define NODE
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
varying vec3 vNormal;
#endif
#include <common>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#include <plane_reflection_pars_vertex>
#if defined(NODE_REFLECT_REFRACT_MX)||defined(NODE_BITMAP_ENV_MX)||defined(NODE_BUMP_BL)||defined(NODE_PHY_SUN_SKY_ENV_MX)||defined(NODE_ENV_SPHERE_MY)||defined(NODE_UV_PROJECTION_AR)||defined(NODE_SUB_TRANSFORM_MX)||defined(NODE_SUB_TRANSFORM_MY)
varying vec3 vWorldPosition;
#endif
#include <node_pars_vertex>
void main(){
#include <beginnormal_vertex>
#include <morphnormal_vertex>
#include <skinbase_vertex>
#include <skinnormal_vertex>
#include <defaultnormal_vertex>
#ifndef FLAT_SHADED
vNormal=normalize(transformedNormal);
#endif
#include <begin_vertex>
#include <morphtarget_vertex>
#include <skinning_vertex>
#include <displacementmap_vertex>
#include <project_vertex>
#include <plane_reflection_vertex>
#include <logdepthbuf_vertex>
#include <clipping_planes_vertex>
vViewPosition=-mvPosition.xyz;
#include <worldpos_vertex>
#include <shadowmap_vertex>
#include <fog_vertex>
#if defined(NODE_REFLECT_REFRACT_MX)||defined(NODE_BITMAP_ENV_MX)||defined(NODE_BUMP_BL)||defined(NODE_PHY_SUN_SKY_ENV_MX)||defined(NODE_ENV_SPHERE_MY)||defined(NODE_UV_PROJECTION_AR)||defined(NODE_SUB_TRANSFORM_MX)||defined(NODE_SUB_TRANSFORM_MY)
vWorldPosition=worldPosition.xyz;
#endif
#include <node_vertex>
}`,$ue=`#define NODE
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <alphatest_pars_fragment>
#include <bsdfs>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#if defined(NODE_NEW_GEOMETRY_BL)||defined(NODE_VECT_TRANSFORM_BL)||defined(NODE_TEX_COORD_BL)||defined(NODE_NORMAL_MAP_BL)||defined(NODE_LAYER_WEIGHT_BL)||defined(NODE_FRESNEL_BL)||defined(NODE_BUMP_BL)||defined(NODE_BSDF_GLASS_BL)||defined(NODE_BSDF_PRINCIPLED_BL)||defined(NODE_TANGENT_BL)||defined(NODE_BITMAP_MX)||defined(NODE_GRADIENT_MX)||defined(NODE_GRADIENT_RAMP_MX)||defined(NODE_NOISE_MX)||defined(NODE_SUB_TRANSFORM_MX)||defined(NODE_SUB_TRANSFORM_MY)||defined(NODE_SAMPLER_INFO_MY)||defined(NODE_INCIDENT)||defined(NODE_POSITION)||defined(NODE_NORMAL)||defined(USE_OSL)||defined(USE_ENVMAP)||defined(SHADOWMAP_TYPE_ESM)&&(defined(NODE_BSDF_DIFFUSE_BL)||defined(NODE_DIFFUSE_BSDF_BL)||defined(NODE_EEVEE_SPECULAR_BL)||defined(NODE_BSDF_GLOSSY_BL)||defined(NODE_BSDF_REFRACTION_BL)||defined(NODE_MATERIAL_MX)||defined(NODE_PHYSICAL_MX)||defined(NODE_STANDARD_SURFACE_AR)||defined(NODE_SHADOW_MATTE_AR))
uniform mat4 invViewMatrix;
#endif
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <lights_node_pars_fragment>
#include <lights_node_gtao_pars_fragment>
#include <shadowmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
#if defined(USE_SSR)
uniform mat4 projectionMatrix;
#endif
#if defined(NODE_VECT_TRANSFORM_BL)||defined(NODE_TEX_COORD_BL)||defined(NODE_NEW_GEOMETRY_BL)||defined(NODE_TANGENT_BL)||defined(NODE_OBJECT_INFO_BL)||defined(NODE_BITMAP_MX)||defined(NODE_GRADIENT_MX)||defined(NODE_GRADIENT_RAMP_MX)||defined(NODE_NOISE_MX)||defined(NODE_SAMPLER_INFO_MY)||defined(NODE_TRANSFORM_MY)||defined(USE_OSL)||defined(USE_PLANE_REFLECTION)||defined(NODE_UV_PROJECTION_AR)||defined(NODE_SUB_TRANSFORM_MX)||defined(NODE_SUB_TRANSFORM_MY)
uniform mat4 modelMatrix;
uniform mat4 invModelMatrix;
#endif
#if defined(NODE_VECT_TRANSFORM_BL)||defined(NODE_NORMAL_MAP_BL)||defined(NODE_NORMAL_BUMP_MX)||defined(NODE_BUMP_2D_MY)||defined(NODE_SAMPLER_INFO_MY)
uniform mat4 modelViewMatrix;
#endif
#if defined(NODE_TEX_IMAGE_BL)
uniform mat3 normalMatrix;
#endif
#if defined(NODE_TEX_COORD_BL)||defined(NODE_NEW_GEOMETRY_BL)||defined(NODE_TANGENT_BL)
uniform vec3 boundingBoxMin;
uniform vec3 boundingBoxMax;
#endif
#if defined(NODE_REFLECT_REFRACT_MX)||defined(NODE_BITMAP_ENV_MX)||defined(NODE_BUMP_BL)||defined(NODE_PHY_SUN_SKY_ENV_MX)||defined(NODE_ENV_SPHERE_MY)||defined(NODE_UV_PROJECTION_AR)||defined(NODE_SUB_TRANSFORM_MX)||defined(NODE_SUB_TRANSFORM_MY)
varying vec3 vWorldPosition;
#endif
#if defined(NODE_TEX_COORD_BL)
uniform vec2 viewWidthHeight;
#endif
#include <ssr_pars_fragment>
#include <plane_reflection_pars_fragment>
#include <node_common_frag>
#include <node_pars_fragment>
#include <oit_weighted_pars_fragment>
void main(){
#include <clipping_planes_fragment>
#include <logdepthbuf_fragment>
#include <normal_fragment_begin>
vec4 outgoingLight=vec4(0.0);
#include <node_fragment>
#if WORLD_NODES==1
outgoingLight.a=1.0;
#endif
#ifdef USE_ALPHATEST
if (outgoingLight.a<alphaTest)
discard;
else
outgoingLight.a=1.0;
#endif
#if defined(OPAQUE)&&!(defined(NODE_HOLDOUT_BL)||defined(NODE_MATTE_SHADOW_MX)||defined(NODE_SHADOW_MATTE_AR)||defined(NODE_AI_SHADOW_MATTE_MY))
outgoingLight.a=1.0;
#endif
gl_FragColor=vec4(outgoingLight);
#include <tonemapping_fragment>
#include <encodings_fragment>
#include <fog_fragment>
#include <premultiplied_alpha_fragment>
#include <dithering_fragment>
#include <normal_output_fragment>
#include <oit_weighted_fragment>
}`;var Yue=`
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
varying vec3 vNormal;
#endif
struct NodeMaterial {
vec3 diffuseColor;
float roughness;
vec3 specularColor;
float specularF90;
vec3 fresnelRefl90;
vec3 refractionColor;
float refractionRoughness;
float refractionIOR;
#ifdef USE_CLEARCOAT
float clearcoat;
float clearcoatRoughness;
vec3 clearcoatF0;
float clearcoatF90;
#endif
#ifdef USE_SHEEN
vec3 sheenColor;
float sheenRoughness;
#endif
};
vec3 clearcoatSpecular=vec3(0.0);
vec3 sheenSpecular=vec3(0.0);
float IBLSheenBRDF(const in vec3 normal,const in vec3 viewDir,const in float roughness){
float dotNV=saturate(dot(normal,viewDir));
float r2=roughness*roughness;
float a=roughness<0.25?-339.2*r2+161.4*roughness-25.9:-8.48*r2+14.3*roughness-9.95;
float b=roughness<0.25?44.0*r2-23.7*roughness+3.26:1.97*r2-3.27*roughness+0.72;
float DG=exp(a*dotNV+b)+(roughness<0.25?0.0:0.1*(roughness-0.25));
return saturate(DG*RECIPROCAL_PI);
}
#if NUM_RECT_AREA_LIGHTS>0
void RE_Direct_RectArea_Node(const in RectAreaLight rectAreaLight,const in GeometricContext geometry,const in NodeMaterial material,inout ReflectedLight reflectedLight){
vec3 normal=geometry.normal;
vec3 viewDir=geometry.viewDir;
vec3 position=geometry.position;
vec3 lightPos=rectAreaLight.position;
vec3 halfWidth=rectAreaLight.halfWidth;
vec3 halfHeight=rectAreaLight.halfHeight;
vec3 lightColor=rectAreaLight.color;
float roughness=material.roughness;
vec3 rectCoords[4];
rectCoords[0]=lightPos+halfWidth-halfHeight;
rectCoords[1]=lightPos-halfWidth-halfHeight;
rectCoords[2]=lightPos-halfWidth+halfHeight;
rectCoords[3]=lightPos+halfWidth+halfHeight;
vec2 uv=LTC_Uv(normal,viewDir,roughness);
vec4 t1=texture2D(ltc_1,uv);
vec4 t2=texture2D(ltc_2,uv);
mat3 mInv=mat3(vec3(t1.x,0,t1.y),vec3( 0,1,0),vec3(t1.z,0,t1.w)
);
vec3 fresnel=(material.specularColor*t2.x+(vec3(1.0)-material.specularColor)*t2.y);
reflectedLight.directSpecular+=lightColor*fresnel*LTC_Evaluate(normal,viewDir,position,mInv,rectCoords);
reflectedLight.directDiffuse+=lightColor*material.diffuseColor*LTC_Evaluate(normal,viewDir,position,mat3(1.0),rectCoords);
}
#endif
void RE_Direct_Node(const in IncidentLight directLight,const in GeometricContext geometry,const in NodeMaterial material,inout ReflectedLight reflectedLight){
float dotNL=saturate(dot(geometry.normal,directLight.direction));
vec3 irradiance=dotNL*directLight.color;
#ifdef USE_CLEARCOAT
float dotNLcc=saturate(dot(geometry.clearcoatNormal,directLight.direction));
vec3 ccIrradiance=dotNLcc*directLight.color;
clearcoatSpecular+=ccIrradiance*BRDF_GGX(directLight.direction,geometry.viewDir,geometry.clearcoatNormal,material.clearcoatF0,material.clearcoatF90,material.clearcoatRoughness);
#endif
#ifdef USE_SHEEN
sheenSpecular+=irradiance*BRDF_Sheen(directLight.direction,geometry.viewDir,geometry.normal,material.sheenColor,material.sheenRoughness);
#endif
reflectedLight.directSpecular+=irradiance*BRDF_GGX(directLight.direction,geometry.viewDir,geometry.normal,material.specularColor,material.specularF90,material.roughness);
reflectedLight.directDiffuse+=irradiance*BRDF_Lambert(material.diffuseColor);
}
void RE_IndirectDiffuse_Node(const in vec3 irradiance,const in GeometricContext geometry,const in NodeMaterial material,inout ReflectedLight reflectedLight){
reflectedLight.indirectDiffuse+=irradiance*BRDF_Lambert(material.diffuseColor);
}
void RE_IndirectSpecular_Node(const in vec3 radiance,const in vec3 irradiance,const in vec3 clearcoatRadiance,const in GeometricContext geometry,const in NodeMaterial material,inout ReflectedLight reflectedLight){
#ifdef USE_CLEARCOAT
clearcoatSpecular+=clearcoatRadiance*BRDF_Specular_GGX_Environment(geometry.viewDir,geometry.clearcoatNormal,material.clearcoatF0,vec3(material.clearcoatF90),material.clearcoatRoughness);
#endif
#ifdef USE_SHEEN
sheenSpecular+=irradiance*material.sheenColor*IBLSheenBRDF(geometry.normal,geometry.viewDir,material.sheenRoughness);
#endif
#ifdef MT_BLENDER
vec3 specEnv=BRDF_Specular_GGX_Environment(geometry.viewDir,geometry.normal,material.specularColor,material.fresnelRefl90,material.roughness);
#elif defined(MT_MAX)
float alphaEnv=pow2(pow2(material.roughness));
vec3 specEnv=material.specularColor/(1.0-alphaEnv+PI*alphaEnv);
#elif defined(MT_MAYA)
vec3 specEnv=BRDF_Specular_GGX_Environment(geometry.viewDir,geometry.normal,material.specularColor,material.fresnelRefl90,material.roughness);
#else
vec3 specEnv=vec3(1.0);
#endif
reflectedLight.indirectSpecular+=radiance*specEnv;
}
void RE_Refraction_Node(const vec3 refraction,const NodeMaterial material,inout vec3 refractedLight){
refractedLight+=refraction*material.refractionColor;
}
void RE_DirectDiffuseOnly_Node(const in IncidentLight directLight,const in GeometricContext geometry,const in NodeMaterial material,inout ReflectedLight reflectedLight){
float dotNL=saturate(dot(geometry.normal,directLight.direction));
vec3 irradiance=dotNL*directLight.color;
reflectedLight.directDiffuse+=irradiance*BRDF_Lambert(material.diffuseColor);
}
void RE_IndirectDiffuse_Empty(const in vec3 irradiance,const in GeometricContext geometry,const in NodeMaterial material,inout ReflectedLight reflectedLight){}
#define RE_Direct_RectArea RE_Direct_RectArea_Node`,Xue=`#ifdef USE_GTAO
uniform sampler2D gtaoMap;
uniform vec2 currResolution;
float calcGTAOVisibilityFix(vec3 viewDir,vec3 normal){
float slopeCoeff=saturate(dot(viewDir,normal));
return pow(2.0/(slopeCoeff+1.0),log2(PI)-1.0);
}
float calcSolidAngle(float radiusAngle){
return PI2*(1.0-cos(radiusAngle));
}
float calcSolidAnglesIntersectionApprox(float radiusAngle0,float radiusAngle1,float distanceAngle){
float rp=radiusAngle0,rl=radiusAngle1,d=distanceAngle;
float rDiff=abs(rp-rl);
return PI2*(1.0-cos(min(rp,rl)))*smoothstep(0.0,1.0,1.0 -
(d-rDiff)/(rp+rl-rDiff));
}
float calcGTSOVisibility(float aoVisibility,vec3 bentNormal,vec3 viewDir,vec3 normal,float roughness){
aoVisibility=saturate(aoVisibility*calcGTAOVisibilityFix(viewDir,normal));
float radiusAngleVisCone=acos(clamp(sqrt(1.0-aoVisibility),-1.0,1.0));
float radiusAngleSpecCone=acos(clamp(exp2(-3.32193*pow2(roughness)),-1.0,1.0));
radiusAngleSpecCone=max(0.001,radiusAngleSpecCone);
vec3 specularConeAxis=-reflect(viewDir,normal);
float distanceAngle=acos(clamp(dot(bentNormal,specularConeAxis),-1.0,1.0));
float solidAngleIntersection=calcSolidAnglesIntersectionApprox(radiusAngleVisCone,radiusAngleSpecCone,distanceAngle);
float solidAngleSpecular=calcSolidAngle(radiusAngleSpecCone);
float specVisibility=solidAngleIntersection/solidAngleSpecular;
return mix(specVisibility,1.0,aoVisibility);
}
#endif`,que=`#ifdef USE_GTAO
reflectedLight.indirectSpecular*=calcGTSOVisibility(gtaoVisibility,gtaoBentNormal,gtaoViewDir,gtaoNormal,gtaoRoughness);
#endif`,Kue=`#if NORMAL_OUTPUT==1
gl_FragColor=vec4(packNormalToRGB(normal),gl_FragColor.a);
#endif`,Zue=`#ifdef USE_SSR
uniform sampler2D ssrSourceBuffer;
uniform sampler2D ssrDepthBuffer;
uniform sampler2D ssrBackfaceDepthBuffer;
uniform mat4 invProjectionMatrix;
uniform vec2 ssrResolution;
uniform float ssrThickness;
uniform float ssrStride;
uniform float ssrJitter;
uniform float ssrMaxDistance;
#ifdef USE_SSR_REFRACT
#define STEPS_FADE_AMOUNT 0.1
#define SCREEN_FADE_THRESHOLD 0.6
#else
#define STEPS_FADE_AMOUNT 1.0
#define SCREEN_FADE_THRESHOLD 0.4
#endif
vec3 deproject(vec3 p){
vec4 res=invProjectionMatrix*vec4(p,1);
return res.xyz/res.w;
}
bool doesIntersect(float rayzmax,float rayzmin,vec2 uv){
float sceneZMin=texture2D(ssrDepthBuffer,uv).r;
#ifdef USE_SSR_REFRACT
return rayzmin>=(sceneZMin-ssrThickness)&&rayzmax<=sceneZMin;
#else
float sceneZMax=texture2D(ssrBackfaceDepthBuffer,uv).r;
return rayzmin>=sceneZMax&&rayzmax<=sceneZMin;
#endif
}
float distanceSquared(vec2 a,vec2 b){a-=b;return dot(a,a);}
void swapIfBigger(inout float a,inout float b){
if (a>b){
float t=a;
a=b;
b=t;
}
}
bool isOutsideUvBounds(float x){return x<0.0||x>1.0;}
bool isOutsideUvBounds(vec2 uv){return isOutsideUvBounds(uv.x)||isOutsideUvBounds(uv.y);}
vec3 computeSSR(vec3 color,vec3 normal,float ior){
vec2 uv=gl_FragCoord.xy/ssrResolution;
vec2 screenCoord=uv*2.0-vec2(1,1);
float nearClip=deproject(vec3(0,0,-1)).z;
vec3 ray=deproject(vec3(screenCoord,-1));
ray/=ray.z;
float depthSample=-vViewPosition.z;
vec3 vpos=depthSample*ray;
#ifdef USE_SSR_REFRACT
vec3 dir=normalize(refract(normalize(vpos),normalize(normal),1.0/ior));
#else
vec3 dir=normalize(reflect(normalize(vpos),normalize(normal)));
#endif
float maxDist=ssrMaxDistance;
float rayLength=(vpos.z+dir.z*maxDist)>nearClip?(nearClip-vpos.z)/dir.z:maxDist;
vec3 csOrig=vpos;
vec3 csEndPoint=csOrig+dir*rayLength;
vec4 H0=projectionMatrix*vec4(csOrig,1.0);
vec4 H1=projectionMatrix*vec4(csEndPoint,1.0);
float k0=1.0/H0.w,k1=1.0/H1.w;
vec3 Q0=csOrig.xyz*k0,Q1=csEndPoint.xyz*k1;
vec2 P0=H0.xy*k0,P1=H1.xy*k1;
P0=P0*0.5+vec2(0.5),P1=P1*0.5+vec2(0.5);
#ifndef SSR_SIMPLE_REFRACT
P0*=ssrResolution,P1*=ssrResolution;
P1+=vec2((distanceSquared(P0,P1)<0.0001)?0.01:0.0);
vec2 delta=P1-P0;
bool permute=false;
if (abs(delta.x)<abs(delta.y)){
permute=true;delta=delta.yx;P0=P0.yx;P1=P1.yx;
}
float stepDir=sign(delta.x);
float invdx=stepDir/delta.x;
vec3 dQ=(Q1-Q0)*invdx;
float dk=(k1-k0)*invdx;
vec2 dP=vec2(stepDir,delta.y*invdx);
float pixelStride=ssrStride;
float jitterMod=(gl_FragCoord.x+gl_FragCoord.y)*0.25;
vec4 PQK=vec4(P0,Q0.z,k0);
vec4 dPQK=vec4(dP,dQ.z,dk);
dPQK*=pixelStride;
PQK+=dPQK*mod(jitterMod,1.0)*ssrJitter;
float end=P1.x*stepDir;
float prevZMaxEstimate=PQK.z/PQK.w;
float rayZMin=prevZMaxEstimate,rayZMax=prevZMaxEstimate;
float stepped=0.0;
vec2 hitUV;
bool intersected=false;
for (float stepCount=1.0;stepCount<=float(MAX_STEPS);stepCount ++){
PQK+=dPQK;
rayZMin=prevZMaxEstimate;
rayZMax=(dPQK.z*0.5+PQK.z)/(dPQK.w*0.5+PQK.w);
prevZMaxEstimate=rayZMax;
swapIfBigger(rayZMax,rayZMin);
stepped=stepCount;
hitUV=(permute?PQK.yx: PQK.xy)/ssrResolution;
if (isOutsideUvBounds(hitUV))break;
intersected=doesIntersect(rayZMax,rayZMin,hitUV);
if (intersected||(P0.x*stepDir)>end)break;
}
if (intersected&&pixelStride>1.0){
PQK-=dPQK;
dPQK/=ssrStride;
float ogStride=pixelStride*0.5;
float currStride=pixelStride;
prevZMaxEstimate=PQK.z/PQK.w;
rayZMin=prevZMaxEstimate,rayZMax=prevZMaxEstimate;
for(int j=0;j<int(BINARY_SEARCH_ITERATIONS);j ++){
PQK+=dPQK*currStride;
rayZMin=prevZMaxEstimate;
rayZMax=(dPQK.z*0.5+PQK.z)/(dPQK.w*0.5+PQK.w);
prevZMaxEstimate=rayZMax;
swapIfBigger(rayZMax,rayZMin);
vec2 newUV=(permute?PQK.yx: PQK.xy)/ssrResolution;
ogStride*=0.5;
if (doesIntersect(rayZMax,rayZMin,newUV)){
hitUV=newUV;
currStride=-ogStride;
} else {
currStride=ogStride;
}
}
}
vec3 result=color;
#ifdef USE_SSR_REFRACT
#endif
if (intersected){
vec4 col=texture2D(ssrSourceBuffer,hitUV);
vec2 ndc=abs(hitUV*2.0-1.0);
float maxndc=max(ndc.x,ndc.y);
float fadeVal =
(1.0-(max(0.0,maxndc-SCREEN_FADE_THRESHOLD)/(1.0-SCREEN_FADE_THRESHOLD)))*
(1.0-STEPS_FADE_AMOUNT*(stepped/float(MAX_STEPS)));
col.a=fadeVal;
result=mix(result,col.rgb,col.a);
}
#else
vec3 result=texture2D(ssrSourceBuffer,P1).xyz;
#endif
return result;
}
#endif`,Jue=`#ifdef USE_PLANE_REFLECTION
uniform mat4 planeReflTextureMatrix;
varying vec4 vPlaneReflUv;
#endif`,ede=`#ifdef USE_PLANE_REFLECTION
uniform sampler2D planeReflTexture;
uniform mat4 planeReflTextureMatrix;
uniform vec3 planeReflDir;
uniform vec3 planeReflBoundingBoxMin;
uniform vec3 planeReflBoundingBoxMax;
uniform mat4 planeReflInvModelMatrix;
uniform float planeReflFalloff;
varying vec4 vPlaneReflUv;
vec3 computePlaneReflection(vec3 radiance,float roughness,vec3 position,vec3 normal,mat4 modelMatrix){
vec3 posRefl=(planeReflInvModelMatrix*invViewMatrix*vec4(position,1.0)).xyz;
if (any(lessThan(posRefl,planeReflBoundingBoxMin))||any(greaterThan(posRefl,planeReflBoundingBoxMax)))
return radiance;
vec3 norWorld=transformDirection(normal,invViewMatrix);
vec3 uvNormalOffsetScale;
uvNormalOffsetScale.x=length(vec3(modelMatrix[0].xyz));
uvNormalOffsetScale.y=length(vec3(modelMatrix[1].xyz));
uvNormalOffsetScale.z=length(vec3(modelMatrix[2].xyz));
vec4 uvNormalOffset=planeReflTextureMatrix*vec4((norWorld-planeReflDir)*uvNormalOffsetScale,0.0);
vec3 result=texture2DProj(planeReflTexture,vPlaneReflUv+uvNormalOffset).rgb;
float falloffFactor;
if (planeReflFalloff<EPSILON)
falloffFactor=0.0;
else if (posRefl.y>0.0)
falloffFactor=1.0-clamp((planeReflBoundingBoxMax.y-posRefl.y)/(planeReflBoundingBoxMax.y*(planeReflFalloff)),0.0,1.0);
else
falloffFactor=1.0-clamp((planeReflBoundingBoxMin.y-posRefl.y)/(planeReflBoundingBoxMin.y*(planeReflFalloff)),0.0,1.0);
result=mix(result,radiance,falloffFactor);
result=mix(result,radiance,(roughness<0.0526)?0.0:saturate(10.0*roughness));
return result;
}
#endif`,tde=`#ifdef USE_PLANE_REFLECTION
vPlaneReflUv=planeReflTextureMatrix*modelMatrix*vec4(transformed,1.0);
#endif`,nde=`#ifdef USE_OIT_WEIGHTED
layout(location=1)out float outFragR;
#endif`,rde=`#ifdef USE_OIT_WEIGHTED
float weight=1.0-gl_FragCoord.z;
outFragR=gl_FragColor.a*weight;
outFragColor=vec4(gl_FragColor.rgb*weight,gl_FragColor.a);
#endif`,ode=`
#define LUM_WEIGHTS vec3(0.2126,0.7152,0.0722)
#define LUM_WEIGHTS_MAYA vec3(0.3,0.59,0.11)
#define LUMENS_PER_WATT 683.0
#define MAX_ENV_COORDS_DIR 0
#define MAX_ENV_COORDS_REFLECT 1
#define MAX_ENV_COORDS_REFRACT 2
#if defined(NODE_COLOR_CONVERT_AR)||defined(NODE_COLOR_CORRECT_AR)||defined(NODE_COMBINE_COLOR_BL)||defined(NODE_SEPARATE_COLOR_BL)||defined(NODE_COMBHSV_BL)||defined(NODE_SEPHSV_BL)||defined(NODE_HUE_SAT_BL)||defined(NODE_COLOR_CORRECTION_MX)||defined(NODE_COMPOSITE_LAYER_MX)||defined(NODE_COLOR_CORRECT_MY)||defined(USE_OSL)
#define HSV_NODES
#endif
#define OPENPBR_EMISSION_LUM_FACTOR 0.001
float powCompat(const in float val,const in float power){
if (power==0.0)
return 1.0;
else if (val<0.0){
if (mod(-power,2.0)==0.0)
return pow(abs(val),power);
else
return -pow(abs(val),power);
} else if (val==0.0)
return 0.0;
return pow(abs(val),power);
}
float maxFromRGB(vec3 rgb){
return max(max(rgb.r,rgb.g),rgb.b);
}
vec3 swizzleUpZ(const vec3 vec){
return vec3(vec[0],-vec[2],vec[1]);
}
vec3 swizzleUpY(const vec3 vec){
return vec3(vec[0],vec[2],-vec[1]);
}
float getSmoothFactor(float a,float b,float smoothness){
return max(smoothness-abs(a-b),0.0)/smoothness;
}
float smoothMin(float a,float b,float smoothness){
float smoothFac=getSmoothFactor(a,b,smoothness);
return min(a,b)-smoothFac*smoothFac*smoothFac*smoothness*(1.0/6.0);
}
float smoothMax(float a,float b,float smoothness){
float smoothFac=getSmoothFactor(a,b,smoothness);
return max(a,b)+smoothFac*smoothFac*smoothFac*smoothness*(1.0/6.0);
}
float mat3GetDeterminant(mat3 mat){
return mat[0][0]*mat[1][1]*mat[2][2]
+ mat[0][2]*mat[1][0]*mat[2][1]
+ mat[0][1]*mat[1][2]*mat[2][0]
- mat[0][2]*mat[1][1]*mat[2][0]
- mat[0][0]*mat[1][2]*mat[2][1]
- mat[0][1]*mat[1][0]*mat[2][2];
}
mat3 mat3RotateX(float angle){
float s=sin(angle),c=cos(angle);
return mat3(1.0,0.0,0.0,0.0,c,s,0.0,-s,c);
}
mat3 mat3RotateY(float angle){
float s=sin(angle),c=cos(angle);
return mat3(c,0.0,-s,0.0,1.0,0.0,s,0.0,c);
}
mat3 mat3RotateZ(float angle){
float s=sin(angle),c=cos(angle);
return mat3(c,s,0.0,-s,c,0.0,0.0,0.0,1.0);
}
vec3 vec3RotateXAngle(vec3 vector,float angle){
return mat3RotateX(angle)*vector;
}
vec3 vec3RotateYAngle(vec3 vector,float angle){
return mat3RotateY(angle)*vector;
}
vec3 vec3RotateZAngle(vec3 vector,float angle){
return mat3RotateZ(angle)*vector;
}
vec4 eulerToAxisAngle(vec3 euler){
float c1=cos(euler.x/2.0),c2=cos(euler.y/2.0),c3=cos(euler.z/2.0);
float s1=sin(euler.x/2.0),s2=sin(euler.y/2.0),s3=sin(euler.z/2.0);
vec4 axisAngle=vec4(s1*c2*c3-c1*s2*s3,c1*s2*c3+s1*c2*s3,c1*c2*s3-s1*s2*c3,2.0*acos(c1*c2*c3+s1*s2*s3)
);
axisAngle.xyz=length(axisAngle.xyz)>0.0?normalize(axisAngle.xyz):vec3(1.0,0.0,0.0);
return axisAngle;
}
mat3 axisAngleToMat3(vec3 axis,float angle){
float s=sin(angle),c=cos(angle);
float t=1.0-c;
float x=axis.x,y=axis.y,z=axis.z;
float tx=t*x,ty=t*y;
return mat3(tx*x+c,tx*y-s*z,tx*z+s*y,tx*y+s*z,ty*y+c,ty*z-s*x,tx*z-s*y,ty*z+s*x,t*z*z+c);
}
mat3 toMat3(mat4 mat){
return mat3(mat[0][0],mat[0][1],mat[0][2],mat[1][0],mat[1][1],mat[1][2],mat[2][0],mat[2][1],mat[2][2]);
}
mat4 toMat4(mat3 mat){
return mat4(mat[0][0],mat[0][1],mat[0][2],0.0,mat[1][0],mat[1][1],mat[1][2],0.0,mat[2][0],mat[2][1],mat[2][2],0.0,0.0,0.0,0.0,1.0);
}
mat4 translationToMat4(vec3 v){
return mat4(1.0,0.0,0.0,0.0,0.0,1.0,0.0,0.0,0.0,0.0,1.0,0.0,v.x,v.y,v.z,1.0);
}
mat4 scalingToMat4(vec3 v){
return mat4(v.x,0.0,0.0,0.0,0.0,v.y,0.0,0.0,0.0,0.0,v.z,0.0,0.0,0.0,0.0,1.0);
}
vec4 nodeTexelToLinear(in vec4 color,in int sourceType){
if (sourceType==1)
return vec4(pow(color.rgb,vec3(2.2)),color.a);
else
return color;
}
vec3 xyz_to_sRGB(vec3 xyz){
mat3 convMat=mat3(3.2406,-0.9689,0.0557,-1.5372,1.8758,-0.2040,-0.4986,0.0415,1.0570
);
return convMat*xyz;
}
vec3 xyY_to_XYZ(float x,float y,float Y){
float X=0.0;
float Z=0.0;
if (y != 0.0){
X=(Y/y)*x;
Z=(Y/y)*(1.0-x-y);
}
return vec3(X,Y,Z);
}
#if defined HSV_NODES
void hsvToRGB(vec4 hsv,out vec4 outCol)
{
float i,f,p,q,t,h,s,v;
vec3 rgb;
h=hsv[0];
s=hsv[1];
v=hsv[2];
if (s==0.0)
rgb=vec3(v,v,v);
else {
if (h==1.0)
h=0.0;
h*=6.0;
i=floor(h);
f=h-i;
rgb=vec3(f,f,f);
p=v*(1.0-s);
q=v*(1.0-(s*f));
t=v*(1.0-(s*(1.0-f)));
if (i==0.0)
rgb=vec3(v,t,p);
else if (i==1.0)
rgb=vec3(q,v,p);
else if (i==2.0)
rgb=vec3(p,v,t);
else if (i==3.0)
rgb=vec3(p,q,v);
else if (i==4.0)
rgb=vec3(t,p,v);
else
rgb=vec3(v,p,q);
}
outCol=vec4(rgb,hsv.w);
}
void rgbToHSV(vec4 rgb,out vec4 outCol)
{
float cmax,cmin,h,s,v,cdelta;
vec3 c;
cmax=max(rgb[0],max(rgb[1],rgb[2]));
cmin=min(rgb[0],min(rgb[1],rgb[2]));
cdelta=cmax-cmin;
v=cmax;
if (cmax != 0.0)
s=cdelta/cmax;
else {
s=0.0;
h=0.0;
}
if (s==0.0)
h=0.0;
else {
c=(vec3(cmax,cmax,cmax)-rgb.xyz)/cdelta;
if (rgb.x==cmax)h=c[2]-c[1];
else if (rgb.y==cmax)h=2.0+c[0]-c[2];
else h=4.0+c[1]-c[0];
h/=6.0;
if (h<0.0)
h+=1.0;
}
outCol=vec4(h,s,v,rgb.w);
}
#endif
#if defined(NODE_REFLECT_REFRACT_MX)||defined(NODE_BITMAP_ENV_MX)||defined(NODE_ENV_SPHERE_MY)
vec4 sampleEquirectangular(sampler2D map,vec3 reflectVec,mat3 uvTransform,int encoding)
{
reflectVec=normalize(reflectVec);
vec2 sampleUV;
sampleUV.y=asin(clamp(reflectVec.y,-1.0,1.0))*RECIPROCAL_PI+0.5;
sampleUV.x=atan(reflectVec.x,reflectVec.z)*RECIPROCAL_PI2+0.5;
sampleUV.y*=-1.0;
const float seamWidth=0.15;
const float seamBiasFactor=-10.0;
float seam=max(0.0,1.0-abs (reflectVec.x)/seamWidth)*
clamp (1.0-reflectVec.z/seamWidth,0.0,1.0);
sampleUV=(uvTransform*vec3(sampleUV,1.0)).xy;
return texture2D(map,sampleUV,seamBiasFactor*seam);
}
#endif
#if defined(NODE_FRESNEL_BL)||defined(NODE_LAYER_WEIGHT_BL)||defined(NODE_FALLOFF_MX)||defined(NODE_BSDF_GLASS_BL)||defined(NODE_BSDF_PRINCIPLED_BL)
float fresnelReflection(const vec3 dir,const vec3 normal,const float ior){
float cosTheta=clamp(abs(dot(dir,normal)),-1.0,1.0);
float gSquared=pow2(ior)+pow2(cosTheta)-1.0;
if (gSquared<0.0)return 1.0;
float g=sqrt(gSquared);
return 0.5*pow2((g-cosTheta)/(g+cosTheta))
* (1.0+pow2(((g+cosTheta)*cosTheta-1.0)/
((g-cosTheta)*cosTheta+1.0)
));
}
#endif
#if defined(NODE_BITMAP_MX)||defined(NODE_BITMAP_ENV_MX)||defined(NODE_GRADIENT_MX)||defined(NODE_GRADIENT_RAMP_MX)
#define MAPPING_EXPLICIT_MAP_CHANNEL 1
#define MAPPING_VERTEX_COLOR_CHANNEL 2
#define MAPPING_PLANAR_OBJECT_XYZ 3
#define MAPPING_PLANAR_WORLD_XYZ 4
#define AXIS_XY 1
#define AXIS_YZ 2
#define AXIS_ZX 3
#endif
#if defined(NODE_BITMAP_MX)||defined(NODE_BITMAP_ENV_MX)||defined(NODE_BUMP_MX)||defined(NODE_GRADIENT_MX)||defined(NODE_GRADIENT_RAMP_MX)||defined(NODE_PLACE_2D_TEXTURE_MY)
mat3 calcUvTransform(float uOffset,float vOffset,float uTiling,float vTiling,float wAngle)
{
if (abs(uOffset)<EPSILON&&abs(vOffset)<EPSILON &&
(abs(uTiling-1.0))<EPSILON&&(abs(vTiling-1.0))<EPSILON &&
abs(wAngle)<EPSILON)
return mat3(1.0);
float sx=uTiling;
float sy=vTiling;
float c=cos(-wAngle);
float s=sin(-wAngle);
#if defined(NODE_PLACE_2D_TEXTURE_MY)
float tx=uOffset;
float ty=vOffset;
float cx=0.5;
float cy=0.5;
return mat3(c*sx,s*sx,0.0,-s*sy,c*sy,0.0,s*(ty+sy-cy)+c*(tx-cx)+cx,-c*(ty+sy-cy)+s*(tx-cx)-cy+1.0,1.0);
#else
float tx=-uOffset;
float ty=-vOffset;
float cx=uOffset+0.5;
float cy=vOffset+0.5;
return mat3(sx*c,-sy*s,0.0,sx*s,sy*c,0.0,-sx*(c*cx+s*cy)+cx+tx,-sy*(- s*cx+c*cy)+cy+ty,1.0);
#endif
}
#endif
#if defined(NODE_NOISE_MX)
mat4 calcXYZTransform(vec3 offset,vec3 tiling,vec3 angle){
mat4 rot=mat4(cos(angle.y)*cos(angle.z),cos(angle.x)*sin(angle.z)+sin(angle.x)*sin(angle.y)*cos(angle.z),sin(angle.x)*sin(angle.z)-cos(angle.x)*sin(angle.y)*cos(angle.z),0.0,-cos(angle.y)*sin(angle.z),cos(angle.x)*cos(angle.z)-sin(angle.x)*sin(angle.y)*sin(angle.z),cos(angle.x)*sin(angle.y)*sin(angle.z)+sin(angle.x)*cos(angle.z),0.0,sin(angle.y),-sin(angle.x)*cos(angle.y),cos(angle.x)*cos(angle.y),0.0,0.0,0.0,0.0,1.0
);
mat4 til=mat4(tiling.x,0.0,0.0,0.0,0.0,tiling.y,0.0,0.0,0.0,0.0,tiling.z,0.0,0.0,0.0,0.0,1.0
);
mat4 off=mat4(1.0,0.0,0.0,0.0,0.0,1.0,0.0,0.0,0.0,0.0,1.0,0.0,offset.x,offset.y,offset.z,1.0
);
return (til*rot*off);
}
#endif
#if defined(NODE_TEX_NOISE_BL)||defined(NODE_TEX_WAVE_BL)||defined(NODE_NOISE_MX)||defined(USE_OSL)||defined(NODE_NOISE_MY)
#define NOISE_AMP_HACK 0.75
#define NOISE_BLENDER_MEAN 0.78
#define NOISE_SCALE_HACK 0.5
#define noiseModulo(x)(x-floor(x*(1.0/289.0))*289.0)
vec4 noisePermute(vec4 x){
return noiseModulo(((x*34.0)+1.0)*x);
}
vec4 taylorInvSqrt(vec4 r){
return 1.79284291400159-0.85373472095314*r;
}
float taylorInvSqrt(float r){
return 1.79284291400159-0.85373472095314*r;
}
float noisePerlin(vec3 v){
const vec2 C=vec2(1.0/6.0,1.0/3.0);
const vec4 D=vec4(0.0,0.5,1.0,2.0);
vec3 i=floor(v+dot(v,C.yyy));
vec3 x0=v-i+dot(i,C.xxx);
vec3 g=step(x0.yzx,x0.xyz);
vec3 l=1.0-g;
vec3 i1=min(g.xyz,l.zxy);
vec3 i2=max(g.xyz,l.zxy);
vec3 x1=x0-i1+C.xxx;
vec3 x2=x0-i2+C.yyy;
vec3 x3=x0-D.yyy;
i=noiseModulo(i);
vec4 p=noisePermute(noisePermute(noisePermute(i.z+vec4(0.0,i1.z,i2.z,1.0))
+ i.y+vec4(0.0,i1.y,i2.y,1.0))+i.x+vec4(0.0,i1.x,i2.x,1.0));
float n_=0.142857142857;
vec3 ns=n_*D.wyz-D.xzx;
vec4 j=p-49.0*floor(p*ns.z*ns.z);
vec4 x_=floor(j*ns.z);
vec4 y_=floor(j-7.0*x_);
vec4 x=x_*ns.x+ns.yyyy;
vec4 y=y_*ns.x+ns.yyyy;
vec4 h=1.0-abs(x)-abs(y);
vec4 b0=vec4(x.xy,y.xy);
vec4 b1=vec4(x.zw,y.zw);
vec4 s0=floor(b0)*2.0+1.0;
vec4 s1=floor(b1)*2.0+1.0;
vec4 sh=-step(h,vec4(0.0));
vec4 a0=b0.xzyw+s0.xzyw*sh.xxyy;
vec4 a1=b1.xzyw+s1.xzyw*sh.zzww;
vec3 p0=vec3(a0.xy,h.x);
vec3 p1=vec3(a0.zw,h.y);
vec3 p2=vec3(a1.xy,h.z);
vec3 p3=vec3(a1.zw,h.w);
vec4 norm=taylorInvSqrt(vec4(dot(p0,p0),dot(p1,p1),dot(p2,p2),dot(p3,p3)));
p0*=norm.x;
p1*=norm.y;
p2*=norm.z;
p3*=norm.w;
vec4 m=max(0.6-vec4(dot(x0,x0),dot(x1,x1),dot(x2,x2),dot(x3,x3)),0.0);
m=m*m;
return 42.0*dot(m*m,vec4(dot(p0,x0),dot(p1,x1),dot(p2,x2),dot(p3,x3)));
}
vec4 permute(vec4 x){
return mod(((x*34.0)+1.0)*x,289.0);
}
float permute(float x){
return floor(mod(((x*34.0)+1.0)*x,289.0));
}
vec4 grad4(float j,vec4 ip){
const vec4 ones=vec4(1.0,1.0,1.0,-1.0);
vec4 p,s;
p.xyz=floor( fract (vec3(j)*ip.xyz)*7.0)*ip.z-1.0;
p.w=1.5-dot(abs(p.xyz),ones.xyz);
s=vec4(lessThan(p,vec4(0.0)));
p.xyz=p.xyz+(s.xyz*2.0-1.0)*s.www;
return p;
}
float snoise(vec4 v){
const vec2 C=vec2(0.138196601125010504,0.309016994374947451);
vec4 i=floor(v+dot(v,C.yyyy));
vec4 x0=v-i+dot(i,C.xxxx);
vec4 i0;
vec3 isX=step( x0.yzw,x0.xxx );
vec3 isYZ=step( x0.zww,x0.yyz );
i0.x=isX.x+isX.y+isX.z;
i0.yzw=1.0-isX;
i0.y+=isYZ.x+isYZ.y;
i0.zw+=1.0-isYZ.xy;
i0.z+=isYZ.z;
i0.w+=1.0-isYZ.z;
vec4 i3=clamp( i0,0.0,1.0 );
vec4 i2=clamp( i0-1.0,0.0,1.0 );
vec4 i1=clamp( i0-2.0,0.0,1.0 );
vec4 x1=x0-i1+1.0*C.xxxx;
vec4 x2=x0-i2+2.0*C.xxxx;
vec4 x3=x0-i3+3.0*C.xxxx;
vec4 x4=x0-1.0+4.0*C.xxxx;
i=mod(i,289.0);
float j0=permute( permute( permute( permute(i.w)+i.z)+i.y)+i.x);
vec4 j1=permute( permute( permute( permute (i.w+vec4(i1.w,i2.w,i3.w,1.0 ))
+ i.z+vec4(i1.z,i2.z,i3.z,1.0 ))
+ i.y+vec4(i1.y,i2.y,i3.y,1.0 ))
+ i.x+vec4(i1.x,i2.x,i3.x,1.0 ));
vec4 ip=vec4(1.0/294.0,1.0/49.0,1.0/7.0,0.0);
vec4 p0=grad4(j0,ip);
vec4 p1=grad4(j1.x,ip);
vec4 p2=grad4(j1.y,ip);
vec4 p3=grad4(j1.z,ip);
vec4 p4=grad4(j1.w,ip);
vec4 norm=taylorInvSqrt(vec4(dot(p0,p0),dot(p1,p1),dot(p2,p2),dot(p3,p3)));
p0*=norm.x;
p1*=norm.y;
p2*=norm.z;
p3*=norm.w;
p4*=taylorInvSqrt(dot(p4,p4));
vec3 m0=max(0.6-vec3(dot(x0,x0),dot(x1,x1),dot(x2,x2)),0.0);
vec2 m1=max(0.6-vec2(dot(x3,x3),dot(x4,x4)),0.0);
m0=m0*m0;
m1=m1*m1;
return 49.0*( dot(m0*m0,vec3( dot( p0,x0 ),dot( p1,x1 ),dot( p2,x2 )))
+ dot(m1*m1,vec2( dot( p3,x3 ),dot( p4,x4 ))));
}
float noiseBlender(vec3 p){
return 0.5*NOISE_AMP_HACK*(noisePerlin(NOISE_SCALE_HACK*vec3(p.x,p.y,p.z)))+0.5;
}
float noiseSmooth(vec3 p,float octaveLenPerPixel,float falloffFactor,float dispersionFactor){
float mixFac=mix(1.0,smoothstep(0.0,1.0,octaveLenPerPixel)*falloffFactor,dispersionFactor);
return mix(noiseBlender(p),NOISE_BLENDER_MEAN,mixFac);
}
#define MAX_OCTAVES_NUM 16
float noiseTurbulence(vec3 p,float octaves,float octaveLenPerPixel,float falloffFactor,float dispersionFactor){
float fscale=1.0;
float amp=1.0;
float sum=0.0;
octaves=clamp(octaves,0.0,16.0);
int octavesInt=int(octaves);
for (int i=0;i<=MAX_OCTAVES_NUM;i++){
#if __VERSION__==300
if (i<=octavesInt){
float t=noiseSmooth(fscale*p,octaveLenPerPixel,falloffFactor,dispersionFactor);
sum+=t*amp;
amp*=0.5;
fscale*=2.0;
octaveLenPerPixel*=2.0;
} else {
i=MAX_OCTAVES_NUM;
}
#else
if (i>octavesInt)break;
float t=noiseSmooth(fscale*p,octaveLenPerPixel,falloffFactor,dispersionFactor);
sum+=t*amp;
amp*=0.5;
fscale*=2.0;
octaveLenPerPixel*=2.0;
#endif
}
float octavesFrac=fract(octaves);
float octavesCoeff=pow(2.0,float(octavesInt));
if (octavesFrac != 0.0){
float t=noiseSmooth(fscale*p,octaveLenPerPixel,falloffFactor,dispersionFactor);
float sum2=sum+t*amp;
sum*=octavesCoeff/(2.0*octavesCoeff-1.0);
sum2*=2.0*octavesCoeff/(4.0*octavesCoeff-1.0);
return mix(sum,sum2,octavesFrac);
} else {
return sum*octavesCoeff/(2.0*octavesCoeff-1.0);
}
}
#endif
#if (defined(USE_OSL)||defined(NODE_WAVELENGTH_BL))&&__VERSION__==300
vec3 cieColorMatch[81]=vec3[](vec3(0.0014,0.0000,0.0065),vec3(0.0022,0.0001,0.0105),vec3(0.0042,0.0001,0.0201),vec3(0.0076,0.0002,0.0362),vec3(0.0143,0.0004,0.0679),vec3(0.0232,0.0006,0.1102),vec3(0.0435,0.0012,0.2074),vec3(0.0776,0.0022,0.3713),vec3(0.1344,0.0040,0.6456),vec3(0.2148,0.0073,1.0391),vec3(0.2839,0.0116,1.3856),vec3(0.3285,0.0168,1.6230),vec3(0.3483,0.0230,1.7471),vec3(0.3481,0.0298,1.7826),vec3(0.3362,0.0380,1.7721),vec3(0.3187,0.0480,1.7441),vec3(0.2908,0.0600,1.6692),vec3(0.2511,0.0739,1.5281),vec3(0.1954,0.0910,1.2876),vec3(0.1421,0.1126,1.0419),vec3(0.0956,0.1390,0.8130),vec3(0.0580,0.1693,0.6162),vec3(0.0320,0.2080,0.4652),vec3(0.0147,0.2586,0.3533),vec3(0.0049,0.3230,0.2720),vec3(0.0024,0.4073,0.2123),vec3(0.0093,0.5030,0.1582),vec3(0.0291,0.6082,0.1117),vec3(0.0633,0.7100,0.0782),vec3(0.1096,0.7932,0.0573),vec3(0.1655,0.8620,0.0422),vec3(0.2257,0.9149,0.0298),vec3(0.2904,0.9540,0.0203),vec3(0.3597,0.9803,0.0134),vec3(0.4334,0.9950,0.0087),vec3(0.5121,1.0000,0.0057),vec3(0.5945,0.9950,0.0039),vec3(0.6784,0.9786,0.0027),vec3(0.7621,0.9520,0.0021),vec3(0.8425,0.9154,0.0018),vec3(0.9163,0.8700,0.0017),vec3(0.9786,0.8163,0.0014),vec3(1.0263,0.7570,0.0011),vec3(1.0567,0.6949,0.0010),vec3(1.0622,0.6310,0.0008),vec3(1.0456,0.5668,0.0006),vec3(1.0026,0.5030,0.0003),vec3(0.9384,0.4412,0.0002),vec3(0.8544,0.3810,0.0002),vec3(0.7514,0.3210,0.0001),vec3(0.6424,0.2650,0.0000),vec3(0.5419,0.2170,0.0000),vec3(0.4479,0.1750,0.0000),vec3(0.3608,0.1382,0.0000),vec3(0.2835,0.1070,0.0000),vec3(0.2187,0.0816,0.0000),vec3(0.1649,0.0610,0.0000),vec3(0.1212,0.0446,0.0000),vec3(0.0874,0.0320,0.0000),vec3(0.0636,0.0232,0.0000),vec3(0.0468,0.0170,0.0000),vec3(0.0329,0.0119,0.0000),vec3(0.0227,0.0082,0.0000),vec3(0.0158,0.0057,0.0000),vec3(0.0114,0.0041,0.0000),vec3(0.0081,0.0029,0.0000),vec3(0.0058,0.0021,0.0000),vec3(0.0041,0.0015,0.0000),vec3(0.0029,0.0010,0.0000),vec3(0.0020,0.0007,0.0000),vec3(0.0014,0.0005,0.0000),vec3(0.0010,0.0004,0.0000),vec3(0.0007,0.0002,0.0000),vec3(0.0005,0.0002,0.0000),vec3(0.0003,0.0001,0.0000),vec3(0.0002,0.0001,0.0000),vec3(0.0002,0.0001,0.0000),vec3(0.0001,0.0000,0.0000),vec3(0.0001,0.0000,0.0000),vec3(0.0001,0.0000,0.0000),vec3(0.0000,0.0000,0.0000)
);
#endif
#if defined(USE_OSL)||defined(NODE_BLACKBODY_BL)
vec3 colorTempToRGB(float temp)
{
vec3 retColor;
temp=clamp(temp,100.0,40000.0)/100.0;
if (temp<=66.0){
retColor.r=1.0;
retColor.g=saturate(0.390081578*log(temp)-0.631841443);
} else {
float t=temp-60.0;
retColor.r=saturate(1.292936186*pow(t,-0.133204759));
retColor.g=saturate(1.129890860*pow(t,-0.075514849));
}
if (temp>=66.0)
retColor.b=1.0;
else if (temp<=19.0)
retColor.b=0.0;
else
retColor.b=saturate(0.543206789*log(temp-10.0)-1.196254089);
retColor.rgb=pow(retColor.rgb,vec3(2.2));
return retColor;
}
#endif
#if (defined(NODE_TEX_WHITE_NOISE_BL)||defined(NODE_TEX_GABOR_BL))&&__VERSION__==300
#define rotUint32(x,k)(((x)<< (k))|((x)>> (32-(k))))
#define mixUint32(a,b,c){a-=c;a ^= rotUint32(c,4);c+=b;b-=a;b ^= rotUint32(a,6);a+=c;c-=b;c ^= rotUint32(b,8);b+=a;a-=c;a ^= rotUint32(c,16);c+=b;b-=a;b ^= rotUint32(a,19);a+=c;c-=b;c ^= rotUint32(b,4);b+=a;}
#define finalUint32(a,b,c){c ^= b;c-=rotUint32(b,14);a ^= c;a-=rotUint32(c,11);b ^= a;b-=rotUint32(a,25);c ^= b;c-=rotUint32(b,16);a ^= c;a-=rotUint32(c,4);b ^= a;b-=rotUint32(a,14);c ^= b;c-=rotUint32(b,24);}
uint hashUint(uint x){
uint a=0xdeadbeefu+17u+x;
uint b=0xdeadbeefu+17u;
uint c=0xdeadbeefu+17u;
finalUint32(a,b,c);
return c;
}
uint hashUint2(uvec2 vec){
uvec3 abc=uvec3(0xdeadbeefu+21u)+uvec3(vec,0u);
finalUint32(abc.x,abc.y,abc.z);
return abc.z;
}
uint hashUint3(uvec3 vec){
uvec3 abc=uvec3(0xdeadbeefu+25u)+vec;
finalUint32(abc.x,abc.y,abc.z);
return abc.z;
}
uint hashUint4(uvec4 vec){
uvec3 abc=uvec3(0xdeadbeefu+29u)+vec.xyz;
mixUint32(abc.x,abc.y,abc.z);
abc.x+=vec.w;
finalUint32(abc.x,abc.y,abc.z);
return abc.z;
}
#undef rotUint32
#undef mixUint32
#undef finalUint32
float uintToFloat(uint value){
return float(value)/float(0xFFFFFFFFu);
}
float hashFloatToFloat(float value){
return uintToFloat(hashUint(floatBitsToUint(value)));
}
float hashVec2ToFloat(vec2 vec){
return uintToFloat(hashUint2(floatBitsToUint(vec)));
}
float hashVec3ToFloat(vec3 vec){
return uintToFloat(hashUint3(floatBitsToUint(vec)));
}
float hashVec4ToFloat(vec4 vec){
return uintToFloat(hashUint4(floatBitsToUint(vec)));
}
vec2 hashVec3ToVec2(vec3 k){
return vec2(hashVec3ToFloat(k.xyz),hashVec3ToFloat(k.zxy));
}
vec2 hashVec4ToVec2(vec4 k){
return vec2(hashVec4ToFloat(k.xyzw),hashVec4ToFloat(k.zxwy));
}
vec3 hashFloatToVec3(float val){
return vec3(hashFloatToFloat(val),hashVec2ToFloat(vec2(val,1.0)),hashVec2ToFloat(vec2(val,2.0)));
}
vec3 hashVec2ToVec3(vec2 vec){
return vec3(hashVec2ToFloat(vec),hashVec3ToFloat(vec3(vec,1.0)),hashVec3ToFloat(vec3(vec,2.0)));
}
vec3 hashVec3ToVec3(vec3 vec){
return vec3(hashVec3ToFloat(vec),hashVec4ToFloat(vec4(vec,1.0)),hashVec4ToFloat(vec4(vec,2.0)));
}
vec3 hashVec4ToVec3(vec4 vec){
return vec3(hashVec4ToFloat(vec.xyzw),hashVec4ToFloat(vec.zxwy),hashVec4ToFloat(vec.wzyx));
}
#endif`,ide=`#ifdef USE_OSL
#define M_PI PI
#define M_PI_2 PI/2.0
#define M_PI_4 PI/4.0
#define M_2_PI 2.0/PI
#define M_2PI 2.0*PI
#define M_4PI 4.0*PI
#define M_2_SQRTPI 2.0/sqrt(PI)
#define M_E 2.718281828459
#define M_LN2 0.69314718056
#define M_LN10 2.30258509299
#define M_LOG2E 1.4426950409
#define M_LOG10E 0.43429448190
#define M_SQRT2 sqrt(2.0)
#define M_SQRT1_2 sqrt(0.5)
#define OSL_ALPHA 33633
#define OSL_ANISOTROPIC 40205
#define OSL_AVERAGEALPHA 57701
#define OSL_AVERAGECOLOR 46077
#define OSL_BANDWIDTH 37485
#define OSL_BEZIER 27645
#define OSL_BLACK 62409
#define OSL_BSPLINE 16959
#define OSL_CAMERA 8198
#define OSL_CAMERA_CLIP 34380
#define OSL_CAMERA_CLIP_FAR 31933
#define OSL_CAMERA_CLIP_NEAR 21485
#define OSL_CAMERA_FOV 60706
#define OSL_CAMERA_PIXELASPECT 4950
#define OSL_CAMERA_PROJECTION 29369
#define OSL_CAMERA_RESOLUTION 39679
#define OSL_CAMERA_SCREEN_WINDOW 47009
#define OSL_CAMERA_SHUTTER 7107
#define OSL_CAMERA_SHUTTER_CLOSE 34406
#define OSL_CAMERA_SHUTTER_OPEN 40085
#define OSL_CATMULL_ROM 31642
#define OSL_CELL 20984
#define OSL_CHANNELS 8726
#define OSL_CLAMP 20052
#define OSL_COLOR 53753
#define OSL_COMMON 49871
#define OSL_CONSTANT 25144
#define OSL_DATAWINDOW 54276
#define OSL_DEFAULT 54870
#define OSL_DIFFUSE 40389
#define OSL_DIRECTION 42220
#define OSL_DISPLAYWINDOW 30728
#define OSL_DISTANCE 51337
#define OSL_DO_FILTER 35765
#define OSL_EMPTY 9314
#define OSL_ERRORMESSAGE 38305
#define OSL_EXISTS 41510
#define OSL_FILL 39132
#define OSL_FIRSTCHANNEL 48155
#define OSL_GABOR 57764
#define OSL_GEOM_NAME 63686
#define OSL_GLOSSY 47998
#define OSL_HASH 49390
#define OSL_HERMITE 63643
#define OSL_HIT 48491
#define OSL_HITDIST 22029
#define OSL_HSL 49898
#define OSL_HSV 29073
#define OSL_IMPULSES 56191
#define OSL_INDEX 1731
#define OSL_INTERP 10557
#define OSL_LINEAR 2182
#define OSL_MIRROR 64591
#define OSL_MISSINGALPHA 39755
#define OSL_MISSINGCOLOR 51667
#define OSL_NDC 48899
#define OSL_NORMAL 16520
#define OSL_OBJECT 59084
#define OSL_OSL_VERSION 47920
#define OSL_PERIODIC 8749
#define OSL_PERLIN 730
#define OSL_POSITION 43041
#define OSL_RASTER 2618
#define OSL_REFLECTION 37621
#define OSL_REFRACTION 37287
#define OSL_RESOLUTION 48704
#define OSL_RGB 26673
#define OSL_RWRAP 47801
#define OSL_SCREEN 55875
#define OSL_SHADER 21066
#define OSL_SHADER_GROUPNAME 62327
#define OSL_SHADER_LAYERNAME 51796
#define OSL_SHADER_SHADERNAME 65123
#define OSL_SHADOW 60708
#define OSL_SIMPLEX 61636
#define OSL_SUBIMAGE 33526
#define OSL_SUBIMAGES 2366
#define OSL_SWRAP 4328
#define OSL_TEXTUREFORMAT 17851
#define OSL_TIME 52235
#define OSL_TRACE 62908
#define OSL_TWRAP 30524
#define OSL_TYPE 64071
#define OSL_UPERLIN 65308
#define OSL_USIMPLEX 11314
#define OSL_WIDTH 48751
#define OSL_WORLD 9059
#define OSL_WORLDTOCAMERA 32273
#define OSL_WORLDTOSCREEN 33876
#define OSL_WRAP 58300
#define OSL_XYY 2228
#define OSL_XYZ 47351
#define OSL_YIQ 15839
vec3 oslGetP(vec3 viewPos){
#if WORLD_NODES==1
return swizzleUpZ((invViewMatrix*vec4(-viewPos,0.0)).xyz);
#else
return swizzleUpZ((invViewMatrix*vec4(-viewPos,1.0)).xyz);
#endif
}
vec3 oslGetI(vec3 viewPos){
#if WORLD_NODES==1
return swizzleUpZ((invViewMatrix*vec4(normalize(-viewPos),0.0)).xyz);
#else
return swizzleUpZ((invViewMatrix*vec4(normalize(-viewPos),0.0)).xyz);
#endif
}
vec3 oslGetN(vec3 viewNorm){
return swizzleUpZ(normalize(invViewMatrix*vec4(viewNorm,0.0)).xyz);
}
vec3 oslBlackbody(float temperatureK){
return vec4(colorTempToRGB(temperatureK),1.0).rgb;
}
float oslDistance(vec3 p0,vec3 p1){
return distance(p0,p1);
}
float oslDistance(vec3 p0,vec3 p1,vec3 q){
vec3 d=p1-p0;
float dd=dot(d,d);
if (dd==0.0)
return distance(q,p0);
float t=dot(q-p0,d)/dd;
return distance(q,p0+clamp(t,0.0,1.0)*d);
}
int oslEndsWith(int name1,int name2){
return int(name1==name2);
}
int oslFormat(int name1,int name2){
return name2;
}
int oslGetAttribute(int name,out int value){
value=0;
return 0;
}
int oslGetAttribute(int name,out float value){
value=0.0;
return 0;
}
int oslGetAttribute(int name,out vec3 vec){
vec=vec3(0.0,0.0,0.0);
return 0;
}
void oslGetTextureInfo(int filename,int name,out int value){
value=4;
}
void oslGetTextureInfo(int filename,int name,out int value[2]){
value[0]=1024;
value[1]=1024;
}
vec3 oslHSV(float h,float s,float v){
vec4 outCol;
hsvToRGB(vec4(h,s,v,1.0),outCol);
return outCol.rgb;
}
float oslHypot(float x,float y){
return sqrt(x*x+y*y);
}
float oslHypot(float x,float y,float z){
return sqrt(x*x+y*y+z*z);
}
float oslLog2(float x,float y){
return log(x)/log(y);
}
float oslLuminance(vec3 color){
return linearToRelativeLuminance(color);
}
float oslNoise(int type,vec3 vec,float phase){
float n=snoise(vec4(vec,phase));
if (type==OSL_UPERLIN)
n=n*0.5+0.5;
return n;
}
float oslNoise(int type,float value,float phase){
return oslNoise(type,vec3(value),phase);
}
float oslNoise(int type,vec3 vec){
return oslNoise(type,vec,0.0);
}
float oslNoise(int type,float value){
return oslNoise(type,vec3(value),0.0);
}
vec3 oslNoise3D(int type,vec3 vec,float phase){
float x=snoise(vec4(vec,phase));
float y=snoise(vec4(vec.y,vec.x,vec.z,phase));
float z=snoise(vec4(vec.y,vec.z,vec.x,phase));
vec3 n=vec3(x,y,z);
if (type==OSL_UPERLIN)
n=n*0.5+0.5;
return n;
}
vec3 oslNoise3D(int type,float value,float phase){
return oslNoise3D(type,vec3(value),phase);
}
vec3 oslNoise3D(int type,vec3 vec){
return oslNoise3D(type,vec,0.0);
}
vec3 oslNoise3D(int type,float value){
return oslNoise3D(type,vec3(value),0.0);
}
float oslPow(float a,float b){
return pow(a,b);
}
vec3 oslPow(vec3 a,float b){
return pow(a,vec3(b));
}
int oslRayType(int name){
if (name==OSL_CAMERA)
#if LIGHT_PATH_IS_CAM_RAY
return 1;
#else
return 0;
#endif
else
return 0;
}
vec3 oslRotate(vec3 vec,float angle,vec3 p0,vec3 p1){
vec3 axis=normalize(p1-p0);
float c=cos(angle);
float s=sin(angle);
float x=axis[0];
float y=axis[1];
float z=axis[2];
mat4 mat=mat4(x*x+(1.0-x*x)*c,x*y*(1.0-c)+z*s,x*z*(1.0-c)-y*s,0.0,x*y*(1.0-c)-z*s,y*y+(1.0-y*y)*c,y*z*(1.0-c)+x*s,0.0,x*z*(1.0-c)+y*s,y*z*(1.0-c)-x*s,z*z+(1.0-z*z)*c,0.0,0.0,0.0,0.0,1.0
);
return (mat*vec4((vec-p0),1.0)+vec4(p0,1.0)).xyz;
}
vec3 oslRotate(vec3 vec,float angle,vec3 axis){
return oslRotate(vec,angle,vec3(0.0),axis);
}
int oslStartsWith(int name1,int name2){
return int(name1==name2);
}
int oslStrLen(int name){
if (name==OSL_EMPTY)
return 0;
else
return 1;
}
int oslSubStr(int s,int start,int len){
return s;
}
int oslSubStr(int s,int start){
return s;
}
vec3 oslTexture(sampler2D image,float u,float v,int wrapModeFlag,int wrapMode,int alphaFlag,out float alpha){
if (wrapMode==OSL_DEFAULT||wrapMode==OSL_BLACK){
if (u<0.0||u>1.0||v<0.0||v>1.0)
return vec3(0.0);
} else if (wrapMode==OSL_CLAMP){
u=clamp(u,0.0,1.0);
v=clamp(v,0.0,1.0);
} else if (wrapMode==OSL_PERIODIC){
u=mod(u,1.0);
v=mod(v,1.0);
} else if (wrapMode==OSL_MIRROR){
if (mod(floor(u),2.0)==0.0)
u=u-floor(u);
else
u=1.0-(u-floor(u));
if (mod(floor(v),2.0)==0.0)
v=v-floor(v);
else
v=1.0-(v-floor(v));
}
vec4 colAlpha=texture2D(image,vec2(u,v));
alpha=colAlpha.a;
return colAlpha.rgb;
}
vec3 oslTexture(sampler2D image,float u,float v,int alphaFlag,out float alpha,int wrapModeFlag,int wrapMode){
return oslTexture(image,u,v,wrapModeFlag,wrapMode,alphaFlag,alpha);
}
vec3 oslTexture(sampler2D image,float u,float v,int alphaFlag,out float alpha){
return oslTexture(image,u,v,OSL_WRAP,OSL_DEFAULT,alphaFlag,alpha);
}
vec3 oslTexture(sampler2D image,float u,float v,int wrapModeFlag,int wrapMode){
float alpha;
return oslTexture(image,u,v,wrapModeFlag,wrapMode,OSL_ALPHA,alpha);
}
vec3 oslTexture(sampler2D image,float u,float v){
float alpha;
return oslTexture(image,u,v,OSL_WRAP,OSL_DEFAULT,OSL_ALPHA,alpha);
}
vec3 oslTexture(sampler2D image,float u,float v,int wrapModeFlag,int wrapMode,int colorSpaceFlag,int colorSpace){
float alpha;
return oslTexture(image,u,v,wrapModeFlag,wrapMode,OSL_ALPHA,alpha);
}
vec3 oslTransform(int fromSpace,int toSpace,vec4 vec){
if (toSpace==OSL_WORLD||toSpace==OSL_SHADER||toSpace==OSL_COMMON){
return vec.xyz;
} else if (toSpace==OSL_OBJECT){
vec=vec4(swizzleUpY(vec.xyz),vec.w);
vec=invModelMatrix*vec;
return swizzleUpZ(vec.xyz);
} else if (toSpace==OSL_CAMERA){
vec=vec4(swizzleUpY(vec.xyz),vec.w);
return (viewMatrix*vec).xyz;
} else if (toSpace==OSL_SCREEN){
return vec.xyz;
} else if (toSpace==OSL_RASTER){
return gl_FragCoord.xyz;
} else if (toSpace==OSL_NDC){
return vec.xyz;
} else {
return vec.xyz;
}
}
vec3 oslTransform(int fromSpace,int toSpace,vec3 vec){
return oslTransform(fromSpace,toSpace,vec4(vec,1.0));
}
vec3 oslTransform(int toSpace,vec3 vec){
return oslTransform(OSL_COMMON,toSpace,vec4(vec,1.0));
}
vec3 oslTransformDir(int fromSpace,int toSpace,vec3 vec){
return oslTransform(fromSpace,toSpace,vec4(vec,0.0));
}
vec3 oslTransformDir(int toSpace,vec3 vec){
return oslTransform(OSL_COMMON,toSpace,vec4(vec,0.0));
}
vec3 oslTransformC(int fromSpace,int toSpace,vec3 vec){
vec4 outVec=vec4(vec,1.0);
if (fromSpace==OSL_HSV&&toSpace==OSL_RGB)
hsvToRGB(vec4(vec,1.0),outVec);
else if (fromSpace==OSL_RGB&&toSpace==OSL_HSV)
rgbToHSV(vec4(vec,1.0),outVec);
return outVec.rgb;
}
vec3 oslTransformC(int toSpace,vec3 vec){
return oslTransformC(OSL_RGB,toSpace,vec);
}
void oslError(){}
void oslFPrintf(){}
void oslPrintf(){}
void oslWarning(){}
vec3 oslWaveLengthColor(float lambdaNM){
#if __VERSION__==300
vec3 xyz=vec3(0.0);
float ii=(lambdaNM-380.0)/5.0;
int i=int(ii);
if (i<0||i>=80)
return xyz;
ii-=float(i);
vec3 c1=cieColorMatch[i];
vec3 c2=cieColorMatch[i+1];
xyz=mix(c1,c2,ii);
return xyz_to_sRGB(xyz);
#else
return vec3(0.0);
#endif
}
#endif`,ade=`void node_incident(vec3 viewPos,out vec3 incident)
{

vec4 viewDir=vec4(normalize(viewPos),0.0);
incident=-swizzleUpZ(viewDir.xyz);
}`,sde=`void node_normal(vec3 norParam,out vec3 norOut)
{
#ifdef MT_BLENDER
#if WORLD_NODES==1
vec4 viewDir=isOrthographic?vec4(0.0,0.0,-1.0,0.0):vec4(normalize(-vViewPosition),0.0);
viewDir=invViewMatrix*viewDir;
norOut=-swizzleUpZ(viewDir.xyz);
#else
norOut=normalize(invViewMatrix*vec4(norParam,0.0)).xyz;
norOut=swizzleUpZ(norOut);
#endif
#else
norOut=norParam;
#endif
}`,lde=`void node_position(vec3 posParam,out vec3 posOut)
{
#if defined(MT_BLENDER)||defined(MT_MAX)
posOut=swizzleUpZ(-posParam);
#else
posOut=-posParam;
#endif
}`,cde=`uniform vec4 nodeRGB[NODE_RGB_NUM];
void node_rgb_alpha(vec4 color,out vec3 outColor,out float outAlpha)
{
outColor=color.rgb;
outAlpha=color.a;
}`,ude=`uniform float nodeValue[NODE_VALUE_NUM];
void node_value(float value,out float outValue)
{
outValue=value;
}`,dde=`void node_u_float(vec2 inUv,out float u)
{
u=inUv.x;
}`,fde=`void node_abs(vec3 inputVal,out vec3 outColor)
{
outColor=abs(inputVal);
}`,hde=`void node_add(vec3 input1,vec3 input2,out vec3 outColor)
{
outColor=input1+input2;
}`,pde=`void node_atan(int units,vec3 x,vec3 y,out vec3 outColor)
{
outColor=atan(y,x);
if (units==1)
outColor=degrees(outColor);
}`,mde=`void node_checkerboard(const vec2 inUv,vec3 color1,vec3 color2,float uFrequency,float vFrequency,float uOffset,float vOffset,float contrast,out vec3 outColor){
vec2 uv=-1.0+2.0*inUv;
float fmodResult=mod(floor(uOffset*2.0+uFrequency*uv.x)+floor(vOffset*2.0+vFrequency*uv.y),2.0);
float final=max(sign(fmodResult),0.0);
vec3 col=vec3(final);
if (final==0.0)
col=color1;
else
col=color2;
outColor=col*vec3(contrast)+vec3(1.0-contrast);
}`,gde=`void node_clamp(const int mode,vec3 inputValue,float minValue,float maxValue,vec3 minColor,vec3 maxColor,out vec3 outColor,out vec3 outTransparency)
{
if (mode==0)
outColor=clamp(inputValue,vec3(minValue),vec3(maxValue));
else
outColor=clamp(inputValue,minColor,maxColor);
outTransparency=outColor;
}`,_de=`void node_color_to_float(const int mode,vec3 inputValue,out float outValue)
{
if (mode==0)
outValue=min(min(inputValue.r,inputValue.g),inputValue.b);
else if (mode==1)
outValue=max(max(inputValue.r,inputValue.g),inputValue.b);
else if (mode==2)
outValue=(inputValue.r+inputValue.g+inputValue.b)/3.0;
else if (mode==3)
outValue=inputValue.r+inputValue.g+inputValue.b;
else if (mode==4){
outValue=dot(inputValue,LUM_WEIGHTS);
}
else if (mode==5)
outValue=inputValue.r;
else if (mode==6)
outValue=inputValue.g;
else if (mode==7)
outValue=inputValue.b;
}`,vde=`void node_color_convert(const int from,const int to,vec3 inputValue,out vec3 outColor,out vec3 outTransparency)
{
vec4 c;
if (from==to)
c=vec4(inputValue,1.0);
else if (from==0)
rgbToHSV(vec4(inputValue,1.0),c);
else if (from==1)
hsvToRGB(vec4(inputValue,1.0),c);
outColor=c.rgb;
outTransparency=outColor;
}`,Ade=`void node_color_correct(vec3 inputValue,float mask,float gamma,float hueShift,float saturation,float contrast,float contrastPivot,float exposure,vec3 multiply,vec3 add,bool invert,bool alphaIsLuminance,float alphaMultiply,float alphaAdd,bool invertAlpha,out vec3 outColor,out float outAlpha)
{
outColor=inputValue;
outColor=invert?1.0-outColor:outColor;
outColor=vec3(pow(abs(outColor.r),gamma),pow(abs(outColor.g),gamma),pow(abs(outColor.b),gamma));
vec4 hsv;
rgbToHSV(vec4(outColor,1.0),hsv);
hsv[0]+=hueShift/360.0;
if (hsv[0]>1.0)
hsv[0]-=1.0;
else if (hsv[0]<0.0)
hsv[0]+=1.0;

hsv[1]*=(saturation);
hsv[1]=saturate(hsv[1]);
hsv[2]+=exposure*2.0;
vec4 c=hsv;
hsvToRGB(hsv,c);
c=((c-contrastPivot)*contrast+contrastPivot)*vec4(multiply,1.0)+vec4(add,1.0);
outColor=c.rgb;
outAlpha=1.0;
}`,yde=`void node_compare(int test,float input1,float input2,out bool outValue)
{
if (test==0)
outValue=input1==input2;
else if (test==1)
outvalue=input1 != input2;
else if (test==2)
outValue=input1<input2;
else if (test==3)
outValue=input1>input2;
else if (test==4)
outValue=input1<=input2;
else if (test==5)
outValue=input1>=input2;
}`,bde=`void node_complement(vec3 inputValue,out vec3 outColor)
{
outColor=1.0-inputValue;
}`,xde=`void node_composite(const int operation,const int alphaOperation,vec3 A,vec3 B,float AA,float BA,out float outAlpha,out vec3 outColor,out vec3 outTransparency)
{
vec4 A1=vec4(A,AA);
vec4 B1=vec4(B,BA);
vec4 color=vec4(0.0);
if (operation==0)
color=A1;
else if (operation==1)
color=B1;
else if (operation==2)
color=A1*B1.a+B1*(1.0-A1.a);
else if (operation==3)
color=(A1+B1)/2.0;
else if (operation==4)
color=A1.a>B1.a?A1:(A1+B1*(1.0-A1.a)/B1.a);
else if (operation==5)
color=abs(A1-B1);
else if (operation==6)
color=A1.a+B1.a<1.0?A1+B1:A1+B1*(1.0-A1.a)/B1.a;
else if (operation==7)
for (int i=0;i<4;i++)
color[i]=B1[i]==0.0?0.0:(A1[i]/B1[i]);
else if (operation==8)
color=A1+B1-2.0*A1*B1;
else if (operation==9)
color=B1-A1;
else if (operation==10)
color=2.0*A1*B1/(A1+B1);
else if (operation==11)
for (int i=0;i<4;i++)
color[i]=A1[i]<0.5?(A1[i]*B1[i]):(A1[i]>=0.0&&A1[i]<=1.0&&B1[i]>=0.0&&B1[i]<=1.0)?(A1[i]+B1[i]-A1[i]*B1[i]):max(A1[i],B1[i]);
else if (operation==12)
color=sqrt(A1*A1+B1*B1);
else if (operation==13)
color=A1*B1.a;
else if (operation==14)
color=B1*A1.a;
else if (operation==15)
color=A1*A1.a+B1*(1.0-A1.a);
else if (operation==16)
color=max(A1,B1);
else if (operation==17)
color=min(A1,B1);
else if (operation==18)
color=A1-B1;
else if (operation==19)
color=A1*B1;
else if (operation==20)
color=A1*(1.0-B1.a);
else if (operation==21)
color=A1+B1*(1.0-A1.a);
else if (operation==22)
for (int i=0;i<4;i++)
color[i]=B1[i]<0.5?(A1[i]*B1[i]):(A1[i]>=0.0&&A1[i]<=1.0&&B1[i]>=0.0&&B1[i]<=1.0)?(A1[i]+B1[i]-A1[i]*B1[i]):max(A1[i],B1[i]);
else if (operation==23)
color=A1+B1;
else if (operation==24)
for (int i=0;i<4;i++)
color[i]=(A1[i]>=0.0&&A1[i]<=1.0&&B1[i]>=0.0&&B1[i]<=1.0)?(A1[i]+B1[i]-A1[i]*B1[i]):max(A1[i],B1[i]);

else if (operation==25)
for (int i=0;i<4;i++)
color[i]=(A1[i]<.75)?(A1[i]*B1[i]):(A1[i]>=0.0&&A1[i]<=1.0&&B1[i]>=0.0&&B1[i]<=1.0)?(A1[i]+B1[i]-A1[i]*B1[i]):max(A1[i],B1[i]);
else if (operation==26)
color=B1*(1.0-A1.a);
else if (operation==27)
color=A1*(1.0-B1.a)+B1;
else if (operation==28)
color=A1*(1.0-B1.a)+B1*(1.0-A1.a);
if (alphaOperation==1)
color.a=AA;
else if (alphaOperation ==2)
color.a=BA;
outColor=color.rgb;
outAlpha=color.a;
outTransparency=outColor;
}`,Ede=`void node_cross(vec3 input1,vec3 input2,out vec3 outValue)
{
outValue=cross(input1,input2);
}`,Cde=`void node_divide(vec3 input1,vec3 input2,out vec3 outColor)
{
outColor=input1/input2;
}`,Sde=`void node_dot(vec3 input1,vec3 input2,out vec3 outValue)
{
outValue=dot(input1,input2);
}`,wde=`void node_exp(vec3 inputVal,out vec3 outColor)
{
outColor=exp(inputVal);
}`,Mde=`void node_facing_ratio(vec3 viewNorm,const float bias,const float gain,const bool invert,const bool linear,out float outValue)
{
outValue=dot(normalize(viewNorm),normalize(vViewPosition));
}`,Tde=`void node_flat(vec3 color,out vec3 outColor)
{
outColor=color;
}`,Ide=`void node_float_to_int(const int mode,float inputValue,out int outValue)
{
if (mode==0)
outValue=round(inputValue);
else if (mode==1)
outValue=trunc(inputValue);
else if (mode==2)
outValue=floor(inputValue);
else if (mode==3)
outValue=ceil(inputValue);
}`,Rde=`void node_float_to_matrix(float input00,float input01,float input02,float input03,float input10,float input11,float input12,float input13,float input20,float input21,float input22,float input23,float input30,float input31,float input32,float input33,out mat4 outValue)
{
outValue=mat4(input00,input01,input02,input03,input10,input11,input12,input13,input20,input21,input22,input23,input30,input31,input32,input33);
}`,Lde=`void node_float_to_rgba(float r,float g,float b,float a,out vec4 outColor,out float outAlpha,out vec3 outTransparency)
{
outAlpha=a;
outColor=vec4(r,g,b,a);
outTransparency=vec3(1.0-a);
}`,Pde=`void node_float_to_rgb(float r,float g,float b,out vec3 outValue)
{
outValue=vec3(r,g,b);
}`,Dde=`void node_fraction(vec3 inputValue,out vec3 outColor)
{
outColor=fract(inputValue);
}`,Bde=`void node_is_finite(vec3 inputValue,out bool outValue)
{
outValue=!any(isinf(inputValue));
}`,Nde=`
void node_image(sampler2D ima,const int encoding,vec3 multiply,vec3 offset,vec2 uvcoords,float soffset,float toffset,float sscale,float tscale,bool sflip,bool tflip,bool swapSt,out vec3 outColor,out float outAlpha,out vec3 outTransparency){
vec2 uv=vec2(uvcoords.x,uvcoords.y);
uv+=vec2(soffset,toffset);
uv=mix(uv.xy,uv.yx,float(swapSt));
vec2 stFlip=vec2(float(sflip),float(tflip));
uv=mix(uv,1.0-uv,stFlip);
uv*=vec2(sscale,tscale);
uv.y=1.0-uv.y;
vec4 tex=texture2D(ima,uv);
outColor=nodeTexelToLinear(tex,encoding).rgb*multiply+offset;
outAlpha=tex.a;
outTransparency=outColor.rgb;
}
void node_image(sampler2D ima,const int encoding,vec3 multiply,vec3 offset,vec2 uvcoords,float soffset,float toffset,float sscale,float tscale,bool sflip,bool tflip,bool swapSt,vec2 dUVdx,vec2 dUVdy,out vec3 outColor,out float outAlpha,out vec3 outTransparency){
vec2 uv=vec2(uvcoords.x,uvcoords.y);
uv+=vec2(soffset,toffset);
uv=mix(uv.xy,uv.yx,float(swapSt));
vec2 stFlip=vec2(float(sflip),float(tflip));
uv=mix(uv,1.0-uv,stFlip);
uv*=vec2(sscale,tscale);
uv.y=1.0-uv.y;
#ifdef texture2DGradEXT
vec2 dInvOp=stFlip*(-2.0)+1.0;
dUVdx*=vec2(sscale,tscale)*dInvOp;
dUVdy*=vec2(sscale,tscale)*dInvOp;
vec4 tex=textureGrad(ima,uv,dUVdx,dUVdy);
#else
vec4 tex=texture2D(ima,uv);
#endif
outColor=nodeTexelToLinear(tex,encoding).rgb*multiply+offset;
outAlpha=tex.a;
outTransparency=outColor.rgb;
}
void node_image(sampler2D ima,const int encoding,vec4 multiply,vec4 offset,vec2 uvcoords,float soffset,float toffset,float sscale,float tscale,bool sflip,bool tflip,bool swapSt,out vec4 outColor){
vec2 uv=vec2(uvcoords.x,uvcoords.y);
uv+=vec2(soffset,toffset);
uv=mix(uv.xy,uv.yx,float(swapSt));
vec2 stFlip=vec2(float(sflip),float(tflip));
uv=mix(uv,1.0-uv,stFlip);
uv*=vec2(sscale,tscale);
uv.y=1.0-uv.y;
vec4 tex=texture2D(ima,uv);
outColor=nodeTexelToLinear(tex,encoding).rgba*multiply+offset;
}
void node_image(sampler2D ima,const int encoding,vec4 multiply,vec4 offset,vec2 uvcoords,float soffset,float toffset,float sscale,float tscale,bool sflip,bool tflip,bool swapSt,vec2 dUVdx,vec2 dUVdy,out vec4 outColor){
vec2 uv=vec2(uvcoords.x,uvcoords.y);
uv+=vec2(soffset,toffset);
uv=mix(uv.xy,uv.yx,float(swapSt));
vec2 stFlip=vec2(float(sflip),float(tflip));
uv=mix(uv,1.0-uv,stFlip);
uv*=vec2(sscale,tscale);
uv.y=1.0-uv.y;
#ifdef texture2DGradEXT
vec2 dInvOp=stFlip*(-2.0)+1.0;
dUVdx*=vec2(sscale,tscale)*dInvOp;
dUVdy*=vec2(sscale,tscale)*dInvOp;
vec4 tex=textureGrad(ima,uv,dUVdx,dUVdy);
#else
vec4 tex=texture2D(ima,uv);
#endif
outColor=nodeTexelToLinear(tex,encoding).rgba*multiply+offset;
}`,Ode=`void node_lambert(vec3 geometryNormal,float base,vec3 baseColor,vec3 normalCamera,vec3 opacity,out vec4 outColor,out float outAlpha,out vec3 outTransparency)
{
NodeMaterial material;
material.diffuseColor=base*baseColor;
ReflectedLight reflectedLight=ReflectedLight(vec3(0.0),vec3(0.0),vec3(0.0),vec3(0.0));
#ifdef USE_CLEARCOAT
#undef USE_CLEARCOAT
#define _CLEARCOAT_RESTORE
#endif
vec3 normal=normalCamera;
#define RE_Direct RE_DirectDiffuseOnly_Node
#define RE_IndirectDiffuse RE_IndirectDiffuse_Node
#include <lights_fragment_begin>
#include <lights_fragment_maps>
#include <lights_fragment_end>
#undef RE_Direct
#undef RE_IndirectDiffuse
#ifdef _CLEARCOAT_RESTORE
#undef _CLEARCOAT_RESTORE
#define USE_CLEARCOAT
#endif
outAlpha=average(opacity);
outColor=vec4(reflectedLight.directDiffuse+reflectedLight.indirectDiffuse,outAlpha);
outTransparency=vec3(1.0)-opacity;
}`,kde=`void node_length(int mode,vec3 inputVec,out float outValue)
{
if (mode==0)
outValue=length(inputVec);
else if (mode==1)
outValue=dot(inputVec,inputVec);
else
outValue=abs(inputVec.x)+abs(inputVec.y)+abs(inputVec.z);
}`,Fde=`void node_log(vec3 inputVec,vec3 base,out vec3 outColor)
{
outColor=log(inputVec)/log(base);
}`,Vde=`void node_map_to_mtl(bool opaqueEnabled,vec4 color,out vec4 outColor)
{
outColor=vec4(color.rgb,opaqueEnabled?color.a:1.0);
}`,Ude=`
void node_matrix_transform(const int transformOrder,const int rotationType,const int rotationUnits,const int rotationOrder,vec3 rotationEuler,vec3 rotationAxis,float rotationAngle,vec3 translation,vec3 scaling,vec3 pivot,out mat4 outMatrix)
{
mat4 tMat=translationToMat4(translation);
mat4 sMat=scalingToMat4(scaling);
mat4 rMat=mat4(1.0);
if (rotationType==0){
vec3 rot=float(rotationUnits)*radians(rotationEuler)+float(1-rotationUnits)*rotationEuler;
mat3 matX=mat3RotateX(rot.x);
mat3 matY=mat3RotateY(-rot.y);
mat3 matZ=mat3RotateZ(rot.z);
mat3 rotMat3;
if (rotationOrder==0){
rotMat3=matX*matY*matZ;
} else if (rotationOrder==1){
rotMat3=matX*matZ*matY;
} else if (rotationOrder==2){
rotMat3=matY*matX*matZ;
} else if (rotationOrder==3){
rotMat3=matY*matZ*matX;
} else if (rotationOrder==4){
rotMat3=matZ*matX*matY;
} else if (rotationOrder==5){
rotMat3=matZ*matY*matX;
}
rMat=toMat4(rotMat3);
} else if (rotationType==1){
float angleInRadians=float(rotationUnits)*radians(rotationAngle)+float(1-rotationUnits)*rotationAngle;
rotationAxis=normalize(rotationAxis);
rMat=toMat4(axisAngleToMat3(rotationAxis,angleInRadians));
}
if (transformOrder==0){
outMatrix=sMat*rMat*tMat;
} else if (transformOrder==1){
outMatrix=sMat*tMat*rMat;
} else if (transformOrder==2){
outMatrix=rMat*sMat*tMat;
} else if (transformOrder==3){
outMatrix=rMat*tMat*sMat;
} else if (transformOrder==4){
outMatrix=tMat*sMat*rMat;
} else if (transformOrder==5){
outMatrix=tMat*rMat*sMat;
}
mat4 rotX90=toMat4(mat3RotateX(PI*0.5));
mat4 pivotMat=translationToMat4(pivot);
mat4 invPivotMat=inverse(pivotMat);
outMatrix=invPivotMat*outMatrix*pivotMat*rotX90;
}
void node_matrix_transform(const int transformOrder,const int rotationType,const int rotationUnits,const int rotationOrder,vec3 rotationEuler,vec3 rotationAxis,float rotationAngle,vec3 translation,vec3 scaling,vec3 pivot,out mat4 outMatrix,out vec3 outTransparency)
{
mat4 tMat=translationToMat4(translation);
mat4 sMat=scalingToMat4(scaling);
mat4 rMat=mat4(1.0);
if (rotationType==0){
vec3 rot=mix(rotationEuler,radians(rotationEuler),float(rotationUnits));
mat3 matX=mat3RotateX(rot.x);
mat3 matY=mat3RotateY(-rot.y);
mat3 matZ=mat3RotateZ(rot.z);
mat3 rotMat3;
if (rotationOrder==0){
rotMat3=matX*matY*matZ;
} else if (rotationOrder==1){
rotMat3=matX*matZ*matY;
} else if (rotationOrder==2){
rotMat3=matY*matX*matZ;
} else if (rotationOrder==3){
rotMat3=matY*matZ*matX;
} else if (rotationOrder==4){
rotMat3=matZ*matX*matY;
} else if (rotationOrder==5){
rotMat3=matZ*matY*matX;
}
rMat=toMat4(rotMat3);
} else if (rotationType==1){
float angleInRadians=mix(rotationAngle,radians(rotationAngle),float(rotationUnits));
rotationAxis=normalize(rotationAxis);
rMat=toMat4(axisAngleToMat3(rotationAxis,angleInRadians));
}
outMatrix=rMat;
if (transformOrder==0){
outMatrix=sMat*rMat*tMat;
} else if (transformOrder==1){
outMatrix=sMat*tMat*rMat;
} else if (transformOrder==2){
outMatrix=rMat*sMat*tMat;
} else if (transformOrder==3){
outMatrix=rMat*tMat*sMat;
} else if (transformOrder==4){
outMatrix=tMat*sMat*rMat;
} else if (transformOrder==5){
outMatrix=tMat*rMat*sMat;
}
mat4 pivotMat=translationToMat4(pivot);
mat4 invPivotMat=inverse(pivotMat);
outMatrix=invPivotMat*outMatrix*pivotMat;
}`,zde=`void node_max(vec3 input1,vec3 input2,out vec3 outColor)
{
outColor=max(input1,input2);
}`,Gde=`void node_min(vec3 input1,vec3 input2,out vec3 outColor)
{
outColor=min(input1,input2);
}`,Hde=`void node_mix_shader(const int mode,const float mixAmt,vec4 shader1,vec4 shader2,out vec4 color)
{
shader1.rgb*=shader1.a;
shader2.rgb*=shader2.a;
if (mode==0)
color=mix(shader1,shader2,clamp(mixAmt,0.0,1.0));
else
color=vec4(shader1.rgb+shader2.rgb,min(shader1.a,shader2.a));
color.rgb/=color.a;
}`,Wde=`void node_modulo(vec3 inputVec,vec3 divisor,out vec3 outColor)
{
outColor=mod(inputVec,divisor);
}`,jde=`void node_multiply(vec3 input1,vec3 input2,out vec3 outColor)
{
outColor=input1*input2;
}`,Qde=`void node_negate(vec3 inputVec,out vec3 outColor)
{
outColor=-inputVec;
}`,$de=`void node_normalize(vec3 inputVec,out vec3 outValue)
{
outValue=normalize(inputVec);
}`,Yde=`void node_normal_map(vec4 tangentParam,vec3 inputVal,vec3 normal,float strength,vec3 tangent,out vec3 outValue){
#ifdef DOUBLE_SIDED
normal=normal*(float(gl_FrontFacing)*2.0-1.0);
#endif
vec3 normalTex=inputVal.xyz*2.0-1.0;
vec3 bitangent=tangentParam.w*cross(normal,tangent);
outValue=normalize(normalTex.x*tangent+normalTex.y*bitangent+normalTex.z*normal);
outValue=mix(normal,outValue,strength);
}`,Xde=`void node_pow(vec3 base,vec3 exponent,out vec3 outColor)
{
outColor=pow(base,exponent);
}`,qde=`void node_abs(vec3 inputColor,out vec3 outColor)
{
outColor=inputColor;
}`,Kde=`void node_range(vec3 inputValue,float inputMin,float inputMax,float outputMin,float outputMax,bool smoothstep1,float contrast,float contrastPivot,float bias,float gain,out vec3 outColor,out vec3 outTransparency)
{

outColor=min(max(inputValue,vec3(inputMin)),vec3(inputMax));
outColor=(outColor-contrastPivot)*contrast+contrastPivot;
if (smoothstep1==true){
for (int i=0;i<3;i++)
outColor[i]=smoothstep(outputMin,outputMax,outColor[i]);
} else
outColor=min(max(outColor,vec3(outputMin)),vec3(outputMax));
outTransparency=outColor;
}`,Zde=`void node_ray_switch(vec3 camera,vec3 diffuseReflection,vec3 diffuseTransmission,vec3 shadow,vec3 specularReflection,vec3 specularTransmission,out vec3 outColor,out float outAlpha)
{
#if LIGHT_PATH_IS_CAM_RAY
outColor=camera;
#else
outColor=diffuseReflection;
#endif
outAlpha=1.0;
}`,Jde=`void node_reciprocal(vec3 inputVec,out vec3 outColor)
{
outColor=1.0/inputVec;
}`,efe=`void node_rgba_to_float(const int mode,vec3 inputValue,float inputA,out float outValue,out vec3 outTransparency)
{
outTransparency=inputValue+vec3(inputA/4.0);
if (mode==0)
outValue=min(min(min(inputValue.r,inputValue.g),inputValue.b),inputA);
else if (mode==1)
outValue=max(max(max(inputValue.r,inputValue.g),inputValue.b),inputA);
else if (mode==2)
outValue=(inputValue.r+inputValue.g+inputValue.b+inputA)/4.0;
else if (mode==3)
outValue=inputValue.r+inputValue.g+inputValue.b+inputA;
else if (mode==4){
outValue=dot(inputValue,LUM_WEIGHTS);
}
else if (mode==5)
outValue=inputValue.r;
else if (mode==6)
outValue=inputValue.g;
else if (mode==7)
outValue=inputValue.b;
}`,tfe=`void node_rgb_to_float(const int mode,vec3 inputValue,out float outValue)
{
if (mode==0)
outValue=min(min(inputValue.r,inputValue.g),inputValue.b);
else if (mode==1)
outValue=max(max(inputValue.r,inputValue.g),inputValue.b);
else if (mode==2)
outValue=(inputValue.r+inputValue.g+inputValue.b)/3.0;
else if (mode==3)
outValue=inputValue.r+inputValue.g+inputValue.b;
else if (mode==4){
outValue=dot(inputValue,LUM_WEIGHTS);
}
else if (mode==5)
outValue=inputValue.r;
else if (mode==6)
outValue=inputValue.g;
else if (mode==7)
outValue=inputValue.b;
}`,nfe=`void node_rgb_to_vector(const int mode,vec3 inputValue,out vec3 outValue)
{

outValue=inputValue;
}`,rfe=`#include <shadowmask_pars_fragment>
void node_shadow_matte(vec3 normal,vec3 shadowColor,float backlighting,float shadowOpacity,out vec4 outColor,out float outAlpha){
float shadow=getShadowMask();
outColor=vec4(shadowColor,shadowOpacity*(1.0-shadow));
outAlpha=outColor.a;
}`,ofe=`
void node_shuffle(const int channelR,const int channelG,const int channelB,const int channelA,vec3 color,float alpha,bool negateR,bool negateG,bool negateB,bool negateA,out vec3 outColor,out float outAlpha)
{
outColor=vec3(0.0);
vec4 choose=vec4(color,alpha);
outAlpha=1.0;
#if __VERSION__==100
outColor.r=choose[0];
outColor.g=choose[1];
outColor.b=choose[2];
outAlpha=choose[3];
#else
outColor.r=choose[channelR];
outColor.g=choose[channelG];
outColor.b=choose[channelB];
outAlpha=choose[channelA];
#endif
if (negateR)
outColor.r=-outColor.r;
if (negateG)
outColor.g=-outColor.g;
if (negateB)
outColor.b=-outColor.b;
if (negateA)
outAlpha=-outAlpha;
}
void node_shuffle(const int channelR,const int channelG,const int channelB,const int channelA,vec4 color,float alpha,bool negateR,bool negateG,bool negateB,bool negateA,out vec4 outColor)
{
outColor=vec4(0.0);
vec4 choose=vec4(color.rgb,alpha);
#if __VERSION__==100
outColor.r=choose[0];
outColor.g=choose[1];
outColor.b=choose[2];
outColor.a=choose[3];
#else
outColor.r=choose[channelR];
outColor.g=choose[channelG];
outColor.b=choose[channelB];
outColor.a=choose[channelA];
#endif
if (negateR)
outColor.r=-outColor.r;
if (negateG)
outColor.g=-outColor.g;
if (negateB)
outColor.b=-outColor.b;
if (negateA)
outColor.a=-outColor.a;
}`,ife=`void node_sign(vec3 inputVec,out vec3 outColor)
{
outColor=sign(inputVec);
}`,afe=`void node_skydome_light(vec3 color,float intensity,out vec4 outgoingLight)
{
outgoingLight=vec4(color*intensity,1.0);
}`,sfe=`void node_sqrt(vec3 inputVec,out vec3 outColor)
{
outColor=sqrt(inputVec);
}`,lfe=`void node_standard_surface(vec3 geometryNormal,const bool thinWalled,const float base,const vec3 baseColor,const float diffuseRoughness,const float metalness,const float specular,const vec3 specularColor,const float specularRoughness,const float trans,const vec3 transColor,const float transDepth,const vec3 transScatter,const float transExtraRoughness,const float subsurface,const vec3 subsurfaceColor,const vec3 subsurfaceRadius,const float clearcoat,const vec3 clearcoatColor,const float clearcoatRoughness,const float sheen,const vec3 sheenColor,const float sheenRoughness,const float emission,const vec3 emissionColor,const vec3 opacity,const vec3 normal,const vec3 clearcoatNormal,const float specularIOR,out vec4 outColor,out vec3 outTransparency)
{
NodeMaterial material;
vec3 baseColorWeighted=base*baseColor.rgb;
material.diffuseColor=baseColorWeighted*(1.0-metalness)*(1.0-trans);
#ifdef USE_CLEARCOAT
material.clearcoat=saturate(clearcoat);
material.clearcoatRoughness=clamp(clearcoatRoughness,0.0,1.0);
material.clearcoatF0=vec3(0.04);
material.clearcoatF90=1.0;
#endif
#ifdef USE_SHEEN
material.sheenColor=saturate(sheen*sheenColor);
material.sheenRoughness=clamp(sheenRoughness,0.0,1.0);
#endif
vec3 dxy=max(abs(dFdx(geometryNormal)),abs(dFdy(geometryNormal)));
float geometryRoughness=max(max(dxy.x,dxy.y),dxy.z);
material.roughness=max(specularRoughness,0.0525);
material.roughness+=geometryRoughness;
material.roughness=min(material.roughness,1.0);
vec3 specularColorWeighted=specular*specularColor;
vec3 dielRefl=pow2((1.0-specularIOR)/(1.0+specularIOR))*specularColorWeighted;
material.specularColor=mix(dielRefl,baseColorWeighted,metalness);
material.fresnelRefl90=mix(specularColorWeighted,vec3(1.0),metalness);
material.specularF90=average(material.fresnelRefl90);
material.refractionColor=pow(trans*(1.0-metalness)*transColor.rgb,vec3(2.0));
material.refractionIOR=specularIOR;
material.refractionRoughness=material.roughness;
ReflectedLight reflectedLight=ReflectedLight(vec3(0.0),vec3(0.0),vec3(0.0),vec3(0.0));
vec3 refractedLight=vec3(0.0);
#ifdef USE_GTAO
vec4 gtaoVisibilityBentNormal=texture2D(gtaoMap,gl_FragCoord.xy/currResolution);
vec3 bentNormal=normalize(unpackRGBToNormal(gtaoVisibilityBentNormal.gba));
#define PROBE_NORMAL bentNormal
#endif
#define RE_Direct RE_Direct_Node
#define RE_IndirectDiffuse RE_IndirectDiffuse_Node
#define RE_IndirectSpecular RE_IndirectSpecular_Node
#define RE_Refraction RE_Refraction_Node
#include <lights_fragment_begin>
#include <lights_fragment_maps>
#include <lights_fragment_end>
#undef RE_Direct
#undef RE_IndirectDiffuse
#undef RE_IndirectSpecular
#undef RE_Refraction
#ifdef PROBE_NORMAL
#undef PROBE_NORMAL
#endif
#ifdef USE_GTAO
reflectedLight.indirectDiffuse*=gtaoVisibilityBentNormal.r;
float gtaoVisibility=gtaoVisibilityBentNormal.r;
vec3 gtaoBentNormal=bentNormal;
vec3 gtaoViewDir=geometry.viewDir;
vec3 gtaoNormal=normal;
float gtaoRoughness=material.roughness;
#endif
#include <lights_fragment_gtso>
vec3 totalEmissiveRadiance=emission*emissionColor;
vec3 outSpecular=reflectedLight.directSpecular+reflectedLight.indirectSpecular;
vec3 outColor3=reflectedLight.directDiffuse+reflectedLight.indirectDiffuse +
outSpecular+totalEmissiveRadiance;
#ifdef USE_SHEEN
float sheenEnergyComp=1.0-0.157*max3(material.sheenColor);
outColor3=outColor3*sheenEnergyComp+sheenSpecular;
#endif
#ifdef USE_CLEARCOAT
float dotNVcc=saturate(dot(geometry.normal,geometry.viewDir));
vec3 Fcc=F_Schlick(material.clearcoatF0,material.clearcoatF90,dotNVcc);
outColor3=outColor3*(1.0-material.clearcoat*Fcc)+clearcoatSpecular*material.clearcoat;
#endif
float alpha=1.0;
if (thinWalled){
alpha=average(opacity)*(1.0-saturate(trans)+maxFromRGB(outSpecular)*saturate(trans));
} else {
outColor3+=refractedLight;
}
outColor=vec4(outColor3,saturate(alpha));
outTransparency=outColor3;
}
void node_standard_surface(vec3 geometryNormal,const bool thinWalled,const float base,const vec3 baseColor,const float diffuseRoughness,const float metalness,const float specular,const vec3 specularColor,const float specularRoughness,const float trans,const vec3 transColor,const float transDepth,const vec3 transScatter,const float transExtraRoughness,const float subsurface,const vec3 subsurfaceColor,const vec3 subsurfaceRadius,const float clearcoat,const vec3 clearcoatColor,const float clearcoatRoughness,const float sheen,const vec3 sheenColor,const float sheenRoughness,const float emission,const vec3 emissionColor,const vec3 opacity,const vec3 normal,const vec3 clearcoatNormal,out vec4 outColor,out vec3 outTransparency)
{
node_standard_surface(geometryNormal,thinWalled,base,baseColor,diffuseRoughness,metalness,specular,specularColor,specularRoughness,trans,transColor,transDepth,transScatter,transExtraRoughness,subsurface,subsurfaceColor,subsurfaceRadius,clearcoat,clearcoatColor,clearcoatRoughness,sheen,sheenColor,sheenRoughness,emission,emissionColor,opacity,normal,clearcoatNormal,1.5,outColor,outTransparency);
}`,cfe=`void node_subtract(vec3 input1,vec3 input2,out vec3 outColor)
{
outColor=input1-input2;
}`,ufe=`void node_trigo(const int function,const int units,vec3 inputVec,float frequency,float phase,out vec3 outColor)
{
if (units==1&&function>=0&&function <=2)
inputVec=radians(inputVec);
if (function==0)
outColor=cos(inputVec*frequency+phase);
else if (function==1)
outColor=sin(inputVec*frequency+phase);
else if (function==2)
outColor=tan(inputVec*frequency+phase);
else if (function==3)
outColor=acos(inputVec*frequency+phase);
else if (function==4)
outColor=asin(inputVec*frequency+phase);
else if (function==5)
outColor=atan(inputVec*frequency+phase);
else if (function==6)
outColor=cosh(inputVec*frequency+phase);
else if (function==7)
outColor=sinh(inputVec*frequency+phase);
else
outColor=tanh(inputVec*frequency+phase);
if (units==1&&function>=3&&function <=5)
outColor=degrees(outColor);
}`,dfe=`
void node_triplanar(const int coordSpace,const bool inputPerAxis,const bool flipOnOppositeDirection,const float blendFactor,vec4 inputColor,vec4 inputColorY,vec4 inputColorZ,vec3 scaling,vec3 rotation,vec3 offset,vec3 normal,out vec4 outColor)
{
if (inputPerAxis==true){
vec3 barycentric=abs(normal);
barycentric/=barycentric.x+barycentric.y+barycentric.z;
vec3 edgeShape=min(min(barycentric.yzx,barycentric.zxy),(blendFactor-1.0)/(blendFactor-3.0));
vec3 edgeValue=(1.0-blendFactor)*(1.0-edgeShape)/2.0;
vec3 weight=max((barycentric-edgeValue)/(1.0-edgeValue),EPSILON);
weight/=(weight.x+weight.y+weight.z);
outColor=weight.x*inputColor+weight.y*inputColorY+weight.z*inputColorZ;
} else {
outColor=inputColor;
}
}
void node_triplanar(const int coordSpace,const bool inputPerAxis,const bool flipOnOppositeDirection,const float blendFactor,vec3 inputColor,vec3 inputColorY,vec3 inputColorZ,vec3 scaling,vec3 rotation,vec3 offset,vec3 normal,out vec3 outColor)
{
if (inputPerAxis==true){
vec3 barycentric=abs(normal);
barycentric/=barycentric.x+barycentric.y+barycentric.z;
vec3 edgeShape=min(min(barycentric.yzx,barycentric.zxy),(blendFactor-1.0)/(blendFactor-3.0));
vec3 edgeValue=(1.0-blendFactor)*(1.0-edgeShape)/2.0;
vec3 weight=max((barycentric-edgeValue)/(1.0-edgeValue),EPSILON);
weight/=(weight.x+weight.y+weight.z);
outColor=weight.x*inputColor+weight.y*inputColorY+weight.z*inputColorZ;
} else {
outColor=inputColor;
}
}`,ffe=`
float screenSpaceDither12(vec2 vScreenPos){
float vDither=dot(vec2(171.0,231.0),vScreenPos.xy);
return fract(vDither/103.0);
}
vec3 smoothContrast(vec3 alpha,float contrast){
vec3 powAlpha=pow(alpha,vec3(contrast));
return powAlpha/(powAlpha.x+powAlpha.y+powAlpha.z);
}
void node_triplanar_uv(const bool flipOnOppositeDirection,const float blendFactor,vec3 vector,vec3 normal,out vec2 outUV,out vec2 dUVdx,out vec2 dUVdy)
{
vec3 norm=normal;
float fp=float(flipOnOppositeDirection);
vec2 xFac=mix(vec2(1.0),vec2(-sign(norm.x),1.0),fp);
vec2 uvX=vec2(vector.z,vector.y)*xFac+0.5;
vec2 yFac=mix(vec2(1.0),vec2(1.0,-sign(norm.y)),fp);
vec2 uvY=vec2(vector.x,vector.z)*yFac+0.5;
vec2 zFac=vec2(mix(1.0,sign(norm.z),fp),1.0);
vec2 uvZ=vec2(vector.x,vector.y)*zFac+0.5;
#ifdef texture2DGradEXT
vec3 alpha=abs(norm);
float contrast=mix(20.0,1.0,blendFactor);
alpha=smoothContrast(alpha,contrast);
float dither=screenSpaceDither12(gl_FragCoord.xy);
dither=clamp(dither,0.01,0.99);
vec3 duvwdx=dFdx(vector);
vec3 duvwdy=dFdy(vector);
if (alpha.x>dither){
outUV=uvX;
dUVdx=duvwdx.yz*xFac;
dUVdy=duvwdy.yz*xFac;
} else if (1.-alpha.z>dither){
outUV=uvY;
dUVdx=duvwdx.xz*yFac;
dUVdy=duvwdy.xz*yFac;
} else {
outUV=uvZ;
dUVdx=duvwdx.xy*zFac;
dUVdy=duvwdy.xy*zFac;
}
#else
vec3 absNorm=abs(norm);
vec3 faceMask=step(absNorm.yzx,absNorm)*step(absNorm.zxy,absNorm);
outUV=faceMask.x*uvX+faceMask.y*uvY+faceMask.z*uvZ;
#endif
}
void node_triplanar_uv(const bool flipOnOppositeDirection,const int projectionAxis,vec3 vector,vec3 normal,out vec2 outUV)
{
vec3 norm=normal;
float fp=float(flipOnOppositeDirection);
if (projectionAxis==0){
vec2 xFac=mix(vec2(1.0),vec2(-sign(norm.x),1.0),fp);
outUV=vec2(vector.z,vector.y)*xFac+0.5;
} else if (projectionAxis==1){
vec2 yFac=mix(vec2(1.0),vec2(1.0,-sign(norm.y)),fp);
outUV=vec2(vector.x,vector.z)*yFac+0.5;
} else if (projectionAxis==2){
vec2 zFac=vec2(mix(1.0,sign(norm.z),fp),1.0);
outUV=vec2(vector.x,vector.y)*zFac+0.5;
} else if (projectionAxis==3){
vec2 xFac=mix(vec2(1.0),vec2(-sign(norm.x),1.0),fp);
vec2 uvX=vec2(vector.z,vector.y)*xFac+0.5;
vec2 yFac=mix(vec2(1.0),vec2(1.0,-sign(norm.y)),fp);
vec2 uvY=vec2(vector.x,vector.z)*yFac+0.5;
vec2 zFac=vec2(mix(1.0,sign(norm.z),fp),1.0);
vec2 uvZ=vec2(vector.x,vector.y)*zFac+0.5;
vec3 absNorm=abs(norm);
vec3 faceMask=step(absNorm.yzx,absNorm)*step(absNorm.zxy,absNorm);
outUV=faceMask.x*uvX+faceMask.y*uvY+faceMask.z*uvZ;
}
}`,hfe=`void node_two_sided(float frontFacing,vec3 front,vec3 back,out vec3 outColor)
{
outColor=(frontFacing>0.0)?front:back;
}`,pfe=`void node_user_data_color(vec4 color,out vec3 outColor,out float outAlpha)
{
outColor=color.rgb;
outAlpha=color.a;
}`,mfe=`#define TEX_PROJ_PLANAR 0
#define TEX_PROJ_SPHERICAL 1
#define TEX_PROJ_CYLINDRICAL 2
#define TEX_PROJ_BALL 3
#define TEX_PROJ_CUBIC 4
#define TEX_PROJ_SHRINK_WRAP 5
#define COORD_WORLD_SPACE 0
#define COORD_OBJECT_SPACE 1
void node_uv_projection(const int projectionType,const int coordSpace,vec3 projectionColor,float uAngleDegrees,float vAngleDegrees,mat4 matrix,out vec2 outUV)
{
vec3 vector=vWorldPosition.xyz;
if (coordSpace==COORD_OBJECT_SPACE){
vector=(invModelMatrix*vec4(vector,1.0)).xyz;
}
vector=(matrix*vec4(vector,1.0)).xyz;
if (projectionType==TEX_PROJ_PLANAR){
outUV=vector.xy*0.5+0.5;
} else if (projectionType==TEX_PROJ_SPHERICAL){
vector=normalize(vector);
float uAngle=radians(uAngleDegrees);
float vAngle=radians(vAngleDegrees);
float theta=atan(vector.x,vector.z)/(uAngle);
theta=theta*0.5+0.5;
float vAngleNormalized=vAngle*2.0/PI;
float phi=(acos(-vector.y)/PI-0.5)/vAngleNormalized+0.5;
outUV=vec2(theta,phi);
} else if (projectionType==TEX_PROJ_CYLINDRICAL){
vector.xz=normalize(vector).xz;
float uAngle=radians(uAngleDegrees);
vec2 uv=vec2((atan(vector.x,vector.z))/(uAngle),(vector.y)/2.0);
outUV=uv+0.5;
} else if (projectionType==TEX_PROJ_BALL){
vec3 normal=normalize(vector);
normal.z+=1.0;
normal/=(2.0*sqrt(max(0.5*normal.z,0.0)));
outUV=clamp(0.5*normal.xy+0.5,0.0,1.0);
} else if (projectionType==TEX_PROJ_CUBIC){
vec2 uvX=vec2(vector.z,vector.y)/abs(vector.x);
vec2 uvY=vec2(vector.x,vector.z)/abs(vector.y);
vec2 uvZ=vec2(vector.x,vector.y)/abs(vector.z);
vec3 absVec=abs(vector);
vec3 faceMask=step(absVec.yzx,absVec)*step(absVec.zxy,absVec);
vec2 uv=faceMask.x*uvX+faceMask.y*uvY+faceMask.z*uvZ;
uv=uv*0.5+0.5;
outUV=uv;
} else if (projectionType==TEX_PROJ_SHRINK_WRAP){
vector=normalize(vector);
outUV=normalize(vector.xz)*acos(vector.y)/PI;
outUV=outUV*0.5+0.5;
}
}`,gfe=`void node_vector_to_rgb(const int mode,vec3 inputValue,out vec3 outColor)
{
if (mode==0)
outColor=inputValue;
else if (mode==1)
outColor=normalize(inputValue);
else if (mode==2)
outColor=inputValue;
}`,_fe=`void node_add_shader(vec4 color1,vec4 color2,out vec4 outColor){
outColor.rgb=color1.rgb+color2.rgb;
outColor.a=clamp(color1.a+color2.a,0.0,1.0);
}`,vfe=`void node_ambient_occlusion(vec4 color,float distance,vec3 normal,out vec4 outColor,out float outAO){
outColor=color;
outAO=1.0;
}`,Afe=`void node_attribute(vec4 paramAttr,out vec4 outColor,out vec3 outVector,out float outFac,out float outAlpha){
outColor=vec4(paramAttr.xyz,1.0);
outVector=paramAttr.xyz;
outFac=average(paramAttr.xyz);
outAlpha=paramAttr.w;
}`,yfe=`void node_background(vec4 color,float strength,out vec4 outColor)
{
outColor=strength*color;
}`,bfe=`void node_bevel(float radius,vec3 normal,out vec3 outNormal){
outNormal=normal;
}`,xfe=`void node_blackbody(float temp,out vec4 outColor)
{
outColor=vec4(colorTempToRGB(temp),1.0);
}`,Efe=`void node_brightcontrast(vec4 color,float bright,float contrast,out vec4 outColor)
{
float bminc=bright-contrast*0.5;
outColor.r=max((1.0+contrast)*color.r+bminc,0.0);
outColor.g=max((1.0+contrast)*color.g+bminc,0.0);
outColor.b=max((1.0+contrast)*color.b+bminc,0.0);
outColor.a=color.a;
}`,Cfe=`void node_bsdf_anisotropic(vec4 color,float roughness,float anisotropy,float rotation,vec3 normal,vec3 tangent,out vec4 outColor)
{
outColor=color;
}`,Sfe=`
void node_bsdf_diffuse(vec4 color,float roughness,vec3 normal,out vec4 outColor){
normal=vec3(normal[0],normal[2],-normal[1]);
normal=(viewMatrix*vec4(normal.xyz,0.0)).xyz;
NodeMaterial material;
material.diffuseColor=color.rgb;
ReflectedLight reflectedLight=ReflectedLight(vec3(0.0),vec3(0.0),vec3(0.0),vec3(0.0));
#ifdef USE_CLEARCOAT
#undef USE_CLEARCOAT
#define _CLEARCOAT_RESTORE
#endif
#ifdef USE_GTAO
vec4 gtaoVisibilityBentNormal=texture2D(gtaoMap,gl_FragCoord.xy/currResolution);
vec3 bentNormal=normalize(unpackRGBToNormal(gtaoVisibilityBentNormal.gba));
#define PROBE_NORMAL bentNormal
#endif
#define RE_Direct RE_DirectDiffuseOnly_Node
#define RE_IndirectDiffuse RE_IndirectDiffuse_Node
#include <lights_fragment_begin>
#include <lights_fragment_maps>
#include <lights_fragment_end>
#undef RE_Direct
#undef RE_IndirectDiffuse
#ifdef PROBE_NORMAL
#undef PROBE_NORMAL
#endif
#ifdef _CLEARCOAT_RESTORE
#undef _CLEARCOAT_RESTORE
#define USE_CLEARCOAT
#endif
#ifdef USE_GTAO
reflectedLight.indirectDiffuse*=gtaoVisibilityBentNormal.r;
#endif
outColor=vec4(reflectedLight.directDiffuse+reflectedLight.indirectDiffuse,1.0);
}`,wfe=`void node_bsdf_glass(vec3 geometryNormal,vec4 color,float roughness,float ior,vec3 normal,out vec4 outColor){
normal=normalize(normal);
normal=swizzleUpY(normal);
vec3 normalWorld=normal;
normal=(viewMatrix*vec4(normal.xyz,0.0)).xyz;
NodeMaterial material;
material.specularColor=vec3(1.0);
material.fresnelRefl90=vec3(1.0);
material.roughness=clamp(roughness,0.0,1.0);
material.refractionColor=vec3(1.0);
material.refractionIOR=ior;
material.refractionRoughness=pow2(roughness);
#if defined(ENVMAP_TYPE_CUBE)||defined(ENVMAP_TYPE_CUBE_UV)
float geomRoughness=calcGeometryRoughness(geometryNormal);
material.roughness=calcCubeUVAdjustedRoughness(material.roughness,geomRoughness);
material.refractionRoughness=calcCubeUVAdjustedRoughness(material.refractionRoughness,geomRoughness);
#endif
ReflectedLight reflectedLight=ReflectedLight(vec3(0.0),vec3(0.0),vec3(0.0),vec3(0.0));
vec3 refractedLight=vec3(0.0);
#ifdef USE_CLEARCOAT
#undef USE_CLEARCOAT
#define _CLEARCOAT_RESTORE
#endif
#ifdef USE_GTAO
vec4 gtaoVisibilityBentNormal=texture2D(gtaoMap,gl_FragCoord.xy/currResolution);
vec3 bentNormal=normalize(unpackRGBToNormal(gtaoVisibilityBentNormal.gba));
#define PROBE_NORMAL bentNormal
#endif
#define RE_Direct RE_Direct_Node
#define RE_IndirectDiffuse RE_IndirectDiffuse_Empty
#define RE_IndirectSpecular RE_IndirectSpecular_Node
#define RE_Refraction RE_Refraction_Node
#include <lights_fragment_begin>
#include <lights_fragment_maps>
#include <lights_fragment_end>
#undef RE_Direct
#undef RE_IndirectDiffuse
#undef RE_IndirectSpecular
#undef RE_Refraction
#ifdef PROBE_NORMAL
#undef PROBE_NORMAL
#endif
#ifdef _CLEARCOAT_RESTORE
#undef _CLEARCOAT_RESTORE
#define USE_CLEARCOAT
#endif
#ifdef USE_GTAO
float gtaoVisibility=gtaoVisibilityBentNormal.r;
vec3 gtaoBentNormal=bentNormal;
vec3 gtaoViewDir=geometry.viewDir;
vec3 gtaoNormal=normal;
float gtaoRoughness=material.roughness;
#endif
#include <lights_fragment_gtso>
vec3 viewWorld;
if (isOrthographic)
viewWorld=(invViewMatrix*vec4(0.0,0.0,-1.0,0.0)).xyz;
else
viewWorld=(invViewMatrix*vec4(-vViewPosition,0.0)).xyz;
viewWorld=normalize(viewWorld);
float fresnel=fresnelReflection(viewWorld,normalWorld,ior);
outColor=vec4(color.rgb*mix(refractedLight,reflectedLight.directSpecular
+ reflectedLight.indirectSpecular,fresnel),1.0);
}`,Mfe=`void node_bsdf_glossy(vec3 geometryNormal,vec4 color,float roughness,float anisotropy,float rotation,vec3 normal,vec3 tangent,out vec4 outColor){
normal=vec3(normal[0],normal[2],-normal[1]);
normal=normalize((viewMatrix*vec4(normal.xyz,0.0)).xyz);
NodeMaterial material;
material.specularColor=vec3(1.0);
material.fresnelRefl90=vec3(1.0);
material.roughness=clamp(roughness,0.0,1.0);
#if defined(ENVMAP_TYPE_CUBE)||defined(ENVMAP_TYPE_CUBE_UV)
float geomRoughness=calcGeometryRoughness(geometryNormal);
material.roughness=calcCubeUVAdjustedRoughness(material.roughness,geomRoughness);
#endif
ReflectedLight reflectedLight=ReflectedLight(vec3(0.0),vec3(0.0),vec3(0.0),vec3(0.0));
#ifdef USE_CLEARCOAT
#undef USE_CLEARCOAT
#define _CLEARCOAT_RESTORE
#endif
#ifdef USE_GTAO
vec4 gtaoVisibilityBentNormal=texture2D(gtaoMap,gl_FragCoord.xy/currResolution);
vec3 bentNormal=normalize(unpackRGBToNormal(gtaoVisibilityBentNormal.gba));
#define PROBE_NORMAL bentNormal
#endif
#define RE_Direct RE_Direct_Node
#define RE_IndirectDiffuse RE_IndirectDiffuse_Empty
#define RE_IndirectSpecular RE_IndirectSpecular_Node
#include <lights_fragment_begin>
#include <lights_fragment_maps>
#include <lights_fragment_end>
#undef RE_Direct
#undef RE_IndirectDiffuse
#undef RE_IndirectSpecular
#ifdef PROBE_NORMAL
#undef PROBE_NORMAL
#endif
#ifdef _CLEARCOAT_RESTORE
#undef _CLEARCOAT_RESTORE
#define USE_CLEARCOAT
#endif
#ifdef USE_GTAO
float gtaoVisibility=gtaoVisibilityBentNormal.r;
vec3 gtaoBentNormal=bentNormal;
vec3 gtaoViewDir=geometry.viewDir;
vec3 gtaoNormal=normal;
float gtaoRoughness=material.roughness;
#endif
#include <lights_fragment_gtso>
outColor=vec4(color.rgb*(reflectedLight.directSpecular
+ reflectedLight.indirectSpecular),1.0);
}
void node_bsdf_glossy(vec3 geometryNormal,vec4 color,float roughness,vec3 normal,out vec4 outColor){
node_bsdf_glossy(geometryNormal,color,roughness,0.0,0.0,normal,vec3(0.0),outColor);
}`,Tfe=`void node_bsdf_hair(vec4 color,float offset,float roughnessU,float roughnessV,vec3 tangent,out vec4 outColor)
{
outColor=color;
}`,Ife=`#define BSDF_METALLIC_BECKMANN 0
#define BSDF_METALLIC_GGX 1
#define BSDF_METALLIC_MULTI_GGX 2
vec3 fresnelConductor(float cosi,vec3 eta,vec3 k){
vec3 cosiSqr=vec3(cosi*cosi);
vec3 tmpF=(eta*eta)+(k*k);
vec3 tmp2EtaCosI=2.0*eta*vec3(cosi);
vec3 tmp=tmpF*cosiSqr;
vec3 rparl2=(tmp-tmp2EtaCosI+vec3(1.0))/(tmp+tmp2EtaCosI+vec3(1.0));
vec3 rperp2=(tmpF-tmp2EtaCosI+cosiSqr)/(tmpF+tmp2EtaCosI+cosiSqr);
return (rparl2+rperp2)*0.5;
}
void node_bsdf_metallic(vec3 geometryNormal,const int distribution,const bool usePhysicalConductor,vec4 baseColor,vec4 edgeTint,vec3 ior,vec3 extinction,float roughness,float anisotropy,float rotation,vec3 normal,vec3 tangent,out vec4 outColor){
normal=vec3(normal[0],normal[2],-normal[1]);
normal=normalize((viewMatrix*vec4(normal.xyz,0.0)).xyz);
NodeMaterial material;
if (usePhysicalConductor){
material.specularColor=saturate(fresnelConductor(1.0,ior,extinction));
material.fresnelRefl90=saturate(fresnelConductor(1.0/7.0,ior,extinction));
} else {
material.specularColor=saturate(baseColor.rgb);
material.fresnelRefl90=saturate(edgeTint.rgb);
}
material.specularF90=average(material.fresnelRefl90);
material.roughness=saturate(roughness);
#if defined(ENVMAP_TYPE_CUBE)||defined(ENVMAP_TYPE_CUBE_UV)
float geomRoughness=calcGeometryRoughness(geometryNormal);
material.roughness=calcCubeUVAdjustedRoughness(material.roughness,geomRoughness);
#endif
ReflectedLight reflectedLight=ReflectedLight(vec3(0.0),vec3(0.0),vec3(0.0),vec3(0.0));
#ifdef USE_CLEARCOAT
#undef USE_CLEARCOAT
#define _CLEARCOAT_RESTORE
#endif
#ifdef USE_GTAO
vec4 gtaoVisibilityBentNormal=texture2D(gtaoMap,gl_FragCoord.xy/currResolution);
vec3 bentNormal=normalize(unpackRGBToNormal(gtaoVisibilityBentNormal.gba));
#define PROBE_NORMAL bentNormal
#endif
#define RE_Direct RE_Direct_Node
#define RE_IndirectDiffuse RE_IndirectDiffuse_Empty
#define RE_IndirectSpecular RE_IndirectSpecular_Node
#include <lights_fragment_begin>
#include <lights_fragment_maps>
#include <lights_fragment_end>
#undef RE_Direct
#undef RE_IndirectDiffuse
#undef RE_IndirectSpecular
#ifdef PROBE_NORMAL
#undef PROBE_NORMAL
#endif
#ifdef _CLEARCOAT_RESTORE
#undef _CLEARCOAT_RESTORE
#define USE_CLEARCOAT
#endif
#ifdef USE_GTAO
float gtaoVisibility=gtaoVisibilityBentNormal.r;
vec3 gtaoBentNormal=bentNormal;
vec3 gtaoViewDir=geometry.viewDir;
vec3 gtaoNormal=normal;
float gtaoRoughness=material.roughness;
#endif
#include <lights_fragment_gtso>
outColor=vec4(reflectedLight.directDiffuse+reflectedLight.indirectDiffuse+reflectedLight.directSpecular+reflectedLight.indirectSpecular,1.0);
}`,Rfe=`
vec3 tintFromColor(vec3 color){
float lum=dot(color,vec3(0.3,0.6,0.1));
return lum>0.0?color/lum:vec3(1.0);
}
vec3 fresnelBlend(float ior,float fresnel,vec3 fresnelColor){
float fresnelFac=fresnelReflection(vec3(1.0,0.0,0.0),vec3(1.0,0.0,0.0),ior);
float mixFac=saturate((fresnel-fresnelFac)/max(1e-8,1.0-fresnelFac));
return mix(fresnelColor,vec3(1.0),mixFac);
}
float iorToF0(float eta){
float A=(eta-1.0)/(eta+1.0);
return A*A;
}
#ifdef USE_SHEEN_BLENDER
float principledSheen(float NV,float rough){
float den=35.6694*rough*rough-24.4269*rough*NV-0.1405*NV*NV+6.1211*rough+0.28105*NV-0.1405;
float num=58.5299*rough*rough-85.0941*rough*NV+9.8955*NV*NV+1.9250*rough+74.2268*NV-0.2246;
return saturate(den/num);
}
#elif defined(USE_SHEEN_BLENDER_OLD)
float principledSheen(float NV){
float f=1.0-NV;
float sheen=f*f*f*0.077+f*0.01+0.00026;
return sheen;
}
#endif
void node_bsdf_principled(vec3 geometryNormal,vec4 baseColor,float metallic,float roughness,float ior,float alpha,vec3 normal,float diffuseRoughness,float subsurface,vec3 subsurfaceRadius,float subsurfaceScale,float subsurfaceIOR,float subsurfaceAnisotropy,float specularIORLevel,vec4 specularTint,float anisotropic,float anisotropicRotation,vec3 tangent,float transmission,float clearcoat,float clearcoatRoughness,float clearcoatIOR,vec4 clearcoatTint,vec3 clearcoatNormal,float sheen,float sheenRoughness,vec4 sheenTint,vec4 emission,float emissionStrength,float thinFilmThickness,float thinFilmIOR,out vec4 outColor){
normal=vec3(normal[0],normal[2],-normal[1]);
vec3 normalWorld=normal;
normal=(viewMatrix*vec4(normal.xyz,0.0)).xyz;
NodeMaterial material;
metallic=clamp(metallic,0.0,1.0);
float dielectric=1.0-metallic;
transmission*=dielectric;
material.diffuseColor=baseColor.rgb*dielectric;
#ifdef USE_CLEARCOAT
material.clearcoat=saturate(clearcoat);
material.clearcoatRoughness=clamp(clearcoatRoughness,0.0,1.0);
material.clearcoatF0=vec3(0.04);
material.clearcoatF90=1.0;
#endif
#ifdef USE_SHEEN_BLENDER
float dotNVsh=dot(normal,(isOrthographic)?vec3(0,0,1):normalize(vViewPosition));
material.diffuseColor+=sheen*sheenTint.rgb*principledSheen(dotNVsh,sheenRoughness);
#endif
material.roughness=clamp(roughness,0.0,1.0);
vec3 viewWorld;
if (isOrthographic)
viewWorld=(invViewMatrix*vec4(0.0,0.0,-1.0,0.0)).xyz;
else
viewWorld=(invViewMatrix*vec4(-vViewPosition,0.0)).xyz;
viewWorld=normalize(viewWorld);
float f0d=iorToF0(ior);
if (specularIORLevel != 0.5)
f0d*=2.0*specularIORLevel;
vec3 F0d=vec3(f0d)*specularTint.rgb;
F0d=clamp(F0d,vec3(0.0),vec3(1.0));
vec3 F90d=vec3(1.0);
material.specularColor=mix(F0d,baseColor.rgb,metallic);
material.fresnelRefl90=mix(F90d,specularTint.rgb,metallic);
material.specularF90=average(material.fresnelRefl90);
material.refractionColor=baseColor.rgb;
material.refractionIOR=ior;
material.refractionRoughness=pow2(roughness);
#if defined(ENVMAP_TYPE_CUBE)||defined(ENVMAP_TYPE_CUBE_UV)
float geomRoughness=calcGeometryRoughness(geometryNormal);
material.roughness=calcCubeUVAdjustedRoughness(material.roughness,geomRoughness);
material.refractionRoughness=calcCubeUVAdjustedRoughness(material.refractionRoughness,geomRoughness);
#ifdef USE_CLEARCOAT
material.clearcoatRoughness=calcCubeUVAdjustedRoughness(material.clearcoatRoughness,geomRoughness);
clearcoatNormal=normalize(vec3(clearcoatNormal[0],clearcoatNormal[2],-clearcoatNormal[1]));
clearcoatNormal=(viewMatrix*vec4(clearcoatNormal.xyz,0.0)).xyz;
#endif
#endif
ReflectedLight reflectedLight=ReflectedLight(vec3(0.0),vec3(0.0),vec3(0.0),vec3(0.0));
vec3 refractedLight=vec3(0.0);
#ifdef USE_GTAO
vec4 gtaoVisibilityBentNormal=texture2D(gtaoMap,gl_FragCoord.xy/currResolution);
vec3 bentNormal=normalize(unpackRGBToNormal(gtaoVisibilityBentNormal.gba));
#define PROBE_NORMAL bentNormal
#endif
#define RE_Direct RE_Direct_Node
#define RE_IndirectDiffuse RE_IndirectDiffuse_Node
#define RE_IndirectSpecular RE_IndirectSpecular_Node
#define RE_Refraction RE_Refraction_Node
#include <lights_fragment_begin>
#include <lights_fragment_maps>
#ifdef USE_CLEARCOAT
clearcoatSpecular+=clearcoatRadiance*BRDF_Specular_GGX_Environment(geometry.viewDir,geometry.clearcoatNormal,material.clearcoatF0,vec3(material.clearcoatF90),material.clearcoatRoughness);
#endif
irradiance+=iblIrradiance;
vec3 specEnv=BRDF_Specular_GGX_Environment(geometry.viewDir,geometry.normal,material.specularColor,material.fresnelRefl90,material.roughness);
reflectedLight.indirectSpecular+=radiance*specEnv;
float weight=1.0;
weight*=max((1.0-max3(specEnv)),0.0);
material.diffuseColor*=weight;
RE_IndirectDiffuse(irradiance,geometry,material,reflectedLight);
RE_Refraction(refraction,material,refractedLight);
#undef RE_Direct
#undef RE_IndirectDiffuse
#undef RE_IndirectSpecular
#undef RE_Refraction
#ifdef PROBE_NORMAL
#undef PROBE_NORMAL
#endif
#ifdef USE_GTAO
reflectedLight.indirectDiffuse*=gtaoVisibilityBentNormal.r;
float gtaoVisibility=gtaoVisibilityBentNormal.r;
vec3 gtaoBentNormal=bentNormal;
vec3 gtaoViewDir=geometry.viewDir;
vec3 gtaoNormal=normal;
float gtaoRoughness=material.roughness;
#endif
#include <lights_fragment_gtso>
float fresnel=fresnelReflection(viewWorld,normalWorld,ior);
vec3 outColor3=(reflectedLight.directDiffuse+reflectedLight.indirectDiffuse)*(1.0-transmission)
+ reflectedLight.directSpecular+reflectedLight.indirectSpecular
+ refractedLight*transmission*(1.0-fresnel)
+ emission.rgb*emissionStrength;
#ifdef USE_CLEARCOAT
float dotNVcc=saturate(dot(geometry.normal,geometry.viewDir));
vec3 Fcc=F_Schlick(material.clearcoatF0,material.clearcoatF90,dotNVcc);
outColor3=outColor3*(1.0-material.clearcoat*Fcc)+clearcoatSpecular*material.clearcoat;
#endif
outColor=vec4(outColor3,alpha);
}
void node_bsdf_principled(vec3 geometryNormal,vec4 baseColor,float metallic,float roughness,float ior,float alpha,vec3 normal,float subsurface,vec3 subsurfaceRadius,float subsurfaceScale,float subsurfaceIOR,float subsurfaceAnisotropy,float specularIORLevel,vec4 specularTint,float anisotropic,float anisotropicRotation,vec3 tangent,float transmission,float clearcoat,float clearcoatRoughness,float clearcoatIOR,vec4 clearcoatTint,vec3 clearcoatNormal,float sheen,float sheenRoughness,vec4 sheenTint,vec4 emission,float emissionStrength,float thinFilmThickness,float thinFilmIOR,out vec4 outColor){
node_bsdf_principled(geometryNormal,baseColor,metallic,roughness,ior,alpha,normal,0.0,subsurface,subsurfaceRadius,subsurfaceScale,subsurfaceIOR,subsurfaceAnisotropy,specularIORLevel,specularTint,anisotropic,anisotropicRotation,tangent,transmission,clearcoat,clearcoatRoughness,clearcoatIOR,clearcoatTint,clearcoatNormal,sheen,sheenRoughness,sheenTint,emission,emissionStrength,0.0,0.0,outColor);
}
void node_bsdf_principled(vec3 geometryNormal,vec4 baseColor,float metallic,float roughness,float ior,float alpha,vec3 normal,float subsurface,vec3 subsurfaceRadius,float subsurfaceScale,float subsurfaceIOR,float subsurfaceAnisotropy,float specularIORLevel,vec4 specularTint,float anisotropic,float anisotropicRotation,vec3 tangent,float transmission,float clearcoat,float clearcoatRoughness,float clearcoatIOR,vec4 clearcoatTint,vec3 clearcoatNormal,float sheen,float sheenRoughness,vec4 sheenTint,vec4 emission,float emissionStrength,out vec4 outColor){
node_bsdf_principled(geometryNormal,baseColor,metallic,roughness,ior,alpha,normal,subsurface,subsurfaceRadius,subsurfaceScale,subsurfaceIOR,subsurfaceAnisotropy,specularIORLevel,specularTint,anisotropic,anisotropicRotation,tangent,transmission,clearcoat,clearcoatRoughness,clearcoatIOR,clearcoatTint,clearcoatNormal,sheen,sheenRoughness,sheenTint,emission,emissionStrength,0.0,0.0,outColor);
}
void node_bsdf_principled(vec3 geometryNormal,vec4 baseColor,float subsurface,vec3 subsurfaceRadius,vec4 subsurfaceColor,float subsurfaceIOR,float subsurfaceAnisotropy,float metallic,float specular,float specularTint,float roughness,float anisotropic,float anisotropicRotation,float sheen,float sheenTint,float clearcoat,float clearcoatRoughness,float ior,float transmission,float transmissionRoughness,vec4 emission,float emissionStrength,float alpha,vec3 normal,vec3 clearcoatNormal,vec3 tangent,out vec4 outColor){
normal=vec3(normal[0],normal[2],-normal[1]);
vec3 normalWorld=normal;
normal=(viewMatrix*vec4(normal.xyz,0.0)).xyz;
NodeMaterial material;
metallic=clamp(metallic,0.0,1.0);
float dielectric=1.0-metallic;
transmission*=dielectric;
material.diffuseColor=baseColor.rgb*dielectric;
#ifndef USE_CLEARCOAT
float dielReflCoeff=0.08;
#else
float dielReflCoeff=0.16;
material.clearcoat=saturate(clearcoat);
material.clearcoatRoughness=clamp(clearcoatRoughness,0.0,1.0);
material.clearcoatF0=vec3(0.04);
material.clearcoatF90=1.0;
#endif
#if defined(USE_SHEEN_BLENDER_OLD)
float dotNVsh=dot(normal,(isOrthographic)?vec3(0,0,1):normalize(vViewPosition));
vec3 sheenColor=mix(vec3(1.0),tintFromColor(baseColor.rgb),sheenTint);
material.diffuseColor+=sheen*sheenColor*principledSheen(dotNVsh);
#endif
vec3 dielRefl=dielReflCoeff*specular
* mix(vec3(1.0),tintFromColor(baseColor.rgb),specularTint);
material.specularColor=mix(dielRefl,baseColor.rgb,metallic);
material.roughness=clamp(roughness,0.0,1.0);
vec3 viewWorld;
if (isOrthographic)
viewWorld=(invViewMatrix*vec4(0.0,0.0,-1.0,0.0)).xyz;
else
viewWorld=(invViewMatrix*vec4(-vViewPosition,0.0)).xyz;
viewWorld=normalize(viewWorld);
float fresnel=fresnelReflection(viewWorld,normalWorld,ior);
vec3 fresnelColor=mix(vec3(1.0),baseColor.rgb,specularTint);
material.specularColor=mix(material.specularColor,fresnelBlend(ior,fresnel,fresnelColor)*fresnel,transmission);
float isStrictDielectric=step(0.0,-length(vec4(subsurface,clearcoat,transmission,float(metallic==1.0))));
material.fresnelRefl90=mix(vec3(1.0),material.specularColor,(1.0-specular)*metallic*(1.0-isStrictDielectric));
material.specularF90=average(material.fresnelRefl90);
material.refractionColor=baseColor.rgb;
material.refractionIOR=ior;
material.refractionRoughness=pow2(roughness);
#if defined(ENVMAP_TYPE_CUBE)||defined(ENVMAP_TYPE_CUBE_UV)
float geomRoughness=calcGeometryRoughness(geometryNormal);
material.roughness=calcCubeUVAdjustedRoughness(material.roughness,geomRoughness);
material.refractionRoughness=calcCubeUVAdjustedRoughness(material.refractionRoughness,geomRoughness);
#ifdef USE_CLEARCOAT
material.clearcoatRoughness=calcCubeUVAdjustedRoughness(material.clearcoatRoughness,geomRoughness);
clearcoatNormal=normalize(vec3(clearcoatNormal[0],clearcoatNormal[2],-clearcoatNormal[1]));
clearcoatNormal=(viewMatrix*vec4(clearcoatNormal.xyz,0.0)).xyz;
#endif
#endif
ReflectedLight reflectedLight=ReflectedLight(vec3(0.0),vec3(0.0),vec3(0.0),vec3(0.0));
vec3 refractedLight=vec3(0.0);
#ifdef USE_GTAO
vec4 gtaoVisibilityBentNormal=texture2D(gtaoMap,gl_FragCoord.xy/currResolution);
vec3 bentNormal=normalize(unpackRGBToNormal(gtaoVisibilityBentNormal.gba));
#define PROBE_NORMAL bentNormal
#endif
#define RE_Direct RE_Direct_Node
#define RE_IndirectDiffuse RE_IndirectDiffuse_Node
#define RE_IndirectSpecular RE_IndirectSpecular_Node
#define RE_Refraction RE_Refraction_Node
#include <lights_fragment_begin>
#include <lights_fragment_maps>
#include <lights_fragment_end>
#undef RE_Direct
#undef RE_IndirectDiffuse
#undef RE_IndirectSpecular
#undef RE_Refraction
#ifdef PROBE_NORMAL
#undef PROBE_NORMAL
#endif
#ifdef USE_GTAO
reflectedLight.indirectDiffuse*=gtaoVisibilityBentNormal.r;
float gtaoVisibility=gtaoVisibilityBentNormal.r;
vec3 gtaoBentNormal=bentNormal;
vec3 gtaoViewDir=geometry.viewDir;
vec3 gtaoNormal=normal;
float gtaoRoughness=material.roughness;
#endif
#include <lights_fragment_gtso>
vec3 outColor3=(reflectedLight.directDiffuse+reflectedLight.indirectDiffuse)*(1.0-transmission)
+ reflectedLight.directSpecular+reflectedLight.indirectSpecular
+ refractedLight*transmission*(1.0-fresnel)
+ emission.rgb*emissionStrength;
#ifdef USE_CLEARCOAT
float dotNVcc=saturate(dot(geometry.normal,geometry.viewDir));
vec3 Fcc=F_Schlick(material.clearcoatF0,material.clearcoatF90,dotNVcc);
outColor3=outColor3*(1.0-material.clearcoat*Fcc)+clearcoatSpecular*material.clearcoat;
#endif
outColor=vec4(outColor3,alpha);
}`,Lfe=`#define BSDF_REFRACTION_GGX 0
#define BSDF_REFRACTION_BECKMANN 1
#define BSDF_REFRACTION_SHARP 2
void node_bsdf_refraction(vec3 geometryNormal,const int distribution,vec4 color,float roughness,float ior,vec3 normal,out vec4 outColor){
normal=swizzleUpY(normal);
normal=(viewMatrix*vec4(normal.xyz,0.0)).xyz;
NodeMaterial material;
material.refractionColor=color.rgb;
material.refractionIOR=ior;
if (distribution==BSDF_REFRACTION_SHARP){
material.refractionRoughness=0.0;
} else {
material.refractionRoughness=pow2(roughness);
}
#if defined(ENVMAP_TYPE_CUBE)||defined(ENVMAP_TYPE_CUBE_UV)
float geomRoughness=calcGeometryRoughness(geometryNormal);
material.refractionRoughness=calcCubeUVAdjustedRoughness(material.refractionRoughness,geomRoughness);
#endif
ReflectedLight reflectedLight=ReflectedLight(vec3(0.0),vec3(0.0),vec3(0.0),vec3(0.0));
vec3 refractedLight=vec3(0.0);
#ifdef USE_CLEARCOAT
#undef USE_CLEARCOAT
#define _CLEARCOAT_RESTORE
#endif
#define RE_Refraction RE_Refraction_Node
#include <lights_fragment_begin>
#include <lights_fragment_maps>
#include <lights_fragment_end>
#undef RE_Refraction
#ifdef _CLEARCOAT_RESTORE
#undef _CLEARCOAT_RESTORE
#define USE_CLEARCOAT
#endif
outColor=vec4(refractedLight,1.0);
}`,Pfe=`
void node_bsdf_sheen(vec4 color,float roughness,vec3 normal,out vec4 outColor)
{
normal=vec3(normal[0],normal[2],-normal[1]);
normal=(viewMatrix*vec4(normal.xyz,0.0)).xyz;
NodeMaterial material;
material.diffuseColor=color.rgb;
ReflectedLight reflectedLight=ReflectedLight(vec3(0.0),vec3(0.0),vec3(0.0),vec3(0.0));
#ifdef USE_CLEARCOAT
#undef USE_CLEARCOAT
#define _CLEARCOAT_RESTORE
#endif
#define RE_Direct RE_DirectDiffuseOnly_Node
#define RE_IndirectDiffuse RE_IndirectDiffuse_Node
#include <lights_fragment_begin>
#include <lights_fragment_maps>
#include <lights_fragment_end>
#undef RE_Direct
#undef RE_IndirectDiffuse
#ifdef _CLEARCOAT_RESTORE
#undef _CLEARCOAT_RESTORE
#define USE_CLEARCOAT
#endif
outColor=vec4(reflectedLight.directDiffuse+reflectedLight.indirectDiffuse,1.0);
}`,Dfe=`void node_bsdf_toon(vec4 color,float size,float smoothFac,vec3 normal,out vec4 outColor)
{
outColor=color;
}`,Bfe=`void node_bsdf_translucent(vec4 color,vec3 normal,out vec4 outColor){
normal=-vec3(normal[0],normal[2],-normal[1]);
normal=(viewMatrix*vec4(normal.xyz,0.0)).xyz;
NodeMaterial material;
material.diffuseColor=color.rgb;
ReflectedLight reflectedLight=ReflectedLight(vec3(0.0),vec3(0.0),vec3(0.0),vec3(0.0));
#ifdef USE_CLEARCOAT
#undef USE_CLEARCOAT
#define _CLEARCOAT_RESTORE
#endif
#define RE_Direct RE_DirectDiffuseOnly_Node
#define RE_IndirectDiffuse RE_IndirectDiffuse_Node
#include <lights_fragment_begin>
#include <lights_fragment_maps>
#include <lights_fragment_end>
#undef RE_Direct
#undef RE_IndirectDiffuse
#ifdef _CLEARCOAT_RESTORE
#undef _CLEARCOAT_RESTORE
#define USE_CLEARCOAT
#endif
outColor=vec4(reflectedLight.directDiffuse+reflectedLight.indirectDiffuse,1.0);
}`,Nfe=`void node_bsdf_transparent(vec4 color,out vec4 outColor)
{
float alpha=saturate(1.0-dot(color.rgb,vec3(0.333333)));
outColor=vec4(0.0,0.0,0.0,alpha);
}`,Ofe=`
void node_bsdf_velvet(vec4 color,float sigma,vec3 normal,out vec4 outColor)
{
outColor=color;
}`,kfe=`void node_bump(const bool invert,float strength,float bumpDist,float filterWidth,float height,vec3 normal,out vec3 outNormal){
vec3 position=swizzleUpZ(vWorldPosition);
if (invert)
bumpDist*=-1.0;
vec3 dPdx=dFdx(position);
vec3 dPdy=dFdy(position);
float dHdx=dFdx(height);
float dHdy=dFdy(height);
vec3 tanX=cross(dPdy,normal);
vec3 tanY=cross(normal,dPdx);
vec3 surfaceGrad=dHdx*tanX+dHdy*tanY;
float dotPosTanX=dot(dPdx,tanX);
outNormal=normalize(normal*abs(dotPosTanX)-surfaceGrad*bumpDist*sign(dotPosTanX));
outNormal=normalize(mix(normal,outNormal,max(0.0,strength)));
}
void node_bump(const bool invert,float strength,float bumpDist,float height,vec3 normal,out vec3 outNormal){
node_bump(invert,strength,bumpDist,1.0,height,normal,outNormal);
}
void node_bump(const bool invert,float strength,float bumpDist,float height,float height_dx,float height_dy,vec3 normal,out vec3 outNormal){
node_bump(invert,strength,bumpDist,1.0,height,normal,outNormal);
}`,Ffe=`void node_camera(vec3 viewPos,const bool invCamZ,out vec3 outViewVector,out float outViewZDepth,out float outViewDistance)
{
viewPos=-viewPos;
if (invCamZ)
viewPos.z=-viewPos.z;
outViewVector=normalize(viewPos);
outViewZDepth=abs(viewPos.z);
outViewDistance=length(viewPos);
}`,Vfe=`void node_clamp(bool clampRange,float value,float minVal,float maxVal,out float result){
if (clampRange)
result=(maxVal>minVal)?clamp(value,minVal,maxVal):clamp(value,maxVal,minVal);
else
result=min(max(value,minVal),maxVal);
}`,Ufe=`
void node_combhsv(float h,float s,float v,out vec4 col)
{
hsvToRGB(vec4(h,s,v,1.0),col);
}`,zfe=`#define NODE_COMB_COL_RGB 0
#define NODE_COMB_COL_HSV 1
#define NODE_COMB_COL_HSL 2
void hslToRGB(vec3 hsl,out vec3 outCol)
{
float nr,ng,nb,chroma;
float h,s,l;
h=hsl[0];
s=hsl[1];
l=hsl[2];
nr=abs(h*6.0-3.0)-1.0;
ng=2.0-abs(h*6.0-2.0);
nb=2.0-abs(h*6.0-4.0);
nr=clamp(nr,0.0,1.0);
nb=clamp(nb,0.0,1.0);
ng=clamp(ng,0.0,1.0);
chroma=(1.0-abs(2.0*l-1.0))*s;
outCol=vec3((nr-0.5)*chroma+l,(ng-0.5)*chroma+l,(nb-0.5)*chroma+l);
}
void node_combine_color(int mode,float r,float g,float b,out vec4 col)
{
if (mode==NODE_COMB_COL_RGB){
col=vec4(r,g,b,1.0);
} else if (mode==NODE_COMB_COL_HSV){
hsvToRGB(vec4(r,g,b,1.0),col);
} else {
vec3 col3;
hslToRGB(vec3(r,g,b),col3);
col=vec4(col3,1.0);
}
}`,Gfe=`
void node_combrgb(float r,float g,float b,out vec4 col)
{
col=vec4(r,g,b,1.0);
}`,Hfe=`void node_combxyz(float x,float y,float z,out vec3 outVector)
{
outVector=vec3(x,y,z);
}`,Wfe=`void node_curve_float(sampler2D curveData,float fac,float value,out float outValue)
{
outValue=texture2D(curveData,vec2((value+1.0)*0.5,0.0)).x;
outValue=mix(value,outValue*2.0-1.0,fac);
}`,jfe=`void node_curve_rgb(sampler2D curveData,float fac,vec4 col,out vec4 outCol)
{
outCol.r=texture2D(curveData,vec2(texture2D(curveData,vec2(col.r,0.0)).a,0.0)).r;
outCol.g=texture2D(curveData,vec2(texture2D(curveData,vec2(col.g,0.0)).a,0.0)).g;
outCol.b=texture2D(curveData,vec2(texture2D(curveData,vec2(col.b,0.0)).a,0.0)).b;
outCol=mix(col,outCol,fac);
outCol.a=col.a;
}`,Qfe=`void node_curve_vec(sampler2D curveData,float fac,vec3 vec,out vec3 outVec)
{
outVec.x=texture2D(curveData,vec2((vec.x+1.0)*0.5,0.0)).x;
outVec.y=texture2D(curveData,vec2((vec.y+1.0)*0.5,0.0)).y;
outVec.z=texture2D(curveData,vec2((vec.z+1.0)*0.5,0.0)).z;
outVec=mix(vec,outVec*2.0-vec3(1.0),fac);
}`,$fe=`void node_diffuse_bsdf(vec4 color,float roughness,vec3 normal,out vec4 outColor){
normal=vec3(normal[0],normal[2],-normal[1]);
normal=(viewMatrix*vec4(normal.xyz,0.0)).xyz;
NodeMaterial material;
material.diffuseColor=color.rgb;
ReflectedLight reflectedLight=ReflectedLight(vec3(0.0),vec3(0.0),vec3(0.0),vec3(0.0));
#ifdef USE_CLEARCOAT
#undef USE_CLEARCOAT
#define _CLEARCOAT_RESTORE
#endif
#ifdef USE_GTAO
vec4 gtaoVisibilityBentNormal=texture2D(gtaoMap,gl_FragCoord.xy/currResolution);
vec3 bentNormal=normalize(unpackRGBToNormal(gtaoVisibilityBentNormal.gba));
#define PROBE_NORMAL bentNormal
#endif
#define RE_Direct RE_DirectDiffuseOnly_Node
#define RE_IndirectDiffuse RE_IndirectDiffuse_Node
#include <lights_fragment_begin>
#include <lights_fragment_maps>
#include <lights_fragment_end>
#undef RE_Direct
#undef RE_IndirectDiffuse
#ifdef PROBE_NORMAL
#undef PROBE_NORMAL
#endif
#ifdef _CLEARCOAT_RESTORE
#undef _CLEARCOAT_RESTORE
#define USE_CLEARCOAT
#endif
#ifdef USE_GTAO
reflectedLight.indirectDiffuse*=gtaoVisibilityBentNormal.r;
#endif
outColor=vec4(reflectedLight.directDiffuse+reflectedLight.indirectDiffuse,1.0);
}`,Yfe=`void node_displacement(float height,float midlevel,float scale,vec3 normal,out vec3 outDisplacement){
outDisplacement=vec3(0.0);
}`,Xfe=`void node_eevee_specular(vec3 geometryNormal,vec4 baseColor,vec4 specular,float roughness,vec4 emissiveColor,float transparency,vec3 normal,float clearcoat,float clearcoatRoughness,vec3 clearcoatNormal,float ambientOcclusion,out vec4 outColor){
normal=vec3(normal[0],normal[2],-normal[1]);
vec3 normalWorld=normal;
normal=(viewMatrix*vec4(normal.xyz,0.0)).xyz;
NodeMaterial material;
material.diffuseColor=baseColor.rgb;
material.specularColor=specular.rgb;
material.roughness=clamp(roughness,0.0,1.0);
#ifdef USE_CLEARCOAT
material.clearcoat=saturate(clearcoat);
material.clearcoatRoughness=clamp(clearcoatRoughness,0.0,1.0);
#endif
#if defined(ENVMAP_TYPE_CUBE)||defined(ENVMAP_TYPE_CUBE_UV)
float geomRoughness=calcGeometryRoughness(geometryNormal);
material.roughness=calcCubeUVAdjustedRoughness(material.roughness,geomRoughness);
#ifdef USE_CLEARCOAT
material.clearcoatRoughness=calcCubeUVAdjustedRoughness(material.clearcoatRoughness,geomRoughness);
clearcoatNormal=normalize(vec3(clearcoatNormal[0],clearcoatNormal[2],-clearcoatNormal[1]));
clearcoatNormal=(viewMatrix*vec4(clearcoatNormal.xyz,0.0)).xyz;
#endif
#endif
ReflectedLight reflectedLight=ReflectedLight(vec3(0.0),vec3(0.0),vec3(0.0),vec3(0.0));
#ifdef USE_GTAO
vec4 gtaoVisibilityBentNormal=texture2D(gtaoMap,gl_FragCoord.xy/currResolution);
vec3 bentNormal=normalize(unpackRGBToNormal(gtaoVisibilityBentNormal.gba));
#define PROBE_NORMAL bentNormal
#endif
#define RE_Direct RE_Direct_Node
#define RE_IndirectDiffuse RE_IndirectDiffuse_Node
#define RE_IndirectSpecular RE_IndirectSpecular_Node
#include <lights_fragment_begin>
#include <lights_fragment_maps>
#include <lights_fragment_end>
#undef RE_Direct
#undef RE_IndirectDiffuse
#undef RE_IndirectSpecular
#ifdef PROBE_NORMAL
#undef PROBE_NORMAL
#endif
#ifdef USE_GTAO
reflectedLight.indirectDiffuse*=gtaoVisibilityBentNormal.r;
float gtaoVisibility=gtaoVisibilityBentNormal.r;
vec3 gtaoBentNormal=bentNormal;
vec3 gtaoViewDir=geometry.viewDir;
vec3 gtaoNormal=normal;
float gtaoRoughness=material.roughness;
#endif
#include <lights_fragment_gtso>
vec3 outColor3=(reflectedLight.directDiffuse+reflectedLight.indirectDiffuse
+ reflectedLight.directSpecular+reflectedLight.indirectSpecular)*ambientOcclusion
+ emissiveColor.rgb;
outColor=vec4(outColor3,1.0-transparency);
}`,qfe=`void node_emission(vec4 color,float strength,out vec4 outColor)
{
outColor=vec4(strength*color.rgb,1.0);
}`,Kfe=`void node_fresnel(vec3 viewPos,float IOR,vec3 normal,out float fac)
{
vec3 worldDir;
if (isOrthographic)
worldDir=(invViewMatrix*vec4(0.0,0.0,-1.0,0.0)).xyz;
else
worldDir=(invViewMatrix*vec4(-viewPos,0.0)).xyz;
worldDir=normalize(swizzleUpZ(worldDir));
float eta=max(IOR,0.00001);
fac=fresnelReflection(worldDir,normal,(gl_FrontFacing)?eta:1.0/eta);
}`,Zfe=`void node_gamma(vec4 col,float gamma,out vec4 outCol)
{
outCol=col;
if (col.r>0.0)
outCol.r=powCompat(col.r,gamma);
if (col.g>0.0)
outCol.g=powCompat(col.g,gamma);
if (col.b>0.0)
outCol.b=powCompat(col.b,gamma);
}`,Jfe=`
void node_hair_info(out float isStrand,out float intercept,out float len,out float thickness,out vec3 tangentNormal,out float random){
isStrand=0.0;
intercept=0.0;
len=0.0;
thickness=0.0;
tangentNormal=vec3(0.0);
random=1.0;
}
void node_hair_info(out float isStrand,out float intercept,out float thickness,out vec3 tangentNormal,out float random){
float len;
node_hair_info(isStrand,intercept,len,thickness,tangentNormal,random);
}`,ehe=`void node_holdout(out vec4 outColor)
{
outColor=vec4(0.0);
}`,the=`void node_hue_sat(float hue,float sat,float value,float fac,vec4 col,out vec4 outCol)
{
vec4 hsv;
rgbToHSV(col,hsv);
hsv[0]+=(fract(hue)-0.5);
if (hsv[0]>1.0)hsv[0]-=1.0;else if (hsv[0]<0.0)hsv[0]+=1.0;
hsv[1]*=sat;
if (hsv[1]>1.0)hsv[1]=1.0;else if (hsv[1]<0.0)hsv[1]=0.0;
hsv[2]*=value;
hsvToRGB(hsv,outCol);
outCol=mix(col,outCol,fac);
}`,nhe=`void node_invert(float fac,vec4 col,out vec4 outCol)
{
outCol.xyz=mix(col.xyz,vec3(1.0,1.0,1.0)-col.xyz,fac);
outCol.w=col.w;
}`,rhe=`void node_layer_weight(vec3 viewPos,float blend,vec3 normal,out float fresnel,out float facing)
{
vec3 worldDir;
if (isOrthographic)
worldDir=(invViewMatrix*vec4(0.0,0.0,-1.0,0.0)).xyz;
else
worldDir=(invViewMatrix*vec4(-viewPos,0.0)).xyz;
worldDir=normalize(swizzleUpZ(worldDir));
float eta=max(1.0-blend,EPSILON);
fresnel=fresnelReflection(worldDir,normal,(gl_FrontFacing)?1.0/eta:eta);
facing=abs(dot(worldDir,normal));
if (blend != 0.5){
blend=clamp(blend,0.0,1.0-EPSILON);
blend=(blend<0.5)?blend*2.0:0.5/(1.0-blend);
facing=pow(facing,blend);
}
facing=1.0-facing;
}`,ohe=`void node_light_falloff(float strength,float inSmooth,out float quadratic,out float linear,out float constant)
{
quadratic=1.0;
linear=1.0;
constant=1.0;
}`,ihe=`void node_light_path(out float isCameraRay,out float isShadowRay,out float isDiffuseRay,out float isGlossyRay,out float isSingularRay,out float isReflectionRay,out float isTransmissionRay,out float isVolumeScatterRay,out float rayLength,out float rayDepth,out float diffuseDepth,out float glossyDepth,out float transparentDepth,out float transmissionDepth)
{
#if LIGHT_PATH_IS_CAM_RAY
isCameraRay=1.0;
#else
isCameraRay=0.0;
#endif
isShadowRay=0.0;
isDiffuseRay=0.0;
isGlossyRay=0.0;
isSingularRay=0.0;
isReflectionRay=0.0;
isTransmissionRay=0.0;
isVolumeScatterRay=0.0;
rayLength=1.0;
rayDepth=1.0;
diffuseDepth=1.0;
glossyDepth=1.0;
transparentDepth=1.0;
transmissionDepth=1.0;
}
void node_light_path(out float isCameraRay,out float isShadowRay,out float isDiffuseRay,out float isGlossyRay,out float isSingularRay,out float isReflectionRay,out float isTransmissionRay,out float rayLength,out float rayDepth,out float diffuseDepth,out float glossyDepth,out float transparentDepth,out float transmissionDepth)
{
#if LIGHT_PATH_IS_CAM_RAY
isCameraRay=1.0;
#else
isCameraRay=0.0;
#endif
isShadowRay=0.0;
isDiffuseRay=0.0;
isGlossyRay=0.0;
isSingularRay=0.0;
isReflectionRay=0.0;
isTransmissionRay=0.0;
rayLength=1.0;
rayDepth=1.0;
diffuseDepth=1.0;
glossyDepth=1.0;
transparentDepth=1.0;
transmissionDepth=1.0;
}`,ahe=`#define NODE_MAPPING_POINT 1
#define NODE_MAPPING_TEXTURE 2
#define NODE_MAPPING_VECTOR 3
#define NODE_MAPPING_NORMAL 4
mat3 rotationMatrix(float angleX,float angleY,float angleZ){
float cx=cos(angleX);
float sx=sin(angleX);
float cy=cos(angleY);
float sy=sin(angleY);
float cz=cos(angleZ);
float sz=sin(angleZ);
mat3 mat;
mat[0][0]=cy*cz;
mat[0][1]=cy*sz;
mat[0][2]=-sy;
mat[1][0]=sy*sx*cz-cx*sz;
mat[1][1]=sy*sx*sz+cx*cz;
mat[1][2]=cy*sx;
mat[2][0]=sy*cx*cz+sx*sz;
mat[2][1]=sy*cx*sz-sx*cz;
mat[2][2]=cy*cx;
return mat;
}
mat3 mat3GetInverseTransposed(mat3 mat){
float det=mat3GetDeterminant(mat);
float a00=(mat[1][1]*mat[2][2]-mat[1][2]*mat[2][1])/det;
float a01=- (mat[1][0]*mat[2][2]-mat[1][2]*mat[2][0])/det;
float a02=(mat[1][0]*mat[2][1]-mat[1][1]*mat[2][0])/det;
float a10=- (mat[0][1]*mat[2][2]-mat[0][2]*mat[2][1])/det;
float a11=(mat[0][0]*mat[2][2]-mat[0][2]*mat[2][0])/det;
float a12=- (mat[0][0]*mat[2][1]-mat[0][1]*mat[2][0])/det;
float a20=(mat[0][1]*mat[1][2]-mat[0][2]*mat[1][1])/det;
float a21=- (mat[0][0]*mat[1][2]-mat[0][2]*mat[1][0])/det;
float a22=(mat[0][0]*mat[1][1]-mat[0][1]*mat[1][0])/det;
return mat3(a00,a01,a02,a10,a11,a12,a20,a21,a22
);
}
void node_mapping(int type,vec3 vec,vec3 loc,vec3 rot,vec3 scale,out vec3 outVec)
{
if (type==NODE_MAPPING_POINT)
outVec=rotationMatrix(rot.x,rot.y,rot.z)*(vec*scale)+loc;
else if (type==NODE_MAPPING_TEXTURE)
outVec=transposeMat3(rotationMatrix(rot.x,rot.y,rot.z))*(vec-loc)/scale;
else if (type==NODE_MAPPING_VECTOR)
outVec=rotationMatrix(rot.x,rot.y,rot.z)*(vec*scale);
else {
mat3 rot=rotationMatrix(rot.x,rot.y,rot.z)*mat3(scale[0],0.0,0.0,0.0,scale[1],0.0,0.0,0.0,scale[2]
);
outVec=normalize(mat3GetInverseTransposed(rot)*vec);
}
}`,she=`#define NODE_MAP_RANGE_INTERP_LINEAR 0
#define NODE_MAP_RANGE_INTERP_STEPPED 1
#define NODE_MAP_RANGE_INTERP_SMOOTHSTEP 2
#define NODE_MAP_RANGE_INTERP_SMOOTHERSTEP 3
#define NODE_MAP_RANGE_TYPE_FLOAT 0
#define NODE_MAP_RANGE_TYPE_FLOAT_VECTOR 1
float smootherstep(float edge0,float edge1,float x){
float t=clamp((x-edge0)/(edge1-edge0),0.0,1.0);
return t*t*t*(t*(t*6.0-15.0)+10.0);
}
vec3 smootherstep(vec3 x){
vec3 t=clamp(x,0.0,1.0);
return (t*(t*6.0-15.0)+10.0)*t*t*t;
}
void node_map_range(const int interpolation,bool inClamp,float value,float fromMin,float fromMax,float toMin,float toMax,float steps,out float result){
if (fromMax==fromMin){
result=0.0;
} else if (interpolation==NODE_MAP_RANGE_INTERP_LINEAR){
result=(value-fromMin)/(fromMax-fromMin)*(toMax-toMin)+toMin;
} else if (interpolation==NODE_MAP_RANGE_INTERP_STEPPED){
float fac=(value-fromMin)/(fromMax-fromMin);
fac=(steps>0.0)?floor(fac*(steps+1.0))/steps:0.0;
result=fac*(toMax-toMin)+toMin;
} else if (interpolation==NODE_MAP_RANGE_INTERP_SMOOTHSTEP){
float fac=(fromMin>fromMax)?
1.0-smoothstep(fromMax,fromMin,value):
smoothstep(fromMin,fromMax,value);
result=fac*(toMax-toMin)+toMin;
} else {
float fac=(fromMin>fromMax)?
1.0-smootherstep(fromMax,fromMin,value):
smootherstep(fromMin,fromMax,value);
result=fac*(toMax-toMin)+toMin;
}
if (inClamp&&interpolation<=NODE_MAP_RANGE_INTERP_STEPPED){
result=clamp(result,toMin,toMax);
}
}
void node_map_range(const int dataType,const int interpolation,bool inClamp,float value,float fromMin,float fromMax,float toMin,float toMax,float steps,vec3 valueVec,vec3 fromMinVec,vec3 fromMaxVec,vec3 toMinVec,vec3 toMaxVec,vec3 stepsVec,out float result,out vec3 resultVec){
if (dataType==NODE_MAP_RANGE_TYPE_FLOAT){
if (fromMax==fromMin){
result=0.0;
} else if (interpolation==NODE_MAP_RANGE_INTERP_LINEAR){
result=(value-fromMin)/(fromMax-fromMin)*(toMax-toMin)+toMin;
} else if (interpolation==NODE_MAP_RANGE_INTERP_STEPPED){
float fac=(value-fromMin)/(fromMax-fromMin);
fac=(steps>0.0)?floor(fac*(steps+1.0))/steps:0.0;
result=fac*(toMax-toMin)+toMin;
} else if (interpolation==NODE_MAP_RANGE_INTERP_SMOOTHSTEP){
float fac=(fromMin>fromMax)?
1.0-smoothstep(fromMax,fromMin,value):
smoothstep(fromMin,fromMax,value);
result=fac*(toMax-toMin)+toMin;
} else {
float fac=(fromMin>fromMax)?
1.0-smootherstep(fromMax,fromMin,value):
smootherstep(fromMin,fromMax,value);
result=fac*(toMax-toMin)+toMin;
}
} else if (dataType==NODE_MAP_RANGE_TYPE_FLOAT_VECTOR){
vec3 deltaVec=fromMaxVec-fromMinVec;
vec3 fac=vec3(deltaVec.x==0.0?0.0:(valueVec.x-fromMinVec.x)/deltaVec.x,deltaVec.y==0.0?0.0:(valueVec.y-fromMinVec.y)/deltaVec.y,deltaVec.z==0.0?0.0:(valueVec.z-fromMinVec.z)/deltaVec.z
);
if (interpolation==NODE_MAP_RANGE_INTERP_LINEAR){
resultVec=fac*(toMaxVec-toMinVec)+toMinVec;
} else if (interpolation==NODE_MAP_RANGE_INTERP_STEPPED){
fac.x=stepsVec.x==0.0?0.0:floor(fac.x*(stepsVec.x+1.0))/stepsVec.x;
fac.y=stepsVec.y==0.0?0.0:floor(fac.y*(stepsVec.y+1.0))/stepsVec.y;
fac.z=stepsVec.z==0.0?0.0:floor(fac.z*(stepsVec.z+1.0))/stepsVec.z;
resultVec=fac*(toMaxVec-toMinVec)+toMinVec;
} else if (interpolation==NODE_MAP_RANGE_INTERP_SMOOTHSTEP){
fac=clamp(fac,0.0,1.0);
fac=fac*fac*(3.0-2.0*fac);
resultVec=fac*(toMaxVec-toMinVec)+toMinVec;
} else {
resultVec=smootherstep(fac)*(toMaxVec-toMinVec)+toMinVec;
}
if (inClamp&&interpolation<=NODE_MAP_RANGE_INTERP_STEPPED){
vec3 sumVec=toMinVec+toMaxVec;
toMaxVec=max(toMaxVec,toMinVec);
toMinVec=sumVec-toMaxVec;
resultVec=clamp(resultVec,toMinVec,toMaxVec);
}
}
}`,lhe=`void node_math_add(float val1,float val2,float val3,out float outVal)
{
outVal=val1+val2;
}
void node_math_subtract(float val1,float val2,float val3,out float outVal)
{
outVal=val1-val2;
}
void node_math_multiply(float val1,float val2,float val3,out float outVal)
{
outVal=val1*val2;
}
void node_math_divide(float val1,float val2,float val3,out float outVal)
{
if (val2==0.0)
outVal=0.0;
else
outVal=val1/val2;
}
void node_math_sine(float val,float val2,float val3,out float outVal)
{
outVal=sin(val);
}
void node_math_cosine(float val,float val2,float val3,out float outVal)
{
outVal=cos(val);
}
void node_math_tangent(float val,float val2,float val3,out float outVal)
{
outVal=tan(val);
}
void node_math_arcsine(float val,float val2,float val3,out float outVal)
{
if (val<=1.0&&val>=-1.0)
outVal=asin(val);
else
outVal=0.0;
}
void node_math_arccosine(float val,float val2,float val3,out float outVal)
{
if (val<=1.0&&val>=-1.0)
outVal=acos(val);
else
outVal=0.0;
}
void node_math_arctangent(float val,float val2,float val3,out float outVal)
{
outVal=atan(val);
}
void node_math_arctan2(float val,float val2,float val3,out float outVal)
{
outVal=atan(val,val2);
}
void node_math_power(float val1,float val2,float val3,out float outVal)
{
if (val1>=0.0)
outVal=powCompat(val1,val2);
else {
float val2_mod_1=mod(abs(val2),1.0);
if (val2_mod_1>0.999||val2_mod_1<0.001)
outVal=powCompat(val1,floor(val2+0.5));
else
outVal=0.0;
}
}
void node_math_logarithm(float val1,float val2,float val3,out float outVal)
{
if (val1>0.0&&val2>0.0)
outVal=log2(val1)/log2(val2);
else
outVal=0.0;
}
void node_math_sqrt(float val1,float val2,float val3,out float outVal)
{
outVal=sqrt(val1);
}
void node_math_maximum(float val1,float val2,float val3,out float outVal)
{
outVal=max(val1,val2);
}
void node_math_minimum(float val1,float val2,float val3,out float outVal)
{
outVal=min(val1,val2);
}
void node_math_round(float val1,float val2,float val3,out float outVal)
{
outVal=floor(val1+0.5);
}
void node_math_floor(float val1,float val2,float val3,out float outVal)
{
outVal=floor(val1);
}
void node_math_ceil(float val1,float val2,float val3,out float outVal)
{
outVal=ceil(val1);
}
void node_math_fract(float val1,float val2,float val3,out float outVal)
{
outVal=fract(val1);
}
void node_math_less_than(float val1,float val2,float val3,out float outVal)
{
if (val1<val2)
outVal=1.0;
else
outVal=0.0;
}
void node_math_greater_than(float val1,float val2,float val3,out float outVal)
{
if (val1>val2)
outVal=1.0;
else
outVal=0.0;
}
void node_math_modulo(float val1,float val2,float val3,out float outVal)
{
if (val2==0.0)
outVal=0.0;
else
outVal=mod(val1,val2);
outVal=(val1>0.0)?outVal:outVal-val2;
}
void node_math_floored_modulo(float val1,float val2,float val3,out float outVal)
{
outVal=(val2 != 0.0)?val1-floor(val1/val2)*val2:0.0;
}
void node_math_absolute(float val1,float val2,float val3,out float outVal)
{
outVal=abs(val1);
}
void node_math_compare(float val1,float val2,float val3,out float outVal){
outVal=step(abs(val1-val2),val3);
}
void node_math_cosh(float val1,float val2,float val3,out float outVal){
outVal=cosh(val1);
}
void node_math_degrees(float val1,float val2,float val3,out float outVal){
outVal=val1/PI*180.0;
}
void node_math_exponent(float val1,float val2,float val3,out float outVal){
outVal=exp(val1);
}
void node_math_inverse_sqrt(float val1,float val2,float val3,out float outVal){
if (val1>=0.0){
outVal=1.0/sqrt(val1);
} else {
outVal=0.0;
}
}
void node_math_multiply_add(float val1,float val2,float val3,out float outVal){
outVal=val1*val2+val3;
}
void node_math_pingpong(float val1,float val2,float val3,out float outVal){
if (val2==0.0){
outVal=0.0;
} else {
float absVal2=abs(val2);
float rem=mod(val1,absVal2);
outVal=mix(rem,absVal2-rem,mod(floor(val1/absVal2),2.0));
}
}
void node_math_radians(float val1,float val2,float val3,out float outVal){
outVal=val1/180.0*PI;
}
void node_math_sign(float val1,float val2,float val3,out float outVal){
outVal=sign(val1);
}
void node_math_sinh(float val1,float val2,float val3,out float outVal){
outVal=sinh(val1);
}
void node_math_smooth_max(float val1,float val2,float val3,out float outVal){
outVal=smoothMax(val1,val2,val3);
}
void node_math_smooth_min(float val1,float val2,float val3,out float outVal){
outVal=smoothMin(val1,val2,val3);
}
void node_math_snap(float val1,float val2,float val3,out float outVal){
val1+=1e-5*sign(val2);
float quot=val1/val2;
outVal=floor(quot)*val2;
}
void node_math_tanh(float val1,float val2,float val3,out float outVal){
outVal=tanh(val1);
}
void node_math_trunc(float val1,float val2,float val3,out float outVal){
val1+=1e-5;
outVal=trunc(val1);
}
void node_math_wrap(float val1,float val2,float val3,out float outVal){
val1+=1e-5;
outVal=mod(val1-val3,val2-val3)+val3;
}`,che=`void node_mix_rgba_mix(float fac,vec4 col1,vec4 col2,out vec4 outCol)
{
fac=clamp(fac,0.0,1.0);
outCol=mix(col1,col2,fac);
outCol.a=col1.a;
}
void node_mix_rgba_add(float fac,vec4 col1,vec4 col2,out vec4 outCol)
{
fac=clamp(fac,0.0,1.0);
outCol=mix(col1,col1+col2,fac);
outCol.a=col1.a;
}
void node_mix_rgba_multiply(float fac,vec4 col1,vec4 col2,out vec4 outCol)
{
fac=clamp(fac,0.0,1.0);
outCol=mix(col1,col1*col2,fac);
outCol.a=col1.a;
}
void node_mix_rgba_screen(float fac,vec4 col1,vec4 col2,out vec4 outCol)
{
fac=clamp(fac,0.0,1.0);
float facm=1.0-fac;
outCol=vec4(1.0)-(vec4(facm)+fac*(vec4(1.0)-col2))*(vec4(1.0)-col1);
outCol.a=col1.a;
}
void node_mix_rgba_overlay(float fac,vec4 col1,vec4 col2,out vec4 outCol)
{
fac=clamp(fac,0.0,1.0);
float facm=1.0-fac;
outCol=col1;
if (outCol.r<0.5)
outCol.r*=facm+2.0*fac*col2.r;
else
outCol.r=1.0-(facm+2.0*fac*(1.0-col2.r))*(1.0-outCol.r);
if (outCol.g<0.5)
outCol.g*=facm+2.0*fac*col2.g;
else
outCol.g=1.0-(facm+2.0*fac*(1.0-col2.g))*(1.0-outCol.g);
if (outCol.b<0.5)
outCol.b*=facm+2.0*fac*col2.b;
else
outCol.b=1.0-(facm+2.0*fac*(1.0-col2.b))*(1.0-outCol.b);
}
void node_mix_rgba_exclusion(float fac,vec4 col1,vec4 col2,out vec4 outCol)
{
fac=clamp(fac,0.0,1.0);
outCol=max(mix(col1,col1+col2-2.0*col1*col2,fac),0.0);
outCol.a=col1.a;
}
void node_mix_rgba_subtract(float fac,vec4 col1,vec4 col2,out vec4 outCol)
{
fac=clamp(fac,0.0,1.0);
outCol=mix(col1,col1-col2,fac);
outCol.a=col1.a;
}
void node_mix_rgba_divide(float fac,vec4 col1,vec4 col2,out vec4 outCol)
{
fac=clamp(fac,0.0,1.0);
float facm=1.0-fac;
outCol=col1;
if (col2.r != 0.0)outCol.r=facm*outCol.r+fac*outCol.r/col2.r;
if (col2.g != 0.0)outCol.g=facm*outCol.g+fac*outCol.g/col2.g;
if (col2.b != 0.0)outCol.b=facm*outCol.b+fac*outCol.b/col2.b;
}
void node_mix_rgba_difference(float fac,vec4 col1,vec4 col2,out vec4 outCol)
{
fac=clamp(fac,0.0,1.0);
outCol=mix(col1,abs(col1-col2),fac);
outCol.a=col1.a;
}
void node_mix_rgba_darken(float fac,vec4 col1,vec4 col2,out vec4 outCol)
{
fac=clamp(fac,0.0,1.0);
outCol.rgb=mix(col1.rgb,min(col1.rgb,col2.rgb),fac);
outCol.a=col1.a;
}
void node_mix_rgba_lighten(float fac,vec4 col1,vec4 col2,out vec4 outCol)
{
fac=clamp(fac,0.0,1.0);
outCol.rgb=mix(col1.rgb,max(col1.rgb,col2.rgb),fac);
outCol.a=col1.a;
}
void node_mix_rgba_dodge(float fac,vec4 col1,vec4 col2,out vec4 outCol)
{
fac=clamp(fac,0.0,1.0);
outCol=col1;
if (outCol.r != 0.0){
float tmp=1.0-fac*col2.r;
if (tmp<=0.0)
outCol.r=1.0;
else if ((tmp=outCol.r/tmp)>1.0)
outCol.r=1.0;
else
outCol.r=tmp;
}
if (outCol.g != 0.0){
float tmp=1.0-fac*col2.g;
if (tmp<=0.0)
outCol.g=1.0;
else if ((tmp=outCol.g/tmp)>1.0)
outCol.g=1.0;
else
outCol.g=tmp;
}
if (outCol.b != 0.0){
float tmp=1.0-fac*col2.b;
if (tmp<=0.0)
outCol.b=1.0;
else if ((tmp=outCol.b/tmp)>1.0)
outCol.b=1.0;
else
outCol.b=tmp;
}
}
void node_mix_rgba_burn(float fac,vec4 col1,vec4 col2,out vec4 outCol)
{
fac=clamp(fac,0.0,1.0);
float tmp,facm=1.0-fac;
outCol=col1;
tmp=facm+fac*col2.r;
if (tmp<=0.0)
outCol.r=0.0;
else if ((tmp=(1.0-(1.0-outCol.r)/tmp))<0.0)
outCol.r=0.0;
else if (tmp>1.0)
outCol.r=1.0;
else
outCol.r=tmp;
tmp=facm+fac*col2.g;
if (tmp<=0.0)
outCol.g=0.0;
else if ((tmp=(1.0-(1.0-outCol.g)/tmp))<0.0)
outCol.g=0.0;
else if (tmp>1.0)
outCol.g=1.0;
else
outCol.g=tmp;
tmp=facm+fac*col2.b;
if (tmp<=0.0)
outCol.b=0.0;
else if ((tmp=(1.0-(1.0-outCol.b)/tmp))<0.0)
outCol.b=0.0;
else if (tmp>1.0)
outCol.b=1.0;
else
outCol.b=tmp;
}
#ifdef HSV_NODES
void node_mix_rgba_hue(float fac,vec4 col1,vec4 col2,out vec4 outCol)
{
fac=clamp(fac,0.0,1.0);
float facm=1.0-fac;
outCol=col1;
vec4 hsv,hsv2,tmp;
rgbToHSV(col2,hsv2);
if (hsv2.y != 0.0){
rgbToHSV(outCol,hsv);
hsv.x=hsv2.x;
hsvToRGB(hsv,tmp);
outCol=mix(outCol,tmp,fac);
outCol.a=col1.a;
}
}
void node_mix_rgba_saturation(float fac,vec4 col1,vec4 col2,out vec4 outCol)
{
fac=clamp(fac,0.0,1.0);
float facm=1.0-fac;
outCol=col1;
vec4 hsv,hsv2;
rgbToHSV(outCol,hsv);
if (hsv.y != 0.0){
rgbToHSV(col2,hsv2);
hsv.y=facm*hsv.y+fac*hsv2.y;
hsvToRGB(hsv,outCol);
}
}
void node_mix_rgba_value(float fac,vec4 col1,vec4 col2,out vec4 outCol)
{
fac=clamp(fac,0.0,1.0);
float facm=1.0-fac;
vec4 hsv,hsv2;
rgbToHSV(col1,hsv);
rgbToHSV(col2,hsv2);
hsv.z=facm*hsv.z+fac*hsv2.z;
hsvToRGB(hsv,outCol);
}
void node_mix_rgba_color(float fac,vec4 col1,vec4 col2,out vec4 outCol)
{
fac=clamp(fac,0.0,1.0);
float facm=1.0-fac;
outCol=col1;
vec4 hsv,hsv2,tmp;
rgbToHSV(col2,hsv2);
if (hsv2.y != 0.0){
rgbToHSV(outCol,hsv);
hsv.x=hsv2.x;
hsv.y=hsv2.y;
hsvToRGB(hsv,tmp);
outCol=mix(outCol,tmp,fac);
outCol.a=col1.a;
}
}
#endif
void node_mix_rgba_soft_light(float fac,vec4 col1,vec4 col2,out vec4 outCol)
{
fac=clamp(fac,0.0,1.0);
float facm=1.0-fac;
vec4 one=vec4(1.0);
vec4 scr=one-(one-col2)*(one-col1);
outCol=facm*col1+fac*((one-col1)*col2*col1+col1*scr);
}
void node_mix_rgba_linear_light(float fac,vec4 col1,vec4 col2,out vec4 outCol)
{
fac=clamp(fac,0.0,1.0);
outCol=col1+fac*(2.0*(col2-vec4(0.5)));
}
void node_mix_vector_uniform(float fac,vec3 facVec,vec3 v1,vec3 v2,out vec3 outVec)
{
fac=clamp(fac,0.0,1.0);
outVec=mix(v1,v2,fac);
}
void node_mix_vector_non_uniform(float fac,vec3 facVec,vec3 v1,vec3 v2,out vec3 outVec)
{
facVec=clamp(facVec,0.0,1.0);
outVec=mix(v1,v2,facVec);
}
void node_mix_float(float fac,float val1,float val2,out float outVal)
{
fac=clamp(fac,0.0,1.0);
outVal=mix(val1,val2,fac);
}`,uhe=`
void node_mix_rgb_mix(float fac,vec4 col1,vec4 col2,out vec4 outCol)
{
fac=clamp(fac,0.0,1.0);
outCol=mix(col1,col2,fac);
outCol.a=col1.a;
}
void node_mix_rgb_add(float fac,vec4 col1,vec4 col2,out vec4 outCol)
{
fac=clamp(fac,0.0,1.0);
outCol=mix(col1,col1+col2,fac);
outCol.a=col1.a;
}
void node_mix_rgb_multiply(float fac,vec4 col1,vec4 col2,out vec4 outCol)
{
fac=clamp(fac,0.0,1.0);
outCol=mix(col1,col1*col2,fac);
outCol.a=col1.a;
}
void node_mix_rgb_screen(float fac,vec4 col1,vec4 col2,out vec4 outCol)
{
fac=clamp(fac,0.0,1.0);
float facm=1.0-fac;
outCol=vec4(1.0)-(vec4(facm)+fac*(vec4(1.0)-col2))*(vec4(1.0)-col1);
outCol.a=col1.a;
}
void node_mix_rgb_overlay(float fac,vec4 col1,vec4 col2,out vec4 outCol)
{
fac=clamp(fac,0.0,1.0);
float facm=1.0-fac;
outCol=col1;
if (outCol.r<0.5)
outCol.r*=facm+2.0*fac*col2.r;
else
outCol.r=1.0-(facm+2.0*fac*(1.0-col2.r))*(1.0-outCol.r);
if (outCol.g<0.5)
outCol.g*=facm+2.0*fac*col2.g;
else
outCol.g=1.0-(facm+2.0*fac*(1.0-col2.g))*(1.0-outCol.g);
if (outCol.b<0.5)
outCol.b*=facm+2.0*fac*col2.b;
else
outCol.b=1.0-(facm+2.0*fac*(1.0-col2.b))*(1.0-outCol.b);
}
void node_mix_rgb_subtract(float fac,vec4 col1,vec4 col2,out vec4 outCol)
{
fac=clamp(fac,0.0,1.0);
outCol=mix(col1,col1-col2,fac);
outCol.a=col1.a;
}
void node_mix_rgb_divide(float fac,vec4 col1,vec4 col2,out vec4 outCol)
{
fac=clamp(fac,0.0,1.0);
float facm=1.0-fac;
outCol=col1;
if (col2.r != 0.0)outCol.r=facm*outCol.r+fac*outCol.r/col2.r;
if (col2.g != 0.0)outCol.g=facm*outCol.g+fac*outCol.g/col2.g;
if (col2.b != 0.0)outCol.b=facm*outCol.b+fac*outCol.b/col2.b;
}
void node_mix_rgb_difference(float fac,vec4 col1,vec4 col2,out vec4 outCol)
{
fac=clamp(fac,0.0,1.0);
outCol=mix(col1,abs(col1-col2),fac);
outCol.a=col1.a;
}
void node_mix_rgb_darken(float fac,vec4 col1,vec4 col2,out vec4 outCol)
{
fac=clamp(fac,0.0,1.0);
outCol.rgb=mix(col1.rgb,min(col1.rgb,col2.rgb),fac);
outCol.a=col1.a;
}
void node_mix_rgb_lighten(float fac,vec4 col1,vec4 col2,out vec4 outCol)
{
fac=clamp(fac,0.0,1.0);
outCol.rgb=max(col1.rgb,col2.rgb*fac);
outCol.a=col1.a;
}
void node_mix_rgb_dodge(float fac,vec4 col1,vec4 col2,out vec4 outCol)
{
fac=clamp(fac,0.0,1.0);
outCol=col1;
if (outCol.r != 0.0){
float tmp=1.0-fac*col2.r;
if (tmp<=0.0)
outCol.r=1.0;
else if ((tmp=outCol.r/tmp)>1.0)
outCol.r=1.0;
else
outCol.r=tmp;
}
if (outCol.g != 0.0){
float tmp=1.0-fac*col2.g;
if (tmp<=0.0)
outCol.g=1.0;
else if ((tmp=outCol.g/tmp)>1.0)
outCol.g=1.0;
else
outCol.g=tmp;
}
if (outCol.b != 0.0){
float tmp=1.0-fac*col2.b;
if (tmp<=0.0)
outCol.b=1.0;
else if ((tmp=outCol.b/tmp)>1.0)
outCol.b=1.0;
else
outCol.b=tmp;
}
}
void node_mix_rgb_burn(float fac,vec4 col1,vec4 col2,out vec4 outCol)
{
fac=clamp(fac,0.0,1.0);
float tmp,facm=1.0-fac;
outCol=col1;
tmp=facm+fac*col2.r;
if (tmp<=0.0)
outCol.r=0.0;
else if ((tmp=(1.0-(1.0-outCol.r)/tmp))<0.0)
outCol.r=0.0;
else if (tmp>1.0)
outCol.r=1.0;
else
outCol.r=tmp;
tmp=facm+fac*col2.g;
if (tmp<=0.0)
outCol.g=0.0;
else if ((tmp=(1.0-(1.0-outCol.g)/tmp))<0.0)
outCol.g=0.0;
else if (tmp>1.0)
outCol.g=1.0;
else
outCol.g=tmp;
tmp=facm+fac*col2.b;
if (tmp<=0.0)
outCol.b=0.0;
else if ((tmp=(1.0-(1.0-outCol.b)/tmp))<0.0)
outCol.b=0.0;
else if (tmp>1.0)
outCol.b=1.0;
else
outCol.b=tmp;
}
#ifdef HSV_NODES
void node_mix_rgb_hue(float fac,vec4 col1,vec4 col2,out vec4 outCol)
{
fac=clamp(fac,0.0,1.0);
float facm=1.0-fac;
outCol=col1;
vec4 hsv,hsv2,tmp;
rgbToHSV(col2,hsv2);
if (hsv2.y != 0.0){
rgbToHSV(outCol,hsv);
hsv.x=hsv2.x;
hsvToRGB(hsv,tmp);
outCol=mix(outCol,tmp,fac);
outCol.a=col1.a;
}
}
void node_mix_rgb_saturation(float fac,vec4 col1,vec4 col2,out vec4 outCol)
{
fac=clamp(fac,0.0,1.0);
float facm=1.0-fac;
outCol=col1;
vec4 hsv,hsv2;
rgbToHSV(outCol,hsv);
if (hsv.y != 0.0){
rgbToHSV(col2,hsv2);
hsv.y=facm*hsv.y+fac*hsv2.y;
hsvToRGB(hsv,outCol);
}
}
void node_mix_rgb_value(float fac,vec4 col1,vec4 col2,out vec4 outCol)
{
fac=clamp(fac,0.0,1.0);
float facm=1.0-fac;
vec4 hsv,hsv2;
rgbToHSV(col1,hsv);
rgbToHSV(col2,hsv2);
hsv.z=facm*hsv.z+fac*hsv2.z;
hsvToRGB(hsv,outCol);
}
void node_mix_rgb_color(float fac,vec4 col1,vec4 col2,out vec4 outCol)
{
fac=clamp(fac,0.0,1.0);
float facm=1.0-fac;
outCol=col1;
vec4 hsv,hsv2,tmp;
rgbToHSV(col2,hsv2);
if (hsv2.y != 0.0){
rgbToHSV(outCol,hsv);
hsv.x=hsv2.x;
hsv.y=hsv2.y;
hsvToRGB(hsv,tmp);
outCol=mix(outCol,tmp,fac);
outCol.a=col1.a;
}
}
#endif
void node_mix_rgb_soft_light(float fac,vec4 col1,vec4 col2,out vec4 outCol)
{
fac=clamp(fac,0.0,1.0);
float facm=1.0-fac;
vec4 one=vec4(1.0);
vec4 scr=one-(one-col2)*(one-col1);
outCol=facm*col1+fac*((one-col1)*col2*col1+col1*scr);
}
void node_mix_rgb_linear_light(float fac,vec4 col1,vec4 col2,out vec4 outCol)
{
fac=clamp(fac,0.0,1.0);
outCol=col1+fac*(2.0*(col2-vec4(0.5)));
}`,dhe=`void node_mix_shader(int transpShaderNum,float fac,vec4 color1,vec4 color2,out vec4 outColor)
{
if (transpShaderNum==0)
color1.rgb=color2.rgb;
else if (transpShaderNum==1)
color2.rgb=color1.rgb;
outColor=mix(color1,color2,clamp(fac,0.0,1.0));
}`,fhe=`void node_new_geometry(float frontFacing,vec3 viewPos,vec3 viewNorm,out vec3 position,out vec3 normal,out vec3 tangent,out vec3 trueNormal,out vec3 incoming,out vec3 parametric,out float backfacing,out float pointiness,out float randomPerIsland)
{
vec4 posWorld=invViewMatrix*vec4(-viewPos,1.0);
position=swizzleUpZ(posWorld.xyz);
vec4 viewDir=isOrthographic?vec4(0.0,0.0,-1.0,0.0):vec4(normalize(-viewPos),0.0);
viewDir=invViewMatrix*viewDir;
vec3 incomingVec=-swizzleUpZ(viewDir.xyz);
#if WORLD_NODES==1
normal=incomingVec;
tangent=vec3(0.0);
#else
vec3 norWorld=normalize(invViewMatrix*vec4(viewNorm,0.0)).xyz;
normal=swizzleUpZ(norWorld);
vec4 posLocal=invModelMatrix*posWorld;
vec3 posLocalDelta=posLocal.xyz-boundingBoxMin;
vec3 bbDelta=boundingBoxMax-boundingBoxMin;
vec3 posOrco=vec3(bbDelta.x<1e-5?-sign(posLocal.y):posLocalDelta.x/bbDelta.x,0.0,bbDelta.z<1e-5?sign(posLocal.y):posLocalDelta.z/bbDelta.z
);
posOrco-=0.5;
vec3 tangWorld=(modelMatrix*vec4(posOrco.z,0.0,-posOrco.x,0.0)).xyz;
tangWorld=cross(norWorld,normalize(cross(tangWorld,norWorld)));
tangent=swizzleUpZ(tangWorld);
#endif
trueNormal=normal;
incoming=incomingVec;
parametric=vec3(0.0);
backfacing=(frontFacing>0.0)?0.0:1.0;
#if WORLD_NODES==1
pointiness=0.0;
#else
pointiness=0.5;
#endif
randomPerIsland=0.0;
}`,hhe=`void node_normal(vec3 norParam,vec3 norIn,out vec3 norOut,out float dotOut)
{
norOut=norParam;
dotOut=dot(normalize(norIn),norParam);
}`,phe=`void node_normal_map(vec4 tangent,vec3 normal,float strength,vec4 normalColor,out vec3 normalOut)
{
#ifdef DOUBLE_SIDED
normal=normal*(float(gl_FrontFacing)*2.0-1.0);
#endif
if (all(lessThan(abs(tangent.xyz),vec3(EPSILON)))){
normalOut=normal;
} else {
vec3 normalTex=(normalColor.xyz*2.0-1.0);
vec4 viewTangent=vec4(normalize((modelViewMatrix*vec4(tangent.xyz,0.0)).xyz),tangent.w);
vec3 bitangent=viewTangent.w*cross(normal,viewTangent.xyz);
normalOut=normalize(normalTex.x*viewTangent.xyz+normalTex.y*bitangent
+ normalTex.z*normal);
normalOut=mix(normal,normalOut,strength);
}
normalOut=normalize((invViewMatrix*vec4(normalOut,0.0)).xyz);
normalOut=swizzleUpZ(normalOut);
}`,mhe=`uniform int objectIndex;
uniform vec4 objectColor;
uniform int materialIndex;
uniform float objectRandom;
void node_object_info(out vec3 location,out vec4 color,out float alpha,out float objIndex,out float matIndex,out float random){
#if WORLD_NODES==1
location=vec3(0.0);
color=vec4(1.0);
alpha=1.0;
objIndex=0.0;
matIndex=0.0;
random=0.0;
#else
location=swizzleUpZ(modelMatrix[3].xyz);
color=vec4(objectColor.rgb,1.0);
alpha=objectColor.a;
objIndex=float(objectIndex);
matIndex=float(materialIndex);
random=float(objectRandom);
#endif
}
void node_object_info(out vec3 location,out vec4 color,out float objIndex,out float matIndex,out float random){
float alpha;
node_object_info(location,color,alpha,objIndex,matIndex,random);
}`,ghe=`void node_output_lamp(out vec4 outColor)
{
outColor=vec4(0.0);
}`,_he=`void node_output_material(vec4 surface,vec4 volume,vec3 displacement,float thickness,out vec4 outgoingLight){
outgoingLight=surface+volume;
}
void node_output_material(vec4 surface,vec4 volume,vec3 displacement,out vec4 outgoingLight){
node_output_material(surface,volume,displacement,0.0,outgoingLight);
}`,vhe=`void node_output_world(vec4 surface,vec4 volume,out vec4 outgoingLight)
{
outgoingLight=surface;
}`,Ahe=`void node_particle_info(out float index,out float random,out float age,out float lifeTime,out vec3 location,out float size,out vec3 velocity,out vec3 angularVelocity){
#if WORLD_NODES==1
index=0.0;
random=0.0;
age=0.0;
lifeTime=0.0;
location=vec3(0.0);
size=0.0;
velocity=vec3(0.0);
angularVelocity=vec3(0.0);
#else
index=0.0;
random=0.0;
age=0.0;
lifeTime=0.0;
location=vec3(0.0);
size=0.0;
velocity=vec3(0.0);
angularVelocity=vec3(0.0);
#endif
}`,yhe=`void node_point_info(out vec3 position,out float radius,out float random){
position=vec3(0.0);
radius=0.0;
random=0.0;
}`,bhe=`void node_principled_volume(vec4 color,float colorAttribute,float density,float densityAttribute,float anisotropy,vec4 absorptionColor,float emissionStrength,vec4 emissionColor,float blackbodyIntensity,vec4 blackbodyTint,float temperature,float temperatureAttribute,out vec4 volume){
volume=vec4(0.0);
}`,xhe=`uniform vec4 nodeRGB[NODE_RGB_NUM];
void node_rgb(vec4 color,out vec4 outColor)
{
outColor=color;
}`,Ehe=`void node_rgbtobw(vec4 color,out float outVal){
outVal=linearToRelativeLuminance(color.rgb);
}`,Che=`void node_script(out vec4 outColor)
{
outColor=vec4(0.0);
}`,She=`
void node_sephsv(vec4 col,out float h,out float s,out float v)
{
vec4 hsv;
rgbToHSV(col,hsv);
h=hsv[0];
s=hsv[1];
v=hsv[2];
}`,whe=`#define NODE_SEP_COL_RGB 0
#define NODE_SEP_COL_HSV 1
#define NODE_SEP_COL_HSL 2
void rgbToHSL(vec3 rgb,out vec3 outCol)
{
float cMax,cMin;
float h,s,l;
cMax=max(rgb[0],max(rgb[1],rgb[2]));
cMin=min(rgb[0],min(rgb[1],rgb[2]));
l=min(1.0,(cMax+cMin)/2.0);
if (cMax==cMin){
h=s=0.0;
} else {
float cdelta=cMax-cMin;
s=l>0.5?cdelta/(2.0-cMax-cMin):cdelta/(cMax+cMin);
if (cMax==rgb[0]){
h=(rgb[1]-rgb[2])/cdelta+(rgb[1]<rgb[2]?6.0:0.0);
} else if (cMax==rgb[1]){
h=(rgb[2]-rgb[0])/cdelta+2.0;
} else {
h=(rgb[0]-rgb[1])/cdelta+4.0;
}
}
h/=6.0;
outCol=vec3(h,s,l);
}
void node_separate_color(int mode,vec4 color,out float r,out float g,out float b)
{
if (mode==NODE_SEP_COL_RGB){
r=color.r;
g=color.g;
b=color.b;
} else if (mode==NODE_SEP_COL_HSV){
vec4 hsv;
rgbToHSV(color,hsv);
r=hsv[0];
g=hsv[1];
b=hsv[2];
} else {
vec3 hsl;
rgbToHSL(color.rgb,hsl);
r=hsl[0];
g=hsl[1];
b=hsl[2];
}
}`,Mhe=`
void node_seprgb(vec4 col,out float r,out float g,out float b)
{
r=col.r;
g=col.g;
b=col.b;
}`,The=`void node_sepxyz(vec3 vector,out float x,out float y,out float z)
{
x=vector.x;
y=vector.y;
z=vector.z;
}`,Ihe=`void node_shadertorgb(vec4 shader,out vec4 color,out float alpha){
color=vec4(shader.rgb,1.0);
alpha=shader.a;
}`,Rhe=`void node_squeeze(float val,float width,float center,out float outVal)
{
outVal=1.0/(1.0+pow(2.71828183,-((val-center)*width)));
}`,Lhe=`void node_subsurface_scattering(vec4 color,float scale,vec3 radius,float ior,float anisotropy,float roughness,vec3 normal,out vec4 outColor)
{
outColor=color;
}
void node_subsurface_scattering(vec4 color,float scale,vec3 radius,float ior,float anisotropy,vec3 normal,out vec4 outColor)
{
outColor=color;
}`,Phe=`#define TANGENT_AXIS_X 0
#define TANGENT_AXIS_Y 1
#define TANGENT_AXIS_Z 2
void node_tangent(int axis,vec3 viewPos,vec3 viewNorm,out vec3 outTangent){
outTangent=vec3(0.0);
#if WORLD_NODES==0
vec4 posWorld=invViewMatrix*vec4(-viewPos,1.0);
vec3 norWorld=normalize(invViewMatrix*vec4(viewNorm,0.0)).xyz;
vec3 posLocal=(invModelMatrix*posWorld).xyz;
vec3 posOrco=(posLocal-boundingBoxMin)
/ (boundingBoxMax-boundingBoxMin)-0.5;
vec4 posOrcoPermuted;
if (axis==TANGENT_AXIS_X){
posOrcoPermuted=vec4(0.0,-posOrco.z,posOrco.y,0.0);
} else if (axis==TANGENT_AXIS_Y){
posOrcoPermuted=vec4(-posOrco.y,posOrco.x,0.0,0.0);
} else if (axis==TANGENT_AXIS_Z){
posOrcoPermuted=vec4(posOrco.z,0.0,-posOrco.x,0.0);
}
vec3 tangWorld=(modelMatrix*posOrcoPermuted).xyz;
tangWorld=cross(norWorld,normalize(cross(tangWorld,norWorld)));
outTangent=swizzleUpZ(tangWorld);
#endif
}
void node_tangent(vec4 tangent,out vec3 outTangent){
#if WORLD_NODES==0
outTangent=normalize((modelMatrix*vec4(tangent.xyz,0.0)).xyz);
outTangent=swizzleUpZ(outTangent);
#endif
}`,Dhe=`float integer_noise(int rowCount,int brickCount)
{
#if __VERSION__==300
int n=(rowCount << 16)+(brickCount&0xFFFF);
n=(n+1013)&0x7fffffff;
n=(n >> 13)^ n;
int nn=(n*(n*n*60493+19990303)+1376312589)&0x7fffffff;
return 0.5*(float(nn)/1073741824.0);
#else
const int RAND_MAX=32767;
int next=((123456*rowCount)+brickCount)*1103515245+12345;
return (mod(float(next/65536),float(RAND_MAX+1)))/float(RAND_MAX);
#endif
}
void node_tex_brick(float offset,int offsetFrequency,float squash,int squashFrequency,vec3 vector,vec4 color1,vec4 color2,vec4 mortar,float scale,float mortarSize,float mortarSmooth,float bias,float brickWidth,float rowHeight,out vec4 outColor,out float outFac)
{
float x,y;
vec3 p=vector*scale;
float rowCount=floor(p.y/rowHeight);
if (offsetFrequency != 0&&squashFrequency != 0){
brickWidth*=mod(rowCount,float(squashFrequency))>0.5?1.0:squash;
offset=mod(rowCount,float(offsetFrequency))>0.5?0.0:(brickWidth*offset);
} 
int brickCount=int((p.x+offset)/brickWidth);
float tint=clamp((integer_noise(int(rowCount),brickCount)+bias),0.0,1.0);

x=abs((p.x+offset)-brickWidth*float(brickCount));
y=abs(p.y-rowHeight*rowCount);
float min_dist=min(min(x,y),min(brickWidth-x,rowHeight-y));

float f=step(min_dist,mortarSize);
if (mortarSmooth>0.0){
min_dist=1.0-min_dist/mortarSize;
f*=smoothstep(0.0,mortarSmooth,min_dist);
}
outColor=mix(mix(color1,color2,tint),mortar,f);
outFac=f;
}`,Bhe=`void node_tex_checker(vec3 vector,vec4 color1,vec4 color2,float scale,out vec4 outColor,out float outFac)
{
vec3 p=vector*scale;
p=(p+0.00001)*0.99999;
float cx=floor(p.x);
float cy=floor(p.y);
float cz=floor(p.z);
float result=sign(mod(cx+cy+cz,2.0));
outFac=max(result,0.0);
outColor=mix(color2,color1,outFac);
}`,Nhe=`uniform mat4 nodeTexCoordObjectMatrices[NODE_TEX_COORD_NUM];
void node_tex_coord(mat4 objectMat,vec3 viewPos,vec3 viewNorm,vec2 uv,out vec3 outGenerated,out vec3 outNormal,out vec3 outUV,out vec3 outObject,out vec3 outCamera,out vec3 outWindow,out vec3 outReflection)
{
vec4 view=vec4(-viewPos,1.0);
vec4 posWorld=invViewMatrix*view;
vec3 loc=swizzleUpZ((invModelMatrix*posWorld).xyz);
#if WORLD_NODES==1
loc=normalize(loc);
#endif
#if WORLD_NODES==1
outGenerated=loc;
#else
vec3 boxMin=vec3(boundingBoxMin.x,-boundingBoxMax.z,boundingBoxMin.y);
vec3 boxMax=vec3(boundingBoxMax.x,-boundingBoxMin.z,boundingBoxMax.y);
vec3 boxSize=boxMax-boxMin;
if (abs(boxSize.x)<0.001){
outGenerated.x=0.5;
} else {
outGenerated.x=(loc.x-boxMin.x)/boxSize.x;
}
if (abs(boxSize.y)<0.001){
outGenerated.y=0.5;
} else {
outGenerated.y=(loc.y-boxMin.y)/boxSize.y;
}
if (abs(boxSize.z)<0.001){
outGenerated.z=0.5;
} else {
outGenerated.z=(loc.z-boxMin.z)/boxSize.z;
}
#endif
#if WORLD_NODES==1
outNormal=-loc;
#else
outNormal=normalize(invModelMatrix*invViewMatrix*vec4(viewNorm,0.0)).rgb;
outNormal=swizzleUpZ(outNormal);
#endif
#if WORLD_NODES==1
outUV=vec3(0.0);
#else
uv.y=1.0-uv.y;
outUV=vec3(uv,0.0);
#endif
#if WORLD_NODES==1
outObject=loc;
#else
outObject=swizzleUpZ((objectMat*posWorld).xyz);
#endif
outCamera=vec3(view.xy,-view.z);
#if WORLD_NODES==1
outWindow=vec3(0.0);
#else
outWindow=vec3(gl_FragCoord.xy/viewWidthHeight,0.0);
#endif
#if WORLD_NODES==1
outReflection=-loc;
#else
vec4 reflection=(invViewMatrix*vec4(reflect(view.xyz,normalize(viewNorm)),0.0));
outReflection=normalize(swizzleUpZ(reflection.xyz));
#endif
}`,Ohe=`#define TEX_PROJ_EQUIRECTANGULAR 0
#define TEX_PROJ_MIRROR_BALL 1
void node_tex_environment(sampler2D tex,const int encoding,const int projection,vec3 vector,out vec4 outColor){
vec2 uv;
float bias;
if (projection==TEX_PROJ_EQUIRECTANGULAR){
vec3 direction=swizzleUpY(vector);
if (length(direction)==0.0){
direction=vec3(0.0,1.0,0.0);
} else {
direction=normalize(direction);
}
uv=equirectUv(direction);
#if WORLD_NODES==1
bias=-16.0;
#else
const float seamWidth=0.15;
const float seamBiasFactor=-10.0;
float seam=max(0.0,1.0-abs (direction.z)/seamWidth)*
clamp (1.0-direction.x/seamWidth,0.0,1.0);
bias=seamBiasFactor*seam;
#endif
} else {
vec3 normal=normalize(vector);
normal.y-=1.0;
normal/=(2.0*sqrt(max(-0.5*normal.y,0.0)));
uv=clamp(0.5*normal.xz+0.5,0.0,1.0);
bias=0.0;
}
uv.y=1.0-uv.y;
outColor=texture2D(tex,uv,bias);
outColor=nodeTexelToLinear(outColor,encoding);
}`,khe=`void node_tex_environment_none(vec3 vector,out vec4 outColor){
outColor=vec4(1.0,0.0,1.0,1.0);
}`,Fhe=`#define TEX_GABOR_2D 0
#define TEX_GABOR_3D 1
#define IMPULSES_COUNT 8
#if __VERSION__==300
vec2 compute2DGaborKernel(vec2 position,float frequency,float orientation){
float distanceSq=dot(position,position);
float hannWindow=0.5+0.5*cos(PI*distanceSq);
float gaussianEnvelop=exp(-PI*distanceSq);
float windowedGaussianEnvelope=gaussianEnvelop*hannWindow;
vec2 frequencyVector=frequency*vec2(cos(orientation),sin(orientation));
float angle=2.0*PI*dot(position,frequencyVector);
vec2 phasor=vec2(cos(angle),sin(angle));
return windowedGaussianEnvelope*phasor;
}
float compute2DGaborStandardDeviation(){
float integralOfGaborSq=0.25;
float secondMoment=0.5;
return sqrt(float(IMPULSES_COUNT)*secondMoment*integralOfGaborSq);
}
vec2 compute2DGaborNoiseCell(vec2 cell,vec2 position,float frequency,float isotropy,float baseOrientation){
vec2 noise=vec2(0.0);
for (int i=0;i<IMPULSES_COUNT;++i){
vec3 seedForOrientation=vec3(cell,i*3);
vec3 seedForKernelCenter=vec3(cell,i*3+1);
vec3 seedForWeight=vec3(cell,i*3+2);
float random_orientation=(hashVec3ToFloat(seedForOrientation)-0.5)*PI;
float orientation=baseOrientation+random_orientation*isotropy;
vec2 kernelCenter=hashVec3ToVec2(seedForKernelCenter);
vec2 positionInKernelSpace=position-kernelCenter;
if (dot(positionInKernelSpace,positionInKernelSpace)>=1.0)
continue;
float weight=hashVec3ToFloat(seedForWeight)<0.5?-1.0:1.0;
noise+=weight*compute2DGaborKernel(positionInKernelSpace,frequency,orientation);
}
return noise;
}
vec2 compute2DGaborNoise(vec2 coordinates,float frequency,float isotropy,float baseOrientation){
vec2 cellPosition=floor(coordinates);
vec2 localPosition=coordinates-cellPosition;
vec2 sum=vec2(0.0);
for (int j=-1;j<=1;j++){
for (int i=-1;i<=1;i++){
vec2 cellOffset=vec2(i,j);
vec2 currCellPosition=cellPosition+cellOffset;
vec2 positionInCellSpace=localPosition-cellOffset;
sum+=compute2DGaborNoiseCell(currCellPosition,positionInCellSpace,frequency,isotropy,baseOrientation);
}
}
return sum;
}
vec2 compute3DGaborKernel(vec3 position,float frequency,vec3 orientation){
float distanceSq=dot(position,position);
float hannWindow=0.5+0.5*cos(PI*distanceSq);
float gaussianEnvelop=exp(-PI*distanceSq);
float windowedGaussianEnvelope=gaussianEnvelop*hannWindow;
vec3 frequencyVector=frequency*orientation;
float angle=2.0*PI*dot(position,frequencyVector);
vec2 phasor=vec2(cos(angle),sin(angle));
return windowedGaussianEnvelope*phasor;
}
float compute3DGaborStandardDeviation(){
float integralOfGaborSq=1.0/(4.0*sqrt(2.0));
float secondMoment=0.5;
return sqrt(float(IMPULSES_COUNT)*secondMoment*integralOfGaborSq);
}
vec3 compute3DOrientation(vec3 orientation,float isotropy,vec4 seed){
if (isotropy==0.0)
return orientation;
float inclination=acos(orientation.z);
float azimuth=sign(orientation.y)*acos(orientation.x/length(orientation.xy));
vec2 randomAngles=hashVec4ToVec2(seed)*PI;
inclination+=randomAngles.x*isotropy;
azimuth+=randomAngles.y*isotropy;
return vec3(sin(inclination)*cos(azimuth),sin(inclination)*sin(azimuth),cos(inclination));
}
vec2 compute3DGaborNoiseCell(vec3 cell,vec3 position,float frequency,float isotropy,vec3 baseOrientation){
vec2 noise=vec2(0.0);
for (int i=0;i<IMPULSES_COUNT;++i){
vec4 seedForOrientation=vec4(cell,i*3);
vec4 seedForKernelCenter=vec4(cell,i*3+1);
vec4 seedForWeight=vec4(cell,i*3+2);
vec3 orientation=compute3DOrientation(baseOrientation,isotropy,seedForOrientation);
vec3 kernelCenter=hashVec4ToVec3(seedForKernelCenter);
vec3 positionInKernelSpace=position-kernelCenter;
if (dot(positionInKernelSpace,positionInKernelSpace)>=1.0)
continue;
float weight=hashVec4ToFloat(seedForWeight)<0.5?-1.0:1.0;
noise+=weight*compute3DGaborKernel(positionInKernelSpace,frequency,orientation);
}
return noise;
}
vec2 compute3DGaborNoise(vec3 coordinates,float frequency,float isotropy,vec3 baseOrientation){
vec3 cellPosition=floor(coordinates);
vec3 localPosition=coordinates-cellPosition;
vec2 sum=vec2(0.0);
for (int k=-1;k<=1;k++){
for (int j=-1;j<=1;j++){
for (int i=-1;i<=1;i++){
vec3 cellOffset=vec3(i,j,k);
vec3 currCellPosition=cellPosition+cellOffset;
vec3 positionInCellSpace=localPosition-cellOffset;
sum+=compute3DGaborNoiseCell(currCellPosition,positionInCellSpace,frequency,isotropy,baseOrientation);
}
}
}
return sum;
}
void node_tex_gabor(int gaborType,vec3 vector,float scale,float frequency,float anisotropy,float orientation2D,vec3 orientation3D,out float outValue,out float outPhase,out float outIntensity){
vec3 scaledVector=vector*scale;
float isotropy=1.0-clamp(anisotropy,0.0,1.0);
frequency=max(0.001,frequency);
vec2 phasor=vec2(0.0);
float standard_deviation=1.0;
if (gaborType==TEX_GABOR_2D){
phasor=compute2DGaborNoise(scaledVector.xy,frequency,isotropy,orientation2D);
standard_deviation=compute2DGaborStandardDeviation();
} else {
vec3 orientation=normalize(orientation3D);
phasor=compute3DGaborNoise(scaledVector,frequency,isotropy,orientation);
standard_deviation=compute3DGaborStandardDeviation();
}
float normalizationFactor=6.0*standard_deviation;
outValue=(phasor.y/normalizationFactor)*0.5+0.5;
outPhase=(atan(phasor.y,phasor.x)+PI)/(2.0*PI);
outIntensity=length(phasor)/normalizationFactor;
}
#else
void node_tex_gabor(int gaborType,vec3 vector,float scale,float frequency,float anisotropy,float orientation2D,vec3 orientation3D,out float outValue,out float outPhase,out float outIntensity){
outValue=0.0;
outPhase=0.0;
outIntensity=0.0;
}
#endif`,Vhe=`#define TEX_GRAD_LINEAR 0
#define TEX_GRAD_QUADRATIC 1
#define TEX_GRAD_EASING 2
#define TEX_GRAD_DIAGONAL 3
#define TEX_GRAD_SPHERICAL 4
#define TEX_GRAD_QUADRATIC_SPHERE 5
#define TEX_GRAD_RADIAL 6
void node_tex_gradient(const int type,vec3 vector,out vec4 outColor,out float outFac)
{
float x,y,z,r;
x=vector.x;
y=vector.y;
z=vector.z;
if (type==TEX_GRAD_LINEAR){
outFac=x;
} else if (type==TEX_GRAD_QUADRATIC){
r=max(x,0.0);
outFac=pow2(r);
} else if (type==TEX_GRAD_EASING){
r=min(max(x,0.0),1.0);
outFac=(3.0*pow2(r)-2.0*pow3(r));
} else if (type==TEX_GRAD_DIAGONAL){
outFac=(x+y)*0.5;
} else if (type==TEX_GRAD_RADIAL){
outFac=atan(y,x)/PI2+0.5;
} else {
r=max(0.99999-sqrt(x*x+y*y+z*z),0.0);
if (type==TEX_GRAD_QUADRATIC_SPHERE){
outFac=pow2(r);
} else if (type==TEX_GRAD_SPHERICAL){
outFac=r;
}
}
outFac=clamp(outFac,0.0,1.0);
outColor=vec4(outFac,outFac,outFac,1.0);
}`,Uhe=`void node_tex_ies(vec3 vector,float strength,out float fac){
fac=0.0;
}`,zhe=`#define TEX_PROJ_FLAT 0
#define TEX_PROJ_BOX 1
#define TEX_PROJ_SPHERE 2
#define TEX_PROJ_TUBE 3
#define TEX_ALPHA_CLEAR 0
#define TEX_ALPHA_PREMUL 1
#define TEX_ALPHA_UNPREMUL 2
#define TEX_ALPHA_ONE 3
vec4 applyAlphaMode(vec4 color,const int alphaMode){
if (alphaMode==TEX_ALPHA_CLEAR){
} else if (alphaMode==TEX_ALPHA_PREMUL){
color.rgb=color.rgb*color.a;
} else if (alphaMode==TEX_ALPHA_UNPREMUL){
float alpha=color.a;
color.rgb=clamp(color.rgb,0.0,alpha);
if (alpha==0.0)
color.rgb=vec3(0.0);
else
color.rgb/=alpha;
}
return color;
}
void node_tex_image(sampler2D ima,const int encoding,const int alphaMode,vec3 viewNorm,const int projection,const float projectionBlend,const bool clampToEdgeNoExtend,vec3 vector,out vec4 outColor,out float outAlpha){
if (projection==TEX_PROJ_FLAT){
vec2 uv=vector.xy;
uv.y=1.0-uv.y;
if (clampToEdgeNoExtend&&(uv.x<0.0||uv.x>1.0||uv.y<0.0||uv.y>1.0)){
outColor=vec4(0.0);
outAlpha=0.0;
} else {
outColor=texture2D(ima,uv);
outAlpha=outColor.a;
}
outColor=nodeTexelToLinear(outColor,encoding);
} else if (projection==TEX_PROJ_BOX){
vec3 norm=normalize(viewNorm*normalMatrix);
vector=swizzleUpY(vector);
vec2 uvX=vec2(-sign(norm.x)*vector.z,-vector.y);
vec2 uvY=vec2(sign(norm.y)*vector.z,-vector.x);
vec2 uvZ=vec2(sign(norm.z)*vector.x,-vector.y);
vec4 colX=nodeTexelToLinear(texture2D(ima,uvX),encoding);
vec4 colY=nodeTexelToLinear(texture2D(ima,uvY),encoding);
vec4 colZ=nodeTexelToLinear(texture2D(ima,uvZ),encoding);
vec3 barycentric=abs(norm);
barycentric/=barycentric.x+barycentric.y+barycentric.z;
vec3 edgeShape=min(min(barycentric.yzx,barycentric.zxy),(projectionBlend-1.0)/(projectionBlend-3.0));
vec3 edgeValue=(1.0-projectionBlend)*(1.0-edgeShape)/2.0;
vec3 weight=max((barycentric-edgeValue)/(1.0-edgeValue),EPSILON);
weight/=(weight.x+weight.y+weight.z);
outColor=weight.x*colX+weight.y*colY+weight.z*colZ;
outAlpha=outColor.a;
} else if (projection==TEX_PROJ_SPHERE){
vector=normalize(vector*2.0-1.0);
vector=swizzleUpY(vector);
vec2 uv=vec2(atan(vector.x,vector.z)/PI2,acos(vector.y)/PI);
uv.x=mod(uv.x,1.0);
outColor=texture2D(ima,uv);
outAlpha=outColor.a;
outColor=nodeTexelToLinear(outColor,encoding);
} else if (projection==TEX_PROJ_TUBE){
vector=vector*2.0-1.0;
vector=swizzleUpY(vector);
vec2 uv=vec2(atan(vector.x,vector.z)/PI2,(1.0-vector.y)/2.0);
uv.x=mod(uv.x,1.0);
outColor=texture2D(ima,uv);
outAlpha=outColor.a;
outColor=nodeTexelToLinear(outColor,encoding);
}
outColor=applyAlphaMode(outColor,alphaMode);
if (alphaMode==TEX_ALPHA_ONE)
outAlpha=1.0;
}`,Ghe=`void node_tex_image_none(vec3 vector,out vec4 color,out float alpha)
{
color=vec4(1.0,0.0,1.0,1.0);
alpha=1.0;
}`,Hhe=`void node_tex_magic(vec3 vector,float scale,float distortion,out vec4 outColor,out float outFac)
{
outColor=vec4(0.0);
outFac=0.0;
}`,Whe=`
void node_tex_musgrave(vec3 vector,float w,float scale,float detail,float dimension,float lacunarity,float offset,float gain,out float outFac){
outFac=0.0;
}`,jhe=`#define TEX_NOISE_MULTIFRACTAL 0
#define TEX_NOISE_RIDGED_MULTIFRACTAL 1
#define TEX_NOISE_HYBRID_MULTIFRACTAL 2
#define TEX_NOISE_FBM 3
#define TEX_NOISE_HETERO_TERRAIN 4
void node_tex_noise(int noiseType,float falloffFactor,float dispersionFactor,vec3 vector,float w,float scale,float detail,float roughness,float lacunarity,float offset,float gain,float distortion,out float outFac,out vec4 outColor){
vec3 p=vector*scale;
vec3 dx=dFdx(p);
vec3 dy=dFdy(p);
float octaveLenPerPixel=(length(dx)+length(dy))/4.0;
if (distortion != 0.0){
vec3 r,offset=vec3(13.5,13.5,13.5);
r.x=noiseSmooth(p+offset,octaveLenPerPixel,falloffFactor,dispersionFactor)*distortion;
r.y=noiseSmooth(p,octaveLenPerPixel,falloffFactor,dispersionFactor)*distortion;
r.z=noiseSmooth(p-offset,octaveLenPerPixel,falloffFactor,dispersionFactor)*distortion;
p+=r;
}
outFac=noiseTurbulence(p,detail,octaveLenPerPixel,falloffFactor,dispersionFactor);
vec3 color=vec3(outFac,noiseTurbulence(vec3(p.y,p.x,p.z),detail,octaveLenPerPixel,falloffFactor,dispersionFactor),noiseTurbulence(vec3(p.y,p.z,p.x),detail,octaveLenPerPixel,falloffFactor,dispersionFactor)
);
outColor=vec4(color,1.0);
}
void node_tex_noise(float falloffFactor,float dispersionFactor,vec3 vector,float w,float scale,float detail,float roughness,float lacunarity,float distortion,out float outFac,out vec4 outColor){
node_tex_noise(TEX_NOISE_FBM,falloffFactor,dispersionFactor,vector,w,scale,detail,roughness,lacunarity,0.0,1.0,distortion,outFac,outColor);
}
void node_tex_noise(float falloffFactor,float dispersionFactor,vec3 vector,float w,float scale,float detail,float roughness,float distortion,out float outFac,out vec4 outColor){
node_tex_noise(falloffFactor,dispersionFactor,vector,w,scale,detail,roughness,2.0,distortion,outFac,outColor);
}`,Qhe=`void node_tex_pointdensity(vec3 vector,out vec4 outColor,out float outDensity)
{
outColor=vec4(0.0);
outDensity=0.0;
}`,$he=`
#define TEX_SKY_PREETHAM 0
#define TEX_SKY_HOSEK_WILKIE 1
#define TEX_SKY_NISHITA 2
#define Km 683.0
void node_tex_sky(const int skyType,vec3 param0,vec3 param1,vec3 param2,vec3 param3,vec3 param4,vec3 param5,vec3 param6,vec3 param7,vec3 param8,vec3 radiance,vec3 sunDirection,vec3 vectorIn,out vec4 outColor){
if (length(vectorIn)==0.0){
vectorIn=vec3(0.0,1.0,0.0);
} else {
vectorIn=normalize(vectorIn);
}
vectorIn=swizzleUpY(vectorIn);
sunDirection=swizzleUpY(sunDirection);
float cosGamma=clamp(dot(vectorIn,sunDirection),-1.0,1.0);
float cosTheta=clamp(vectorIn.y,0.0,1.0);
if (skyType==TEX_SKY_PREETHAM){
vec3 radInternal=(1.0+param0*exp(param1/cosTheta))*(1.0+param2*exp(param3*acos(cosGamma))
+ param4*pow(cosGamma,2.0)
);
vec3 XYZ=xyY_to_XYZ(radInternal.y*radiance.y,radInternal.z*radiance.z,radInternal.x*radiance.x);
outColor=vec4(max(xyz_to_sRGB(XYZ),0.0),1.0);
} else if (skyType==TEX_SKY_HOSEK_WILKIE){
float cosGammaSq=pow(cosGamma,2.0);
vec3 chi=(1.0+cosGammaSq)/pow(1.0+pow(param8,vec3(2.0))
- 2.0*param8*cosGamma,vec3(1.5));
vec3 radInternal=(1.0+param0*exp(param1/(cosTheta+0.01)))*(param2+param3*exp(param4*acos(cosGamma))
+ param5*cosGammaSq+param6*chi+param7*sqrt(cosTheta)
);
outColor=vec4(max(xyz_to_sRGB(radInternal*radiance),0.0)*PI2/Km,1.0);
} else {
outColor=vec4(0.0,0.0,0.0,1.0);
}
}`,Yhe=`#define DISTANCE_EUCLIDEAN 0
#define DISTANCE_MANHATTAN 1
#define DISTANCE_CHEBYCHEV 2
#define DISTANCE_MINKOWSKI 3
#define FEATURE_F1 0
#define FEATURE_F2 1
#define FEATURE_SMOOTH_F1 2
#define FEATURE_DISTANCE_TO_EDGE 3
#define FEATURE_N_SPHERE_RADIUS 4
struct VoronoiGridData {
vec3 point;
vec3 randVec;
vec3 toClosest;
float dist;
};
highp vec3 rand3(const in vec3 v){
const highp float c=43758.5453;
const highp mat3 coeffs=mat3(165.15,253.34,323.22,241.49,329.07,147.79,376.31,143.45,281.63
);
highp vec3 sn=mod(coeffs*v,PI);
return fract(sin(sn)*c);
}
float worleyLength(vec3 vec,int distance,float exponent){
if (distance==DISTANCE_EUCLIDEAN){
return length(vec);
} else if (distance==DISTANCE_MANHATTAN){
return abs(vec.x)+abs(vec.y)+abs(vec.z);
} else if (distance==DISTANCE_CHEBYCHEV){
return max(max(abs(vec.x),abs(vec.y)),abs(vec.z));
} else if (distance==DISTANCE_MINKOWSKI){
return pow(pow(abs(vec.x),exponent)
+ pow(abs(vec.y),exponent)
+ pow(abs(vec.z),exponent),1.0/exponent);
}
return 0.0;
}
void worleyNoise(vec3 pos,int distance,float exponent,int feature,float smoothness,float randomness,out float outDist,out vec4 outColor,out vec3 outPosition,out float outW,out float outRadius){
const highp float RAND_FIX_ZERO=0.125;
vec3 posI=floor(pos);
vec3 posF=fract(pos);
VoronoiGridData vgd[27];
#pragma unroll_loop
for (int i=0;i<=2;i++){
#pragma unroll_loop
for (int j=0;j<=2;j++){
#pragma unroll_loop
for (int k=0;k<=2;k++){
vec3 point=vec3((i),(j),(k))-1.0;
vec3 randVec=rand3(posI+point+RAND_FIX_ZERO);
vec3 toClosest=point+randomness*randVec-posF;
const int counter=(i)+(j)*3+(k)*9;
vgd[counter].point=point;
vgd[counter].randVec=randVec;
vgd[counter].toClosest=toClosest;
vgd[counter].dist=worleyLength(toClosest,distance,exponent);
}
}
}
float f1=1e10;
float f2=1e10;
vec3 edgeToClosest=vec3(0.0);
float distToEdge=1e10;
vec3 randColF1=vec3(0.0);
vec3 randColF2=vec3(0.0);
vec3 toClosestF1=vec3(0.0);
vec3 toClosestF2=vec3(0.0);
vec3 radPoint=vec3(0.0);
vec3 radToClosest=vec3(0.0);
#pragma unroll_loop
for (int i=0;i<27;i++){
if (feature==FEATURE_F1){
if (vgd[i].dist<f1){
f1=vgd[i].dist;
randColF1=vgd[i].randVec;
toClosestF1=vgd[i].toClosest;
}
} else if (feature==FEATURE_F2){
if (vgd[i].dist<f1){
f2=f1;
f1=vgd[i].dist;
randColF2=randColF1;
randColF1=vgd[i].randVec;
toClosestF2=toClosestF1;
toClosestF1=vgd[i].toClosest;
} else if (vgd[i].dist<f2){
f2=vgd[i].dist;
randColF2=vgd[i].randVec;
toClosestF2=vgd[i].toClosest;
}
} else if (feature==FEATURE_SMOOTH_F1){
f1=smoothMin(f1,vgd[i].dist,smoothness);
} else if (feature==FEATURE_DISTANCE_TO_EDGE){
float dist=worleyLength(vgd[i].toClosest,DISTANCE_EUCLIDEAN,exponent);
if (dist<f1){
f1=dist;
edgeToClosest=vgd[i].toClosest;
}
} else if (feature==FEATURE_N_SPHERE_RADIUS){
float dist=worleyLength(vgd[i].toClosest,DISTANCE_EUCLIDEAN,exponent);
if (dist<f1){
f1=dist;
radPoint=vgd[i].point;
radToClosest=vgd[i].toClosest;
}
}
}
if (feature==FEATURE_F1){
outDist=f1;
outColor=vec4(randColF1,1.0);
outPosition=pos+toClosestF1;
} else if (feature==FEATURE_F2){
outDist=f2;
outColor=vec4(randColF2,1.0);
outPosition=pos+toClosestF2;
} else if (feature==FEATURE_SMOOTH_F1){
outDist=f1;
vec3 avgCol=vec3(0.0);
vec3 avgOff=vec3(0.0);
float sumWeightsCol=0.0;
float sumWeightsOff=0.0;
#pragma unroll_loop
for (int i=0;i<27;i++){
float smoothFac=getSmoothFactor(f1,vgd[i].dist,smoothness);
float weightOff=smoothFac*smoothFac*smoothFac;
float weightCol=weightOff*smoothFac;
avgCol+=vgd[i].randVec*weightCol;
avgOff+=vgd[i].toClosest*weightOff;
sumWeightsCol+=weightCol;
sumWeightsOff+=weightOff;
}
outColor=vec4(avgCol/sumWeightsCol,1.0);
outPosition=pos+avgOff/sumWeightsOff;
} else if (feature==FEATURE_DISTANCE_TO_EDGE){
#pragma unroll_loop
for (int i=0;i<27;i++){
if (vgd[i].toClosest != edgeToClosest){
float dist=dot(0.5*(edgeToClosest+vgd[i].toClosest),normalize(vgd[i].toClosest-edgeToClosest));
distToEdge=min(distToEdge,dist);
}
}
outDist=distToEdge;
} else if (feature==FEATURE_N_SPHERE_RADIUS){
float diam=1e10;
#pragma unroll_loop
for (int i=0;i<=2;i++){
#pragma unroll_loop
for (int j=0;j<=2;j++){
#pragma unroll_loop
for (int k=0;k<=2;k++){
vec3 localPoint=vec3((i),(j),(k))-1.0;
if (length(localPoint)>0.0){
vec3 point=localPoint+radPoint;
vec3 randVec=rand3(posI+point+RAND_FIX_ZERO);
vec3 toClosest=point+randomness*randVec-posF;
diam=min(diam,length(toClosest-radToClosest));
}
}
}
}
outRadius=diam/2.0;
}
}
#define VORONOI_SMOOTH_COEFF 0.74
void node_tex_voronoi(int distance,int feature,vec3 vector,float w,float scale,float detail,float roughness,float lacunarity,float smoothness,float exponent,float randomness,out float outDistance,out vec4 outColor,out vec3 outPosition,out float outW,out float outRadius){
vector=scale*(vector-0.0001);
smoothness=clamp(smoothness,1e-3,1.0);
smoothness*=VORONOI_SMOOTH_COEFF;
worleyNoise(vector,distance,exponent,feature,smoothness,randomness,outDistance,outColor,outPosition,outW,outRadius);
outPosition/=scale;
}
void node_tex_voronoi(int distance,int feature,vec3 vector,float w,float scale,float smoothness,float exponent,float randomness,out float outDistance,out vec4 outColor,out vec3 outPosition,out float outW,out float outRadius){
node_tex_voronoi(distance,feature,vector,w,scale,0.0,0.5,2.0,smoothness,exponent,randomness,outDistance,outColor,outPosition,outW,outRadius);
}
#define FEATURE_F3 5
#define FEATURE_F4 6
#define FEATURE_F2F1 7
#define COLORING_INTENSITY 0
#define COLORING_CELLS 1
struct VoronoiClosest {
vec4 closestDists;
vec4 closestInds;
};
void updateVoronoiClosest(inout VoronoiClosest vf,vec3 newDistances,vec3 newIndices){
#pragma unroll_loop
for (int i=0;i<3;i++){
float currDist=newDistances[i];
float currIdx=newIndices[i];
#pragma unroll_loop
for (int j=0;j<4;j++){
if (currDist<vf.closestDists[j]){
float tmp=vf.closestDists[j];
vf.closestDists[j]=currDist;
currDist=tmp;
tmp=vf.closestInds[j];
vf.closestInds[j]=currIdx;
currIdx=tmp;
}
}
}
}
vec3 worleyPermute(vec3 x){
return mod((34.0*x+1.0)*x,289.0);
}
vec3 worleyDist(vec3 x,vec3 y,vec3 z,int distance,float exponent){
if (distance==DISTANCE_EUCLIDEAN){
return x*x+y*y+z*z;
} else if (distance==DISTANCE_MANHATTAN){
return abs(x)+abs(y)+abs(z);
} else if (distance==DISTANCE_CHEBYCHEV){
return max(max(abs(x),abs(y)),abs(z));
} else if (distance==DISTANCE_MINKOWSKI){
vec3 expVec=vec3(exponent);
return pow(pow(abs(x),expVec)
+ pow(abs(y),expVec)
+ pow(abs(z),expVec),1.0/expVec);
}
return vec3(0.0);
}
VoronoiClosest worleyClosest(vec3 P,float jitter,int distance,float exponent){
float K=0.142857142857;
float Ko=0.428571428571;
float K2=0.020408163265306;
float Kz=0.166666666667;
float Kzo=0.416666666667;
vec3 Pi=mod(floor(P),289.0);
vec3 Pf=fract(P)-0.5;
vec3 Pfx=Pf.x+vec3(1.0,0.0,-1.0);
vec3 Pfy=Pf.y+vec3(1.0,0.0,-1.0);
vec3 Pfz=Pf.z+vec3(1.0,0.0,-1.0);
vec3 p=worleyPermute(Pi.x+vec3(-1.0,0.0,1.0));
vec3 p1=worleyPermute(p+Pi.y-1.0);
vec3 p2=worleyPermute(p+Pi.y);
vec3 p3=worleyPermute(p+Pi.y+1.0);
vec3 p11=worleyPermute(p1+Pi.z-1.0);
vec3 p12=worleyPermute(p1+Pi.z);
vec3 p13=worleyPermute(p1+Pi.z+1.0);
vec3 p21=worleyPermute(p2+Pi.z-1.0);
vec3 p22=worleyPermute(p2+Pi.z);
vec3 p23=worleyPermute(p2+Pi.z+1.0);
vec3 p31=worleyPermute(p3+Pi.z-1.0);
vec3 p32=worleyPermute(p3+Pi.z);
vec3 p33=worleyPermute(p3+Pi.z+1.0);
vec3 ox11=fract(p11*K)-Ko;
vec3 oy11=mod(floor(p11*K),7.0)*K-Ko;
vec3 oz11=floor(p11*K2)*Kz-Kzo;
vec3 ox12=fract(p12*K)-Ko;
vec3 oy12=mod(floor(p12*K),7.0)*K-Ko;
vec3 oz12=floor(p12*K2)*Kz-Kzo;
vec3 ox13=fract(p13*K)-Ko;
vec3 oy13=mod(floor(p13*K),7.0)*K-Ko;
vec3 oz13=floor(p13*K2)*Kz-Kzo;
vec3 ox21=fract(p21*K)-Ko;
vec3 oy21=mod(floor(p21*K),7.0)*K-Ko;
vec3 oz21=floor(p21*K2)*Kz-Kzo;
vec3 ox22=fract(p22*K)-Ko;
vec3 oy22=mod(floor(p22*K),7.0)*K-Ko;
vec3 oz22=floor(p22*K2)*Kz-Kzo;
vec3 ox23=fract(p23*K)-Ko;
vec3 oy23=mod(floor(p23*K),7.0)*K-Ko;
vec3 oz23=floor(p23*K2)*Kz-Kzo;
vec3 ox31=fract(p31*K)-Ko;
vec3 oy31=mod(floor(p31*K),7.0)*K-Ko;
vec3 oz31=floor(p31*K2)*Kz-Kzo;
vec3 ox32=fract(p32*K)-Ko;
vec3 oy32=mod(floor(p32*K),7.0)*K-Ko;
vec3 oz32=floor(p32*K2)*Kz-Kzo;
vec3 ox33=fract(p33*K)-Ko;
vec3 oy33=mod(floor(p33*K),7.0)*K-Ko;
vec3 oz33=floor(p33*K2)*Kz-Kzo;
vec3 dx11=Pfx+jitter*ox11;
vec3 dy11=Pfy.x+jitter*oy11;
vec3 dz11=Pfz.x+jitter*oz11;
vec3 dx12=Pfx+jitter*ox12;
vec3 dy12=Pfy.x+jitter*oy12;
vec3 dz12=Pfz.y+jitter*oz12;
vec3 dx13=Pfx+jitter*ox13;
vec3 dy13=Pfy.x+jitter*oy13;
vec3 dz13=Pfz.z+jitter*oz13;
vec3 dx21=Pfx+jitter*ox21;
vec3 dy21=Pfy.y+jitter*oy21;
vec3 dz21=Pfz.x+jitter*oz21;
vec3 dx22=Pfx+jitter*ox22;
vec3 dy22=Pfy.y+jitter*oy22;
vec3 dz22=Pfz.y+jitter*oz22;
vec3 dx23=Pfx+jitter*ox23;
vec3 dy23=Pfy.y+jitter*oy23;
vec3 dz23=Pfz.z+jitter*oz23;
vec3 dx31=Pfx+jitter*ox31;
vec3 dy31=Pfy.z+jitter*oy31;
vec3 dz31=Pfz.x+jitter*oz31;
vec3 dx32=Pfx+jitter*ox32;
vec3 dy32=Pfy.z+jitter*oy32;
vec3 dz32=Pfz.y+jitter*oz32;
vec3 dx33=Pfx+jitter*ox33;
vec3 dy33=Pfy.z+jitter*oy33;
vec3 dz33=Pfz.z+jitter*oz33;
vec3 d11=worleyDist(dx11,dy11,dz11,distance,exponent);
vec3 d12=worleyDist(dx12,dy12,dz12,distance,exponent);
vec3 d13=worleyDist(dx13,dy13,dz13,distance,exponent);
vec3 d21=worleyDist(dx21,dy21,dz21,distance,exponent);
vec3 d22=worleyDist(dx22,dy22,dz22,distance,exponent);
vec3 d23=worleyDist(dx23,dy23,dz23,distance,exponent);
vec3 d31=worleyDist(dx31,dy31,dz31,distance,exponent);
vec3 d32=worleyDist(dx32,dy32,dz32,distance,exponent);
vec3 d33=worleyDist(dx33,dy33,dz33,distance,exponent);
VoronoiClosest vf=VoronoiClosest(vec4(1e10),vec4(0.0));
updateVoronoiClosest(vf,d11,p11);
updateVoronoiClosest(vf,d12,p12);
updateVoronoiClosest(vf,d13,p13);
updateVoronoiClosest(vf,d21,p21);
updateVoronoiClosest(vf,d22,p22);
updateVoronoiClosest(vf,d23,p23);
updateVoronoiClosest(vf,d31,p31);
updateVoronoiClosest(vf,d32,p32);
updateVoronoiClosest(vf,d33,p33);
return vf;
}
void node_tex_voronoi(int coloring,int distance,int feature,vec3 vector,float scale,float exponent,out vec4 outColor,out float outFac){
vector=scale*(vector-0.0001);
VoronoiClosest vf=worleyClosest(vector,1.0,distance,exponent);
vec4 vorColorData;
if (coloring==COLORING_INTENSITY){
vorColorData=vf.closestDists;
} else if (coloring==COLORING_CELLS){
vorColorData=vf.closestInds;
}
float vorColorFac;
if (feature==FEATURE_F1){
vorColorFac=vorColorData.x;
} else if (feature==FEATURE_F2){
vorColorFac=vorColorData.y;
} else if (feature==FEATURE_F3){
vorColorFac=vorColorData.z;
} else if (feature==FEATURE_F4){
vorColorFac=vorColorData.w;
} else if (feature==FEATURE_F2F1){
vorColorFac=vorColorData.y-vorColorData.x;
}
if (coloring==COLORING_INTENSITY){
outFac=vorColorFac;
outColor=vec4(vec3(outFac),1.0);
} else if (coloring==COLORING_CELLS){
vorColorFac+=1e-3;
float r=rand(vec2(vorColorFac/289.0));
float g=rand(vec2(vorColorFac/23535.0));
float b=rand(vec2(vorColorFac/4353.0));
outFac=(r+g+b)/3.0;
outColor=vec4(r,g,b,1.0);
}
}`,Xhe=`#define TEX_WAVE_TYPE_BANDS 0
#define TEX_WAVE_TYPE_RINGS 1
#define TEX_WAVE_PROFILE_SIN 0
#define TEX_WAVE_PROFILE_SAW 1
#define TEX_WAVE_PROFILE_TRI 2
#define TEX_WAVE_BANDS_DIR_X 0
#define TEX_WAVE_BANDS_DIR_Y 1
#define TEX_WAVE_BANDS_DIR_Z 2
#define TEX_WAVE_BANDS_DIR_DIAGONAL 3
#define TEX_WAVE_RINGS_DIR_X 0
#define TEX_WAVE_RINGS_DIR_Y 1
#define TEX_WAVE_RINGS_DIR_Z 2
#define TEX_WAVE_RINGS_DIR_SPHERICAL 3
void node_tex_wave(int waveType,int waveProfile,int bandsDirection,int ringsDirection,vec3 vector,float scale,float distortion,float detail,float detailScale,float detailRoughness,float phaseOffset,out vec4 outColor,out float outFac){
vec3 coScaled=vector*scale;
float waveFac;
vec3 waveVec=coScaled;
if (waveType==TEX_WAVE_TYPE_BANDS){
const float BANDS_AXIS_SCALE=2.0/3.0;
if (bandsDirection==TEX_WAVE_BANDS_DIR_X){
waveVec=waveVec.xxx*BANDS_AXIS_SCALE;
} else if (bandsDirection==TEX_WAVE_BANDS_DIR_Y){
waveVec=waveVec.yyy*BANDS_AXIS_SCALE;
} else if (bandsDirection==TEX_WAVE_BANDS_DIR_Z){
waveVec=waveVec.zzz*BANDS_AXIS_SCALE;
} else if (bandsDirection==TEX_WAVE_BANDS_DIR_DIAGONAL){
}
waveFac=(waveVec.x+waveVec.y+waveVec.z)*10.0;
} else {
if (ringsDirection==TEX_WAVE_RINGS_DIR_X){
waveVec.x=0.0;
} else if (ringsDirection==TEX_WAVE_RINGS_DIR_Y){
waveVec.y=0.0;
} else if (ringsDirection==TEX_WAVE_RINGS_DIR_Z){
waveVec.z=0.0;
} else if (ringsDirection==TEX_WAVE_RINGS_DIR_SPHERICAL){
}
waveFac=length(waveVec)*20.0;
}
if (distortion != 0.0){
waveFac+=distortion*noiseTurbulence(coScaled*detailScale,detail,0.0,0.0,1.0);
}
if (waveProfile==TEX_WAVE_PROFILE_SIN){
waveFac=0.5+0.5*sin(waveFac-PI_HALF+phaseOffset);
} else if (waveProfile==TEX_WAVE_PROFILE_SAW){
waveFac=fract((waveFac+phaseOffset+1e-4)/PI2);
} else if (waveProfile==TEX_WAVE_PROFILE_TRI){
waveFac=abs(2.0*fract((waveFac+PI+phaseOffset)/PI2)-1.0);
}
outColor=vec4(waveFac,waveFac,waveFac,1.0);
outFac=waveFac;
}`,qhe=`#if __VERSION__==300
void node_tex_white_noise_1d(vec3 vector,float w,out float outValue,out vec4 outColor)
{
outValue=hashFloatToFloat(w);
outColor=vec4(hashFloatToVec3(w),1.0);
}
void node_tex_white_noise_2d(vec3 vector,float w,out float outValue,out vec4 outColor)
{
outValue=hashVec2ToFloat(vector.xy);
outColor=vec4(hashVec2ToVec3(vector.xy),1.0);
}
void node_tex_white_noise_3d(vec3 vector,float w,out float outValue,out vec4 outColor)
{
outValue=hashVec3ToFloat(vector);
outColor=vec4(hashVec3ToVec3(vector),1.0);
}
void node_tex_white_noise_4d(vec3 vector,float w,out float outValue,out vec4 outColor)
{
outValue=hashVec4ToFloat(vec4(vector,w));
outColor=vec4(hashVec4ToVec3(vec4(vector,w)),1.0);
}
#else
void node_tex_white_noise_1d(vec3 vector,float w,out float outValue,out vec4 outColor)
{
outValue=0.0;
outColor=vec4(0.0);
}
void node_tex_white_noise_2d(vec3 vector,float w,out float outValue,out vec4 outColor)
{
outValue=0.0;
outColor=vec4(0.0);
}
void node_tex_white_noise_3d(vec3 vector,float w,out float outValue,out vec4 outColor)
{
outValue=0.0;
outColor=vec4(0.0);
}
void node_tex_white_noise_4d(vec3 vector,float w,out float outValue,out vec4 outColor)
{
outValue=0.0;
outColor=vec4(0.0);
}
#endif`,Khe=`void node_uvmap(vec2 uv,out vec3 outUV){
#if WORLD_NODES==1
outUV=vec3(0.0);
#else
uv.y=1.0-uv.y;
outUV=vec3(uv,0.0);
#endif
}`,Zhe=`void node_valtorgb(sampler2D colormap,float fac,out vec4 colOut,out float alphaOut)
{
colOut=texture2D(colormap,vec2(fac,0.0));
alphaOut=colOut.a;
}`,Jhe=`uniform float nodeValue[NODE_VALUE_NUM];
void node_value(float value,out float outValue)
{
outValue=value;
}`,epe=`void node_vect_math_add(vec3 v1,vec3 v2,vec3 v3,float val,out vec3 outVec,out float outVal){
outVec=v1+v2;
}
void node_vect_math_subtract(vec3 v1,vec3 v2,vec3 v3,float val,out vec3 outVec,out float outVal){
outVec=v1-v2;
}
void node_vect_math_multiply(vec3 v1,vec3 v2,vec3 v3,float val,out vec3 outVec,out float outVal){
outVec=v1*v2;
}
void node_vect_math_divide(vec3 v1,vec3 v2,vec3 v3,float val,out vec3 outVec,out float outVal){
outVec.x=v2.x==0.0?0.0:v1.x/v2.x;
outVec.y=v2.y==0.0?0.0:v1.y/v2.y;
outVec.z=v2.z==0.0?0.0:v1.z/v2.z;
}
void node_vect_math_cross_product(vec3 v1,vec3 v2,vec3 v3,float val,out vec3 outVec,out float outVal){
outVec=cross(v1,v2);
}
void node_vect_math_project(vec3 v1,vec3 v2,vec3 v3,float val,out vec3 outVec,out float outVal){
float d=dot(v2,v2);
outVec=(d != 0.0)?(dot(v1,v2)/d)*v2:vec3(0.0);
}
void node_vect_math_reflect(vec3 v1,vec3 v2,vec3 v3,float val,out vec3 outVec,out float outVal){
if (v2 != vec3(0.0)){
v2=normalize(v2);
}
outVec=reflect(v1,v2);
}
void node_vect_math_dot_product(vec3 v1,vec3 v2,vec3 v3,float val,out vec3 outVec,out float outVal){
outVal=dot(v1,v2);
}
void node_vect_math_distance(vec3 v1,vec3 v2,vec3 v3,float val,out vec3 outVec,out float outVal){
outVal=distance(v1,v2);
}
void node_vect_math_length(vec3 v1,vec3 v2,vec3 v3,float val,out vec3 outVec,out float outVal){
outVal=length(v1);
}
void node_vect_math_scale(vec3 v1,vec3 v2,vec3 v3,float val,out vec3 outVec,out float outVal){
outVec=v1*val;
}
void node_vect_math_normalize(vec3 v1,vec3 v2,vec3 v3,float val,out vec3 outVec,out float outVal){
if (v1 != vec3(0.0)){
v1=normalize(v1);
}
outVec=v1;
}
void node_vect_math_snap(vec3 v1,vec3 v2,vec3 v3,float val,out vec3 outVec,out float outVal){
outVec.x=v2.x==0.0?0.0:floor(v1.x/v2.x)*v2.x;
outVec.y=v2.y==0.0?0.0:floor(v1.y/v2.y)*v2.y;
outVec.z=v2.z==0.0?0.0:floor(v1.z/v2.z)*v2.z;
}
void node_vect_math_floor(vec3 v1,vec3 v2,vec3 v3,float val,out vec3 outVec,out float outVal){
outVec=floor(v1);
}
void node_vect_math_ceil(vec3 v1,vec3 v2,vec3 v3,float val,out vec3 outVec,out float outVal){
outVec=ceil(v1);
}
void node_vect_math_modulo(vec3 v1,vec3 v2,vec3 v3,float val,out vec3 outVec,out float outVal){
vec3 signProduct=sign(v1)*sign(v2);
v1+=1e-5*signProduct;
outVec.x=signProduct.x>0.0?mod(v1.x,abs(v2.x)):0.0;
outVec.y=signProduct.y>0.0?mod(v1.y,abs(v2.y)):0.0;
outVec.z=signProduct.z>0.0?mod(v1.z,abs(v2.z)):0.0;
}
void node_vect_math_fraction(vec3 v1,vec3 v2,vec3 v3,float val,out vec3 outVec,out float outVal){
outVec=fract(v1);
}
void node_vect_math_absolute(vec3 v1,vec3 v2,vec3 v3,float val,out vec3 outVec,out float outVal){
outVec=abs(v1);
}
void node_vect_math_power(vec3 v1,vec3 v2,vec3 v3,float val,out vec3 outVec,out float outVal){
outVec=vec3(powCompat(v1.x,v2.x),powCompat(v1.y,v2.y),powCompat(v1.z,v2.z));
}
void node_vect_math_sign(vec3 v1,vec3 v2,vec3 v3,float val,out vec3 outVec,out float outVal){
outVec=sign(v1);
}
void node_vect_math_minimum(vec3 v1,vec3 v2,vec3 v3,float val,out vec3 outVec,out float outVal){
outVec=min(v1,v2);
}
void node_vect_math_maximum(vec3 v1,vec3 v2,vec3 v3,float val,out vec3 outVec,out float outVal){
outVec=max(v1,v2);
}
void node_vect_math_cosine(vec3 v1,vec3 v2,vec3 v3,float val,out vec3 outVec,out float outVal){
outVec=cos(v1);
}
void node_vect_math_sine(vec3 v1,vec3 v2,vec3 v3,float val,out vec3 outVec,out float outVal){
outVec=sin(v1);
}
void node_vect_math_tangent(vec3 v1,vec3 v2,vec3 v3,float val,out vec3 outVec,out float outVal){
outVec=tan(v1);
}
void node_vect_math_wrap(vec3 v1,vec3 v2,vec3 v3,float val,out vec3 outVec,out float outVal){
v1+=1e-5;
outVec.x=v2.x==v3.x?v2.x:mod(v1.x-v3.x,v2.x-v3.x)+v3.x;
outVec.y=v2.y==v3.y?v2.y:mod(v1.y-v3.y,v2.y-v3.y)+v3.y;
outVec.z=v2.z==v3.z?v2.z:mod(v1.z-v3.z,v2.z-v3.z)+v3.z;
}
void node_vect_math_faceforward(vec3 v1,vec3 v2,vec3 v3,float val,out vec3 outVec,out float outVal){
outVec=dot(v2,v3)<0.0?v1:-v1;
}
void node_vect_math_multiply_add(vec3 v1,vec3 v2,vec3 v3,float val,out vec3 outVec,out float outVal){
outVec=v1*v2+v3;
}
void node_vect_math_refract(vec3 v1,vec3 v2,vec3 v3,float val,out vec3 outVec,out float outVal){
if (v2 != vec3(0.0)){
v2=normalize(v2);
}
outVec=refract(v1,v2,val);
}`,tpe=`#define VEC_TRANS_NONE 0
#define VEC_TRANS_W_O 1
#define VEC_TRANS_W_C 2
#define VEC_TRANS_O_W 3
#define VEC_TRANS_O_C 4
#define VEC_TRANS_C_W 5
#define VEC_TRANS_C_O 6
#define VEC_TRANS_W_O_DIR 7
#define VEC_TRANS_W_C_DIR 8
#define VEC_TRANS_O_W_DIR 9
#define VEC_TRANS_O_C_DIR 10
#define VEC_TRANS_C_W_DIR 11
#define VEC_TRANS_C_O_DIR 12
void node_vect_transform(const int vecTransType,const bool invCamZ,vec3 vIn,out vec3 vOut)
{
if (vecTransType==VEC_TRANS_NONE)
vOut=vIn;
else {
vec4 vec;
if (vecTransType<VEC_TRANS_W_O_DIR)
vec=vec4(vIn.xyz,1.0);
else
vec=vec4(vIn.xyz,0.0);
if (vecTransType==VEC_TRANS_W_O||vecTransType==VEC_TRANS_W_O_DIR){
vec=vec4(vec.x,vec.z,-vec.y,vec.w);
vec=invModelMatrix*vec;
vec=vec4(vec.x,-vec.z,vec.y,vec.w);
} else if (vecTransType==VEC_TRANS_W_C||vecTransType==VEC_TRANS_W_C_DIR){
vec=vec4(vec.x,vec.z,-vec.y,vec.w);
vec=viewMatrix*vec;
if (invCamZ)
vec[2]=-vec[2];
} else if (vecTransType==VEC_TRANS_O_W||vecTransType==VEC_TRANS_O_W_DIR){
vec=vec4(vec.x,vec.z,-vec.y,vec.w);
vec=modelMatrix*vec;
vec=vec4(vec.x,-vec.z,vec.y,vec.w);
} else if (vecTransType==VEC_TRANS_O_C||vecTransType==VEC_TRANS_O_C_DIR){
vec=vec4(vec.x,vec.z,-vec.y,vec.w);
vec=modelViewMatrix*vec;
if (invCamZ)
vec[2]=-vec[2];
} else if (vecTransType==VEC_TRANS_C_W||vecTransType==VEC_TRANS_C_W_DIR){
if (invCamZ)
vec[2]=-vec[2];
vec=invViewMatrix*vec;
vec=vec4(vec.x,-vec.z,vec.y,vec.w);
} else if (vecTransType==VEC_TRANS_C_O||vecTransType==VEC_TRANS_C_O_DIR){
if (invCamZ)
vec[2]=-vec[2];
vec=invModelMatrix*invViewMatrix*vec;
vec=vec4(vec.x,-vec.z,vec.y,vec.w);
}
vOut=vec.xyz;
}
}`,npe=`void node_vector_displacement(vec4 vector,float midLevel,float scale,out vec3 displacement){
displacement=vec3(0.0);
}`,rpe=`void node_vector_rotate_axis_angle(float invert,vec3 vector,vec3 center,vec3 axis,float angle,vec3 rotation,out vec3 outVector){
if (length(axis)>0.0){
vector-=center;
outVector=vec3RotateAxisAngle(vector,axis,invert*angle);
outVector+=center;
} else {
outVector=vector;
}
}
void node_vector_rotate_euler_xyz(float invert,vec3 vector,vec3 center,vec3 axis,float angle,vec3 rotation,out vec3 outVector){
vec4 axisAngle=eulerToAxisAngle(rotation);
vector-=center;
outVector=vec3RotateAxisAngle(vector,axisAngle.xyz,invert*axisAngle.w);
outVector+=center;
}
void node_vector_rotate_x_axis(float invert,vec3 vector,vec3 center,vec3 axis,float angle,vec3 rotation,out vec3 outVector){
vector-=center;
outVector=vec3RotateXAngle(vector,invert*angle);
outVector+=center;
}
void node_vector_rotate_y_axis(float invert,vec3 vector,vec3 center,vec3 axis,float angle,vec3 rotation,out vec3 outVector){
vector-=center;
outVector=vec3RotateYAngle(vector,invert*angle);
outVector+=center;
}
void node_vector_rotate_z_axis(float invert,vec3 vector,vec3 center,vec3 axis,float angle,vec3 rotation,out vec3 outVector){
vector-=center;
outVector=vec3RotateZAngle(vector,invert*angle);
outVector+=center;
}`,ope=`void node_vertex_color(vec4 color,out vec4 outColor,out float outAlpha){
outColor=color;
outAlpha=color.a;
}`,ipe=`void node_volume_absorption(vec4 color,float density,out vec4 outColor)
{
outColor=color;
}`,ape=`void node_volume_info(out vec4 color,out float density,out float flame,out float temperature){
color=vec4(vec3(0.0),1.0);
density=0.0;
flame=0.0;
temperature=0.0;
}`,spe=`void node_volume_scatter(vec4 color,float density,float anisotropy,float ior,float backscatter,float alpha,float diameter,out vec4 outColor)
{
outColor=vec4(color);
}
void node_volume_scatter(vec4 color,float density,float anisotropy,out vec4 outColor)
{
outColor=vec4(color);
}`,lpe=`void node_wavelength(float wavelength,out vec4 outColor)
{
outColor=vec4(0.0,0.0,0.0,1.0);
#if __VERSION__==300
vec3 xyz=vec3(0.0);
float ii=(wavelength-380.0)/5.0;
int i=int(ii);
if (i<0||i>=80){
return;
}
ii-=float(i);
vec3 c1=cieColorMatch[i];
vec3 c2=cieColorMatch[i+1];
xyz=mix(c1,c2,ii);
outColor=vec4(xyz_to_sRGB(xyz),1.0);
#endif
}`,cpe=`void node_wireframe(float size,out float outFac)
{
outFac=0.0;
}`,upe=`void node_bitmap_none(out vec4 color)
{
color=vec4(1.0);
}`,dpe=`void node_bitmap_env(sampler2D envMap,int reflectMode,float IOR,const int encoding,const bool alphaAsMono,const bool alphaAsRGB,float uOffset,float vOffset,float uTiling,float vTiling,float wAngle,vec3 normal,out vec4 color,out float value)
{
vec3 cameraToVertex=normalize(vWorldPosition-cameraPosition);
vec3 worldNormal=inverseTransformDirection(normal,viewMatrix);
vec3 reflectVec;
#if WORLD_NODES
reflectVec=normalize(cameraToVertex);
#else
if (reflectMode==MAX_ENV_COORDS_REFLECT)
reflectVec=reflect(cameraToVertex,worldNormal);
else {
float refrRatio=1.0/IOR;
reflectVec=refract(cameraToVertex,worldNormal,refrRatio);
}
#endif
mat3 uvTransform=calcUvTransform(uOffset,vOffset,uTiling,vTiling,wAngle);
color=sampleEquirectangular(envMap,reflectVec,uvTransform,encoding);
if (alphaAsMono)
value=color.a;
else
value=average(color.rgb);
if (alphaAsRGB)
color=vec4(color.a);
}`,fpe=`void node_bitmap(sampler2D map,const vec2 uvIn,const int mapping,const int axis,const ivec2 clampToEdgeNoExtend,const int encoding,const bool alphaAsMono,const bool alphaAsRGB,float uOffset,float vOffset,float uTiling,float vTiling,float wAngle,out vec4 color,out float value)
{
vec3 coordsIn;
if (mapping==MAPPING_EXPLICIT_MAP_CHANNEL){
coordsIn=vec3(uvIn.x,1.0-uvIn.y,0.0);
} else if (mapping==MAPPING_VERTEX_COLOR_CHANNEL){
coordsIn=vec3(0.0);
} else if (mapping==MAPPING_PLANAR_OBJECT_XYZ){
coordsIn=swizzleUpZ((invModelMatrix*invViewMatrix*vec4(-vViewPosition,1.0)).xyz);
} else {
coordsIn=swizzleUpZ((invViewMatrix*vec4(-vViewPosition,1.0)).xyz);
}
if (axis==AXIS_XY)
coordsIn=vec3(coordsIn.x,coordsIn.y,1.0);
else if (axis==AXIS_YZ)
coordsIn=vec3(coordsIn.y,coordsIn.z,1.0);
else if (axis==AXIS_ZX)
coordsIn=vec3(coordsIn.z,coordsIn.x,1.0);
vec3 coordsOut=calcUvTransform(uOffset,vOffset,uTiling,vTiling,wAngle)*coordsIn;
vec2 uv=vec2(coordsOut.x,1.0-coordsOut.y);
if ((clampToEdgeNoExtend[0]==1&&(uvIn.x<0.0||uvIn.x>1.0))||
(clampToEdgeNoExtend[1]==1&&(uvIn.y<0.0||uvIn.y>1.0))){
color=vec4(0.0,0.0,0.0,1.0);
} else {
color=texture2D(map,uv);
color=nodeTexelToLinear(color,encoding);
}
if (alphaAsMono)
value=color.a;
else
value=average(color.rgb);
if (alphaAsRGB)
color=vec4(color.a);
}`,hpe=`void node_bump(sampler2D bumpMap,const vec3 eyePos,const vec3 normal,const vec2 uvIn,float uOffset,float vOffset,float uTiling,float vTiling,float wAngle,out vec3 normalOut)
{
vec3 coordsIn;
coordsIn=vec3(uvIn.x,1.0-uvIn.y,1.0);
vec3 coordsOut=calcUvTransform(uOffset,vOffset,uTiling,vTiling,wAngle)*coordsIn;
vec2 uv=vec2(coordsOut.x,1.0-coordsOut.y);
vec2 dSTdx=dFdx(uv);
vec2 dSTdy=dFdy(uv);
if (any(equal(dSTdx,vec2(0.0)))||any(equal(dSTdy,vec2(0.0)))){
normalOut=normal;
} else {
const float bumpScale=1.0;
vec3 vSigmaX=vec3(dFdx(eyePos.x),dFdx(eyePos.y),dFdx(eyePos.z));
vec3 vSigmaY=vec3(dFdy(eyePos.x),dFdy(eyePos.y),dFdy(eyePos.z));
vec3 vN=normal;
vec3 R1=cross(vSigmaY,vN);
vec3 R2=cross(vN,vSigmaX);
float fDet=dot(vSigmaX,R1);
float Hll=bumpScale*texture2D(bumpMap,uv).x;
float dBx=bumpScale*texture2D(bumpMap,uv+dSTdx).x-Hll;
float dBy=bumpScale*texture2D(bumpMap,uv+dSTdy).x-Hll;
vec2 dHdxy=vec2(dBx,dBy);
vec3 vGrad=sign(fDet)*(dHdxy.x*R1+dHdxy.y*R2);
normalOut=normalize(abs(fDet)*normal-vGrad);
}
}`,ppe=`void node_blend(const bool useCurve,const float curveLower,const float curveUpper,const vec4 color1,const vec4 color2,float mask,out vec4 color)
{
if (useCurve)
mask=smoothstep(curveLower,curveUpper,mask);
else
mask=clamp(mask,0.0,1.0);
color=mix(color1,color2,mask);
}`,mpe=`#define REWIRE_RED 0
#define REWIRE_GREEN 1
#define REWIRE_BLUE 2
#define REWIRE_ALPHA 3
#define REWIRE_RED_INV 4
#define REWIRE_GREEN_INV 5
#define REWIRE_BLUE_INV 6
#define REWIRE_ALPHA_INV 7
#define REWIRE_MONOCHROME 8
#define REWIRE_ONE 9
#define REWIRE_ZERO 10
float rewireChannel(int type,vec4 color)
{
if (type==REWIRE_RED)
return color.r;
else if (type==REWIRE_GREEN)
return color.g;
else if (type==REWIRE_BLUE)
return color.b;
else if (type==REWIRE_ALPHA)
return color.a;
else if (type==REWIRE_RED_INV)
return 1.0-color.r;
else if (type==REWIRE_GREEN_INV)
return 1.0-color.g;
else if (type==REWIRE_BLUE_INV)
return 1.0-color.b;
else if (type==REWIRE_ALPHA_INV)
return 1.0-color.a;
else if (type==REWIRE_MONOCHROME)
return average(color.rgb);
else if (type==REWIRE_ONE)
return 1.0;
else
return 0.0;
}
vec3 gainPivotGammaLift(vec3 color,float gain,float pivot,float gamma,float lift,int exposureMode,float printerLights)
{
gain=gain/100.0;
if (exposureMode==0){
color=color*gain/pivot;
} else if (exposureMode==1){
color=color*pow(2.0,gain)/pivot;
} else {
color=color*pow(printerLights,gain)/pivot;
}
vec3 tmp=pivot*pow(color,vec3(1.0/gamma));
return step(0.00001,color)*tmp+lift;
}
float gainPivotGammaLift(float value,float gain,float pivot,float gamma,float lift,int exposureMode,float printerLights)
{
gain=gain/100.0;
if (exposureMode==0){
value=value*gain/pivot;
} else if (exposureMode==1){
value=value*pow(2.0,gain)/pivot;
} else {
value=value*pow(printerLights,gain)/pivot;
}
float tmp=pivot*pow(value,1.0/gamma);
return step(0.00001,value)*tmp+lift;
}
void node_color_correction(const ivec4 rewire,const vec4 color,const float hueShift,const float saturation,const vec4 tint,const float tintStrength,const float brightness,const float contrast,out vec4 outColor)
{
if (all(equal(rewire,ivec4(REWIRE_RED,REWIRE_GREEN,REWIRE_BLUE,REWIRE_ALPHA)))){
outColor=color;
} else {
outColor.r=rewireChannel(rewire.x,color);
outColor.g=rewireChannel(rewire.y,color);
outColor.b=rewireChannel(rewire.z,color);
outColor.a=rewireChannel(rewire.w,color);
}
vec4 hsv;
rgbToHSV(outColor,hsv);
hsv[0]+=hueShift/360.0;
if (hsv[0]>1.0)
hsv[0]-=1.0;
else if (hsv[0]<0.0)
hsv[0]+=1.0;
hsv[1]*=(saturation/100.0+1.0);
hsv[1]=saturate(hsv[1]);
if (tintStrength>0.0){
vec4 hsvTint;
rgbToHSV(tint,hsvTint);
hsv[0]=hsv[0]+(hsvTint[0]-hsv[0])*tintStrength/100.0;
}
hsvToRGB(hsv,outColor);
outColor=(outColor-0.5)*(contrast/100.0+1.0)+0.5+brightness/100.0;
outColor=max(outColor,0.0);
}
void node_color_correction(const ivec4 rewire,const mat4 params,bool enableR,bool enableG,bool enableB,int exposureMode,float printerLights,const vec4 color,const float hueShift,const float saturation,const vec4 tint,const float tintStrength,out vec4 outColor)
{
if (all(equal(rewire,ivec4(REWIRE_RED,REWIRE_GREEN,REWIRE_BLUE,REWIRE_ALPHA)))){
outColor=color;
} else {
outColor.r=rewireChannel(rewire.x,color);
outColor.g=rewireChannel(rewire.y,color);
outColor.b=rewireChannel(rewire.z,color);
outColor.a=rewireChannel(rewire.w,color);
}
vec4 hsv;
rgbToHSV(outColor,hsv);
hsv[0]+=hueShift/360.0;
if (hsv[0]>1.0)
hsv[0]-=1.0;
else if (hsv[0]<0.0)
hsv[0]+=1.0;
hsv[1]*=(saturation/100.0+1.0);
hsv[1]=saturate(hsv[1]);
if (tintStrength>0.0){
vec4 hsvTint;
rgbToHSV(tint,hsvTint);
hsv[0]=hsv[0]+(hsvTint[0]-hsv[0])*tintStrength/100.0;
}
hsvToRGB(hsv,outColor);
outColor.rgb=gainPivotGammaLift(outColor.rgb,params[0][0],params[0][1],params[0][2],params[0][3],exposureMode,printerLights);
if (enableR)
outColor.r=gainPivotGammaLift(outColor.r,params[1][0],params[1][1],params[1][2],params[1][3],exposureMode,printerLights);
if (enableG)
outColor.g=gainPivotGammaLift(outColor.g,params[2][0],params[2][1],params[2][2],params[2][3],exposureMode,printerLights);
if (enableB)
outColor.b=gainPivotGammaLift(outColor.b,params[3][0],params[3][1],params[3][2],params[3][3],exposureMode,printerLights);
outColor=max(outColor,0.0);
}`,gpe=`void node_color_map(const bool reverseGamma,const vec4 color,const float gamma,const float gain,out vec4 outColor)
{
float p=reverseGamma?gamma:1.0/gamma;
float g=reverseGamma?(gain>EPSILON?1.0/gain:1.0):gain;
outColor=vec4(g*pow(abs(color.rgb),vec3(p)),color.a);
}`,_pe=`#define COMP_BLEND_NORMAL 0
#define COMP_BLEND_AVERAGE 1
#define COMP_BLEND_ADD 2
#define COMP_BLEND_SUBTRACT 3
#define COMP_BLEND_DARKEN 4
#define COMP_BLEND_MULTIPLY 5
#define COMP_BLEND_COLORBURN 6
#define COMP_BLEND_LINEARBURN 7
#define COMP_BLEND_LIGHTEN 8
#define COMP_BLEND_SCREEN 9
#define COMP_BLEND_COLORDODGE 10
#define COMP_BLEND_LINEARDODGE 11
#define COMP_BLEND_SPOT 12
#define COMP_BLEND_SPOTBLEND 13
#define COMP_BLEND_OVERLAY 14
#define COMP_BLEND_SOFTLIGHT 15
#define COMP_BLEND_HARDLIGHT 16
#define COMP_BLEND_PINLIGHT 17
#define COMP_BLEND_HARDMIX 18
#define COMP_BLEND_DIFFERENCE 19
#define COMP_BLEND_EXCLUSION 20
#define COMP_BLEND_HUE 21
#define COMP_BLEND_SATURATION 22
#define COMP_BLEND_COLOR 23
#define COMP_BLEND_VALUE 24
vec4 calcBlending(const vec4 colorBG,const vec4 colorFG,const int blendMode){
if (blendMode==COMP_BLEND_NORMAL)
return colorFG;
else if (blendMode==COMP_BLEND_AVERAGE)
return (colorFG+colorBG)/2.0;
else if (blendMode==COMP_BLEND_ADD)
return colorBG+colorFG;
else if (blendMode==COMP_BLEND_SUBTRACT)
return colorBG-colorFG;
else if (blendMode==COMP_BLEND_DARKEN)
return min(colorFG,colorBG);
else if (blendMode==COMP_BLEND_MULTIPLY)
return colorBG*colorFG;
else if (blendMode==COMP_BLEND_COLORBURN){
if (colorFG.r==0.0&&colorFG.g==0.0&&colorFG.b==0.0)
return vec4(0.0,0.0,0.0,1.0);
else
return max(1.0-(1.0-colorBG)/colorFG,0.0);
} else if (blendMode==COMP_BLEND_LINEARBURN)
return max(colorFG+colorBG-1.0,0.0);
else if (blendMode==COMP_BLEND_LIGHTEN)
return max(colorFG,colorBG);
else if (blendMode==COMP_BLEND_SCREEN)
return colorFG+colorBG-colorFG*colorBG;
else if (blendMode==COMP_BLEND_COLORDODGE){
if (colorFG.r==1.0&&colorFG.g==1.0&&colorFG.b==1.0)
return vec4(1.0);
else
return min(colorBG/(1.0-colorFG),1.0);
} else if (blendMode==COMP_BLEND_LINEARDODGE)
return min(colorFG+colorBG,1.0);
else if (blendMode==COMP_BLEND_SPOT)
return min(2.0*colorFG*colorBG,1.0);
else if (blendMode==COMP_BLEND_SPOTBLEND)
return min(colorFG*colorBG+colorBG,1.0);
else if (blendMode==COMP_BLEND_OVERLAY){
if (colorBG.r<=0.5&&colorBG.g<=0.5&&colorBG.b<=0.5)
return saturate(2.0*colorFG*colorBG);
else
return saturate(1.0-2.0*(1.0-colorFG)*(1.0-colorBG));
} else if (blendMode==COMP_BLEND_SOFTLIGHT){
if (colorFG.r<=0.5&&colorFG.g<=0.5&&colorFG.b<=0.5)
return saturate(colorBG*(colorBG+2.0*colorFG*(1.0-colorBG)));
else
return saturate(colorBG+(2.0*colorFG-1.0)*(sqrt(colorBG)-colorBG));
} else if (blendMode==COMP_BLEND_HARDLIGHT){
if (colorFG.r<=0.5&&colorFG.g<=0.5&&colorFG.b<=0.5)
return saturate(2.0*colorFG*colorBG);
else
return saturate(1.0-2.0*(1.0-colorFG)*(1.0-colorBG));
} else if (blendMode==COMP_BLEND_PINLIGHT){
if (((colorFG.r>0.5&&colorFG.g>0.5&&colorFG.b>0.5)&&all(greaterThan(colorFG,colorBG)))||
((colorFG.r<=0.5&&colorFG.g<=0.5&&colorFG.b<=0.5)&&all(lessThan(colorFG,colorBG))))
return colorFG;
else
return colorBG;
} else if (blendMode==COMP_BLEND_HARDMIX){
if (colorFG.r+colorBG.r<=1.0&&colorFG.g+colorBG.g<=1.0&&colorFG.b+colorBG.b<=1.0)
return vec4(0.0,0.0,0.0,1.0);
else
return vec4(1.0);
} else if (blendMode==COMP_BLEND_DIFFERENCE)
return abs(colorFG-colorBG);
else if (blendMode==COMP_BLEND_EXCLUSION)
return colorFG+colorBG-2.0*colorFG*colorBG;
}
vec4 calcBlendingHSV(const vec4 colorBG,const vec4 colorFG,const int blendMode)
{
vec4 hsvBG,hsvFG;
vec4 outColor;
if (blendMode==COMP_BLEND_HUE){
rgbToHSV(colorBG,hsvBG);
rgbToHSV(colorFG,hsvFG);
hsvToRGB(vec4(hsvFG[0],hsvBG[1],hsvBG[2],1.0),outColor);
} else if (blendMode==COMP_BLEND_SATURATION){
rgbToHSV(colorBG,hsvBG);
rgbToHSV(colorFG,hsvFG);
hsvToRGB(vec4(hsvBG[0],hsvFG[1],hsvBG[2],1.0),outColor);
} else if (blendMode==COMP_BLEND_COLOR){
rgbToHSV(colorBG,hsvBG);
rgbToHSV(colorFG,hsvFG);
hsvToRGB(vec4(hsvFG[0],hsvFG[1],hsvBG[2],1.0),outColor);
} else if (blendMode==COMP_BLEND_VALUE){
rgbToHSV(colorBG,hsvBG);
rgbToHSV(colorFG,hsvFG);
hsvToRGB(vec4(hsvBG[0],hsvBG[1],hsvFG[2],1.0),outColor);
}
return outColor;
}
void node_composite_layer(const int blendMode,const float opacity,const vec4 colorBG,const vec4 colorFG,const vec4 mask,out vec4 outColor)
{
float fac=saturate(opacity*average(mask.rgb));
if (blendMode<COMP_BLEND_HUE)
outColor=calcBlending(colorBG,colorFG,blendMode);
else
outColor=calcBlendingHSV(colorBG,colorFG,blendMode);
outColor=mix(colorBG,outColor,fac);
}`,vpe=`#define FALLOFF_TYPE_TOWARDS_AWAY 0
#define FALLOFF_TYPE_PERP_PARALL 1
#define FALLOFF_TYPE_FRESHNEL 2
#define FALLOFF_TYPE_SHADOW_LIGHT 3
#define FALLOFF_TYPE_DIST_BLEND 4
void node_falloff(const vec3 viewPos,const float IOR,const int falloffType,const vec4 color1,const vec4 color2,const vec3 normal,out vec4 color)
{
vec3 dir=normalize(viewPos);
float fac;
if (falloffType==FALLOFF_TYPE_TOWARDS_AWAY){
fac=1.0-(0.5*(abs(dot(dir,normal))+1.0));
} else if (falloffType==FALLOFF_TYPE_PERP_PARALL){
fac=1.0-abs(dot(dir,normal));
} else if (falloffType==FALLOFF_TYPE_FRESHNEL){
float eta=max(IOR,0.00001);
fac=fresnelReflection(dir,normal,(gl_FrontFacing)?eta:1.0/eta);
} else {
fac=0.0;
}
color=mix(color1,color2,fac);
}
void node_falloff(const vec3 viewPos,bool extrapolateOn,float nearDistance,float farDistance,const vec4 color1,const vec4 color2,const vec3 normal,out vec4 color)
{
float dist=length(viewPos);
float fac;
if (!extrapolateOn&&dist<=nearDistance){
fac=1.0;
} else if (!extrapolateOn&&dist>farDistance){
fac=0.0;
} else {
fac=((farDistance-nearDistance)!= 0.0)?((farDistance-dist)/(farDistance-nearDistance)):10000.0;
}
color=mix(color1,color2,fac);
}`,Ape=`#define GRAD_TYPE_LINEAR 0
#define GRAD_TYPE_RADIAL 1
void node_gradient(float color2Pos,int gradientType,vec2 uvIn,vec3 viewPos,int mapping,int axis,ivec2 clampToEdgeNoExtend,vec3 color1,vec3 color2,vec3 color3,float uOffset,float vOffset,float uTiling,float vTiling,float wAngle,out vec4 outCol)
{
vec3 coordsIn;
if (mapping==MAPPING_EXPLICIT_MAP_CHANNEL){
coordsIn=vec3(uvIn.x,1.0-uvIn.y,0.0);
} else if (mapping==MAPPING_VERTEX_COLOR_CHANNEL){
coordsIn=vec3(0.0);
} else if (mapping==MAPPING_PLANAR_OBJECT_XYZ){
coordsIn=swizzleUpZ((invModelMatrix*invViewMatrix*vec4(-viewPos,1.0)).xyz);
} else {
coordsIn=swizzleUpZ((invViewMatrix*vec4(-vViewPosition,1.0)).xyz);
}
if (axis==AXIS_XY)
coordsIn=vec3(coordsIn.x,coordsIn.y,1.0);
else if (axis==AXIS_YZ)
coordsIn=vec3(coordsIn.y,coordsIn.z,1.0);
else if (axis==AXIS_ZX)
coordsIn=vec3(coordsIn.z,coordsIn.x,1.0);
vec3 coordsOut=calcUvTransform(uOffset,vOffset,uTiling,vTiling,wAngle)*coordsIn;
float coord=uvIn.x;
uvIn=coordsOut.xy;
if ((clampToEdgeNoExtend[0]==1&&(uvIn.x<0.0||uvIn.x>1.0))||
(clampToEdgeNoExtend[1]==1&&(uvIn.y<0.0||uvIn.y>1.0))){
outCol=vec4(0.0,0.0,0.0,1.0);
return;
}
uvIn=fract(uvIn);
if (gradientType==GRAD_TYPE_LINEAR){
coord=uvIn.y;
} else {
coord=length(uvIn-vec2(0.5))*2.0;
if (coord>1.0)
coord=1.0;
}
if (coord<color2Pos){
coord=coord/color2Pos;
outCol=vec4(color3*(1.0-coord)+color2*coord,1.0);
} else if (coord>color2Pos){
coord=(coord-color2Pos)/(1.0-color2Pos);
outCol=vec4(color2*(1.0-coord)+color1*coord,1.0);
} else {
outCol=vec4(color2,1.0);
}
}`,ype=`#define GRAD_TYPE_4_CORNER 0
#define GRAD_TYPE_BOX 1
#define GRAD_TYPE_DIAGONAL 2
#define GRAD_TYPE_LIGHTING 3
#define GRAD_TYPE_LINEAR 4
#define GRAD_TYPE_MAPPED 5
#define GRAD_TYPE_NORMAL 6
#define GRAD_TYPE_PONG 7
#define GRAD_TYPE_RADIAL 8
#define GRAD_TYPE_SPIRAL 9
#define GRAD_TYPE_SWEEP 10
#define GRAD_TYPE_TARTAN 11
void node_gradient_ramp(sampler2D gradientData,int gradientType,vec2 uvIn,vec3 geometryNormal,vec3 viewPos,int mapping,int axis,ivec2 clampToEdgeNoExtend,vec4 sourceMap,float uOffset,float vOffset,float uTiling,float vTiling,float wAngle,out vec4 outCol)
{
vec3 coordsIn;
if (mapping==MAPPING_EXPLICIT_MAP_CHANNEL){
coordsIn=vec3(uvIn.x,1.0-uvIn.y,0.0);
} else if (mapping==MAPPING_VERTEX_COLOR_CHANNEL){
coordsIn=vec3(0.0);
} else if (mapping==MAPPING_PLANAR_OBJECT_XYZ){
coordsIn=swizzleUpZ((invModelMatrix*invViewMatrix*vec4(-viewPos,1.0)).xyz);
} else {
coordsIn=swizzleUpZ((invViewMatrix*vec4(-vViewPosition,1.0)).xyz);
}
if (axis==AXIS_XY)
coordsIn=vec3(coordsIn.x,coordsIn.y,1.0);
else if (axis==AXIS_YZ)
coordsIn=vec3(coordsIn.y,coordsIn.z,1.0);
else if (axis==AXIS_ZX)
coordsIn=vec3(coordsIn.z,coordsIn.x,1.0);
vec3 coordsOut=calcUvTransform(uOffset,vOffset,uTiling,vTiling,wAngle)*coordsIn;
float coord=uvIn.x;
uvIn=coordsOut.xy;
if ((clampToEdgeNoExtend[0]==1&&(uvIn.x<0.0||uvIn.x>1.0))||
(clampToEdgeNoExtend[1]==1&&(uvIn.y<0.0||uvIn.y>1.0))){
outCol=vec4(0.0,0.0,0.0,1.0);
return;
}
uvIn=fract(uvIn);
if (gradientType==GRAD_TYPE_4_CORNER){
coord=pow(uvIn.x,2.0);
} else if (gradientType==GRAD_TYPE_BOX){
vec2 boxUv=abs(uvIn-vec2(0.5))*2.0;
coord=max(boxUv.x,boxUv.y);
} else if (gradientType==GRAD_TYPE_DIAGONAL){
coord=abs(uvIn.x-uvIn.y)*sqrt(2.0);
} else if (gradientType==GRAD_TYPE_LIGHTING){
IncidentLight directLight;
GeometricContext geometry;
geometry.position=-viewPos;
vec3 irr=vec3(0.0);
#if (NUM_POINT_LIGHTS>0)
#pragma unroll_loop
for (int i=0;i<NUM_POINT_LIGHTS;i++){
getPointLightInfo(pointLights[i],geometry,directLight);
float dotNL=saturate(dot(geometryNormal,directLight.direction));
irr+=dotNL*directLight.color;
}
#endif
#if (NUM_SPOT_LIGHTS>0)
#pragma unroll_loop
for (int i=0;i<NUM_SPOT_LIGHTS;i++){
getSpotLightInfo(spotLights[i],geometry,directLight);
float dotNL=saturate(dot(geometryNormal,directLight.direction));
irr+=dotNL*directLight.color;
}
#endif
#if (NUM_DIR_LIGHTS>0)
#pragma unroll_loop
for (int i=0;i<NUM_DIR_LIGHTS;i++){
getDirectionalLightInfo(directionalLights[i],geometry,directLight);
float dotNL=saturate(dot(geometryNormal,directLight.direction));
irr+=dotNL*directLight.color;
}
#endif
irr/=PI;
vec3 ambIrr=getAmbientLightIrradiance(ambientLightColor);
irr+=ambIrr;
coord=(irr.x+irr.y+irr.z)/3.0;
} else if (gradientType==GRAD_TYPE_LINEAR){
coord=uvIn.x;
} else if (gradientType==GRAD_TYPE_MAPPED){
coord=(sourceMap.x+sourceMap.y+sourceMap.z)/3.0;
} else if (gradientType==GRAD_TYPE_NORMAL){
float angle=acos(clamp(dot(geometryNormal,normalize(viewPos)),-1.0,1.0));
float k=100.0;
coord=1.0-sin(pow2(k)-k*sqrt(pow2(k)-pow2(angle)));
} else if (gradientType==GRAD_TYPE_PONG){
float y=min(uvIn.y,uvIn.x);
float x=max(uvIn.y,uvIn.x);
coord=y/x;
} else if (gradientType==GRAD_TYPE_RADIAL){
coord=length(uvIn-vec2(0.5))*2.0;
} else if (gradientType==GRAD_TYPE_SPIRAL){
vec2 uvSpiral=mat2(0.0,1.0,-1.0,0.0)*(uvIn-vec2(0.5));
coord=atan(uvSpiral.y,uvSpiral.x)/PI2+0.5;
} else if (gradientType==GRAD_TYPE_SWEEP){
coord=atan(uvIn.x,uvIn.y)/PI_HALF;
} else if (gradientType==GRAD_TYPE_TARTAN){
vec2 uvTartan=abs(uvIn-vec2(0.5));
coord=1.0-min(uvTartan.x,uvTartan.y)*2.0;
}
outCol=texture2D(gradientData,vec2(coord,0.0));
}`,bpe=`
void node_map(const vec4 colorIn,out vec4 color)
{
color=colorIn;
}`,xpe=`void node_mask(const bool maskInverted,const vec4 color,vec4 mask,out vec4 outColor)
{
mask=maskInverted?vec4(vec3(1.0)-mask.rgb,mask.a):mask;
outColor=color*mask;
}`,Epe=`void node_material(float reflectionRatio,const float refractionRatio,const bool selfIllumColorOn,const vec4 ambientColor,const vec4 diffuseColor,const vec4 specularColor,const float glossiness,const float specularLevel,const vec4 selfIllum,const float opacity,const vec4 filterColor,const vec3 normal,const vec4 reflection,const vec4 refraction,const float displacement,out vec4 outColor)
{
vec3 diffuse,specular;
NodeMaterial material;
float ior=1.5;
float facing=pow2((1.0-ior)/(1.0+ior));
float edge=1.0;
float slope=5.0;
float cosTheta=saturate(dot(normal,normalize(vViewPosition)));
float fresnelRefl=(facing+(edge-facing)*pow(1.0-cosTheta,slope))*saturate(specularLevel);
float kd=1.0-fresnelRefl;
material.diffuseColor=diffuseColor.rgb*kd;
material.specularColor=mix(vec3(0.0),specularColor.rgb,fresnelRefl);
material.roughness=1.0-glossiness;
ReflectedLight reflectedLight=ReflectedLight(vec3(0.0),vec3(0.0),vec3(0.0),vec3(0.0));
#define RE_Direct RE_Direct_Node
#define RE_IndirectDiffuse RE_IndirectDiffuse_Node
#define RE_IndirectSpecular RE_IndirectSpecular_Node
#include <lights_fragment_begin>
#include <lights_fragment_maps>
#include <lights_fragment_end>
#undef RE_Direct
#undef RE_IndirectDiffuse
#undef RE_IndirectSpecular
diffuse=reflectedLight.directDiffuse+reflectedLight.indirectDiffuse;
if (selfIllumColorOn){
diffuse+=selfIllum.rgb;
} else {
diffuse=mix(diffuse,material.diffuseColor,selfIllum[0]);
}
specular=reflectedLight.directSpecular+reflectedLight.indirectSpecular;
outColor=vec4(saturate(diffuse+specular),1.0);
float alpha=opacity-saturate(maxFromRGB(specular))*(opacity-1.0);
outColor+=reflection*specularColor*reflectionRatio;
outColor+=refraction*refractionRatio;
alpha+=saturate(maxFromRGB(reflection.rgb)*maxFromRGB(specularColor.rgb))*reflectionRatio;
alpha+=saturate(maxFromRGB(refraction.rgb))*refractionRatio;
outColor.a=alpha;
}`,Cpe=`#include <shadowmask_pars_fragment>
void node_matte_shadow(vec3 normal,bool receiveShadow,float shadowBrightness,vec3 color,out vec4 outColor){
float shadow=getShadowMask();
outColor=vec4(color,1.0-(shadowBrightness+(1.0-shadowBrightness)*shadow));
}`,Spe=`void node_mix(const vec4 color1,const vec4 color2,const float amount,out vec4 color)
{
color=mix(color1,color2,clamp(amount,0.0,1.0));
}`,wpe=`#define NOISE_REGULAR 0
#define NOISE_FRACTAL 1
#define NOISE_TURBULENCE 2
float noise(vec3 vec,const int noiseType,const float size,const float thresholdLow,const float thresholdHigh,const float levels,float phase){
vec/=size;
float n=0.0;
if (noiseType==NOISE_REGULAR){
n=(1.0+snoise(vec4(vec,phase)))*0.5;
} else if (noiseType==NOISE_FRACTAL){
float l,f=1.0;
#if __VERSION__==100
for (float l=3.0;l>=1.0;l-=1.0){
#else
for (l=levels;l>=1.0;l-=1.0){
#endif
n+=snoise(vec4(vec*f,phase))/f;
f*=2.0;
}
if (l>0.0)
n+=l*snoise(vec4(vec*f,phase))/f;
n=0.5*(n+1.0);
} else {
float l,f=1.0;
float ml=levels;
#if __VERSION__==100
for (float l=3.0;l>=1.0;l-=1.0){
#else
for (l=levels;l>=1.0;l-=1.0,ml-=1.0){
#endif
n+=abs(snoise(vec4(vec*f,phase)))/f;
f*=2.0;
}
if (l>0.0)
n+=l*abs(snoise(vec4(vec*f,phase)))/f;
}
return clamp(smoothstep(thresholdLow,thresholdHigh,n),0.0,1.0);
}
void node_noise(const vec2 uv,const int noiseType,const int coordType,const vec3 color1,const vec3 color2,const float size,const float thresholdLow,const float thresholdHigh,const float levels,const float phase,const vec3 offset,const vec3 tiling,const vec3 angle,out vec4 color){
vec3 vec=(calcXYZTransform(offset,tiling,angle)*vec4(uv.x,1.0-uv.y,1.0,1.0)).xyz;
color=vec4(mix(color1,color2,noise(vec,noiseType,size,thresholdLow,thresholdHigh,levels,phase)),1.0);
}
void node_noise(const vec3 viewPos,const int noiseType,const int coordType,const vec3 color1,const vec3 color2,const float size,const float thresholdLow,const float thresholdHigh,const float levels,const float phase,const vec3 offset,const vec3 tiling,const vec3 angle,out vec4 color){
vec4 posWorld=invViewMatrix*vec4(-viewPos,1.0);
vec3 vec;
if (coordType==0)
vec=(invModelMatrix*posWorld).xyz;
else
vec=posWorld.xyz;
vec=(calcXYZTransform(offset,tiling,angle)*vec4(swizzleUpZ(vec),1.0)).xyz;
color=vec4(mix(color1,color2,noise(vec,noiseType,size,thresholdLow,thresholdHigh,levels,phase)),1.0);
}`,Mpe=`void node_normal_bump(const vec4 tangent,const vec3 normal,ivec2 flip,vec4 normalColor,vec3 additionalBump,float normalMult,float addBumpMult,out vec3 normalOut)
{
if (flip[0]==1)
normalColor.x=1.0-normalColor.x;
if (flip[1]==0)
normalColor.y=1.0-normalColor.y;
vec3 normalTex=(normalColor.xyz*2.0-1.0);
vec4 viewTangent=vec4(normalize(modelViewMatrix*vec4(tangent.xyz,0.0)).xyz,tangent.w);
vec3 bitangent=viewTangent.w*cross(normal,viewTangent.xyz);
normalOut=normalize(normalTex.x*viewTangent.xyz+normalTex.y*bitangent 
+ normalTex.z*normal);
normalOut=mix(normal,normalOut,normalMult);
additionalBump=mix(normal,additionalBump,addBumpMult);
normalOut=normalize(normalOut+additionalBump);
}`,Tpe=`void node_openpbr_surface(vec3 geometryNormal,const bool thinWalled,const float baseWeight,const vec3 baseColor,const float baseMetalness,const float baseDiffuseRoughness,const float specularWeight,const vec3 specularColor,const float specularRoughness,const float specularIOR,const float transmissionWeight,const vec3 transmissionColor,const float transmissionDepth,const float coatWeight,const vec3 coatColor,const float coatRoughness,const float fuzzWeight,const vec3 fuzzColor,const float fuzzRoughness,const float emissionWeight,const vec3 emissionColor,const float emissionLuminance,const float geometryOpacity,const vec3 normal,const vec3 clearcoatNormal,out vec4 outColor)
{
NodeMaterial material;
vec3 baseColorWeighted=baseWeight*baseColor.rgb;
material.diffuseColor=baseColorWeighted*(1.0-baseMetalness)*(1.0-transmissionWeight);
#ifdef USE_CLEARCOAT
material.clearcoat=saturate(coatWeight);
material.clearcoatRoughness=clamp(coatRoughness,0.0,1.0);
material.clearcoatF0=vec3(0.04);
material.clearcoatF90=1.0;
#endif
#ifdef USE_SHEEN
material.sheenColor=saturate(fuzzWeight*fuzzColor);
material.sheenRoughness=clamp(fuzzRoughness,0.0,1.0);
#endif
vec3 dxy=max(abs(dFdx(geometryNormal)),abs(dFdy(geometryNormal)));
float geometryRoughness=max(max(dxy.x,dxy.y),dxy.z);
material.roughness=max(specularRoughness,0.0525);
material.roughness+=geometryRoughness;
material.roughness=min(material.roughness,1.0);
vec3 specularColorWeighted=specularWeight*specularColor;
vec3 dielRefl=pow2((1.0-specularIOR)/(1.0+specularIOR))*specularColorWeighted;
material.specularColor=mix(dielRefl,baseColorWeighted,baseMetalness);
material.fresnelRefl90=mix(specularColorWeighted,vec3(1.0),baseMetalness);
material.specularF90=average(material.fresnelRefl90);
material.refractionColor=pow(transmissionWeight*(1.0-baseMetalness)*transmissionColor.rgb,vec3(2.0));
material.refractionIOR=specularIOR;
material.refractionRoughness=material.roughness;
ReflectedLight reflectedLight=ReflectedLight(vec3(0.0),vec3(0.0),vec3(0.0),vec3(0.0));
vec3 refractedLight=vec3(0.0);
#ifdef USE_GTAO
vec4 gtaoVisibilityBentNormal=texture2D(gtaoMap,gl_FragCoord.xy/currResolution);
vec3 bentNormal=normalize(unpackRGBToNormal(gtaoVisibilityBentNormal.gba));
#define PROBE_NORMAL bentNormal
#endif
#define RE_Direct RE_Direct_Node
#define RE_IndirectDiffuse RE_IndirectDiffuse_Node
#define RE_IndirectSpecular RE_IndirectSpecular_Node
#define RE_Refraction RE_Refraction_Node
#include <lights_fragment_begin>
#include <lights_fragment_maps>
#include <lights_fragment_end>
#undef RE_Direct
#undef RE_IndirectDiffuse
#undef RE_IndirectSpecular
#undef RE_Refraction
#ifdef PROBE_NORMAL
#undef PROBE_NORMAL
#endif
#ifdef USE_GTAO
reflectedLight.indirectDiffuse*=gtaoVisibilityBentNormal.r;
float gtaoVisibility=gtaoVisibilityBentNormal.r;
vec3 gtaoBentNormal=bentNormal;
vec3 gtaoViewDir=geometry.viewDir;
vec3 gtaoNormal=normal;
float gtaoRoughness=material.roughness;
#endif
#include <lights_fragment_gtso>
vec3 totalEmissiveRadiance=emissionWeight*emissionColor*emissionLuminance*OPENPBR_EMISSION_LUM_FACTOR;
vec3 outSpecular=reflectedLight.directSpecular+reflectedLight.indirectSpecular;
vec3 outColor3=reflectedLight.directDiffuse+reflectedLight.indirectDiffuse +
outSpecular+totalEmissiveRadiance;
#ifdef USE_SHEEN
float sheenEnergyComp=1.0-0.157*max3(material.sheenColor);
outColor3=outColor3*sheenEnergyComp+sheenSpecular;
#endif
#ifdef USE_CLEARCOAT
float dotNVcc=saturate(dot(geometry.normal,geometry.viewDir));
vec3 Fcc=F_Schlick(material.clearcoatF0,material.clearcoatF90,dotNVcc);
outColor3=outColor3*(1.0-material.clearcoat*Fcc)+clearcoatSpecular*material.clearcoat;
#endif
float alpha=1.0;
if (thinWalled){
alpha=geometryOpacity*(1.0-saturate(transmissionWeight)+maxFromRGB(outSpecular)*saturate(transmissionWeight));
} else {
outColor3+=refractedLight;
}
outColor=vec4(outColor3,saturate(alpha));
}`,Ipe=`vec4 processOutputColor(vec4 color,const bool invert,const bool clampColor,const bool alphaFromRGB,const float rgbLevel,const float rgbOffset,const float outputAmount)
{
vec3 color3=color.rgb;
color3=clampColor?saturate(color3):color3;
color3=color3*rgbLevel+vec3(rgbOffset);
color3=invert?(vec3(1.0)-color3):color3;
color=outputAmount*vec4(color3,color.a);
color.a=alphaFromRGB?average(color.rgb):color.a;
return color;
}
void node_output_map(const bool invert,const bool clampColor,const bool alphaFromRGB,const vec4 color,const float rgbLevel,const float rgbOffset,const float outputAmount,const float bumpAmount,out vec4 outColor)
{
outColor=processOutputColor(color,invert,clampColor,alphaFromRGB,rgbLevel,rgbOffset,outputAmount);
}
void node_output_map(const bool invert,const bool clampColor,const bool alphaFromRGB,sampler2D colormap,vec4 color,const float rgbLevel,const float rgbOffset,const float outputAmount,const float bumpAmount,out vec4 outColor)
{
float r=texture2D(colormap,vec2(color.r,0.0)).r;
float g=texture2D(colormap,vec2(color.g,0.0)).g;
float b=texture2D(colormap,vec2(color.b,0.0)).b;
outColor=processOutputColor(vec4(r,g,b,color.a),invert,clampColor,alphaFromRGB,rgbLevel,rgbOffset,outputAmount);
}`,Rpe=`void node_output(vec4 color,out vec4 outgoingLight)
{
outgoingLight=color;
}`,Lpe=`#define DEFAULT_REFLECTION_EDGE 1.0
#define DEFAULT_REFLECTION_SLOPE 5.0
void node_physical(vec3 geometryNormal,const float emitLuminance,const bool useCustomReflCurve,const float reflFacing,const float reflEdge,const float reflSlope,const bool roughnessInv,const bool transRoughnessLock,const bool transRoughnessInv,const bool thinWalled,const float base,const vec4 baseColor,const float reflectivity,const vec4 reflColor,const float roughness,const float metalness,const float diffRoughness,const float anisotropy,const float anisoangle,const float transparency,const vec4 transColor,const float transRoughness,const float ior,const float scattering,const vec4 sssColor,const float sssScale,const float emission,const vec4 emitColor,const float clearcoat,const vec4 clearcoatColor,const float clearcoatRoughness,const vec3 normal,const vec3 clearcoatNormal,const float displacement,const float opacity,out vec4 outColor)
{
NodeMaterial material;
vec3 baseColorWeighted=base*baseColor.rgb;
material.diffuseColor=baseColorWeighted*(1.0-transparency);
#ifdef USE_CLEARCOAT
material.clearcoat=saturate(clearcoat);
material.clearcoatRoughness=clamp(clearcoatRoughness,0.0,1.0);
material.clearcoatF0=vec3(0.04);
material.clearcoatF90=1.0;
#endif
float facing,edge,slope;
if (useCustomReflCurve){
facing=reflFacing;
edge=reflEdge;
slope=reflSlope;
} else {
facing=pow2((1.0-ior)/(1.0+ior));
edge=DEFAULT_REFLECTION_EDGE;
slope=DEFAULT_REFLECTION_SLOPE;
}
float cosTheta=saturate(dot(normal,normalize(vViewPosition)));
float fresnelRefl=(facing+(edge-facing)*pow(1.0-cosTheta,slope))
* saturate(reflectivity+metalness);
float kd=1.0-(metalness*(1.0-fresnelRefl)+fresnelRefl);
material.specularColor=mix(metalness*baseColorWeighted,reflColor.rgb,fresnelRefl);
material.diffuseColor*=kd;
material.specularF90=1.0;
material.roughness=clamp(roughnessInv?(1.0-roughness):roughness,0.0,1.0);
material.refractionColor=pow(transparency*(1.0-metalness)*transColor.rgb,vec3(2.0));
material.refractionIOR=ior;
float tRough;
if (transRoughnessLock){
tRough=roughnessInv?1.0-roughness:roughness;
} else {
tRough=transRoughnessInv?1.0-transRoughness:transRoughness;
}
material.refractionRoughness=pow2(tRough);
#if defined(ENVMAP_TYPE_CUBE)||defined(ENVMAP_TYPE_CUBE_UV)
float geomRoughness=calcGeometryRoughness(geometryNormal);
material.roughness=calcCubeUVAdjustedRoughness(material.roughness,geomRoughness);
material.refractionRoughness=calcCubeUVAdjustedRoughness(material.refractionRoughness,geomRoughness);
#ifdef USE_CLEARCOAT
material.clearcoatRoughness=calcCubeUVAdjustedRoughness(material.clearcoatRoughness,geomRoughness);
#endif
#endif
ReflectedLight reflectedLight=ReflectedLight(vec3(0.0),vec3(0.0),vec3(0.0),vec3(0.0));
vec3 refractedLight=vec3(0.0);
#ifdef USE_GTAO
vec4 gtaoVisibilityBentNormal=texture2D(gtaoMap,gl_FragCoord.xy/currResolution);
vec3 bentNormal=normalize(unpackRGBToNormal(gtaoVisibilityBentNormal.gba));
#define PROBE_NORMAL bentNormal
#endif
#define RE_Direct RE_Direct_Node
#define RE_IndirectDiffuse RE_IndirectDiffuse_Node
#define RE_IndirectSpecular RE_IndirectSpecular_Node
#define RE_Refraction RE_Refraction_Node
#include <lights_fragment_begin>
#include <lights_fragment_maps>
#include <lights_fragment_end>
#undef RE_Direct
#undef RE_IndirectDiffuse
#undef RE_IndirectSpecular
#undef RE_Refraction
#ifdef PROBE_NORMAL
#undef PROBE_NORMAL
#endif
#ifdef USE_GTAO
reflectedLight.indirectDiffuse*=gtaoVisibilityBentNormal.r;
float gtaoVisibility=gtaoVisibilityBentNormal.r;
vec3 gtaoBentNormal=bentNormal;
vec3 gtaoViewDir=geometry.viewDir;
vec3 gtaoNormal=normal;
float gtaoRoughness=material.roughness;
#endif
#include <lights_fragment_gtso>
vec3 totalEmissiveRadiance=emitLuminance/LUMENS_PER_WATT*emission*emitColor.rgb;
vec3 specular=reflectedLight.directSpecular+reflectedLight.indirectSpecular;
vec3 outColor3=reflectedLight.directDiffuse+reflectedLight.indirectDiffuse +
specular+totalEmissiveRadiance;
#ifdef USE_CLEARCOAT
float dotNVcc=saturate(dot(geometry.normal,geometry.viewDir));
vec3 Fcc=F_Schlick(material.clearcoatF0,material.clearcoatF90,dotNVcc);
outColor3=outColor3*(1.0-material.clearcoat*Fcc)+clearcoatSpecular*material.clearcoat;
#endif
float alpha=1.0;
if (thinWalled){
alpha=1.0-saturate(transparency)+maxFromRGB(specular)*saturate(transparency);
} else {
outColor3+=refractedLight;
}
outColor=vec4(outColor3,saturate(alpha)*opacity);
}`,Ppe=`vec3 perezSky(vec3 paramA,vec3 paramB,vec3 paramC,vec3 paramD,vec3 paramE,vec3 radiance,vec3 sunDirection,vec3 direction)
{
float cosGamma=clamp(dot(direction,sunDirection),-1.0,1.0);
float cosTheta=clamp(direction.y,0.0,1.0);
vec3 radInternal=(1.0+paramA*exp(paramB/cosTheta))*(1.0+paramC*exp(paramD*acos(cosGamma))
+ paramE*pow(cosGamma,2.0)
);
float ciex=radInternal.y*radiance.y;
float ciey=radInternal.z*radiance.z;
float cieY=clamp(radInternal.x*radiance.x,0.0,1000000.0);
vec3 XYZ=xyY_to_XYZ(ciex,ciey,cieY);
return max(xyz_to_sRGB(XYZ),0.0);
}
#define GROUND_SKY_SAMPLES 16
vec3 groundSky(vec3 paramA,vec3 paramB,vec3 paramC,vec3 paramD,vec3 paramE,vec3 radiance,vec3 sunDirection,vec3 sunIlluminance)
{
const int horizSamples=GROUND_SKY_SAMPLES;
const int vertSamples=GROUND_SKY_SAMPLES/2;
vec3 result=vec3(0.0);
for (int horizSampleIdx=0;horizSampleIdx<horizSamples;horizSampleIdx++){
float horizSample=float(horizSampleIdx)/float(horizSamples);
float horizAngle=PI2*horizSample;
for (int vertSampleIdx=0;vertSampleIdx<vertSamples;vertSampleIdx++){
float vertSample=float(vertSampleIdx)/float(vertSamples);
float y=1.0-vertSample;
float x=sqrt(1.0-y*y)*cos(horizAngle);
float z=-sqrt(1.0-y*y)*sin(horizAngle);
vec3 direction=vec3(x,y,z);
vec3 sampleColor=perezSky(paramA,paramB,paramC,paramD,paramE,radiance,sunDirection,direction);

result+=direction.y*sampleColor;
}
}
result/=float(horizSamples*vertSamples);
result+=(sunIlluminance*sunDirection.y)/PI;
return result;
}
void node_phy_sun_sky_env(vec3 paramA,vec3 paramB,vec3 paramC,vec3 paramD,vec3 paramE,vec3 radiance,vec3 sunDirection,vec3 sunIlluminance,vec3 sunLuminance,float globalIntensity,vec4 groundColor,out vec4 outColor)
{
vec3 dir=vWorldPosition;
if (length(dir)==0.0){
dir=vec3(0.0,0.0,-1.0);
} else {
dir=normalize(dir);
}
if (dir.y<0.0){
outColor=groundColor*vec4(groundSky(paramA,paramB,paramC,paramD,paramE,radiance,sunDirection,sunIlluminance),1.0);
} else {
outColor=vec4(perezSky(paramA,paramB,paramC,paramD,paramE,radiance,sunDirection,dir),1.0);
}
outColor=globalIntensity*outColor;
}`,Dpe=`void node_reflect_refract(sampler2D envMap,int reflectMode,const float IOR,const int encoding,vec3 normal,out vec4 color)
{
vec3 cameraToVertex=normalize(vWorldPosition-cameraPosition);
vec3 worldNormal=inverseTransformDirection(normal,viewMatrix);
vec3 reflectVec;
if (reflectMode==MAX_ENV_COORDS_REFLECT)
reflectVec=reflect(cameraToVertex,worldNormal);
else {
float refrRatio=1.0/IOR;
reflectVec=refract(cameraToVertex,worldNormal,refrRatio);
}
reflectVec=normalize(reflectVec);
color=sampleEquirectangular(envMap,reflectVec,mat3(1.0),encoding);
}`,Bpe=`void node_reflect_refract_color(const vec4 colorIn,out vec4 color)
{
color=vec4(colorIn);
}`,Npe=`void node_rgb_multiply(const vec4 color1,const vec4 color2,out vec4 color)
{
color=color1*color2;
}`,Ope=`void node_rgb_tint(const vec4 color,const vec4 red,const vec4 green,const vec4 blue,out vec4 outColor)
{
mat3 tintMatrix=mat3(red.rgb,green.rgb,blue.rgb);
outColor=vec4(tintMatrix*color.rgb,color.a);
}`,kpe=`uniform vec4 nodeRGB[NODE_RGB_NUM];
void node_rgb(vec4 color,out vec4 outColor)
{
outColor=color;
}`,Fpe=`void node_shellac(const vec4 color1,const vec4 color2,const float amount,out vec4 color)
{
color=mix(color1,color2,clamp(amount,0.0,1.0));
}`,Vpe=`#define COORD_WORLD_SPACE 0
#define COORD_OBJECT_SPACE 1
void node_sub_transform(const int coordSpace,vec3 scale,vec3 rotate,vec3 offset,out vec3 outVector,out vec3 outNormal)
{
vec3 norm=vNormal;
norm=(invViewMatrix*vec4(norm,0.0)).xyz;
vec3 vector=vWorldPosition.xyz;
if (coordSpace==COORD_OBJECT_SPACE){
vector=(invModelMatrix*vec4(vector,1.0)).xyz;
norm=(invModelMatrix*vec4(norm,0.0)).xyz;
}
vector-=swizzleUpY(offset.xyz);
vector*=scale.xzy;
mat3 rotX90=mat3RotateX(PI*0.5);
mat3 rotX=mat3RotateX(radians(rotate.x));
mat3 rotY=mat3RotateY(radians(-rotate.y));
mat3 rotZ=mat3RotateZ(radians(rotate.z));
mat3 rotMat=rotX*rotY*rotZ*rotX90;
vector=rotMat*vector;
norm=rotMat*norm;
outVector=vector;
outNormal=normalize(norm);
}`,Upe=`uniform float nodeValue[NODE_VALUE_NUM];
void node_value(float value,out float outValue)
{
outValue=value;
}`,zpe=`void node_vertex_color(vec3 color,out vec4 outColor)
{
outColor=vec4(color,1.0);
}`,Gpe=`void node_add_double_linear(float input1,float input2,out float outValue){
outValue=input1+input2;
}`,Hpe=`void node_add_matrix(mat4 matrixIn1,out mat4 matrixSum)
{
matrixSum=matrixIn1;
}
void node_add_matrix(mat4 matrixIn1,mat4 matrixIn2,out mat4 matrixSum)
{
matrixSum=matrixIn1+matrixIn2;
}
void node_add_matrix(mat4 matrixIn1,mat4 matrixIn2,mat4 matrixIn3,out mat4 matrixSum)
{
matrixSum=matrixIn1+matrixIn2+matrixIn3;
}`,Wpe=`#ifndef NODE_VALUE
uniform float nodeValue[NODE_VALUE_NUM];
#endif
void node_anim_curve_ta(float val,out float outVal)
{
outVal=val;
}`,jpe=`#ifndef NODE_VALUE
uniform float nodeValue[NODE_VALUE_NUM];
#endif
void node_anim_curve_tu(float val,out float outVal)
{
outVal=val;
}`,Qpe=`void node_blend_colors(float blender,vec3 color1,vec3 color2,out vec3 outColor)
{
blender=clamp(blender,0.0,1.0);
outColor=mix(color1,color2,1.0-blender);
}
void node_blend_colors(float blender,vec4 color1,vec4 color2,out vec4 outColor)
{
blender=clamp(blender,0.0,1.0);
outColor=mix(color1,color2,1.0-blender);
}`,$pe=`void node_blinn(vec3 geometryNormal,vec3 color,vec3 ambientColor,vec3 incandescence,float matteOpacity,float diffuse,vec3 normal,float reflectivity,vec3 reflectedColor,float eccentricity,vec3 specularColor,float specularRollOff,float translucence,vec3 transparency,out vec4 outColor){
NodeMaterial material;
material.diffuseColor=diffuse*color;
#ifdef USE_CLEARCOAT
#undef USE_CLEARCOAT
#define _CLEARCOAT_RESTORE
#endif
vec3 dxy=max(abs(dFdx(geometryNormal)),abs(dFdy(geometryNormal)));
float geometryRoughness=max(max(dxy.x,dxy.y),dxy.z);
material.roughness=max(eccentricity,0.0525);
material.roughness+=geometryRoughness;
material.roughness=min(material.roughness,1.0);
material.specularColor=specularColor;
ReflectedLight reflectedLight=ReflectedLight(vec3(0.0),vec3(0.0),vec3(0.0),vec3(0.0));
#define RE_Direct RE_Direct_Node
#define RE_IndirectDiffuse RE_IndirectDiffuse_Node
#define RE_IndirectSpecular RE_IndirectSpecular_Node
#include <lights_fragment_begin>
#include <lights_fragment_maps>
#include <lights_fragment_end>
#undef RE_Direct
#undef RE_IndirectDiffuse
#undef RE_IndirectSpecular
#ifdef _CLEARCOAT_RESTORE
#undef _CLEARCOAT_RESTORE
#define USE_CLEARCOAT
#endif
float alpha=1.0-average(transparency);
outColor=vec4(reflectedLight.directDiffuse+reflectedLight.indirectDiffuse +
reflectedLight.directSpecular+reflectedLight.indirectSpecular+incandescence,alpha);
}`,Ype=`void node_bulge(float uWidth,float vWidth,vec2 uvCoord,out float outAlpha,out vec3 outColor){
uvCoord=2.0*fract(uvCoord);
float bulge=0.0;
if (uvCoord.x>uWidth&&uvCoord.x<2.0-uWidth &&
uvCoord.y>vWidth&&uvCoord.y<2.0-vWidth){
uvCoord.x=(uvCoord.x-uWidth)/(1.0-uWidth);
uvCoord.y=(uvCoord.y-vWidth)/(1.0-vWidth);
bulge=uvCoord.x*(2.0-uvCoord.x)*uvCoord.y*(2.0-uvCoord.y);
}
outAlpha=bulge;
outColor=vec3(bulge,bulge,bulge);
}`,Xpe=`void node_bump_2d(vec3 normal,float bumpDepth,float bumpValue,out vec3 outNormal){
vec3 position=vViewPosition;
vec3 dPdx=dFdx(position);
vec3 dPdy=dFdy(position);
float dHdx=dFdx(bumpValue);
float dHdy=dFdy(bumpValue);
vec3 tanX=cross(dPdy,normal);
vec3 tanY=cross(normal,dPdx);
vec3 surfaceGrad=dHdx*tanX+dHdy*tanY;
float dotPosTanX=dot(dPdx,tanX);
outNormal=normalize(normal*abs(dotPosTanX)-surfaceGrad*sign(dotPosTanX));
outNormal=normalize(mix(normal,outNormal,max(0.0,bumpDepth)));
}
void node_bump_2d(vec3 normal,vec4 tangent,float bumpDepth,vec3 bumpValue,out vec3 outNormal){
#ifdef DOUBLE_SIDED
normal=normal*(float(gl_FrontFacing)*2.0-1.0);
#endif
if (length(tangent.xyz)==0.0)
tangent.x=1.0;
vec3 normalTex=(bumpValue.xyz*2.0-1.0);
vec4 viewTangent=vec4(normalize((modelViewMatrix*vec4(tangent.xyz,0.0)).xyz),tangent.w);
vec3 bitangent=viewTangent.w*cross(normal,viewTangent.xyz);
outNormal=normalize(normalTex.x*viewTangent.xyz+normalTex.y*bitangent
+ normalTex.z*normal);
outNormal=mix(normal,outNormal,bumpDepth);
}`,qpe=`void node_channels(int channelR,int channelG,int channelB,int channelA,float inAlpha,vec3 inColor,out float outAlpha,out vec3 outColor){
outAlpha=1.0;
outColor=vec3(1.0);
if (channelR==0)
outColor.r=inColor.r;
else if (channelR==1)
outColor.r=inColor.g;
else if (channelR==2)
outColor.r=inColor.b;
else
outColor.r=inAlpha;
if (channelG==0)
outColor.g=inColor.r;
else if (channelG==1)
outColor.g=inColor.g;
else if (channelG==2)
outColor.g=inColor.b;
else
outColor.g=inAlpha;
if (channelB==0)
outColor.b=inColor.r;
else if (channelB==1)
outColor.b=inColor.g;
else if (channelB==2)
outColor.b=inColor.b;
else
outColor.b=inAlpha;
if (channelA==0)
outAlpha=inColor.r;
else if (channelA==1)
outAlpha=inColor.g;
else if (channelA==2)
outAlpha=inColor.b;
else
outAlpha=inAlpha;
}`,Kpe=`void node_checker(vec3 color1,vec3 color2,float contrast,vec2 uvCoord,out float outAlpha,out vec3 outColor){
uvCoord-=floor(uvCoord);
vec3 deltaColor=color2-color1;
color1+=(1.0-contrast)*0.5*deltaColor;
color2-=(1.0-contrast)*0.5*deltaColor;
if ((uvCoord.x<0.5&&uvCoord.y>=0.5)||(uvCoord.x>=0.5&&uvCoord.y<0.5)){
outColor=color2;
outAlpha=1.0;
} else {
outColor=color1;
outAlpha=0.0;
}
}`,Zpe=`void node_clamp(vec3 inputValue,vec3 maxValue,vec3 minValue,out vec3 outputValue){
outputValue=clamp(inputValue,minValue,maxValue);
}`,Jpe=`void node_cloth(float brightSpread,vec3 gapColor,float randomness,vec3 uColor,float uWave,float uWidth,vec3 vColor,float vWave,float vWidth,float widthSpread,vec2 uvCoord,out float outAlpha,out vec3 outColor){
if (abs(uWave)>-EPSILON||abs(vWave)>-EPSILON){
uvCoord.x+=- uWave*sin(PI2*uvCoord.y);
uvCoord.y+=vWave*sin(PI2*uvCoord.x);
}
uvCoord=fract(uvCoord);
int thread=0;
if ((uvCoord.x>=0.5&&uvCoord.y<0.5)||(uvCoord.x<0.5&&uvCoord.y>=0.5)){
float flippedCoord;
flippedCoord=uvCoord.x;
uvCoord.x=uvCoord.y;
uvCoord.y=flippedCoord;
flippedCoord=uWidth;
uWidth=vWidth;
vWidth=flippedCoord;
thread=1;
}
uvCoord=fract(2.0*uvCoord);
float cloth=1.0;
if (uvCoord.y<=vWidth){
float clothU=uvCoord.x-0.5*uWidth;
float clothV=2.0*uvCoord.y/vWidth-1.0;
cloth=0.75*(clothU*clothU+clothV*clothV);
} else if (uvCoord.x<=uWidth){
float clothU=2.0*uvCoord.x/uWidth-1.0;
float clothV=uvCoord.y-0.5*vWidth-1.0;
cloth=0.75*(clothU*clothU+clothV*clothV);
thread=1-thread;
}
outColor=gapColor;
if (cloth<1.0){
cloth=1.0-cloth;
cloth=min(cloth,1.0);
outColor*=(1.0-cloth);
vec3 threadColor=uColor;
if (thread==0)
threadColor=vColor;
outColor+=threadColor*cloth;
}
outAlpha=dot(outColor,LUM_WEIGHTS_MAYA);
}`,eme=`void node_color_condition(float alphaA,float alphaB,vec3 colorA,vec3 colorB,bool condition,out float outAlpha,out vec3 outColor){
outAlpha=condition?alphaA:alphaB;
outColor=condition?colorA:colorB;
}`,tme=`void node_color_composite(int operation,vec3 colorA,float alphaA,vec3 colorB,float alphaB,float factor,out vec3 outColor,out float outAlpha)
{
if (factor<=0.0){
outColor=colorA;
outAlpha=alphaA;
return;
}
if (operation==0){
outColor[0]=colorA[0]+(colorB[0]*factor);
outColor[1]=colorA[1]+(colorB[1]*factor);
outColor[2]=colorA[2]+(colorB[2]*factor);
outAlpha=alphaA+(alphaB*factor);
} else if (operation==1){
outColor[0]=colorA[0]+((colorB[0]-1.0)*factor);
outColor[1]=colorA[1]+((colorB[1]-1.0)*factor);
outColor[2]=colorA[2]+((colorB[2]-1.0)*factor);
outAlpha=alphaA+((alphaB-1.0)*factor);
} else if (operation==2){
if (factor>=1.0){
outColor=colorB;
outAlpha=alphaB;
return;
}
outColor[0]=mix(colorA[0],colorB[0],factor);
outColor[1]=mix(colorA[1],colorB[1],factor);
outColor[2]=mix(colorA[2],colorB[2],factor);
outAlpha=mix(alphaA,alphaB,factor);
} else if (operation==3){
outColor[0]=colorA[0]*(colorB[0]*factor+(1.0-factor));
outColor[1]=colorA[1]*(colorB[1]*factor+(1.0-factor));
outColor[2]=colorA[2]*(colorB[2]*factor+(1.0-factor));
outAlpha=alphaA*(alphaB*factor+(1.0-factor));
} else if (operation==4){
outColor[0]=1.0-((1.0-colorA[0])*(1.0-colorB[0]*factor));
outColor[1]=1.0-((1.0-colorA[1])*(1.0-colorB[1]*factor));
outColor[2]=1.0-((1.0-colorA[2])*(1.0-colorB[2]*factor));
outAlpha=1.0-((1.0-alphaA)*(1.0-alphaB*factor));
} else if (operation==5){
outColor[0]=colorB[0]>0.5?(2.0*colorA[0]*colorB[0]*factor)+colorA[0]*(1.0-factor):
1.0-((1.0-colorA[0])*(1.0-colorB[0]*factor))*(2.0-(1.0-factor));
outColor[1]=colorB[1]>0.5?(2.0*colorA[1]*colorB[1]*factor)+colorA[1]*(1.0-factor):
1.0-((1.0-colorA[1])*(1.0-colorB[1]*factor))*(2.0-(1.0-factor));
outColor[2]=colorB[2]>0.5?(2.0*colorA[2]*colorB[2]*factor)+colorA[2]*(1.0-factor):
1.0-((1.0-colorA[2])*(1.0-colorB[2]*factor))*(2.0-(1.0-factor));
outAlpha=alphaB>0.5?(2.0*alphaA*alphaB*factor)+alphaA*(1.0-factor):
1.0-((1.0-alphaA)*(1.0-alphaB*factor))*(2.0-(1.0-factor));
} else if (operation==6){
outColor[0]=abs(colorA[0]-(colorB[0]*factor));
outColor[1]=abs(colorA[1]-(colorB[1]*factor));
outColor[2]=abs(colorA[2]-(colorB[2]*factor));
outAlpha=abs(alphaA-(alphaB*factor));
} else if (operation==7){
outColor[0]=clamp(mix(colorA[0],colorA[0]/max(1.0-colorB[0],0.00001),factor),colorA[0],colorB[0]);
outColor[1]=clamp(mix(colorA[1],colorA[1]/max(1.0-colorB[1],0.00001),factor),colorA[1],colorB[1]);
outColor[2]=clamp(mix(colorA[2],colorA[2]/max(1.0-colorB[2],0.00001),factor),colorA[2],colorB[2]);
outAlpha=clamp(mix(alphaA,alphaA/max(1.0-alphaB,0.00001),factor),alphaA,alphaB);
} else if (operation==8){
outColor[0]=clamp(mix(colorA[0],1.0-(colorA[0]/max(1.0-colorB[0],0.00001)),factor),colorA[0],colorB[0]);
outColor[1]=clamp(mix(colorA[1],1.0-(colorA[1]/max(1.0-colorB[1],0.00001)),factor),colorA[1],colorB[1]);
outColor[2]=clamp(mix(colorA[2],1.0-(colorA[2]/max(1.0-colorB[2],0.00001)),factor),colorA[2],colorB[2]);
outAlpha=clamp(mix(alphaA,1.0-(alphaA/max(1.0-alphaB,0.00001)),factor),alphaA,alphaB);
}
}`,nme=`void node_color_constant(vec3 inColor,float inAlpha,out vec3 outColor,out float outAlpha)
{
outColor=inColor;
outAlpha=inAlpha;
}`,rme=`void node_color_correct(bool colClamp,vec3 colClampMin,vec3 colClampMax,bool alphaClamp,float alphaClampMin,float alphaClampMax,bool unpremultInput,bool premultResult,float alphaGain,float alphaGamma,float alphaOffset,vec3 colGain,vec3 colGamma,vec3 colOffset,float hueShift,float inAlpha,vec3 inColor,float satGain,float valGain,out float outAlpha,out vec3 outColor)
{
outColor=unpremultInput?inColor/inAlpha:inColor;
if (hueShift != 0.0||satGain != 1.0||valGain != 1.0){
vec4 color=vec4(outColor,1.0);
rgbToHSV(vec4(inColor,1.0),color);
color.r+=hueShift/360.0;
if (color.r>1.0)
color.r-=1.0;
else if (color.r<0.0)
color.r+=1.0;
color.g*=satGain;
color.b*=valGain;
hsvToRGB(color,color);
outColor=color.rgb;
}
outColor*=colGain;
outColor+=colOffset;
if (any(notEqual(colGamma,vec3(1.0))))
outColor=pow(outColor,1.0/colGamma);
if (colClamp)
outColor=clamp(outColor,colClampMin,colClampMax);
outAlpha=inAlpha*alphaGain;
outAlpha+=alphaOffset;
if (alphaGamma != 1.0)
outAlpha=pow(outAlpha,1.0/alphaGamma);
if (alphaClamp)
outAlpha=clamp(outAlpha,alphaClampMin,alphaClampMax);
if (premultResult)
outColor*=outAlpha;
}`,ome=`void node_color_logic(int operation,vec3 colorA,vec3 colorB,out bool outBool){
if (operation==0){
outBool=all(equal(colorA,colorB));
} else if (operation==1){
outBool=any(notEqual(colorA,colorB));
} else if (operation==2){
outBool=((colorA.x+colorA.y+colorA.z)<(colorB.x+colorB.y+colorB.z));
} else if (operation==3){
outBool=((colorA.x+colorA.y+colorA.z)>(colorB.x+colorB.y+colorB.z));
} else if (operation==4){
outBool=((colorA.x+colorA.y+colorA.z)<=(colorB.x+colorB.y+colorB.z));
} else {
outBool=((colorA.x+colorA.y+colorA.z)>=(colorB.x+colorB.y+colorB.z));
}
}`,ime=`void node_color_mask(bool maskAlphaIsLuminance,float inAlpha,vec3 inColor,vec3 mask,float maskAlpha,out float outAlpha,out vec3 outColor){
if (maskAlphaIsLuminance)
maskAlpha=1.0-dot(mask,LUM_WEIGHTS_MAYA);
outColor=inColor*(1.0-maskAlpha);
}`,ame=`void node_color_math(int operation,float alphaA,float alphaB,vec3 colorA,vec3 colorB,out float outAlpha,out vec3 outColor){
if (operation==0){
outColor=colorA+colorB;
outAlpha=alphaA+alphaB;
} else if (operation==1){
outColor=colorA-colorB;
outAlpha=alphaA-alphaB;
} else if (operation==2){
outColor=colorA*colorB;
outAlpha=alphaA*alphaB;
} else if (operation==3){
outColor=colorA/colorB;
outAlpha=alphaA/alphaB;
} else if (operation==4){
outColor=min(colorA,colorB);
outAlpha=min(alphaA,alphaB);
} else {
outColor=max(colorA,colorB);
outAlpha=max(alphaA,alphaB);
}
}`,sme=`mat3 quatToMat3(vec4 quat){
float x=quat.x,y=quat.y,z=quat.z,w=quat.w;
float x2=x+x;
float y2=y+y;
float z2=z+z;

float xx=x*x2;
float yx=y*x2;
float yy=y*y2;
float zx=z*x2;
float zy=z*y2;
float zz=z*z2;
float wx=w*x2;
float wy=w*y2;
float wz=w*z2;

mat3 mat;

mat[0][0]=1.0-yy-zz;
mat[1][0]=yx-wz;
mat[2][0]=zx+wy;

mat[0][1]=yx+wz;
mat[1][1]=1.0-xx-zz;
mat[2][1]=zy-wx;

mat[0][2]=zx-wy;
mat[1][2]=zy+wx;
mat[2][2]=1.0-xx-yy;
return mat;
}
void node_compose_matrix(bool useEulerRotation,int inputRotateOrder,vec4 inputQuat,vec3 inputRotate,vec3 inputScale,vec3 inputShear,vec3 inputTranslate,out mat4 outputMatrix)
{
mat4 rotateMatrix;
inputRotate=radians(inputRotate);
if (useEulerRotation)
rotateMatrix=toMat4(mat3RotateX(inputRotate.x)*mat3RotateY(inputRotate.y)*mat3RotateZ(inputRotate.z));
else
rotateMatrix=toMat4(quatToMat3(normalize(inputQuat)));
mat4 scaleMatrix=mat4(inputScale.x,0.0,0.0,0.0,0.0,inputScale.y,0.0,0.0,0.0,0.0,inputScale.z,0.0,0.0,0.0,0.0,1.0);
mat4 shearMatrix=mat4(1.0,0.0,0.0,0.0,inputShear.x,1.0,0.0,0.0,inputShear.y,inputShear.z,1.0,0.0,0.0,0.0,0.0,1.0);
mat4 transMatrix=mat4(1.0,0.0,0.0,0.0,0.0,1.0,0.0,0.0,0.0,0.0,1.0,0.0,inputTranslate.x,inputTranslate.y,inputTranslate.z,1.0);
outputMatrix=scaleMatrix*shearMatrix*rotateMatrix*transMatrix;
}`,lme=`void node_condition(int operation,vec3 colorIfFalse,vec3 colorIfTrue,float firstTerm,float secondTerm,out vec3 outColor){
if (operation==0){
if (firstTerm==secondTerm)
outColor=colorIfTrue;
else
outColor=colorIfFalse;
} else if (operation==1){
if (firstTerm != secondTerm)
outColor=colorIfTrue;
else
outColor=colorIfFalse;
} else if (operation==2){
if (firstTerm>secondTerm)
outColor=colorIfTrue;
else
outColor=colorIfFalse;
} else if (operation==3){
if (firstTerm>=secondTerm)
outColor=colorIfTrue;
else
outColor=colorIfFalse;
} else if (operation==4){
if (firstTerm<secondTerm)
outColor=colorIfTrue;
else
outColor=colorIfFalse;
} else if (operation==5){
if (firstTerm<=secondTerm)
outColor=colorIfTrue;
else
outColor=colorIfFalse;
}
}`,cme=`vec4 mat3ToQuat(mat3 m){
float trace=m[0][0]+m[1][1]+m[2][2];
vec4 q=vec4(0.0,0.0,0.0,0.0);
if (trace>0.0){
float s=sqrt(trace+1.0)*2.0;
q.w=0.25*s;
q.x=(m[2][1]-m[1][2])/s;
q.y=(m[0][2]-m[2][0])/s;
q.z=(m[1][0]-m[0][1])/s;
} else if ((m[0][0]>m[1][1])&&(m[0][0]>m[2][2])){
float s=sqrt(1.0+m[0][0]-m[1][1]-m[2][2])*2.0;
q.w=(m[2][1]-m[1][2])/s;
q.x=0.25*s;
q.y=(m[0][1]+m[1][0])/s;
q.z=(m[0][2]+m[2][0])/s;
} else if (m[1][1]>m[2][2]){
float s=sqrt(1.0+m[1][1]-m[0][0]-m[2][2])*2.0;
q.w=(m[0][2]-m[2][0])/s;
q.x=(m[0][1]+m[1][0])/s;
q.y=0.25*s;
q.z=(m[1][2]+m[2][1])/s;
} else {
float s=sqrt(1.0+m[2][2]-m[0][0]-m[1][1])*2.0;
q.w=(m[1][0]-m[0][1])/s;
q.x=(m[0][2]+m[2][0])/s;
q.y=(m[1][2]+m[2][1])/s;
q.z=0.25*s;
}
return q;
}
vec3 mat3ToEuler(mat3 m){
float m11=m[0][0],m12=m[1][0],m13=m[2][0];
float m21=m[0][1],m22=m[1][1],m23=m[2][1];
float m31=m[0][2],m32=m[1][2],m33=m[2][2];
vec3 euler;
euler.y=asin(clamp(m13,-1.0,1.0));
if (abs(m13)<0.9999999){
euler.x=atan(-m23,m33);
euler.z=atan(-m12,m11);
} else {
euler.x=atan(m32,m22);
euler.z=0.0;
}
return euler;
}
void decomposeMat4(mat4 m,out vec3 position,out vec4 quat,out vec3 euler,out vec3 scale){
float sx=length(vec3(m[0][0],m[0][1],m[0][2]));
float sy=length(vec3(m[1][0],m[1][1],m[1][2]));
float sz=length(vec3(m[2][0],m[2][1],m[2][2]));
float det=mat3GetDeterminant(toMat3(m));
if (det<0.0)
sx=-sx;
position.x=m[3][0];
position.y=m[3][1];
position.z=m[3][2];
float invSX=1.0/sx;
float invSY=1.0/sy;
float invSZ=1.0/sz;
m[0][0]*=invSX;
m[0][1]*=invSX;
m[0][2]*=invSX;
m[1][0]*=invSY;
m[1][1]*=invSY;
m[1][2]*=invSY;
m[2][0]*=invSZ;
m[2][1]*=invSZ;
m[2][2]*=invSZ;
quat=mat3ToQuat(toMat3(m));
euler=mat3ToEuler(toMat3(m));
scale.x=sx;
scale.y=sy;
scale.z=sz;
}
void node_decompose_matrix(mat4 inputMatrix,out vec4 outputQuat,out vec3 outputRotate,out vec3 outputScale,out vec3 outputShear,out vec3 outputTranslate)
{
decomposeMat4(inputMatrix,outputTranslate,outputQuat,outputRotate,outputScale);
outputShear=vec3(0.0,0.0,0.0);
}`,ume=`void node_env_sphere(sampler2D envMap,int encoding,vec3 normal,mat4 placementMatrix,out float outAlpha,out vec3 outColor)
{
vec3 cameraToVertex=normalize(vWorldPosition-cameraPosition);
vec3 reflectVec;
#if WORLD_NODES
reflectVec=normalize(cameraToVertex);
#else
vec3 worldNormal=inverseTransformDirection(normal,viewMatrix);
reflectVec=reflect(cameraToVertex,worldNormal);
#endif
mat3 uvTransform=mat3(1.0);
reflectVec=toMat3(placementMatrix)*reflectVec;
vec4 tex=sampleEquirectangular(envMap,reflectVec,uvTransform,encoding);
outAlpha=tex.a;
outColor=tex.rgb;
}`,dme=`void node_file(sampler2D ima,const int encoding,const bool rgbToAlpha,vec2 uvCoord,out float outAlpha,out vec3 outColor,out vec2 outSize,out vec3 outTransparency){
vec2 uv=vec2(uvCoord.x,1.0-uvCoord.y);
vec4 tex=texture2D(ima,uv);
outColor=nodeTexelToLinear(tex,encoding).rgb;
if (rgbToAlpha)
outAlpha=dot(tex.rgb,LUM_WEIGHTS_MAYA);
else
outAlpha=tex.a;
outSize=vec2(0.0);
outTransparency=vec3(1.0-outAlpha,1.0-outAlpha,1.0-outAlpha);
}`,fme=`void node_float_condition(bool condition,float floatA,float floatB,out float outFloat){
outFloat=condition?floatA:floatB;
}`,hme=`void node_float_composite(int operation,float floatA,float floatB,float factor,out float outFloat)
{
if (factor<=0.0){
outFloat=floatA;
return;
}
if (operation==0){
outFloat=floatA+(floatB*factor);
} else if (operation==1){
outFloat=floatA+((floatB-1.0)*factor);
} else if (operation==2){
if (factor>=1.0){
outFloat=floatB;
return;
}
outFloat=mix(floatA,floatB,factor);
} else if (operation==3){
outFloat=floatA*(floatB*factor+(1.0-factor));
} else if (operation==4){
outFloat=1.0-((1.0-floatA)*(1.0-floatB*factor));
} else if (operation==5){
outFloat=floatB>0.5?(2.0*floatA*floatB*factor)+floatA*(1.0-factor):
1.0-((1.0-floatA)*(1.0-floatB*factor))*(2.0-(1.0-factor));
} else if (operation==6){
outFloat=abs(floatA-(floatB*factor));
} else if (operation==7){
outFloat=clamp(mix(floatA,floatA/max(1.0-floatB,0.00001),factor),floatA,floatB);
} else if (operation==8){
outFloat=clamp(mix(floatA,1.0-(floatA/max(1.0-floatB,0.00001)),factor),floatA,floatB);
}
}`,pme=`void node_float_constant(float value,out float outValue)
{
outValue=value;
}`,mme=`void node_float_logic(int operation,float floatA,float floatB,out bool outBool){
if (operation==0){
outBool=(floatA==floatB);
} else if (operation==1){
outBool=(floatA != floatB);
} else if (operation==2){
outBool=(floatA<floatB);
} else if (operation==3){
outBool=(floatA>floatB);
} else if (operation==4){
outBool=(floatA<=floatB);
} else {
outBool=(floatA>=floatB);
}
}`,gme=`void node_float_mask(float inFloat,float mask,out float outFloat){
outFloat=inFloat-mask;
}`,_me=`void node_float_math(int operation,float floatA,float floatB,out float outFloat){
if (operation==0){
outFloat=floatA+floatB;
} else if (operation==1){
outFloat=floatA-floatB;
} else if (operation==2){
outFloat=floatA*floatB;
} else if (operation==3){
outFloat=floatA/floatB;
} else if (operation==4){
outFloat=min(floatA,floatB);
} else if (operation==5){
outFloat=max(floatA,floatB);
} else {
outFloat=pow(floatA,floatB);
}
}`,vme=`void node_four_by_four_matrix(float in00,float in01,float in02,float in03,float in10,float in11,float in12,float in13,float in20,float in21,float in22,float in23,float in30,float in31,float in32,float in33,out mat4 outMatrix)
{
outMatrix=mat4(in00,in01,in02,in03,in10,in11,in12,in13,in20,in21,in22,in23,in30,in31,in32,in33);
}`,Ame=`void node_gamma_correct(vec3 gamma,vec3 value,out vec3 outValue){
outValue=pow(value,1.0/gamma);
}`,yme=`void node_grid(float contrast,vec3 fillerColor,vec3 lineColor,float uWidth,float vWidth,vec2 uvCoord,out float outAlpha,out vec3 outColor){
uvCoord=fract(uvCoord);
float v0=max(uvCoord.y,0.5*vWidth);
float v1=min(uvCoord.y,1.0-0.5*vWidth);
float u0=max(uvCoord.x,0.5*uWidth);
float u1=min(uvCoord.x,1.0-0.5*uWidth);
float gridFactor=(v0<=v1&&u0<=u1)?1.0:0.0;
gridFactor=0.5-contrast*(gridFactor-0.5);
gridFactor=max(gridFactor,0.0);
vec3 gridColor=mix(fillerColor,lineColor,gridFactor);
gridColor.r=max(gridColor.r,0.0);
gridColor.g=max(gridColor.g,0.0);
gridColor.b=max(gridColor.b,0.0);
outAlpha=saturate(gridFactor);
outColor=gridColor;
}`,bme=`
mat4 inverseMat4(mat4 m){
float a00=m[0][0],a01=m[0][1],a02=m[0][2],a03=m[0][3],a10=m[1][0],a11=m[1][1],a12=m[1][2],a13=m[1][3],a20=m[2][0],a21=m[2][1],a22=m[2][2],a23=m[2][3],a30=m[3][0],a31=m[3][1],a32=m[3][2],a33=m[3][3];
float b00=a00*a11-a01*a10,b01=a00*a12-a02*a10,b02=a00*a13-a03*a10,b03=a01*a12-a02*a11,b04=a01*a13-a03*a11,b05=a02*a13-a03*a12,b06=a20*a31-a21*a30,b07=a20*a32-a22*a30,b08=a20*a33-a23*a30,b09=a21*a32-a22*a31,b10=a21*a33-a23*a31,b11=a22*a33-a23*a32;
float det=b00*b11-b01*b10+b02*b09+b03*b08-b04*b07+b05*b06;
return mat4(a11*b11-a12*b10+a13*b09,a02*b10-a01*b11-a03*b09,a31*b05-a32*b04+a33*b03,a22*b04-a21*b05-a23*b03,a12*b08-a10*b11-a13*b07,a00*b11-a02*b08+a03*b07,a32*b02-a30*b05-a33*b01,a20*b05-a22*b02+a23*b01,a10*b10-a11*b08+a13*b06,a01*b08-a00*b10-a03*b06,a30*b04-a31*b02+a33*b00,a21*b02-a20*b04-a23*b00,a11*b07-a10*b09-a12*b06,a00*b09-a01*b07+a02*b06,a31*b01-a30*b03-a32*b00,a20*b03-a21*b01+a22*b00)/det;
}
void node_inverse_matrix(mat4 inputMatrix,out mat4 outputMatrix)
{
outputMatrix=inverseMat4(inputMatrix);
}`,xme=`void node_lambert(vec3 geometryNormal,vec3 color,vec3 ambientColor,vec3 incandescence,float matteOpacity,float diffuse,vec3 normal,float translucence,vec3 transparency,out vec4 outColor){
NodeMaterial material;
material.diffuseColor=diffuse*color.rgb;
ReflectedLight reflectedLight=ReflectedLight(vec3(0.0),vec3(0.0),vec3(0.0),vec3(0.0));
#ifdef USE_CLEARCOAT
#undef USE_CLEARCOAT
#define _CLEARCOAT_RESTORE
#endif
#define RE_Direct RE_DirectDiffuseOnly_Node
#define RE_IndirectDiffuse RE_IndirectDiffuse_Node
#include <lights_fragment_begin>
#include <lights_fragment_maps>
#include <lights_fragment_end>
#undef RE_Direct
#undef RE_IndirectDiffuse
#ifdef _CLEARCOAT_RESTORE
#undef _CLEARCOAT_RESTORE
#define USE_CLEARCOAT
#endif
float alpha=1.0-average(transparency);
outColor=vec4(reflectedLight.directDiffuse+reflectedLight.indirectDiffuse+incandescence,alpha);
}`,Eme=`#define LAYER_BLEND_MODE_NONE 0.0
#define LAYER_BLEND_MODE_OVER 1.0
#define LAYER_BLEND_MODE_IN 2.0
#define LAYER_BLEND_MODE_OUT 3.0
#define LAYER_BLEND_MODE_ADD 4.0
#define LAYER_BLEND_MODE_SUBTRACT 5.0
#define LAYER_BLEND_MODE_MULTIPLY 6.0
#define LAYER_BLEND_MODE_DIFFERENCE 7.0
#define LAYER_BLEND_MODE_LIGHTEN 8.0
#define LAYER_BLEND_MODE_DARKEN 9.0
#define LAYER_BLEND_MODE_SATURATE 10.0
#define LAYER_BLEND_MODE_DESATURATE 11.0
#define LAYER_BLEND_MODE_ILLUMINATE 12.0
void node_layered_texture_layer(const float alphaBG,const vec3 colorBG,const vec3 color,const float alpha,const float blendMode,const bool isVisible,out float outAlpha,out vec3 outColor)
{
outAlpha=alphaBG;
outColor=colorBG;
if (!isVisible)
return;
if (blendMode==LAYER_BLEND_MODE_NONE){
outColor=color;
} else if (blendMode==LAYER_BLEND_MODE_OVER){
outColor=mix(colorBG,color,alpha);
} else if (blendMode==LAYER_BLEND_MODE_IN){
outColor=alpha*colorBG;
} else if (blendMode==LAYER_BLEND_MODE_OUT){
outColor=(1.0-alpha)*colorBG;
} else if (blendMode==LAYER_BLEND_MODE_ADD){
outColor=mix(colorBG,colorBG+color,alpha);
} else if (blendMode==LAYER_BLEND_MODE_SUBTRACT){
outColor=mix(colorBG,colorBG-color,alpha);
} else if (blendMode==LAYER_BLEND_MODE_MULTIPLY){
outColor=mix(colorBG,colorBG*color,alpha);
} else {
outColor=mix(colorBG,color,alpha);
}
}`,Cme=`void node_luminance(vec3 value,out float outValue){
outValue=dot(value,LUM_WEIGHTS_MAYA);
}`,Sme=`void node_multiply_divide(int operation,vec3 input1,vec3 input2,out vec3 outValue){
if (operation==0){
outValue=input1;
} else if (operation==1){
outValue=input1*input2;
} else if (operation==2){

outValue=input1/input2;
} else {
outValue=pow(input1,input2);
}
}`,wme=`void node_mult_double_linear(float input1,float input2,out float outValue){
outValue=input1*input2;
}`,Mme=`
void node_mult_matrix(mat4 matrixIn1,out mat4 matrixSum)
{
matrixSum=matrixIn1;
}
void node_mult_matrix(mat4 matrixIn1,mat4 matrixIn2,out mat4 matrixSum)
{
matrixSum=matrixIn2*matrixIn1;
}
void node_mult_matrix(mat4 matrixIn1,mat4 matrixIn2,mat4 matrixIn3,out mat4 matrixSum)
{
matrixSum=matrixIn3*matrixIn2*matrixIn1;
}`,Tme=`vec2 calcNoiseImplode(float implode,vec2 implodeCenter,vec2 uv){
if (abs(implode)>=EPSILON){
uv-=implodeCenter;
float len=length(uv);
if (len>EPSILON){
float factor=pow(len,1.0-implode)/len;
uv*=factor;
}
uv+=implodeCenter;
}
return uv;
}
void node_noise(float amplitude,int depthMax,float frequency,float frequencyRatio,float implode,vec2 implodeCenter,bool inflection,float ratio,float threshold,float time,vec2 uvCoord,out float outAlpha,out vec3 outColor){
uvCoord=calcNoiseImplode(implode,implodeCenter,uvCoord);
frequency*=0.6;
amplitude*=0.9;
uvCoord*=frequency;
float noiseAccum=0.0;
vec2 freqOffset=vec2(0.02,0.3);
#if __VERSION__==300
for (int depthId=0;depthId<depthMax;depthId++){
#else
for (int depthId=0;depthId<3;depthId++){
#endif
int stepVal=depthId;
float noise=noisePerlin(vec3(uvCoord+freqOffset,time+0.5*float(stepVal)));
if (inflection)
noise=abs(noise);
noiseAccum+=amplitude*noise;
uvCoord*=frequencyRatio;
time*=sqrt(frequencyRatio);
amplitude*=ratio;
freqOffset+=vec2(0.02,0.3);
}
if (!inflection)
noiseAccum=0.5*noiseAccum+0.5;
noiseAccum+=threshold;
outAlpha=min(1.0,noiseAccum);
outColor=vec3(outAlpha,outAlpha,outAlpha);
}`,Ime=`void node_openpbr_surface(vec3 geometryNormal,const bool thinWalled,const float baseWeight,const vec3 baseColor,const float baseDiffuseRoughness,const float baseMetalness,const float specularWeight,const vec3 specularColor,const float specularRoughness,const float specularIOR,const float transmissionWeight,const vec3 transmissionColor,const float transmissionDepth,const vec3 transmissionScatter,const float fuzzWeight,const vec3 fuzzColor,const float fuzzRoughness,const float coatWeight,const vec3 coatColor,const float coatRoughness,const float emissionLuminance,const vec3 emissionColor,const float geometryOpacity,const vec3 normal,out vec4 outColor)
{
NodeMaterial material;
vec3 baseColorWeighted=baseWeight*baseColor.rgb;
material.diffuseColor=baseColorWeighted*(1.0-baseMetalness)*(1.0-transmissionWeight);
vec3 clearcoatNormal=normal;
#ifdef USE_CLEARCOAT
material.clearcoat=saturate(coatWeight);
material.clearcoatRoughness=clamp(coatRoughness,0.0,1.0);
material.clearcoatF0=vec3(0.04);
material.clearcoatF90=1.0;
#endif
#ifdef USE_SHEEN
material.sheenColor=saturate(fuzzWeight*fuzzColor);
material.sheenRoughness=clamp(fuzzRoughness,0.0,1.0);
#endif
vec3 dxy=max(abs(dFdx(geometryNormal)),abs(dFdy(geometryNormal)));
float geometryRoughness=max(max(dxy.x,dxy.y),dxy.z);
material.roughness=max(specularRoughness,0.0525);
material.roughness+=geometryRoughness;
material.roughness=min(material.roughness,1.0);
vec3 specularColorWeighted=specularWeight*specularColor;
vec3 dielRefl=pow2((1.0-specularIOR)/(1.0+specularIOR))*specularColorWeighted;
material.specularColor=mix(dielRefl,baseColorWeighted,baseMetalness);
material.fresnelRefl90=mix(specularColorWeighted,vec3(1.0),baseMetalness);
material.specularF90=average(material.fresnelRefl90);
material.refractionColor=pow(transmissionWeight*(1.0-baseMetalness)*transmissionColor.rgb,vec3(2.0));
material.refractionIOR=specularIOR;
material.refractionRoughness=material.roughness;
ReflectedLight reflectedLight=ReflectedLight(vec3(0.0),vec3(0.0),vec3(0.0),vec3(0.0));
vec3 refractedLight=vec3(0.0);
#ifdef USE_GTAO
vec4 gtaoVisibilityBentNormal=texture2D(gtaoMap,gl_FragCoord.xy/currResolution);
vec3 bentNormal=normalize(unpackRGBToNormal(gtaoVisibilityBentNormal.gba));
#define PROBE_NORMAL bentNormal
#endif
#define RE_Direct RE_Direct_Node
#define RE_IndirectDiffuse RE_IndirectDiffuse_Node
#define RE_IndirectSpecular RE_IndirectSpecular_Node
#define RE_Refraction RE_Refraction_Node
#include <lights_fragment_begin>
#include <lights_fragment_maps>
#include <lights_fragment_end>
#undef RE_Direct
#undef RE_IndirectDiffuse
#undef RE_IndirectSpecular
#undef RE_Refraction
#ifdef PROBE_NORMAL
#undef PROBE_NORMAL
#endif
#ifdef USE_GTAO
reflectedLight.indirectDiffuse*=gtaoVisibilityBentNormal.r;
float gtaoVisibility=gtaoVisibilityBentNormal.r;
vec3 gtaoBentNormal=bentNormal;
vec3 gtaoViewDir=geometry.viewDir;
vec3 gtaoNormal=normal;
float gtaoRoughness=material.roughness;
#endif
#include <lights_fragment_gtso>
vec3 totalEmissiveRadiance=emissionLuminance*OPENPBR_EMISSION_LUM_FACTOR*emissionColor;
vec3 outSpecular=reflectedLight.directSpecular+reflectedLight.indirectSpecular;
vec3 outColor3=reflectedLight.directDiffuse+reflectedLight.indirectDiffuse +
outSpecular+totalEmissiveRadiance;
#ifdef USE_SHEEN
float sheenEnergyComp=1.0-0.157*max3(material.sheenColor);
outColor3=outColor3*sheenEnergyComp+sheenSpecular;
#endif
#ifdef USE_CLEARCOAT
float dotNVcc=saturate(dot(geometry.normal,geometry.viewDir));
vec3 Fcc=F_Schlick(material.clearcoatF0,material.clearcoatF90,dotNVcc);
outColor3=outColor3*(1.0-material.clearcoat*Fcc)+clearcoatSpecular*material.clearcoat;
#endif
float alpha=1.0;
if (thinWalled){
alpha=geometryOpacity*(1.0-saturate(transmissionWeight)+maxFromRGB(outSpecular)*saturate(transmissionWeight));
} else {
outColor3+=refractedLight;
}
outColor=vec4(outColor3,saturate(alpha));
}`,Rme=`void node_output(vec4 rgb,out vec4 outgoingLight)
{
outgoingLight=rgb;
}`,Lme=`void node_phong(vec3 geometryNormal,vec3 color,vec3 ambientColor,vec3 incandescence,float matteOpacity,float diffuse,vec3 normal,float reflectivity,vec3 reflectedColor,float cosinePower,vec3 specularColor,float translucence,vec3 transparency,out vec4 outColor){
NodeMaterial material;
material.diffuseColor=diffuse*color;
#ifdef USE_CLEARCOAT
#undef USE_CLEARCOAT
#define _CLEARCOAT_RESTORE
#endif
vec3 dxy=max(abs(dFdx(geometryNormal)),abs(dFdy(geometryNormal)));
float geometryRoughness=max(max(dxy.x,dxy.y),dxy.z);
float roughness=sqrt(1.0/(0.454*cosinePower+3.357));
material.roughness=max(roughness,0.0525);
material.roughness+=geometryRoughness;
material.roughness=min(material.roughness,1.0);
material.specularColor=specularColor;
ReflectedLight reflectedLight=ReflectedLight(vec3(0.0),vec3(0.0),vec3(0.0),vec3(0.0));
#define RE_Direct RE_Direct_Node
#define RE_IndirectDiffuse RE_IndirectDiffuse_Node
#define RE_IndirectSpecular RE_IndirectSpecular_Node
#include <lights_fragment_begin>
#include <lights_fragment_maps>
#include <lights_fragment_end>
#undef RE_Direct
#undef RE_IndirectDiffuse
#undef RE_IndirectSpecular
#ifdef _CLEARCOAT_RESTORE
#undef _CLEARCOAT_RESTORE
#define USE_CLEARCOAT
#endif
float alpha=1.0-average(transparency);
outColor=vec4(reflectedLight.directDiffuse+reflectedLight.indirectDiffuse +
reflectedLight.directSpecular+reflectedLight.indirectSpecular+incandescence,alpha);
}`,Pme=`void node_phong_e(vec3 geometryNormal,vec3 color,vec3 ambientColor,vec3 incandescence,float matteOpacity,float diffuse,vec3 normal,float reflectivity,vec3 reflectedColor,float highlightSize,float roughness,vec3 specularColor,float translucence,vec3 transparency,out vec4 outColor){
NodeMaterial material;
material.diffuseColor=diffuse*color;
#ifdef USE_CLEARCOAT
#undef USE_CLEARCOAT
#define _CLEARCOAT_RESTORE
#endif
vec3 dxy=max(abs(dFdx(geometryNormal)),abs(dFdy(geometryNormal)));
float geometryRoughness=max(max(dxy.x,dxy.y),dxy.z);
material.roughness=max(roughness,0.0525);
material.roughness+=geometryRoughness;
material.roughness=min(material.roughness,1.0);
material.specularColor=specularColor;
ReflectedLight reflectedLight=ReflectedLight(vec3(0.0),vec3(0.0),vec3(0.0),vec3(0.0));
#define RE_Direct RE_Direct_Node
#define RE_IndirectDiffuse RE_IndirectDiffuse_Node
#define RE_IndirectSpecular RE_IndirectSpecular_Node
#include <lights_fragment_begin>
#include <lights_fragment_maps>
#include <lights_fragment_end>
#undef RE_Direct
#undef RE_IndirectDiffuse
#undef RE_IndirectSpecular
#ifdef _CLEARCOAT_RESTORE
#undef _CLEARCOAT_RESTORE
#define USE_CLEARCOAT
#endif
float alpha=1.0-average(transparency);
outColor=vec4(reflectedLight.directDiffuse+reflectedLight.indirectDiffuse +
reflectedLight.directSpecular+reflectedLight.indirectSpecular+incandescence,alpha);
}`,Dme=`void node_place_2d_texture(const vec2 inUv,vec2 offset,vec2 repeatUv,float rotateUv,out vec2 outUv)
{
outUv=(calcUvTransform(offset.x,offset.y,repeatUv.x,repeatUv.y,rotateUv)*vec3(inUv,1.0)).xy;
outUv.y=1.0-outUv.y;
}`,Bme=`void node_premultiply(float inAlpha,vec3 inColor,out float outAlpha,out vec3 outColor){
outColor=inColor*inAlpha;
outAlpha=inAlpha;
}`,Nme=`#define RAMP_WRAP_REPEAT 1000
#define RAMP_WRAP_CLAMP_TO_EDGE 1001
#define RAMP_WRAP_MIRROR 1002
float applyWrap(float coord,int wrap){
if (coord<0.0||coord>1.0){
if (wrap==RAMP_WRAP_REPEAT)
coord=mod(coord,1.0);
else if (wrap==RAMP_WRAP_CLAMP_TO_EDGE)
coord=clamp(coord,0.0,1.0);
else if (wrap==RAMP_WRAP_MIRROR){
if (mod(floor(coord),2.0)==0.0)
coord=coord-floor(coord);
else
coord=1.0-(coord-floor(coord));
}
}
return coord;
}
void node_ramp(sampler2D rampData,int rampType,int wrapU,int wrapV,vec2 uvCoord,out float outAlpha,out vec3 outColor)
{
uvCoord.x=applyWrap(uvCoord.x,wrapU);
uvCoord.y=applyWrap(uvCoord.y,wrapV);
float coord;
if (rampType==0){
coord=uvCoord.y;
} else if (rampType==1){
coord=uvCoord.x;
} else if (rampType==2){
coord=abs(uvCoord.x+uvCoord.y)/2.0;
} else if (rampType==3){
vec2 uvSpiral=mat2(0.0,1.0,1.0,0.0)*(uvCoord-vec2(0.5));
coord=atan(uvSpiral.y,uvSpiral.x)/PI2+0.5;
} else if (rampType==4){
coord=length(uvCoord-vec2(0.5))*sqrt(2.0);
} else if (rampType==5){
vec2 boxUv=abs(uvCoord-vec2(0.5))*2.0;
coord=max(boxUv.x,boxUv.y);
} else if (rampType==6){
uvCoord=abs((uvCoord-vec2(0.5))*2.0);
coord=uvCoord.y;
} else if (rampType==7){
coord=uvCoord.y;
} else {
coord=uvCoord.y;
}
float offset=0.5/float(RAMP_TEX_SIZE);
float scale=1.0-(1.0/float(RAMP_TEX_SIZE));
coord=coord*scale+offset;
vec4 tex=texture2D(rampData,vec2(coord,0.0));
outAlpha=average(tex.xyz);
outColor=tex.xyz;
}`,Ome=`void node_remap_hsv(vec3 color,out vec3 outColor)
{
outColor=color;
}`,kme=`void node_reverse(vec3 inValue,out vec3 outValue){
outValue=1.0-inValue;
}`,Fme=`void node_sampler_info(float frontFacing,vec4 tangent,vec2 uv,vec3 viewNorm,out float facingRatio,out bool flippedNormal,out mat4 matrixEyeToWorld,out vec3 normalCamera,out vec2 pixelCenter,out vec3 pointCamera,out vec3 pointObj,out vec3 pointWorld,out vec3 tangentUCamera,out vec3 tangentVCamera,out vec2 uvCoord)
{
vec4 worldPos=invViewMatrix*vec4(-vViewPosition,1.0);
facingRatio=dot(normalize(viewNorm),normalize(vViewPosition));
flippedNormal=(frontFacing>0.0);
matrixEyeToWorld=invViewMatrix;
normalCamera=viewNorm;
pixelCenter=vec2(1.0);
pointCamera=-vViewPosition*UNITS_SCALE_FACTOR;
pointObj=(invModelMatrix*worldPos).xyz*UNITS_SCALE_FACTOR;
pointWorld=worldPos.xyz*UNITS_SCALE_FACTOR;
tangentUCamera=normalize((modelViewMatrix*vec4(tangent.xyz,0.0)).xyz);
tangentVCamera=tangent.w*cross(viewNorm,tangentUCamera);
uvCoord=vec2(uv.x,1.0-uv.y);
}`,Vme=`void node_set_range(vec3 maxValue,vec3 minValue,vec3 oldMax,vec3 oldMin,vec3 value,out vec3 outValue){
outValue=minValue+(((value-oldMin)/(oldMax-oldMin))*(maxValue-minValue));
}`,Ume=`void node_shading_engine(vec4 surface,vec4 volume,vec3 displacement,out vec4 outgoingLight){
outgoingLight=surface+volume;
}`,zme=`#define COORD_WORLD_SPACE 0
#define COORD_OBJECT_SPACE 1
void node_sub_transform(const int coordSpace,vec3 scale,vec3 rotate,vec3 offset,out vec3 outVector,out vec3 outNormal)
{
vec3 norm=vNormal;
norm=(invViewMatrix*vec4(norm,0.0)).xyz;
vec3 vector=vWorldPosition.xyz;
if (coordSpace==COORD_OBJECT_SPACE){
vector=(invModelMatrix*vec4(vector,1.0)).xyz;
norm=(invModelMatrix*vec4(norm,0.0)).xyz;
}
vector-=offset;
vector*=scale;
mat3 rotX=mat3RotateX(radians(rotate.x));
mat3 rotY=mat3RotateY(radians(-rotate.y));
mat3 rotZ=mat3RotateZ(radians(rotate.z));
mat3 rotMat=rotX*rotY*rotZ;
vector=rotMat*vector;
norm=rotMat*norm;
outVector=vector;
outNormal=normalize(norm);
}`,Gme=`void node_surface_shader(vec3 color,vec3 glowColor,vec3 matteOpacity,vec3 transparency,out vec4 outColor,out vec3 outGlowColor,out vec3 outMatteOpacity,out vec3 outTransparency)
{
outColor=vec4(color,saturate(1.0-average(transparency)));
outGlowColor=glowColor;
outMatteOpacity=matteOpacity;
outTransparency=transparency;
}
void node_surface_shader(vec3 color,vec3 glowColor,vec3 matteOpacity,vec3 transparency,out vec3 outColor,out vec3 outGlowColor,out vec3 outMatteOpacity,out vec3 outTransparency)
{
outColor=color;
outGlowColor=glowColor;
outMatteOpacity=matteOpacity;
outTransparency=transparency;
}`,Hme=`void node_transform(out vec3 center,out mat4 inverseMatrix,out mat4 matrix,out mat4 parentInverseMatrix,out mat4 parentMatrix,out mat4 worldInverseMatrix,out mat4 worldMatrix,out mat4 xformMatrix)
{
center=modelMatrix[3].xyz;
inverseMatrix=invModelMatrix;
matrix=modelMatrix;
parentInverseMatrix=mat4(1.0);
parentMatrix=mat4(1.0);
worldInverseMatrix=invModelMatrix;
worldMatrix=modelMatrix;
xformMatrix=matrix;
}`,Wme=`mat4 transposeMat4(mat4 m){
return mat4(vec4(m[0].x,m[1].x,m[2].x,m[3].x),vec4(m[0].y,m[1].y,m[2].y,m[3].y),vec4(m[0].z,m[1].z,m[2].z,m[3].z),vec4(m[0].w,m[1].w,m[2].w,m[3].w));
}
void node_transpose_matrix(mat4 inputMatrix,out mat4 outputMatrix)
{
outputMatrix=transposeMat4(inputMatrix);
}`,jme=`void node_unit_conversion(float conversionFactor,float inInput,out float outOutput)
{
outOutput=conversionFactor*inInput;
}
void node_unit_conversion(float conversionFactor,vec3 inInput,out vec3 outOutput)
{
outOutput=conversionFactor*inInput;
}`,Qme=`void node_unpremultiply(float inAlpha,vec3 inColor,out float outAlpha,out vec3 outColor){
outColor=inColor/inAlpha;
outAlpha=inAlpha;
}`,$me=`void node_vector_product(const int operation,const bool normalizeOutput,vec3 input1,vec3 input2,mat4 matrix,out vec3 outVector){
if (operation==0){
outVector=input1;
} else if (operation==1){
if (normalizeOutput){
input1=normalize(input1);
input2=normalize(input2);
}
outVector=vec3(dot(input1,input2));
} else if (operation==2){
outVector=cross(input1,input2);
} else if (operation==3){
outVector=(matrix*vec4(input1,0.0)).xyz;
} else {
outVector=(matrix*vec4(input1,1.0)).xyz;
}

if (operation>1&&normalizeOutput)
outVector=normalize(outVector);
}`,Yme=`void node_wt_add_matrix(mat4 matrixIn1,float weightIn1,out mat4 matrixSum)
{
matrixSum=weightIn1*matrixIn1;
}
void node_wt_add_matrix(mat4 matrixIn1,float weightIn1,mat4 matrixIn2,float weightIn2,out mat4 matrixSum)
{
matrixSum=weightIn1*matrixIn1+weightIn2*matrixIn2;
}
void node_wt_add_matrix(mat4 matrixIn1,float weightIn1,mat4 matrixIn2,float weightIn2,mat4 matrixIn3,float weightIn3,out mat4 matrixSum)
{
matrixSum=weightIn1*matrixIn1+weightIn2*matrixIn2+weightIn3*matrixIn3;
}`,Xme=`precision mediump float;
precision mediump int;
attribute vec3 position;
attribute vec2 uv;
attribute float faceIndex;
varying vec3 vOutputDirection;
vec3 getDirection(vec2 uv,float face){
uv=2.0*uv-1.0;
vec3 direction=vec3(uv,1.0);
if (face==0.0){
direction=direction.zyx;
direction.z*=-1.0;
} else if (face==1.0){
direction=direction.xzy;
direction.z*=-1.0;
} else if (face==3.0){
direction=direction.zyx;
direction.x*=-1.0;
} else if (face==4.0){
direction=direction.xzy;
direction.y*=-1.0;
} else if (face==5.0){
direction.xz*=-1.0;
}
return direction;
}
void main(){
vOutputDirection=getDirection(uv,faceIndex);
gl_Position=vec4(position,1.0);
}`,qme=`precision highp float;
precision highp int;
varying vec3 vOutputDirection;
uniform sampler2D envMap;
uniform int samples;
uniform float weights[n];
uniform bool latitudinal;
uniform float dTheta;
uniform float lodIdx;
uniform vec3 poleAxis;
#define ENVMAP_TYPE_CUBE_UV
#include <cube_uv_reflection_fragment>
vec3 getSample(float theta,vec3 axis){
float cosTheta=cos(theta);
vec3 sampleDirection=vOutputDirection*cosTheta
+ cross(axis,vOutputDirection)*sin(theta)
+ axis*dot(axis,vOutputDirection)*(1.0-cosTheta);
return bilinearCubeUV(envMap,sampleDirection,lodIdx);
}
void main(){
vec3 axis=latitudinal?poleAxis:cross(poleAxis,vOutputDirection);
if (all(equal(axis,vec3(0.0)))){
axis=vec3(vOutputDirection.z,0.0,-vOutputDirection.x);
}
axis=normalize(axis);
gl_FragColor=vec4(0.0);
gl_FragColor.rgb+=weights[0]*getSample(0.0,axis);
for (int i=1;i<n;i++){
if (i>=samples){
break;
}
float theta=dTheta*float(i);
gl_FragColor.rgb+=weights[i]*getSample(-1.0*theta,axis);
gl_FragColor.rgb+=weights[i]*getSample(theta,axis);
}
}`,Kme=`precision mediump float;
precision mediump int;
uniform bool flipCubemapX;
uniform samplerCube envMap;
varying vec3 vOutputDirection;
void main(){
gl_FragColor=textureCube(envMap,vec3(vOutputDirection.x*(flipCubemapX?-1.0:1.0),vOutputDirection.yz));
}`,Zme=`precision mediump float;
precision mediump int;
varying vec3 vOutputDirection;
uniform sampler2D envMap;
uniform vec2 texelSize;
#define RECIPROCAL_PI 0.31830988618
#define RECIPROCAL_PI2 0.15915494
void main(){
gl_FragColor=vec4(0.0);
vec3 outputDirection=normalize(vOutputDirection);
vec2 uv;
uv.y=asin(clamp(outputDirection.y,-1.0,1.0))*RECIPROCAL_PI+0.5;
uv.x=atan(outputDirection.z,outputDirection.x)*RECIPROCAL_PI2+0.5;
vec2 f=fract(uv/texelSize-0.5);
uv-=f*texelSize;
vec3 tl=texture2D(envMap,uv).rgb;
uv.x+=texelSize.x;
vec3 tr=texture2D(envMap,uv).rgb;
uv.y+=texelSize.y;
vec3 br=texture2D(envMap,uv).rgb;
uv.x-=texelSize.x;
vec3 bl=texture2D(envMap,uv).rgb;
vec3 tm=mix(tl,tr,f.x);
vec3 bm=mix(bl,br,f.x);
gl_FragColor.rgb=mix(tm,bm,f.y);
}`,Jme=`varying vec2 vUv;
void main(){
vUv=uv;
gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.0);
}`,ege=`varying vec2 vUv;
uniform sampler2D tRGBABuffer;
uniform sampler2D tFloatBuffer;
void main(){
vec4 color=texture2D(tRGBABuffer,vUv);
vec3 colorSum=color.rgb;
float alphaProduct=color.a;
float alphaSum=texture2D(tFloatBuffer,vUv).r;
gl_FragColor=vec4(colorSum.rgb/max(alphaSum,1e-5),1.0-alphaProduct);
}`,tge=`uniform float damp;
uniform sampler2D tOld;
uniform sampler2D tNew;
varying vec2 vUv;
vec4 when_gt(vec4 x,float y){
return max(sign(x-y),0.0);
}
void main(){
vec4 texelOld=texture2D(tOld,vUv);
vec4 texelNew=texture2D(tNew,vUv);

texelOld*=damp*when_gt(texelOld,0.1);
gl_FragColor=max(texelNew,texelOld);
}`,nge=`varying vec2 vUv;
uniform sampler2D blurTexture1;
uniform sampler2D blurTexture2;
uniform sampler2D blurTexture3;
uniform sampler2D blurTexture4;
uniform sampler2D blurTexture5;
uniform sampler2D dirtTexture;
uniform float bloomStrength;
uniform float bloomRadius;
uniform float bloomFactors[NUM_MIPS];
uniform vec3 bloomTintColors[NUM_MIPS];
float lerpBloomFactor(const in float factor){
float mirrorFactor=1.2-factor;
return mix(factor,mirrorFactor,bloomRadius);
}
void main(){
gl_FragColor=bloomStrength*(lerpBloomFactor(bloomFactors[0])*vec4(bloomTintColors[0],1.0)*texture2D(blurTexture1,vUv)+
lerpBloomFactor(bloomFactors[1])*vec4(bloomTintColors[1],1.0)*texture2D(blurTexture2,vUv)+
lerpBloomFactor(bloomFactors[2])*vec4(bloomTintColors[2],1.0)*texture2D(blurTexture3,vUv)+
lerpBloomFactor(bloomFactors[3])*vec4(bloomTintColors[3],1.0)*texture2D(blurTexture4,vUv)+
lerpBloomFactor(bloomFactors[4])*vec4(bloomTintColors[4],1.0)*texture2D(blurTexture5,vUv)
);
}`,rge=`uniform sampler2D tDiffuse;
uniform vec3 defaultColor;
uniform float defaultOpacity;
uniform float luminosityThreshold;
uniform float smoothWidth;
varying vec2 vUv;
void main(){
vec4 texel=texture2D(tDiffuse,vUv);
vec3 luma=vec3(0.299,0.587,0.114);
float v=dot(texel.xyz,luma);
vec4 outputColor=vec4(defaultColor.rgb,defaultOpacity);
float alpha=smoothstep(luminosityThreshold,luminosityThreshold+smoothWidth,v);
gl_FragColor=mix(outputColor,texel,alpha);
gl_FragColor=clamp(gl_FragColor,0.0,10.0);
}`,oge=`#include <common>
varying vec2 vUv;
uniform sampler2D colorTexture;
uniform vec2 texSize;
uniform vec2 direction;
float gaussianPdf(in float x,in float sigma){
return 0.39894*exp(-0.5*x*x/(sigma*sigma))/sigma;
}
void main(){
vec2 invSize=1.0/texSize;
float fSigma=float(SIGMA);
float weightSum=gaussianPdf(0.0,fSigma);
vec3 diffuseSum=texture2D(colorTexture,vUv).rgb*weightSum;
for (int i=1;i<KERNEL_RADIUS;i++){
float x=float(i);
float w=gaussianPdf(x,fSigma);
vec2 uvOffset=direction*invSize*x;
vec3 sample1=texture2D(colorTexture,vUv+uvOffset).rgb;
vec3 sample2=texture2D(colorTexture,vUv-uvOffset).rgb;
diffuseSum+=(sample1+sample2)*w;
weightSum+=2.0*w;
}
gl_FragColor=vec4(diffuseSum/weightSum,1.0);
}`,ige=`#include <common>
varying vec2 vUv;
uniform sampler2D colorTexture;
uniform vec2 texSize;
uniform vec2 direction;
uniform float kernelRadius;
float gaussianPdf(in float x,in float sigma){
return 0.39894*exp(-0.5*x*x/(sigma*sigma))/sigma;
}
void main(){
vec2 invSize=1.0/texSize;
float weightSum=gaussianPdf(0.0,kernelRadius);
#if LOG_SPACE==1
float origDiffuse=texture2D(colorTexture,vUv).r;
float diffuseSum=weightSum;
#else
float diffuseSum=texture2D(colorTexture,vUv).r*weightSum;
#endif
vec2 delta=direction*invSize*kernelRadius/float(MAX_SAMPLE_RADIUS);
vec2 uvOffset=delta;
#if OCTAHEDRAL_MAP==1
vec3 cubeDir=normalize(octUVToCubeVec(vUv,invSize));
vec3 dirX=normalize(abs(cubeDir.y)<0.99999?vec3(cubeDir.z,0.0,-cubeDir.x)
: vec3(0.0,-cubeDir.z,cubeDir.y));
vec3 dirY=cross(cubeDir,dirX);
#endif
#pragma unroll_loop
for (int i=1;i<=MAX_SAMPLE_RADIUS;i++){
float w=gaussianPdf(uvOffset.x,kernelRadius);
#if OCTAHEDRAL_MAP==1
vec3 cubeOffset=uvOffset.x*dirX+uvOffset.y*dirY;
vec2 uv1=cubeVecToOctUV(cubeDir+cubeOffset,invSize);
vec2 uv2=cubeVecToOctUV(cubeDir-cubeOffset,invSize);
#else
vec2 uv1=vUv+uvOffset;
vec2 uv2=vUv-uvOffset;
#endif
float sample1=texture2D(colorTexture,uv1).r;
float sample2=texture2D(colorTexture,uv2).r;
#if LOG_SPACE==1
diffuseSum+=(clamp(exp(sample1-origDiffuse),0.0,1e38)+
clamp(exp(sample2-origDiffuse),0.0,1e38)
)*w;
#else
diffuseSum+=((sample1+sample2)*w);
#endif
weightSum+=2.0*w;
uvOffset+=delta;
}
#if LOG_SPACE==1
gl_FragColor=vec4(origDiffuse+log(diffuseSum/weightSum),0.0,0.0,1.0);
#else
gl_FragColor=vec4(diffuseSum/weightSum,0.0,0.0,1.0);
#endif
}`,age=`#include <common>
varying vec2 vUv;
uniform sampler2D tColor;
uniform sampler2D tDepth;
uniform float maxblur;
uniform float aperture;
uniform float nearClip;
uniform float farClip;
uniform float focus;
uniform float aspect;
uniform float depthLeakThreshold;
#include <packing>
float getDepth(const in vec2 screenPosition){
#if DEPTH_PACKING==1
return unpackRGBAToDepth(texture2D(tDepth,screenPosition));
#else
return texture2D(tDepth,screenPosition).x;
#endif
}
float getViewZ(const in float depth){
#if PERSPECTIVE_CAMERA==1
return perspectiveDepthToViewZ(depth,nearClip,farClip);
#else
return orthoDepthToViewZ(depth,nearClip,farClip);
#endif
}
vec4 blurSample(vec2 uvOffset,vec4 centerCol,float viewZCenter){
float viewZ=-getViewZ(getDepth(vUv+uvOffset));
float blurFactor=(viewZ>=viewZCenter)?1.0:
min(depthLeakThreshold*abs((focus-viewZ)/aperture),1.0);
return mix(centerCol,texture2D(tColor,vUv+uvOffset),blurFactor);
}
void main(){
vec2 aspectcorrect=vec2(1.0,aspect);
float viewZ=-getViewZ(getDepth(vUv));
float factor=abs(focus-viewZ);

float dofblur=maxblur*min(factor/aperture,1.0);
float dofblur9=dofblur*0.9;
float dofblur7=dofblur*0.7;
float dofblur4=dofblur*0.4;
vec4 centerCol=texture2D(tColor,vUv);
vec4 col=centerCol;
col+=blurSample((vec2( 0.0,0.4 )*aspectcorrect)*dofblur,centerCol,viewZ);
col+=blurSample((vec2( 0.15,0.37)*aspectcorrect)*dofblur,centerCol,viewZ);
col+=blurSample((vec2( 0.29,0.29)*aspectcorrect)*dofblur,centerCol,viewZ);
col+=blurSample((vec2(-0.37,0.15)*aspectcorrect)*dofblur,centerCol,viewZ);
col+=blurSample((vec2( 0.40,0.0 )*aspectcorrect)*dofblur,centerCol,viewZ);
col+=blurSample((vec2( 0.37,-0.15)*aspectcorrect)*dofblur,centerCol,viewZ);
col+=blurSample((vec2( 0.29,-0.29)*aspectcorrect)*dofblur,centerCol,viewZ);
col+=blurSample((vec2(-0.15,-0.37)*aspectcorrect)*dofblur,centerCol,viewZ);
col+=blurSample((vec2( 0.0,-0.4 )*aspectcorrect)*dofblur,centerCol,viewZ);
col+=blurSample((vec2(-0.15,0.37)*aspectcorrect)*dofblur,centerCol,viewZ);
col+=blurSample((vec2(-0.29,0.29)*aspectcorrect)*dofblur,centerCol,viewZ);
col+=blurSample((vec2( 0.37,0.15)*aspectcorrect)*dofblur,centerCol,viewZ);
col+=blurSample((vec2(-0.4,0.0 )*aspectcorrect)*dofblur,centerCol,viewZ);
col+=blurSample((vec2(-0.37,-0.15)*aspectcorrect)*dofblur,centerCol,viewZ);
col+=blurSample((vec2(-0.29,-0.29)*aspectcorrect)*dofblur,centerCol,viewZ);
col+=blurSample((vec2( 0.15,-0.37)*aspectcorrect)*dofblur,centerCol,viewZ);

col+=blurSample((vec2( 0.15,0.37)*aspectcorrect)*dofblur9,centerCol,viewZ);
col+=blurSample((vec2(-0.37,0.15)*aspectcorrect)*dofblur9,centerCol,viewZ);
col+=blurSample((vec2( 0.37,-0.15)*aspectcorrect)*dofblur9,centerCol,viewZ);
col+=blurSample((vec2(-0.15,-0.37)*aspectcorrect)*dofblur9,centerCol,viewZ);
col+=blurSample((vec2(-0.15,0.37)*aspectcorrect)*dofblur9,centerCol,viewZ);
col+=blurSample((vec2( 0.37,0.15)*aspectcorrect)*dofblur9,centerCol,viewZ);
col+=blurSample((vec2(-0.37,-0.15)*aspectcorrect)*dofblur9,centerCol,viewZ);
col+=blurSample((vec2( 0.15,-0.37)*aspectcorrect)*dofblur9,centerCol,viewZ);

col+=blurSample((vec2( 0.29,0.29)*aspectcorrect)*dofblur7,centerCol,viewZ);
col+=blurSample((vec2( 0.40,0.0 )*aspectcorrect)*dofblur7,centerCol,viewZ);
col+=blurSample((vec2( 0.29,-0.29)*aspectcorrect)*dofblur7,centerCol,viewZ);
col+=blurSample((vec2( 0.0,-0.4 )*aspectcorrect)*dofblur7,centerCol,viewZ);
col+=blurSample((vec2(-0.29,0.29)*aspectcorrect)*dofblur7,centerCol,viewZ);
col+=blurSample((vec2(-0.4,0.0 )*aspectcorrect)*dofblur7,centerCol,viewZ);
col+=blurSample((vec2(-0.29,-0.29)*aspectcorrect)*dofblur7,centerCol,viewZ);
col+=blurSample((vec2( 0.0,0.4 )*aspectcorrect)*dofblur7,centerCol,viewZ);

col+=blurSample((vec2( 0.29,0.29)*aspectcorrect)*dofblur4,centerCol,viewZ);
col+=blurSample((vec2( 0.4,0.0 )*aspectcorrect)*dofblur4,centerCol,viewZ);
col+=blurSample((vec2( 0.29,-0.29)*aspectcorrect)*dofblur4,centerCol,viewZ);
col+=blurSample((vec2( 0.0,-0.4 )*aspectcorrect)*dofblur4,centerCol,viewZ);
col+=blurSample((vec2(-0.29,0.29)*aspectcorrect)*dofblur4,centerCol,viewZ);
col+=blurSample((vec2(-0.4,0.0 )*aspectcorrect)*dofblur4,centerCol,viewZ);
col+=blurSample((vec2(-0.29,-0.29)*aspectcorrect)*dofblur4,centerCol,viewZ);
col+=blurSample((vec2( 0.0,0.4 )*aspectcorrect)*dofblur4,centerCol,viewZ);
gl_FragColor=col/41.0;
gl_FragColor.a=centerCol.a;
}`,sge=`
uniform sampler2D tDiffuse;
uniform float brightness;
uniform float contrast;
varying vec2 vUv;
void main(){
vec4 texel=texture2D(tDiffuse,vUv);
texel.rgb+=brightness;
if (contrast>0.0)
texel.rgb=(texel.rgb-0.5)/(1.0-contrast)+0.5;
else
texel.rgb=(texel.rgb-0.5)*(1.0+contrast)+0.5;
gl_FragColor=texel;
}`,lge=`uniform sampler2D tDiffuse;
uniform float opacity;
varying vec2 vUv;
void main(){
vec4 texel=(texture2D(tDiffuse,vUv));
gl_FragColor=opacity*texel;
}`,cge=`#include <common>
uniform samplerCube tCube;
uniform vec2 texelSize;
varying vec2 vUv;
void main(){
gl_FragColor=textureCube(tCube,octUVToCubeVec(gl_FragCoord.xy*texelSize,texelSize));
}`,uge=`
precision highp float;
uniform sampler2D tDiffuse;
uniform vec2 resolution;
in vec2 vUv;
#define FXAA_QUALITY_PS 5
#define FXAA_QUALITY_P0 1.0
#define FXAA_QUALITY_P1 1.5
#define FXAA_QUALITY_P2 2.0
#define FXAA_QUALITY_P3 4.0
#define FXAA_QUALITY_P4 12.0
#define FxaaTexTop(t,p)textureLod(t,p,0.0)
#define FxaaTexOff(t,p,o,r)textureLodOffset(t,p,0.0,o)
float FxaaLuma(vec4 rgba){return rgba.y;}
vec4 FxaaPixelShader(vec2 pos,sampler2D tex,vec2 fxaaQualityRcpFrame,float fxaaQualitySubpix,float fxaaQualityEdgeThreshold,float fxaaQualityEdgeThresholdMin
){
vec2 posM;
posM.x=pos.x;
posM.y=pos.y;
vec4 rgbyM=FxaaTexTop(tex,posM);
#define lumaM rgbyM.y
float lumaS=FxaaLuma(FxaaTexOff(tex,posM,ivec2(0,1),fxaaQualityRcpFrame.xy));
float lumaE=FxaaLuma(FxaaTexOff(tex,posM,ivec2(1,0),fxaaQualityRcpFrame.xy));
float lumaN=FxaaLuma(FxaaTexOff(tex,posM,ivec2(0,-1),fxaaQualityRcpFrame.xy));
float lumaW=FxaaLuma(FxaaTexOff(tex,posM,ivec2(-1,0),fxaaQualityRcpFrame.xy));
float maxSM=max(lumaS,lumaM);
float minSM=min(lumaS,lumaM);
float maxESM=max(lumaE,maxSM);
float minESM=min(lumaE,minSM);
float maxWN=max(lumaN,lumaW);
float minWN=min(lumaN,lumaW);
float rangeMax=max(maxWN,maxESM);
float rangeMin=min(minWN,minESM);
float rangeMaxScaled=rangeMax*fxaaQualityEdgeThreshold;
float range=rangeMax-rangeMin;
float rangeMaxClamped=max(fxaaQualityEdgeThresholdMin,rangeMaxScaled);
bool earlyExit=range<rangeMaxClamped;
if (earlyExit)
return rgbyM;
float lumaNW=FxaaLuma(FxaaTexOff(tex,posM,ivec2(-1,-1),fxaaQualityRcpFrame.xy));
float lumaSE=FxaaLuma(FxaaTexOff(tex,posM,ivec2(1,1),fxaaQualityRcpFrame.xy));
float lumaNE=FxaaLuma(FxaaTexOff(tex,posM,ivec2(1,-1),fxaaQualityRcpFrame.xy));
float lumaSW=FxaaLuma(FxaaTexOff(tex,posM,ivec2(-1,1),fxaaQualityRcpFrame.xy));
float lumaNS=lumaN+lumaS;
float lumaWE=lumaW+lumaE;
float subpixRcpRange=1.0/range;
float subpixNSWE=lumaNS+lumaWE;
float edgeHorz1=(-2.0*lumaM)+lumaNS;
float edgeVert1=(-2.0*lumaM)+lumaWE;
float lumaNESE=lumaNE+lumaSE;
float lumaNWNE=lumaNW+lumaNE;
float edgeHorz2=(-2.0*lumaE)+lumaNESE;
float edgeVert2=(-2.0*lumaN)+lumaNWNE;
float lumaNWSW=lumaNW+lumaSW;
float lumaSWSE=lumaSW+lumaSE;
float edgeHorz4=(abs(edgeHorz1)*2.0)+abs(edgeHorz2);
float edgeVert4=(abs(edgeVert1)*2.0)+abs(edgeVert2);
float edgeHorz3=(-2.0*lumaW)+lumaNWSW;
float edgeVert3=(-2.0*lumaS)+lumaSWSE;
float edgeHorz=abs(edgeHorz3)+edgeHorz4;
float edgeVert=abs(edgeVert3)+edgeVert4;
float subpixNWSWNESE=lumaNWSW+lumaNESE;
float lengthSign=fxaaQualityRcpFrame.x;
bool horzSpan=edgeHorz>=edgeVert;
float subpixA=subpixNSWE*2.0+subpixNWSWNESE;
if (!horzSpan)lumaN=lumaW;
if (!horzSpan)lumaS=lumaE;
if (horzSpan)lengthSign=fxaaQualityRcpFrame.y;
float subpixB=(subpixA*(1.0/12.0))-lumaM;
float gradientN=lumaN-lumaM;
float gradientS=lumaS-lumaM;
float lumaNN=lumaN+lumaM;
float lumaSS=lumaS+lumaM;
bool pairN=abs(gradientN)>=abs(gradientS);
float gradient=max(abs(gradientN),abs(gradientS));
if (pairN)lengthSign=-lengthSign;
float subpixC=clamp(abs(subpixB)*subpixRcpRange,0.0,1.0);
vec2 posB;
posB.x=posM.x;
posB.y=posM.y;
vec2 offNP;
offNP.x=(!horzSpan)?0.0:fxaaQualityRcpFrame.x;
offNP.y=(horzSpan)?0.0:fxaaQualityRcpFrame.y;
if (!horzSpan)posB.x+=lengthSign*0.5;
if (horzSpan)posB.y+=lengthSign*0.5;
vec2 posN;
posN.x=posB.x-offNP.x*FXAA_QUALITY_P0;
posN.y=posB.y-offNP.y*FXAA_QUALITY_P0;
vec2 posP;
posP.x=posB.x+offNP.x*FXAA_QUALITY_P0;
posP.y=posB.y+offNP.y*FXAA_QUALITY_P0;
float subpixD=((-2.0)*subpixC)+3.0;
float lumaEndN=FxaaLuma(FxaaTexTop(tex,posN));
float subpixE=subpixC*subpixC;
float lumaEndP=FxaaLuma(FxaaTexTop(tex,posP));
if (!pairN)lumaNN=lumaSS;
float gradientScaled=gradient*1.0/4.0;
float lumaMM=lumaM-lumaNN*0.5;
float subpixF=subpixD*subpixE;
bool lumaMLTZero=lumaMM<0.0;
lumaEndN-=lumaNN*0.5;
lumaEndP-=lumaNN*0.5;
bool doneN=abs(lumaEndN)>=gradientScaled;
bool doneP=abs(lumaEndP)>=gradientScaled;
if (!doneN)posN.x-=offNP.x*FXAA_QUALITY_P1;
if (!doneN)posN.y-=offNP.y*FXAA_QUALITY_P1;
bool doneNP=(!doneN)||(!doneP);
if (!doneP)posP.x+=offNP.x*FXAA_QUALITY_P1;
if (!doneP)posP.y+=offNP.y*FXAA_QUALITY_P1;
if (doneNP){
if (!doneN)lumaEndN=FxaaLuma(FxaaTexTop(tex,posN.xy));
if (!doneP)lumaEndP=FxaaLuma(FxaaTexTop(tex,posP.xy));
if (!doneN)lumaEndN=lumaEndN-lumaNN*0.5;
if (!doneP)lumaEndP=lumaEndP-lumaNN*0.5;
doneN=abs(lumaEndN)>=gradientScaled;
doneP=abs(lumaEndP)>=gradientScaled;
if (!doneN)posN.x-=offNP.x*FXAA_QUALITY_P2;
if (!doneN)posN.y-=offNP.y*FXAA_QUALITY_P2;
doneNP=(!doneN)||(!doneP);
if (!doneP)posP.x+=offNP.x*FXAA_QUALITY_P2;
if (!doneP)posP.y+=offNP.y*FXAA_QUALITY_P2;
#if (FXAA_QUALITY_PS>3)
if (doneNP){
if (!doneN)lumaEndN=FxaaLuma(FxaaTexTop(tex,posN.xy));
if (!doneP)lumaEndP=FxaaLuma(FxaaTexTop(tex,posP.xy));
if (!doneN)lumaEndN=lumaEndN-lumaNN*0.5;
if (!doneP)lumaEndP=lumaEndP-lumaNN*0.5;
doneN=abs(lumaEndN)>=gradientScaled;
doneP=abs(lumaEndP)>=gradientScaled;
if (!doneN)posN.x-=offNP.x*FXAA_QUALITY_P3;
if (!doneN)posN.y-=offNP.y*FXAA_QUALITY_P3;
doneNP=(!doneN)||(!doneP);
if (!doneP)posP.x+=offNP.x*FXAA_QUALITY_P3;
if (!doneP)posP.y+=offNP.y*FXAA_QUALITY_P3;
#if (FXAA_QUALITY_PS>4)
if (doneNP){
if (!doneN)lumaEndN=FxaaLuma(FxaaTexTop(tex,posN.xy));
if (!doneP)lumaEndP=FxaaLuma(FxaaTexTop(tex,posP.xy));
if (!doneN)lumaEndN=lumaEndN-lumaNN*0.5;
if (!doneP)lumaEndP=lumaEndP-lumaNN*0.5;
doneN=abs(lumaEndN)>=gradientScaled;
doneP=abs(lumaEndP)>=gradientScaled;
if (!doneN)posN.x-=offNP.x*FXAA_QUALITY_P4;
if (!doneN)posN.y-=offNP.y*FXAA_QUALITY_P4;
doneNP=(!doneN)||(!doneP);
if (!doneP)posP.x+=offNP.x*FXAA_QUALITY_P4;
if (!doneP)posP.y+=offNP.y*FXAA_QUALITY_P4;
#if (FXAA_QUALITY_PS>5)
if (doneNP){
if (!doneN)lumaEndN=FxaaLuma(FxaaTexTop(tex,posN.xy));
if (!doneP)lumaEndP=FxaaLuma(FxaaTexTop(tex,posP.xy));
if (!doneN)lumaEndN=lumaEndN-lumaNN*0.5;
if (!doneP)lumaEndP=lumaEndP-lumaNN*0.5;
doneN=abs(lumaEndN)>=gradientScaled;
doneP=abs(lumaEndP)>=gradientScaled;
if (!doneN)posN.x-=offNP.x*FXAA_QUALITY_P5;
if (!doneN)posN.y-=offNP.y*FXAA_QUALITY_P5;
doneNP=(!doneN)||(!doneP);
if (!doneP)posP.x+=offNP.x*FXAA_QUALITY_P5;
if (!doneP)posP.y+=offNP.y*FXAA_QUALITY_P5;
#if (FXAA_QUALITY_PS>6)
if (doneNP){
if (!doneN)lumaEndN=FxaaLuma(FxaaTexTop(tex,posN.xy));
if (!doneP)lumaEndP=FxaaLuma(FxaaTexTop(tex,posP.xy));
if (!doneN)lumaEndN=lumaEndN-lumaNN*0.5;
if (!doneP)lumaEndP=lumaEndP-lumaNN*0.5;
doneN=abs(lumaEndN)>=gradientScaled;
doneP=abs(lumaEndP)>=gradientScaled;
if (!doneN)posN.x-=offNP.x*FXAA_QUALITY_P6;
if (!doneN)posN.y-=offNP.y*FXAA_QUALITY_P6;
doneNP=(!doneN)||(!doneP);
if (!doneP)posP.x+=offNP.x*FXAA_QUALITY_P6;
if (!doneP)posP.y+=offNP.y*FXAA_QUALITY_P6;
#if (FXAA_QUALITY_PS>7)
if (doneNP){
if (!doneN)lumaEndN=FxaaLuma(FxaaTexTop(tex,posN.xy));
if (!doneP)lumaEndP=FxaaLuma(FxaaTexTop(tex,posP.xy));
if (!doneN)lumaEndN=lumaEndN-lumaNN*0.5;
if (!doneP)lumaEndP=lumaEndP-lumaNN*0.5;
doneN=abs(lumaEndN)>=gradientScaled;
doneP=abs(lumaEndP)>=gradientScaled;
if (!doneN)posN.x-=offNP.x*FXAA_QUALITY_P7;
if (!doneN)posN.y-=offNP.y*FXAA_QUALITY_P7;
doneNP=(!doneN)||(!doneP);
if (!doneP)posP.x+=offNP.x*FXAA_QUALITY_P7;
if (!doneP)posP.y+=offNP.y*FXAA_QUALITY_P7;
#if (FXAA_QUALITY_PS>8)
if (doneNP){
if (!doneN)lumaEndN=FxaaLuma(FxaaTexTop(tex,posN.xy));
if (!doneP)lumaEndP=FxaaLuma(FxaaTexTop(tex,posP.xy));
if (!doneN)lumaEndN=lumaEndN-lumaNN*0.5;
if (!doneP)lumaEndP=lumaEndP-lumaNN*0.5;
doneN=abs(lumaEndN)>=gradientScaled;
doneP=abs(lumaEndP)>=gradientScaled;
if (!doneN)posN.x-=offNP.x*FXAA_QUALITY_P8;
if (!doneN)posN.y-=offNP.y*FXAA_QUALITY_P8;
doneNP=(!doneN)||(!doneP);
if (!doneP)posP.x+=offNP.x*FXAA_QUALITY_P8;
if (!doneP)posP.y+=offNP.y*FXAA_QUALITY_P8;
#if (FXAA_QUALITY_PS>9)
if (doneNP){
if (!doneN)lumaEndN=FxaaLuma(FxaaTexTop(tex,posN.xy));
if (!doneP)lumaEndP=FxaaLuma(FxaaTexTop(tex,posP.xy));
if (!doneN)lumaEndN=lumaEndN-lumaNN*0.5;
if (!doneP)lumaEndP=lumaEndP-lumaNN*0.5;
doneN=abs(lumaEndN)>=gradientScaled;
doneP=abs(lumaEndP)>=gradientScaled;
if (!doneN)posN.x-=offNP.x*FXAA_QUALITY_P9;
if (!doneN)posN.y-=offNP.y*FXAA_QUALITY_P9;
doneNP=(!doneN)||(!doneP);
if (!doneP)posP.x+=offNP.x*FXAA_QUALITY_P9;
if (!doneP)posP.y+=offNP.y*FXAA_QUALITY_P9;
#if (FXAA_QUALITY_PS>10)
if (doneNP){
if (!doneN)lumaEndN=FxaaLuma(FxaaTexTop(tex,posN.xy));
if (!doneP)lumaEndP=FxaaLuma(FxaaTexTop(tex,posP.xy));
if (!doneN)lumaEndN=lumaEndN-lumaNN*0.5;
if (!doneP)lumaEndP=lumaEndP-lumaNN*0.5;
doneN=abs(lumaEndN)>=gradientScaled;
doneP=abs(lumaEndP)>=gradientScaled;
if (!doneN)posN.x-=offNP.x*FXAA_QUALITY_P10;
if (!doneN)posN.y-=offNP.y*FXAA_QUALITY_P10;
doneNP=(!doneN)||(!doneP);
if (!doneP)posP.x+=offNP.x*FXAA_QUALITY_P10;
if (!doneP)posP.y+=offNP.y*FXAA_QUALITY_P10;
#if (FXAA_QUALITY_PS>11)
if (doneNP){
if (!doneN)lumaEndN=FxaaLuma(FxaaTexTop(tex,posN.xy));
if (!doneP)lumaEndP=FxaaLuma(FxaaTexTop(tex,posP.xy));
if (!doneN)lumaEndN=lumaEndN-lumaNN*0.5;
if (!doneP)lumaEndP=lumaEndP-lumaNN*0.5;
doneN=abs(lumaEndN)>=gradientScaled;
doneP=abs(lumaEndP)>=gradientScaled;
if (!doneN)posN.x-=offNP.x*FXAA_QUALITY_P11;
if (!doneN)posN.y-=offNP.y*FXAA_QUALITY_P11;
doneNP=(!doneN)||(!doneP);
if (!doneP)posP.x+=offNP.x*FXAA_QUALITY_P11;
if (!doneP)posP.y+=offNP.y*FXAA_QUALITY_P11;
#if (FXAA_QUALITY_PS>12)
if (doneNP){
if (!doneN)lumaEndN=FxaaLuma(FxaaTexTop(tex,posN.xy));
if (!doneP)lumaEndP=FxaaLuma(FxaaTexTop(tex,posP.xy));
if (!doneN)lumaEndN=lumaEndN-lumaNN*0.5;
if (!doneP)lumaEndP=lumaEndP-lumaNN*0.5;
doneN=abs(lumaEndN)>=gradientScaled;
doneP=abs(lumaEndP)>=gradientScaled;
if (!doneN)posN.x-=offNP.x*FXAA_QUALITY_P12;
if (!doneN)posN.y-=offNP.y*FXAA_QUALITY_P12;
doneNP=(!doneN)||(!doneP);
if (!doneP)posP.x+=offNP.x*FXAA_QUALITY_P12;
if (!doneP)posP.y+=offNP.y*FXAA_QUALITY_P12;
}
#endif
}
#endif
}
#endif
}
#endif
}
#endif
}
#endif
}
#endif
}
#endif
}
#endif
}
#endif
}
float dstN=posM.x-posN.x;
float dstP=posP.x-posM.x;
if (!horzSpan)dstN=posM.y-posN.y;
if (!horzSpan)dstP=posP.y-posM.y;
bool goodSpanN=(lumaEndN<0.0)!= lumaMLTZero;
float spanLength=(dstP+dstN);
bool goodSpanP=(lumaEndP<0.0)!= lumaMLTZero;
float spanLengthRcp=1.0/spanLength;
bool directionN=dstN<dstP;
float dst=min(dstN,dstP);
bool goodSpan=directionN?goodSpanN:goodSpanP;
float subpixG=subpixF*subpixF;
float pixelOffset=(dst*(-spanLengthRcp))+0.5;
float subpixH=subpixG*fxaaQualitySubpix;
float pixelOffsetGood=goodSpan?pixelOffset:0.0;
float pixelOffsetSubpix=max(pixelOffsetGood,subpixH);
if (!horzSpan)posM.x+=pixelOffsetSubpix*lengthSign;
if (horzSpan)posM.y+=pixelOffsetSubpix*lengthSign;
return FxaaTexTop(tex,posM);
}
void main(){
gl_FragColor=FxaaPixelShader(vUv,tDiffuse,resolution,0.75,0.166,0.0);
}`,dge=`uniform sampler2D tDiffuse;
varying vec2 vUv;
void main(){
vec4 texel=texture2D(tDiffuse,vUv);
float bw=texel.r*0.35+texel.g*0.45+texel.b*0.2;
texel=vec4(bw,bw,bw,texel.a);
gl_FragColor=texel;
}`,fge=`uniform sampler2D tDiffuse;
uniform sampler2D tNormal;
uniform vec2 direction;
uniform vec2 resolution;
varying vec2 vUv;
#include <packing>
const float SIGMA_SPATIAL=1.5;
const float SIGMA_INTENSITY=0.01;
float gaussianPdf(float x,float sigma){
return 0.39894*exp(-0.5*x*x/(sigma*sigma))/sigma;
}
void main(){
float weightSum=gaussianPdf(0.0,SIGMA_SPATIAL)
* gaussianPdf(0.0,SIGMA_INTENSITY);
vec4 diffSample=texture(tDiffuse,vUv);
vec4 gtaoDataSum=vec4(diffSample.r,unpackRGBToNormal(diffSample.gba))*weightSum;
vec3 normCenter=unpackRGBToNormal(texture(tNormal,vUv).xyz);
vec2 delta=direction/resolution;
vec2 offset=delta;
#pragma unroll_loop
for (int i=1;i<=BLUR_RADIUS_PX;i++){
vec2 uvCoords0=vUv+offset;
vec2 uvCoords1=vUv-offset;
vec4 diffSample0=texture(tDiffuse,uvCoords0);
vec4 diffSample1=texture(tDiffuse,uvCoords1);
vec4 gtaoData0=vec4(diffSample0.r,unpackRGBToNormal(diffSample0.gba));
vec4 gtaoData1=vec4(diffSample1.r,unpackRGBToNormal(diffSample1.gba));
vec3 normSample0=unpackRGBToNormal(texture(tNormal,uvCoords0).xyz);
vec3 normSample1=unpackRGBToNormal(texture(tNormal,uvCoords1).xyz);
float weightSpatial=gaussianPdf(float(i),SIGMA_SPATIAL);
float weight0=weightSpatial*gaussianPdf(1.0-max(0.0,dot(normCenter,normSample0)),SIGMA_INTENSITY);
float weight1=weightSpatial*gaussianPdf(1.0-max(0.0,dot(normCenter,normSample1)),SIGMA_INTENSITY);
weightSum+=weight0+weight1;
gtaoDataSum+=weight0*gtaoData0+weight1*gtaoData1;
offset+=delta;
}
float visibility=gtaoDataSum.r/weightSum;
vec3 bentNormal=normalize(gtaoDataSum.gba);
gl_FragColor=vec4(visibility,packNormalToRGB(bentNormal));
}`,hge=`uniform sampler2D tNormal;
uniform sampler2D tDepth;
uniform sampler2D tNoise;
uniform float occlDistance;
uniform float factor;
uniform float occlPrecision;
uniform mat4 mainCameraProjMat;
uniform vec2 resolution;
varying vec2 vUv;
#include <common>
#include <packing>
const vec3 AXIS_Z=vec3(0.0,0.0,1.0);
const float NUM_SAMPLES_HALF_MIN=4.0;
const float NUM_SAMPLES_HALF_MAX=8.0;
const float NOISE_TEX_SIZE=32.0;
const float NEAR_FIELD_COEFF=0.5;
const float SELF_OCCL_BIAS=-1e-5;
const float NORMAL_RENDER_GEOM_MAX_DIFF_ANGLE=0.85*PI_HALF;
float integrateArc(vec2 horizonAngles,float normalAngle){
vec2 visCoeffs=(-cos(2.0*horizonAngles-normalAngle)+cos(normalAngle)
+ 2.0*horizonAngles*sin(normalAngle))/4.0;
return visCoeffs.x+visCoeffs.y;
}
vec3 calcViewFromUVDepth(vec2 uv,float depth,float zBias){
vec3 ndcCo=2.0*vec3(uv,depth)-1.0;
#if ORTHO_CAMERA==1
float viewZ=(ndcCo.z-mainCameraProjMat[3][2])/mainCameraProjMat[2][2]+zBias;
vec2 _00_11=vec2(mainCameraProjMat[0][0],mainCameraProjMat[1][1]);
vec2 _30_31=vec2(mainCameraProjMat[3][0],mainCameraProjMat[3][1]);
return vec3((ndcCo.xy-_30_31)/_00_11,viewZ);
#else
float viewZ=-mainCameraProjMat[3][2]/(mainCameraProjMat[2][2]+ndcCo.z)+zBias;
vec2 _00_11=vec2(mainCameraProjMat[0][0],mainCameraProjMat[1][1]);
vec2 _20_21=vec2(mainCameraProjMat[2][0],mainCameraProjMat[2][1]);
return vec3(-viewZ*(ndcCo.xy+_20_21)/_00_11,viewZ);
#endif
}
vec2 calcSliceRadiusUV(float viewZ){
vec4 distView=vec4(occlDistance,occlDistance,viewZ,1.0);
vec4 distClip=mainCameraProjMat*distView;
vec2 xyNDC=distClip.xy/distClip.w;
return clamp(0.5*xyNDC,0.0,0.5);
}
vec2 calcHorizonAngles(vec3 viewPos,vec3 viewVec,vec2 sliceDir,float offsetNoise){
vec2 maxHorizonCos=vec2(-1.0);
vec2 sliceRadius=calcSliceRadiusUV(viewPos.z);
vec2 pxSize=1.0/resolution;
int NUM_SAMPLES_HALF=int(occlPrecision
* (NUM_SAMPLES_HALF_MAX-NUM_SAMPLES_HALF_MIN)+NUM_SAMPLES_HALF_MIN);
for (int i=0;i<NUM_SAMPLES_HALF;i++){
vec2 offset=sliceDir*(pxSize*(1.0+float(i))
+ sliceRadius*pow((float(i)+offsetNoise)/float(NUM_SAMPLES_HALF),2.0));
vec2 uvs=vUv-offset;
vec3 ps=calcViewFromUVDepth(uvs,texture(tDepth,uvs).x,SELF_OCCL_BIAS);
vec3 ds=normalize(ps-viewPos);
vec2 uvt=vUv+offset;
vec3 pt=calcViewFromUVDepth(uvt,texture(tDepth,uvt).x,SELF_OCCL_BIAS);
vec3 dt=normalize(pt-viewPos);
vec2 sampleLen=vec2(length(ps-viewPos),length(pt-viewPos));
vec2 blendWeight=(sampleLen/occlDistance-1.0)/(NEAR_FIELD_COEFF-1.0);
blendWeight=clamp(blendWeight,0.0,1.0);
vec2 maxHorizonCosNoBlending=max(maxHorizonCos,vec2(dot(ds,viewVec),dot(dt,viewVec)));
maxHorizonCos=mix(maxHorizonCos,maxHorizonCosNoBlending,blendWeight);
}
vec2 horizons=acos(maxHorizonCos);
return vec2(-horizons.x,horizons.y);
}
vec2 calcNormalAngleAndProjLen(vec3 viewVec,vec3 normal,vec2 sliceDir){
vec3 sliceVec=vec3(sliceDir,0.0);
sliceVec=sliceVec-dot(sliceVec,viewVec)*viewVec;
vec3 sliceOrthoVec=cross(sliceVec,viewVec);
vec3 normalProj=normal-dot(normal,sliceOrthoVec)*sliceOrthoVec;
float normalProjLen=length(normalProj);
float normalAngle=acos(clamp(dot(normalProj/normalProjLen,viewVec),0.0,1.0));
normalAngle*=sign(dot(normalProj,sliceVec));
return vec2(normalAngle,normalProjLen);
}
#if CALC_BENT_NORMALS==1
vec3 calcSliceBentNormal(vec2 sliceDir,vec2 h,float n){
vec2 t=vec2(6.0*sin(h[0]-n)-sin(3.0*h[0]-n)+6.0*sin(h[1]-n)
- sin(3.0*h[1]-n)+16.0*sin(n)-3.0*(sin(h[0]+n)+sin(h[1]+n)),-cos(3.0*h[0]-n)-cos(3.0*h[1]-n)+8.0*cos(n)
- 3.0*(cos(h[0]+n)+cos(h[1]+n))
)/12.0;
return vec3(sliceDir*t[0],t[1]);
}
#endif
vec2 clampHorizonAnglesAroundNormal(vec2 horizonAngles,float normalAngle,float geomNormalAngle){
horizonAngles=normalAngle+clamp(horizonAngles-normalAngle,-PI_HALF,PI_HALF);
if (abs(normalAngle-geomNormalAngle)<NORMAL_RENDER_GEOM_MAX_DIFF_ANGLE){
horizonAngles=geomNormalAngle+clamp(horizonAngles-geomNormalAngle,-PI_HALF,PI_HALF);
}
return horizonAngles;
}
void main(){
float depth=texture(tDepth,vUv).x;
#ifndef GTAO_DISABLE_BKG_FIX
if (depth==1.0){
gl_FragColor=vec4(vec3(1.0),1.0);
} else {
#endif
vec3 viewPos=calcViewFromUVDepth(vUv,depth,0.0);
#if ORTHO_CAMERA==1
vec3 viewVec=vec3(0.0,0.0,1.0);
#else
vec3 viewVec=normalize(-viewPos);
#endif
vec3 viewNormal=unpackRGBToNormal(texture(tNormal,vUv).xyz);
vec3 geomViewNormal=normalize(cross(dFdx(viewPos),dFdy(viewPos)));
vec2 noiseScale=resolution/NOISE_TEX_SIZE;
vec4 noiseData=texture(tNoise,vUv*noiseScale);
float randAngle=noiseData.r*PI_HALF;
float visibility=0.0;
vec3 bentNormalAvg=viewNormal;
float normalAngle,normalProjLen,geomNormalAngle;
vec2 horizonAngles,_vec2Tmp;
vec3 sliceBentNormal;
#if CALC_BENT_NORMALS==1
bentNormalAvg=vec3(0.0);
#if ORTHO_CAMERA==0
vec3 bentRotAxis=cross(AXIS_Z,viewVec);
float bentRotAngle=acos(clamp(dot(AXIS_Z,viewVec),-1.0,1.0));
#endif
#endif
vec2 sliceDir=vec2(cos(randAngle),sin(randAngle));
#pragma unroll_loop
for (int i=0;i<2;i++){
_vec2Tmp=calcNormalAngleAndProjLen(viewVec,viewNormal,sliceDir);
normalAngle=_vec2Tmp[0],normalProjLen=_vec2Tmp[1];
_vec2Tmp=calcNormalAngleAndProjLen(viewVec,geomViewNormal,sliceDir);
geomNormalAngle=_vec2Tmp[0];
horizonAngles=calcHorizonAngles(viewPos,viewVec,sliceDir,noiseData.g);
horizonAngles=clampHorizonAnglesAroundNormal(horizonAngles,normalAngle,geomNormalAngle);
visibility+=normalProjLen*integrateArc(horizonAngles,normalAngle);
#if CALC_BENT_NORMALS==1
sliceBentNormal=calcSliceBentNormal(sliceDir,horizonAngles,normalAngle);
#if ORTHO_CAMERA==0
sliceBentNormal=vec3RotateAxisAngle(sliceBentNormal,bentRotAxis,bentRotAngle);
#endif
bentNormalAvg+=sliceBentNormal*normalProjLen;
#endif
sliceDir=vec2(-sliceDir.y,sliceDir.x);
}
visibility/=2.0;
#if CALC_BENT_NORMALS==1
float mixFactor=clamp((1.0-2.0*visibility)/(3.0*visibility-4.0),0.0,1.0);
bentNormalAvg=normalize(mix(bentNormalAvg,viewNormal,mixFactor));
#endif
gl_FragColor=vec4(pow(visibility,factor),packNormalToRGB(bentNormalAvg));
#ifndef GTAO_DISABLE_BKG_FIX
}
#endif
}`,pge=`varying vec2 vUv;
uniform sampler2D maskTexture;
uniform vec2 texSize;
uniform vec4 visibleEdgeColor;
uniform vec4 hiddenEdgeColor;
void main(){
vec2 invSize=1.0/texSize;
vec4 uvOffset=vec4(1.0,0.0,0.0,1.0)*vec4(invSize,invSize);
vec4 c1=texture2D(maskTexture,vUv+uvOffset.xy);
vec4 c2=texture2D(maskTexture,vUv-uvOffset.xy);
vec4 c3=texture2D(maskTexture,vUv+uvOffset.yw);
vec4 c4=texture2D(maskTexture,vUv-uvOffset.yw);
float diff1=(c1.r-c2.r)*0.5;
float diff2=(c3.r-c4.r)*0.5;
float d=length(vec2(diff1,diff2));
float a1=min(c1.g,c2.g);
float a2=min(c3.g,c4.g);
float visibilityFactor=min(a1,a2);
vec4 edgeColor=(1.0-visibilityFactor>0.001)?visibleEdgeColor:hiddenEdgeColor;
gl_FragColor=edgeColor*vec4(d);
}`,mge=`#include <common>
varying vec2 vUv;
uniform sampler2D colorTexture;
uniform vec2 texSize;
uniform vec2 direction;
uniform float kernelRadius;
float gaussianPdf(in float x,in float sigma){
return 0.39894*exp(-0.5*x*x/(sigma*sigma))/sigma;
}
void main(){
vec2 invSize=1.0/texSize;
float weightSum=gaussianPdf(0.0,kernelRadius);
vec4 diffuseSum=texture2D(colorTexture,vUv);
#if defined(LOG_SPACE)
diffuseSum=exp(diffuseSum);
#endif
diffuseSum*=weightSum;
vec2 delta=direction*invSize*kernelRadius/float(MAX_RADIUS);
vec2 uvOffset=delta;
for (int i=1;i<=MAX_RADIUS;i++){
float w=gaussianPdf(uvOffset.x,kernelRadius);
vec4 sample1=texture2D(colorTexture,vUv+uvOffset);
vec4 sample2=texture2D(colorTexture,vUv-uvOffset);
#if defined(LOG_SPACE)
sample1=exp(sample1);
sample2=exp(sample2);
#endif
diffuseSum+=((sample1+sample2)*w);
weightSum+=(2.0*w);
uvOffset+=delta;
}
vec4 finalCol=diffuseSum/weightSum;
#if defined(LOG_SPACE)
finalCol=log(finalCol);
#endif
gl_FragColor=finalCol;
}`,gge=`varying vec2 vUv;
uniform sampler2D maskTexture;
uniform sampler2D edgeTexture1;
uniform sampler2D edgeTexture2;
uniform sampler2D patternTexture;
uniform float edgeStrength;
uniform float edgeGlow;
uniform bool usePatternTexture;
void main(){
vec4 edgeValue1=texture2D(edgeTexture1,vUv);
vec4 edgeValue2=texture2D(edgeTexture2,vUv);
vec4 maskColor=texture2D(maskTexture,vUv);
vec4 patternColor=texture2D(patternTexture,6.0*vUv);
float visibilityFactor=1.0-maskColor.g>0.0?1.0:0.5;
vec4 edgeValue=edgeValue1+edgeValue2*edgeGlow;
vec4 finalColor=edgeStrength*maskColor.r*edgeValue;
if (usePatternTexture)
finalColor+=+ visibilityFactor*(1.0-maskColor.r)*(1.0-patternColor.r);
float maxChannel=max(finalColor.r,max(finalColor.g,finalColor.b));
if (maxChannel != 0.0){
finalColor.rgb/=maxChannel;
}
gl_FragColor=finalColor;
}`,_ge=`#include <common>
uniform sampler2D tDiffuse;
varying vec2 vUv;
void main(){
vec4 texel=texture2D(tDiffuse,vUv);
float alpha=clamp(texel.a,0.0,1.0);
gl_FragColor=texel;
gl_FragColor.rgb/=alpha;
#include <tonemapping_fragment>
gl_FragColor=LinearTosRGB(gl_FragColor);
gl_FragColor.rgb*=alpha;
}`;const vge=`precision highp float;
attribute vec3 position;
attribute vec3 previous;
attribute vec3 next;
attribute float side;
attribute float width;
attribute vec2 uv;
attribute float counters;
uniform mat4 projectionMatrix;
uniform mat4 modelViewMatrix;
uniform vec2 resolution;
uniform float lineWidth;
uniform float sizeAttenuation;
varying float vCounters;
varying vec2 vUV;
const float EQ_EPS=0.000001;
vec2 fix(vec4 i,float aspect){
vec2 res=i.xy/i.w;
res.x*=aspect;
return res;
}
bool posEqual(vec2 pos0,vec2 pos1){
return length(pos0-pos1)<EQ_EPS;
}
void main(){
float aspect=resolution.x/resolution.y;
vCounters=counters;
vUV=uv;
mat4 m=projectionMatrix*modelViewMatrix;
vec4 finalPosition=m*vec4(position,1.0);
vec4 prevPos=m*vec4(previous,1.0);
vec4 nextPos=m*vec4(next,1.0);
vec2 currentP=fix(finalPosition,aspect);
vec2 prevP=fix(prevPos,aspect);
vec2 nextP=fix(nextPos,aspect);
float w=lineWidth*width;
if (sizeAttenuation==0.0){
w*=finalPosition.w/resolution.x;
}
vec2 dir;
if (posEqual(nextP,currentP)){
dir=normalize(currentP-prevP);
} else if (posEqual(prevP,currentP)){
dir=normalize(nextP-currentP);
} else {
vec2 dir1=normalize(currentP-prevP);
vec2 dir2=normalize(nextP-currentP);
dir=normalize(dir1+dir2);
}
vec2 offset=vec2(-dir.y,dir.x);
offset.y*=aspect;
offset*=w;
finalPosition.xy+=offset*side;
gl_Position=finalPosition;
}`,Age=`precision mediump float;
uniform sampler2D map;
uniform sampler2D alphaMap;
uniform float useMap;
uniform float useAlphaMap;
uniform float visibility;
uniform float alphaTest;
uniform vec2 repeat;
uniform vec3 color;
uniform float opacity;
varying vec2 vUV;
varying float vCounters;
#include <encodings_pars_fragment>
void main(){
vec4 c=vec4(color,opacity);
if (useMap==1.0){
c*=texture2D(map,vUV*repeat);
}
if (useAlphaMap==1.0){
c.a*=texture2D(alphaMap,vUV*repeat).a;
}
if (c.a<alphaTest){
discard;
}
gl_FragColor=c;
gl_FragColor.a*=step(vCounters,visibility);
gl_FragColor=LinearTosRGB(gl_FragColor);
}`,Qe={alphamap_fragment:Cle,alphamap_pars_fragment:Sle,alphatest_fragment:wle,alphatest_pars_fragment:Mle,aomap_fragment:Tle,aomap_pars_fragment:Ile,begin_vertex:Rle,beginnormal_vertex:Lle,bsdfs:Ple,bumpmap_pars_fragment:Dle,clipping_planes_fragment:Ble,clipping_planes_pars_fragment:Nle,clipping_planes_pars_vertex:Ole,clipping_planes_vertex:kle,color_fragment:Fle,color_pars_fragment:Vle,color_pars_vertex:Ule,color_vertex:zle,common:Gle,cube_uv_reflection_fragment:Hle,defaultnormal_vertex:Wle,displacementmap_pars_vertex:jle,displacementmap_vertex:Qle,emissivemap_fragment:$le,emissivemap_pars_fragment:Yle,encodings_fragment:Xle,encodings_pars_fragment:qle,envmap_fragment:Kle,envmap_common_pars_fragment:Zle,envmap_pars_fragment:Jle,envmap_pars_vertex:ece,envmap_physical_pars_fragment:dce,envmap_vertex:tce,fog_vertex:nce,fog_pars_vertex:rce,fog_fragment:oce,fog_pars_fragment:ice,lightmap_fragment:ace,lightmap_pars_fragment:sce,lights_lambert_fragment:lce,lights_lambert_pars_fragment:cce,lights_pars_begin:uce,lights_physical_fragment:fce,lights_physical_pars_fragment:hce,lights_fragment_begin:pce,lights_fragment_maps:mce,lights_fragment_end:gce,logdepthbuf_fragment:_ce,logdepthbuf_pars_fragment:vce,logdepthbuf_pars_vertex:Ace,logdepthbuf_vertex:yce,map_fragment:bce,map_pars_fragment:xce,map_particle_fragment:Ece,map_particle_pars_fragment:Cce,metalnessmap_fragment:Sce,metalnessmap_pars_fragment:wce,morphcolor_vertex:Mce,morphnormal_vertex:Tce,morphtarget_pars_vertex:Ice,morphtarget_vertex:Rce,normal_fragment_begin:Lce,normal_fragment_maps:Pce,normal_pars_fragment:Dce,normal_pars_vertex:Bce,normal_vertex:Nce,normalmap_pars_fragment:Oce,clearcoat_normal_fragment_begin:kce,clearcoat_normal_fragment_maps:Fce,clearcoat_pars_fragment:Vce,output_fragment:Uce,packing:zce,premultiplied_alpha_fragment:Gce,project_vertex:Hce,dithering_fragment:Wce,dithering_pars_fragment:jce,roughnessmap_fragment:Qce,roughnessmap_pars_fragment:$ce,shadowmap_pars_fragment:Yce,shadowmap_pars_vertex:Xce,shadowmap_vertex:qce,shadowmask_pars_fragment:Kce,skinbase_vertex:Zce,skinning_pars_vertex:Jce,skinning_vertex:eue,skinnormal_vertex:tue,specularmap_fragment:nue,specularmap_pars_fragment:rue,tonemapping_fragment:oue,tonemapping_pars_fragment:iue,transmission_fragment:aue,transmission_pars_fragment:sue,uv_pars_fragment:lue,uv_pars_vertex:cue,uv_vertex:uue,uv2_pars_fragment:due,uv2_pars_vertex:fue,uv2_vertex:hue,webgl1_compat:pue,worldpos_vertex:mue,background_vert:gue,background_frag:_ue,backgroundCube_vert:vue,backgroundCube_frag:Aue,cube_vert:yue,cube_frag:bue,depth_vert:xue,depth_frag:Eue,distanceRGBA_vert:Cue,distanceRGBA_frag:Sue,equirect_vert:wue,equirect_frag:Mue,linedashed_vert:Tue,linedashed_frag:Iue,meshbasic_vert:Rue,meshbasic_frag:Lue,meshlambert_vert:Pue,meshlambert_frag:Due,meshnormal_vert:Bue,meshnormal_frag:Nue,meshphysical_vert:Oue,meshphysical_frag:kue,points_vert:Fue,points_frag:Vue,shadow_vert:Uue,shadow_frag:zue,sprite_vert:Gue,sprite_frag:Hue,mask_vert:Wue,mask_frag:jue,meshnode_vert:Que,meshnode_frag:$ue,lights_node_pars_fragment:Yue,lights_node_gtao_pars_fragment:Xue,lights_fragment_gtso:que,normal_output_fragment:Kue,ssr_pars_fragment:Zue,plane_reflection_pars_vertex:Jue,plane_reflection_pars_fragment:ede,plane_reflection_vertex:tde,oit_weighted_pars_fragment:nde,oit_weighted_fragment:rde,node_common_frag:ode,node_osl_frag:ide,node_incident_frag:ade,node_normal_frag:sde,node_position_frag:lde,node_rgb_alpha_frag:cde,node_value_frag:ude,node_u_float_frag:dde,node_abs_ar_frag:fde,node_add_ar_frag:hde,node_atan_ar_frag:pde,node_checkerboard_ar_frag:mde,node_clamp_ar_frag:gde,node_color_convert_ar_frag:vde,node_color_correct_ar_frag:Ade,node_color_to_float_ar_frag:_de,node_compare_ar_frag:yde,node_complement_ar_frag:bde,node_composite_ar_frag:xde,node_cross_ar_frag:Ede,node_divide_ar_frag:Cde,node_dot_ar_frag:Sde,node_exp_ar_frag:wde,node_facing_ratio_ar_frag:Mde,node_flat_ar_frag:Tde,node_float_to_int_ar_frag:Ide,node_float_to_matrix_ar_frag:Rde,node_float_to_rgba_ar_frag:Lde,node_float_to_rgb_ar_frag:Pde,node_fraction_ar_frag:Dde,node_is_finite_ar_frag:Bde,node_image_ar_frag:Nde,node_lambert_ar_frag:Ode,node_length_ar_frag:kde,node_log_ar_frag:Fde,node_map_to_mtl_ar_frag:Vde,node_matrix_transform_ar_frag:Ude,node_max_ar_frag:zde,node_min_ar_frag:Gde,node_mix_shader_ar_frag:Hde,node_modulo_ar_frag:Wde,node_multiply_ar_frag:jde,node_negate_ar_frag:Qde,node_normalize_ar_frag:$de,node_normal_map_ar_frag:Yde,node_pow_ar_frag:Xde,node_random_ar_frag:qde,node_range_ar_frag:Kde,node_ray_switch_ar_frag:Zde,node_reciprocal_ar_frag:Jde,node_rgba_to_float_ar_frag:efe,node_rgb_to_float_ar_frag:tfe,node_rgb_to_vector_ar_frag:nfe,node_shadow_matte_ar_frag:rfe,node_shuffle_ar_frag:ofe,node_sign_ar_frag:ife,node_skydome_light_ar_frag:afe,node_sqrt_ar_frag:sfe,node_standard_surface_ar_frag:lfe,node_subtract_ar_frag:cfe,node_trigo_ar_frag:ufe,node_triplanar_ar_frag:dfe,node_triplanar_uv_ar_frag:ffe,node_two_sided_ar_frag:hfe,node_user_data_color_ar_frag:pfe,node_uv_projection_ar_frag:mfe,node_vector_to_rgb_ar_frag:gfe,node_add_shader_bl_frag:_fe,node_ambient_occlusion_bl_frag:vfe,node_attribute_bl_frag:Afe,node_background_bl_frag:yfe,node_bevel_bl_frag:bfe,node_blackbody_bl_frag:xfe,node_brightcontrast_bl_frag:Efe,node_bsdf_anisotropic_bl_frag:Cfe,node_bsdf_diffuse_bl_frag:Sfe,node_bsdf_glass_bl_frag:wfe,node_bsdf_glossy_bl_frag:Mfe,node_bsdf_metallic_bl_frag:Ife,node_bsdf_hair_bl_frag:Tfe,node_bsdf_principled_bl_frag:Rfe,node_bsdf_refraction_bl_frag:Lfe,node_bsdf_sheen_bl_frag:Pfe,node_bsdf_toon_bl_frag:Dfe,node_bsdf_translucent_bl_frag:Bfe,node_bsdf_transparent_bl_frag:Nfe,node_bsdf_velvet_bl_frag:Ofe,node_bump_bl_frag:kfe,node_camera_bl_frag:Ffe,node_clamp_bl_frag:Vfe,node_combhsv_bl_frag:Ufe,node_combine_color_bl_frag:zfe,node_combrgb_bl_frag:Gfe,node_combxyz_bl_frag:Hfe,node_curve_float_bl_frag:Wfe,node_curve_rgb_bl_frag:jfe,node_curve_vec_bl_frag:Qfe,node_diffuse_bsdf_bl_frag:$fe,node_displacement_bl_frag:Yfe,node_eevee_specular_bl_frag:Xfe,node_emission_bl_frag:qfe,node_fresnel_bl_frag:Kfe,node_gamma_bl_frag:Zfe,node_hair_info_bl_frag:Jfe,node_holdout_bl_frag:ehe,node_hue_sat_bl_frag:the,node_invert_bl_frag:nhe,node_layer_weight_bl_frag:rhe,node_light_falloff_bl_frag:ohe,node_light_path_bl_frag:ihe,node_mapping_bl_frag:ahe,node_map_range_bl_frag:she,node_math_bl_frag:lhe,node_mix_bl_frag:che,node_mix_rgb_bl_frag:uhe,node_mix_shader_bl_frag:dhe,node_new_geometry_bl_frag:fhe,node_normal_bl_frag:hhe,node_normal_map_bl_frag:phe,node_object_info_bl_frag:mhe,node_output_lamp_bl_frag:ghe,node_output_material_bl_frag:_he,node_output_world_bl_frag:vhe,node_particle_info_bl_frag:Ahe,node_point_info_bl_frag:yhe,node_principled_volume_bl_frag:bhe,node_rgb_bl_frag:xhe,node_rgbtobw_bl_frag:Ehe,node_script_bl_frag:Che,node_sephsv_bl_frag:She,node_separate_color_bl_frag:whe,node_seprgb_bl_frag:Mhe,node_sepxyz_bl_frag:The,node_shadertorgb_bl_frag:Ihe,node_squeeze_bl_frag:Rhe,node_subsurface_scattering_bl_frag:Lhe,node_tangent_bl_frag:Phe,node_tex_brick_bl_frag:Dhe,node_tex_checker_bl_frag:Bhe,node_tex_coord_bl_frag:Nhe,node_tex_environment_bl_frag:Ohe,node_tex_environment_none_bl_frag:khe,node_tex_gabor_bl_frag:Fhe,node_tex_gradient_bl_frag:Vhe,node_tex_ies_bl_frag:Uhe,node_tex_image_bl_frag:zhe,node_tex_image_none_bl_frag:Ghe,node_tex_magic_bl_frag:Hhe,node_tex_musgrave_bl_frag:Whe,node_tex_noise_bl_frag:jhe,node_tex_pointdensity_bl_frag:Qhe,node_tex_sky_bl_frag:$he,node_tex_voronoi_bl_frag:Yhe,node_tex_wave_bl_frag:Xhe,node_tex_white_noise_bl_frag:qhe,node_uvmap_bl_frag:Khe,node_valtorgb_bl_frag:Zhe,node_value_bl_frag:Jhe,node_vect_math_bl_frag:epe,node_vect_transform_bl_frag:tpe,node_vector_displacement_bl_frag:npe,node_vector_rotate_bl_frag:rpe,node_vertex_color_bl_frag:ope,node_volume_absorption_bl_frag:ipe,node_volume_info_bl_frag:ape,node_volume_scatter_bl_frag:spe,node_wavelength_bl_frag:lpe,node_wireframe_bl_frag:cpe,node_bitmap_none_mx_frag:upe,node_bitmap_env_mx_frag:dpe,node_bitmap_mx_frag:fpe,node_bump_mx_frag:hpe,node_blend_mx_frag:ppe,node_color_correction_mx_frag:mpe,node_color_map_mx_frag:gpe,node_composite_layer_mx_frag:_pe,node_falloff_mx_frag:vpe,node_gradient_mx_frag:Ape,node_gradient_ramp_mx_frag:ype,node_map_mx_frag:bpe,node_mask_mx_frag:xpe,node_material_mx_frag:Epe,node_matte_shadow_mx_frag:Cpe,node_mix_mx_frag:Spe,node_noise_mx_frag:wpe,node_normal_bump_mx_frag:Mpe,node_openpbr_surface_mx_frag:Tpe,node_output_map_mx_frag:Ipe,node_output_mx_frag:Rpe,node_physical_mx_frag:Lpe,node_phy_sun_sky_env_mx_frag:Ppe,node_reflect_refract_mx_frag:Dpe,node_reflect_refract_color_mx_frag:Bpe,node_rgb_multiply_mx_frag:Npe,node_rgb_tint_mx_frag:Ope,node_rgb_mx_frag:kpe,node_shellac_mx_frag:Fpe,node_sub_transform_mx_frag:Vpe,node_value_mx_frag:Upe,node_vertex_color_mx_frag:zpe,node_add_double_linear_my_frag:Gpe,node_add_matrix_my_frag:Hpe,node_anim_curve_ta_my_frag:Wpe,node_anim_curve_tu_my_frag:jpe,node_blend_colors_my_frag:Qpe,node_bulge_my_frag:Ype,node_blinn_my_frag:$pe,node_bump_2d_my_frag:Xpe,node_channels_my_frag:qpe,node_checker_my_frag:Kpe,node_clamp_my_frag:Zpe,node_cloth_my_frag:Jpe,node_color_condition_my_frag:eme,node_color_composite_my_frag:tme,node_color_constant_my_frag:nme,node_color_correct_my_frag:rme,node_color_logic_my_frag:ome,node_color_mask_my_frag:ime,node_color_math_my_frag:ame,node_compose_matrix_my_frag:sme,node_condition_my_frag:lme,node_decompose_matrix_my_frag:cme,node_env_sphere_my_frag:ume,node_file_my_frag:dme,node_float_condition_my_frag:fme,node_float_composite_my_frag:hme,node_float_constant_my_frag:pme,node_float_logic_my_frag:mme,node_float_mask_my_frag:gme,node_float_math_my_frag:_me,node_four_by_four_matrix_my_frag:vme,node_gamma_correct_my_frag:Ame,node_grid_my_frag:yme,node_inverse_matrix_my_frag:bme,node_lambert_my_frag:xme,node_layered_texture_layer_my_frag:Eme,node_luminance_my_frag:Cme,node_multiply_divide_my_frag:Sme,node_mult_double_linear_my_frag:wme,node_mult_matrix_my_frag:Mme,node_noise_my_frag:Tme,node_openpbr_surface_my_frag:Ime,node_output_my_frag:Rme,node_place_2d_texture_my_frag:Dme,node_phong_my_frag:Lme,node_phong_e_my_frag:Pme,node_premultiply_my_frag:Bme,node_ramp_my_frag:Nme,node_remap_hsv_my_frag:Ome,node_reverse_my_frag:kme,node_sampler_info_my_frag:Fme,node_set_range_my_frag:Vme,node_shading_engine_my_frag:Ume,node_sub_transform_my_frag:zme,node_surface_shader_my_frag:Gme,node_transform_my_frag:Hme,node_transpose_matrix_my_frag:Wme,node_unit_conversion_my_frag:jme,node_unpremultiply_my_frag:Qme,node_vector_product_my_frag:$me,node_wt_add_matrix_my_frag:Yme,pmrem_common_vert:Xme,pmrem_blur_frag:qme,pmrem_cubemap_frag:Kme,pmrem_equirect_frag:Zme,pp_plane_vert:Jme,pp_afterimage_frag:tge,pp_bloom_composite_frag:nge,pp_bloom_lum_high_pass_frag:rge,pp_bloom_separable_blur_frag:oge,pp_blur_frag:ige,pp_brightness_contrast_frag:sge,pp_bokeh_frag:age,pp_copy_frag:lge,pp_cube_octahedral_proj_frag:cge,pp_fxaa_frag:uge,pp_grayscale_frag:dge,pp_gtao_blur_frag:fge,pp_gtao_frag:hge,pp_outline_edge_frag:pge,pp_outline_blur_frag:mge,pp_outline_overlay_frag:gge,pp_tonemap_frag:_ge,pp_oit_weighted_frag:ege,raw_meshline_vert:vge,raw_meshline_frag:Age},qe={common:{diffuse:{value:new Ge(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new ao},uv2Transform:{value:new ao},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new be(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Ge(16777215)}},lights:{ambientLightColor:{value:[],needsUpdate:!0},lightProbe:{value:[],needsUpdate:!0},directionalLights:{value:[],needsUpdate:!0},directionalLightShadowsCSM:{value:[],needsUpdate:!0},directionalLightShadowsCSMCascade:{value:[],needsUpdate:!0},directionalShadowCSMMap:{value:[]},directionalShadowCSMMatrix:{value:[]},spotLights:{value:[],needsUpdate:!0},spotLightShadows:{value:[],needsUpdate:!0},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],needsUpdate:!0},pointLightShadows:{value:[],needsUpdate:!0},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],needsUpdate:!0},rectAreaLights:{value:[],needsUpdate:!0},rectAreaLightShadows:{value:[],needsUpdate:!0},rectAreaShadowMap:{value:[]},rectAreaShadowMatrix:{value:[]},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Ge(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new ao}},sprite:{diffuse:{value:new Ge(16777215)},opacity:{value:1},center:{value:new be(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new ao}},mask:{depthTexture:{value:null},cameraNearFar:{value:new be(.5,.5)},textureMatrix:{value:new Ue}},node:{nodeRGB:{value:[]},nodeValue:{value:[]},nodeInputsFloat:{value:[]},nodeInputsInt:{value:[]},nodeInputsBool:{value:[]},nodeInputsVec2:{value:[]},nodeInputsVec3:{value:[]},nodeInputsVec4:{value:[]},nodeInputsMat3:{value:[]},nodeInputsMat4:{value:[]},flipCubeMap:{value:-1},materialIndex:{value:0}},nodeGTAO:{gtaoMap:{value:null}},ssr:{invProjectionMatrix:{value:new Ue},ssrSourceBuffer:{value:null},ssrDepthBuffer:{value:null},ssrBackfaceDepthBuffer:{value:null},ssrStride:{value:20},ssrResolution:{value:new be},ssrThickness:{value:.01},ssrJitter:{value:1},ssrMaxDistance:{value:100}},planeReflectionProbe:{planeReflTexture:{value:null},planeReflTextureMatrix:{value:new Ue},planeReflDir:{value:new N},planeReflBoundingBoxMin:{value:new N},planeReflBoundingBoxMax:{value:new N},planeReflInvModelMatrix:{value:new Ue},planeReflFalloff:{value:0}}},Tt={basic:{uniforms:Fo([qe.common,qe.specularmap,qe.envmap,qe.aomap,qe.lightmap,qe.fog]),vertexShader:Qe.meshbasic_vert,fragmentShader:Qe.meshbasic_frag},lambert:{uniforms:Fo([qe.common,qe.specularmap,qe.envmap,qe.aomap,qe.lightmap,qe.emissivemap,qe.bumpmap,qe.normalmap,qe.displacementmap,qe.fog,qe.lights,{emissive:{value:new Ge(0)}}]),vertexShader:Qe.meshlambert_vert,fragmentShader:Qe.meshlambert_frag},standard:{uniforms:Fo([qe.common,qe.envmap,qe.aomap,qe.lightmap,qe.emissivemap,qe.bumpmap,qe.normalmap,qe.displacementmap,qe.roughnessmap,qe.metalnessmap,qe.fog,qe.lights,qe.planeReflectionProbe,{emissive:{value:new Ge(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1},envMapParallaxType:{value:0},envMapParallaxMatrix:{value:new Ue},envMapParallaxMatrixInv:{value:new Ue}}]),vertexShader:Qe.meshphysical_vert,fragmentShader:Qe.meshphysical_frag},points:{uniforms:Fo([qe.points,qe.fog]),vertexShader:Qe.points_vert,fragmentShader:Qe.points_frag},dashed:{uniforms:Fo([qe.common,qe.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Qe.linedashed_vert,fragmentShader:Qe.linedashed_frag},depth:{uniforms:Fo([qe.common,qe.displacementmap,{slopeScaledBias:{value:0}}]),vertexShader:Qe.depth_vert,fragmentShader:Qe.depth_frag},normal:{uniforms:Fo([qe.common,qe.bumpmap,qe.normalmap,qe.displacementmap,{opacity:{value:1}}]),vertexShader:Qe.meshnormal_vert,fragmentShader:Qe.meshnormal_frag},sprite:{uniforms:Fo([qe.sprite,qe.fog]),vertexShader:Qe.sprite_vert,fragmentShader:Qe.sprite_frag},background:{uniforms:{uvTransform:{value:new ao},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:Qe.background_vert,fragmentShader:Qe.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1}},vertexShader:Qe.backgroundCube_vert,fragmentShader:Qe.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Qe.cube_vert,fragmentShader:Qe.cube_frag},equirect:{uniforms:{tEquirect:{value:null},invertU:{value:!1},offsetU:{value:0}},vertexShader:Qe.equirect_vert,fragmentShader:Qe.equirect_frag},distanceRGBA:{uniforms:Fo([qe.common,qe.displacementmap,{referencePosition:{value:new N},nearDistance:{value:1},farDistance:{value:1e3},slopeScaledBias:{value:0}}]),vertexShader:Qe.distanceRGBA_vert,fragmentShader:Qe.distanceRGBA_frag},shadow:{uniforms:Fo([qe.lights,qe.fog,{color:{value:new Ge(0)},opacity:{value:1}}]),vertexShader:Qe.shadow_vert,fragmentShader:Qe.shadow_frag},mask:{uniforms:Fo([qe.common,qe.displacementmap,qe.mask]),vertexShader:Qe.mask_vert,fragmentShader:Qe.mask_frag},node:{uniforms:Fo([qe.common,qe.displacementmap,qe.envmap,qe.fog,qe.lights,qe.ssr,qe.planeReflectionProbe,qe.node,qe.nodeGTAO,{envMapIntensity:{value:1},envMapParallaxType:{value:0},envMapParallaxMatrix:{value:new Ue},envMapParallaxMatrixInv:{value:new Ue}}]),vertexShader:Qe.meshnode_vert,fragmentShader:Qe.meshnode_frag},cubeOctahedral:{uniforms:{tCube:{value:null},texelSize:{value:new be(.5,.5)}},vertexShader:Qe.pp_plane_vert,fragmentShader:Qe.pp_cube_octahedral_proj_frag}};Tt.physical={uniforms:Fo([Tt.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new be(1,1)},clearcoatNormalMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new be},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new Ge(0)},specularIntensity:{value:1},specularIntensityMap:{value:null},specularColor:{value:new Ge(1,1,1)},specularColorMap:{value:null}}]),vertexShader:Qe.meshphysical_vert,fragmentShader:Qe.meshphysical_frag},Tt.copy={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:Qe.pp_plane_vert,fragmentShader:Qe.pp_copy_frag},Tt.bokeh={defines:{DEPTH_PACKING:1,PERSPECTIVE_CAMERA:1},uniforms:{tColor:{value:null},tDepth:{value:null},focus:{value:1},aspect:{value:1},aperture:{value:.025},maxblur:{value:1},nearClip:{value:1},farClip:{value:1e3},depthLeakThreshold:{value:.2}},vertexShader:Qe.pp_plane_vert,fragmentShader:Qe.pp_bokeh_frag},Tt.fxaa={uniforms:{tDiffuse:{value:null},resolution:{value:new be(1/1024,1/512)}},vertexShader:Qe.pp_plane_vert,fragmentShader:Qe.pp_fxaa_frag},Tt.grayscale={uniforms:{tDiffuse:{value:null}},vertexShader:Qe.pp_plane_vert,fragmentShader:Qe.pp_grayscale_frag},Tt.brightness_contrast={uniforms:{tDiffuse:{value:null},brightness:{value:0},contrast:{value:0}},vertexShader:Qe.pp_plane_vert,fragmentShader:Qe.pp_brightness_contrast_frag},Tt.bloomLumHighPass={uniforms:{tDiffuse:{type:"t",value:null},luminosityThreshold:{type:"f",value:1},smoothWidth:{type:"f",value:1},defaultColor:{type:"c",value:new Ge(0)},defaultOpacity:{type:"f",value:0}},vertexShader:Qe.pp_plane_vert,fragmentShader:Qe.pp_bloom_lum_high_pass_frag},Tt.blur={defines:{LOG_SPACE:0,OCTAHEDRAL_MAP:0},uniforms:{colorTexture:{value:null},texSize:{value:new be(.5,.5)},direction:{value:new be(.5,.5)},kernelRadius:{value:1}},customPrepTokens:{MAX_SAMPLE_RADIUS:4},vertexShader:Qe.pp_plane_vert,fragmentShader:Qe.pp_blur_frag},Tt.tonemap={uniforms:{tDiffuse:{value:null}},vertexShader:Qe.pp_plane_vert,fragmentShader:Qe.pp_tonemap_frag},Tt.afterimage={uniforms:{damp:{value:.96},tOld:{value:null},tNew:{value:null}},vertexShader:Qe.pp_plane_vert,fragmentShader:Qe.pp_afterimage_frag},Tt.oitWeighted={uniforms:{tRGBABuffer:{value:null},tFloatBuffer:{value:null}},vertexShader:Qe.pp_plane_vert,fragmentShader:Qe.pp_oit_weighted_frag};const c0={r:0,b:0,g:0};function yge(n,e,t,r,o,i,a){const s=new Ge(0);let l,c,u=i===!0?0:1,d=null,f=0,h=null;function p(m,g){m.getRGB(c0,tL(n)),r.buffers.color.setClear(c0.r,c0.g,c0.b,g,a)}return{getClearColor:function(){return s},setClearColor:function(m,g=1){s.set(m),u=g,p(s,u)},getClearAlpha:function(){return u},setClearAlpha:function(m){u=m,p(s,u)},dispose:function(){l&&(l.geometry.dispose(),l.material.dispose()),l=void 0,c&&(c.geometry.dispose(),c.material.dispose()),c=void 0},render:function(m,g){let _=!1,A=g.isScene===!0?g.background:null;A&&A.isTexture&&(A=(g.backgroundBlurriness>0?t:e).get(A));const y=n.xr,b=y.getSession&&y.getSession();b&&b.environmentBlendMode==="additive"&&(A=null),A===null?p(s,u):A&&A.isColor&&(p(A,1),_=!0),(n.autoClear||_)&&n.clear(n.autoClearColor,n.autoClearDepth,n.autoClearStencil),A&&(A.isCubeTexture||A.mapping===306)?(c===void 0&&(c=new Mt(new nc(1,1,1),new Dn({type:"BackgroundCubeMaterial",uniforms:Ou(Tt.backgroundCube.uniforms),vertexShader:Tt.backgroundCube.vertexShader,fragmentShader:Tt.backgroundCube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1})),c.geometry.deleteAttribute("normal"),c.geometry.deleteAttribute("uv"),c.onBeforeRender=function(E,x,w){const L=w.far;this.matrixWorld.makeScale(L,L,L),this.matrixWorld.copyPosition(w.matrixWorld)},Object.defineProperty(c.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),o.update(c)),c.material.uniforms.envMap.value=A,c.material.uniforms.flipEnvMap.value=A.isCubeTexture&&A.isRenderTargetTexture===!1?-1:1,c.material.uniforms.backgroundBlurriness.value=g.backgroundBlurriness,c.material.uniforms.backgroundIntensity.value=g.backgroundIntensity,c.material.toneMapped=g.backgroundToneMapped,d===A&&f===A.version&&h===n.toneMapping||(c.material.needsUpdate=!0,d=A,f=A.version,h=n.toneMapping),c.layers.enableAll(),m.unshift(c,c.geometry,c.material,0,0,null)):A&&A.isTexture&&(l===void 0&&(l=new Mt(new ms(2,2),new Dn({type:"BackgroundMaterial",uniforms:Ou(Tt.background.uniforms),vertexShader:Tt.background.vertexShader,fragmentShader:Tt.background.fragmentShader,side:0,depthTest:!1,depthWrite:!1,fog:!1})),l.geometry.deleteAttribute("normal"),Object.defineProperty(l.material,"map",{get:function(){return this.uniforms.t2D.value}}),o.update(l)),l.material.uniforms.t2D.value=A,l.material.uniforms.backgroundIntensity.value=g.backgroundIntensity,l.material.toneMapped=g.backgroundToneMapped,A.matrixAutoUpdate===!0&&A.updateMatrix(),l.material.uniforms.uvTransform.value.copy(A.matrix),d===A&&f===A.version&&h===n.toneMapping||(l.material.needsUpdate=!0,d=A,f=A.version,h=n.toneMapping),l.layers.enableAll(),m.unshift(l,l.geometry,l.material,0,0,null))}}}function bge(n,e,t,r){const o=n.getParameter(34921),i=r.isWebGL2?null:e.get("OES_vertex_array_object"),a=r.isWebGL2||i!==null,s={},l=h(null);let c=l,u=!1;function d(E){return r.isWebGL2?n.bindVertexArray(E):i.bindVertexArrayOES(E)}function f(E){return r.isWebGL2?n.deleteVertexArray(E):i.deleteVertexArrayOES(E)}function h(E){const x=[],w=[],L=[];for(let C=0;C<o;C++)x[C]=0,w[C]=0,L[C]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:x,enabledAttributes:w,attributeDivisors:L,object:E,attributes:{},index:null}}function p(){const E=c.newAttributes;for(let x=0,w=E.length;x<w;x++)E[x]=0}function m(E){g(E,0)}function g(E,x){const w=c.newAttributes,L=c.enabledAttributes,C=c.attributeDivisors;w[E]=1,L[E]===0&&(n.enableVertexAttribArray(E),L[E]=1),C[E]!==x&&((r.isWebGL2?n:e.get("ANGLE_instanced_arrays"))[r.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](E,x),C[E]=x)}function _(){const E=c.newAttributes,x=c.enabledAttributes;for(let w=0,L=x.length;w<L;w++)x[w]!==E[w]&&(n.disableVertexAttribArray(w),x[w]=0)}function A(E,x,w,L,C,P,D){D===!0?n.vertexAttribIPointer(E,x,w,C,P):n.vertexAttribPointer(E,x,w,L,C,P)}function y(){b(),u=!0,c!==l&&(c=l,d(c.object))}function b(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:function(E,x,w,L,C){let P=!1;if(a){const D=(function(Q,re,G){const se=G.wireframe===!0;let ee=s[Q.id];ee===void 0&&(ee={},s[Q.id]=ee);let ie=ee[re.id];ie===void 0&&(ie={},ee[re.id]=ie);let H=ie[se];return H===void 0&&(H=h(r.isWebGL2?n.createVertexArray():i.createVertexArrayOES()),ie[se]=H),H})(L,w,x);c!==D&&(c=D,d(c.object)),P=(function(Q,re,G,se){const ee=c.attributes,ie=re.attributes;let H=0;const T=G.getAttributes();for(const R in T)if(T[R].location>=0){const O=ee[R];let W=ie[R];if(W===void 0&&(R==="instanceMatrix"&&Q.instanceMatrix&&(W=Q.instanceMatrix),R==="instanceColor"&&Q.instanceColor&&(W=Q.instanceColor)),O===void 0||O.attribute!==W||W&&O.data!==W.data)return!0;H++}return c.attributesNum!==H||c.index!==se})(E,L,w,C),P&&(function(Q,re,G,se){const ee={},ie=re.attributes;let H=0;const T=G.getAttributes();for(const R in T)if(T[R].location>=0){let O=ie[R];O===void 0&&(R==="instanceMatrix"&&Q.instanceMatrix&&(O=Q.instanceMatrix),R==="instanceColor"&&Q.instanceColor&&(O=Q.instanceColor));const W={};W.attribute=O,O&&O.data&&(W.data=O.data),ee[R]=W,H++}c.attributes=ee,c.attributesNum=H,c.index=se})(E,L,w,C)}else{const D=x.wireframe===!0;c.geometry===L.id&&c.program===w.id&&c.wireframe===D||(c.geometry=L.id,c.program=w.id,c.wireframe=D,P=!0)}C!==null&&t.update(C,34963),(P||u)&&(u=!1,(function(D,Q,re,G){if(r.isWebGL2===!1&&(D.isInstancedMesh||G.isInstancedBufferGeometry)&&e.get("ANGLE_instanced_arrays")===null)return;p();const se=G.attributes,ee=re.getAttributes(),ie=Q.defaultAttributeValues;for(const H in ee){const T=ee[H];if(T.location>=0){let R=se[H];if(R===void 0&&(H==="instanceMatrix"&&D.instanceMatrix&&(R=D.instanceMatrix),H==="instanceColor"&&D.instanceColor&&(R=D.instanceColor)),R!==void 0){const O=R.normalized,W=R.itemSize,ae=t.get(R);if(ae===void 0)continue;const ne=ae.buffer,oe=ae.type,F=ae.bytesPerElement,k=r.isWebGL2===!0&&(oe===5124||oe===5125||R.gpuType===1013);if(R.isInstancedBufferAttribute){for(let q=0;q<T.locationSize;q++)g(T.location+q,R.meshPerAttribute);D.isInstancedMesh!==!0&&G._maxInstanceCount===void 0&&(G._maxInstanceCount=R.meshPerAttribute*R.count)}else for(let q=0;q<T.locationSize;q++)m(T.location+q);n.bindBuffer(34962,ne);for(let q=0;q<T.locationSize;q++)A(T.location+q,W/T.locationSize,oe,O,W*F,W/T.locationSize*q*F,k)}else if(ie!==void 0){const O=ie[H];if(O!==void 0)switch(O.length){case 2:n.vertexAttrib2fv(T.location,O);break;case 3:n.vertexAttrib3fv(T.location,O);break;case 4:n.vertexAttrib4fv(T.location,O);break;default:n.vertexAttrib1fv(T.location,O)}}}}_()})(E,x,w,L),C!==null&&n.bindBuffer(34963,t.get(C).buffer))},reset:y,resetDefaultState:b,dispose:function(){y();for(const E in s){const x=s[E];for(const w in x){const L=x[w];for(const C in L)f(L[C].object),delete L[C];delete x[w]}delete s[E]}},releaseStatesOfGeometry:function(E){if(s[E.id]===void 0)return;const x=s[E.id];for(const w in x){const L=x[w];for(const C in L)f(L[C].object),delete L[C];delete x[w]}delete s[E.id]},releaseStatesOfProgram:function(E){for(const x in s){const w=s[x];if(w[E.id]===void 0)continue;const L=w[E.id];for(const C in L)f(L[C].object),delete L[C];delete w[E.id]}},initAttributes:p,enableAttribute:m,disableUnusedAttributes:_}}function xge(n,e,t,r){const o=r.isWebGL2;let i;this.setMode=function(a){i=a},this.render=function(a,s){n.drawArrays(i,a,s),t.update(s,i,1)},this.renderInstances=function(a,s,l){if(l===0)return;let c,u;if(o)c=n,u="drawArraysInstanced";else if(c=e.get("ANGLE_instanced_arrays"),u="drawArraysInstancedANGLE",c===null)return void console.error("v3d.WebGLBufferRenderer: using v3d.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");c[u](i,a,s,l),t.update(s,i,l)}}function Ege(n,e,t){let r;function o(b){if(b==="highp"){if(n.getShaderPrecisionFormat(35633,36338).precision>0&&n.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";b="mediump"}return b==="mediump"&&n.getShaderPrecisionFormat(35633,36337).precision>0&&n.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const i=typeof WebGL2RenderingContext<"u"&&n instanceof WebGL2RenderingContext||typeof WebGL2ComputeRenderingContext<"u"&&n instanceof WebGL2ComputeRenderingContext;let a=t.precision!==void 0?t.precision:"highp";const s=o(a);s!==a&&(console.warn("v3d.WebGLRenderer:",a,"not supported, using",s,"instead."),a=s);const l=i||e.has("WEBGL_draw_buffers"),c=t.logarithmicDepthBuffer===!0,u=n.getParameter(34930),d=n.getParameter(35660),f=n.getParameter(3379),h=n.getParameter(34076),p=n.getParameter(34921),m=n.getParameter(36347),g=n.getParameter(36348),_=n.getParameter(36349),A=d>0,y=i||e.has("OES_texture_float");return{isWebGL2:i,drawBuffers:l,getMaxAnisotropy:function(){if(r!==void 0)return r;if(e.has("EXT_texture_filter_anisotropic")===!0){const b=e.get("EXT_texture_filter_anisotropic");r=n.getParameter(b.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else r=0;return r},getMaxPrecision:o,precision:a,logarithmicDepthBuffer:c,maxTextures:u,maxVertexTextures:d,maxTextureSize:f,maxCubemapSize:h,maxAttributes:p,maxVertexUniforms:m,maxVaryings:g,maxFragmentUniforms:_,vertexTextures:A,floatFragmentTextures:y,floatVertexTextures:A&&y,maxSamples:i?n.getParameter(36183):0}}function Cge(n){const e=this;let t=null,r=0,o=!1,i=!1;const a=new Vo,s=new ao,l={value:null,needsUpdate:!1};function c(){l.value!==t&&(l.value=t,l.needsUpdate=r>0),e.numPlanes=r,e.numIntersection=0}function u(d,f,h,p){const m=d!==null?d.length:0;let g=null;if(m!==0){if(g=l.value,p!==!0||g===null){const _=h+4*m,A=f.matrixWorldInverse;s.getNormalMatrix(A),(g===null||g.length<_)&&(g=new Float32Array(_));for(let y=0,b=h;y!==m;++y,b+=4)a.copy(d[y]).applyMatrix4(A,s),a.normal.toArray(g,b),g[b+3]=a.constant}l.value=g,l.needsUpdate=!0}return e.numPlanes=m,e.numIntersection=0,g}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(d,f,h){const p=d.length!==0||f||r!==0||o;return o=f,t=u(d,h,0),r=d.length,p},this.beginShadows=function(){i=!0,u(null)},this.endShadows=function(){i=!1,c()},this.setState=function(d,f,h){const p=d.clippingPlanes,m=d.clipIntersection,g=d.clipShadows,_=n.get(d);if(!o||p===null||p.length===0||i&&!g)i?u(null):c();else{const A=i?0:r,y=4*A;let b=_.clippingState||null;l.value=b,b=u(p,f,y,h);for(let E=0;E!==y;++E)b[E]=t[E];_.clippingState=b,this.numIntersection=m?this.numPlanes:0,this.numPlanes+=A}}}function Sge(n){let e=new WeakMap;function t(o,i){return i===303?o.mapping=301:i===304&&(o.mapping=302),o}function r(o){const i=o.target;i.removeEventListener("dispose",r);const a=e.get(i);a!==void 0&&(e.delete(i),a.dispose())}return{get:function(o){if(o&&o.isTexture&&o.isRenderTargetTexture===!1){const i=o.mapping;if(i===303||i===304){if(e.has(o))return t(e.get(o).texture,o.mapping);{const a=o.image;if(a&&a.height>0){const s=new hh(a.height/2);return s.fromEquirectangularTexture(n,o),e.set(o,s),o.addEventListener("dispose",r),t(s.texture,o.mapping)}return null}}}return o},dispose:function(){e=new WeakMap}}}class ya extends fh{constructor(e=-1,t=1,r=1,o=-1,i=.1,a=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=r,this.bottom=o,this.near=i,this.far=a,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,r,o,i,a){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=r,this.view.offsetY=o,this.view.width=i,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),r=(this.right+this.left)/2,o=(this.top+this.bottom)/2;let i=r-e,a=r+e,s=o+t,l=o-t;if(this.view!==null&&this.view.enabled){const c=(this.right-this.left)/this.view.fullWidth/this.zoom,u=(this.top-this.bottom)/this.view.fullHeight/this.zoom;i+=c*this.view.offsetX,a=i+c*this.view.width,s-=u*this.view.offsetY,l=s-u*this.view.height}this.projectionMatrix.makeOrthographic(i,a,s,l,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}}class mh extends Dn{constructor(e){super(e),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}let u0=256;const Fu=[{relSize:1,sigma:0,origin:[0,0]},{relSize:.5,sigma:.025,origin:[0,2/3]},{relSize:1/4,sigma:.07,origin:[.5,2/3]},{relSize:1/8,sigma:.18,origin:[.75,2/3]},{relSize:1/16,sigma:.24,origin:[.875,2/3]},{relSize:1/16,sigma:.3,origin:[.875,17/24]},{relSize:1/16,sigma:.36,origin:[.875,.75]},{relSize:1/16,sigma:.42,origin:[.875,19/24]},{relSize:1/16,sigma:.48,origin:[.875,20/24]},{relSize:1/16,sigma:.54,origin:[.875,.875]},{relSize:1/16,sigma:.6,origin:[.875,22/24]}];function ul(n){return Fu[n].relSize*u0}function wge(n){return Fu[n].origin.map((function(e){return e*u0*3}))}const d0=new ya,Vu=Mge(),rL=new Ge;let R2=null;const rc=(1+Math.sqrt(5))/2,Uu=1/rc,oL=[new N(1,1,1),new N(-1,1,1),new N(1,1,-1),new N(-1,1,-1),new N(0,rc,Uu),new N(0,rc,-Uu),new N(Uu,0,rc),new N(-Uu,0,rc),new N(rc,Uu,0),new N(-rc,Uu,0)];class gh{constructor(e,t){this._renderer=e,this._pingPongRenderTarget=null,this._equirectShader=null,this._cubemapShader=null,this.flipCubemapX=!1,Object.defineProperties(this,{maxTileSize:{get:function(){return u0},set:function(r){u0=r}}}),t!==void 0&&(this.maxTileSize=t),this._blurMaterial=Tge(20,this.maxTileSize),this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,r=.1,o=100){R2=this._renderer.getRenderTarget();const i=this._allocateTargets();return this._sceneToCubeUV(e,r,o,i),t>0&&this._blur(i,0,0,t),this._applyPMREM(i),this._cleanup(i),i}fromEquirectangular(e){return e.magFilter=1006,e.minFilter=1006,e.generateMipmaps=!1,this.fromCubemap(e)}fromCubemap(e){R2=this._renderer.getRenderTarget();const t=this._allocateTargets(e);return this._textureToCubeUV(e,t,this.flipCubemapX),this._applyPMREM(t),this._cleanup(t),t}fromCubeRenderTarget(e,t){const r=this._allocateTargets(e.texture,t);return this._cubeRTToCubeUV(e,r,this.flipCubemapX),this._applyPMREM(r),this._cleanup(r),r}compileCubemapShader(){this._cubemapShader===null&&(this._cubemapShader=L2(),this._compileMaterial(this._cubemapShader))}compileEquirectangularShader(){this._equirectShader===null&&(this._equirectShader=aL(),this._compileMaterial(this._equirectShader))}dispose(){this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose(),this._cubemapShader!==null&&this._cubemapShader.dispose(),this._equirectShader!==null&&this._equirectShader.dispose();for(let e=0;e<Vu.length;e++)Vu[e].dispose();this._renderer=null}_cleanup(e){this._renderer.setRenderTarget(R2),e.scissorTest=!1,e.setSize(e.width,e.height)}_allocateTargets(e,t){const r={magFilter:1006,minFilter:1006,generateMipmaps:!1,type:e?e.type:1016,format:e?e.format:1023,encoding:e?e.encoding:3e3,depthBuffer:!1,stencilBuffer:!1};t!==void 0&&Object.assign(r,t);const o=iL(r);return o.depthBuffer=!e,this._pingPongRenderTarget===null&&(this._pingPongRenderTarget=iL(r)),o}_compileMaterial(e){const t=new jr;t.add(new Mt(Vu[0],e)),this._renderer.compile(t,d0)}_sceneToCubeUV(e,t,r,o){const i=new gr(90,1,t,r),a=[1,1,1,1,-1,1],s=[1,1,-1,-1,-1,1],l=this._renderer,c=l.outputEncoding,u=l.toneMapping,d=l.toneMappingExposure;l.getClearColor(rL);const f=l.getClearAlpha();l.toneMapping=1,l.toneMappingExposure=1,l.outputEncoding=3e3,e.scale.z*=-1;let h=e.background;if(h&&h.isColor){h.convertSRGBToLinear();const p=Math.max(h.r,h.g,h.b),m=Math.min(Math.max(Math.ceil(Math.log2(p)),-128),127);h=h.multiplyScalar(Math.pow(2,-m));const g=(m+128)/255;l.setClearColor(h,g),e.background=null}for(let p=0;p<6;p++){const m=p%3;m===0?(i.up.set(0,a[p],0),i.lookAt(s[p],0,0)):m===1?(i.up.set(0,0,a[p]),i.lookAt(0,s[p],0)):(i.up.set(0,a[p],0),i.lookAt(0,0,s[p]));const g=ul(0);f0(o,m*g,p>2?g:0,g,g),l.setRenderTarget(o),l.render(e,i)}l.toneMapping=u,l.toneMappingExposure=d,l.outputEncoding=c,l.setClearColor(rL,f),e.scale.z*=-1}_textureToCubeUV(e,t,r){const o=this._renderer,i=new jr;e.isCubeTexture?this._cubemapShader===null&&(this._cubemapShader=L2()):this._equirectShader===null&&(this._equirectShader=aL());const a=e.isCubeTexture?this._cubemapShader:this._equirectShader;i.add(new Mt(Vu[0],a));const s=a.uniforms;s.envMap.value=e,e.isCubeTexture?s.flipCubemapX.value=r||!1:s.texelSize.value.set(1/e.image.width,1/e.image.height);const l=ul(0);f0(t,0,0,3*l,2*l),o.setRenderTarget(t),o.render(i,d0)}_applyPMREM(e){const t=this._renderer,r=t.autoClear;t.autoClear=!1;for(let o=1;o<Fu.length;o++){const i=Fu[o].sigma,a=Fu[o-1].sigma,s=Math.sqrt(i*i-a*a),l=oL[(o-1)%oL.length];this._blur(e,o-1,o,s,l)}t.autoClear=r}_blur(e,t,r,o,i){const a=this._pingPongRenderTarget;this._halfBlur(e,a,t,r,o,"latitudinal",i),this._halfBlur(a,e,r,r,o,"longitudinal",i)}_halfBlur(e,t,r,o,i,a,s){const l=this._renderer,c=this._blurMaterial;a!=="latitudinal"&&a!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const u=new jr;u.add(new Mt(Vu[o],c));const d=c.uniforms,f=ul(r)-1;let h=isFinite(i)?Math.PI/(2*f):2*Math.PI/39,p=i/h,m=isFinite(i)?1+Math.floor(3*p):20;m>20&&(m=20,p=19/3,h=i/p);const g=[];let _=0;for(let E=0;E<20;++E){const x=E/p,w=Math.exp(-x*x/2);g.push(w),E===0?_+=w:E<m&&(_+=2*w)}for(let E=0;E<g.length;E++)g[E]=g[E]/_;d.envMap.value=e.texture,d.samples.value=m,d.weights.value=g,d.latitudinal.value=a==="latitudinal",s&&(d.poleAxis.value=s),d.dTheta.value=h,d.lodIdx.value=r,c.defines.cubeUV_maxTileSize=Js(ul(0));const[A,y]=wge(o),b=ul(o);f0(t,A,y,3*b,2*b),l.setRenderTarget(t),l.render(u,d0)}_cubeRTToCubeUV(e,t,r){const o=this._renderer,i=new jr;this._cubemapShader==null&&(this._cubemapShader=L2());const a=this._cubemapShader;i.add(new Mt(Vu[0],a));const s=a.uniforms;s.envMap.value=e.texture,s.flipCubemapX.value=r||!1;const l=ul(0);f0(t,0,0,3*l,2*l),o.setRenderTarget(t),o.render(i,d0)}}function Mge(){return Fu.map((function(n,e){const t=1/(ul(e)-1),r=-t/2,o=1+t/2,i=[r,r,o,r,o,o,r,r,o,o,r,o],a=new Float32Array(108),s=new Float32Array(72),l=new Float32Array(36);for(let u=0;u<6;u++){const d=u%3*2/3-1,f=u>2?0:-1,h=[d,f,0,d+2/3,f,0,d+2/3,f+1,0,d,f,0,d+2/3,f+1,0,d,f+1,0];a.set(h,18*u),s.set(i,12*u);const p=[u,u,u,u,u,u];l.set(p,6*u)}const c=new At;return c.setAttribute("position",new Xe(a,3)),c.setAttribute("uv",new Xe(s,2)),c.setAttribute("faceIndex",new Xe(l,1)),c}))}function iL(n){const e=ul(0),t=new nn(3*e,3*e,n);return t.texture.mapping=306,t.texture.name="PMREM.cubeUV",t.scissorTest=!0,t}function f0(n,e,t,r,o){n.viewport.set(e,t,r,o),n.scissor.set(e,t,r,o)}function Tge(n,e){const t=new Float32Array(n),r=new N(0,1,0),o=new mh({defines:{n,cubeUV_maxTileSize:Js(e)},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:t},latitudinal:{value:!1},dTheta:{value:0},lodIdx:{value:0},poleAxis:{value:r}},vertexShader:Qe.pmrem_common_vert,fragmentShader:Qe.pmrem_blur_frag,blending:0,depthTest:!1,depthWrite:!1});return o.type="SphericalGaussianBlur",o}function aL(){const n=new be(1,1),e=new mh({uniforms:{envMap:{value:null},texelSize:{value:n}},vertexShader:Qe.pmrem_common_vert,fragmentShader:Qe.pmrem_equirect_frag,blending:0,depthTest:!1,depthWrite:!1});return e.type="EquirectangularToCubeUV",e}function L2(){const n=new mh({uniforms:{envMap:{value:null},flipCubemapX:{value:!1}},vertexShader:Qe.pmrem_common_vert,fragmentShader:Qe.pmrem_cubemap_frag,blending:0,depthTest:!1,depthWrite:!1});return n.type="CubemapToCubeUV",n}function Ige(n){let e=new WeakMap,t=null;function r(o){const i=o.target;i.removeEventListener("dispose",r);const a=e.get(i);a!==void 0&&(e.delete(i),a.dispose())}return{get:function(o){if(o&&o.isTexture){const i=o.mapping,a=i===303||i===304,s=i===301||i===302;if(a||s){if(o.isRenderTargetTexture&&o.needsPMREMUpdate===!0){o.needsPMREMUpdate=!1;let l=e.get(o);return t===null&&(t=new gh(n)),l=a?t.fromEquirectangular(o,l):t.fromCubemap(o,l),e.set(o,l),l.texture}if(e.has(o))return e.get(o).texture;{const l=o.image;if(a&&l&&l.height>0||s&&l&&(function(c){let u=0;const d=6;for(let f=0;f<d;f++)c[f]!==void 0&&u++;return u===d})(l)){t===null&&(t=new gh(n));const c=a?t.fromEquirectangular(o):t.fromCubemap(o);return e.set(o,c),o.addEventListener("dispose",r),c.texture}return null}}}return o},dispose:function(){e=new WeakMap,t!==null&&(t.dispose(),t=null)}}}function Rge(n){const e={};function t(r){if(e[r]!==void 0)return e[r];let o;switch(r){case"WEBGL_depth_texture":o=n.getExtension("WEBGL_depth_texture")||n.getExtension("MOZ_WEBGL_depth_texture")||n.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":o=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":o=n.getExtension("WEBGL_compressed_texture_s3tc")||n.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":o=n.getExtension("WEBGL_compressed_texture_pvrtc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:o=n.getExtension(r)}return e[r]=o,o}return{has:function(r){return t(r)!==null},init:function(r){r.isWebGL2?t("EXT_color_buffer_float"):(t("WEBGL_depth_texture"),t("OES_texture_float"),t("OES_texture_half_float"),t("OES_texture_half_float_linear"),t("OES_standard_derivatives"),t("OES_element_index_uint"),t("OES_vertex_array_object"),t("ANGLE_instanced_arrays")),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float"),t("WEBGL_multisampled_render_to_texture")},get:function(r){const o=t(r);return o===null&&console.warn("v3d.WebGLRenderer: "+r+" extension not supported."),o}}}function Lge(n,e,t,r){const o={},i=new WeakMap;function a(l){const c=l.target;c.index!==null&&e.remove(c.index);for(const d in c.attributes)e.remove(c.attributes[d]);c.removeEventListener("dispose",a),delete o[c.id];const u=i.get(c);u&&(e.remove(u),i.delete(c)),r.releaseStatesOfGeometry(c),c.isInstancedBufferGeometry===!0&&delete c._maxInstanceCount,t.memory.geometries--}function s(l){const c=[],u=l.index,d=l.attributes.position;let f=0;if(u!==null){const m=u.array;f=u.version;for(let g=0,_=m.length;g<_;g+=3){const A=m[g+0],y=m[g+1],b=m[g+2];c.push(A,y,y,b,b,A)}}else{const m=d.array;f=d.version;for(let g=0,_=m.length/3-1;g<_;g+=3){const A=g+0,y=g+1,b=g+2;c.push(A,y,y,b,b,A)}}const h=new(BR(c)?JR:ZR)(c,1);h.version=f;const p=i.get(l);p&&e.remove(p),i.set(l,h)}return{get:function(l,c){return o[c.id]===!0||(c.addEventListener("dispose",a),o[c.id]=!0,t.memory.geometries++),c},update:function(l){const c=l.attributes;for(const d in c)e.update(c[d],34962);const u=l.morphAttributes;for(const d in u){const f=u[d];for(let h=0,p=f.length;h<p;h++)e.update(f[h],34962)}},getWireframeAttribute:function(l){const c=i.get(l);if(c){const u=l.index;u!==null&&c.version<u.version&&s(l)}else s(l);return i.get(l)}}}function Pge(n,e,t,r){const o=r.isWebGL2;let i,a,s;this.setMode=function(l){i=l},this.setIndex=function(l){a=l.type,s=l.bytesPerElement},this.render=function(l,c){n.drawElements(i,c,a,l*s),t.update(c,i,1)},this.renderInstances=function(l,c,u){if(u===0)return;let d,f;if(o)d=n,f="drawElementsInstanced";else if(d=e.get("ANGLE_instanced_arrays"),f="drawElementsInstancedANGLE",d===null)return void console.error("v3d.WebGLIndexedBufferRenderer: using v3d.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");d[f](i,c,a,l*s,u),t.update(c,i,u)}}function Dge(n){const e={geometries:0,textures:0,textureSpecs:new Map},t={frame:0,calls:0,triangles:0,points:0,lines:0,customCounter:0};return{memory:e,render:t,programs:null,numShaderCompiles:0,reset:function(){t.calls=0,t.triangles=0,t.points=0,t.lines=0,t.customCounter=0},update:function(r,o,i){switch(t.calls++,o){case 4:t.triangles+=i*(r/3);break;case 1:t.lines+=i*(r/2);break;case 3:t.lines+=i*(r-1);break;case 2:t.lines+=i*r;break;case 0:t.points+=i*r;break;default:console.error("v3d.WebGLInfo: Unknown draw mode:",o)}},count:function(){t.customCounter++},addTextureSpec:function(r){let o,i,a,s,l,c;r.isWebGLRenderTarget?(o=r.texture.name,i="RenderTarget",a=r.width,s=r.height,l=r.texture.format,c=!!r.texture.isCubeTexture):(o=r.name,i="Texture",a=r.image.width,s=r.image.height,l=r.format,c=!!r.isCubeTexture),e.textureSpecs.set(r,{name:o,type:i,width:a,height:s,format:l,isCube:c})},removeTextureSpec:function(r){e.textureSpecs.delete(r)}}}function Bge(n,e){function t(r,o){r.opacity.value=o.opacity,o.color&&r.diffuse.value.copy(o.color),o.emissive&&r.emissive.value.copy(o.emissive).multiplyScalar(o.emissiveIntensity),o.map&&(r.map.value=o.map),o.alphaMap&&(r.alphaMap.value=o.alphaMap),o.bumpMap&&(r.bumpMap.value=o.bumpMap,r.bumpScale.value=o.bumpScale,o.side===1&&(r.bumpScale.value*=-1)),o.displacementMap&&(r.displacementMap.value=o.displacementMap,r.displacementScale.value=o.displacementScale,r.displacementBias.value=o.displacementBias),o.emissiveMap&&(r.emissiveMap.value=o.emissiveMap),o.normalMap&&(r.normalMap.value=o.normalMap,r.normalScale.value.copy(o.normalScale),o.side===1&&r.normalScale.value.negate()),o.specularMap&&(r.specularMap.value=o.specularMap),o.alphaTest>0&&(r.alphaTest.value=o.alphaTest);const i=e.get(o).envMap;let a,s;i&&(r.envMap.value=i,r.flipEnvMap.value=i.isCubeTexture&&i.isRenderTargetTexture===!1?-1:1,r.reflectivity.value=o.reflectivity,r.ior.value=o.ior,r.refractionRatio.value=o.refractionRatio),o.lightMap&&(r.lightMap.value=o.lightMap,r.lightMapIntensity.value=o.lightMapIntensity),o.aoMap&&(r.aoMap.value=o.aoMap,r.aoMapIntensity.value=o.aoMapIntensity),o.map?a=o.map:o.specularMap?a=o.specularMap:o.displacementMap?a=o.displacementMap:o.normalMap?a=o.normalMap:o.bumpMap?a=o.bumpMap:o.roughnessMap?a=o.roughnessMap:o.metalnessMap?a=o.metalnessMap:o.alphaMap?a=o.alphaMap:o.emissiveMap?a=o.emissiveMap:o.clearcoatMap?a=o.clearcoatMap:o.clearcoatNormalMap?a=o.clearcoatNormalMap:o.clearcoatRoughnessMap?a=o.clearcoatRoughnessMap:o.specularIntensityMap?a=o.specularIntensityMap:o.specularColorMap?a=o.specularColorMap:o.transmissionMap?a=o.transmissionMap:o.thicknessMap&&(a=o.thicknessMap),a!==void 0&&(a.matrixAutoUpdate===!0&&a.updateMatrix(),r.uvTransform.value.copy(a.matrix)),o.aoMap?s=o.aoMap:o.lightMap&&(s=o.lightMap),s!==void 0&&(s.matrixAutoUpdate===!0&&s.updateMatrix(),r.uv2Transform.value.copy(s.matrix))}return{refreshFogUniforms:function(r,o){o.color.getRGB(r.fogColor.value,tL(n)),o.isFog?(r.fogNear.value=o.near,r.fogFar.value=o.far):o.isFogExp2&&(r.fogDensity.value=o.density)},refreshMaterialUniforms:function(r,o,i,a,s){o.ssrParams&&(function(l,c){l.invProjectionMatrix.value=c.ssrParams.invProjectionMatrix,l.ssrSourceBuffer.value=c.ssrParams.sourceBuffer.texture,l.ssrDepthBuffer.value=c.ssrParams.depthBuffer.texture,l.ssrBackfaceDepthBuffer.value=c.ssrParams.backfaceDepthBuffer.texture,l.ssrResolution.value.set(c.ssrParams.sourceBuffer.width,c.ssrParams.sourceBuffer.height),l.ssrStride.value=c.ssrParams.stride,l.ssrThickness.value=c.ssrParams.thickness,l.ssrMaxDistance.value=c.ssrParams.maxDistance,l.ssrJitter.value=c.ssrParams.jitter})(r,o),o.isMeshBasicMaterial||o.isMeshLambertMaterial?t(r,o):o.isMeshStandardMaterial?(t(r,o),(function(l,c){l.roughness.value=c.roughness,l.metalness.value=c.metalness,c.roughnessMap&&(l.roughnessMap.value=c.roughnessMap),c.metalnessMap&&(l.metalnessMap.value=c.metalnessMap),e.get(c).envMap&&(l.envMapIntensity.value=c.envMapIntensity,l.envMapParallaxType.value=c.envMapParallaxType,l.envMapParallaxMatrix.value.copy(c.envMapParallaxMatrix),l.envMapParallaxMatrixInv.value.copy(c.envMapParallaxMatrixInv))})(r,o),o.isMeshPhysicalMaterial&&(function(l,c,u){l.ior.value=c.ior,c.clearcoat>0&&(l.clearcoat.value=c.clearcoat,l.clearcoatRoughness.value=c.clearcoatRoughness,c.clearcoatMap&&(l.clearcoatMap.value=c.clearcoatMap),c.clearcoatRoughnessMap&&(l.clearcoatRoughnessMap.value=c.clearcoatRoughnessMap),c.clearcoatNormalMap&&(l.clearcoatNormalScale.value.copy(c.clearcoatNormalScale),l.clearcoatNormalMap.value=c.clearcoatNormalMap,c.side===1&&l.clearcoatNormalScale.value.negate())),c.transmission>0&&(l.transmission.value=c.transmission,l.transmissionSamplerMap.value=u.texture,l.transmissionSamplerSize.value.set(u.width,u.height),c.transmissionMap&&(l.transmissionMap.value=c.transmissionMap),l.thickness.value=c.thickness,c.thicknessMap&&(l.thicknessMap.value=c.thicknessMap),l.attenuationDistance.value=c.attenuationDistance,l.attenuationColor.value.copy(c.attenuationColor)),l.specularIntensity.value=c.specularIntensity,l.specularColor.value.copy(c.specularColor),c.specularIntensityMap&&(l.specularIntensityMap.value=c.specularIntensityMap),c.specularColorMap&&(l.specularColorMap.value=c.specularColorMap)})(r,o,s)):o.isMeshDepthMaterial?(t(r,o),(function(l,c){l.slopeScaledBias.value=c.slopeScaledBias})(r,o)):o.isMeshDistanceMaterial?(t(r,o),(function(l,c){l.referencePosition.value.copy(c.referencePosition),l.nearDistance.value=c.nearDistance,l.farDistance.value=c.farDistance,l.slopeScaledBias.value=c.slopeScaledBias})(r,o)):o.isMeshNormalMaterial?t(r,o):o.isLineBasicMaterial?((function(l,c){l.diffuse.value.copy(c.color),l.opacity.value=c.opacity})(r,o),o.isLineDashedMaterial&&(function(l,c){l.dashSize.value=c.dashSize,l.totalSize.value=c.dashSize+c.gapSize,l.scale.value=c.scale})(r,o)):o.isPointsMaterial?(function(l,c,u,d){l.diffuse.value.copy(c.color),l.opacity.value=c.opacity,l.size.value=c.size*u,l.scale.value=.5*d,c.map&&(l.map.value=c.map),c.alphaMap&&(l.alphaMap.value=c.alphaMap),c.alphaTest>0&&(l.alphaTest.value=c.alphaTest);let f;c.map?f=c.map:c.alphaMap&&(f=c.alphaMap),f!==void 0&&(f.matrixAutoUpdate===!0&&f.updateMatrix(),l.uvTransform.value.copy(f.matrix))})(r,o,i,a):o.isSpriteMaterial?(function(l,c){l.diffuse.value.copy(c.color),l.opacity.value=c.opacity,l.rotation.value=c.rotation,c.map&&(l.map.value=c.map),c.alphaMap&&(l.alphaMap.value=c.alphaMap),c.alphaTest>0&&(l.alphaTest.value=c.alphaTest);let u;c.map?u=c.map:c.alphaMap&&(u=c.alphaMap),u!==void 0&&(u.matrixAutoUpdate===!0&&u.updateMatrix(),l.uvTransform.value.copy(u.matrix))})(r,o):o.isShadowMaterial?(r.color.value.copy(o.color),r.opacity.value=o.opacity):o.isMeshMaskMaterial?(t(r,o),(function(l,c){c.cameraNearFar&&(l.cameraNearFar.value=c.cameraNearFar),l.depthTexture.value=c.depthTexture,c.textureMatrix&&(l.textureMatrix.value=c.textureMatrix)})(r,o)):o.isMeshNodeMaterial?(function(l,c){c.alphaTest>0&&(l.alphaTest.value=c.alphaTest);for(let d=0;d<c.nodeValue.length;d++)l.nodeValue.value[d]=c.nodeValue[d];for(let d=0;d<c.nodeRGB.length;d++)c.nodeRGB[d].toArray(l.nodeRGB.value,4*d);const u=e.get(c).envMap;u&&(l.envMap.value=u,l.flipEnvMap.value=u.isCubeTexture&&u.isRenderTargetTexture?-1:1,l.envMapIntensity.value=c.envMapIntensity,l.envMapParallaxType.value=c.envMapParallaxType,l.envMapParallaxMatrix.value.copy(c.envMapParallaxMatrix),l.envMapParallaxMatrixInv.value.copy(c.envMapParallaxMatrixInv)),c.displacementMap&&(l.displacementMap.value=c.displacementMap,l.displacementScale.value=c.displacementScale,l.displacementBias.value=c.displacementBias),l.materialIndex.value=c.materialIndex})(r,o):o.isMeshLineMaterial?(function(l,c){l.lineWidth.value=c.lineWidth,l.sizeAttenuation.value=c.sizeAttenuation,l.color.value=c.color,l.opacity.value=c.opacity,l.useMap.value=c.useMap,c.map&&(l.map.value=c.map),l.useAlphaMap.value=c.useAlphaMap,c.alphaMap&&(l.alphaMap.value=c.alphaMap),l.visibility.value=c.visibility,l.alphaTest.value=c.alphaTest,l.repeat.value=c.repeat})(r,o):o.isShaderMaterial&&(o.uniformsNeedUpdate=!1)},refreshGTAOUniforms:function(r,o){r.gtaoMap.value=o},refreshPlaneReflProbeUniforms:function(r,o){r.planeReflTexture.value=o.renderTarget.texture,r.planeReflTextureMatrix.value.copy(o.textureMatrix),r.planeReflDir.value.copy(o.normal),r.planeReflBoundingBoxMin.value.copy(o.boundingBox.min),r.planeReflBoundingBoxMax.value.copy(o.boundingBox.max),r.planeReflInvModelMatrix.value.copy(o.matrixWorldInverse),r.planeReflFalloff.value=o.falloff}}}function Nge(n,e){return n[0]-e[0]}function Oge(n,e){return Math.abs(e[1])-Math.abs(n[1])}function kge(n,e,t){const r={},o=new Float32Array(12),i=new WeakMap,a=new pt,s=[];for(let l=0;l<12;l++)s[l]=[l,0];return{update:function(l,c,u,d){const f=l.morphTargetInfluences;if(e.isWebGL2===!0){const h=c.morphAttributes.position||c.morphAttributes.normal||c.morphAttributes.color,p=h!==void 0?h.length:0;let m=i.get(c);if(m===void 0||m.count!==p){m!==void 0&&m.texture.dispose();const A=c.morphAttributes.position!==void 0,y=c.morphAttributes.normal!==void 0,b=c.morphAttributes.color!==void 0,E=c.morphAttributes.position||[],x=c.morphAttributes.normal||[],w=c.morphAttributes.color||[];let L=0;A===!0&&(L=1),y===!0&&(L=2),b===!0&&(L=3);let C=c.attributes.position.count*L,P=1;C>e.maxTextureSize&&(P=Math.ceil(C/e.maxTextureSize),C=e.maxTextureSize);const D=new Float32Array(C*P*4*p),Q=new $g(D,C,P,p);Q.type=1015,Q.needsUpdate=!0;const re=4*L;for(let G=0;G<p;G++){const se=E[G],ee=x[G],ie=w[G],H=C*P*4*G;for(let T=0;T<se.count;T++){const R=T*re;A===!0&&(a.fromBufferAttribute(se,T),D[H+R+0]=a.x,D[H+R+1]=a.y,D[H+R+2]=a.z,D[H+R+3]=0),y===!0&&(a.fromBufferAttribute(ee,T),D[H+R+4]=a.x,D[H+R+5]=a.y,D[H+R+6]=a.z,D[H+R+7]=0),b===!0&&(a.fromBufferAttribute(ie,T),D[H+R+8]=a.x,D[H+R+9]=a.y,D[H+R+10]=a.z,D[H+R+11]=ie.itemSize===4?a.w:1)}}m={count:p,texture:Q,size:new be(C,P)},i.set(c,m),c.addEventListener("dispose",(function G(){Q.dispose(),i.delete(c),c.removeEventListener("dispose",G)}))}let g=0;for(let A=0;A<f.length;A++)g+=f[A];const _=c.morphTargetsRelative?1:1-g;d.getUniforms().setValue(n,"morphTargetBaseInfluence",_),d.getUniforms().setValue(n,"morphTargetInfluences",f),d.getUniforms().setValue(n,"morphTargetsTexture",m.texture,t),d.getUniforms().setValue(n,"morphTargetsTextureSize",m.size)}else{const h=f===void 0?0:f.length;let p=r[c.id];if(p===void 0||p.length!==h){p=[];for(let y=0;y<h;y++)p[y]=[y,0];r[c.id]=p}for(let y=0;y<h;y++){const b=p[y];b[0]=y,b[1]=f[y]}p.sort(Oge);for(let y=0;y<12;y++)y<h&&p[y][1]?(s[y][0]=p[y][0],s[y][1]=p[y][1]):(s[y][0]=Number.MAX_SAFE_INTEGER,s[y][1]=0);s.sort(Nge);const m=c.morphAttributes.position,g=c.morphAttributes.normal;let _=0;for(let y=0;y<12;y++){const b=s[y],E=b[0],x=b[1];E!==Number.MAX_SAFE_INTEGER&&x?(m&&c.getAttribute("morphTarget"+y)!==m[E]&&c.setAttribute("morphTarget"+y,m[E]),g&&c.getAttribute("morphNormal"+y)!==g[E]&&c.setAttribute("morphNormal"+y,g[E]),o[y]=x,_+=x):(m&&c.hasAttribute("morphTarget"+y)===!0&&c.deleteAttribute("morphTarget"+y),g&&c.hasAttribute("morphNormal"+y)===!0&&c.deleteAttribute("morphNormal"+y),o[y]=0)}const A=c.morphTargetsRelative?1:1-_;d.getUniforms().setValue(n,"morphTargetBaseInfluence",A),d.getUniforms().setValue(n,"morphTargetInfluences",o)}}}}class P2 extends $n{constructor(e,t,r,o,i,a,s,l,c,u){if((u=u!==void 0?u:1026)!==1026&&u!==1027)throw new Error("DepthTexture format must be either v3d.DepthFormat or v3d.DepthStencilFormat");r===void 0&&u===1026&&(r=1014),r===void 0&&u===1027&&(r=1020),super(null,o,i,a,s,l,u,r,c),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=s!==void 0?s:1003,this.minFilter=l!==void 0?l:1003,this.flipY=!1,this.generateMipmaps=!1}}class xi extends ti{constructor(){super(),this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("v3d.Pass: .render() must be implemented in derived pass.")}setCamera(e){}dispose(){}}const Fge=new ya(-1,1,1,-1,0,1),h0=new At;h0.setAttribute("position",new Xe(new Float32Array([-1,3,0,-1,-1,0,3,-1,0]),3)),h0.setAttribute("uv",new Xe(new Float32Array([0,2,0,0,2,0]),2));class Xi{constructor(e){this._mesh=new Mt(h0,e)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,Fge)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}static dispose(){h0.dispose()}}const Vge=new Ge,sL=new Iu;class Uge{constructor(e,t){this.isWebGLOITMethod=!0,this.resolution=e,this.textureType=t,this.type="WebGLOITMethod",this.mute=!1}render(){this.mute}dispose(){}setSize(e,t){this.resolution.set(e,t)}_ensureProperBuffersClearing(e){e.state.buffers.depth.setTest(!0),e.state.buffers.depth.setMask(!0),e.state.buffers.color.setMask(!0)}}class zge extends Uge{constructor(e,t,r){super(e,t),this.isWebGLOITWeighted=!0,this.type="WebGLOITWeighted",this.shader=Tt.oitWeighted,this.uniforms=_o.clone(this.shader.uniforms),this.scene=null,this.camera=null,this.aaSamples=r||0,this.renderTargetMRT=new c2(this.resolution.x,this.resolution.y,2),this.renderTargetMRT.texture[0].name="wboit_rgba",this.renderTargetMRT.texture[0].format=1023,this.renderTargetMRT.texture[0].type=t,this.renderTargetMRT.texture[1].name="wboit_r",this.renderTargetMRT.texture[1].format=1028,this.renderTargetMRT.texture[1].type=t,this.aaSamples>0&&(this.renderTargetMRTMSAA=new c2(this.resolution.x,this.resolution.y,2,{samples:r}),this.renderTargetMRTMSAA.texture[0].name="wboit_rgba",this.renderTargetMRTMSAA.texture[0].format=1023,this.renderTargetMRTMSAA.texture[0].type=t,this.renderTargetMRTMSAA.texture[1].name="wboit_r",this.renderTargetMRTMSAA.texture[1].format=1028,this.renderTargetMRTMSAA.texture[1].type=t),this.fsQuadSolver=new Xi(new Dn({defines:Object.assign({},this.shader.defines),uniforms:_o.clone(this.shader.uniforms),vertexShader:this.shader.vertexShader,fragmentShader:this.shader.fragmentShader,depthTest:!1,depthWrite:!1,blending:5,blendEquation:100,blendSrc:204,blendDst:205,blendEquationAlpha:100,blendSrcAlpha:201,blendDstAlpha:205})),this._layerMasks={},this._matSettings={},this._savedCameraLayers=new Iu}dispose(){super.dispose(),this.renderTargetMRT.dispose(),this.renderTargetMRTMSAA&&this.renderTargetMRTMSAA.dispose()}setSize(e,t){super.setSize(e,t),this.renderTargetMRT.setSize(e,t),this.renderTargetMRTMSAA&&this.renderTargetMRTMSAA.setSize(e,t)}render(e,t,r,o,i){if(this.mute)return;this._ensureProperBuffersClearing(e);const a=e.getRenderTarget();if(a.isWebGLCubeRenderTarget)return void t(r,o,i);const s=o.overrideMaterial;if(s&&!this.isSupportedMaterial(s))return void t(r,o,i);if(this.resolution.x!==a.width&&this.resolution.y!==a.height)return console.warn("v3d.WebGLOITRenderer: render target size mismatch in v3d.WebGLOITWeighted."),void t(r,o,i);this.scene=o,this.camera=i,this._savedCameraLayers.mask=this.camera.layers.mask;const l=e.getClearColor(Vge),c=e.getClearAlpha(),u=e.autoClear,d=e.useOIT,f=e.sortObjects;e.setClearColor(0),e.setClearAlpha(0),e.autoClear=!1,e.sortObjects=!1,e.useOIT=!1;const h=this.renderTargetMRTMSAA&&this.renderTargetMRTMSAA.samples==a.samples;if(s){const p=[{object:o,material:s}];this._accumulationPass(e,t,h,r,p);const m=s.colorWrite;s.colorWrite=!1,s.needsUpdate=!0,e.setRenderTarget(a),t(r,o,i),s.colorWrite=m,s.needsUpdate=!0}else this._saveLayers(r),this._setupLayers(r),i.layers.disableAll(),i.layers.enable(2),t(r,o,i),i.layers.disableAll(),i.layers.enable(1),this._accumulationPass(e,t,h,r),e.setRenderTarget(a),this._renderOnlyDepth(e,t,r,o,i),this._restoreLayers(r);e.setRenderTarget(a),this._solverPass(e,h),e.setClearColor(l),e.setClearAlpha(c),e.sortObjects=f,e.autoClear=u,e.useOIT=d}isSupportedMaterial(e){return!(!e||!e.isMeshStandardMaterial&&!e.isMeshNodeMaterial)}_accumulationPass(e,t,r,o,i){i||(i=o);const a=e.getContext(),s=e.getRenderTarget(),l=e.getClearAlpha();if(this._saveMatSettings(i),this._setupMatSettings(i),e.setClearAlpha(1),s)if(r){e.setRenderTarget(this.renderTargetMRTMSAA),e.clear();const c=e.properties.get(this.renderTargetMRTMSAA).__webglDepthRenderbuffer,u=e.properties.get(s).__webglDepthRenderbuffer;if(u&&(a.framebufferRenderbuffer(36160,36096,36161,u),a.checkFramebufferStatus(36160)!==36053)||(t(o,this.scene,this.camera),e.getTextureUtils().updateMultisampleRenderTarget(this.renderTargetMRTMSAA),u&&(a.framebufferRenderbuffer(36160,36096,36161,c||null),a.checkFramebufferStatus(36160)!==36053)))return void console.error("v3d.WebGLOITRenderer: incomplete framebuffer in v3d.WebGLOITWeighted.")}else if(s.samples>0){e.setRenderTarget(this.renderTargetMRT),e.clear();const c=e.properties.get(this.renderTargetMRT).__webglFramebuffer,u=e.properties.get(s).__webglMultisampledFramebuffer;if(u&&(a.bindFramebuffer(36008,u),a.bindFramebuffer(36009,c),a.blitFramebuffer(0,0,this.resolution.x,this.resolution.y,0,0,this.resolution.x,this.resolution.y,256,9728),a.bindFramebuffer(36160,c),a.checkFramebufferStatus(36160)!==36053))return void console.error("v3d.WebGLOITRenderer: incomplete framebuffer in v3d.WebGLOITWeighted. Can not blit depth buffer from multisample render target.");t(o,this.scene,this.camera)}else{e.setRenderTarget(this.renderTargetMRT),e.clear();const c=e.properties.get(this.renderTargetMRT),u=c.__webglDepthRenderbuffer||c.__webglDepthbuffer,d=e.properties.get(s),f=d.__webglDepthRenderbuffer||d.__webglDepthbuffer;if(f){if(a.framebufferRenderbuffer(36160,36096,36161,f),a.checkFramebufferStatus(36160)!==36053)return void console.error("v3d.WebGLOITRenderer: incomplete framebuffer in v3d.WebGLOITWeighted.")}else if(s.depthTexture){const h=e.properties.get(s.depthTexture).__webglTexture;a.framebufferTexture2D(36160,36096,3553,h,0)}if(t(o,this.scene,this.camera),f){if(a.framebufferRenderbuffer(36160,36096,36161,u||null),a.checkFramebufferStatus(36160)!==36053)return void console.error("v3d.WebGLOITRenderer: incomplete framebuffer in v3d.WebGLOITWeighted.")}else if(s.depthTexture&&(a.framebufferRenderbuffer(36160,36096,36161,u||null),a.checkFramebufferStatus(36160)!==36053))return void console.error("v3d.WebGLOITRenderer: incomplete framebuffer in v3d.WebGLOITWeighted.")}else console.error("v3d.WebGLOITRenderer: undefined render target in v3d.WebGLOITWeighted.");this._restoreMatSettings(i),e.setClearAlpha(l),e.setRenderTarget(s)}_solverPass(e,t){const r=t?this.renderTargetMRTMSAA:this.renderTargetMRT;this.fsQuadSolver.material.uniforms.tRGBABuffer.value=r.texture[0],this.fsQuadSolver.material.uniforms.tFloatBuffer.value=r.texture[1],this.fsQuadSolver.render(e)}_testInitialLayersWithInitialCameraLayers(e){const t=this._layerMasks[e.id];return sL.mask=t!==void 0?t:e.layers.mask,this._savedCameraLayers.test(sL)}_saveLayers(e){this._layerMasks[this.camera.id]=this.camera.layers.mask;for(let t=0,r=e.length;t<r;t++){const o=e[t].object;this._layerMasks[o.id]=o.layers.mask}}_setupLayers(e){for(let t=0,r=e.length;t<r;t++){const o=e[t],i=o.object,a=o.material;this._testInitialLayersWithInitialCameraLayers(i)?(i.layers.disableAll(),this.isSupportedMaterial(a)?i.layers.enable(1):i.layers.enable(2)):i.layers.disableAll()}}_restoreLayers(e){for(let t=0,r=e.length;t<r;t++){const o=e[t].object;o.layers.mask=this._layerMasks[o.id],delete this._layerMasks[o.id]}this.camera.layers.mask=this._layerMasks[this.camera.id],delete this._layerMasks[this.camera.id]}_saveMatSettings(e){for(let t=0,r=e.length;t<r;t++){const o=e[t],i=o.object,a=o.material;a&&a.id in this._matSettings||this._testInitialLayersWithInitialCameraLayers(i)&&this.isSupportedMaterial(a)&&(this._matSettings[a.id]={defines:{PREMULTIPLIED_ALPHA:a.defines.PREMULTIPLIED_ALPHA},properties:{blending:a.blending,blendEquation:a.blendEquation,blendSrc:a.blendSrc,blendDst:a.blendDst,blendEquationAlpha:a.blendEquationAlpha,blendSrcAlpha:a.blendSrcAlpha,blendDstAlpha:a.blendDstAlpha,depthTest:a.depthTest,depthWrite:a.depthWrite}})}}_setupMatSettings(e){for(let t=0,r=e.length;t<r;t++){const o=e[t],i=o.object,a=o.material;this._testInitialLayersWithInitialCameraLayers(i)&&this.isSupportedMaterial(a)&&(a.defines.PREMULTIPLIED_ALPHA="",a.defines.USE_OIT_WEIGHTED="",a.blending=5,a.blendEquation=100,a.blendSrc=201,a.blendDst=201,a.blendEquationAlpha=100,a.blendSrcAlpha=200,a.blendDstAlpha=205,a.depthTest=!0,a.depthWrite=!1,a.needsUpdate=!0)}}_restoreMatSettings(e){for(let t=0,r=e.length;t<r;t++){const o=e[t],i=o.object,a=o.material;if(!a||!(a.id in this._matSettings)||!this._testInitialLayersWithInitialCameraLayers(i)||!this.isSupportedMaterial(a))continue;delete a.defines.USE_OIT_WEIGHTED;const s=this._matSettings[a.id];for(let l in s.properties)a[l]=s.properties[l];for(let l in s.defines)s.defines[l]?a.defines[l]=s.defines[l]:delete a.defines[l];a.needsUpdate=!0,delete this._matSettings[a.id]}}_renderOnlyDepth(e,t,r,o,i){const a={};for(let s=0,l=r.length;s<l;s++){const c=r[s],u=c.object,d=c.material;d&&d.id in a||this._testInitialLayersWithInitialCameraLayers(u)&&this.isSupportedMaterial(d)&&(a[d.id]={properties:{colorWrite:d.colorWrite}},d.colorWrite=!1,d.needsUpdate=!0)}t(r,o,i);for(let s=0,l=r.length;s<l;s++){const c=r[s];c.object;const u=c.material;if(!u||!(u.id in a))continue;const d=a[u.id];for(let f in d.properties)u[f]=d.properties[f];u.needsUpdate=!0,delete a[u.id]}}}class Gge{constructor(e){this.isWebGLOITRenderer=!0,this.resolution=e,this.texType=1009,this.mute=!1,this.method=0,this.oitRenderer=null}render(e,t,r,o,i){this.mute||this.oitRenderer&&this.oitRenderer.render(e,t,r,o,i)}setMethod(e,t){this.method!==e&&(this.oitRenderer&&this.oitRenderer.dispose(),this.oitRenderer=null,this.method=e,e!==0&&e===1&&(this.oitRenderer=new zge(this.resolution,this.texType,t)))}isMethodCompatible(e,t){return e===0||!(e!==1||!t.isWebGL2)}dispose(){this.oitRenderer&&this.oitRenderer.dispose(),this.method=0}setSize(e,t){this.resolution.set(e,t),this.oitRenderer&&this.oitRenderer.setSize(e,t)}}function Hge(n,e,t,r){let o=new WeakMap;function i(a){const s=a.target;s.removeEventListener("dispose",i),t.remove(s.instanceMatrix),s.instanceColor!==null&&t.remove(s.instanceColor)}return{update:function(a){const s=r.render.frame,l=a.geometry,c=e.get(a,l);return o.get(c)!==s&&(e.update(c),o.set(c,s)),a.isInstancedMesh&&(a.hasEventListener("dispose",i)===!1&&a.addEventListener("dispose",i),t.update(a.instanceMatrix,34962),a.instanceColor!==null&&t.update(a.instanceColor,34962)),c},dispose:function(){o=new WeakMap}}}const lL=new $n,cL=new $g,uL=new l2,dL=new s0,fL=[],hL=[],pL=new Float32Array(16),mL=new Float32Array(9),gL=new Float32Array(4);function zu(n,e,t){const r=n[0];if(r<=0||r>0)return n;const o=e*t;let i=fL[o];if(i===void 0&&(i=new Float32Array(o),fL[o]=i),e!==0){r.toArray(i,0);for(let a=1,s=0;a!==e;++a)s+=t,n[a].toArray(i,s)}return i}function wr(n,e){if(n.length!==e.length)return!1;for(let t=0,r=n.length;t<r;t++)if(n[t]!==e[t])return!1;return!0}function Mr(n,e){for(let t=0,r=e.length;t<r;t++)n[t]=e[t]}function p0(n,e){let t=hL[e];t===void 0&&(t=new Int32Array(e),hL[e]=t);for(let r=0;r!==e;++r)t[r]=n.allocateTextureUnit();return t}function Wge(n,e){const t=this.cache;t[0]!==e&&(n.uniform1f(this.addr,e),t[0]=e)}function jge(n,e){const t=this.cache;if(e.x!==void 0)t[0]===e.x&&t[1]===e.y||(n.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(wr(t,e))return;n.uniform2fv(this.addr,e),Mr(t,e)}}function Qge(n,e){const t=this.cache;if(e.x!==void 0)t[0]===e.x&&t[1]===e.y&&t[2]===e.z||(n.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(e.r!==void 0)t[0]===e.r&&t[1]===e.g&&t[2]===e.b||(n.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(wr(t,e))return;n.uniform3fv(this.addr,e),Mr(t,e)}}function $ge(n,e){const t=this.cache;if(e.x!==void 0)t[0]===e.x&&t[1]===e.y&&t[2]===e.z&&t[3]===e.w||(n.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(wr(t,e))return;n.uniform4fv(this.addr,e),Mr(t,e)}}function Yge(n,e){const t=this.cache,r=e.elements;if(r===void 0){if(wr(t,e))return;n.uniformMatrix2fv(this.addr,!1,e),Mr(t,e)}else{if(wr(t,r))return;gL.set(r),n.uniformMatrix2fv(this.addr,!1,gL),Mr(t,r)}}function Xge(n,e){const t=this.cache,r=e.elements;if(r===void 0){if(wr(t,e))return;n.uniformMatrix3fv(this.addr,!1,e),Mr(t,e)}else{if(wr(t,r))return;mL.set(r),n.uniformMatrix3fv(this.addr,!1,mL),Mr(t,r)}}function qge(n,e){const t=this.cache,r=e.elements;if(r===void 0){if(wr(t,e))return;n.uniformMatrix4fv(this.addr,!1,e),Mr(t,e)}else{if(wr(t,r))return;pL.set(r),n.uniformMatrix4fv(this.addr,!1,pL),Mr(t,r)}}function Kge(n,e){const t=this.cache;t[0]!==e&&(n.uniform1i(this.addr,e),t[0]=e)}function Zge(n,e){const t=this.cache;if(e.x!==void 0)t[0]===e.x&&t[1]===e.y||(n.uniform2i(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(wr(t,e))return;n.uniform2iv(this.addr,e),Mr(t,e)}}function Jge(n,e){const t=this.cache;if(e.x!==void 0)t[0]===e.x&&t[1]===e.y&&t[2]===e.z||(n.uniform3i(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(wr(t,e))return;n.uniform3iv(this.addr,e),Mr(t,e)}}function e0e(n,e){const t=this.cache;if(e.x!==void 0)t[0]===e.x&&t[1]===e.y&&t[2]===e.z&&t[3]===e.w||(n.uniform4i(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(wr(t,e))return;n.uniform4iv(this.addr,e),Mr(t,e)}}function t0e(n,e){const t=this.cache;t[0]!==e&&(n.uniform1ui(this.addr,e),t[0]=e)}function n0e(n,e){const t=this.cache;if(e.x!==void 0)t[0]===e.x&&t[1]===e.y||(n.uniform2ui(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(wr(t,e))return;n.uniform2uiv(this.addr,e),Mr(t,e)}}function r0e(n,e){const t=this.cache;if(e.x!==void 0)t[0]===e.x&&t[1]===e.y&&t[2]===e.z||(n.uniform3ui(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(wr(t,e))return;n.uniform3uiv(this.addr,e),Mr(t,e)}}function o0e(n,e){const t=this.cache;if(e.x!==void 0)t[0]===e.x&&t[1]===e.y&&t[2]===e.z&&t[3]===e.w||(n.uniform4ui(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(wr(t,e))return;n.uniform4uiv(this.addr,e),Mr(t,e)}}function i0e(n,e,t){const r=this.cache,o=t.allocateTextureUnit();r[0]!==o&&(n.uniform1i(this.addr,o),r[0]=o),t.setTexture2D(e||lL,o)}function a0e(n,e,t){const r=this.cache,o=t.allocateTextureUnit();r[0]!==o&&(n.uniform1i(this.addr,o),r[0]=o),t.setTexture3D(e||uL,o)}function s0e(n,e,t){const r=this.cache,o=t.allocateTextureUnit();r[0]!==o&&(n.uniform1i(this.addr,o),r[0]=o),t.setTextureCube(e||dL,o)}function l0e(n,e,t){const r=this.cache,o=t.allocateTextureUnit();r[0]!==o&&(n.uniform1i(this.addr,o),r[0]=o),t.setTexture2DArray(e||cL,o)}function c0e(n){switch(n){case 5126:return Wge;case 35664:return jge;case 35665:return Qge;case 35666:return $ge;case 35674:return Yge;case 35675:return Xge;case 35676:return qge;case 5124:case 35670:return Kge;case 35667:case 35671:return Zge;case 35668:case 35672:return Jge;case 35669:case 35673:return e0e;case 5125:return t0e;case 36294:return n0e;case 36295:return r0e;case 36296:return o0e;case 35678:case 36198:case 36298:case 36306:case 35682:return i0e;case 35679:case 36299:case 36307:return a0e;case 35680:case 36300:case 36308:case 36293:return s0e;case 36289:case 36303:case 36311:case 36292:return l0e}}function u0e(n,e){n.uniform1fv(this.addr,e)}function d0e(n,e){const t=zu(e,this.size,2);n.uniform2fv(this.addr,t)}function f0e(n,e){const t=zu(e,this.size,3);n.uniform3fv(this.addr,t)}function h0e(n,e){const t=zu(e,this.size,4);n.uniform4fv(this.addr,t)}function p0e(n,e){const t=zu(e,this.size,4);n.uniformMatrix2fv(this.addr,!1,t)}function m0e(n,e){const t=zu(e,this.size,9);n.uniformMatrix3fv(this.addr,!1,t)}function g0e(n,e){const t=zu(e,this.size,16);n.uniformMatrix4fv(this.addr,!1,t)}function _0e(n,e){n.uniform1iv(this.addr,e)}function v0e(n,e){n.uniform2iv(this.addr,e)}function A0e(n,e){n.uniform3iv(this.addr,e)}function y0e(n,e){n.uniform4iv(this.addr,e)}function b0e(n,e){n.uniform1uiv(this.addr,e)}function x0e(n,e){n.uniform2uiv(this.addr,e)}function E0e(n,e){n.uniform3uiv(this.addr,e)}function C0e(n,e){n.uniform4uiv(this.addr,e)}function S0e(n,e,t){const r=this.cache,o=e.length,i=p0(t,o);wr(r,i)||(n.uniform1iv(this.addr,i),Mr(r,i));for(let a=0;a!==o;++a)t.setTexture2D(e[a]||lL,i[a])}function w0e(n,e,t){const r=this.cache,o=e.length,i=p0(t,o);wr(r,i)||(n.uniform1iv(this.addr,i),Mr(r,i));for(let a=0;a!==o;++a)t.setTexture3D(e[a]||uL,i[a])}function M0e(n,e,t){const r=this.cache,o=e.length,i=p0(t,o);wr(r,i)||(n.uniform1iv(this.addr,i),Mr(r,i));for(let a=0;a!==o;++a)t.setTextureCube(e[a]||dL,i[a])}function T0e(n,e,t){const r=this.cache,o=e.length,i=p0(t,o);wr(r,i)||(n.uniform1iv(this.addr,i),Mr(r,i));for(let a=0;a!==o;++a)t.setTexture2DArray(e[a]||cL,i[a])}function I0e(n){switch(n){case 5126:return u0e;case 35664:return d0e;case 35665:return f0e;case 35666:return h0e;case 35674:return p0e;case 35675:return m0e;case 35676:return g0e;case 5124:case 35670:return _0e;case 35667:case 35671:return v0e;case 35668:case 35672:return A0e;case 35669:case 35673:return y0e;case 5125:return b0e;case 36294:return x0e;case 36295:return E0e;case 36296:return C0e;case 35678:case 36198:case 36298:case 36306:case 35682:return S0e;case 35679:case 36299:case 36307:return w0e;case 35680:case 36300:case 36308:case 36293:return M0e;case 36289:case 36303:case 36311:case 36292:return T0e}}class R0e{constructor(e,t,r){this.id=e,this.addr=r,this.cache=[],this.setValue=c0e(t.type)}}class L0e{constructor(e,t,r){this.id=e,this.addr=r,this.cache=[],this.size=t.size,this.setValue=I0e(t.type)}}class P0e{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,r){const o=this.seq;for(let i=0,a=o.length;i!==a;++i){const s=o[i];s.setValue(e,t[s.id],r)}}}const D2=/(\w+)(\])?(\[|\.)?/g;function _L(n,e){n.seq.push(e),n.map[e.id]=e}function D0e(n,e,t){const r=n.name,o=r.length;for(D2.lastIndex=0;;){const i=D2.exec(r),a=D2.lastIndex;let s=i[1];const l=i[2]==="]",c=i[3];if(l&&(s|=0),c===void 0||c==="["&&a+2===o){_L(t,c===void 0?new R0e(s,n,e):new L0e(s,n,e));break}{let u=t.map[s];u===void 0&&(u=new P0e(s),_L(t,u)),t=u}}}class m0{constructor(e,t){this.seq=[],this.map={};const r=e.getProgramParameter(t,35718);for(let o=0;o<r;++o){const i=e.getActiveUniform(t,o);D0e(i,e.getUniformLocation(t,i.name),this)}}setValue(e,t,r,o){const i=this.map[t];i!==void 0&&i.setValue(e,r,o)}setOptional(e,t,r){const o=t[r];o!==void 0&&this.setValue(e,r,o)}static upload(e,t,r,o){for(let i=0,a=t.length;i!==a;++i){const s=t[i],l=r[s.id];l.needsUpdate!==!1&&s.setValue(e,l.value,o)}}static seqWithValue(e,t){const r=[];for(let o=0,i=e.length;o!==i;++o){const a=e[o];a.id in t&&r.push(a)}return r}}function vL(n,e,t){const r=n.createShader(e);return n.shaderSource(r,t),n.compileShader(r),r}let B0e=0;function N0e(n,e){const t=n.split(`
`),r=[],o=Math.max(e-6,0),i=Math.min(e+6,t.length);for(let a=o;a<i;a++){const s=a+1;r.push(`${s===e?">":" "} ${s}: ${t[a]}`)}return r.join(`
`)}function O0e(n){switch(n){case 3e3:return["Linear","(value)"];case 3001:return["sRGB","(value)"];default:return console.warn("v3d.WebGLProgram: Unsupported encoding:",n),["Linear","(value)"]}}function AL(n,e,t){const r=n.getShaderParameter(e,35713),o=n.getShaderInfoLog(e).trim();if(r&&o==="")return"";const i=/ERROR: 0:(\d+)/.exec(o);if(i){const a=parseInt(i[1]);return t.toUpperCase()+`

`+o+`

`+N0e(n.getShaderSource(e),a)}return o}function k0e(n,e){const t=O0e(e);return"vec4 "+n+"(vec4 value) { return LinearTo"+t[0]+t[1]+"; }"}function F0e(n,e){let t;switch(e){case 1:t="Linear";break;case 2:t="Reinhard";break;case 3:t="OptimizedCineon";break;case 4:t="ACESFilmic";break;case 5:t="Custom";break;case 6:t="LogarithmicMax";break;case 7:t="PhysicalMax";break;case 8:t="FilmicBlender";break;case 9:t="AgX";break;case 10:t="PbrNeutral";break;default:console.warn("v3d.WebGLProgram: Unsupported toneMapping:",e),t="Linear"}return"vec3 "+n+"(vec3 color) { return "+t+"ToneMapping(color); }"}function V0e(n){let e="TONE_MAPPING_LOOK_NONE";return n===1&&(e="TONE_MAPPING_LOOK_AGX_PUNCHY"),e}function U0e(n){return[n.extensionDerivatives||n.bumpMap||n.tangentSpaceNormalMap||n.clearcoatNormalMap||n.flatShading||n.shaderID==="physical"||n.shaderID==="node"||n.useSlopeScaledBias?"#extension GL_OES_standard_derivatives : enable":"",(n.extensionFragDepth||n.logarithmicDepthBuffer)&&n.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",n.extensionDrawBuffers&&n.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(n.extensionShaderTextureLOD||n.envMap||n.transmission)&&n.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(_h).join(`
`)}function yL(n,e){const t=[];for(const r in n){const o=n[r];o===!1||e&&e.has(r)||t.push("#define "+r+" "+o)}return t.join(`
`)}function z0e(n,e){const t={},r=n.getProgramParameter(e,35721);for(let o=0;o<r;o++){const i=n.getActiveAttrib(e,o),a=i.name;let s=1;i.type===35674&&(s=2),i.type===35675&&(s=3),i.type===35676&&(s=4),t[a]={type:i.type,location:n.getAttribLocation(e,a),locationSize:s}}return t}function _h(n){return n!==""}function bL(n,e){return n.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows).replace(/NUM_RECT_AREA_LIGHT_SHADOWS/g,e.numRectAreaLightShadows).replace(/NUM_DIR_LIGHT_SHADOWS_CSM_WITH_FADE/g,e.numDirLightShadowsCSMWithFade).replace(/NUM_DIR_LIGHT_SHADOWS_CSM/g,e.numDirLightShadowsCSM).replace(/NUM_DIR_LIGHT_SHADOW_CASCADES_CSM/g,e.numDirLightShadowCSMCascades)}function xL(n,e){return n.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}function EL(n,e){const t=Object.keys(e);if(t.length){const r=new RegExp(t.join("|"),"g");return n.replace(r,(function(o){return e[o]}))}return n}function G0e(n){switch(n){case"blender":return"#define MT_BLENDER";case"max":return"#define MT_MAX";case"maya":return"#define MT_MAYA";default:return""}}function CL(n,e){for(const t in e){const r=typeof __V3D_DEVTOOLS__<"u"?`// included: "${t}"
`:"";n=n.replace(`#include <${t}>`,r+e[t])}return n}const H0e=/^[ \t]*#include +<([\w\d./]+)>/gm;function B2(n){return n.replace(H0e,W0e)}function W0e(n,e){const t=Qe[e];if(t===void 0)throw new Error("Can not resolve #include <"+e+">");return B2((typeof __V3D_DEVTOOLS__<"u"?`// included: "${e}"
`:"")+t)}function SL(n){const e=new RegExp("#pragma unroll_loop[\\s]+?for \\(int (\\w+) ?\\= ?(\\d+)\\; ?(\\w+) ?<(=?) ?(\\w+)\\; ?(\\w+)\\+\\+\\) ?\\{"),t=new RegExp("\\{|\\}","g");let r;for(;r=e.exec(n);){let o,i;o=i=t.lastIndex=r.index+r[0].length;let a,s=1;do(a=t.exec(n))&&(a[0]=="{"?s++:a[0]=="}"&&s--,i=a.index);while(a&&s>0);if(s==0){const l=n.substring(r.index,t.lastIndex),c=n.substring(o,i),u=new RegExp(`\\[${r[1]}\\]`,"g"),d=new RegExp(`\\(${r[1]}\\)`,"g");let f="";const h=parseInt(r[2]),p=parseInt(r[5])+(r[4]==="="?1:0);for(let m=h;m<p;m++)f+="{"+c.replace(u,`[${m}]`).replace(d,`(${m})`)+"}";n=n.replace(l,f)}}return n}function wL(n){return"precision "+n.precision+` float;
precision `+n.precision+" int;"}function j0e(n){let e="SHADOWMAP_TYPE_BASIC";return n.shadowMapType===1?e="SHADOWMAP_TYPE_BILINEAR":n.shadowMapType===2?e="SHADOWMAP_TYPE_PCF":n.shadowMapType===3&&(e="SHADOWMAP_TYPE_ESM"),e}function Q0e(n){let e="ENVMAP_TYPE_CUBE";if(n.envMap)switch(n.envMapMode){case 301:case 302:e="ENVMAP_TYPE_CUBE";break;case 306:e="ENVMAP_TYPE_CUBE_UV"}return e}function $0e(n){let e="ENVMAP_MODE_REFLECTION";return n.envMap&&n.envMapMode===302&&(e="ENVMAP_MODE_REFRACTION"),e}function Y0e(n){let e="ENVMAP_BLENDING_NONE";if(n.envMap)switch(n.combine){case 0:e="ENVMAP_BLENDING_MULTIPLY";break;case 1:e="ENVMAP_BLENDING_MIX";break;case 2:e="ENVMAP_BLENDING_ADD"}return e}function X0e(n,e,t,r){const o=n.getContext(),i=t.defines;let a=t.vertexShader,s=t.fragmentShader;const l=j0e(t),c=Q0e(t),u=$0e(t),d=Y0e(t),f=t.unitsScaleFactor%1?String(t.unitsScaleFactor):String(t.unitsScaleFactor)+".0",h=t.isWebGL2?"":U0e(t),p=yL(i),m=yL(i,t.definesFragOnly),g=o.createProgram(),_=this;let A,y,b=t.glslVersion?"#version "+t.glslVersion+`
`:"";t.isRawShaderMaterial?(A=[m].filter(_h).join(`
`),A.length>0&&(A+=`
`),y=[h,p].filter(_h).join(`
`),y.length>0&&(y+=`
`)):(A=[wL(t),"#define SHADER_NAME "+t.shaderName,m,t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.supportsVertexTextures?"#define VERTEX_TEXTURES":"",t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+u:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMap&&t.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",t.normalMap&&t.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.displacementMap&&t.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",t.specularColorMap?"#define USE_SPECULARCOLORMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.vertexTangents?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUvs?"#define USE_UV":"",t.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&t.flatShading===!1?"#define USE_MORPHNORMALS":"",t.morphColors&&t.isWebGL2?"#define USE_MORPHCOLORS":"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+t.morphTextureStride:"",t.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",t.planeReflProbe?"#define USE_PLANE_REFLECTION":"",`
            uniform mat4 modelMatrix;
            uniform mat4 modelViewMatrix;
            uniform mat4 projectionMatrix;
            uniform mat4 viewMatrix;
            uniform mat3 normalMatrix;
            uniform vec3 cameraPosition;
            uniform bool isOrthographic;

            #ifdef USE_INSTANCING
                attribute mat4 instanceMatrix;
            #endif

            #ifdef USE_INSTANCING_COLOR
                attribute vec3 instanceColor;
            #endif

            attribute vec3 position;
            attribute vec3 normal;
            attribute vec2 uv;

            #ifdef USE_TANGENT
                attribute vec4 tangent;
            #endif

            #if defined(USE_COLOR_ALPHA)
                attribute vec4 color;
            #elif defined(USE_COLOR)
                attribute vec3 color;
            #endif

            #if (defined(USE_MORPHTARGETS) && !defined(MORPHTARGETS_TEXTURE))
                #if MORPHTARGETS_COUNT > 0
                    attribute vec3 morphTarget0;
                #endif
                #if MORPHTARGETS_COUNT > 1
                    attribute vec3 morphTarget1;
                #endif
                #if MORPHTARGETS_COUNT > 2
                    attribute vec3 morphTarget2;
                #endif
                #if MORPHTARGETS_COUNT > 3
                    attribute vec3 morphTarget3;
                #endif
                #if MORPHTARGETS_COUNT > 4
                    attribute vec3 morphTarget4;
                #endif
                #if MORPHTARGETS_COUNT > 5
                    attribute vec3 morphTarget5;
                #endif

                #ifdef USE_MORPHNORMALS
                    #if MORPHTARGETS_COUNT > 0
                        attribute vec3 morphNormal0;
                    #endif
                    #if MORPHTARGETS_COUNT > 1
                        attribute vec3 morphNormal1;
                    #endif
                    #if MORPHTARGETS_COUNT > 2
                        attribute vec3 morphNormal2;
                    #endif
                    #if MORPHTARGETS_COUNT > 3
                        attribute vec3 morphNormal3;
                    #endif
                    #if MORPHTARGETS_COUNT > 4
                        attribute vec3 morphNormal4;
                    #endif
                    #if MORPHTARGETS_COUNT > 5
                        attribute vec3 morphNormal5;
                    #endif
                #else
                    #if MORPHTARGETS_COUNT > 6
                        attribute vec3 morphTarget6;
                    #endif
                    #if MORPHTARGETS_COUNT > 7
                        attribute vec3 morphTarget7;
                    #endif
                    #if MORPHTARGETS_COUNT > 8
                        attribute vec3 morphTarget8;
                    #endif
                    #if MORPHTARGETS_COUNT > 9
                        attribute vec3 morphTarget9;
                    #endif
                    #if MORPHTARGETS_COUNT > 10
                        attribute vec3 morphTarget10;
                    #endif
                    #if MORPHTARGETS_COUNT > 11
                        attribute vec3 morphTarget11;
                    #endif
                #endif
            #endif

            #ifdef USE_SKINNING
                attribute vec4 skinIndex;
                attribute vec4 skinWeight;
            #endif
            `].filter(_h).join(`
`),y=[h,wL(t),"#define SHADER_NAME "+t.shaderName,p,G0e(t.materialProfile),t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+c:"",t.envMap?"#define "+u:"",t.envMap?"#define "+d:"",t.envMapCubeUVTileSize!==0?`#define cubeUV_maxTileSize ${Js(t.envMapCubeUVTileSize)}`:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMap&&t.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",t.normalMap&&t.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",t.specularColorMap?"#define USE_SPECULARCOLORMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",t.vertexTangents?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUvs?"#define USE_UV":"",t.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(t.extensionShaderTextureLOD||t.envMap)&&t.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","#define UNITS_SCALE_FACTOR "+f,"uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==0?"#define TONE_MAPPING":"",t.toneMapping!==0?"#define TONE_MAPPING_LOOK "+V0e(t.toneMappingLook):"",t.toneMapping!==0?Qe.tonemapping_pars_fragment:"",t.toneMapping!==0?F0e("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.opaque&&!t.alphaToCoverage?"#define OPAQUE":"",Qe.encodings_pars_fragment,k0e("linearToOutputTexel",t.outputEncoding),t.useDepthPacking?"#define DEPTH_PACKING "+t.depthPacking:"",t.distancePacking?"#define DISTANCE_PACKING "+t.distancePacking:"",t.useSlopeScaledBias?"#define USE_SLOPE_SCALED_BIAS":"",`#define ESM_DISTANCE_SCALE ${Js(t.esmDistanceScale)}`,t.planeReflProbe?"#define USE_PLANE_REFLECTION":"",t.useGTAO?"#define USE_GTAO":"",n.compatSettings.gtaoDisableBkgFix?"#define GTAO_DISABLE_BKG_FIX":"",t.dirLightShadowsCSMLUT&&t.isWebGL2?`#define LUT_DIR_LIGHT_SHADOWS_CSM int[](${t.dirLightShadowsCSMLUT})`:"",`
`].filter(_h).join(`
`)),t.isWebGL2||t.isRawShaderMaterial===!0||(a=`#include <webgl1_compat>
`+a,s=`#include <webgl1_compat>
`+s),t.isMeshNodeMaterial&&(a=CL(a,t.nodeChunks),s=CL(s,t.nodeChunks)),a=B2(a),a=bL(a,t),a=xL(a,t),t.customPrepTokens&&(a=EL(a,t.customPrepTokens)),s=B2(s),s=bL(s,t),s=xL(s,t),t.customPrepTokens&&(s=EL(s,t.customPrepTokens)),a=SL(a),s=SL(s),t.isWebGL2&&t.isRawShaderMaterial!==!0&&(b=`#version 300 es
`,A=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+A,y=["#define varying in",t.glslVersion===Jy?"":"layout(location = 0) out highp vec4 outFragColor;",t.glslVersion===Jy?"":"#define gl_FragColor outFragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DGradEXT textureGrad"].join(`
`)+`
`+y);let E=b+A+a,x=b+y+s;if(n.debug.disableCompiledShaderCache){const re=x.lastIndexOf("}");x=x.substr(0,re)+"    gl_FragColor += vec4("+.001*Math.random()+`);
`+x.substr(re)}const w=vL(o,35633,E),L=vL(o,35632,x);typeof __V3D_DEVTOOLS__<"u"&&__V3D_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:{shaderName:t.shaderName,materialName:t.materialName,vertex:E,fragment:x}})),o.attachShader(g,w),o.attachShader(g,L),t.index0AttributeName!==void 0?o.bindAttribLocation(g,0,t.index0AttributeName):t.morphTargets===!0&&o.bindAttribLocation(g,0,"position"),o.linkProgram(g);let C,P,D=!0;function Q(){if(D=!1,n.debug.checkShaderErrors){const re=o.getProgramInfoLog(g).trim(),G=o.getShaderInfoLog(w).trim(),se=o.getShaderInfoLog(L).trim();let ee=!0,ie=!0;if(o.getProgramParameter(g,35714)===!1){ee=!1;const H=AL(o,w,"vertex"),T=AL(o,L,"fragment");console.error("v3d.WebGLProgram: shader error: ",o.getError(),"35715",o.getProgramParameter(g,35715),"gl.getProgramInfoLog",re,H,T)}else re!==""?console.warn("v3d.WebGLProgram: gl.getProgramInfoLog()",re):G!==""&&se!==""||(ie=!1);ie&&(_.diagnostics={runnable:ee,programLog:re,vertexShader:{log:G,prefix:A},fragmentShader:{log:se,prefix:y}})}o.deleteShader(w),o.deleteShader(L)}return this.getUniforms=function(){return C===void 0&&(D&&Q(),C=new m0(o,g)),C},this.getAttributes=function(){return P===void 0&&(D&&Q(),P=z0e(o,g)),P},this.destroy=function(){r.releaseStatesOfProgram(this),o.deleteProgram(g),this.program=void 0},this.name=t.shaderName,this.id=B0e++,this.cacheKey=e,this.usedTimes=1,this.program=g,this.vertexShader=w,this.fragmentShader=L,this.profile={calcRenderTime:!1,renderTime:0,timerQueries:[],materials:new Set},this.getTexUniformCount=function(){return this.getUniforms().seq.reduce((function(re,G){if(G.info)switch(G.info.type){case 35678:case 35679:case 35680:case 35682:case 36289:case 36292:case 36293:case 36298:case 36299:case 36300:case 36303:case 36306:case 36307:case 36308:case 36311:re+=G.info.size}return re}),0)},this.beginTimerQuery=function(re,G){if(!this.profile.calcRenderTime)return;const se=re.getExtension(G?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query");if(!se)return;let ee;G?(ee=re.createQuery(),re.beginQuery(se.TIME_ELAPSED_EXT,ee)):(ee=se.createQueryEXT(),se.beginQueryEXT(se.TIME_ELAPSED_EXT,ee)),this.profile.timerQueries.push(ee)},this.endTimerQuery=function(re,G){if(!this.profile.calcRenderTime)return;const se=re.getExtension(G?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query");if(!se)return;G?re.endQuery(se.TIME_ELAPSED_EXT):se.endQueryEXT(se.TIME_ELAPSED_EXT);const ee=this.profile.timerQueries;for(let ie=ee.length-1;ie>=0;ie--){const H=ee[ie],T=G?re.getQueryParameter(H,34919):se.getQueryObjectEXT(H,se.QUERY_RESULT_AVAILABLE_EXT),R=re.getParameter(se.GPU_DISJOINT_EXT);if(T&&!R){const O=G?re.getQueryParameter(H,34918):se.getQueryObjectEXT(H,se.QUERY_RESULT_EXT);this.profile.renderTime+=O/1e6,ee.splice(ie,1)}}},this}let q0e=0;class K0e{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,r=e.fragmentShader,o=this._getShaderStage(t),i=this._getShaderStage(r),a=this._getShaderCacheForMaterial(e);return a.has(o)===!1&&(a.add(o),o.usedTimes++),a.has(i)===!1&&(a.add(i),i.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const r of t)r.usedTimes--,r.usedTimes===0&&this.shaderCache.delete(r.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let r=t.get(e);return r===void 0&&(r=new Set,t.set(e,r)),r}_getShaderStage(e){const t=this.shaderCache;let r=t.get(e);return r===void 0&&(r=new Z0e(e),t.set(e,r)),r}}class Z0e{constructor(e){this.id=q0e++,this.code=e,this.usedTimes=0}}function J0e(n,e,t,r,o,i,a){const s=new Iu,l=new K0e,c=[],u=o.isWebGL2,d=o.logarithmicDepthBuffer,f=o.vertexTextures;let h=o.precision,p=0;const m={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite",MeshMaskMaterial:"mask",MeshNodeMaterial:"node"};return{getParameters:function(g,_,A,y,b,E){const x=y.fog,w=b.geometry,L=g.isMeshNodeMaterial||g.isMeshStandardMaterial?y.environment:null,C=(g.isMeshNodeMaterial||g.isMeshStandardMaterial?t:e).get(g.envMap||L),P=m[g.type];g.precision!==null&&(h=o.getMaxPrecision(g.precision),h!==g.precision&&console.warn("v3d.WebGLProgram.getParameters:",g.precision,"not supported, using",h,"instead."));const D=w.morphAttributes.position||w.morphAttributes.normal||w.morphAttributes.color,Q=D!==void 0?D.length:0;let re,G,se,ee,ie=0;if(w.morphAttributes.position!==void 0&&(ie=1),w.morphAttributes.normal!==void 0&&(ie=2),w.morphAttributes.color!==void 0&&(ie=3),P){const O=Tt[P];re=O.vertexShader,G=O.fragmentShader}else re=g.vertexShader,G=g.fragmentShader,l.update(g),se=l.getVertexShaderID(g),ee=l.getFragmentShaderID(g);const H=n.getRenderTarget(),T=g.alphaTest>0,R=g.clearcoat>0;return{isWebGL2:u,shaderID:P,shaderName:g.type,vertexShader:re,fragmentShader:G,defines:g.defines,customVertexShaderID:se,customFragmentShaderID:ee,isRawShaderMaterial:g.isRawShaderMaterial===!0,glslVersion:g.glslVersion,precision:h,instancing:b.isInstancedMesh===!0,instancingColor:b.isInstancedMesh===!0&&b.instanceColor!==null,supportsVertexTextures:f,outputEncoding:H===null?n.outputEncoding:H.isXRRenderTarget===!0?H.texture.encoding:3e3,map:!!g.map,envMap:!!C,envMapMode:C&&C.mapping,lightMap:!!g.lightMap,aoMap:!!g.aoMap,emissiveMap:!!g.emissiveMap,bumpMap:!!g.bumpMap,normalMap:!!g.normalMap,objectSpaceNormalMap:g.normalMapType===1,tangentSpaceNormalMap:g.normalMapType===0,decodeVideoTexture:!!g.map&&g.map.isVideoTexture===!0&&g.map.encoding===3001,clearcoat:R,clearcoatMap:R&&!!g.clearcoatMap,clearcoatRoughnessMap:R&&!!g.clearcoatRoughnessMap,clearcoatNormalMap:R&&!!g.clearcoatNormalMap,displacementMap:!!g.displacementMap,roughnessMap:!!g.roughnessMap,metalnessMap:!!g.metalnessMap,specularMap:!!g.specularMap,specularIntensityMap:!!g.specularIntensityMap,specularColorMap:!!g.specularColorMap,opaque:g.transparent===!1&&g.blending===1,alphaMap:!!g.alphaMap,alphaTest:T,transmission:g.transmission>0,transmissionMap:!!g.transmissionMap,thicknessMap:!!g.thicknessMap,combine:g.combine,vertexTangents:!!g.normalMap&&!!w.attributes.tangent,vertexColors:g.vertexColors,vertexAlphas:g.vertexColors===!0&&!!w.attributes.color&&w.attributes.color.itemSize===4,vertexUvs:!!(g.map||g.bumpMap||g.normalMap||g.specularMap||g.alphaMap||g.emissiveMap||g.roughnessMap||g.metalnessMap||g.clearcoatMap||g.clearcoatRoughnessMap||g.clearcoatNormalMap||g.displacementMap||g.transmissionMap||g.thicknessMap||g.specularIntensityMap||g.specularColorMap),uvsVertexOnly:!(g.map||g.bumpMap||g.normalMap||g.specularMap||g.alphaMap||g.emissiveMap||g.roughnessMap||g.metalnessMap||g.clearcoatNormalMap||g.transmission>0||g.transmissionMap||g.thicknessMap||g.specularIntensityMap||g.specularColorMap||!g.displacementMap),fog:!!x,useFog:g.fog===!0,fogExp2:x&&x.isFogExp2,flatShading:!!g.flatShading,sizeAttenuation:g.sizeAttenuation,logarithmicDepthBuffer:d,skinning:b.isSkinnedMesh===!0,morphTargets:w.morphAttributes.position!==void 0,morphNormals:w.morphAttributes.normal!==void 0,morphColors:w.morphAttributes.color!==void 0,morphTargetsCount:Q,morphTextureStride:ie,numDirLights:_.directional.length,numPointLights:_.point.length,numSpotLights:_.spot.length,numRectAreaLights:_.rectArea.length,numHemiLights:_.hemi.length,numPointLightShadows:_.pointShadowMap.length,numSpotLightShadows:_.spotShadowMap.length,numClippingPlanes:a.numPlanes,numClipIntersection:a.numIntersection,dithering:g.dithering,shadowMapEnabled:n.shadowMap.enabled&&A.length>0,shadowMapType:n.shadowMap.type,toneMapping:g.toneMapped?n.toneMapping:0,toneMappingLook:g.toneMapped?n.toneMappingLook:0,premultipliedAlpha:g.premultipliedAlpha,doubleSided:g.side===2,flipSided:g.side===1,useDepthPacking:!!g.depthPacking,depthPacking:g.depthPacking||0,envMapCubeUVTileSize:C&&C.mapping===306&&C.image!==void 0?C.image.width/3:0,distancePacking:g.distancePacking!==void 0&&g.distancePacking,useSlopeScaledBias:g.useSlopeScaledBias!==void 0&&g.useSlopeScaledBias,esmDistanceScale:n.shadowMap.esmDistanceScale,numRectAreaLightShadows:_.rectAreaShadowMap.length,numDirLightShadowsCSM:_.directionalShadowCSM.length,numDirLightShadowCSMCascades:_.directionalShadowCSMCascade.length,numDirLightShadowsCSMWithFade:_.numDirectionalShadowsCSMWithFade,dirLightShadowsCSMLUT:_.directionalShadowCSMLUT,planeReflProbe:!!E,materialName:g.name,materialProfile:g.profile,unitsScaleFactor:n.unitsScaleFactor,alphaToCoverage:!!g.alphaToCoverage,customPrepTokens:g.customPrepTokens,definesFragOnly:g.definesFragOnly,isMeshNodeMaterial:g.isMeshNodeMaterial,nodeChunks:g.nodeChunks,nodeChunksHash:g.nodeChunksHash,useGTAO:n.canUseGTAO()&&g.isMeshNodeMaterial&&g.canUseGTAO(),index0AttributeName:g.index0AttributeName,extensionDerivatives:g.extensions&&g.extensions.derivatives,extensionFragDepth:g.extensions&&g.extensions.fragDepth,extensionDrawBuffers:g.extensions&&g.extensions.drawBuffers,extensionShaderTextureLOD:g.extensions&&g.extensions.shaderTextureLOD,rendererExtensionFragDepth:u||r.has("EXT_frag_depth"),rendererExtensionDrawBuffers:u||r.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:u||r.has("EXT_shader_texture_lod"),customProgramCacheKey:g.customProgramCacheKey()}},getProgramCacheKey:function(g){const _=[];g.shaderID?_.push(g.shaderID):(_.push(g.customVertexShaderID),_.push(g.customFragmentShaderID));for(const A in g.defines)_.push(A),_.push(g.defines[A]);if(g.customPrepTokens!==void 0)for(const A in g.customPrepTokens)_.push(A),_.push(g.customPrepTokens[A]);return g.isRawShaderMaterial===!1&&((function(A,y){A.push(y.precision),A.push(y.outputEncoding),A.push(y.envMapMode),A.push(y.combine),A.push(y.vertexUvs),A.push(y.fogExp2),A.push(y.sizeAttenuation),A.push(y.morphTargetsCount),A.push(y.morphAttributeCount),A.push(y.numDirLights),A.push(y.numPointLights),A.push(y.numSpotLights),A.push(y.numHemiLights),A.push(y.numRectAreaLights),A.push(y.numPointLightShadows),A.push(y.numSpotLightShadows),A.push(y.shadowMapType),A.push(y.toneMapping),A.push(y.toneMappingLook),A.push(y.numClippingPlanes),A.push(y.numClipIntersection),A.push(y.depthPacking),A.push(y.envMapCubeUVTileSize),A.push(y.unitsScaleFactor),A.push(y.esmDistanceScale),A.push(y.numRectAreaLightShadows),A.push(y.numDirLightShadowsCSM),A.push(y.numDirLightShadowCSMCascades),A.push(y.numDirLightShadowsCSMWithFade),A.push(y.dirLightShadowsCSMLUT)})(_,g),(function(A,y){s.disableAll(),y.isWebGL2&&s.enable(0),y.supportsVertexTextures&&s.enable(1),y.instancing&&s.enable(2),y.instancingColor&&s.enable(3),y.map&&s.enable(4),y.envMap&&s.enable(5),y.lightMap&&s.enable(6),y.aoMap&&s.enable(7),y.emissiveMap&&s.enable(8),y.bumpMap&&s.enable(9),y.normalMap&&s.enable(10),y.objectSpaceNormalMap&&s.enable(11),y.tangentSpaceNormalMap&&s.enable(12),y.clearcoat&&s.enable(13),y.clearcoatMap&&s.enable(14),y.clearcoatRoughnessMap&&s.enable(15),y.clearcoatNormalMap&&s.enable(16),y.displacementMap&&s.enable(17),y.specularMap&&s.enable(18),y.roughnessMap&&s.enable(19),y.metalnessMap&&s.enable(20),y.alphaMap&&s.enable(21),y.alphaTest&&s.enable(22),y.vertexColors&&s.enable(23),y.vertexAlphas&&s.enable(24),y.vertexUvs&&s.enable(25),y.vertexTangents&&s.enable(26),y.uvsVertexOnly&&s.enable(27),A.push(s.mask),s.disableAll(),y.fog&&s.enable(0),y.useFog&&s.enable(1),y.flatShading&&s.enable(2),y.logarithmicDepthBuffer&&s.enable(3),y.skinning&&s.enable(4),y.morphTargets&&s.enable(5),y.morphNormals&&s.enable(6),y.morphColors&&s.enable(7),y.premultipliedAlpha&&s.enable(8),y.shadowMapEnabled&&s.enable(9),y.doubleSided&&s.enable(10),y.flipSided&&s.enable(11),y.useDepthPacking&&s.enable(12),y.dithering&&s.enable(13),y.specularIntensityMap&&s.enable(14),y.specularColorMap&&s.enable(15),y.transmission&&s.enable(16),y.transmissionMap&&s.enable(17),y.thicknessMap&&s.enable(18),y.decodeVideoTexture&&s.enable(19),y.opaque&&s.enable(20),y.distancePacking&&s.enable(21),y.useSlopeScaledBias&&s.enable(22),y.useGTAO&&s.enable(23),y.planeReflProbe&&s.enable(24),y.alphaToCoverage&&s.enable(25),A.push(s.mask)})(_,g),_.push(n.outputEncoding)),_.push(g.customProgramCacheKey),g.nodeChunksHash!==void 0&&_.push(g.nodeChunksHash),_.join()},getUniforms:function(g){const _=m[g.type];let A;if(_){const y=Tt[_];A=_o.clone(y.uniforms)}else A=g.uniforms;return A},acquireProgram:function(g,_){let A;for(let b=0,E=c.length;b<E;b++){const x=c[b];if(x.cacheKey===_){A=x,++A.usedTimes;break}}A===void 0&&(A=new X0e(n,_,g,i),c.push(A),p++);const y=A.profile.materials;return g.materialName&&!y.has(g.materialName)&&y.add(g.materialName),A},releaseProgram:function(g){if(--g.usedTimes===0){const _=c.indexOf(g);c[_]=c[c.length-1],c.pop(),g.destroy()}},releaseShaderCache:function(g){l.remove(g)},programs:c,getNumShaderCompiles:function(){return p},dispose:function(){l.dispose()}}}function e1e(){let n=new WeakMap;return{get:function(e){let t=n.get(e);return t===void 0&&(t={},n.set(e,t)),t},remove:function(e){n.delete(e)},update:function(e,t,r){n.get(e)[t]=r},dispose:function(){n=new WeakMap}}}function t1e(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.material.id!==e.material.id?n.material.id-e.material.id:n.z!==e.z?n.z-e.z:n.id-e.id}function ML(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.z!==e.z?e.z-n.z:n.id-e.id}function TL(){const n=[];let e=0;const t=[],r=[],o=[];function i(a,s,l,c,u,d){let f=n[e];return f===void 0?(f={id:a.id,object:a,geometry:s,material:l,groupOrder:c,renderOrder:a.renderOrder,z:u,group:d},n[e]=f):(f.id=a.id,f.object=a,f.geometry=s,f.material=l,f.groupOrder=c,f.renderOrder=a.renderOrder,f.z=u,f.group=d),e++,f}return{opaque:t,transmissive:r,transparent:o,init:function(){e=0,t.length=0,r.length=0,o.length=0},push:function(a,s,l,c,u,d){const f=i(a,s,l,c,u,d);l.transmission>0?r.push(f):l.transparent===!0?o.push(f):t.push(f)},unshift:function(a,s,l,c,u,d){const f=i(a,s,l,c,u,d);l.transmission>0?r.unshift(f):l.transparent===!0?o.unshift(f):t.unshift(f)},finish:function(){for(let a=e,s=n.length;a<s;a++){const l=n[a];if(l.id===null)break;l.id=null,l.object=null,l.geometry=null,l.material=null,l.group=null}},sort:function(a,s){t.length>1&&t.sort(a||t1e),r.length>1&&r.sort(s||ML),o.length>1&&o.sort(s||ML)}}}function n1e(){let n=new WeakMap;return{get:function(e,t){const r=n.get(e);let o;return r===void 0?(o=new TL,n.set(e,[o])):t>=r.length?(o=new TL,r.push(o)):o=r[t],o},dispose:function(){n=new WeakMap}}}function r1e(){const n={};return{get:function(e){if(n[e.id]!==void 0)return n[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new N,color:new Ge};break;case"SpotLight":t={position:new N,direction:new N,color:new Ge,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new N,color:new Ge,distance:0,decay:0};break;case"HemisphereLight":t={direction:new N,skyColor:new Ge,groundColor:new Ge};break;case"RectAreaLight":t={color:new Ge,position:new N,halfWidth:new N,halfHeight:new N}}return n[e.id]=t,t}}}function o1e(){const n={};return{get:function(e){if(n[e.id]!==void 0)return n[e.id];let t;switch(e.type){case"DirectionalLight":t={cascadeIdxEnd:1,cameraNear:1,shadowFar:0,fade:.25};break;case"SpotLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new be,shadow:0,shadowCameraNear:1,shadowCameraFar:1e3,expBias:1};break;case"PointLight":case"RectAreaLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new be,shadowCameraNear:1,shadowCameraFar:1e3,expBias:1}}return n[e.id]=t,t}}}let i1e=0;function a1e(n,e){const t=n.shadow,r=e.shadow;let o=0;return t&&t.isDirectionalLightShadowCSM&&r&&r.isDirectionalLightShadowCSM&&(o+=(r.fade!=0?1:0)-(t.fade!=0?1:0)),(e.castShadow?4:0)-(n.castShadow?4:0)+(e.map?2:0)-(n.map?2:0)+o}function s1e(n,e){const t=new r1e,r=o1e(),o={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numPointShadows:-1,numSpotShadows:-1,numRectAreaShadows:-1,numDirectionalShadowsCSM:-1,numDirectionalShadowsCSMCascade:-1,numDirectionalShadowsCSMWithFade:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],rectAreaShadow:[],rectAreaShadowMap:[],rectAreaShadowMatrix:[],directionalShadowCSM:[],directionalShadowCSMMap:[],directionalShadowCSMMatrix:[],directionalShadowCSMCascade:[],directionalShadowCSMLUT:[],numDirectionalShadowsCSMWithFade:0};for(let l=0;l<9;l++)o.probe.push(new N);const i=new N,a=new Ue,s=new Ue;return{setup:function(l){let c=0,u=0,d=0;for(let L=0;L<9;L++)o.probe[L].set(0,0,0);let f=0,h=0,p=0,m=0,g=0,_=0,A=0,y=0,b=0,E=0,x=0;l.sort(a1e);for(let L=0,C=l.length;L<C;L++){const P=l[L],D=P.color,Q=P.intensity,re=P.distance,G=P.shadow&&P.shadow.map?P.shadow.map.texture:null;if(P.isAmbientLight)c+=D.r*Q,u+=D.g*Q,d+=D.b*Q;else if(P.isLightProbe)for(let se=0;se<9;se++)o.probe[se].addScaledVector(P.sh.coefficients[se],Q);else if(P.isDirectionalLight){const se=t.get(P);if(se.color.copy(P.color).multiplyScalar(P.intensity),P.castShadow){const ee=P.shadow,ie=r.get(P);ie.cascadeIdxEnd=x+ee.numCascades,ie.fade=ee.fade,E+=ee.fade!=0?ee.numCascades:0;for(let H=0;H<ee.numCascades;H++){let T=x+H;o.directionalShadowCSMCascade[T]||(o.directionalShadowCSMCascade[T]={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new be,shadowCameraNear:1,shadowCameraFar:1,cascade:new be,expBias:1,position:new N,csmIdx:0},o.directionalShadowCSMMap[T]=null,o.directionalShadowCSMMatrix[T]=ee.matrix)}for(let H=0;H<ee.numCascades;H++){const T=x+H,R=o.directionalShadowCSMCascade[T],O=ee._cascades[H],W=O.map?O.map.texture:null;o.directionalShadowCSMMap[T]=W,o.directionalShadowCSMMatrix[T]=O.matrix,R.shadowBias=O.bias,R.shadowNormalBias=O.normalBias,R.shadowRadius=O.radius,R.shadowMapSize=O.mapSize,R.position.setFromMatrixPosition(O.camera.matrixWorld),R.shadowCameraNear=O.camera.near,R.shadowCameraFar=O.camera.far,ee.getCascadeRange(R.cascade,H),R.expBias=O.expBias,R.csmIdx=b,o.directionalShadowCSMLUT[T]=b}x+=ee.numCascades,o.directionalShadowCSM[b]=ie,b++}o.directional[f]=se,f++}else if(P.isSpotLight){const se=t.get(P);if(se.position.setFromMatrixPosition(P.matrixWorld),se.color.copy(D).multiplyScalar(Q),se.distance=re,se.coneCos=Math.cos(P.angle),se.penumbraCos=Math.cos(P.angle*(1-P.penumbra)),se.decay=P.decay,o.spot[p]=se,P.castShadow){const ee=P.shadow,ie=r.get(P);ie.shadowBias=ee.bias,ie.shadowNormalBias=ee.normalBias,ie.shadowRadius=ee.radius,ie.shadowMapSize=ee.mapSize,o.spotShadow[p]=ie,o.spotShadowMap[p]=G,o.spotShadowMatrix[p]=ee.matrix,ie.shadow=P.castShadow?ee.calcUseOmniMaps(P.angle)?2:1:0,ie.shadowCameraNear=ee.camera.near,ie.shadowCameraFar=ee.camera.far,ie.expBias=ee.expBias,A++}p++}else if(P.isRectAreaLight){const se=t.get(P);if(se.color.copy(D).multiplyScalar(Q),se.halfWidth.set(.5*P.width,0,0),se.halfHeight.set(0,.5*P.height,0),P.castShadow){const ee=P.shadow,ie=r.get(P);ie.shadowBias=ee.bias,ie.shadowNormalBias=ee.normalBias,ie.shadowRadius=ee.radius,ie.shadowMapSize=ee.mapSize,ie.shadowCameraNear=ee.camera.near,ie.shadowCameraFar=ee.camera.far,ie.expBias=ee.expBias,o.rectAreaShadow[m]=ie,o.rectAreaShadowMap[m]=G,o.rectAreaShadowMatrix[m]=ee.matrix,y++}o.rectArea[m]=se,m++}else if(P.isPointLight){const se=t.get(P);if(se.color.copy(P.color).multiplyScalar(P.intensity),se.distance=P.distance,se.decay=P.decay,P.castShadow){const ee=P.shadow,ie=r.get(P);ie.shadowBias=ee.bias,ie.shadowNormalBias=ee.normalBias,ie.shadowRadius=ee.radius,ie.shadowMapSize=ee.mapSize,ie.shadowCameraNear=ee.camera.near,ie.shadowCameraFar=ee.camera.far,ie.expBias=ee.expBias,o.pointShadow[h]=ie,o.pointShadowMap[h]=G,o.pointShadowMatrix[h]=ee.matrix,_++}o.point[h]=se,h++}else if(P.isHemisphereLight){const se=t.get(P);se.skyColor.copy(P.color).multiplyScalar(Q),se.groundColor.copy(P.groundColor).multiplyScalar(Q),o.hemi[g]=se,g++}}m>0&&(e.isWebGL2||n.has("OES_texture_float_linear")===!0?(o.rectAreaLTC1=qe.LTC_FLOAT_1,o.rectAreaLTC2=qe.LTC_FLOAT_2):n.has("OES_texture_half_float_linear")===!0?(o.rectAreaLTC1=qe.LTC_HALF_1,o.rectAreaLTC2=qe.LTC_HALF_2):console.error("v3d.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),o.ambient[0]=c,o.ambient[1]=u,o.ambient[2]=d;const w=o.hash;w.directionalLength===f&&w.pointLength===h&&w.spotLength===p&&w.rectAreaLength===m&&w.hemiLength===g&&w.numPointShadows===_&&w.numSpotShadows===A&&w.numRectAreaShadows===y&&w.numDirectionalShadowsCSM===b&&w.numDirectionalShadowsCSMCascade===x&&w.numDirectionalShadowsCSMWithFade===E||(o.directional.length=f,o.spot.length=p,o.rectArea.length=m,o.point.length=h,o.hemi.length=g,o.pointShadow.length=_,o.pointShadowMap.length=_,o.spotShadow.length=A,o.spotShadowMap.length=A,o.pointShadowMatrix.length=_,o.spotShadowMatrix.length=A,w.directionalLength=f,w.pointLength=h,w.spotLength=p,w.rectAreaLength=m,w.hemiLength=g,w.numPointShadows=_,w.numSpotShadows=A,o.rectAreaShadow.length=y,o.rectAreaShadowMap.length=y,o.rectAreaShadowMatrix.length=y,o.directionalShadowCSM.length=b,o.directionalShadowCSMMap.length=x,o.directionalShadowCSMMatrix.length=x,o.directionalShadowCSMCascade.length=x,o.directionalShadowCSMLUT.length=x,o.numDirectionalShadowsCSMWithFade=E,w.numRectAreaShadows=y,w.numDirectionalShadowsCSM=b,w.numDirectionalShadowsCSMCascade=x,w.numDirectionalShadowsCSMWithFade=E,o.version=i1e++)},setupView:function(l,c){let u=0,d=0,f=0,h=0,p=0,m=0;const g=c.matrixWorldInverse;for(let _=0,A=l.length;_<A;_++){const y=l[_];if(y.isDirectionalLight){const b=o.directional[u];if(b.direction.setFromMatrixPosition(y.matrixWorld),i.setFromMatrixPosition(y.target.matrixWorld),b.direction.sub(i),b.direction.transformDirection(g),y.castShadow){const E=y.shadow,x=r.get(y);x.cameraNear=Math.min(E.maxDistance,c.near),x.shadowFar=Math.min(E.maxDistance,c.far);for(let w=0;w<E.numCascades;w++){const L=m+w,C=o.directionalShadowCSMCascade[L],P=E._cascades[w];C.shadowCameraFar=P.camera.far,C.position.setFromMatrixPosition(P.camera.matrixWorld),C.position.applyMatrix4(g)}m+=E.numCascades}u++}else if(y.isSpotLight){const b=o.spot[f];b.position.setFromMatrixPosition(y.matrixWorld),b.position.applyMatrix4(g),b.direction.setFromMatrixPosition(y.matrixWorld),i.setFromMatrixPosition(y.target.matrixWorld),b.direction.sub(i),b.direction.transformDirection(g),f++}else if(y.isRectAreaLight){const b=o.rectArea[h];b.position.setFromMatrixPosition(y.matrixWorld),b.position.applyMatrix4(g),s.identity(),a.copy(y.matrixWorld),a.premultiply(g),s.extractRotation(a),b.halfWidth.set(.5*y.width,0,0),b.halfHeight.set(0,.5*y.height,0),b.halfWidth.applyMatrix4(s),b.halfHeight.applyMatrix4(s),h++}else if(y.isPointLight){const b=o.point[d];b.position.setFromMatrixPosition(y.matrixWorld),b.position.applyMatrix4(g),d++}else if(y.isHemisphereLight){const b=o.hemi[p];b.direction.setFromMatrixPosition(y.matrixWorld),b.direction.transformDirection(g),p++}}},state:o}}function N2(n,e){const t=new s1e(n,e),r=[],o=[],i=[],a=[];return{init:function(){r.length=0,o.length=0,i.length=0,a.length=0},state:{lightsArray:r,shadowsArray:o,envMapProbeArray:i,planeReflProbeArray:a,lights:t},setupLights:function(){t.setup(r)},setupLightsView:function(s){t.setupView(r,s)},pushLight:function(s){r.push(s)},pushShadow:function(s){o.push(s)},pushEnvMapProbe:function(s){i.push(s)},sortEnvMapProbes:function(){i.sort(((s,l)=>s.influenceDistance-l.influenceDistance))},pushPlaneReflProbe:function(s){a.push(s)}}}function l1e(n,e){let t=new WeakMap;return{get:function(r,o=0){const i=t.get(r);let a;return i===void 0?(a=new N2(n,e),t.set(r,[a])):o>=i.length?(a=new N2(n,e),i.push(a)):a=i[o],a},dispose:function(){t=new WeakMap}}}class Gu extends Nr{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=3200,this.useSlopeScaledBias=!1,this.slopeScaledBias=0,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.useSlopeScaledBias=e.useSlopeScaledBias,this.slopeScaledBias=e.slopeScaledBias,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class IL extends Nr{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.referencePosition=new N,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.defines={DISTANCE_SCALE:"1.0"},this.distancePacking=3301,this.useSlopeScaledBias=!1,this.slopeScaledBias=0,this.setValues(e)}copy(e){return super.copy(e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.distancePacking=e.distancePacking,this.useSlopeScaledBias=e.useSlopeScaledBias,this.slopeScaledBias=e.slopeScaledBias,this}}const O2=new Ue,RL=new N,LL=new N;class g0{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.mapSize=new be(512,512),this.map=null,this.matrix=new Ue,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new ph,this._frameExtents=new be(1,1),this._viewportCount=1,this._viewports=[new pt(0,0,1,1)],this.expBias=1,this.slopeScaledBias=0,this._additionalMap2D=null,this._additionalMapCube=null,this.isLightShadow=!0}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,r=this.matrix;RL.setFromMatrixPosition(e.matrixWorld),t.position.copy(RL),LL.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(LL),t.updateMatrixWorld(),O2.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(O2),r.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),r.multiply(O2)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this._additionalMap2D!==null&&this._additionalMap2D.dispose(),this._additionalMapCube!==null&&this._additionalMapCube.dispose()}removeMaps(){this.map=null,this._additionalMap2D=null,this._additionalMapCube=null}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this.expBias=e.expBias,this.slopeScaledBias=e.slopeScaledBias,this}clone(){return new this.constructor().copy(this)}}const c1e=Math.PI/4,PL=new Ue,vh=new N,k2=new N;class u1e extends g0{constructor(){super(new gr(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1,this.useOmniMaps=!1,this.useMinFov90=!1,this._frameExtentsOmni=new be(4,2),this._viewportCountOmni=6,this._viewportsOmni=[new pt(2,1,1,1),new pt(0,1,1,1),new pt(3,1,1,1),new pt(1,1,1,1),new pt(3,0,1,1),new pt(1,0,1,1)],this._cubeDirections=[new N(1,0,0),new N(-1,0,0),new N(0,0,1),new N(0,0,-1),new N(0,1,0),new N(0,-1,0)],this._cubeUps=[new N(0,1,0),new N(0,1,0),new N(0,1,0),new N(0,1,0),new N(0,0,1),new N(0,0,-1)]}updateMatrices(e,t=0){if(this.useOmniMaps){const r=this.camera,o=this.matrix;vh.setFromMatrixPosition(e.matrixWorld),r.position.copy(vh),k2.copy(r.position),k2.add(this._cubeDirections[t]),r.up.copy(this._cubeUps[t]),r.lookAt(k2),r.updateMatrixWorld(),o.makeTranslation(-vh.x,-vh.y,-vh.z),PL.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),this._frustum.setFromProjectionMatrix(PL)}else{const r=this.camera,o=2*xu*e.angle*this.focus,i=this.mapSize.width/this.mapSize.height,a=e.distance||r.far;o===r.fov&&i===r.aspect&&a===r.far||(r.fov=o,r.aspect=i,r.far=a,r.updateProjectionMatrix()),super.updateMatrices(e)}}getViewportCount(){return this.useOmniMaps?this._viewportCountOmni:super.getViewportCount()}getViewport(e){return this.useOmniMaps?this._viewportsOmni[e]:super.getViewport(e)}getFrameExtents(){return this.useOmniMaps?this._frameExtentsOmni:super.getFrameExtents()}calcUseOmniMaps(e){return this.useOmniMaps=e>c1e,this.useOmniMaps}copy(e){return super.copy(e),this.focus=e.focus,this.useOmniMaps=e.useOmniMaps,this.useMinFov90=e.useMinFov90,this}}function d1e(n,e,t){let r=new ph;const o=new be,i=new be,a=new pt,s=new Gu({depthPacking:3201}),l=new IL,c={},u=t.maxTextureSize,d=t.isWebGL2,f={0:1,1:0,2:2},h=new Ue;new Ue;const p=new be(u,u),m=new N,g=new N;new N;const _=[new N(1,0,0),new N(-1,0,0),new N(0,1,0),new N(0,-1,0),new N(0,0,1),new N(0,0,-1)],A=[new N(0,1,0),new N(0,1,0),new N(0,0,1),new N(0,0,-1),new N(0,1,0),new N(0,1,0)];new pt,new pt,new pt,new pt,new pt,new pt,new ni,new N,new N,new N,new N,new N,new N,new N,new N;const y=new Mt(new ms(1,1,1,1));y.name="esmFarPlane",y.castShadow=!0,y.material.shadowSide=0;const b=new ya(-1,1,1,-1,0,10),E=new Mt(new ms(2,2)),x=new Dn({type:"ShadowCubeOctahedral",defines:Object.assign({},Tt.cubeOctahedral.defines),uniforms:_o.clone(Tt.cubeOctahedral.uniforms),vertexShader:Tt.cubeOctahedral.vertexShader,fragmentShader:Tt.cubeOctahedral.fragmentShader}),w={},L={},C=this;function P(ie,H,T,R,O,W,ae,ne,oe){let F=null;const k=ne||ae===3?ie.customDistanceMaterial:ie.customDepthMaterial;if(F=k!==void 0?k:ne||ae===3?l:s,n.localClippingEnabled&&T.clipShadows===!0&&Array.isArray(T.clippingPlanes)&&T.clippingPlanes.length!==0||T.displacementMap&&T.displacementScale!==0||T.alphaMap&&T.alphaTest>0||T.map&&T.alphaTest>0){const q=F.uuid,j=T.uuid;let U=c[q];U===void 0&&(U={},c[q]=U);let z=U[j];z===void 0&&(z=F.clone(),U[j]=z),F=z}switch(F.visible=T.visible,F.wireframe=T.wireframe,F.side=T.shadowSide!==null?T.shadowSide:f[T.side],F.alphaMap=T.alphaMap,F.alphaTest=T.alphaTest,F.map=T.map,F.clipShadows=T.clipShadows,F.clippingPlanes=T.clippingPlanes,F.clipIntersection=T.clipIntersection,F.displacementMap=T.displacementMap,F.displacementScale=T.displacementScale,F.displacementBias=T.displacementBias,F.wireframeLinewidth=T.wireframeLinewidth,F.linewidth=T.linewidth,!ne&&ae!==3||F.isMeshDistanceMaterial!==!0||(F.referencePosition.copy(oe),F.nearDistance=O,F.farDistance=W,F.distancePacking=ae===3?3302:3301),ae===3&&(F.defines.DISTANCE_SCALE=Js(C.esmDistanceScale)),R.shadow.isDirectionalLightShadowCascade&&R.shadow.pancakeDepth&&(F.defines.PANCAKE_DEPTH="",F.defines.CAM_WIDTH=Js(R.shadow.camera.right),F.defines.CAM_HEIGHT=Js(R.shadow.camera.top)),ae){case 0:case 1:case 2:F.useSlopeScaledBias=!0,F.slopeScaledBias=R.shadow.slopeScaledBias;break;case 3:F.useSlopeScaledBias=!0,F.slopeScaledBias=.5}return F}function D(ie,H,T,R,O,W){if(ie.visible===!1)return;if((H.ignoreShadowLayers||ie.layers.test(H.layers))&&(ie.isMesh||ie.isLine||ie.isPoints)&&ie.castShadow&&(!ie.frustumCulled||r.intersectsObject(ie))){ie.modelViewMatrix.multiplyMatrices(T.matrixWorldInverse,ie.matrixWorld);const ne=e.update(ie),oe=ie.material;if(Array.isArray(oe)){const F=ne.groups;for(let k=0,q=F.length;k<q;k++){const j=F[k],U=oe[j.materialIndex];if(U&&U.visible){const z=P(ie,0,U,R,T.near,T.far,O,W,g);n.renderBufferDirect(T,null,ne,z,ie,j)}}}else if(oe.visible){const F=P(ie,0,oe,R,T.near,T.far,O,W,g);n.renderBufferDirect(T,null,ne,F,ie,null)}}const ae=ie.children;for(let ne=0,oe=ae.length;ne<oe;ne++)D(ae[ne],H,T,R,O,W)}function Q(ie,H,T,R){const O=T.shadow,W=O.camera;O.isDirectionalLightShadowCascade?g.setFromMatrixPosition(W.matrixWorld):g.setFromMatrixPosition(T.matrixWorld),o.copy(O.mapSize);const ae=O.getFrameExtents();if(o.multiply(ae),i.copy(O.mapSize),(o.x>u||o.y>u)&&(o.x>u&&(i.x=Math.floor(u/ae.x),o.x=i.x*ae.x,O.mapSize.x=i.x),o.y>u&&(i.y=Math.floor(u/ae.y),o.y=i.y*ae.y,O.mapSize.y=i.y)),T.isSpotLight&&O.map&&O.map.width/O.map.height!==2){const F=O.map;O.map=O._additionalMap2D,O._additionalMap2D=F}const ne=T.isPointLight||T.isRectAreaLight||T.isSpotLight&&O.useOmniMaps;if(ne?T.isSpotLight&&(W.fov=90,W.updateProjectionMatrix()):T.isSpotLight&&O.useMinFov90&&(W.fov=90,W.updateProjectionMatrix()),O.map===null){const F={minFilter:1003,magFilter:1003,format:1023};O.map=new nn(o.x,o.y,F),O.map.texture.name=T.name+".shadowMap",W.updateProjectionMatrix()}n.state.buffers.color.setClear(1,1,1,1),n.setRenderTarget(O.map),n.clear();const oe=O.getViewportCount();for(let F=0;F<oe;F++){const k=O.getViewport(F);a.set(i.x*k.x,i.y*k.y,i.x*k.z,i.y*k.w),n.state.viewport(a),O.updateMatrices(T,F),r.copy(O.getFrustum()),D(ie,H,O.camera,T,R,ne)}}function re(ie,H,T,R){const O=T.shadow,W=O.camera,ae=O.matrix,ne=T.isPointLight||T.isRectAreaLight?2:1,oe=o.copy(O.mapSize).multiplyScalar(ne).min(p).multiplyScalar(1/ne);O._additionalMapCube===null&&(O._additionalMapCube=new hh(oe.x,{minFilter:1006,magFilter:1006,format:d?1028:1023,type:1016}),O._additionalMapCube.texture.name=T.name+".shadowMap.tmpCube"),O._additionalMap2D===null&&(O._additionalMap2D=new nn(oe.x*ne,oe.y*ne,{minFilter:1006,magFilter:1006,format:d?1028:1023,type:1016}),O._additionalMap2D.texture.name=T.name+".shadowMap.tmp2D"),O.map===null&&(O.map=new nn(oe.x*ne,oe.y*ne,{minFilter:1006,magFilter:1006,format:d?1028:1023,type:1016}),O.map.texture.name=T.name+".shadowMap"),g.setFromMatrixPosition(T.matrixWorld),W.position.copy(g),T.isSpotLight&&(W.fov=90,W.updateProjectionMatrix()),ae.makeTranslation(-g.x,-g.y,-g.z);for(let q=0;q<6;q++)m.copy(W.position),m.add(_[q]),W.up.copy(A[q]),q!==2&&q!==3&&W.up.multiplyScalar(-1),W.lookAt(m),W.updateMatrixWorld(),h.multiplyMatrices(W.projectionMatrix,W.matrixWorldInverse),r.setFromProjectionMatrix(h),n.setRenderTarget(O._additionalMapCube,q),n.clearDepth(),ee(H,W,T,R),D(ie,H,W,T,R,!0);const F=Math.max(O.radius*ne,.001),k=(function(q){return Math.ceil(.2*q)})(F);(function(q,j,U){const z=E.material=x;z.uniforms.tCube.value=j.texture,z.uniforms.texelSize.value.set(1/U.width,1/U.height),z.uniformsNeedUpdate=!0,q.setRenderTarget(U),q.clear(),q.updateGeometry(E),q.renderBufferDirect(b,null,E.geometry,z,E,null)})(n,O._additionalMapCube,O.map),G(n,O.map,O._additionalMap2D,k,F,1,0),G(n,O._additionalMap2D,O.map,k,F,0,0)}function G(ie,H,T,R,O,W,ae){const ne=E.material=ae===0?(function(oe){return oe in w||((w[oe]=new Dn({type:"ShadowBlur",defines:Object.assign({},Tt.blur.defines,{LOG_SPACE:1,OCTAHEDRAL_MAP:1}),uniforms:_o.clone(Tt.blur.uniforms),customPrepTokens:Object.assign({},Tt.blur.customPrepTokens),vertexShader:Tt.blur.vertexShader,fragmentShader:Tt.blur.fragmentShader})).customPrepTokens.MAX_SAMPLE_RADIUS=oe),w[oe]})(R):(function(oe){return oe in L||((L[oe]=new Dn({type:"ShadowBlur",defines:Object.assign({},Tt.blur.defines,{LOG_SPACE:1}),uniforms:_o.clone(Tt.blur.uniforms),customPrepTokens:Object.assign({},Tt.blur.customPrepTokens),vertexShader:Tt.blur.vertexShader,fragmentShader:Tt.blur.fragmentShader})).customPrepTokens.MAX_SAMPLE_RADIUS=oe),L[oe]})(R);ne.uniforms.direction.value.set(+(W===0),+(W===1)),ne.uniforms.colorTexture.value=H.texture,ne.uniforms.texSize.value.set(H.width,H.height),ne.uniforms.kernelRadius.value=O,ne.uniformsNeedUpdate=!0,ie.setRenderTarget(T),ie.clear(),ie.updateGeometry(E),ie.renderBufferDirect(b,null,E.geometry,ne,E,null)}function se(ie,H,T,R){const O=T.shadow,W=O.camera,ae=O.matrix,ne=o.copy(O.mapSize).min(p);let oe;O._additionalMap2D===null&&(O._additionalMap2D=new nn(ne.x,ne.y,{minFilter:1006,magFilter:1006,format:d?1028:1023,type:1016}),O._additionalMap2D.texture.name=T.name+".shadowMap.tmp2D"),O.map===null&&(O.map=new nn(ne.x,ne.y,{minFilter:1006,magFilter:1006,format:d?1028:1023,type:1016}),O.map.texture.name=T.name+".shadowMap"),O.isDirectionalLightShadowCascade?g.setFromMatrixPosition(W.matrixWorld):(g.setFromMatrixPosition(T.matrixWorld),W.position.copy(g),m.setFromMatrixPosition(T.target.matrixWorld),W.lookAt(m),W.updateMatrixWorld()),T.isSpotLight&&O.useMinFov90&&(W.fov=90,W.updateProjectionMatrix()),O.isDirectionalLightShadowCascade?(O.updateMatrices(T),r.copy(O.getFrustum())):(ae.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),ae.multiply(W.projectionMatrix),ae.multiply(W.matrixWorldInverse),h.multiplyMatrices(W.projectionMatrix,W.matrixWorldInverse),r.setFromProjectionMatrix(h)),n.setRenderTarget(O.map),n.clearDepth(),ee(H,W,T,R),D(ie,H,W,T,R,!1),oe=T.isDirectionalLight&&T.shadow.isDirectionalLightShadowCascade?50*O.esmBlurRadius:T.isSpotLight?.8*O.radius:O.radius,oe=Math.max(oe,.001);const F=(function(k){return Math.ceil(.8*k)})(oe);G(n,O.map,O._additionalMap2D,F,oe,0,1),G(n,O._additionalMap2D,O.map,F,oe,1,1)}function ee(ie,H,T,R){let O,W,ae,ne,oe,F;H.isPerspectiveCamera?(O=W=0,ae=-.999*H.far,ne=oe=2*-ae*Math.tan(ih(H.fov)/2),F=1):H.isOrthographicCamera&&(O=(H.right+H.left)/2,W=(H.top+H.bottom)/2,ae=-.999*H.far,ne=H.right-H.left,oe=H.top-H.bottom,F=1),H.add(y),y.scale.set(ne,oe,F),y.position.set(O,W,ae),y.updateMatrixWorld(),D(y,ie,H,T,R,!0)}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=2,this.esmDistanceScale=1,this.render=function(ie,H,T){if(C.enabled===!1||C.autoUpdate===!1&&C.needsUpdate===!1||ie.length===0)return;const R=n.getRenderTarget(),O=n.getActiveCubeFace(),W=n.getActiveMipmapLevel(),ae=n.state;ae.setBlending(0),ae.buffers.color.setClear(1,1,1,1),ae.buffers.depth.setTest(!0),ae.setScissorTest(!1);for(let ne=0,oe=ie.length;ne<oe;ne++){const F=ie[ne],k=F.shadow;if(k!==void 0){if(k.autoUpdate!==!1||k.needsUpdate!==!1){if(F.isSpotLight&&k.calcUseOmniMaps(F.angle),F.isPointLight||F.isRectAreaLight||F.isSpotLight&&k.useOmniMaps)switch(C.type){case 0:case 1:case 2:Q(H,T,F,C.type);break;case 3:re(H,T,F,C.type);break;default:continue}else{if(!F.isSpotLight&&!F.isDirectionalLight)continue;switch(C.type){case 0:case 1:case 2:if(k.isDirectionalLightShadowCSM){k.update(T,F);const q=F.shadow;for(let j=0;j<q.numCascades;j++)F.shadow=q._cascades[j],Q(H,T,F,C.type);F.shadow=q}else Q(H,T,F,C.type);break;case 3:if(k.isDirectionalLightShadowCSM){k.update(T,F);const q=F.shadow;for(let j=0;j<q.numCascades;j++)F.shadow=q._cascades[j],se(H,T,F,C.type);F.shadow=q}else se(H,T,F,C.type);break;default:continue}}k.needsUpdate=!1}}else console.warn("v3d.WebGLShadowMap:",F,"has no shadow.")}C.needsUpdate=!1,n.setRenderTarget(R,O,W)}}function f1e(n,e,t){const r=t.isWebGL2,o=new function(){let v=!1;const M=new pt;let S=null;const I=new pt(0,0,0,0);return{setMask:function(J){S===J||v||(n.colorMask(J,J,J,J),S=J)},getMask:function(){return S},setLocked:function(J){v=J},setClear:function(J,$,B,V,Y){Y===!0&&(J*=V,$*=V,B*=V),M.set(J,$,B,V),I.equals(M)===!1&&(n.clearColor(J,$,B,V),I.copy(M))},reset:function(){v=!1,S=null,I.set(-1,0,0,0)}}},i=new function(){let v=!1,M=null,S=null,I=null,J=null;return{setTest:function($){$!==J&&($?ne(2929):oe(2929),J=$)},getTest:function(){return J},setMask:function($){M===$||v||(n.depthMask($),M=$)},setFunc:function($){if(S!==$){switch($){case 0:n.depthFunc(512);break;case 1:n.depthFunc(519);break;case 2:n.depthFunc(513);break;case 3:default:n.depthFunc(515);break;case 4:n.depthFunc(514);break;case 5:n.depthFunc(518);break;case 6:n.depthFunc(516);break;case 7:n.depthFunc(517)}S=$}},setLocked:function($){v=$},setClear:function($){I!==$&&(n.clearDepth($),I=$)},reset:function(){v=!1,M=null,S=null,I=null}}},a=new function(){let v=!1,M=null,S=null,I=null,J=null,$=null,B=null,V=null,Y=null;return{setTest:function(le){v||(le?ne(2960):oe(2960))},setMask:function(le){M===le||v||(n.stencilMask(le),M=le)},setFunc:function(le,me,fe){S===le&&I===me&&J===fe||(n.stencilFunc(le,me,fe),S=le,I=me,J=fe)},setOp:function(le,me,fe){$===le&&B===me&&V===fe||(n.stencilOp(le,me,fe),$=le,B=me,V=fe)},setLocked:function(le){v=le},setClear:function(le){Y!==le&&(n.clearStencil(le),Y=le)},reset:function(){v=!1,M=null,S=null,I=null,J=null,$=null,B=null,V=null,Y=null}}},s=new WeakMap,l=new WeakMap;let c={},u={},d=new WeakMap,f=[],h=null,p=!1,m=null,g=null,_=null,A=null,y=null,b=null,E=null,x=!1,w=null,L=null,C=null,P=null,D=null;const Q=n.getParameter(35661);let re=!1,G=0;const se=n.getParameter(7938);se.indexOf("WebGL")!==-1?(G=parseFloat(/^WebGL (\d)/.exec(se)[1]),re=G>=1):se.indexOf("OpenGL ES")!==-1&&(G=parseFloat(/^OpenGL ES (\d)/.exec(se)[1]),re=G>=2);let ee=null,ie={};const H=n.getParameter(3088),T=n.getParameter(2978),R=new pt().fromArray(H),O=new pt().fromArray(T);function W(v,M,S){const I=new Uint8Array(4),J=n.createTexture();n.bindTexture(v,J),n.texParameteri(v,10241,9728),n.texParameteri(v,10240,9728);for(let $=0;$<S;$++)n.texImage2D(M+$,0,6408,1,1,0,6408,5121,I);return J}const ae={};function ne(v){c[v]!==!0&&(n.enable(v),c[v]=!0)}function oe(v){c[v]!==!1&&(n.disable(v),c[v]=!1)}ae[3553]=W(3553,3553,1),ae[34067]=W(34067,34069,6),o.setClear(0,0,0,1),i.setClear(1),a.setClear(0),ne(2929),i.setFunc(3),j(!1),U(1),ne(2884),q(0);const F={[X5]:32774,[q5]:32778,[K5]:32779};if(r)F[103]=32775,F[104]=32776;else{const v=e.get("EXT_blend_minmax");v!==null&&(F[103]=v.MIN_EXT,F[104]=v.MAX_EXT)}const k={[Z5]:0,[J5]:1,[eR]:768,[nR]:770,[lR]:776,[aR]:774,[oR]:772,[tR]:769,[rR]:771,[sR]:775,[iR]:773};function q(v,M,S,I,J,$,B,V){if(v!==0){if(p===!1&&(ne(3042),p=!0),v===5)J=J||M,$=$||S,B=B||I,M===g&&J===y||(n.blendEquationSeparate(F[M],F[J]),g=M,y=J),S===_&&I===A&&$===b&&B===E||(n.blendFuncSeparate(k[S],k[I],k[$],k[B]),_=S,A=I,b=$,E=B),m=v,x=!1;else if(v!==m||V!==x){if(g===100&&y===100||(n.blendEquation(32774),g=100,y=100),V)switch(v){case 1:n.blendFuncSeparate(1,771,1,771);break;case 2:n.blendFunc(1,1);break;case 3:n.blendFuncSeparate(0,769,0,1);break;case 4:n.blendFuncSeparate(0,768,0,770);break;default:console.error("v3d.WebGLState: Invalid blending: ",v)}else switch(v){case 1:n.blendFuncSeparate(770,771,1,771);break;case 2:n.blendFunc(770,1);break;case 3:n.blendFuncSeparate(0,769,0,1);break;case 4:n.blendFunc(0,768);break;default:console.error("v3d.WebGLState: Invalid blending: ",v)}_=null,A=null,b=null,E=null,m=v,x=V}}else p===!0&&(oe(3042),p=!1)}function j(v){w!==v&&(v?n.frontFace(2304):n.frontFace(2305),w=v)}function U(v){v!==0?(ne(2884),v!==L&&(v===1?n.cullFace(1029):v===2?n.cullFace(1028):n.cullFace(1032))):oe(2884),L=v}function z(v,M,S){v?(ne(32823),P===M&&D===S||(n.polygonOffset(M,S),P=M,D=S)):oe(32823)}return{buffers:{color:o,depth:i,stencil:a},enable:ne,disable:oe,bindFramebuffer:function(v,M){return u[v]!==M&&(n.bindFramebuffer(v,M),u[v]=M,r&&(v===36009&&(u[36160]=M),v===36160&&(u[36009]=M)),!0)},drawBuffers:function(v,M){let S=f,I=!1;if(v)if(S=d.get(M),S===void 0&&(S=[],d.set(M,S)),v.isWebGLMultipleRenderTargets){const J=v.texture;if(S.length!==J.length||S[0]!==36064){for(let $=0,B=J.length;$<B;$++)S[$]=36064+$;S.length=J.length,I=!0}}else S[0]!==36064&&(S[0]=36064,I=!0);else S[0]!==1029&&(S[0]=1029,I=!0);I&&(t.isWebGL2?n.drawBuffers(S):e.get("WEBGL_draw_buffers").drawBuffersWEBGL(S))},useProgram:function(v){return h!==v&&(n.useProgram(v),h=v,!0)},setBlending:q,setMaterial:function(v,M){v.side===2?oe(2884):ne(2884);let S=v.side===1;M&&(S=!S),j(S),v.blending===1&&v.transparent===!1?q(0):q(v.blending,v.blendEquation,v.blendSrc,v.blendDst,v.blendEquationAlpha,v.blendSrcAlpha,v.blendDstAlpha,v.premultipliedAlpha),i.setFunc(v.depthFunc),i.setTest(v.depthTest),i.setMask(v.depthWrite),o.setMask(v.colorWrite);const I=v.stencilWrite;a.setTest(I),I&&(a.setMask(v.stencilWriteMask),a.setFunc(v.stencilFunc,v.stencilRef,v.stencilFuncMask),a.setOp(v.stencilFail,v.stencilZFail,v.stencilZPass)),z(v.polygonOffset,v.polygonOffsetFactor,v.polygonOffsetUnits),v.alphaToCoverage===!0?ne(32926):oe(32926)},setFlipSided:j,setCullFace:U,setLineWidth:function(v){v!==C&&(re&&n.lineWidth(v),C=v)},setPolygonOffset:z,setScissorTest:function(v){v?ne(3089):oe(3089)},activeTexture:function(v){v===void 0&&(v=33984+Q-1),ee!==v&&(n.activeTexture(v),ee=v)},bindTexture:function(v,M,S){S===void 0&&(S=ee===null?33984+Q-1:ee);let I=ie[S];I===void 0&&(I={type:void 0,texture:void 0},ie[S]=I),I.type===v&&I.texture===M||(ee!==S&&(n.activeTexture(S),ee=S),n.bindTexture(v,M||ae[v]),I.type=v,I.texture=M)},unbindTexture:function(){const v=ie[ee];v!==void 0&&v.type!==void 0&&(n.bindTexture(v.type,null),v.type=void 0,v.texture=void 0)},compressedTexImage2D:function(){try{n.compressedTexImage2D.apply(n,arguments)}catch(v){console.error("v3d.WebGLState:",v)}},compressedTexImage3D:function(){try{n.compressedTexImage3D.apply(n,arguments)}catch(v){console.error("v3d.WebGLState:",v)}},texImage2D:function(){try{n.texImage2D.apply(n,arguments)}catch(v){console.error("v3d.WebGLState:",v)}},texImage3D:function(){try{n.texImage3D.apply(n,arguments)}catch(v){console.error("v3d.WebGLState:",v)}},updateUBOMapping:function(v,M){let S=l.get(M);S===void 0&&(S=new WeakMap,l.set(M,S));let I=S.get(v);I===void 0&&(I=n.getUniformBlockIndex(M,v.name),S.set(v,I))},uniformBlockBinding:function(v,M){const S=l.get(M).get(v);s.get(v)!==S&&(n.uniformBlockBinding(M,S,v.__bindingPointIndex),s.set(v,S))},texStorage2D:function(){try{n.texStorage2D.apply(n,arguments)}catch(v){console.error("v3d.WebGLState:",v)}},texStorage3D:function(){try{n.texStorage3D.apply(n,arguments)}catch(v){console.error("v3d.WebGLState:",v)}},texSubImage2D:function(){try{n.texSubImage2D.apply(n,arguments)}catch(v){console.error("v3d.WebGLState:",v)}},texSubImage3D:function(){try{n.texSubImage3D.apply(n,arguments)}catch(v){console.error("v3d.WebGLState:",v)}},compressedTexSubImage2D:function(){try{n.compressedTexSubImage2D.apply(n,arguments)}catch(v){console.error("v3d.WebGLState:",v)}},compressedTexSubImage3D:function(){try{n.compressedTexSubImage3D.apply(n,arguments)}catch(v){console.error("v3d.WebGLState:",v)}},scissor:function(v){R.equals(v)===!1&&(n.scissor(v.x,v.y,v.z,v.w),R.copy(v))},viewport:function(v){O.equals(v)===!1&&(n.viewport(v.x,v.y,v.z,v.w),O.copy(v))},reset:function(){n.disable(3042),n.disable(2884),n.disable(2929),n.disable(32823),n.disable(3089),n.disable(2960),n.disable(32926),n.blendEquation(32774),n.blendFunc(1,0),n.blendFuncSeparate(1,0,1,0),n.colorMask(!0,!0,!0,!0),n.clearColor(0,0,0,0),n.depthMask(!0),n.depthFunc(513),n.clearDepth(1),n.stencilMask(4294967295),n.stencilFunc(519,0,4294967295),n.stencilOp(7680,7680,7680),n.clearStencil(0),n.cullFace(1029),n.frontFace(2305),n.polygonOffset(0,0),n.activeTexture(33984),n.bindFramebuffer(36160,null),r===!0&&(n.bindFramebuffer(36009,null),n.bindFramebuffer(36008,null)),n.useProgram(null),n.lineWidth(1),n.scissor(0,0,n.canvas.width,n.canvas.height),n.viewport(0,0,n.canvas.width,n.canvas.height),c={},ee=null,ie={},u={},d=new WeakMap,f=[],h=null,p=!1,m=null,g=null,_=null,A=null,y=null,b=null,E=null,x=!1,w=null,L=null,C=null,P=null,D=null,R.set(0,0,n.canvas.width,n.canvas.height),O.set(0,0,n.canvas.width,n.canvas.height),o.reset(),i.reset(),a.reset()}}}function h1e(n,e,t,r,o,i,a){const s=o.isWebGL2,l=o.maxTextures,c=o.maxCubemapSize,u=o.maxTextureSize,d=o.maxSamples,f=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,h=typeof navigator<"u"&&/OculusBrowser/g.test(navigator.userAgent),p=new WeakMap;let m;const g=new WeakMap;let _=!1;try{_=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function A(F,k){return _?new OffscreenCanvas(F,k):lh("canvas")}function y(F,k,q,j){let U=1;if((F.width>j||F.height>j)&&(U=j/Math.max(F.width,F.height)),U<1||k===!0){if(typeof HTMLImageElement<"u"&&F instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&F instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&F instanceof ImageBitmap){const z=k?Vg:Math.floor,v=z(U*F.width),M=z(U*F.height);m===void 0&&(m=A(v,M));const S=q?A(v,M):m;return S.width=v,S.height=M,S.getContext("2d").drawImage(F,0,0,v,M),console.warn("v3d.WebGLRenderer: Texture has been resized from ("+F.width+"x"+F.height+") to ("+v+"x"+M+")."),S}return"data"in F&&console.warn("v3d.WebGLRenderer: Image in DataTexture is too big ("+F.width+"x"+F.height+")."),F}return F}function b(F){return n2(F.width)&&n2(F.height)}function E(F,k){return F.generateMipmaps&&k&&F.minFilter!==1003&&F.minFilter!==1006}function x(F){n.generateMipmap(F)}function w(F,k,q,j,U=!1){if(s===!1)return k;if(F!==null){if(n[F]!==void 0)return n[F];console.warn("v3d.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+F+"'")}let z=k;return k===6403&&(q===5126&&(z=33326),q===5131&&(z=33325),q===5121&&(z=33321)),k===36244&&(q===5121&&(z=33330),q===5123&&(z=33332),q===5125&&(z=33334),q===5120&&(z=33329),q===5122&&(z=33331),q===5124&&(z=33333)),k===33319&&(q===5126&&(z=33328),q===5131&&(z=33327),q===5121&&(z=33323)),k===33320&&(q===5121&&(z=33336),q===5123&&(z=33338),q===5125&&(z=33340),q===5120&&(z=33335),q===5122&&(z=33337),q===5124&&(z=33339)),k===36248&&(q===5121&&(z=36221),q===5123&&(z=36215),q===5125&&(z=36209),q===5120&&(z=36239),q===5122&&(z=36233),q===5124&&(z=36227)),k===36249&&(q===5121&&(z=36220),q===5123&&(z=36214),q===5125&&(z=36208),q===5120&&(z=36238),q===5122&&(z=36232),q===5124&&(z=36226)),k===6407&&q===35902&&(z=35901),k===6408&&(q===5126&&(z=34836),q===5131&&(z=34842),q===5121&&(z=j===3001&&U===!1?35907:32856),q===32819&&(z=32854),q===32820&&(z=32855)),z!==33325&&z!==33326&&z!==33327&&z!==33328&&z!==34842&&z!==34836||e.get("EXT_color_buffer_float"),z}function L(F,k,q){return E(F,q)===!0||F.isFramebufferTexture&&F.minFilter!==1003&&F.minFilter!==1006?Math.log2(Math.max(k.width,k.height))+1:F.mipmaps!==void 0&&F.mipmaps.length>0?F.mipmaps.length:F.isCompressedTexture&&Array.isArray(F.image)?k.mipmaps.length:1}function C(F){return F===1003||F===1004||F===1005?9728:9729}function P(F){const k=F.target;k.removeEventListener("dispose",P),(function(q){const j=r.get(q);if(j.__webglInit===void 0)return;const U=q.source,z=g.get(U);if(z){const v=z[j.__cacheKey];v.usedTimes--,v.usedTimes===0&&Q(q),Object.keys(z).length===0&&g.delete(U)}r.remove(q)})(k),k.isVideoTexture&&p.delete(k)}function D(F){const k=F.target;k.removeEventListener("dispose",D),(function(q){const j=q.texture,U=r.get(q),z=r.get(j);if(z.__webglTexture!==void 0&&(n.deleteTexture(z.__webglTexture),a.memory.textures--),q.depthTexture&&q.depthTexture.dispose(),q.isWebGLCubeRenderTarget)for(let v=0;v<6;v++)n.deleteFramebuffer(U.__webglFramebuffer[v]),U.__webglDepthbuffer&&n.deleteRenderbuffer(U.__webglDepthbuffer[v]);else{if(n.deleteFramebuffer(U.__webglFramebuffer),U.__webglDepthbuffer&&n.deleteRenderbuffer(U.__webglDepthbuffer),U.__webglMultisampledFramebuffer&&n.deleteFramebuffer(U.__webglMultisampledFramebuffer),U.__webglColorRenderbuffer)for(let v=0;v<U.__webglColorRenderbuffer.length;v++)U.__webglColorRenderbuffer[v]&&n.deleteRenderbuffer(U.__webglColorRenderbuffer[v]);U.__webglDepthRenderbuffer&&n.deleteRenderbuffer(U.__webglDepthRenderbuffer)}if(q.isWebGLMultipleRenderTargets)for(let v=0,M=j.length;v<M;v++){const S=r.get(j[v]);S.__webglTexture&&(n.deleteTexture(S.__webglTexture),a.memory.textures--),r.remove(j[v])}r.remove(j),r.remove(q)})(k),a.removeTextureSpec(k)}function Q(F){const k=r.get(F);n.deleteTexture(k.__webglTexture);const q=F.source;delete g.get(q)[k.__cacheKey],a.memory.textures--,a.removeTextureSpec(F)}let re=0;function G(F,k){const q=r.get(F);if(F.isVideoTexture&&(function(j){const U=a.render.frame;p.get(j)!==U&&(p.set(j,U),j.update())})(F),F.isRenderTargetTexture===!1&&F.version>0&&q.__version!==F.version){const j=F.image;if(j===null)console.warn("v3d.WebGLRenderer: Texture marked for update but no image data found.");else{if(j.complete!==!1)return void T(q,F,k);console.warn("v3d.WebGLRenderer: Texture marked for update but image is incomplete")}}t.bindTexture(3553,q.__webglTexture,33984+k)}const se={[cR]:10497,[uR]:33071,[dR]:33648},ee={[fR]:9728,[hR]:9984,[pR]:9986,[mR]:9729,[gR]:9985,[_R]:9987};function ie(F,k,q){if(q?(n.texParameteri(F,10242,se[k.wrapS]),n.texParameteri(F,10243,se[k.wrapT]),F!==32879&&F!==35866||n.texParameteri(F,32882,se[k.wrapR]),n.texParameteri(F,10240,ee[k.magFilter]),n.texParameteri(F,10241,ee[k.minFilter])):(n.texParameteri(F,10242,33071),n.texParameteri(F,10243,33071),F!==32879&&F!==35866||n.texParameteri(F,32882,33071),k.wrapS===1001&&k.wrapT===1001||console.warn("v3d.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to v3d.ClampToEdgeWrapping."),n.texParameteri(F,10240,C(k.magFilter)),n.texParameteri(F,10241,C(k.minFilter)),k.minFilter!==1003&&k.minFilter!==1006&&console.warn("v3d.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to v3d.NearestFilter or v3d.LinearFilter.")),e.has("EXT_texture_filter_anisotropic")===!0){const j=e.get("EXT_texture_filter_anisotropic");if(k.magFilter===1003||k.minFilter!==1005&&k.minFilter!==1008||k.type===1015&&e.has("OES_texture_float_linear")===!1||s===!1&&k.type===1016&&e.has("OES_texture_half_float_linear")===!1)return;(k.anisotropy>1||r.get(k).__currentAnisotropy)&&(n.texParameterf(F,j.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(k.anisotropy,o.getMaxAnisotropy())),r.get(k).__currentAnisotropy=k.anisotropy)}}function H(F,k){let q=!1;F.__webglInit===void 0&&(F.__webglInit=!0,k.addEventListener("dispose",P));const j=k.source;let U=g.get(j);U===void 0&&(U={},g.set(j,U));const z=(function(v){const M=[];return M.push(v.wrapS),M.push(v.wrapT),M.push(v.wrapR||0),M.push(v.magFilter),M.push(v.minFilter),M.push(v.anisotropy),M.push(v.internalFormat),M.push(v.format),M.push(v.type),M.push(v.generateMipmaps),M.push(v.premultiplyAlpha),M.push(v.flipY),M.push(v.unpackAlignment),M.push(v.encoding),M.join()})(k);if(z!==F.__cacheKey){U[z]===void 0&&(U[z]={texture:n.createTexture(),usedTimes:0},a.memory.textures++,a.addTextureSpec(k),q=!0),U[z].usedTimes++;const v=U[F.__cacheKey];v!==void 0&&(U[F.__cacheKey].usedTimes--,v.usedTimes===0&&Q(k)),F.__cacheKey=z,F.__webglTexture=U[z].texture}return q}function T(F,k,q){let j=3553;(k.isDataArrayTexture||k.isCompressedArrayTexture)&&(j=35866),k.isData3DTexture&&(j=32879);const U=H(F,k),z=k.source;t.bindTexture(j,F.__webglTexture,33984+q);const v=r.get(z);if(z.version!==v.__version||U===!0){t.activeTexture(33984+q),n.pixelStorei(37440,k.flipY),n.pixelStorei(37441,k.premultiplyAlpha),n.pixelStorei(3317,k.unpackAlignment),n.pixelStorei(37443,0);const M=(function(te){return!s&&(te.wrapS!==1001||te.wrapT!==1001||te.minFilter!==1003&&te.minFilter!==1006)})(k)&&b(k.image)===!1;let S=y(k.image,M,!1,u);S=oe(k,S);const I=b(S)||s,J=i.convert(k.format,k.encoding);let $,B=i.convert(k.type),V=w(k.internalFormat,J,B,k.encoding,k.isVideoTexture);ie(j,k,I);const Y=k.mipmaps,le=s&&k.isVideoTexture!==!0,me=v.__version===void 0||U===!0,fe=L(k,S,I);if(k.isDepthTexture)V=6402,s?V=k.type===1015?36012:k.type===1014?33190:k.type===1020?35056:33189:k.type===1015&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),k.format===1026&&V===6402&&k.type!==1012&&k.type!==1014&&(console.warn("v3d.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),k.type=1014,B=i.convert(k.type)),k.format===1027&&V===6402&&(V=34041,k.type!==1020&&(console.warn("v3d.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),k.type=1020,B=i.convert(k.type))),me&&(le?t.texStorage2D(3553,1,V,S.width,S.height):t.texImage2D(3553,0,V,S.width,S.height,0,J,B,null));else if(k.isDataTexture)if(Y.length>0&&I){le&&me&&t.texStorage2D(3553,fe,V,Y[0].width,Y[0].height);for(let te=0,de=Y.length;te<de;te++)$=Y[te],le?t.texSubImage2D(3553,te,0,0,$.width,$.height,J,B,$.data):t.texImage2D(3553,te,V,$.width,$.height,0,J,B,$.data);k.generateMipmaps=!1}else le?(me&&t.texStorage2D(3553,fe,V,S.width,S.height),t.texSubImage2D(3553,0,0,0,S.width,S.height,J,B,S.data)):t.texImage2D(3553,0,V,S.width,S.height,0,J,B,S.data);else if(k.isCompressedTexture)if(k.isCompressedArrayTexture){le&&me&&t.texStorage3D(35866,fe,V,Y[0].width,Y[0].height,S.depth);for(let te=0,de=Y.length;te<de;te++)$=Y[te],k.format!==1023?J!==null?le?t.compressedTexSubImage3D(35866,te,0,0,0,$.width,$.height,S.depth,J,$.data,0,0):t.compressedTexImage3D(35866,te,V,$.width,$.height,S.depth,0,$.data,0,0):console.warn("v3d.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):le?t.texSubImage3D(35866,te,0,0,0,$.width,$.height,S.depth,J,B,$.data):t.texImage3D(35866,te,V,$.width,$.height,S.depth,0,J,B,$.data)}else{le&&me&&t.texStorage2D(3553,fe,V,Y[0].width,Y[0].height);for(let te=0,de=Y.length;te<de;te++)$=Y[te],k.format!==1023?J!==null?le?t.compressedTexSubImage2D(3553,te,0,0,$.width,$.height,J,$.data):t.compressedTexImage2D(3553,te,V,$.width,$.height,0,$.data):console.warn("v3d.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):le?t.texSubImage2D(3553,te,0,0,$.width,$.height,J,B,$.data):t.texImage2D(3553,te,V,$.width,$.height,0,J,B,$.data)}else if(k.isDataArrayTexture)le?(me&&t.texStorage3D(35866,fe,V,S.width,S.height,S.depth),t.texSubImage3D(35866,0,0,0,0,S.width,S.height,S.depth,J,B,S.data)):t.texImage3D(35866,0,V,S.width,S.height,S.depth,0,J,B,S.data);else if(k.isData3DTexture)le?(me&&t.texStorage3D(32879,fe,V,S.width,S.height,S.depth),t.texSubImage3D(32879,0,0,0,0,S.width,S.height,S.depth,J,B,S.data)):t.texImage3D(32879,0,V,S.width,S.height,S.depth,0,J,B,S.data);else if(k.isFramebufferTexture){if(me)if(le)t.texStorage2D(3553,fe,V,S.width,S.height);else{let te=S.width,de=S.height;for(let we=0;we<fe;we++)t.texImage2D(3553,we,V,te,de,0,J,B,null),te>>=1,de>>=1}}else if(Y.length>0&&I){le&&me&&t.texStorage2D(3553,fe,V,Y[0].width,Y[0].height);for(let te=0,de=Y.length;te<de;te++)$=Y[te],le?t.texSubImage2D(3553,te,0,0,J,B,$):t.texImage2D(3553,te,V,J,B,$);k.generateMipmaps=!1}else le?(me&&t.texStorage2D(3553,fe,V,S.width,S.height),t.texSubImage2D(3553,0,0,0,J,B,S)):t.texImage2D(3553,0,V,J,B,S);E(k,I)&&x(j),v.__version=z.version,k.onUpdate&&k.onUpdate(k)}F.__version=k.version}function R(F,k,q,j,U){const z=i.convert(q.format,q.encoding),v=i.convert(q.type),M=w(q.internalFormat,z,v,q.encoding);r.get(k).__hasExternalTextures||(U===32879||U===35866?t.texImage3D(U,0,M,k.width,k.height,k.depth,0,z,v,null):t.texImage2D(U,0,M,k.width,k.height,0,z,v,null)),t.bindFramebuffer(36160,F),ne(k)?f.framebufferTexture2DMultisampleEXT(36160,j,U,r.get(q).__webglTexture,0,ae(k)):(U===3553||U>=34069&&U<=34074)&&n.framebufferTexture2D(36160,j,U,r.get(q).__webglTexture,0),t.bindFramebuffer(36160,null)}function O(F,k,q){if(n.bindRenderbuffer(36161,F),k.depthBuffer&&!k.stencilBuffer){let j=33189;if(s&&(j=33190),q||ne(k)){const U=k.depthTexture;U&&U.isDepthTexture&&(U.type===1015?j=36012:U.type===1014&&(j=33190));const z=ae(k);ne(k)?f.renderbufferStorageMultisampleEXT(36161,z,j,k.width,k.height):n.renderbufferStorageMultisample(36161,z,j,k.width,k.height)}else n.renderbufferStorage(36161,j,k.width,k.height);n.framebufferRenderbuffer(36160,36096,36161,F)}else if(k.depthBuffer&&k.stencilBuffer){const j=ae(k);q&&ne(k)===!1?n.renderbufferStorageMultisample(36161,j,35056,k.width,k.height):ne(k)?f.renderbufferStorageMultisampleEXT(36161,j,35056,k.width,k.height):n.renderbufferStorage(36161,34041,k.width,k.height),n.framebufferRenderbuffer(36160,33306,36161,F)}else{const j=k.isWebGLMultipleRenderTargets===!0?k.texture:[k.texture];for(let U=0;U<j.length;U++){const z=j[U],v=i.convert(z.format,z.encoding),M=i.convert(z.type),S=w(z.internalFormat,v,M,z.encoding),I=ae(k);q&&ne(k)===!1?n.renderbufferStorageMultisample(36161,I,S,k.width,k.height):ne(k)?f.renderbufferStorageMultisampleEXT(36161,I,S,k.width,k.height):n.renderbufferStorage(36161,S,k.width,k.height)}}n.bindRenderbuffer(36161,null)}function W(F){const k=r.get(F),q=F.isWebGLCubeRenderTarget===!0;if(F.depthTexture&&!k.__autoAllocateDepthBuffer){if(q)throw new Error("target.depthTexture not supported in Cube render targets");(function(j,U){if(U&&U.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(36160,j),!U.depthTexture||!U.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of v3d.DepthTexture");r.get(U.depthTexture).__webglTexture&&U.depthTexture.image.width===U.width&&U.depthTexture.image.height===U.height||(U.depthTexture.image.width=U.width,U.depthTexture.image.height=U.height,U.depthTexture.needsUpdate=!0),G(U.depthTexture,0);const z=r.get(U.depthTexture).__webglTexture,v=ae(U);if(U.depthTexture.format===1026)ne(U)?f.framebufferTexture2DMultisampleEXT(36160,36096,3553,z,0,v):n.framebufferTexture2D(36160,36096,3553,z,0);else{if(U.depthTexture.format!==1027)throw new Error("Unknown depthTexture format");ne(U)?f.framebufferTexture2DMultisampleEXT(36160,33306,3553,z,0,v):n.framebufferTexture2D(36160,33306,3553,z,0)}})(k.__webglFramebuffer,F)}else if(q){k.__webglDepthbuffer=[];for(let j=0;j<6;j++)t.bindFramebuffer(36160,k.__webglFramebuffer[j]),k.__webglDepthbuffer[j]=n.createRenderbuffer(),O(k.__webglDepthbuffer[j],F,!1)}else t.bindFramebuffer(36160,k.__webglFramebuffer),k.__webglDepthbuffer=n.createRenderbuffer(),O(k.__webglDepthbuffer,F,!1);t.bindFramebuffer(36160,null)}function ae(F){return Math.min(d,F.samples)}function ne(F){const k=r.get(F);return s&&F.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&k.__useRenderToTexture!==!1}function oe(F,k){const q=F.encoding,j=F.format,U=F.type;return F.isCompressedTexture===!0||F.isVideoTexture===!0||F.format===1035||q!==3e3&&(q===3001?s===!1?e.has("EXT_sRGB")===!0&&j===1023?(F.format=1035,F.minFilter=1006,F.generateMipmaps=!1):k=zR.sRGBToLinear(k):j===1023&&U===1009||console.warn("v3d.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType. Perhaps you've set sRGB color space for an HDR image?"):console.error("v3d.WebGLTextures: Unsupported texture encoding:",q)),k}this.allocateTextureUnit=function(){const F=re;return F>=l&&console.warn("v3d.WebGLTextures: Trying to use "+F+" texture units while this GPU supports only "+l),re+=1,F},this.resetTextureUnits=function(){re=0},this.setTexture2D=G,this.setTexture2DArray=function(F,k){const q=r.get(F);F.version>0&&q.__version!==F.version?T(q,F,k):t.bindTexture(35866,q.__webglTexture,33984+k)},this.setTexture3D=function(F,k){const q=r.get(F);F.version>0&&q.__version!==F.version?T(q,F,k):t.bindTexture(32879,q.__webglTexture,33984+k)},this.setTextureCube=function(F,k){const q=r.get(F);F.version>0&&q.__version!==F.version?(function(j,U,z){if(U.image.length!==6)return;const v=H(j,U),M=U.source;t.bindTexture(34067,j.__webglTexture,33984+z);const S=r.get(M);if(M.version!==S.__version||v===!0){t.activeTexture(33984+z),n.pixelStorei(37440,U.flipY),n.pixelStorei(37441,U.premultiplyAlpha),n.pixelStorei(3317,U.unpackAlignment),n.pixelStorei(37443,0);const I=U.isCompressedTexture||U.image[0].isCompressedTexture,J=U.image[0]&&U.image[0].isDataTexture,$=[];for(let Ie=0;Ie<6;Ie++)$[Ie]=I||J?J?U.image[Ie].image:U.image[Ie]:y(U.image[Ie],!1,!0,c),$[Ie]=oe(U,$[Ie]);const B=$[0],V=b(B)||s,Y=i.convert(U.format,U.encoding),le=i.convert(U.type),me=w(U.internalFormat,Y,le,U.encoding),fe=s&&U.isVideoTexture!==!0,te=S.__version===void 0||v===!0;let de,we=L(U,B,V);if(ie(34067,U,V),I){fe&&te&&t.texStorage2D(34067,we,me,B.width,B.height);for(let Ie=0;Ie<6;Ie++){de=$[Ie].mipmaps;for(let Ne=0;Ne<de.length;Ne++){const He=de[Ne];U.format!==1023?Y!==null?fe?t.compressedTexSubImage2D(34069+Ie,Ne,0,0,He.width,He.height,Y,He.data):t.compressedTexImage2D(34069+Ie,Ne,me,He.width,He.height,0,He.data):console.warn("v3d.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):fe?t.texSubImage2D(34069+Ie,Ne,0,0,He.width,He.height,Y,le,He.data):t.texImage2D(34069+Ie,Ne,me,He.width,He.height,0,Y,le,He.data)}}}else{de=U.mipmaps,fe&&te&&(de.length>0&&we++,t.texStorage2D(34067,we,me,$[0].width,$[0].height));for(let Ie=0;Ie<6;Ie++)if(J){fe?t.texSubImage2D(34069+Ie,0,0,0,$[Ie].width,$[Ie].height,Y,le,$[Ie].data):t.texImage2D(34069+Ie,0,me,$[Ie].width,$[Ie].height,0,Y,le,$[Ie].data);for(let Ne=0;Ne<de.length;Ne++){const He=de[Ne].image[Ie].image;fe?t.texSubImage2D(34069+Ie,Ne+1,0,0,He.width,He.height,Y,le,He.data):t.texImage2D(34069+Ie,Ne+1,me,He.width,He.height,0,Y,le,He.data)}}else{fe?t.texSubImage2D(34069+Ie,0,0,0,Y,le,$[Ie]):t.texImage2D(34069+Ie,0,me,Y,le,$[Ie]);for(let Ne=0;Ne<de.length;Ne++){const He=de[Ne];fe?t.texSubImage2D(34069+Ie,Ne+1,0,0,Y,le,He.image[Ie]):t.texImage2D(34069+Ie,Ne+1,me,Y,le,He.image[Ie])}}}E(U,V)&&x(34067),S.__version=M.version,U.onUpdate&&U.onUpdate(U)}j.__version=U.version})(q,F,k):t.bindTexture(34067,q.__webglTexture,33984+k)},this.rebindTextures=function(F,k,q){const j=r.get(F);k!==void 0&&R(j.__webglFramebuffer,F,F.texture,36064,3553),q!==void 0&&W(F)},this.setupRenderTarget=function(F){const k=F.texture,q=r.get(F),j=r.get(k);F.addEventListener("dispose",D),F.isWebGLMultipleRenderTargets!==!0&&(j.__webglTexture===void 0&&(j.__webglTexture=n.createTexture()),j.__version=k.version,a.memory.textures++),a.addTextureSpec(F);const U=F.isWebGLCubeRenderTarget===!0,z=F.isWebGLMultipleRenderTargets===!0,v=b(F)||s;if(U){q.__webglFramebuffer=[];for(let M=0;M<6;M++)q.__webglFramebuffer[M]=n.createFramebuffer()}else{if(q.__webglFramebuffer=n.createFramebuffer(),z)if(o.drawBuffers){const M=F.texture;for(let S=0,I=M.length;S<I;S++){const J=r.get(M[S]);J.__webglTexture===void 0&&(J.__webglTexture=n.createTexture(),a.memory.textures++)}}else console.warn("v3d.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(s&&F.samples>0&&ne(F)===!1){const M=z?k:[k];q.__webglMultisampledFramebuffer=n.createFramebuffer(),q.__webglColorRenderbuffer=[],t.bindFramebuffer(36160,q.__webglMultisampledFramebuffer);for(let S=0;S<M.length;S++){const I=M[S];q.__webglColorRenderbuffer[S]=n.createRenderbuffer(),n.bindRenderbuffer(36161,q.__webglColorRenderbuffer[S]);const J=i.convert(I.format,I.encoding),$=i.convert(I.type),B=w(I.internalFormat,J,$,I.encoding,F.isXRRenderTarget===!0),V=ae(F);n.renderbufferStorageMultisample(36161,V,B,F.width,F.height),n.framebufferRenderbuffer(36160,36064+S,36161,q.__webglColorRenderbuffer[S])}n.bindRenderbuffer(36161,null),F.depthBuffer&&(q.__webglDepthRenderbuffer=n.createRenderbuffer(),O(q.__webglDepthRenderbuffer,F,!0)),t.bindFramebuffer(36160,null)}}if(U){t.bindTexture(34067,j.__webglTexture),ie(34067,k,v);for(let M=0;M<6;M++)R(q.__webglFramebuffer[M],F,k,36064,34069+M);E(k,v)&&x(34067),t.unbindTexture()}else if(z){const M=F.texture;for(let S=0,I=M.length;S<I;S++){const J=M[S],$=r.get(J);t.bindTexture(3553,$.__webglTexture),ie(3553,J,v),R(q.__webglFramebuffer,F,J,36064+S,3553),E(J,v)&&x(3553)}t.unbindTexture()}else{let M=3553;(F.isWebGL3DRenderTarget||F.isWebGLArrayRenderTarget)&&(s?M=F.isWebGL3DRenderTarget?32879:35866:console.error("v3d.WebGLTextures: v3d.Data3DTexture and v3d.DataArrayTexture only supported with WebGL2.")),t.bindTexture(M,j.__webglTexture),ie(M,k,v),R(q.__webglFramebuffer,F,k,36064,M),E(k,v)&&x(M),t.unbindTexture()}F.depthBuffer&&W(F)},this.updateRenderTargetMipmap=function(F){const k=b(F)||s,q=F.isWebGLMultipleRenderTargets===!0?F.texture:[F.texture];for(let j=0,U=q.length;j<U;j++){const z=q[j];if(E(z,k)){const v=F.isWebGLCubeRenderTarget?34067:3553,M=r.get(z).__webglTexture;t.bindTexture(v,M),x(v),t.unbindTexture()}}},this.updateMultisampleRenderTarget=function(F){if(s&&F.samples>0&&ne(F)===!1){const k=F.isWebGLMultipleRenderTargets?F.texture:[F.texture],q=F.width,j=F.height;let U=16384;const z=[],v=F.stencilBuffer?33306:36096,M=r.get(F),S=F.isWebGLMultipleRenderTargets===!0;if(S)for(let I=0;I<k.length;I++)t.bindFramebuffer(36160,M.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(36160,36064+I,36161,null),t.bindFramebuffer(36160,M.__webglFramebuffer),n.framebufferTexture2D(36009,36064+I,3553,null,0);t.bindFramebuffer(36008,M.__webglMultisampledFramebuffer),t.bindFramebuffer(36009,M.__webglFramebuffer);for(let I=0;I<k.length;I++){z.push(36064+I),F.depthBuffer&&z.push(v);const J=M.__ignoreDepthValues!==void 0&&M.__ignoreDepthValues;if(J===!1&&(F.depthBuffer&&(U|=256),F.stencilBuffer&&(U|=1024)),S&&n.framebufferRenderbuffer(36008,36064,36161,M.__webglColorRenderbuffer[I]),J===!0&&(n.invalidateFramebuffer(36008,[v]),n.invalidateFramebuffer(36009,[v])),S){const $=r.get(k[I]).__webglTexture;n.framebufferTexture2D(36009,36064,3553,$,0)}n.blitFramebuffer(0,0,q,j,0,0,q,j,U,9728),h&&n.invalidateFramebuffer(36008,z)}if(t.bindFramebuffer(36008,null),t.bindFramebuffer(36009,null),S)for(let I=0;I<k.length;I++){t.bindFramebuffer(36160,M.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(36160,36064+I,36161,M.__webglColorRenderbuffer[I]);const J=r.get(k[I]).__webglTexture;t.bindFramebuffer(36160,M.__webglFramebuffer),n.framebufferTexture2D(36009,36064+I,3553,J,0)}t.bindFramebuffer(36009,M.__webglMultisampledFramebuffer)}},this.setupDepthRenderbuffer=W,this.setupFrameBufferTexture=R,this.useMultisampledRTT=ne}function p1e(n,e,t,r){let o={},i={},a=[];const s=t.isWebGL2?n.getParameter(35375):0;function l(d,f,h){const p=d.value;if(h[f]===void 0){if(typeof p=="number")h[f]=p;else{const m=Array.isArray(p)?p:[p],g=[];for(let _=0;_<m.length;_++)g.push(m[_].clone());h[f]=g}return!0}if(typeof p=="number"){if(h[f]!==p)return h[f]=p,!0}else{const m=Array.isArray(h[f])?h[f]:[h[f]],g=Array.isArray(p)?p:[p];for(let _=0;_<m.length;_++){const A=m[_];if(A.equals(g[_])===!1)return A.copy(g[_]),!0}}return!1}function c(d){const f={boundary:0,storage:0};return typeof d=="number"?(f.boundary=4,f.storage=4):d.isVector2?(f.boundary=8,f.storage=8):d.isVector3||d.isColor?(f.boundary=16,f.storage=12):d.isVector4?(f.boundary=16,f.storage=16):d.isMatrix3?(f.boundary=48,f.storage=48):d.isMatrix4?(f.boundary=64,f.storage=64):d.isTexture?console.warn("v3d.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("v3d.WebGLRenderer: Unsupported uniform value type.",d),f}function u(d){const f=d.target;f.removeEventListener("dispose",u);const h=a.indexOf(f.__bindingPointIndex);a.splice(h,1),n.deleteBuffer(o[f.id]),delete o[f.id],delete i[f.id]}return{bind:function(d,f){const h=f.program;r.uniformBlockBinding(d,h)},update:function(d,f){let h=o[d.id];h===void 0&&((function(g){const _=g.uniforms;let A=0;const y=16;let b=0;for(let E=0,x=_.length;E<x;E++){const w=_[E],L={boundary:0,storage:0},C=Array.isArray(w.value)?w.value:[w.value];for(let P=0,D=C.length;P<D;P++){const Q=c(C[P]);L.boundary+=Q.boundary,L.storage+=Q.storage}w.__data=new Float32Array(L.storage/Float32Array.BYTES_PER_ELEMENT),w.__offset=A,E>0&&(b=A%y,b!==0&&y-b-L.boundary<0&&(A+=y-b,w.__offset=A)),A+=L.storage}b=A%y,b>0&&(A+=y-b),g.__size=A,g.__cache={}})(d),h=(function(g){const _=(function(){for(let E=0;E<s;E++)if(a.indexOf(E)===-1)return a.push(E),E;return console.error("v3d.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0})();g.__bindingPointIndex=_;const A=n.createBuffer(),y=g.__size,b=g.usage;return n.bindBuffer(35345,A),n.bufferData(35345,y,b),n.bindBuffer(35345,null),n.bindBufferBase(35345,_,A),A})(d),o[d.id]=h,d.addEventListener("dispose",u));const p=f.program;r.updateUBOMapping(d,p);const m=e.render.frame;i[d.id]!==m&&((function(g){const _=o[g.id],A=g.uniforms,y=g.__cache;n.bindBuffer(35345,_);for(let b=0,E=A.length;b<E;b++){const x=A[b];if(l(x,b,y)===!0){const w=x.__offset,L=Array.isArray(x.value)?x.value:[x.value];let C=0;for(let P=0;P<L.length;P++){const D=L[P],Q=c(D);typeof D=="number"?(x.__data[0]=D,n.bufferSubData(35345,w+C,x.__data)):D.isMatrix3?(x.__data[0]=D.elements[0],x.__data[1]=D.elements[1],x.__data[2]=D.elements[2],x.__data[3]=D.elements[0],x.__data[4]=D.elements[3],x.__data[5]=D.elements[4],x.__data[6]=D.elements[5],x.__data[7]=D.elements[0],x.__data[8]=D.elements[6],x.__data[9]=D.elements[7],x.__data[10]=D.elements[8],x.__data[11]=D.elements[0]):(D.toArray(x.__data,C),C+=Q.storage/Float32Array.BYTES_PER_ELEMENT)}n.bufferSubData(35345,w,x.__data)}}n.bindBuffer(35345,null)})(d),i[d.id]=m)},dispose:function(){for(const d in o)n.deleteBuffer(o[d]);a=[],o={},i={}}}}function DL(n,e,t){const r=t.isWebGL2;return{convert:function(o,i=null){let a;if(o===1009)return 5121;if(o===1017)return 32819;if(o===1018)return 32820;if(o===1010)return 5120;if(o===1011)return 5122;if(o===1012)return 5123;if(o===1013)return 5124;if(o===1014)return 5125;if(o===1015)return 5126;if(o===1016)return r?5131:(a=e.get("OES_texture_half_float"),a!==null?a.HALF_FLOAT_OES:null);if(o===1021)return 6406;if(o===1023)return 6408;if(o===1024)return 6409;if(o===1025)return 6410;if(o===1026)return 6402;if(o===1027)return 34041;if(o===1035)return a=e.get("EXT_sRGB"),a!==null?a.SRGB_ALPHA_EXT:null;if(o===1028)return 6403;if(o===1029)return 36244;if(o===1030)return 33319;if(o===1031)return 33320;if(o===1033)return 36249;if(o===33776||o===33777||o===33778||o===33779)if(i===3001){if(a=e.get("WEBGL_compressed_texture_s3tc_srgb"),a===null)return null;if(o===33776)return a.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(o===33777)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(o===33778)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(o===33779)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(a=e.get("WEBGL_compressed_texture_s3tc"),a===null)return null;if(o===33776)return a.COMPRESSED_RGB_S3TC_DXT1_EXT;if(o===33777)return a.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(o===33778)return a.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(o===33779)return a.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(o===35840||o===35841||o===35842||o===35843){if(a=e.get("WEBGL_compressed_texture_pvrtc"),a===null)return null;if(o===35840)return a.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(o===35841)return a.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(o===35842)return a.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(o===35843)return a.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(o===36196)return a=e.get("WEBGL_compressed_texture_etc1"),a!==null?a.COMPRESSED_RGB_ETC1_WEBGL:null;if(o===37492||o===37496){if(a=e.get("WEBGL_compressed_texture_etc"),a===null)return null;if(o===37492)return i===3001?a.COMPRESSED_SRGB8_ETC2:a.COMPRESSED_RGB8_ETC2;if(o===37496)return i===3001?a.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:a.COMPRESSED_RGBA8_ETC2_EAC}if(o===37808||o===37809||o===37810||o===37811||o===37812||o===37813||o===37814||o===37815||o===37816||o===37817||o===37818||o===37819||o===37820||o===37821){if(a=e.get("WEBGL_compressed_texture_astc"),a===null)return null;if(o===37808)return i===3001?a.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:a.COMPRESSED_RGBA_ASTC_4x4_KHR;if(o===37809)return i===3001?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:a.COMPRESSED_RGBA_ASTC_5x4_KHR;if(o===37810)return i===3001?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:a.COMPRESSED_RGBA_ASTC_5x5_KHR;if(o===37811)return i===3001?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:a.COMPRESSED_RGBA_ASTC_6x5_KHR;if(o===37812)return i===3001?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:a.COMPRESSED_RGBA_ASTC_6x6_KHR;if(o===37813)return i===3001?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:a.COMPRESSED_RGBA_ASTC_8x5_KHR;if(o===37814)return i===3001?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:a.COMPRESSED_RGBA_ASTC_8x6_KHR;if(o===37815)return i===3001?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:a.COMPRESSED_RGBA_ASTC_8x8_KHR;if(o===37816)return i===3001?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:a.COMPRESSED_RGBA_ASTC_10x5_KHR;if(o===37817)return i===3001?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:a.COMPRESSED_RGBA_ASTC_10x6_KHR;if(o===37818)return i===3001?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:a.COMPRESSED_RGBA_ASTC_10x8_KHR;if(o===37819)return i===3001?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:a.COMPRESSED_RGBA_ASTC_10x10_KHR;if(o===37820)return i===3001?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:a.COMPRESSED_RGBA_ASTC_12x10_KHR;if(o===37821)return i===3001?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:a.COMPRESSED_RGBA_ASTC_12x12_KHR}if(o===36492){if(a=e.get("EXT_texture_compression_bptc"),a===null)return null;if(o===36492)return i===3001?a.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:a.COMPRESSED_RGBA_BPTC_UNORM_EXT}return o===1020?r?34042:(a=e.get("WEBGL_depth_texture"),a!==null?a.UNSIGNED_INT_24_8_WEBGL:null):n[o]!==void 0?n[o]:null}}}class BL extends gr{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}}class qi extends kt{constructor(){super(),this.isGroup=!0,this.type="Group"}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}}const m1e={type:"move"};class F2{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new qi,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(e){return this._targetRay===null&&(this._targetRay=new qi,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new N,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new N,this._targetRay.name="XR_CONTROLLER_"+String(e)),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new qi,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new N,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new N),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const r of e.hand.values())this._getHandJoint(t,r)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,r){let o=null,i=null,a=null;const s=this._targetRay,l=this._grip,c=this._hand;if(e&&t.session.visibilityState!=="visible-blurred"){if(c&&e.hand){a=!0;for(const m of e.hand.values()){const g=t.getJointPose(m,r),_=this._getHandJoint(c,m);g!==null&&(_.matrix.fromArray(g.transform.matrix),_.matrix.decompose(_.position,_.rotation,_.scale),_.jointRadius=g.radius),_.visible=g!==null}const u=c.joints["index-finger-tip"],d=c.joints["thumb-tip"],f=u.position.distanceTo(d.position),h=.02,p=.005;c.inputState.pinching&&f>h+p?(c.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!c.inputState.pinching&&f<=h-p&&(c.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else l!==null&&e.gripSpace&&(i=t.getPose(e.gripSpace,r),i!==null&&(l.matrix.fromArray(i.transform.matrix),l.matrix.decompose(l.position,l.rotation,l.scale),i.linearVelocity?(l.hasLinearVelocity=!0,l.linearVelocity.copy(i.linearVelocity)):l.hasLinearVelocity=!1,i.angularVelocity?(l.hasAngularVelocity=!0,l.angularVelocity.copy(i.angularVelocity)):l.hasAngularVelocity=!1));s!==null&&(o=t.getPose(e.targetRaySpace,r),o===null&&i!==null&&(o=i),o!==null&&(s.matrix.fromArray(o.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale),o.linearVelocity?(s.hasLinearVelocity=!0,s.linearVelocity.copy(o.linearVelocity)):s.hasLinearVelocity=!1,o.angularVelocity?(s.hasAngularVelocity=!0,s.angularVelocity.copy(o.angularVelocity)):s.hasAngularVelocity=!1,this.dispatchEvent(m1e)))}return s!==null&&(s.visible=o!==null),l!==null&&(l.visible=i!==null),c!==null&&(c.visible=a!==null),this}_getHandJoint(e,t){if(e.joints[t.jointName]===void 0){const r=new qi;r.matrixAutoUpdate=!1,r.visible=!1,e.joints[t.jointName]=r,e.add(r)}return e.joints[t.jointName]}}class _0{constructor(e,t,r=0,o=1/0){this.ray=new Tu(e,t),this.near=r,this.far=o,this.camera=null,this.layers=new Iu,this.params={Mesh:{omitGeometry:!1},Line:{threshold:.1},LOD:{},Points:{threshold:.1},Sprite:{},checkVisibility:!0},this.layers.enable(3),this.layers.enable(4),this.layers.enable(5),this.layers.enable(6),this.layers.enable(7)}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("v3d.Raycaster: Unsupported camera type: "+t.type)}intersectObject(e,t=!0,r=[]){return V2(e,this,r,t,this.params.checkVisibility),r.sort(NL),r}intersectObjects(e,t=!0,r=[]){for(let o=0,i=e.length;o<i;o++)V2(e[o],this,r,t,this.params.checkVisibility);return r.sort(NL),r}}function NL(n,e){return n.distance-e.distance}function V2(n,e,t,r,o){if(!(o&&(n.visible===!1||n.isMesh&&n.isMaterialGeneratedMesh&&n.parent&&!n.parent.visible)||(n.layers.test(e.layers)&&n.raycast(e,t),r!==!0))){const i=n.children;for(let a=0,s=i.length;a<s;a++)V2(i[a],e,t,!0,o)}}class g1e extends ti{constructor(e,t){super();const r=this;let o=null,i=1,a=null,s="local-floor",l=null,c=null,u=null,d=null,f=null,h=null;const p=t.getContextAttributes();let m=null,g=null;const _=[],A=[],y=new Set,b=new Map,E=new be;let x=null;const w=new gr;w.layers.enable(1),w.viewport=new pt;const L=new gr;L.layers.enable(2),L.viewport=new pt;const C=[w,L],P=new BL;P.layers.enable(1),P.layers.enable(2),P.matrixAutoUpdate=!1;let D=null,Q=null,re=null,G=null,se=null,ee=new Ue;const ie=new N,H=new N,T=new It;function R(j){const U=A.indexOf(j.inputSource);if(U===-1)return;const z=_[U];z!==void 0&&z.dispatchEvent({type:j.type,data:j.inputSource})}function O(){o.removeEventListener("select",R),o.removeEventListener("selectstart",R),o.removeEventListener("selectend",R),o.removeEventListener("squeeze",R),o.removeEventListener("squeezestart",R),o.removeEventListener("squeezeend",R),o.removeEventListener("end",O),o.removeEventListener("inputsourceschange",W);for(let j=0;j<_.length;j++){const U=A[j];U!==null&&(A[j]=null,_[j].disconnect(U))}D=null,Q=null,e.setRenderTarget(m),f=null,d=null,u=null,o=null,g=null,re=null,k.stop(),r.isPresenting=!1,e.setPixelRatio(x),e.setSize(E.width,E.height,!1),r.dispatchEvent({type:"sessionend"})}function W(j){for(let U=0;U<j.removed.length;U++){const z=j.removed[U],v=A.indexOf(z);v>=0&&(A[v]=null,_[v].disconnect(z))}for(let U=0;U<j.added.length;U++){const z=j.added[U];let v=A.indexOf(z);if(v===-1){for(let S=0;S<_.length;S++){if(S>=A.length){A.push(z),v=S;break}if(A[S]===null){A[S]=z,v=S;break}}if(v===-1)break}const M=_[v];M&&M.connect(z)}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(j){let U=_[j];return U===void 0&&(U=new F2,_[j]=U),U.getTargetRaySpace(j)},this.getControllerGrip=function(j){let U=_[j];return U===void 0&&(U=new F2,_[j]=U),U.getGripSpace()},this.getHand=function(j){let U=_[j];return U===void 0&&(U=new F2,_[j]=U),U.getHandSpace()},this.setFramebufferScaleFactor=function(j){i=j,r.isPresenting===!0&&console.warn("v3d.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(j){s=j,r.isPresenting===!0&&console.warn("v3d.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return l||a},this.setReferenceSpace=function(j){l=j},this.getBaseLayer=function(){return d!==null?d:f},this.getBinding=function(){return u},this.getFrame=function(){return h},this.getSession=function(){return o},this.setSession=async function(j){if(o=j,o!==null){if(m=e.getRenderTarget(),o.addEventListener("select",R),o.addEventListener("selectstart",R),o.addEventListener("selectend",R),o.addEventListener("squeeze",R),o.addEventListener("squeezestart",R),o.addEventListener("squeezeend",R),o.addEventListener("end",O),o.addEventListener("inputsourceschange",W),p.xrCompatible!==!0&&await t.makeXRCompatible(),x=e.getPixelRatio(),e.getSize(E),o.renderState.layers===void 0||e.capabilities.isWebGL2===!1){const U={antialias:o.renderState.layers!==void 0||p.antialias,alpha:p.alpha,depth:p.depth,stencil:p.stencil,framebufferScaleFactor:i};f=new XRWebGLLayer(o,t,U),o.updateRenderState({baseLayer:f}),e.setPixelRatio(1),e.setSize(f.framebufferWidth,f.framebufferHeight,!1),g=new nn(f.framebufferWidth,f.framebufferHeight,{format:1023,type:1009,encoding:e.outputEncoding,stencilBuffer:p.stencil})}else{let U=null,z=null,v=null;p.depth&&(v=p.stencil?35056:33190,U=p.stencil?1027:1026,z=p.stencil?1020:1014);const M={colorFormat:32856,depthFormat:v,scaleFactor:i};u=new XRWebGLBinding(o,t),d=u.createProjectionLayer(M),o.updateRenderState({layers:[d]}),e.setPixelRatio(1),e.setSize(d.textureWidth,d.textureHeight,!1),g=new nn(d.textureWidth,d.textureHeight,{format:1023,type:1009,depthTexture:new P2(d.textureWidth,d.textureHeight,z,void 0,void 0,void 0,void 0,void 0,void 0,U),stencilBuffer:p.stencil,encoding:e.outputEncoding,samples:p.antialias?4:0}),e.properties.get(g).__ignoreDepthValues=d.ignoreDepthValues}g.isXRRenderTarget=!0,this.setFoveation(1),l=null,a=await o.requestReferenceSpace(s),k.setContext(o),k.start(),r.isPresenting=!0,r.dispatchEvent({type:"sessionstart"})}};const ae=new N,ne=new N;function oe(j,U){if(U===null)j.matrixWorld.copy(j.matrix),ee.identity(),l=null;else{j.matrixWorld.copy(j.matrix),ee.copy(U.matrixWorld).invert().decompose(ie,T,H);var z=new XRRigidTransform({x:ie.x,y:ie.y,z:ie.z},{x:T.x,y:T.y,z:T.z,w:T.w});l=a.getOffsetReferenceSpace(z)}j.matrixWorldInverse.copy(j.matrixWorld).invert()}this.updateCamera=function(j){if(o===null)return;P.near=L.near=w.near=j.near,P.far=L.far=w.far=j.far,D===P.near&&Q===P.far||(o.updateRenderState({depthNear:P.near,depthFar:P.far}),D=P.near,Q=P.far);const U=j.parent,z=P.cameras;oe(P,U);for(let S=0;S<z.length;S++)oe(z[S],U);P.matrixWorld.decompose(P.position,P.quaternion,P.scale),j.matrixWorld.copy(P.matrixWorld),U===null?j.matrix.copy(j.matrixWorld):(j.matrix.copy(U.matrixWorld).invert(),j.matrix.multiply(j.matrixWorld)),j.matrix.decompose(j.position,j.quaternion,j.scale);const v=j.children;for(let S=0,I=v.length;S<I;S++)v[S].updateWorldMatrix(!1,!0);z.length===2?(function(S,I,J){ae.setFromMatrixPosition(I.matrixWorld),ne.setFromMatrixPosition(J.matrixWorld);const $=ae.distanceTo(ne),B=I.projectionMatrix.elements,V=J.projectionMatrix.elements,Y=B[14]/(B[10]-1),le=B[14]/(B[10]+1),me=(B[9]+1)/B[5],fe=(B[9]-1)/B[5],te=(B[8]-1)/B[0],de=(V[8]+1)/V[0],we=Y*te,Ie=Y*de,Ne=$/(-te+de),He=Ne*-te;I.matrixWorld.decompose(S.position,S.quaternion,S.scale),S.translateX(He),S.translateZ(Ne),S.matrixWorld.compose(S.position,S.quaternion,S.scale),S.matrixWorldInverse.copy(S.matrixWorld).invert();const je=Y+Ne,ct=le+Ne,Vt=we-He,En=Ie+($-He),Rt=me*le/ct*je,pe=fe*le/ct*je;S.projectionMatrix.makePerspective(Vt,En,Rt,pe,je,ct)})(P,w,L):P.projectionMatrix.copy(w.projectionMatrix);const M=P.projectionMatrix.elements;P.fov=Fg(2*Math.atan(1/M[5])),P.aspect=M[5]/M[0],P.projectionMatrixInverse.copy(P.projectionMatrix).invert()},this.getCamera=function(){return P},this.getFoveation=function(){return d!==null?d.fixedFoveation:f!==null?f.fixedFoveation:void 0},this.setFoveation=function(j){d!==null&&(d.fixedFoveation=j),f!==null&&f.fixedFoveation!==void 0&&(f.fixedFoveation=j)},this.getPlanes=function(){return y};let F=null;const k=new nL;function q(j){if(re){const U=j.getHitTestResults(re);if(U.length){const z=U[0].getPose(r.getReferenceSpace()),v=new Ue().fromArray(z.transform.matrix),M=new N;M.setFromMatrixPosition(v);const S=new N(0,1,0);S.applyNormalMatrix(new ao().setFromMatrix4(v)),G(M,S)}else se()}}k.setAnimationLoop((function(j,U){if(c=U.getViewerPose(l||a),h=U,c!==null){const z=c.views;f!==null&&(e.setRenderTargetFramebuffer(g,f.framebuffer),e.setRenderTarget(g));let v=!1;z.length!==P.cameras.length&&(P.cameras.length=0,v=!0);for(let M=0;M<z.length;M++){const S=z[M];let I=null;if(f!==null)I=f.getViewport(S);else{const $=u.getViewSubImage(d,S);I=$.viewport,M===0&&(e.setRenderTargetTextures(g,$.colorTexture,d.ignoreDepthValues?void 0:$.depthStencilTexture),e.setRenderTarget(g))}let J=C[M];J===void 0&&(J=new gr,J.layers.enable(M),J.viewport=new pt,C[M]=J),J.matrix.fromArray(S.transform.matrix),J.projectionMatrix.fromArray(S.projectionMatrix),J.viewport.set(I.x,I.y,I.width,I.height),M===0&&P.matrix.copy(J.matrix),v===!0&&P.cameras.push(J)}}for(let z=0;z<_.length;z++){const v=A[z],M=_[z];v!==null&&M!==void 0&&M.update(v,U,l||a),q(U)}if(F&&F(j,U),U.detectedPlanes){r.dispatchEvent({type:"planesdetected",data:U.detectedPlanes});let z=null;for(const v of y)U.detectedPlanes.has(v)||(z===null&&(z=[]),z.push(v));if(z!==null)for(const v of z)y.delete(v),b.delete(v),r.dispatchEvent({type:"planeremoved",data:v});for(const v of U.detectedPlanes)if(y.has(v)){const M=b.get(v);v.lastChangedTime>M&&(b.set(v,v.lastChangedTime),r.dispatchEvent({type:"planechanged",data:v}))}else y.add(v),b.set(v,U.lastChangedTime),r.dispatchEvent({type:"planeadded",data:v})}h=null})),this.setAnimationLoop=function(j){F=j},this.dispose=function(){},this.arHitTest=function(j,U,z,v){if(!o||!XRSession.prototype.requestHitTestSource)return;G=z||function(){},se=v||function(){},this.raycaster=this.raycaster||new _0,this.raycaster.setFromCamera({x:j,y:U},C[0]);const M=this.raycaster.ray;new XRRay(M.origin,M.direction),o.requestReferenceSpace("viewer").then((function(S){const I={space:S};o.requestHitTestSource(I).then((function(J){re=J}))}))}}}function _1e(){const n=lh("canvas");return n.style.display="block",n}function U2(n={}){this.isWebGLRenderer=!0;const e=n.canvas!==void 0?n.canvas:_1e(),t=n.context!==void 0?n.context:null,r=n.depth===void 0||n.depth,o=n.stencil===void 0||n.stencil,i=n.antialias!==void 0&&n.antialias,a=n.premultipliedAlpha===void 0||n.premultipliedAlpha,s=n.preserveDrawingBuffer!==void 0&&n.preserveDrawingBuffer,l=n.powerPreference!==void 0?n.powerPreference:"default",c=n.failIfMajorPerformanceCaveat!==void 0&&n.failIfMajorPerformanceCaveat;let u;u=t!==null?t.getContextAttributes().alpha:n.alpha!==void 0&&n.alpha;const d=new Uint32Array(4),f=new Int32Array(4);let h=null,p=null;const m=[],g=[];this.domElement=e,this.debug={checkShaderErrors:!0,disableCompiledShaderCache:!1},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=3e3,this.unitsScaleFactor=1,this.toneMapping=0,this.toneMappingLook=0,this.toneMappingExposure=1,this.gtaoMap=null,this.gtaoMapEnabled=!1,this.compatSettings={gtaoDisableBkgFix:!1};const _=this;let A=!1,y=0,b=0,E=null,x=-1,w=null;const L=new pt,C=new pt;let P=null,D=e.width,Q=e.height,re=1,G=null,se=null;const ee=new pt(0,0,D,Q),ie=new pt(0,0,D,Q);let H=!1;const T=new ph;let R=!1,O=!1,W=null;const ae=new Ue,ne=new be,oe=new N,F=new jr,k=new Ue,q=new Ue,j=new pt,U=new Ue;new Tn;let z=!1;function v(){return E===null?re:1}this.oitRenderer=new Gge(new be(D,Q));let M,S,I,J,$,B,V,Y,le,me,fe,te,de,we,Ie,Ne,He,je,ct,Vt,En,Rt,pe,Te,Ce=t;function Zt(ce,Se){for(let Me=0;Me<ce.length;Me++){const Fe=ce[Me],Re=e.getContext(Fe,Se);if(Re!==null)return Re}return null}try{const ce={alpha:!0,depth:r,stencil:o,antialias:i,premultipliedAlpha:a,preserveDrawingBuffer:s,powerPreference:l,xrCompatible:!nr.checkSafari(),failIfMajorPerformanceCaveat:c};if("setAttribute"in e&&e.setAttribute("data-engine","Verge3D 4.10.0"),e.addEventListener("webglcontextlost",Di,!1),e.addEventListener("webglcontextrestored",xo,!1),e.addEventListener("webglcontextcreationerror",Eo,!1),Ce===null){const Se=["webgl2","webgl"];if(Ce=Zt(Se,ce),Ce===null)throw Zt(Se)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.");const Me=typeof WebGL2RenderingContext<"u"&&Ce instanceof WebGL2RenderingContext;console.log("Verge3D 4.10.0 "+qse()+" ("+(Eu(kg)==3483952072?"Trial":"License")+", "+(Me?"WebGL 2.0":"WebGL 1.0")+")")}}catch(ce){throw console.error("v3d.WebGLRenderer: "+ce.message),ce}function rt(){M=new Rge(Ce),S=new Ege(Ce,M,n),M.init(S),Rt=new DL(Ce,M,S),I=new f1e(Ce,M,S),J=new Dge,$=new e1e,B=new h1e(Ce,M,I,$,S,Rt,J),V=new Sge(_),Y=new Ige(_),le=new Ele(Ce,S),pe=new bge(Ce,M,le,S),me=new Lge(Ce,le,J,pe),fe=new Hge(Ce,me,le,J),ct=new kge(Ce,S,B),Ne=new Cge($),te=new J0e(_,V,Y,M,S,pe,Ne),de=new Bge(_,$),we=new n1e,Ie=new l1e(M,S),je=new yge(_,V,Y,I,fe,u,a),He=new d1e(_,fe,S),Te=new p1e(Ce,J,S,I),Vt=new xge(Ce,M,J,S),En=new Pge(Ce,M,J,S),J.programs=te.programs,_.capabilities=S,_.extensions=M,_.properties=$,_.renderLists=we,_.shadowMap=He,_.state=I,_.info=J}rt();const rn=new g1e(_,Ce);function Di(ce){ce.preventDefault(),console.log("v3d.WebGLRenderer: Context Lost."),A=!0}function xo(){console.log("v3d.WebGLRenderer: Context Restored."),A=!1;const ce=He.enabled,Se=He.autoUpdate,Me=He.needsUpdate,Fe=He.type;rt(),He.enabled=ce,He.autoUpdate=Se,He.needsUpdate=Me,He.type=Fe}function Eo(ce){console.error("v3d.WebGLRenderer: A WebGL context could not be created. Reason:",ce.statusMessage)}function jn(ce){const Se=ce.target;Se.removeEventListener("dispose",jn),(function(Me){(function(Fe){const Re=$.get(Fe).programs;Re!==void 0&&(Re.forEach((function(ke){te.releaseProgram(ke)})),Fe.isShaderMaterial&&te.releaseShaderCache(Fe))})(Me),$.remove(Me)})(Se)}this.xr=rn,this.getContext=function(){return Ce},this.getContextAttributes=function(){return Ce.getContextAttributes()},this.forceContextLoss=function(){const ce=M.get("WEBGL_lose_context");ce&&ce.loseContext()},this.forceContextRestore=function(){const ce=M.get("WEBGL_lose_context");ce&&ce.restoreContext()},this.getTextureUtils=function(){return B},this.getPixelRatio=function(){return re},this.setPixelRatio=function(ce){ce!==void 0&&(re=ce,this.setSize(D,Q,!1))},this.getSize=function(ce){return ce.set(D,Q)},this.setSize=function(ce,Se,Me){rn.isPresenting?console.warn("v3d.WebGLRenderer: Can't change size while VR device is presenting."):(D=ce,Q=Se,e.width=Math.floor(ce*re),e.height=Math.floor(Se*re),Me!==!1&&(e.style.width=ce+"px",e.style.height=Se+"px"),this.setViewport(0,0,ce,Se),this.oitRenderer&&(this.getDrawingBufferSize(ne),this.oitRenderer.setSize(ne.x,ne.y)))},this.getDrawingBufferSize=function(ce){return ce.set(D*re,Q*re).floor()},this.setDrawingBufferSize=function(ce,Se,Me){D=ce,Q=Se,re=Me,e.width=Math.floor(ce*Me),e.height=Math.floor(Se*Me),this.setViewport(0,0,ce,Se)},this.getCurrentViewport=function(ce){return ce.copy(L)},this.getViewport=function(ce){return ce.copy(ee)},this.setViewport=function(ce,Se,Me,Fe){ce.isVector4?ee.set(ce.x,ce.y,ce.z,ce.w):ee.set(ce,Se,Me,Fe),I.viewport(L.copy(ee).multiplyScalar(re).floor())},this.getScissor=function(ce){return ce.copy(ie)},this.setScissor=function(ce,Se,Me,Fe){ce.isVector4?ie.set(ce.x,ce.y,ce.z,ce.w):ie.set(ce,Se,Me,Fe),I.scissor(C.copy(ie).multiplyScalar(re).floor())},this.getScissorTest=function(){return H},this.setScissorTest=function(ce){I.setScissorTest(H=ce)},this.setOpaqueSort=function(ce){G=ce},this.setTransparentSort=function(ce){se=ce},this.getClearColor=function(ce){return ce.copy(je.getClearColor())},this.setClearColor=function(){je.setClearColor.apply(je,arguments)},this.getClearAlpha=function(){return je.getClearAlpha()},this.setClearAlpha=function(){je.setClearAlpha.apply(je,arguments)},this.clear=function(ce=!0,Se=!0,Me=!0){let Fe=0;if(ce){let Re=!1;if(E!==null){const ke=E.texture.format;Re=ke===1033||ke===1031||ke===1029}if(Re){const ke=E.texture.type,ut=ke===1009||ke===1014||ke===1012||ke===1020||ke===1017||ke===1018,dt=je.getClearColor(),ft=je.getClearAlpha(),yt=dt.r,Ze=dt.g,Rn=dt.b;ut?(d[0]=yt,d[1]=Ze,d[2]=Rn,d[3]=ft,Ce.clearBufferuiv(6144,0,d)):(f[0]=yt,f[1]=Ze,f[2]=Rn,f[3]=ft,Ce.clearBufferiv(6144,0,f))}else Fe|=16384}Se&&(Fe|=256),Me&&(Fe|=1024),Ce.clear(Fe)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",Di,!1),e.removeEventListener("webglcontextrestored",xo,!1),e.removeEventListener("webglcontextcreationerror",Eo,!1),this.disposeGTAO(),this.disposeOIT(),this.disposeInternalCaches(),rn.dispose(),rn.removeEventListener("sessionstart",Sc),rn.removeEventListener("sessionend",wc),W&&(W.dispose(),W=null),Vr.stop()},this.canUseGTAO=function(){return this.gtaoMap&&this.gtaoMapEnabled},this.disposeGTAO=function(){var ce;(ce=this.gtaoMap)==null||ce.dispose(),this.gtaoMap=null},this.disposeOIT=function(){this.oitRenderer&&this.oitRenderer.dispose(),this.useOIT=!1},this.disposeInternalCaches=function(){we.dispose(),Ie.dispose(),$.dispose(),V.dispose(),Y.dispose(),fe.dispose(),pe.dispose(),te.dispose(),Te.dispose(),je.dispose(),le.dispose()},this.renderBufferDirect=function(ce,Se,Me,Fe,Re,ke){Se===null&&(Se=F);const ut=Re.isMesh&&Re.matrixWorld.determinant()<0,dt=(function(ln,hi,Cn,et,on){var Z;hi.isScene!==!0&&(hi=F),B.resetTextureUnits();const ur=hi.fog,Ba=et.isMeshNodeMaterial||et.isMeshStandardMaterial?hi.environment:null,lx=E===null?_.outputEncoding:E.isXRRenderTarget===!0?E.texture.encoding:3e3;if(et.envMapAutoAssign&&(et.isMeshNodeMaterial||et.isMeshStandardMaterial)){const X=p.state.envMapProbeArray.find((ue=>ue.influenceGroup===null?ue.intersectsMesh(on):on.groupNames.includes(ue.influenceGroup)^ue.influenceGroupInv))||hi.worldEnvMapProbe;if(X){et.envMap=((Z=X.renderTarget)==null?void 0:Z.texture)||null;const ue=X.parallaxDistance;et.envMapParallaxMatrix.copy(X.matrixWorldInverse).premultiply(U.makeScale(1/ue,1/ue,1/ue)),et.envMapParallaxMatrixInv.copy(X.matrixWorld).multiply(U.makeScale(ue,ue,ue)),et.envMapParallaxType=X.parallaxType}}const Rs=(et.isMeshNodeMaterial||et.isMeshStandardMaterial?Y:V).get(et.envMap||Ba),Co=et.vertexColors===!0&&!!Cn.attributes.color&&Cn.attributes.color.itemSize===4,up=!!et.normalMap&&!!Cn.attributes.tangent,El=!!Cn.morphAttributes.position,dp=!!Cn.morphAttributes.normal,t_=!!Cn.morphAttributes.color,cx=et.toneMapped?_.toneMapping:0,Cd=Cn.morphAttributes.position||Cn.morphAttributes.normal||Cn.morphAttributes.color,ux=Cd!==void 0?Cd.length:0,n_=et.side===1,Jt=$.get(et),Sd=p.state.lights;if(R===!0&&(O===!0||ln!==w)){const X=ln===w&&et.id===x;Ne.setState(et,ln,X)}const fp=Bt(on,et,p),r_=_.canUseGTAO()&&et.isMeshNodeMaterial&&et.canUseGTAO();let pi=!1,wd=!1;et.version===Jt.__version?Jt.needsLights&&Jt.lightsStateVersion!==Sd.state.version||Jt.outputEncoding!==lx||on.isInstancedMesh&&Jt.instancing===!1?pi=!0:on.isInstancedMesh||Jt.instancing!==!0?on.isSkinnedMesh&&Jt.skinning===!1?pi=!0:on.isSkinnedMesh||Jt.skinning!==!0?Jt.envMap!==Rs?(pi=!0,wd=!0):et.fog===!0&&Jt.fog!==ur?pi=!0:Jt.numClippingPlanes===void 0||Jt.numClippingPlanes===Ne.numPlanes&&Jt.numIntersection===Ne.numIntersection?(Jt.vertexAlphas!==Co||Jt.vertexTangents!==up||Jt.morphTargets!==El||Jt.morphNormals!==dp||Jt.morphColors!==t_||Jt.toneMapping!==cx||S.isWebGL2===!0&&Jt.morphTargetsCount!==ux||Jt.planeReflProbe!==fp||et.isMeshNormalMaterial&&Jt.flipSided!==n_||Jt.useGTAO!==r_)&&(pi=!0):pi=!0:pi=!0:pi=!0:pi=!0;let Tr=Jt.currentProgram;pi===!0&&(Tr=Ts(et,hi,on,p));let jo=!1,Ln=!1,So=!1;const St=Tr.getUniforms(),Bi=Jt.uniforms;if(I.useProgram(Tr.program)&&(jo=!0,Ln=!0,So=!0),et.id!==x&&(x=et.id,Ln=!0),wd&&(Ln=!0),jo||w!==ln){if(St.setValue(Ce,"projectionMatrix",ln.projectionMatrix),S.logarithmicDepthBuffer&&St.setValue(Ce,"logDepthBufFC",2/(Math.log(ln.far+1)/Math.LN2)),w!==ln&&(w=ln,Ln=!0,So=!0),et.isMeshNodeMaterial||et.isShaderMaterial||et.isMeshStandardMaterial||et.envMap){const X=St.map.cameraPosition;X!==void 0&&X.setValue(Ce,oe.setFromMatrixPosition(ln.matrixWorld))}(et.isMeshNodeMaterial||et.isMeshLambertMaterial||et.isMeshBasicMaterial||et.isMeshStandardMaterial||et.isShaderMaterial)&&St.setValue(Ce,"isOrthographic",ln.isOrthographicCamera===!0),(et.isMeshNodeMaterial||et.isMeshLambertMaterial||et.isMeshBasicMaterial||et.isMeshStandardMaterial||et.isShaderMaterial||et.isShadowMaterial||on.isSkinnedMesh)&&St.setValue(Ce,"viewMatrix",ln.matrixWorldInverse),(et.isMeshNodeMaterial||et.isMeshLambertMaterial||et.isMeshStandardMaterial||et.isShadowMaterial)&&St.setValue(Ce,"invViewMatrix",ln.matrixWorld)}if(on.isSkinnedMesh){St.setOptional(Ce,on,"bindMatrix"),St.setOptional(Ce,on,"bindMatrixInverse");const X=on.skeleton;X&&(S.floatVertexTextures?(X.boneTexture===null&&X.computeBoneTexture(),St.setValue(Ce,"boneTexture",X.boneTexture,B),St.setValue(Ce,"boneTextureSize",X.boneTextureSize)):console.warn("v3d.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}const Md=Cn.morphAttributes;if((Md.position!==void 0||Md.normal!==void 0||Md.color!==void 0&&S.isWebGL2===!0)&&ct.update(on,Cn,et,Tr),(Ln||Jt.receiveShadow!==on.receiveShadow)&&(Jt.receiveShadow=on.receiveShadow,St.setValue(Ce,"receiveShadow",on.receiveShadow)),Ln){if(St.setValue(Ce,"toneMappingExposure",_.toneMappingExposure),_.toneMapping==6?(St.setValue(Ce,"toneMappingBrightness",_.toneMappingBrightness),St.setValue(Ce,"toneMappingContrast",_.toneMappingContrast),St.setValue(Ce,"toneMappingMidTones",_.toneMappingMidTones),St.setValue(Ce,"toneMappingPhysicalScale",_.toneMappingPhysicalScale),St.setValue(Ce,"toneMappingChromaticAdaptation",_.toneMappingChromaticAdaptation),St.setValue(Ce,"toneMappingWhiteColor",_.toneMappingWhiteColor),St.setValue(Ce,"toneMappingColorDifferentiation",_.toneMappingColorDifferentiation),St.setValue(Ce,"toneMappingExteriorDaylight",_.toneMappingExteriorDaylight)):_.toneMapping==7&&(St.setValue(Ce,"toneMappingResolution",ne.set(D,Q)),St.setValue(Ce,"toneMappingWhiteBalance",_.toneMappingWhiteBalance),St.setValue(Ce,"toneMappingHighlights",_.toneMappingHighlights),St.setValue(Ce,"toneMappingMidTones",_.toneMappingMidTones),St.setValue(Ce,"toneMappingShadows",_.toneMappingShadows),St.setValue(Ce,"toneMappingSaturation",_.toneMappingSaturation),St.setValue(Ce,"toneMappingPhysicalScale",_.toneMappingPhysicalScale),St.setValue(Ce,"toneMappingAperture",_.toneMappingAperture),St.setValue(Ce,"toneMappingShutter",_.toneMappingShutter),St.setValue(Ce,"toneMappingISO",_.toneMappingISO),St.setValue(Ce,"toneMappingVignetting",_.toneMappingVignetting)),Jt.needsLights&&(co=So,(wo=Bi).ambientLightColor.needsUpdate=co,wo.lightProbe.needsUpdate=co,wo.directionalLights.needsUpdate=co,wo.directionalLightShadowsCSM.needsUpdate=co,wo.directionalLightShadowsCSMCascade.needsUpdate=co,wo.pointLights.needsUpdate=co,wo.pointLightShadows.needsUpdate=co,wo.spotLights.needsUpdate=co,wo.spotLightShadows.needsUpdate=co,wo.rectAreaLights.needsUpdate=co,wo.rectAreaLightShadows.needsUpdate=co,wo.hemisphereLights.needsUpdate=co),ur&&et.fog===!0&&de.refreshFogUniforms(Bi,ur),Jt.useGTAO){const X=(E==null?void 0:E.width)??D,ue=(E==null?void 0:E.height)??Q;St.setValue(Ce,"currResolution",ne.set(X,ue)),de.refreshGTAOUniforms(Bi,_.gtaoMap)}if(de.refreshMaterialUniforms(Bi,et,re,Q,W),fp&&de.refreshPlaneReflProbeUniforms(Bi,fp),et.isMeshNodeMaterial)for(const X in et.nodeTextures)St.setValue(Ce,X,et.nodeTextures[X],B);et.isMeshLineMaterial&&St.setValue(Ce,"resolution",ne.set(D,Q)),m0.upload(Ce,fi(Jt),Bi,B)}var wo,co;if(et.isShaderMaterial&&et.uniformsNeedUpdate===!0&&(m0.upload(Ce,fi(Jt),Bi,B),et.uniformsNeedUpdate=!1),et.isSpriteMaterial&&St.setValue(Ce,"center",on.center),et.isMeshNodeMaterial){et.needsBoundingBox&&(Cn.boundingBox===null&&Cn.computeBoundingBox(),St.setValue(Ce,"boundingBoxMin",Cn.boundingBox.min),St.setValue(Ce,"boundingBoxMax",Cn.boundingBox.max)),St.setValue(Ce,"viewWidthHeight",ne.set(L.z-L.x,L.w-L.y));const X=St.map.invModelMatrix;(X||et.nodeTexCoordObject.includes(null))&&(k.copy(on.matrixWorld).invert(),X&&X.setValue(Ce,k)),et.nodeTexCoordObject.forEach((function(ge,Oe){(ge===null?k:q.copy(ge.matrixWorld).invert()).toArray(Jt.nodeTexCoordObjectMatrices,16*Oe)})),St.setValue(Ce,"nodeTexCoordObjectMatrices",Jt.nodeTexCoordObjectMatrices),St.setValue(Ce,"objectIndex",on.objectIndex);const ue=on.objectColor;St.setValue(Ce,"objectColor",j.set(ue.r,ue.g,ue.b,on.objectAlpha)),St.setValue(Ce,"objectRandom",Eu(on.uuid)/Math.pow(2,32))}if(St.setValue(Ce,"modelViewMatrix",on.modelViewMatrix),St.setValue(Ce,"normalMatrix",on.normalMatrix),St.setValue(Ce,"modelMatrix",on.matrixWorld),et.isShaderMaterial||et.isRawShaderMaterial){const X=et.uniformsGroups;for(let ue=0,ge=X.length;ue<ge;ue++)if(S.isWebGL2){const Oe=X[ue];Te.update(Oe,Tr),Te.bind(Oe,Tr)}else console.warn("v3d.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return Tr})(ce,Se,Me,Fe,Re);I.setMaterial(Fe,ut);let ft=Me.index,yt=1;Fe.wireframe===!0&&(ft=me.getWireframeAttribute(Me),yt=2);const Ze=Me.drawRange,Rn=Me.attributes.position;let $t=Ze.start*yt,at=(Ze.start+Ze.count)*yt;ke!==null&&($t=Math.max($t,ke.start*yt),at=Math.min(at,(ke.start+ke.count)*yt)),ft!==null?($t=Math.max($t,0),at=Math.min(at,ft.count)):Rn!=null&&($t=Math.max($t,0),at=Math.min(at,Rn.count));const zt=at-$t;if(zt<0||zt===1/0)return;let Is;pe.setup(Re,Fe,dt,Me,ft);let sn=Vt;if(ft!==null&&(Is=le.get(ft),sn=En,sn.setIndex(Is)),Re.isMesh)Fe.wireframe===!0?(I.setLineWidth(Fe.wireframeLinewidth*v()),sn.setMode(1)):sn.setMode(4);else if(Re.isLine){let ln=Fe.linewidth;ln===void 0&&(ln=1),I.setLineWidth(ln*v()),Re.isLineSegments?sn.setMode(1):Re.isLineLoop?sn.setMode(2):sn.setMode(3)}else Re.isPoints?sn.setMode(0):Re.isSprite&&sn.setMode(4);if(dt.beginTimerQuery(Ce,S.isWebGL2),Fe.depthPrepass&&Fe.transparent){const ln=I.buffers.depth.getTest(),hi=I.buffers.color.getMask();if(I.buffers.depth.setTest(!0),I.buffers.color.setMask(0),Re.isInstancedMesh)sn.renderInstances($t,zt,Re.count);else if(Me.isInstancedBufferGeometry){const Cn=Me._maxInstanceCount!==void 0?Me._maxInstanceCount:1/0,et=Math.min(Me.instanceCount,Cn);sn.renderInstances($t,zt,et)}else sn.render($t,zt);I.buffers.depth.setTest(ln),I.buffers.color.setMask(hi)}if(Re.isInstancedMesh)sn.renderInstances($t,zt,Re.count);else if(Me.isInstancedBufferGeometry){const ln=Me._maxInstanceCount!==void 0?Me._maxInstanceCount:1/0,hi=Math.min(Me.instanceCount,ln);sn.renderInstances($t,zt,hi)}else sn.render($t,zt);dt.endTimerQuery(Ce,S.isWebGL2)},this._compilePrepareRenderState=function(ce,Se,Me){Me.init(),ce.traverse((Re=>{Re.isLight?(Me.pushLight(Re),Re.castShadow&&Me.pushShadow(Re)):Re.isCubeReflectionProbe?Me.pushEnvMapProbe(Re):Re.isPlaneReflectionProbe&&Me.pushPlaneReflProbe(Re)})),Me.setupLights(),Me.sortEnvMapProbes();let Fe=null;return ce.worldEnvMapProbe&&ce.worldEnvMapProbe.renderTarget!==null&&(Fe=ce.worldEnvMapProbe.renderTarget.texture),ce.traverse((Re=>{Re.material&&(Array.isArray(Re.material)?Re.material:[Re.material]).forEach((ke=>{(ke.isMeshNodeMaterial||ke.isMeshStandardMaterial)&&(Re.material.envMap=Fe,Re.material.needsUpdate=!0)}))})),Me},this.compile=function(ce,Se){this.gtaoMapEnabled=!0;const Me=Ie.get(ce,g.length);this._compilePrepareRenderState(ce,Se,Me);const Fe={};ce.traverse((function(Re){const ke=Re.material;if(ke)if(Array.isArray(ke))for(let ut=0;ut<ke.length;ut++){const dt=ke[ut];!(dt.uuid in Fe)&&(Ts(dt,ce,Re,Me),Fe[dt.uuid]=!0)}else!(ke.uuid in Fe)&&(Ts(ke,ce,Re,Me),Fe[ke.uuid]=!0)})),this.gtaoMapEnabled=!1},this.compileAsync=function(ce,Se,Me){const Fe=new N2(M,S);this._compilePrepareRenderState(ce,Se,Fe);const Re=[];if(ce.traverse((function(ke){ke.material&&(Array.isArray(ke.material)?ke.material:[ke.material]).forEach((function(ut){Re.push({scene:ce,obj:ke,mat:ut})}))})),Re.length===0)Me(1);else{const ke=M.get("KHR_parallel_shader_compile"),ut=(ke===null?1:2)*Re.length;let dt=0,ft=0;const yt={};if(Kse(Re,(function(Ze,Rn,$t){_.gtaoMapEnabled=!0;var at=Ts(Ze.mat,Ze.scene,Ze.obj,Fe);if(_.gtaoMapEnabled=!1,ke){const zt=at.id;zt in yt||(yt[zt]={program:at,weight:0}),yt[zt].weight++}Me&&(dt++,Me((dt+ft)/ut))}),16),ke){const Ze=setInterval((function(){let Rn=0;for(let $t in yt){const at=yt[$t];(at.program.program===void 0||Ce.getProgramParameter(at.program.program,ke.COMPLETION_STATUS_KHR))&&(Rn+=at.weight)}ft=Math.max(ft,Rn),Me&&Me((dt+ft)/ut),ft===Re.length&&clearInterval(Ze)}),16)}}};let xl=null;function Sc(){Vr.stop()}function wc(){Vr.start()}const Vr=new nL;function Ms(ce,Se,Me,Fe){ce.isAnnotationControl&&ce.update(Se);let Re=!1;if(ce.visible&&(Re=ce.layers.test(Se.layers),Re)){if(ce.isGroup)Me=ce.renderOrder;else if(ce.isLOD)ce.autoUpdate===!0&&ce.update(Se);else if(ce.isLight)p.pushLight(ce),ce.castShadow&&p.pushShadow(ce);else if(ce.isCubeReflectionProbe)p.pushEnvMapProbe(ce);else if(ce.isPlaneReflectionProbe)p.pushPlaneReflProbe(ce);else if(ce.isSprite){if(!ce.frustumCulled||T.intersectsSprite(ce)){Fe&&oe.setFromMatrixPosition(ce.matrixWorld).applyMatrix4(ae);const ut=fe.update(ce),dt=ce.material;h.push(ce,ut,dt,Me,oe.z,null)}}else if((ce.isMesh||ce.isLine||ce.isPoints)&&(ce.isSkinnedMesh&&ce.skeleton.frame!==J.render.frame&&(ce.skeleton.update(),ce.skeleton.frame=J.render.frame),!ce.frustumCulled||T.intersectsObject(ce))){Fe&&oe.setFromMatrixPosition(ce.matrixWorld).applyMatrix4(ae);const ut=fe.update(ce),dt=ce.material;if(Array.isArray(dt)){const ft=ut.groups;for(let yt=0,Ze=ft.length;yt<Ze;yt++){const Rn=ft[yt],$t=dt[Rn.materialIndex];$t&&$t.visible&&h.push(ce,ut,$t,Me,oe.z,Rn)}}else dt.visible&&h.push(ce,ut,dt,Me,oe.z,null)}}if(ce.disableChildRendering)return;const ke=ce.children;for(let ut=0,dt=ke.length;ut<dt;ut++){const ft=ke[ut];!Re&&ft.isMesh&&ft.isMaterialGeneratedMesh||Ms(ft,Se,Me,Fe)}}function Mc(ce,Se,Me,Fe){const Re=ce.opaque,ke=ce.transmissive,ut=ce.transparent;p.setupLightsView(Me),ke.length>0&&(function(dt,ft,yt){const Ze=S.isWebGL2;W===null&&(W=new nn(1,1,{generateMipmaps:!0,type:M.has("EXT_color_buffer_half_float")?1016:1009,minFilter:1008,samples:Ze&&i===!0?4:0})),_.getDrawingBufferSize(ne),Ze?W.setSize(ne.x,ne.y):W.setSize(Vg(ne.x),Vg(ne.y));const Rn=_.getRenderTarget();_.setRenderTarget(W),_.clear();const $t=_.toneMapping;_.toneMapping=0,oa(dt,ft,yt),_.toneMapping=$t,B.updateMultisampleRenderTarget(W),B.updateRenderTargetMipmap(W),_.setRenderTarget(Rn)})(Re,Se,Me),Fe&&I.viewport(L.copy(Fe)),Re.length>0&&oa(Re,Se,Me),ke.length>0&&oa(ke,Se,Me),ut.length>0&&(z&&_.oitRenderer.method!==0?_.oitRenderer.render(_,oa,ut,Se,Me):oa(ut,Se,Me)),I.buffers.depth.setTest(!0),I.buffers.depth.setMask(!0),I.buffers.color.setMask(!0),I.setPolygonOffset(!1)}function oa(ce,Se,Me){const Fe=Se.isScene===!0?Se.overrideMaterial:null;for(let Re=0,ke=ce.length;Re<ke;Re++){const ut=ce[Re],dt=ut.object,ft=ut.geometry,yt=Fe===null?ut.material:Fe,Ze=ut.group;dt.layers.test(Me.layers)&&Ed(dt,Se,Me,ft,yt,Ze)}}function Ed(ce,Se,Me,Fe,Re,ke){ce.onBeforeRender(_,Se,Me,Fe,Re,ke),ce.modelViewMatrix.multiplyMatrices(Me.matrixWorldInverse,ce.matrixWorld),ce.normalMatrix.getNormalMatrix(ce.modelViewMatrix),Re.onBeforeRender(_,Se,Me,Fe,ce,ke),Re.transparent===!0&&Re.side===3?(Re.side=1,Re.needsUpdate=!0,_.renderBufferDirect(Me,Se,Fe,Re,ce,ke),Re.side=0,Re.needsUpdate=!0,_.renderBufferDirect(Me,Se,Fe,Re,ce,ke),Re.side=3):_.renderBufferDirect(Me,Se,Fe,Re,ce,ke),ce.onAfterRender(_,Se,Me,Fe,Re,ke)}function Ts(ce,Se,Me,Fe){Se.isScene!==!0&&(Se=F);const Re=$.get(ce);Re.__version=ce.version;const ke=Fe.state.lights,ut=Fe.state.shadowsArray,dt=ke.state.version,ft=Bt(Me,ce,Fe);Re.planeReflProbe=ft;const yt=te.getParameters(ce,ke.state,ut,Se,Me,ft),Ze=te.getProgramCacheKey(yt);let Rn=Re.programs;Re.environment=ce.isMeshNodeMaterial||ce.isMeshStandardMaterial?Se.environment:null,Re.fog=Se.fog,Re.envMap=(ce.isMeshNodeMaterial||ce.isMeshStandardMaterial?Y:V).get(ce.envMap||Re.environment),Re.useGTAO=_.canUseGTAO()&&ce.isMeshNodeMaterial&&ce.canUseGTAO(),Rn===void 0&&(ce.addEventListener("dispose",jn),Rn=new Map,Re.programs=Rn);let $t=Rn.get(Ze);if($t!==void 0){if(Re.currentProgram===$t&&Re.lightsStateVersion===dt)return De(ce,yt),$t}else yt.uniforms=te.getUniforms(ce),ce.onBuild(Me,yt,_),ce.onBeforeCompile(yt,_),$t=te.acquireProgram(yt,Ze),Rn.set(Ze,$t),J.numShaderCompiles=te.getNumShaderCompiles(),Re.uniforms=yt.uniforms;const at=Re.uniforms;if((ce.isShaderMaterial||ce.isRawShaderMaterial)&&ce.clipping!==!0||ce.defines.WORLD_NODES||(at.clippingPlanes=Ne.uniform),De(ce,yt),Re.needsLights=(function(zt){return zt.isMeshNodeMaterial||zt.isMeshLambertMaterial||zt.isMeshStandardMaterial||zt.isShadowMaterial||zt.isShaderMaterial&&zt.lights===!0})(ce),Re.lightsStateVersion=dt,Re.needsLights&&(at.ambientLightColor.value=ke.state.ambient,at.lightProbe.value=ke.state.probe,at.directionalLights.value=ke.state.directional,at.spotLights.value=ke.state.spot,at.spotLightShadows.value=ke.state.spotShadow,at.rectAreaLights.value=ke.state.rectArea,at.ltc_1.value=ke.state.rectAreaLTC1,at.ltc_2.value=ke.state.rectAreaLTC2,at.pointLights.value=ke.state.point,at.pointLightShadows.value=ke.state.pointShadow,at.hemisphereLights.value=ke.state.hemi,at.spotShadowMap.value=ke.state.spotShadowMap,at.spotShadowMatrix.value=ke.state.spotShadowMatrix,at.pointShadowMap.value=ke.state.pointShadowMap,at.pointShadowMatrix.value=ke.state.pointShadowMatrix,at.rectAreaLightShadows.value=ke.state.rectAreaShadow,at.rectAreaShadowMap.value=ke.state.rectAreaShadowMap,at.rectAreaShadowMatrix.value=ke.state.rectAreaShadowMatrix,at.directionalLightShadowsCSM.value=ke.state.directionalShadowCSM,at.directionalShadowCSMMap.value=ke.state.directionalShadowCSMMap,at.directionalShadowCSMMatrix.value=ke.state.directionalShadowCSMMatrix,at.directionalLightShadowsCSMCascade.value=ke.state.directionalShadowCSMCascade),ce.isMeshNodeMaterial){at.nodeRGB.value!==4*ce.nodeRGB.length&&(at.nodeRGB.value=new Float32Array(4*ce.nodeRGB.length)),at.nodeValue.value.length!==ce.nodeValue.length&&(at.nodeValue.value=new Float32Array(ce.nodeValue.length));for(const zt in ce.nodeInputs){const Is=`nodeInputs${zg(zt)}`;at[Is].value.length!==ce.nodeInputs[zt]&&(at[Is].value=ce.nodeInputs[zt])}Re.nodeTexCoordObjectMatrices&&Re.nodeTexCoordObjectMatrices.length===16*ce.nodeTexCoordObject.length||(Re.nodeTexCoordObjectMatrices=new Float32Array(16*ce.nodeTexCoordObject.length))}else Re.nodeTexCoordObjectMatrices=new Float32Array(0);return Re.currentProgram=$t,Re.uniformsList=null,$t}function fi(ce){if(ce.uniformsList===null){const Se=ce.currentProgram.getUniforms();ce.uniformsList=m0.seqWithValue(Se.seq,ce.uniforms)}return ce.uniformsList}function De(ce,Se){const Me=$.get(ce);Me.outputEncoding=Se.outputEncoding,Me.instancing=Se.instancing,Me.skinning=Se.skinning,Me.morphTargets=Se.morphTargets,Me.morphNormals=Se.morphNormals,Me.morphColors=Se.morphColors,Me.morphTargetsCount=Se.morphTargetsCount,Me.numClippingPlanes=Se.numClippingPlanes,Me.numIntersection=Se.numClipIntersection,Me.vertexAlphas=Se.vertexAlphas,Me.vertexTangents=Se.vertexTangents,Me.toneMapping=Se.toneMapping,Me.flipSided=Se.flipSided}function Bt(ce,Se,Me){return(Se.isMeshNodeMaterial||Se.isMeshStandardMaterial)&&Me.state.planeReflProbeArray.find((Fe=>Fe.intersectsMesh(ce)))||null}Vr.setAnimationLoop((function(ce){xl&&xl(ce)})),typeof self<"u"&&Vr.setContext(self),this.setAnimationLoop=function(ce){xl=ce,rn.setAnimationLoop(ce),ce===null?Vr.stop():Vr.start()},rn.addEventListener("sessionstart",Sc),rn.addEventListener("sessionend",wc),this.render=function(ce,Se){if(Se!==void 0&&Se.isCamera!==!0)return void console.error("v3d.WebGLRenderer.render: camera is not an instance of v3d.Camera.");if(A===!0)return;ce.matrixWorldAutoUpdate===!0&&ce.updateMatrixWorld(),Se.parent===null&&Se.matrixWorldAutoUpdate===!0&&Se.updateMatrixWorld(),rn.enabled===!0&&rn.isPresenting===!0&&(rn.cameraAutoUpdate===!0&&rn.updateCamera(Se),Se=rn.getCamera()),ce.isScene===!0&&ce.onBeforeRender(_,ce,Se,E),p=Ie.get(ce,g.length),p.init(),g.push(p),ae.multiplyMatrices(Se.projectionMatrix,Se.matrixWorldInverse),T.setFromProjectionMatrix(ae),O=this.localClippingEnabled,R=Ne.init(this.clippingPlanes,O,Se),h=we.get(ce,m.length),h.init(),m.push(h),Ms(ce,Se,0,_.sortObjects),h.finish(),_.sortObjects===!0&&h.sort(G,se),R===!0&&Ne.beginShadows();const Me=p.state.shadowsArray;if(He.render(Me,ce,Se),R===!0&&Ne.endShadows(),this.info.render.frame++,je.render(h,ce),p.setupLights(),p.sortEnvMapProbes(),Se.isArrayCamera){const Fe=Se.cameras;for(let Re=0,ke=Fe.length;Re<ke;Re++){const ut=Fe[Re];Mc(h,ce,ut,ut.viewport)}}else Mc(h,ce,Se);E!==null&&(B.updateMultisampleRenderTarget(E),B.updateRenderTargetMipmap(E)),ce.isScene===!0&&ce.onAfterRender(_,ce,Se),pe.resetDefaultState(),x=-1,w=null,g.pop(),p=g.length>0?g[g.length-1]:null,m.pop(),h=m.length>0?m[m.length-1]:null},this.getActiveCubeFace=function(){return y},this.getActiveMipmapLevel=function(){return b},this.getRenderTarget=function(){return E},this.setRenderTargetTextures=function(ce,Se,Me){$.get(ce.texture).__webglTexture=Se,$.get(ce.depthTexture).__webglTexture=Me;const Fe=$.get(ce);Fe.__hasExternalTextures=!0,Fe.__hasExternalTextures&&(Fe.__autoAllocateDepthBuffer=Me===void 0,Fe.__autoAllocateDepthBuffer||M.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("v3d.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),Fe.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(ce,Se){const Me=$.get(ce);Me.__webglFramebuffer=Se,Me.__useDefaultFramebuffer=Se===void 0},this.setRenderTarget=function(ce,Se=0,Me=0){E=ce,y=Se,b=Me;let Fe=!0,Re=null,ke=!1,ut=!1;if(ce){const dt=$.get(ce);dt.__useDefaultFramebuffer!==void 0?(I.bindFramebuffer(36160,null),Fe=!1):dt.__webglFramebuffer===void 0?B.setupRenderTarget(ce):dt.__hasExternalTextures&&B.rebindTextures(ce,$.get(ce.texture).__webglTexture,$.get(ce.depthTexture).__webglTexture);const ft=ce.texture;(ft.isData3DTexture||ft.isDataArrayTexture||ft.isCompressedArrayTexture)&&(ut=!0);const yt=$.get(ce).__webglFramebuffer;ce.isWebGLCubeRenderTarget?(Re=yt[Se],ke=!0):Re=S.isWebGL2&&ce.samples>0&&B.useMultisampledRTT(ce)===!1?$.get(ce).__webglMultisampledFramebuffer:yt,L.copy(ce.viewport),C.copy(ce.scissor),P=ce.scissorTest}else L.copy(ee).multiplyScalar(re).floor(),C.copy(ie).multiplyScalar(re).floor(),P=H;if(I.bindFramebuffer(36160,Re)&&S.drawBuffers&&Fe&&I.drawBuffers(ce,Re),I.viewport(L),I.scissor(C),I.setScissorTest(P),ke){const dt=$.get(ce.texture);Ce.framebufferTexture2D(36160,36064,34069+Se,dt.__webglTexture,Me)}else if(ut){const dt=$.get(ce.texture),ft=Se||0;Ce.framebufferTextureLayer(36160,36064,dt.__webglTexture,Me||0,ft)}x=-1},this.readRenderTargetPixels=function(ce,Se,Me,Fe,Re,ke,ut){if(!ce||!ce.isWebGLRenderTarget)return void console.error("v3d.WebGLRenderer.readRenderTargetPixels: renderTarget is not v3d.WebGLRenderTarget.");let dt=$.get(ce).__webglFramebuffer;if(ce.isWebGLCubeRenderTarget&&ut!==void 0&&(dt=dt[ut]),dt){I.bindFramebuffer(36160,dt);try{const ft=ce.texture,yt=ft.format,Ze=ft.type;if(yt!==1023&&Rt.convert(yt)!==Ce.getParameter(35739))return void console.error("v3d.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");const Rn=Ze===1016&&(M.has("EXT_color_buffer_half_float")||S.isWebGL2&&M.has("EXT_color_buffer_float"));if(!(Ze===1009||Rt.convert(Ze)===Ce.getParameter(35738)||Ze===1015&&(S.isWebGL2||M.has("OES_texture_float")||M.has("WEBGL_color_buffer_float"))||Rn))return void console.error("v3d.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");Se>=0&&Se<=ce.width-Fe&&Me>=0&&Me<=ce.height-Re&&Ce.readPixels(Se,Me,Fe,Re,Rt.convert(yt),Rt.convert(Ze),ke)}finally{const ft=E!==null?$.get(E).__webglFramebuffer:null;I.bindFramebuffer(36160,ft)}}},this.readRenderTargetPixelsAsync=async function(ce,Se,Me,Fe,Re,ke,ut){if(!ce||!ce.isWebGLRenderTarget)throw new Error("v3d.WebGLRenderer.readRenderTargetPixels: renderTarget is not v3d.WebGLRenderTarget.");let dt=$.get(ce).__webglFramebuffer;if(ce.isWebGLCubeRenderTarget&&ut!==void 0&&(dt=dt[ut]),dt){if(Se>=0&&Se<=ce.width-Fe&&Me>=0&&Me<=ce.height-Re){I.bindFramebuffer(36160,dt);const ft=ce.texture,yt=ft.format,Ze=ft.type;if(yt!==1023&&Rt.convert(yt)!==Ce.getParameter(35739))return void console.error("v3d.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");const Rn=Ze===1016&&(M.has("EXT_color_buffer_half_float")||S.isWebGL2&&M.has("EXT_color_buffer_float"));if(!(Ze===1009||Rt.convert(Ze)===Ce.getParameter(35738)||Ze===1015&&(S.isWebGL2||M.has("OES_texture_float")||M.has("WEBGL_color_buffer_float"))||Rn))return void console.error("v3d.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");const $t=Ce.createBuffer();Ce.bindBuffer(35051,$t),Ce.bufferData(35051,ke.byteLength,35041),Ce.readPixels(Se,Me,Fe,Re,Rt.convert(yt),Rt.convert(Ze),0);const at=E!==null?$.get(E).__webglFramebuffer:null;I.bindFramebuffer(36160,at);const zt=Ce.fenceSync(37143,0);return Ce.flush(),await Xse(Ce,zt,4),Ce.bindBuffer(35051,$t),Ce.getBufferSubData(35051,0,ke),Ce.deleteBuffer($t),Ce.deleteSync(zt),ke}throw new Error("v3d.WebGLRenderer.readRenderTargetPixelsAsync: requested read bounds are out of range.")}},this.copyFramebufferToTexture=function(ce,Se,Me=0){const Fe=Math.pow(2,-Me),Re=Math.floor(Se.image.width*Fe),ke=Math.floor(Se.image.height*Fe);B.setTexture2D(Se,0),Ce.copyTexSubImage2D(3553,Me,0,0,ce.x,ce.y,Re,ke),I.unbindTexture()},this.copyTextureToTexture=function(ce,Se,Me,Fe=0){const Re=Se.image.width,ke=Se.image.height,ut=Rt.convert(Me.format),dt=Rt.convert(Me.type);B.setTexture2D(Me,0),Ce.pixelStorei(37440,Me.flipY),Ce.pixelStorei(37441,Me.premultiplyAlpha),Ce.pixelStorei(3317,Me.unpackAlignment),Se.isDataTexture?Ce.texSubImage2D(3553,Fe,ce.x,ce.y,Re,ke,ut,dt,Se.image.data):Se.isCompressedTexture?Ce.compressedTexSubImage2D(3553,Fe,ce.x,ce.y,Se.mipmaps[0].width,Se.mipmaps[0].height,ut,Se.mipmaps[0].data):Ce.texSubImage2D(3553,Fe,ce.x,ce.y,ut,dt,Se.image),Fe===0&&Me.generateMipmaps&&Ce.generateMipmap(3553),I.unbindTexture()},this.copyTextureToTexture3D=function(ce,Se,Me,Fe,Re=0){if(!S.isWebGL2)return void console.warn("v3d.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");const ke=ce.max.x-ce.min.x+1,ut=ce.max.y-ce.min.y+1,dt=ce.max.z-ce.min.z+1,ft=Rt.convert(Fe.format),yt=Rt.convert(Fe.type);let Ze;if(Fe.isData3DTexture)B.setTexture3D(Fe,0),Ze=32879;else{if(!Fe.isDataArrayTexture)return void console.warn("v3d.WebGLRenderer.copyTextureToTexture3D: only supports v3d.DataTexture3D and v3d.DataTexture2DArray.");B.setTexture2DArray(Fe,0),Ze=35866}Ce.pixelStorei(37440,Fe.flipY),Ce.pixelStorei(37441,Fe.premultiplyAlpha),Ce.pixelStorei(3317,Fe.unpackAlignment);const Rn=Ce.getParameter(3314),$t=Ce.getParameter(32878),at=Ce.getParameter(3316),zt=Ce.getParameter(3315),Is=Ce.getParameter(32877),sn=Me.isCompressedTexture?Me.mipmaps[0]:Me.image;Ce.pixelStorei(3314,sn.width),Ce.pixelStorei(32878,sn.height),Ce.pixelStorei(3316,ce.min.x),Ce.pixelStorei(3315,ce.min.y),Ce.pixelStorei(32877,ce.min.z),Me.isDataTexture||Me.isData3DTexture?Ce.texSubImage3D(Ze,Re,Se.x,Se.y,Se.z,ke,ut,dt,ft,yt,sn.data):Me.isCompressedArrayTexture?(console.warn("v3d.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),Ce.compressedTexSubImage3D(Ze,Re,Se.x,Se.y,Se.z,ke,ut,dt,ft,sn.data)):Ce.texSubImage3D(Ze,Re,Se.x,Se.y,Se.z,ke,ut,dt,ft,yt,sn),Ce.pixelStorei(3314,Rn),Ce.pixelStorei(32878,$t),Ce.pixelStorei(3316,at),Ce.pixelStorei(3315,zt),Ce.pixelStorei(32877,Is),Re===0&&Fe.generateMipmaps&&Ce.generateMipmap(Ze),I.unbindTexture()},this.initTexture=function(ce){ce.isCubeTexture?B.setTextureCube(ce,0):ce.isData3DTexture?B.setTexture3D(ce,0):ce.isDataArrayTexture||ce.isCompressedArrayTexture?B.setTexture2DArray(ce,0):B.setTexture2D(ce,0),I.unbindTexture()},this.resetState=function(){y=0,b=0,E=null,I.reset(),pe.reset()},typeof __V3D_DEVTOOLS__<"u"&&__V3D_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this})),this.updateGeometry=function(ce){return fe.update(ce)},this.setOIT=function(ce,Se){this.oitRenderer.setSize(D,Q),this.oitRenderer.texType=Rt.convert(1016)!==null?1016:1009;let Me=Se||(i===!0?4:0);this.oitRenderer.isMethodCompatible(ce,S)?this.oitRenderer.setMethod(ce,Me):console.log("v3d.WebGLRenderer: the OIT method is not compatible.")},this.getOIT=function(){return this.oitRenderer.method},Object.defineProperty(this,"useOIT",{get:function(){return z},set:function(ce){this.setTransparentSort(ce?function(){}:null),z=ce}})}class z2{constructor(e,t=25e-5){this.isFogExp2=!0,this.name="",this.color=new Ge(e),this.density=t}clone(){return new z2(this.color,this.density)}}class G2{constructor(e,t=1,r=1e3){this.isFog=!0,this.name="",this.color=new Ge(e),this.near=t,this.far=r}clone(){return new G2(this.color,this.near,this.far)}}class H2 extends Nr{constructor(e){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new Ge(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}let Hu;const Ah=new N,Wu=new N,ju=new N,Qu=new be,yh=new be,OL=new Ue,v0=new N,bh=new N,A0=new N,kL=new be,W2=new be,FL=new be;class VL extends kt{constructor(e){if(super(),this.isSprite=!0,this.type="Sprite",Hu===void 0){Hu=new At;const t=new Float32Array([-.5,-.5,0,.5,-.5,0,.5,.5,0,-.5,.5,0]),r=new Float32Array([0,0,1,0,1,1,0,1]);Hu.setIndex([0,1,2,0,2,3]),Hu.setAttribute("position",new Xe(t,3)),Hu.setAttribute("uv",new Xe(r,2))}this.geometry=Hu,this.material=e!==void 0?e:new H2,this.center=new be(.5,.5)}raycast(e,t){if(e.camera===null)return void console.error('v3d.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.');Wu.setFromMatrixScale(this.matrixWorld),OL.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),ju.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&Wu.multiplyScalar(-ju.z);const r=this.material.rotation;let o,i;r!==0&&(i=Math.cos(r),o=Math.sin(r));const a=this.center;y0(v0.set(-.5,-.5,0),ju,a,Wu,o,i),y0(bh.set(.5,-.5,0),ju,a,Wu,o,i),y0(A0.set(.5,.5,0),ju,a,Wu,o,i),kL.set(0,0),W2.set(1,0),FL.set(1,1);let s=e.ray.intersectTriangle(v0,bh,A0,!1,Ah);if(s===null&&(y0(bh.set(-.5,.5,0),ju,a,Wu,o,i),W2.set(0,1),s=e.ray.intersectTriangle(v0,A0,bh,!1,Ah),s===null))return;const l=e.ray.origin.distanceTo(Ah);l<e.near||l>e.far||t.push({distance:l,point:Ah.clone(),uv:Br.getInterpolation(Ah,v0,bh,A0,kL,W2,FL,new be),face:null,object:this})}copy(e,t){return super.copy(e,t),e.center!==void 0&&this.center.copy(e.center),this.material=e.material,this}}function y0(n,e,t,r,o,i){Qu.subVectors(n,t).addScalar(.5).multiply(r),o!==void 0?(yh.x=i*Qu.x-o*Qu.y,yh.y=o*Qu.x+i*Qu.y):yh.copy(Qu),n.copy(e),n.x+=yh.x,n.y+=yh.y,n.applyMatrix4(OL)}const b0=new N,UL=new N;class v1e extends kt{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(e){super.copy(e,!1);const t=e.levels;for(let r=0,o=t.length;r<o;r++){const i=t[r];this.addLevel(i.object.clone(),i.distance,i.hysteresis)}return this.autoUpdate=e.autoUpdate,this}addLevel(e,t=0,r=0){t=Math.abs(t);const o=this.levels;let i;for(i=0;i<o.length&&!(t<o[i].distance);i++);return o.splice(i,0,{distance:t,hysteresis:r,object:e}),this.add(e),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(e){const t=this.levels;if(t.length>0){let r,o;for(r=1,o=t.length;r<o;r++){let i=t[r].distance;if(t[r].object.visible&&(i-=i*t[r].hysteresis),e<i)break}return t[r-1].object}return null}raycast(e,t){if(this.levels.length>0){b0.setFromMatrixPosition(this.matrixWorld);const r=e.ray.origin.distanceTo(b0);this.getObjectForDistance(r).raycast(e,t)}}update(e){const t=this.levels;if(t.length>1){b0.setFromMatrixPosition(e.matrixWorld),UL.setFromMatrixPosition(this.matrixWorld);const r=b0.distanceTo(UL)/e.zoom;let o,i;for(t[0].object.visible=!0,o=1,i=t.length;o<i;o++){let a=t[o].distance;if(t[o].object.visible&&(a-=a*t[o].hysteresis),!(r>=a))break;t[o-1].object.visible=!1,t[o].object.visible=!0}for(this._currentLevel=o-1;o<i;o++)t[o].object.visible=!1}}}const zL=new N,GL=new pt,HL=new pt,A1e=new N,WL=new Ue;class x0 extends Mt{constructor(e,t){super(e,t),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Ue,this.bindMatrixInverse=new Ue,this.normalizeSkinWeights()}copy(e,t){return super.copy(e,t),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,this}bind(e,t){this.skeleton=e,t===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new pt,t=this.geometry.attributes.skinWeight;for(let r=0,o=t.count;r<o;r++){e.fromBufferAttribute(t,r);const i=1/e.manhattanLength();i!==1/0?e.multiplyScalar(i):e.set(1,0,0,0),t.setXYZW(r,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode==="attached"?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode==="detached"?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("v3d.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}boneTransform(e,t){const r=this.skeleton,o=this.geometry;GL.fromBufferAttribute(o.attributes.skinIndex,e),HL.fromBufferAttribute(o.attributes.skinWeight,e),zL.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let i=0;i<4;i++){const a=HL.getComponent(i);if(a!==0){const s=GL.getComponent(i);WL.multiplyMatrices(r.bones[s].matrixWorld,r.boneInverses[s]),t.addScaledVector(A1e.copy(zL).applyMatrix4(WL),a)}}return t.applyMatrix4(this.bindMatrixInverse)}}class jL extends kt{constructor(){super(),this.isBone=!0,this.type="Bone"}}class gs extends $n{constructor(e=null,t=1,r=1,o,i,a,s,l,c=1003,u=1003,d,f){super(null,a,s,l,c,u,o,i,d,f),this.isDataTexture=!0,this.image={data:e,width:t,height:r},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const QL=new Ue,y1e=new Ue;class E0{constructor(e=[],t=[]){this.uuid=ji(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(16*e.length),t.length===0)this.calculateInverses();else if(e.length!==t.length){console.warn("v3d.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let r=0,o=this.bones.length;r<o;r++)this.boneInverses.push(new Ue)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const r=new Ue;this.bones[e]&&r.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(r)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const r=this.bones[e];r&&r.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const r=this.bones[e];r&&(r.parent&&r.parent.isBone?(r.matrix.copy(r.parent.matrixWorld).invert(),r.matrix.multiply(r.matrixWorld)):r.matrix.copy(r.matrixWorld),r.matrix.decompose(r.position,r.quaternion,r.scale))}}update(){const e=this.bones,t=this.boneInverses,r=this.boneMatrices,o=this.boneTexture;for(let i=0,a=e.length;i<a;i++){const s=e[i]?e[i].matrixWorld:y1e;QL.multiplyMatrices(s,t[i]),QL.toArray(r,16*i)}o!==null&&(o.needsUpdate=!0)}clone(){return new E0(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(4*this.bones.length);e=LR(e),e=Math.max(e,4);const t=new Float32Array(e*e*4);t.set(this.boneMatrices);const r=new gs(t,e,e,1023,1015);return r.name="Skeleton.bone",r.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=r,this.boneTextureSize=e,this}getBoneByName(e){for(let t=0,r=this.bones.length;t<r;t++){const o=this.bones[t];if(o.name===e)return o}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}}let j2=class extends Xe{constructor(n,e,t,r=1){super(n,e,t),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=r}copy(n){return super.copy(n),this.meshPerAttribute=n.meshPerAttribute,this}};const $L=new Ue,YL=new Ue,C0=[],b1e=new Ue,xh=new Mt;class x1e extends Mt{constructor(e,t,r){super(e,t),this.isInstancedMesh=!0,this.instanceMatrix=new j2(new Float32Array(16*r),16),this.instanceColor=null,this.count=r,this.frustumCulled=!1;for(let o=0;o<r;o++)this.setMatrixAt(o,b1e)}copy(e,t){return super.copy(e,t),this.instanceMatrix.copy(e.instanceMatrix),e.instanceColor!==null&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,this}getColorAt(e,t){t.fromArray(this.instanceColor.array,3*e)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,16*e)}raycast(e,t){const r=this.matrixWorld,o=this.count;if(xh.geometry=this.geometry,xh.material=this.material,xh.material!==void 0)for(let i=0;i<o;i++){this.getMatrixAt(i,$L),YL.multiplyMatrices(r,$L),xh.matrixWorld=YL,xh.raycast(e,C0);for(let a=0,s=C0.length;a<s;a++){const l=C0[a];l.instanceId=i,l.object=this,t.push(l)}C0.length=0}}setColorAt(e,t){this.instanceColor===null&&(this.instanceColor=new j2(new Float32Array(3*this.instanceMatrix.count),3)),t.toArray(this.instanceColor.array,3*e)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,16*e)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}class _r extends Nr{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new Ge(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const XL=new N,qL=new N,KL=new Ue,Q2=new Tu,S0=new ni;class Ki extends kt{constructor(e=new At,t=new _r){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,r=[0];for(let o=1,i=t.count;o<i;o++)XL.fromBufferAttribute(t,o-1),qL.fromBufferAttribute(t,o),r[o]=r[o-1],r[o]+=XL.distanceTo(qL);e.setAttribute("lineDistance",new mt(r,1))}else console.warn("v3d.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const r=this.geometry,o=this.matrixWorld,i=e.params.Line.threshold,a=r.drawRange;if(r.boundingSphere===null&&r.computeBoundingSphere(),S0.copy(r.boundingSphere),S0.applyMatrix4(o),S0.radius+=i,e.ray.intersectsSphere(S0)===!1)return;KL.copy(o).invert(),Q2.copy(e.ray).applyMatrix4(KL);const s=i/((this.scale.x+this.scale.y+this.scale.z)/3),l=s*s,c=new N,u=new N,d=new N,f=new N,h=this.isLineSegments?2:1,p=r.index,m=r.attributes.position;if(p!==null)for(let g=Math.max(0,a.start),_=Math.min(p.count,a.start+a.count)-1;g<_;g+=h){const A=p.getX(g),y=p.getX(g+1);if(c.fromBufferAttribute(m,A),u.fromBufferAttribute(m,y),Q2.distanceSqToSegment(c,u,f,d)>l)continue;f.applyMatrix4(this.matrixWorld);const b=e.ray.origin.distanceTo(f);b<e.near||b>e.far||t.push({distance:b,point:d.clone().applyMatrix4(this.matrixWorld),index:g,face:null,faceIndex:null,object:this})}else for(let g=Math.max(0,a.start),_=Math.min(m.count,a.start+a.count)-1;g<_;g+=h){if(c.fromBufferAttribute(m,g),u.fromBufferAttribute(m,g+1),Q2.distanceSqToSegment(c,u,f,d)>l)continue;f.applyMatrix4(this.matrixWorld);const A=e.ray.origin.distanceTo(f);A<e.near||A>e.far||t.push({distance:A,point:d.clone().applyMatrix4(this.matrixWorld),index:g,face:null,faceIndex:null,object:this})}}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const r=e[t[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let o=0,i=r.length;o<i;o++){const a=r[o].name||String(o);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=o}}}}}const ZL=new N,JL=new N;class ai extends Ki{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,r=[];for(let o=0,i=t.count;o<i;o+=2)ZL.fromBufferAttribute(t,o),JL.fromBufferAttribute(t,o+1),r[o]=o===0?0:r[o-1],r[o+1]=r[o]+ZL.distanceTo(JL);e.setAttribute("lineDistance",new mt(r,1))}else console.warn("v3d.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class eP extends Ki{constructor(e,t){super(e,t),this.isLineLoop=!0,this.type="LineLoop"}}class $2 extends Nr{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new Ge(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const tP=new Ue,Y2=new Tu,w0=new ni,M0=new N;class nP extends kt{constructor(e=new At,t=new $2){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=e.material,this.geometry=e.geometry,this}raycast(e,t){const r=this.geometry,o=this.matrixWorld,i=e.params.Points.threshold,a=r.drawRange;if(r.boundingSphere===null&&r.computeBoundingSphere(),w0.copy(r.boundingSphere),w0.applyMatrix4(o),w0.radius+=i,e.ray.intersectsSphere(w0)===!1)return;tP.copy(o).invert(),Y2.copy(e.ray).applyMatrix4(tP);const s=i/((this.scale.x+this.scale.y+this.scale.z)/3),l=s*s,c=r.index,u=r.attributes.position;if(c!==null)for(let d=Math.max(0,a.start),f=Math.min(c.count,a.start+a.count);d<f;d++){const h=c.getX(d);M0.fromBufferAttribute(u,h),rP(M0,h,l,o,e,t,this)}else for(let d=Math.max(0,a.start),f=Math.min(u.count,a.start+a.count);d<f;d++)M0.fromBufferAttribute(u,d),rP(M0,d,l,o,e,t,this)}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const r=e[t[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let o=0,i=r.length;o<i;o++){const a=r[o].name||String(o);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=o}}}}}function rP(n,e,t,r,o,i,a){const s=Y2.distanceSqToPoint(n);if(s<t){const l=new N;Y2.closestPointToPoint(n,l),l.applyMatrix4(r);const c=o.ray.origin.distanceTo(l);if(c<o.near||c>o.far)return;i.push({distance:c,distanceToRay:Math.sqrt(s),point:l,index:e,face:null,object:a})}}class E1e extends $n{constructor(e,t,r,o,i,a,s,l,c){super(e,t,r,o,i,a,s,l,c),this.isVideoTexture=!0,this.minFilter=a!==void 0?a:1006,this.magFilter=i!==void 0?i:1006,this.generateMipmaps=!1;const u=this;"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback((function d(){u.needsUpdate=!0,e.requestVideoFrameCallback(d)}))}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;!("requestVideoFrameCallback"in e)&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}class C1e extends $n{constructor(e,t,r){super({width:e,height:t}),this.isFramebufferTexture=!0,this.format=r,this.magFilter=1003,this.minFilter=1003,this.generateMipmaps=!1,this.needsUpdate=!0}}class dl extends $n{constructor(e,t,r,o,i,a,s,l,c,u,d,f){super(null,a,s,l,c,u,o,i,d,f),this.isCompressedTexture=!0,this.image={width:t,height:r},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}class S1e extends dl{constructor(e,t,r,o,i,a){super(e,t,r,i,a),this.isCompressedArrayTexture=!0,this.image.depth=o,this.wrapR=1001}}class oP extends $n{constructor(e,t,r,o,i,a,s,l,c){super(e,t,r,o,i,a,s,l,c),this.isCanvasTexture=!0,this.needsUpdate=!0}}class Zi{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("v3d.Curve: .getPoint() not implemented."),null}getPointAt(e,t){const r=this.getUtoTmapping(e);return this.getPoint(r,t)}getPoints(e=5){const t=[];for(let r=0;r<=e;r++)t.push(this.getPoint(r/e));return t}getSpacedPoints(e=5){const t=[];for(let r=0;r<=e;r++)t.push(this.getPointAt(r/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let r,o=this.getPoint(0),i=0;t.push(0);for(let a=1;a<=e;a++)r=this.getPoint(a/e),i+=r.distanceTo(o),t.push(i),o=r;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){const r=this.getLengths();let o=0;const i=r.length;let a;a=t||e*r[i-1];let s,l=0,c=i-1;for(;l<=c;)if(o=Math.floor(l+(c-l)/2),s=r[o]-a,s<0)l=o+1;else{if(!(s>0)){c=o;break}c=o-1}if(o=c,r[o]===a)return o/(i-1);const u=r[o];return(o+(a-u)/(r[o+1]-u))/(i-1)}getTangent(e,t){let o=e-1e-4,i=e+1e-4;o<0&&(o=0),i>1&&(i=1);const a=this.getPoint(o),s=this.getPoint(i),l=t||(a.isVector2?new be:new N);return l.copy(s).sub(a).normalize(),l}getTangentAt(e,t){const r=this.getUtoTmapping(e);return this.getTangent(r,t)}computeFrenetFrames(e,t){const r=new N,o=[],i=[],a=[],s=new N,l=new Ue;for(let h=0;h<=e;h++){const p=h/e;o[h]=this.getTangentAt(p,new N)}i[0]=new N,a[0]=new N;let c=Number.MAX_VALUE;const u=Math.abs(o[0].x),d=Math.abs(o[0].y),f=Math.abs(o[0].z);u<=c&&(c=u,r.set(1,0,0)),d<=c&&(c=d,r.set(0,1,0)),f<=c&&r.set(0,0,1),s.crossVectors(o[0],r).normalize(),i[0].crossVectors(o[0],s),a[0].crossVectors(o[0],i[0]);for(let h=1;h<=e;h++){if(i[h]=i[h-1].clone(),a[h]=a[h-1].clone(),s.crossVectors(o[h-1],o[h]),s.length()>Number.EPSILON){s.normalize();const p=Math.acos(Ht(o[h-1].dot(o[h]),-1,1));i[h].applyMatrix4(l.makeRotationAxis(s,p))}a[h].crossVectors(o[h],i[h])}if(t===!0){let h=Math.acos(Ht(i[0].dot(i[e]),-1,1));h/=e,o[0].dot(s.crossVectors(i[0],i[e]))>0&&(h=-h);for(let p=1;p<=e;p++)i[p].applyMatrix4(l.makeRotationAxis(o[p],h*p)),a[p].crossVectors(o[p],i[p])}return{tangents:o,normals:i,binormals:a}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class X2 extends Zi{constructor(e=0,t=0,r=1,o=1,i=0,a=2*Math.PI,s=!1,l=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=r,this.yRadius=o,this.aStartAngle=i,this.aEndAngle=a,this.aClockwise=s,this.aRotation=l}getPoint(e,t){const r=t||new be,o=2*Math.PI;let i=this.aEndAngle-this.aStartAngle;const a=Math.abs(i)<Number.EPSILON;for(;i<0;)i+=o;for(;i>o;)i-=o;i<Number.EPSILON&&(i=a?0:o),this.aClockwise!==!0||a||(i===o?i=-o:i-=o);const s=this.aStartAngle+e*i;let l=this.aX+this.xRadius*Math.cos(s),c=this.aY+this.yRadius*Math.sin(s);if(this.aRotation!==0){const u=Math.cos(this.aRotation),d=Math.sin(this.aRotation),f=l-this.aX,h=c-this.aY;l=f*u-h*d+this.aX,c=f*d+h*u+this.aY}return r.set(l,c)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}class w1e extends X2{constructor(e,t,r,o,i,a){super(e,t,r,r,o,i,a),this.isArcCurve=!0,this.type="ArcCurve"}}function q2(){let n=0,e=0,t=0,r=0;function o(i,a,s,l){n=i,e=s,t=-3*i+3*a-2*s-l,r=2*i-2*a+s+l}return{initCatmullRom:function(i,a,s,l,c){o(a,s,c*(s-i),c*(l-a))},initNonuniformCatmullRom:function(i,a,s,l,c,u,d){let f=(a-i)/c-(s-i)/(c+u)+(s-a)/u,h=(s-a)/u-(l-a)/(u+d)+(l-s)/d;f*=u,h*=u,o(a,s,f,h)},calc:function(i){const a=i*i;return n+e*i+t*a+r*(a*i)}}}const T0=new N,K2=new q2,Z2=new q2,J2=new q2;class M1e extends Zi{constructor(e=[],t=!1,r="centripetal",o=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=r,this.tension=o}getPoint(e,t=new N){const r=t,o=this.points,i=o.length,a=(i-(this.closed?0:1))*e;let s,l,c=Math.floor(a),u=a-c;this.closed?c+=c>0?0:(Math.floor(Math.abs(c)/i)+1)*i:u===0&&c===i-1&&(c=i-2,u=1),this.closed||c>0?s=o[(c-1)%i]:(T0.subVectors(o[0],o[1]).add(o[0]),s=T0);const d=o[c%i],f=o[(c+1)%i];if(this.closed||c+2<i?l=o[(c+2)%i]:(T0.subVectors(o[i-1],o[i-2]).add(o[i-1]),l=T0),this.curveType==="centripetal"||this.curveType==="chordal"){const h=this.curveType==="chordal"?.5:.25;let p=Math.pow(s.distanceToSquared(d),h),m=Math.pow(d.distanceToSquared(f),h),g=Math.pow(f.distanceToSquared(l),h);m<1e-4&&(m=1),p<1e-4&&(p=m),g<1e-4&&(g=m),K2.initNonuniformCatmullRom(s.x,d.x,f.x,l.x,p,m,g),Z2.initNonuniformCatmullRom(s.y,d.y,f.y,l.y,p,m,g),J2.initNonuniformCatmullRom(s.z,d.z,f.z,l.z,p,m,g)}else this.curveType==="catmullrom"&&(K2.initCatmullRom(s.x,d.x,f.x,l.x,this.tension),Z2.initCatmullRom(s.y,d.y,f.y,l.y,this.tension),J2.initCatmullRom(s.z,d.z,f.z,l.z,this.tension));return r.set(K2.calc(u),Z2.calc(u),J2.calc(u)),r}copy(e){super.copy(e),this.points=[];for(let t=0,r=e.points.length;t<r;t++){const o=e.points[t];this.points.push(o.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function iP(n,e,t,r,o){const i=.5*(r-e),a=.5*(o-t),s=n*n;return(2*t-2*r+i+a)*(n*s)+(-3*t+3*r-2*i-a)*s+i*n+t}function T1e(n,e){const t=1-n;return t*t*e}function I1e(n,e){return 2*(1-n)*n*e}function R1e(n,e){return n*n*e}function Eh(n,e,t,r){return T1e(n,e)+I1e(n,t)+R1e(n,r)}function L1e(n,e){const t=1-n;return t*t*t*e}function P1e(n,e){const t=1-n;return 3*t*t*n*e}function D1e(n,e){return 3*(1-n)*n*n*e}function B1e(n,e){return n*n*n*e}function Ch(n,e,t,r,o){return L1e(n,e)+P1e(n,t)+D1e(n,r)+B1e(n,o)}class aP extends Zi{constructor(e=new be,t=new be,r=new be,o=new be){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=r,this.v3=o}getPoint(e,t=new be){const r=t,o=this.v0,i=this.v1,a=this.v2,s=this.v3;return r.set(Ch(e,o.x,i.x,a.x,s.x),Ch(e,o.y,i.y,a.y,s.y)),r}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}}class N1e extends Zi{constructor(e=new N,t=new N,r=new N,o=new N){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=r,this.v3=o}getPoint(e,t=new N){const r=t,o=this.v0,i=this.v1,a=this.v2,s=this.v3;return r.set(Ch(e,o.x,i.x,a.x,s.x),Ch(e,o.y,i.y,a.y,s.y),Ch(e,o.z,i.z,a.z,s.z)),r}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}}class eb extends Zi{constructor(e=new be,t=new be){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new be){const r=t;return e===1?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(e).add(this.v1)),r}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t){const r=t||new be;return r.copy(this.v2).sub(this.v1).normalize(),r}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}}class O1e extends Zi{constructor(e=new N,t=new N){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=t}getPoint(e,t=new N){const r=t;return e===1?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(e).add(this.v1)),r}getPointAt(e,t){return this.getPoint(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}}class sP extends Zi{constructor(e=new be,t=new be,r=new be){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=r}getPoint(e,t=new be){const r=t,o=this.v0,i=this.v1,a=this.v2;return r.set(Eh(e,o.x,i.x,a.x),Eh(e,o.y,i.y,a.y)),r}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}}class lP extends Zi{constructor(e=new N,t=new N,r=new N){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=r}getPoint(e,t=new N){const r=t,o=this.v0,i=this.v1,a=this.v2;return r.set(Eh(e,o.x,i.x,a.x),Eh(e,o.y,i.y,a.y),Eh(e,o.z,i.z,a.z)),r}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}}class cP extends Zi{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,t=new be){const r=t,o=this.points,i=(o.length-1)*e,a=Math.floor(i),s=i-a,l=o[a===0?a:a-1],c=o[a],u=o[a>o.length-2?o.length-1:a+1],d=o[a>o.length-3?o.length-1:a+2];return r.set(iP(s,l.x,c.x,u.x,d.x),iP(s,l.y,c.y,u.y,d.y)),r}copy(e){super.copy(e),this.points=[];for(let t=0,r=e.points.length;t<r;t++){const o=e.points[t];this.points.push(o.clone())}return this}}class uP extends Zi{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new eb(t,e))}getPoint(e,t){const r=e*this.getLength(),o=this.getCurveLengths();let i=0;for(;i<o.length;){if(o[i]>=r){const a=o[i]-r,s=this.curves[i],l=s.getLength(),c=l===0?0:1-a/l;return s.getPointAt(c,t)}i++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let t=0;for(let r=0,o=this.curves.length;r<o;r++)t+=this.curves[r].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){const t=[];for(let r=0;r<=e;r++)t.push(this.getPoint(r/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){const t=[];let r;for(let o=0,i=this.curves;o<i.length;o++){const a=i[o],s=a.isEllipseCurve?2*e:a.isLineCurve||a.isLineCurve3?1:a.isSplineCurve?e*a.points.length:e,l=a.getPoints(s);for(let c=0;c<l.length;c++){const u=l[c];r&&r.equals(u)||(t.push(u),r=u)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,r=e.curves.length;t<r;t++){const o=e.curves[t];this.curves.push(o.clone())}return this.autoClose=e.autoClose,this}}class I0 extends uP{constructor(e){super(),this.type="Path",this.currentPoint=new be,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,r=e.length;t<r;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){const r=new eb(this.currentPoint.clone(),new be(e,t));return this.curves.push(r),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,r,o){const i=new sP(this.currentPoint.clone(),new be(e,t),new be(r,o));return this.curves.push(i),this.currentPoint.set(r,o),this}bezierCurveTo(e,t,r,o,i,a){const s=new aP(this.currentPoint.clone(),new be(e,t),new be(r,o),new be(i,a));return this.curves.push(s),this.currentPoint.set(i,a),this}splineThru(e){const t=[this.currentPoint.clone()].concat(e),r=new cP(t);return this.curves.push(r),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,r,o,i,a){const s=this.currentPoint.x,l=this.currentPoint.y;return this.absarc(e+s,t+l,r,o,i,a),this}absarc(e,t,r,o,i,a){return this.absellipse(e,t,r,r,o,i,a),this}ellipse(e,t,r,o,i,a,s,l){const c=this.currentPoint.x,u=this.currentPoint.y;return this.absellipse(e+c,t+u,r,o,i,a,s,l),this}absellipse(e,t,r,o,i,a,s,l){const c=new X2(e,t,r,o,i,a,s,l);if(this.curves.length>0){const d=c.getPoint(0);d.equals(this.currentPoint)||this.lineTo(d.x,d.y)}this.curves.push(c);const u=c.getPoint(1);return this.currentPoint.copy(u),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}}class dP extends At{constructor(e=[new be(0,-.5),new be(.5,0),new be(0,.5)],t=12,r=0,o=2*Math.PI){super(),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:r,phiLength:o},t=Math.floor(t),o=Ht(o,0,2*Math.PI);const i=[],a=[],s=[],l=[],c=[],u=1/t,d=new N,f=new be,h=new N,p=new N,m=new N;let g=0,_=0;for(let A=0;A<=e.length-1;A++)switch(A){case 0:g=e[A+1].x-e[A].x,_=e[A+1].y-e[A].y,h.x=1*_,h.y=-g,h.z=0*_,m.copy(h),h.normalize(),l.push(h.x,h.y,h.z);break;case e.length-1:l.push(m.x,m.y,m.z);break;default:g=e[A+1].x-e[A].x,_=e[A+1].y-e[A].y,h.x=1*_,h.y=-g,h.z=0*_,p.copy(h),h.x+=m.x,h.y+=m.y,h.z+=m.z,h.normalize(),l.push(h.x,h.y,h.z),m.copy(p)}for(let A=0;A<=t;A++){const y=r+A*u*o,b=Math.sin(y),E=Math.cos(y);for(let x=0;x<=e.length-1;x++){d.x=e[x].x*b,d.y=e[x].y,d.z=e[x].x*E,a.push(d.x,d.y,d.z),f.x=A/t,f.y=x/(e.length-1),s.push(f.x,f.y);const w=l[3*x+0]*b,L=l[3*x+1],C=l[3*x+0]*E;c.push(w,L,C)}}for(let A=0;A<t;A++)for(let y=0;y<e.length-1;y++){const b=y+A*e.length,E=b,x=b+e.length,w=b+e.length+1,L=b+1;i.push(E,x,L),i.push(w,L,x)}this.setIndex(i),this.setAttribute("position",new mt(a,3)),this.setAttribute("uv",new mt(s,2)),this.setAttribute("normal",new mt(c,3))}}class k1e extends dP{constructor(e=1,t=1,r=4,o=8){const i=new I0;i.absarc(0,-t/2,e,1.5*Math.PI,0),i.absarc(0,t/2,e,0,.5*Math.PI),super(i.getPoints(r),o),this.type="CapsuleGeometry",this.parameters={radius:e,height:t,capSegments:r,radialSegments:o}}}class F1e extends At{constructor(e=1,t=32,r=0,o=2*Math.PI){super(),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:r,thetaLength:o},t=Math.max(3,t);const i=[],a=[],s=[],l=[],c=new N,u=new be;a.push(0,0,0),s.push(0,0,1),l.push(.5,.5);for(let d=0,f=3;d<=t;d++,f+=3){const h=r+d/t*o;c.x=e*Math.cos(h),c.y=e*Math.sin(h),a.push(c.x,c.y,c.z),s.push(0,0,1),u.x=(a[f]/e+1)/2,u.y=(a[f+1]/e+1)/2,l.push(u.x,u.y)}for(let d=1;d<=t;d++)i.push(d,d+1,0);this.setIndex(i),this.setAttribute("position",new mt(a,3)),this.setAttribute("normal",new mt(s,3)),this.setAttribute("uv",new mt(l,2))}}class tb extends At{constructor(e=1,t=1,r=1,o=32,i=1,a=!1,s=0,l=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:r,radialSegments:o,heightSegments:i,openEnded:a,thetaStart:s,thetaLength:l};const c=this;o=Math.floor(o),i=Math.floor(i);const u=[],d=[],f=[],h=[];let p=0;const m=[],g=r/2;let _=0;function A(y){const b=p,E=new be,x=new N;let w=0;const L=y===!0?e:t,C=y===!0?1:-1;for(let D=1;D<=o;D++)d.push(0,g*C,0),f.push(0,C,0),h.push(.5,.5),p++;const P=p;for(let D=0;D<=o;D++){const Q=D/o*l+s,re=Math.cos(Q),G=Math.sin(Q);x.x=L*G,x.y=g*C,x.z=L*re,d.push(x.x,x.y,x.z),f.push(0,C,0),E.x=.5*re+.5,E.y=.5*G*C+.5,h.push(E.x,E.y),p++}for(let D=0;D<o;D++){const Q=b+D,re=P+D;y===!0?u.push(re,re+1,Q):u.push(re+1,re,Q),w+=3}c.addGroup(_,w,y===!0?1:2),_+=w}(function(){const y=new N,b=new N;let E=0;const x=(t-e)/r;for(let w=0;w<=i;w++){const L=[],C=w/i,P=C*(t-e)+e;for(let D=0;D<=o;D++){const Q=D/o,re=Q*l+s,G=Math.sin(re),se=Math.cos(re);b.x=P*G,b.y=-C*r+g,b.z=P*se,d.push(b.x,b.y,b.z),y.set(G,x,se).normalize(),f.push(y.x,y.y,y.z),h.push(Q,1-C),L.push(p++)}m.push(L)}for(let w=0;w<o;w++)for(let L=0;L<i;L++){const C=m[L][w],P=m[L+1][w],D=m[L+1][w+1],Q=m[L][w+1];u.push(C,P,Q),u.push(P,D,Q),E+=6}c.addGroup(_,E,0),_+=E})(),a===!1&&(e>0&&A(!0),t>0&&A(!1)),this.setIndex(u),this.setAttribute("position",new mt(d,3)),this.setAttribute("normal",new mt(f,3)),this.setAttribute("uv",new mt(h,2))}}class V1e extends tb{constructor(e=1,t=1,r=32,o=1,i=!1,a=0,s=2*Math.PI){super(0,e,t,r,o,i,a,s),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:r,heightSegments:o,openEnded:i,thetaStart:a,thetaLength:s}}}class Sh extends At{constructor(e=[],t=[],r=1,o=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:r,detail:o};const i=[],a=[];function s(f,h,p,m){const g=m+1,_=[];for(let A=0;A<=g;A++){_[A]=[];const y=f.clone().lerp(p,A/g),b=h.clone().lerp(p,A/g),E=g-A;for(let x=0;x<=E;x++)_[A][x]=x===0&&A===g?y:y.clone().lerp(b,x/E)}for(let A=0;A<g;A++)for(let y=0;y<2*(g-A)-1;y++){const b=Math.floor(y/2);y%2==0?(l(_[A][b+1]),l(_[A+1][b]),l(_[A][b])):(l(_[A][b+1]),l(_[A+1][b+1]),l(_[A+1][b]))}}function l(f){i.push(f.x,f.y,f.z)}function c(f,h){const p=3*f;h.x=e[p+0],h.y=e[p+1],h.z=e[p+2]}function u(f,h,p,m){m<0&&f.x===1&&(a[h]=f.x-1),p.x===0&&p.z===0&&(a[h]=m/2/Math.PI+.5)}function d(f){return Math.atan2(f.z,-f.x)}(function(f){const h=new N,p=new N,m=new N;for(let g=0;g<t.length;g+=3)c(t[g+0],h),c(t[g+1],p),c(t[g+2],m),s(h,p,m,f)})(o),(function(f){const h=new N;for(let p=0;p<i.length;p+=3)h.x=i[p+0],h.y=i[p+1],h.z=i[p+2],h.normalize().multiplyScalar(f),i[p+0]=h.x,i[p+1]=h.y,i[p+2]=h.z})(r),(function(){const f=new N;for(let p=0;p<i.length;p+=3){f.x=i[p+0],f.y=i[p+1],f.z=i[p+2];const m=d(f)/2/Math.PI+.5,g=(h=f,Math.atan2(-h.y,Math.sqrt(h.x*h.x+h.z*h.z))/Math.PI+.5);a.push(m,1-g)}var h;(function(){const p=new N,m=new N,g=new N,_=new N,A=new be,y=new be,b=new be;for(let E=0,x=0;E<i.length;E+=9,x+=6){p.set(i[E+0],i[E+1],i[E+2]),m.set(i[E+3],i[E+4],i[E+5]),g.set(i[E+6],i[E+7],i[E+8]),A.set(a[x+0],a[x+1]),y.set(a[x+2],a[x+3]),b.set(a[x+4],a[x+5]),_.copy(p).add(m).add(g).divideScalar(3);const w=d(_);u(A,x+0,p,w),u(y,x+2,m,w),u(b,x+4,g,w)}})(),(function(){for(let p=0;p<a.length;p+=6){const m=a[p+0],g=a[p+2],_=a[p+4],A=Math.max(m,g,_),y=Math.min(m,g,_);A>.9&&y<.1&&(m<.2&&(a[p+0]+=1),g<.2&&(a[p+2]+=1),_<.2&&(a[p+4]+=1))}})()})(),this.setAttribute("position",new mt(i,3)),this.setAttribute("normal",new mt(i.slice(),3)),this.setAttribute("uv",new mt(a,2)),o===0?this.computeVertexNormals():this.normalizeNormals()}}class U1e extends Sh{constructor(e=1,t=0){const r=(1+Math.sqrt(5))/2,o=1/r;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-o,-r,0,-o,r,0,o,-r,0,o,r,-o,-r,0,-o,r,0,o,-r,0,o,r,0,-r,0,-o,r,0,-o,-r,0,o,r,0,o],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,t),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}}}const R0=new N,L0=new N,nb=new N,P0=new Br;class z1e extends At{constructor(e=null,t=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:e,thresholdAngle:t},e!==null){const o=Math.pow(10,4),i=Math.cos(ss*t),a=e.getIndex(),s=e.getAttribute("position"),l=a?a.count:s.count,c=[0,0,0],u=["a","b","c"],d=new Array(3),f={},h=[];for(let p=0;p<l;p+=3){a?(c[0]=a.getX(p),c[1]=a.getX(p+1),c[2]=a.getX(p+2)):(c[0]=p,c[1]=p+1,c[2]=p+2);const{a:m,b:g,c:_}=P0;if(m.fromBufferAttribute(s,c[0]),g.fromBufferAttribute(s,c[1]),_.fromBufferAttribute(s,c[2]),P0.getNormal(nb),d[0]=`${Math.round(m.x*o)},${Math.round(m.y*o)},${Math.round(m.z*o)}`,d[1]=`${Math.round(g.x*o)},${Math.round(g.y*o)},${Math.round(g.z*o)}`,d[2]=`${Math.round(_.x*o)},${Math.round(_.y*o)},${Math.round(_.z*o)}`,d[0]!==d[1]&&d[1]!==d[2]&&d[2]!==d[0])for(let A=0;A<3;A++){const y=(A+1)%3,b=d[A],E=d[y],x=P0[u[A]],w=P0[u[y]],L=`${b}_${E}`,C=`${E}_${b}`;C in f&&f[C]?(nb.dot(f[C].normal)<=i&&(h.push(x.x,x.y,x.z),h.push(w.x,w.y,w.z)),f[C]=null):L in f||(f[L]={index0:c[A],index1:c[y],normal:nb.clone()})}}for(const p in f)if(f[p]){const{index0:m,index1:g}=f[p];R0.fromBufferAttribute(s,m),L0.fromBufferAttribute(s,g),h.push(R0.x,R0.y,R0.z),h.push(L0.x,L0.y,L0.z)}this.setAttribute("position",new mt(h,3))}}}class $u extends I0{constructor(e){super(e),this.uuid=ji(),this.type="Shape",this.holes=[]}getPointsHoles(e){const t=[];for(let r=0,o=this.holes.length;r<o;r++)t[r]=this.holes[r].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,r=e.holes.length;t<r;t++){const o=e.holes[t];this.holes.push(o.clone())}return this}}const G1e={triangulate:function(n,e,t=2){const r=e&&e.length,o=r?e[0]*t:n.length;let i=fP(n,0,o,t,!0);const a=[];if(!i||i.next===i.prev)return a;let s,l,c,u,d,f,h;if(r&&(i=$1e(n,e,i,t)),n.length>80*t){s=c=n[0],l=u=n[1];for(let p=t;p<o;p+=t)d=n[p],f=n[p+1],d<s&&(s=d),f<l&&(l=f),d>c&&(c=d),f>u&&(u=f);h=Math.max(c-s,u-l),h=h!==0?32767/h:0}return wh(i,a,t,s,l,h,0),a}};function fP(n,e,t,r,o){let i,a;if(o===o_e(n,e,t,r)>0)for(i=e;i<t;i+=r)a=mP(i,n[i],n[i+1],a);else for(i=t-r;i>=e;i-=r)a=mP(i,n[i],n[i+1],a);return a&&D0(a,a.next)&&(Th(a),a=a.next),a}function oc(n,e){if(!n)return n;e||(e=n);let t,r=n;do if(t=!1,r.steiner||!D0(r,r.next)&&qn(r.prev,r,r.next)!==0)r=r.next;else{if(Th(r),r=e=r.prev,r===r.next)break;t=!0}while(t||r!==e);return e}function wh(n,e,t,r,o,i,a){if(!n)return;!a&&i&&Z1e(n,r,o,i);let s,l,c=n;for(;n.prev!==n.next;)if(s=n.prev,l=n.next,i?W1e(n,r,o,i):H1e(n))e.push(s.i/t|0),e.push(n.i/t|0),e.push(l.i/t|0),Th(n),n=l.next,c=l.next;else if((n=l)===c){a?a===1?wh(n=j1e(oc(n),e,t),e,t,r,o,i,2):a===2&&Q1e(n,e,t,r,o,i):wh(oc(n),e,t,r,o,i,1);break}}function H1e(n){const e=n.prev,t=n,r=n.next;if(qn(e,t,r)>=0)return!1;const o=e.x,i=t.x,a=r.x,s=e.y,l=t.y,c=r.y,u=o<i?o<a?o:a:i<a?i:a,d=s<l?s<c?s:c:l<c?l:c,f=o>i?o>a?o:a:i>a?i:a,h=s>l?s>c?s:c:l>c?l:c;let p=r.next;for(;p!==e;){if(p.x>=u&&p.x<=f&&p.y>=d&&p.y<=h&&Yu(o,s,i,l,a,c,p.x,p.y)&&qn(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function W1e(n,e,t,r){const o=n.prev,i=n,a=n.next;if(qn(o,i,a)>=0)return!1;const s=o.x,l=i.x,c=a.x,u=o.y,d=i.y,f=a.y,h=s<l?s<c?s:c:l<c?l:c,p=u<d?u<f?u:f:d<f?d:f,m=s>l?s>c?s:c:l>c?l:c,g=u>d?u>f?u:f:d>f?d:f,_=rb(h,p,e,t,r),A=rb(m,g,e,t,r);let y=n.prevZ,b=n.nextZ;for(;y&&y.z>=_&&b&&b.z<=A;){if(y.x>=h&&y.x<=m&&y.y>=p&&y.y<=g&&y!==o&&y!==a&&Yu(s,u,l,d,c,f,y.x,y.y)&&qn(y.prev,y,y.next)>=0||(y=y.prevZ,b.x>=h&&b.x<=m&&b.y>=p&&b.y<=g&&b!==o&&b!==a&&Yu(s,u,l,d,c,f,b.x,b.y)&&qn(b.prev,b,b.next)>=0))return!1;b=b.nextZ}for(;y&&y.z>=_;){if(y.x>=h&&y.x<=m&&y.y>=p&&y.y<=g&&y!==o&&y!==a&&Yu(s,u,l,d,c,f,y.x,y.y)&&qn(y.prev,y,y.next)>=0)return!1;y=y.prevZ}for(;b&&b.z<=A;){if(b.x>=h&&b.x<=m&&b.y>=p&&b.y<=g&&b!==o&&b!==a&&Yu(s,u,l,d,c,f,b.x,b.y)&&qn(b.prev,b,b.next)>=0)return!1;b=b.nextZ}return!0}function j1e(n,e,t){let r=n;do{const o=r.prev,i=r.next.next;!D0(o,i)&&hP(o,r,r.next,i)&&Mh(o,i)&&Mh(i,o)&&(e.push(o.i/t|0),e.push(r.i/t|0),e.push(i.i/t|0),Th(r),Th(r.next),r=n=i),r=r.next}while(r!==n);return oc(r)}function Q1e(n,e,t,r,o,i){let a=n;do{let s=a.next.next;for(;s!==a.prev;){if(a.i!==s.i&&t_e(a,s)){let l=pP(a,s);return a=oc(a,a.next),l=oc(l,l.next),wh(a,e,t,r,o,i,0),void wh(l,e,t,r,o,i,0)}s=s.next}a=a.next}while(a!==n)}function $1e(n,e,t,r){const o=[];let i,a,s,l,c;for(i=0,a=e.length;i<a;i++)s=e[i]*r,l=i<a-1?e[i+1]*r:n.length,c=fP(n,s,l,r,!1),c===c.next&&(c.steiner=!0),o.push(e_e(c));for(o.sort(Y1e),i=0;i<o.length;i++)t=X1e(o[i],t);return t}function Y1e(n,e){return n.x-e.x}function X1e(n,e){const t=q1e(n,e);if(!t)return e;const r=pP(t,n);return oc(r,r.next),oc(t,t.next)}function q1e(n,e){let t,r=e,o=-1/0;const i=n.x,a=n.y;do{if(a<=r.y&&a>=r.next.y&&r.next.y!==r.y){const f=r.x+(a-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(f<=i&&f>o&&(o=f,t=r.x<r.next.x?r:r.next,f===i))return t}r=r.next}while(r!==e);if(!t)return null;const s=t,l=t.x,c=t.y;let u,d=1/0;r=t;do i>=r.x&&r.x>=l&&i!==r.x&&Yu(a<c?i:o,a,l,c,a<c?o:i,a,r.x,r.y)&&(u=Math.abs(a-r.y)/(i-r.x),Mh(r,n)&&(u<d||u===d&&(r.x>t.x||r.x===t.x&&K1e(t,r)))&&(t=r,d=u)),r=r.next;while(r!==s);return t}function K1e(n,e){return qn(n.prev,n,e.prev)<0&&qn(e.next,n,n.next)<0}function Z1e(n,e,t,r){let o=n;do o.z===0&&(o.z=rb(o.x,o.y,e,t,r)),o.prevZ=o.prev,o.nextZ=o.next,o=o.next;while(o!==n);o.prevZ.nextZ=null,o.prevZ=null,J1e(o)}function J1e(n){let e,t,r,o,i,a,s,l,c=1;do{for(t=n,n=null,i=null,a=0;t;){for(a++,r=t,s=0,e=0;e<c&&(s++,r=r.nextZ,r);e++);for(l=c;s>0||l>0&&r;)s!==0&&(l===0||!r||t.z<=r.z)?(o=t,t=t.nextZ,s--):(o=r,r=r.nextZ,l--),i?i.nextZ=o:n=o,o.prevZ=i,i=o;t=r}i.nextZ=null,c*=2}while(a>1);return n}function rb(n,e,t,r,o){return(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-t)*o|0)|n<<8))|n<<4))|n<<2))|n<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-r)*o|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function e_e(n){let e=n,t=n;do(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next;while(e!==n);return t}function Yu(n,e,t,r,o,i,a,s){return(o-a)*(e-s)>=(n-a)*(i-s)&&(n-a)*(r-s)>=(t-a)*(e-s)&&(t-a)*(i-s)>=(o-a)*(r-s)}function t_e(n,e){return n.next.i!==e.i&&n.prev.i!==e.i&&!n_e(n,e)&&(Mh(n,e)&&Mh(e,n)&&r_e(n,e)&&(qn(n.prev,n,e.prev)||qn(n,e.prev,e))||D0(n,e)&&qn(n.prev,n,n.next)>0&&qn(e.prev,e,e.next)>0)}function qn(n,e,t){return(e.y-n.y)*(t.x-e.x)-(e.x-n.x)*(t.y-e.y)}function D0(n,e){return n.x===e.x&&n.y===e.y}function hP(n,e,t,r){const o=N0(qn(n,e,t)),i=N0(qn(n,e,r)),a=N0(qn(t,r,n)),s=N0(qn(t,r,e));return o!==i&&a!==s||!(o!==0||!B0(n,t,e))||!(i!==0||!B0(n,r,e))||!(a!==0||!B0(t,n,r))||!(s!==0||!B0(t,e,r))}function B0(n,e,t){return e.x<=Math.max(n.x,t.x)&&e.x>=Math.min(n.x,t.x)&&e.y<=Math.max(n.y,t.y)&&e.y>=Math.min(n.y,t.y)}function N0(n){return n>0?1:n<0?-1:0}function n_e(n,e){let t=n;do{if(t.i!==n.i&&t.next.i!==n.i&&t.i!==e.i&&t.next.i!==e.i&&hP(t,t.next,n,e))return!0;t=t.next}while(t!==n);return!1}function Mh(n,e){return qn(n.prev,n,n.next)<0?qn(n,e,n.next)>=0&&qn(n,n.prev,e)>=0:qn(n,e,n.prev)<0||qn(n,n.next,e)<0}function r_e(n,e){let t=n,r=!1;const o=(n.x+e.x)/2,i=(n.y+e.y)/2;do t.y>i!=t.next.y>i&&t.next.y!==t.y&&o<(t.next.x-t.x)*(i-t.y)/(t.next.y-t.y)+t.x&&(r=!r),t=t.next;while(t!==n);return r}function pP(n,e){const t=new ob(n.i,n.x,n.y),r=new ob(e.i,e.x,e.y),o=n.next,i=e.prev;return n.next=e,e.prev=n,t.next=o,o.prev=t,r.next=t,t.prev=r,i.next=r,r.prev=i,r}function mP(n,e,t,r){const o=new ob(n,e,t);return r?(o.next=r.next,o.prev=r,r.next.prev=o,r.next=o):(o.prev=o,o.next=o),o}function Th(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function ob(n,e,t){this.i=n,this.x=e,this.y=t,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function o_e(n,e,t,r){let o=0;for(let i=e,a=t-r;i<t;i+=r)o+=(n[a]-n[i])*(n[i+1]+n[a+1]),a=i;return o}class ba{static area(e){const t=e.length;let r=0;for(let o=t-1,i=0;i<t;o=i++)r+=e[o].x*e[i].y-e[i].x*e[o].y;return .5*r}static isClockWise(e){return ba.area(e)<0}static triangulateShape(e,t){const r=[],o=[],i=[];gP(e),_P(r,e);let a=e.length;t.forEach(gP);for(let l=0;l<t.length;l++)o.push(a),a+=t[l].length,_P(r,t[l]);const s=G1e.triangulate(r,o);for(let l=0;l<s.length;l+=3)i.push(s.slice(l,l+3));return i}}function gP(n){const e=n.length;e>2&&n[e-1].equals(n[0])&&n.pop()}function _P(n,e){for(let t=0;t<e.length;t++)n.push(e[t].x),n.push(e[t].y)}class vP extends At{constructor(e=new $u([new be(.5,.5),new be(-.5,.5),new be(-.5,-.5),new be(.5,-.5)]),t={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];const r=this,o=[],i=[];for(let s=0,l=e.length;s<l;s++)a(e[s]);function a(s){const l=[],c=t.curveSegments!==void 0?t.curveSegments:12,u=t.steps!==void 0?t.steps:1,d=t.depth!==void 0?t.depth:1;let f=t.bevelEnabled===void 0||t.bevelEnabled,h=t.bevelThickness!==void 0?t.bevelThickness:.2,p=t.bevelSize!==void 0?t.bevelSize:h-.1,m=t.bevelOffset!==void 0?t.bevelOffset:0,g=t.bevelSegments!==void 0?t.bevelSegments:3;const _=t.extrudePath,A=t.UVGenerator!==void 0?t.UVGenerator:i_e;let y,b,E,x,w,L=!1;_&&(y=_.getSpacedPoints(u),L=!0,f=!1,b=_.computeFrenetFrames(u,!1),E=new N,x=new N,w=new N),f||(g=0,h=0,p=0,m=0);const C=s.extractPoints(c);let P=C.shape;const D=C.holes;if(!ba.isClockWise(P)){P=P.reverse();for(let j=0,U=D.length;j<U;j++){const z=D[j];ba.isClockWise(z)&&(D[j]=z.reverse())}}const Q=ba.triangulateShape(P,D),re=P;for(let j=0,U=D.length;j<U;j++){const z=D[j];P=P.concat(z)}function G(j,U,z){return U||console.error("v3d.ExtrudeGeometry: vec does not exist"),U.clone().multiplyScalar(z).add(j)}const se=P.length,ee=Q.length;function ie(j,U,z){let v,M,S;const I=j.x-U.x,J=j.y-U.y,$=z.x-j.x,B=z.y-j.y,V=I*I+J*J,Y=I*B-J*$;if(Math.abs(Y)>Number.EPSILON){const le=Math.sqrt(V),me=Math.sqrt($*$+B*B),fe=U.x-J/le,te=U.y+I/le,de=((z.x-B/me-fe)*B-(z.y+$/me-te)*$)/(I*B-J*$);v=fe+I*de-j.x,M=te+J*de-j.y;const we=v*v+M*M;if(we<=2)return new be(v,M);S=Math.sqrt(we/2)}else{let le=!1;I>Number.EPSILON?$>Number.EPSILON&&(le=!0):I<-Number.EPSILON?$<-Number.EPSILON&&(le=!0):Math.sign(J)===Math.sign(B)&&(le=!0),le?(v=-J,M=I,S=Math.sqrt(V)):(v=I,M=J,S=Math.sqrt(V/2))}return new be(v/S,M/S)}const H=[];for(let j=0,U=re.length,z=U-1,v=j+1;j<U;j++,z++,v++)z===U&&(z=0),v===U&&(v=0),H[j]=ie(re[j],re[z],re[v]);const T=[];let R,O=H.concat();for(let j=0,U=D.length;j<U;j++){const z=D[j];R=[];for(let v=0,M=z.length,S=M-1,I=v+1;v<M;v++,S++,I++)S===M&&(S=0),I===M&&(I=0),R[v]=ie(z[v],z[S],z[I]);T.push(R),O=O.concat(R)}for(let j=0;j<g;j++){const U=j/g,z=h*Math.cos(U*Math.PI/2),v=p*Math.sin(U*Math.PI/2)+m;for(let M=0,S=re.length;M<S;M++){const I=G(re[M],H[M],v);ne(I.x,I.y,-z)}for(let M=0,S=D.length;M<S;M++){const I=D[M];R=T[M];for(let J=0,$=I.length;J<$;J++){const B=G(I[J],R[J],v);ne(B.x,B.y,-z)}}}const W=p+m;for(let j=0;j<se;j++){const U=f?G(P[j],O[j],W):P[j];L?(x.copy(b.normals[0]).multiplyScalar(U.x),E.copy(b.binormals[0]).multiplyScalar(U.y),w.copy(y[0]).add(x).add(E),ne(w.x,w.y,w.z)):ne(U.x,U.y,0)}for(let j=1;j<=u;j++)for(let U=0;U<se;U++){const z=f?G(P[U],O[U],W):P[U];L?(x.copy(b.normals[j]).multiplyScalar(z.x),E.copy(b.binormals[j]).multiplyScalar(z.y),w.copy(y[j]).add(x).add(E),ne(w.x,w.y,w.z)):ne(z.x,z.y,d/u*j)}for(let j=g-1;j>=0;j--){const U=j/g,z=h*Math.cos(U*Math.PI/2),v=p*Math.sin(U*Math.PI/2)+m;for(let M=0,S=re.length;M<S;M++){const I=G(re[M],H[M],v);ne(I.x,I.y,d+z)}for(let M=0,S=D.length;M<S;M++){const I=D[M];R=T[M];for(let J=0,$=I.length;J<$;J++){const B=G(I[J],R[J],v);L?ne(B.x,B.y+y[u-1].y,y[u-1].x+z):ne(B.x,B.y,d+z)}}}function ae(j,U){let z=j.length;for(;--z>=0;){const v=z;let M=z-1;M<0&&(M=j.length-1);for(let S=0,I=u+2*g;S<I;S++){const J=se*S,$=se*(S+1);F(U+v+J,U+M+J,U+M+$,U+v+$)}}}function ne(j,U,z){l.push(j),l.push(U),l.push(z)}function oe(j,U,z){k(j),k(U),k(z);const v=o.length/3,M=A.generateTopUV(r,o,v-3,v-2,v-1);q(M[0]),q(M[1]),q(M[2])}function F(j,U,z,v){k(j),k(U),k(v),k(U),k(z),k(v);const M=o.length/3,S=A.generateSideWallUV(r,o,M-6,M-3,M-2,M-1);q(S[0]),q(S[1]),q(S[3]),q(S[1]),q(S[2]),q(S[3])}function k(j){o.push(l[3*j+0]),o.push(l[3*j+1]),o.push(l[3*j+2])}function q(j){i.push(j.x),i.push(j.y)}(function(){const j=o.length/3;if(f){let U=0,z=se*U;for(let v=0;v<ee;v++){const M=Q[v];oe(M[2]+z,M[1]+z,M[0]+z)}U=u+2*g,z=se*U;for(let v=0;v<ee;v++){const M=Q[v];oe(M[0]+z,M[1]+z,M[2]+z)}}else{for(let U=0;U<ee;U++){const z=Q[U];oe(z[2],z[1],z[0])}for(let U=0;U<ee;U++){const z=Q[U];oe(z[0]+se*u,z[1]+se*u,z[2]+se*u)}}r.addGroup(j,o.length/3-j,0)})(),(function(){const j=o.length/3;let U=0;ae(re,U),U+=re.length;for(let z=0,v=D.length;z<v;z++){const M=D[z];ae(M,U),U+=M.length}r.addGroup(j,o.length/3-j,1)})()}this.setAttribute("position",new mt(o,3)),this.setAttribute("uv",new mt(i,2)),this.computeVertexNormals()}}const i_e={generateTopUV:function(n,e,t,r,o){const i=e[3*t],a=e[3*t+1],s=e[3*r],l=e[3*r+1],c=e[3*o],u=e[3*o+1];return[new be(i,a),new be(s,l),new be(c,u)]},generateSideWallUV:function(n,e,t,r,o,i){const a=e[3*t],s=e[3*t+1],l=e[3*t+2],c=e[3*r],u=e[3*r+1],d=e[3*r+2],f=e[3*o],h=e[3*o+1],p=e[3*o+2],m=e[3*i],g=e[3*i+1],_=e[3*i+2];return Math.abs(s-u)<Math.abs(a-c)?[new be(a,1-l),new be(c,1-d),new be(f,1-p),new be(m,1-_)]:[new be(s,1-l),new be(u,1-d),new be(h,1-p),new be(g,1-_)]}};class a_e extends Sh{constructor(e=1,t=0){const r=(1+Math.sqrt(5))/2;super([-1,r,0,1,r,0,-1,-r,0,1,-r,0,0,-1,r,0,1,r,0,-1,-r,0,1,-r,r,0,-1,r,0,1,-r,0,-1,-r,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}}class AP extends Sh{constructor(e=1,t=0){super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}}}class s_e extends At{constructor(e=.5,t=1,r=32,o=1,i=0,a=2*Math.PI){super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:r,phiSegments:o,thetaStart:i,thetaLength:a},r=Math.max(3,r);const s=[],l=[],c=[],u=[];let d=e;const f=(t-e)/(o=Math.max(1,o)),h=new N,p=new be;for(let m=0;m<=o;m++){for(let g=0;g<=r;g++){const _=i+g/r*a;h.x=d*Math.cos(_),h.y=d*Math.sin(_),l.push(h.x,h.y,h.z),c.push(0,0,1),p.x=(h.x/t+1)/2,p.y=(h.y/t+1)/2,u.push(p.x,p.y)}d+=f}for(let m=0;m<o;m++){const g=m*(r+1);for(let _=0;_<r;_++){const A=_+g,y=A,b=A+r+1,E=A+r+2,x=A+1;s.push(y,b,x),s.push(b,E,x)}}this.setIndex(s),this.setAttribute("position",new mt(l,3)),this.setAttribute("normal",new mt(c,3)),this.setAttribute("uv",new mt(u,2))}}class l_e extends At{constructor(e=new $u([new be(0,.5),new be(-.5,-.5),new be(.5,-.5)]),t=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:t};const r=[],o=[],i=[],a=[];let s=0,l=0;if(Array.isArray(e)===!1)c(e);else for(let u=0;u<e.length;u++)c(e[u]),this.addGroup(s,l,u),s+=l,l=0;function c(u){const d=o.length/3,f=u.extractPoints(t);let h=f.shape;const p=f.holes;ba.isClockWise(h)===!1&&(h=h.reverse());for(let g=0,_=p.length;g<_;g++){const A=p[g];ba.isClockWise(A)===!0&&(p[g]=A.reverse())}const m=ba.triangulateShape(h,p);for(let g=0,_=p.length;g<_;g++){const A=p[g];h=h.concat(A)}for(let g=0,_=h.length;g<_;g++){const A=h[g];o.push(A.x,A.y,0),i.push(0,0,1),a.push(A.x,A.y)}for(let g=0,_=m.length;g<_;g++){const A=m[g],y=A[0]+d,b=A[1]+d,E=A[2]+d;r.push(y,b,E),l+=3}}this.setIndex(r),this.setAttribute("position",new mt(o,3)),this.setAttribute("normal",new mt(i,3)),this.setAttribute("uv",new mt(a,2))}}class yP extends At{constructor(e=1,t=32,r=16,o=0,i=2*Math.PI,a=0,s=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:r,phiStart:o,phiLength:i,thetaStart:a,thetaLength:s},t=Math.max(3,Math.floor(t)),r=Math.max(2,Math.floor(r));const l=Math.min(a+s,Math.PI);let c=0;const u=[],d=new N,f=new N,h=[],p=[],m=[],g=[];for(let _=0;_<=r;_++){const A=[],y=_/r;let b=0;_==0&&a==0?b=.5/t:_==r&&l==Math.PI&&(b=-.5/t);for(let E=0;E<=t;E++){const x=E/t;d.x=-e*Math.cos(o+x*i)*Math.sin(a+y*s),d.y=e*Math.cos(a+y*s),d.z=e*Math.sin(o+x*i)*Math.sin(a+y*s),p.push(d.x,d.y,d.z),f.copy(d).normalize(),m.push(f.x,f.y,f.z),g.push(x+b,1-y),A.push(c++)}u.push(A)}for(let _=0;_<r;_++)for(let A=0;A<t;A++){const y=u[_][A+1],b=u[_][A],E=u[_+1][A],x=u[_+1][A+1];(_!==0||a>0)&&h.push(y,b,x),(_!==r-1||l<Math.PI)&&h.push(b,E,x)}this.setIndex(h),this.setAttribute("position",new mt(p,3)),this.setAttribute("normal",new mt(m,3)),this.setAttribute("uv",new mt(g,2))}}class c_e extends Sh{constructor(e=1,t=0){super([1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,t),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t}}}class u_e extends At{constructor(e=1,t=.4,r=12,o=48,i=2*Math.PI){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:r,tubularSegments:o,arc:i},r=Math.floor(r),o=Math.floor(o);const a=[],s=[],l=[],c=[],u=new N,d=new N,f=new N;for(let h=0;h<=r;h++)for(let p=0;p<=o;p++){const m=p/o*i,g=h/r*Math.PI*2;d.x=(e+t*Math.cos(g))*Math.cos(m),d.y=(e+t*Math.cos(g))*Math.sin(m),d.z=t*Math.sin(g),s.push(d.x,d.y,d.z),u.x=e*Math.cos(m),u.y=e*Math.sin(m),f.subVectors(d,u).normalize(),l.push(f.x,f.y,f.z),c.push(p/o),c.push(h/r)}for(let h=1;h<=r;h++)for(let p=1;p<=o;p++){const m=(o+1)*h+p-1,g=(o+1)*(h-1)+p-1,_=(o+1)*(h-1)+p,A=(o+1)*h+p;a.push(m,g,A),a.push(g,_,A)}this.setIndex(a),this.setAttribute("position",new mt(s,3)),this.setAttribute("normal",new mt(l,3)),this.setAttribute("uv",new mt(c,2))}}class ib extends At{constructor(e=1,t=.4,r=64,o=8,i=2,a=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:r,radialSegments:o,p:i,q:a},r=Math.floor(r),o=Math.floor(o);const s=[],l=[],c=[],u=[],d=new N,f=new N,h=new N,p=new N,m=new N,g=new N,_=new N;for(let y=0;y<=r;++y){const b=y/r*i*Math.PI*2;A(b,i,a,e,h),A(b+.01,i,a,e,p),g.subVectors(p,h),_.addVectors(p,h),m.crossVectors(g,_),_.crossVectors(m,g),m.normalize(),_.normalize();for(let E=0;E<=o;++E){const x=E/o*Math.PI*2,w=-t*Math.cos(x),L=t*Math.sin(x);d.x=h.x+(w*_.x+L*m.x),d.y=h.y+(w*_.y+L*m.y),d.z=h.z+(w*_.z+L*m.z),l.push(d.x,d.y,d.z),f.subVectors(d,h).normalize(),c.push(f.x,f.y,f.z),u.push(y/r),u.push(E/o)}}for(let y=1;y<=r;y++)for(let b=1;b<=o;b++){const E=(o+1)*(y-1)+(b-1),x=(o+1)*y+(b-1),w=(o+1)*y+b,L=(o+1)*(y-1)+b;s.push(E,x,L),s.push(x,w,L)}function A(y,b,E,x,w){const L=Math.cos(y),C=Math.sin(y),P=E/b*y,D=Math.cos(P);w.x=x*(2+D)*.5*L,w.y=x*(2+D)*C*.5,w.z=x*Math.sin(P)*.5}this.setIndex(s),this.setAttribute("position",new mt(l,3)),this.setAttribute("normal",new mt(c,3)),this.setAttribute("uv",new mt(u,2))}static fromJSON(e){return new ib(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}}class d_e extends At{constructor(e=new lP(new N(-1,-1,0),new N(-1,1,0),new N(1,1,0)),t=64,r=1,o=8,i=!1){super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:r,radialSegments:o,closed:i};const a=e.computeFrenetFrames(t,i);this.tangents=a.tangents,this.normals=a.normals,this.binormals=a.binormals;const s=new N,l=new N,c=new be;let u=new N;const d=[],f=[],h=[],p=[];function m(g){u=e.getPointAt(g/t,u);const _=a.normals[g],A=a.binormals[g];for(let y=0;y<=o;y++){const b=y/o*Math.PI*2,E=Math.sin(b),x=-Math.cos(b);l.x=x*_.x+E*A.x,l.y=x*_.y+E*A.y,l.z=x*_.z+E*A.z,l.normalize(),f.push(l.x,l.y,l.z),s.x=u.x+r*l.x,s.y=u.y+r*l.y,s.z=u.z+r*l.z,d.push(s.x,s.y,s.z)}}(function(){for(let g=0;g<t;g++)m(g);m(i===!1?t:0),(function(){for(let g=0;g<=t;g++)for(let _=0;_<=o;_++)c.x=g/t,c.y=_/o,h.push(c.x,c.y)})(),(function(){for(let g=1;g<=t;g++)for(let _=1;_<=o;_++){const A=(o+1)*(g-1)+(_-1),y=(o+1)*g+(_-1),b=(o+1)*g+_,E=(o+1)*(g-1)+_;p.push(A,y,E),p.push(y,b,E)}})()})(),this.setIndex(p),this.setAttribute("position",new mt(d,3)),this.setAttribute("normal",new mt(f,3)),this.setAttribute("uv",new mt(h,2))}}class bP extends At{constructor(e=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:e},e!==null){const t=[],r=new Set,o=new N,i=new N;if(e.index!==null){const a=e.attributes.position,s=e.index;let l=e.groups;l.length===0&&(l=[{start:0,count:s.count,materialIndex:0}]);for(let c=0,u=l.length;c<u;++c){const d=l[c],f=d.start;for(let h=f,p=f+d.count;h<p;h+=3)for(let m=0;m<3;m++){const g=s.getX(h+m),_=s.getX(h+(m+1)%3);o.fromBufferAttribute(a,g),i.fromBufferAttribute(a,_),xP(o,i,r)===!0&&(t.push(o.x,o.y,o.z),t.push(i.x,i.y,i.z))}}}else{const a=e.attributes.position;for(let s=0,l=a.count/3;s<l;s++)for(let c=0;c<3;c++){const u=3*s+c,d=3*s+(c+1)%3;o.fromBufferAttribute(a,u),i.fromBufferAttribute(a,d),xP(o,i,r)===!0&&(t.push(o.x,o.y,o.z),t.push(i.x,i.y,i.z))}}this.setAttribute("position",new mt(t,3))}}}function xP(n,e,t){const r=`${n.x},${n.y},${n.z}-${e.x},${e.y},${e.z}`,o=`${e.x},${e.y},${e.z}-${n.x},${n.y},${n.z}`;return t.has(r)!==!0&&t.has(o)!==!0&&(t.add(r),t.add(o),!0)}class f_e extends At{constructor(e=1,t=10,r=!0,o=!0,i=!0,a=!0,s=!0){const l=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,3,16,17,18,7,19,20,21,11,22,23,24,15,25,26,27,18,28,29,30,21,31,32,33,24,34,35,36,27,37,38,39,30,40,41,0,33,42,43,4,36,44,45,8,39,46,47,12,12,13,14,15,48,49,50,51,52,53,54,55,56,57,58,59,15,25,26,27,51,60,61,62,55,63,64,65,59,66,67,68,27,37,38,39,62,69,70,71,65,72,73,74,68,75,76,77,39,46,47,12,71,78,79,48,74,80,81,52,77,82,83,56,56,57,58,59,84,85,86,87,88,89,90,91,92,93,94,95,59,66,67,68,87,96,97,98,91,99,100,101,95,102,103,104,68,75,76,77,98,105,106,107,101,108,109,110,104,111,112,113,77,82,83,56,107,114,115,84,110,116,117,88,113,118,119,92,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,123,136,137,120,127,138,139,124,131,140,141,128,135,142,143,132,132,133,134,135,144,145,146,147,148,149,150,151,68,152,153,154,135,142,143,132,147,155,156,144,151,157,158,148,154,159,160,68,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,164,177,178,161,168,179,180,165,172,181,182,169,176,183,184,173,173,174,175,176,185,186,187,188,189,190,191,192,193,194,195,196,176,183,184,173,188,197,198,185,192,199,200,189,196,201,202,193,203,203,203,203,204,205,206,207,208,208,208,208,209,210,211,212,203,203,203,203,207,213,214,215,208,208,208,208,212,216,217,218,203,203,203,203,215,219,220,221,208,208,208,208,218,222,223,224,203,203,203,203,221,225,226,204,208,208,208,208,224,227,228,209,209,210,211,212,229,230,231,232,233,234,235,236,237,238,239,240,212,216,217,218,232,241,242,243,236,244,245,246,240,247,248,249,218,222,223,224,243,250,251,252,246,253,254,255,249,256,257,258,224,227,228,209,252,259,260,229,255,261,262,233,258,263,264,237,265,265,265,265,266,267,268,269,270,271,272,273,92,119,118,113,265,265,265,265,269,274,275,276,273,277,278,279,113,112,111,104,265,265,265,265,276,280,281,282,279,283,284,285,104,103,102,95,265,265,265,265,282,286,287,266,285,288,289,270,95,94,93,92],c=[1.4,0,2.4,1.4,-.784,2.4,.784,-1.4,2.4,0,-1.4,2.4,1.3375,0,2.53125,1.3375,-.749,2.53125,.749,-1.3375,2.53125,0,-1.3375,2.53125,1.4375,0,2.53125,1.4375,-.805,2.53125,.805,-1.4375,2.53125,0,-1.4375,2.53125,1.5,0,2.4,1.5,-.84,2.4,.84,-1.5,2.4,0,-1.5,2.4,-.784,-1.4,2.4,-1.4,-.784,2.4,-1.4,0,2.4,-.749,-1.3375,2.53125,-1.3375,-.749,2.53125,-1.3375,0,2.53125,-.805,-1.4375,2.53125,-1.4375,-.805,2.53125,-1.4375,0,2.53125,-.84,-1.5,2.4,-1.5,-.84,2.4,-1.5,0,2.4,-1.4,.784,2.4,-.784,1.4,2.4,0,1.4,2.4,-1.3375,.749,2.53125,-.749,1.3375,2.53125,0,1.3375,2.53125,-1.4375,.805,2.53125,-.805,1.4375,2.53125,0,1.4375,2.53125,-1.5,.84,2.4,-.84,1.5,2.4,0,1.5,2.4,.784,1.4,2.4,1.4,.784,2.4,.749,1.3375,2.53125,1.3375,.749,2.53125,.805,1.4375,2.53125,1.4375,.805,2.53125,.84,1.5,2.4,1.5,.84,2.4,1.75,0,1.875,1.75,-.98,1.875,.98,-1.75,1.875,0,-1.75,1.875,2,0,1.35,2,-1.12,1.35,1.12,-2,1.35,0,-2,1.35,2,0,.9,2,-1.12,.9,1.12,-2,.9,0,-2,.9,-.98,-1.75,1.875,-1.75,-.98,1.875,-1.75,0,1.875,-1.12,-2,1.35,-2,-1.12,1.35,-2,0,1.35,-1.12,-2,.9,-2,-1.12,.9,-2,0,.9,-1.75,.98,1.875,-.98,1.75,1.875,0,1.75,1.875,-2,1.12,1.35,-1.12,2,1.35,0,2,1.35,-2,1.12,.9,-1.12,2,.9,0,2,.9,.98,1.75,1.875,1.75,.98,1.875,1.12,2,1.35,2,1.12,1.35,1.12,2,.9,2,1.12,.9,2,0,.45,2,-1.12,.45,1.12,-2,.45,0,-2,.45,1.5,0,.225,1.5,-.84,.225,.84,-1.5,.225,0,-1.5,.225,1.5,0,.15,1.5,-.84,.15,.84,-1.5,.15,0,-1.5,.15,-1.12,-2,.45,-2,-1.12,.45,-2,0,.45,-.84,-1.5,.225,-1.5,-.84,.225,-1.5,0,.225,-.84,-1.5,.15,-1.5,-.84,.15,-1.5,0,.15,-2,1.12,.45,-1.12,2,.45,0,2,.45,-1.5,.84,.225,-.84,1.5,.225,0,1.5,.225,-1.5,.84,.15,-.84,1.5,.15,0,1.5,.15,1.12,2,.45,2,1.12,.45,.84,1.5,.225,1.5,.84,.225,.84,1.5,.15,1.5,.84,.15,-1.6,0,2.025,-1.6,-.3,2.025,-1.5,-.3,2.25,-1.5,0,2.25,-2.3,0,2.025,-2.3,-.3,2.025,-2.5,-.3,2.25,-2.5,0,2.25,-2.7,0,2.025,-2.7,-.3,2.025,-3,-.3,2.25,-3,0,2.25,-2.7,0,1.8,-2.7,-.3,1.8,-3,-.3,1.8,-3,0,1.8,-1.5,.3,2.25,-1.6,.3,2.025,-2.5,.3,2.25,-2.3,.3,2.025,-3,.3,2.25,-2.7,.3,2.025,-3,.3,1.8,-2.7,.3,1.8,-2.7,0,1.575,-2.7,-.3,1.575,-3,-.3,1.35,-3,0,1.35,-2.5,0,1.125,-2.5,-.3,1.125,-2.65,-.3,.9375,-2.65,0,.9375,-2,-.3,.9,-1.9,-.3,.6,-1.9,0,.6,-3,.3,1.35,-2.7,.3,1.575,-2.65,.3,.9375,-2.5,.3,1.125,-1.9,.3,.6,-2,.3,.9,1.7,0,1.425,1.7,-.66,1.425,1.7,-.66,.6,1.7,0,.6,2.6,0,1.425,2.6,-.66,1.425,3.1,-.66,.825,3.1,0,.825,2.3,0,2.1,2.3,-.25,2.1,2.4,-.25,2.025,2.4,0,2.025,2.7,0,2.4,2.7,-.25,2.4,3.3,-.25,2.4,3.3,0,2.4,1.7,.66,.6,1.7,.66,1.425,3.1,.66,.825,2.6,.66,1.425,2.4,.25,2.025,2.3,.25,2.1,3.3,.25,2.4,2.7,.25,2.4,2.8,0,2.475,2.8,-.25,2.475,3.525,-.25,2.49375,3.525,0,2.49375,2.9,0,2.475,2.9,-.15,2.475,3.45,-.15,2.5125,3.45,0,2.5125,2.8,0,2.4,2.8,-.15,2.4,3.2,-.15,2.4,3.2,0,2.4,3.525,.25,2.49375,2.8,.25,2.475,3.45,.15,2.5125,2.9,.15,2.475,3.2,.15,2.4,2.8,.15,2.4,0,0,3.15,.8,0,3.15,.8,-.45,3.15,.45,-.8,3.15,0,-.8,3.15,0,0,2.85,.2,0,2.7,.2,-.112,2.7,.112,-.2,2.7,0,-.2,2.7,-.45,-.8,3.15,-.8,-.45,3.15,-.8,0,3.15,-.112,-.2,2.7,-.2,-.112,2.7,-.2,0,2.7,-.8,.45,3.15,-.45,.8,3.15,0,.8,3.15,-.2,.112,2.7,-.112,.2,2.7,0,.2,2.7,.45,.8,3.15,.8,.45,3.15,.112,.2,2.7,.2,.112,2.7,.4,0,2.55,.4,-.224,2.55,.224,-.4,2.55,0,-.4,2.55,1.3,0,2.55,1.3,-.728,2.55,.728,-1.3,2.55,0,-1.3,2.55,1.3,0,2.4,1.3,-.728,2.4,.728,-1.3,2.4,0,-1.3,2.4,-.224,-.4,2.55,-.4,-.224,2.55,-.4,0,2.55,-.728,-1.3,2.55,-1.3,-.728,2.55,-1.3,0,2.55,-.728,-1.3,2.4,-1.3,-.728,2.4,-1.3,0,2.4,-.4,.224,2.55,-.224,.4,2.55,0,.4,2.55,-1.3,.728,2.55,-.728,1.3,2.55,0,1.3,2.55,-1.3,.728,2.4,-.728,1.3,2.4,0,1.3,2.4,.224,.4,2.55,.4,.224,2.55,.728,1.3,2.55,1.3,.728,2.55,.728,1.3,2.4,1.3,.728,2.4,0,0,0,1.425,0,0,1.425,.798,0,.798,1.425,0,0,1.425,0,1.5,0,.075,1.5,.84,.075,.84,1.5,.075,0,1.5,.075,-.798,1.425,0,-1.425,.798,0,-1.425,0,0,-.84,1.5,.075,-1.5,.84,.075,-1.5,0,.075,-1.425,-.798,0,-.798,-1.425,0,0,-1.425,0,-1.5,-.84,.075,-.84,-1.5,.075,0,-1.5,.075,.798,-1.425,0,1.425,-.798,0,.84,-1.5,.075,1.5,-.84,.075];super(),t=Math.max(2,Math.floor(t));const u=3.15*(s?1:1.3)/2,d=e/u;let f=r?(8*t-4)*t:0;f+=o?(16*t-4)*t:0,f+=i?40*t*t:0;const h=new Uint32Array(3*f);let p=r?4:0;p+=o?8:0,p+=i?20:0,p*=(t+1)*(t+1);const m=new Float32Array(3*p),g=new Float32Array(3*p),_=new Float32Array(2*p),A=new Ue;A.set(-1,3,-3,1,3,-6,3,0,-3,3,0,0,1,0,0,0);const y=[],b=[],E=[],x=[],w=[],L=[],C=[],P=[],D=[],Q=new N;let re,G,se,ee,ie=0,H=0;const T=new N,R=new Ue,O=new Ue,W=new pt,ae=new pt,ne=new pt,oe=new pt,F=new N,k=new N,q=A.clone();q.transpose();const j=($,B,V)=>!(m[3*$]===m[3*B]&&m[3*$+1]===m[3*B+1]&&m[3*$+2]===m[3*B+2]||m[3*$]===m[3*V]&&m[3*$+1]===m[3*V+1]&&m[3*$+2]===m[3*V+2]||m[3*B]===m[3*V]&&m[3*B+1]===m[3*V+1]&&m[3*B+2]===m[3*V+2]);for(let $=0;$<3;$++)L[$]=new Ue;const U=r?32:28,z=t+1;let v=0,M=0,S=0,I=0,J=0;for(let $=i?0:20;$<U;$++)if(o||$<20||$>=28){for(let B=0;B<3;B++){for(let V=0;V<4;V++)for(let Y=0;Y<4;Y++)y[4*Y+V]=c[3*l[16*$+4*V+Y]+B],a&&$>=20&&$<28&&B!==2&&(y[4*Y+V]*=1.077),s||B!==2||(y[4*Y+V]*=1.3);R.set(y[0],y[1],y[2],y[3],y[4],y[5],y[6],y[7],y[8],y[9],y[10],y[11],y[12],y[13],y[14],y[15]),O.multiplyMatrices(R,A),L[B].multiplyMatrices(q,O)}for(let B=0;B<=t;B++){const V=B/t;for(let Y=0;Y<=t;Y++){const le=Y/t;for(ee=4,G=se=1;ee--;)b[ee]=G,E[ee]=se,G*=V,se*=le,ee===3?(x[ee]=w[ee]=0,ie=H=1):(x[ee]=ie*(3-ee),w[ee]=H*(3-ee),ie*=V,H*=le);W.fromArray(b),ae.fromArray(E),ne.fromArray(x),oe.fromArray(w);for(let me=0;me<3;me++)re=W.clone(),re.applyMatrix4(L[me]),C[me]=re.dot(ae),re=ne.clone(),re.applyMatrix4(L[me]),P[me]=re.dot(ae),re=W.clone(),re.applyMatrix4(L[me]),D[me]=re.dot(oe);F.fromArray(P),k.fromArray(D),Q.crossVectors(k,F),Q.normalize(),C[0]===0&&C[1]===0?T.set(0,C[2]>u?1:-1,0):T.set(Q.x,Q.z,-Q.y),m[M++]=d*C[0],m[M++]=d*(C[2]-u),m[M++]=-d*C[1],g[S++]=T.x,g[S++]=T.y,g[S++]=T.z,_[I++]=1-le,_[I++]=1-V}}for(let B=0;B<t;B++)for(let V=0;V<t;V++){const Y=v*z*z+B*z+V,le=Y+1,me=le+z,fe=Y+z;j(Y,le,me)&&(h[J++]=Y,h[J++]=le,h[J++]=me),j(Y,me,fe)&&(h[J++]=Y,h[J++]=me,h[J++]=fe)}v++}this.setIndex(new Xe(h,1)),this.setAttribute("position",new Xe(m,3)),this.setAttribute("normal",new Xe(g,3)),this.setAttribute("uv",new Xe(_,2)),this.computeBoundingSphere()}}class Ih extends vP{constructor(e,t={}){const r=t.font;if(!r||!r.isFont)return console.error("v3d.TextGeometry: font parameter is not an instance of v3d.Font."),new At;t.alignX===void 0&&(t.alignX="left"),t.alignY===void 0&&(t.alignY="topBaseline"),t.lineHeight===void 0&&(t.lineHeight=-1),t.scaledEmSize===void 0&&(t.scaledEmSize=!1);const o=r.generateShapes(e,t.size,t.alignX,t.alignY,t.lineHeight,t.scaledEmSize);t.depth=t.height!==void 0?t.height:50,t.bevelThickness===void 0&&(t.bevelThickness=10),t.bevelSize===void 0&&(t.bevelSize=8),t.bevelEnabled===void 0&&(t.bevelEnabled=!1),super(o,t),this.type="TextGeometry",this.parameters={text:e,parameters:t}}cloneWithText(e){const t=this.parameters.parameters;return new Ih(e,{font:t.font,size:t.size,height:t.height,curveSegments:t.curveSegments,bevelEnabled:t.bevelEnabled,bevelThickness:t.bevelThickness,bevelSize:t.bevelSize,alignX:t.alignX,alignY:t.alignY,lineHeight:t.lineHeight,scaledEmSize:t.scaledEmSize})}}class h_e extends Nr{constructor(e){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new Ge(0),this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.fog=e.fog,this}}class Xu extends Nr{constructor(e){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Ge(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ge(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new be(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.fog=!0,this.envMapParallaxType=0,this.envMapParallaxMatrix=new Ue,this.envMapParallaxMatrixInv=new Ue,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this.fog=e.fog,this.envMapParallaxType=e.envMapParallaxType,this.envMapParallaxMatrix.copy(e.envMapParallaxMatrix),this.envMapParallaxMatrixInv.copy(e.envMapParallaxMatrixInv),this}}class ab extends Xu{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new be(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return Ht(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new Ge(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new Ge(1,1,1),this.specularColorMap=null,this._clearcoat=0,this._transmission=0,this.setValues(e)}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.ior=e.ior,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}class EP extends Nr{constructor(e){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new be(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}class O0 extends Nr{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new Ge(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ge(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new be(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this.fog=e.fog,this}}class p_e extends _r{constructor(e){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}class sb extends mh{constructor(e){super(),this.isMeshLineMaterial=!0,this.type="MeshLineMaterial",this.lineWidth=1,this.sizeAttenuation=1,this.color=new Ge(16777215),this.opacity=1,this.useMap=0,this.map=null,this.useAlphaMap=0,this.alphaMap=null,this.visibility=1,this.alphaTest=0,this.repeat=new be(1,1),this.uniforms={lineWidth:{value:1},sizeAttenuation:{value:1},color:{value:new Ge(16777215)},opacity:{value:1},useMap:{value:0},map:{value:null},alphaMap:{value:null},useAlphaMap:{value:0},visibility:{value:1},alphaTest:{value:0},repeat:{value:new be(1,1)}},this.vertexShader=Qe.raw_meshline_vert,this.fragmentShader=Qe.raw_meshline_frag,this.setValues(e)}copy(e){return super.copy(e),this.lineWidth=e.lineWidth,this.sizeAttenuation=e.sizeAttenuation,this.color.copy(e.color),this.opacity=e.opacity,this.useMap=e.useMap,this.map=e.map,this.useAlphaMap=e.useAlphaMap,this.alphaMap=e.alphaMap,this.visibility=e.visibility,this.alphaTest=e.alphaTest,this.repeat.copy(e.repeat),this}}class CP extends Nr{constructor(e){super(),this.isMeshMaskMaterial=!0,this.type="MeshMaskMaterial",this.side=2,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.lights=!1,this.cameraNearFar=null,this.depthTexture=null,this.textureMatrix=null,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,e.cameraNearFar&&(this.cameraNearFar=e.cameraNearFar.clone()),e.textureMatrix&&(this.textureMatrix=e.textureMatrix.clone()),e.depthTexture&&(this.depthTexture=e.depthTexture),this}}class qu{constructor(e,t,r,o){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=o!==void 0?o:new t.constructor(r),this.sampleValues=t,this.valueSize=r,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let r=this._cachedIndex,o=t[r],i=t[r-1];t:{e:{let a;n:{r:if(!(e<o)){for(let s=r+2;;){if(o===void 0){if(e<i)break r;return r=t.length,this._cachedIndex=r,this.copySampleValue_(r-1)}if(r===s)break;if(i=o,o=t[++r],e<o)break e}a=t.length;break n}if(e>=i)break t;{const s=t[1];e<s&&(r=2,i=s);for(let l=r-2;;){if(i===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(r===l)break;if(o=i,i=t[--r-1],e>=i)break e}a=r,r=0}}for(;r<a;){const s=r+a>>>1;e<t[s]?a=s:r=s+1}if(o=t[r],i=t[r-1],i===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(o===void 0)return r=t.length,this._cachedIndex=r,this.copySampleValue_(r-1)}this._cachedIndex=r,this.intervalChanged_(r,i,o)}return this.interpolate_(r,i,e,o)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,r=this.sampleValues,o=this.valueSize,i=e*o;for(let a=0;a!==o;++a)t[a]=r[i+a];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class lb extends qu{constructor(e,t,r,o){super(e,t,r,o)}interpolate_(e){return this.copySampleValue_(e-1)}}const SP=function(n){this.value=n,this.next=null},_s=function(){this.N=0,this.first=null};_s.prototype.push=function(n){this.first=this._push(this.first,n)},_s.prototype._push=function(n,e){if(n==null)return this.N++,new SP(e);const t=n;return this.N++,(n=new SP(e)).next=t,n},_s.prototype.pop=function(){if(this.first==null)return;const n=this.first,e=n.value;return this.first=n.next,this.N--,e},_s.prototype.size=function(){return this.N},_s.prototype.isEmpty=function(){return this.N==0},_s.prototype.peep=function(){if(this.first!=null)return this.first.value},_s.prototype.toArray=function(){const n=[];let e=this.first;for(;e!=null;)n.push(e.value),e=e.next;return n};const wP=function(n){this.value=n,this.prev=null,this.next=null},k0=function(){this.first=null,this.last=null,this.map={}};k0.prototype.push=function(n,e){this.map[e]=n,this.first===null?(this.first=n,this.last=n):(this.last.next=n,n.prev=this.last,this.last=n)},k0.prototype.removeNodeByKey=function(n){const e=this.map[n],t=e.prev,r=e.next;t!==null&&r!==null?(t.next=r,r.prev=t):t===null&&r!==null?(this.first=r,r.prev=null):t!==null&&r===null?(this.last=t,t.next=null):(this.first=null,this.last=null),delete this.map[n]};const Fn=function(n=0){this.V=n,this.adjList=[],this.nodeInfo=[],this.edges={};for(let e=0;e<n;++e)this.adjList.push([]),this.nodeInfo.push({})};Fn.prototype.removeAll=function(){this.V=0,this.adjList=[],this.nodeInfo=[],this.edges={}},Fn.prototype.addNode=function(n){n=n||{},this.V++,this.adjList.push([]),this.nodeInfo.push(n)},Fn.prototype.addNewEdge=function(n,e){this.adjList[n].push(e);const t=n+"_"+e,r=new si(n,e,0);return this.edges[t]=r,r},Fn.prototype.addEdge=function(n){const e=n.v,t=n.w;this.adjList[e].push(t);const r=e+"_"+t;this.edges[r]=n},Fn.prototype.removeEdge=function(n,e){const t=this.adjList[n];for(let o=0;o<t.length;o++)t[o]==e&&(t.splice(o,1),o--);const r=n+"_"+e;r in this.edges&&delete this.edges[r]},Fn.prototype.edge=function(n,e){const t=n+"_"+e;return t in this.edges?this.edges[t]:null},Fn.prototype.adj=function(n){return this.adjList[n]},Fn.prototype.node=function(n){return this.nodeInfo[n]},Fn.prototype.nodeIndex=function(n){for(let e=0;e<this.V;++e)if(this.nodeInfo[e]==n)return e;return-1},Fn.prototype.reverse=function(){const n=new Fn(this.V);for(let e=0;e<this.V;++e){const t=this.adjList[e];for(let r=0;r<t.length;++r){const o=t[r];n.addNewEdge(o,e)}}return n},Fn.prototype.len=function(){return this.V},Fn.prototype.findInEdges=function(n){const e=[];for(let t=0;t<this.V;t++){const r=this.adjList[t];for(let o=0;o<r.length;o++)r[o]==n&&e.push(this.edge(t,n))}return e},Fn.prototype.findOutEdges=function(n){const e=[],t=this.adjList[n];for(let r=0;r<t.length;r++)e.push(this.edge(n,t[r]));return e},Fn.prototype.disconnect=function(n,e){this.adjList[n].splice(0);for(let t=0;t<this.V;t++){const r=this.adjList[t];for(let i=0;i<r.length;i++)r[i]==n&&(r.splice(i,1),i--);let o=t+"_"+n;o in this.edges&&delete this.edges[o],o=n+"_"+t,o in this.edges&&delete this.edges[o]}if(e){const t=new Fn(this.V-1);for(let r=0;r<this.V;r++){if(r==n)continue;const o=this.adjList[r];for(let i=0;i<o.length;i++){const a=o[i],s=r>n?r-1:r,l=a>n?a-1:a,c=this.edge(r,a).copy();c.v=s,c.w=l,t.addEdge(c)}}this.V--,this.adjList=t.adjList,this.nodeInfo.splice(n,1),this.edges=t.edges}},Fn.prototype.insert=function(n,e,t,r=i=>i,o=i=>i){const i=this.V,a=n.V;for(let s=0;s<a;s++){this.adjList.push([]),this.nodeInfo.push(r(n.nodeInfo[s]));const l=n.adjList[s];for(let c=0;c<l.length;c++){const u=l[c],d=n.edge(s,u).copy(o);d.v+=i,d.w+=i,this.addEdge(d)}}this.V+=a;for(let s=0;s<e.length;s++){const l=e[s].copy(o);l.w+=i,this.addEdge(l)}for(let s=0;s<t.length;s++){const l=t[s].copy(o);l.v+=i,this.addEdge(l)}},Fn.prototype.vis=function(n){n=n||function(t,r){return String(t)};let e="digraph G {";for(let t=0;t<this.V;t++){e+=t+' [label="'+n(t,this.nodeInfo[t])+'"];';const r=this.adjList[t];for(let o=0;o<r.length;o++)e+=t+" -> "+r[o]+";"}e+="}",console.log(e)};const si=function(n,e,t=0){this.v=n,this.w=e,this.weight=t};si.prototype.either=function(){return this.v},si.prototype.other=function(n){return n==this.v?this.w:this.v},si.prototype.from=function(){return this.v},si.prototype.to=function(){return this.w},si.prototype.copy=function(n=e=>e){const e=new si(0,0,0);for(const t in this)this.hasOwnProperty(t)&&(typeof this[t]=="object"?e[t]=n(this[t]):e[t]=this[t]);return e};const Ku=function(n){this.V=n,this.adjList=[],this.nodeInfo=[];for(let e=0;e<n;++e)this.adjList.push([]),this.nodeInfo.push({})};Ku.prototype.adj=function(n){return this.adjList[n]},Ku.prototype.edge=function(n,e){const t=this.adjList[n];for(let r=0;r<t.length;++r)if(t[r].other(n)==e)return t[r];return null},Ku.prototype.node=function(n){return this.nodeInfo[n]},Ku.prototype.addNewEdge=function(n){const e=n.either(),t=n.other(e);this.adjList[e].push(n),this.adjList[t].push(n)};const cb=function(n){Ku.call(this,n)};(cb.prototype=Object.create(Ku.prototype)).addNewEdge=function(n){const e=n.from();this.adjList[e].push(n)},cb.prototype.edge=function(n,e){const t=this.adjList[n];for(let r=0;r<t.length;++r)if(t[r].other(n)==e)return t[r];return null},cb.prototype.toDiGraph=function(){const n=new Fn(this.V);for(let e=0;e<this.V;++e){const t=this.adjList[e];for(let r=0;r<t.length;++r){const o=t[r].other(e);n.addNewEdge(e,o)}}return n};const Rh=function(n,e){this.s=e;const t=n.V;this.marked=[],this.edgeTo=[];for(let r=0;r<t;++r)this.marked.push(!1),this.edgeTo.push(-1);this.dfs(n,e)};Rh.prototype.dfs=function(n,e){this.marked[e]=!0;const t=n.adj(e);for(let r=0;r<t.length;++r){const o=t[r];this.marked[o]||(this.edgeTo[o]=e,this.dfs(n,o))}},Rh.prototype.hasPathTo=function(n){return this.marked[n]},Rh.prototype.pathTo=function(n){const e=new _s;if(n==this.s)return[n];for(let t=n;t!=this.s;t=this.edgeTo[t])e.push(t);return e.push(this.s),e.toArray()};const F0=function(n){this.postOrder=new _s,this.marked=[];const e=n.V;for(let t=0;t<e;++t)this.marked.push(!1);for(let t=0;t<e;++t)this.marked[t]||this.dfs(n,t)};F0.prototype.dfs=function(n,e){this.marked[e]=!0;const t=n.adj(e);for(let r=0;r<t.length;++r){const o=t[r];this.marked[o]||this.dfs(n,o)}this.postOrder.push(e)},F0.prototype.order=function(){return this.postOrder.toArray()};var m_e=Object.freeze({__proto__:null,DepthFirstSearch:Rh,DiGraph:Fn,Edge:si,LinkMap:k0,LinkMapNode:wP,TopologicalSort:F0}),g_e=[-1.117001,-.1867262,-11.13505,12.59865,-.03937339,1.167571,.007100686,3.592678,.6083296,-1.152006,-.1926669,6.152049,-4.770802,-.08704701,.7483626,.03372718,4.464592,.4036546,-1.072371,-.2696632,.2816168,1.820571,-.3742666,2.080607,-.07675295,-2.835366,1.129329,-1.109935,-.1532764,1.198787,-.9015183,.005173015,.5749178,.1075633,4.387949,.2650413,-1.052297,-.2229452,1.952347,.5727205,-4.88507,1.984016,-.1106197,-.4898361,.8907873,-1.070108,-.1600465,1.593886,-4479251e-11,-3.306541,.9390193,.09513168,2.343583,.5335404,-1.113253,-.16996,-10.38822,11.37513,-.04040911,1.037455,.04991792,4.801919,.630271,-1.135747,-.1678594,4.970755,-4.43023,-.06657408,.3636161,.1558009,6.01337,.3959601,-1.095892,-.2732595,.7666496,1.350731,-.4401401,2.470135,-.1707929,-3.260793,1.170337,-1.073668,-.02603929,-.1944589,.4575207,.6878164,-.139077,.3690299,7.885781,.1877694,-1.070091,-.2798957,2.338478,-2.647221,-7.387808,2.32921,-.1644639,-2.00371,.9874527,-1.06712,-.1418866,1.25409,6.053048,-2.918892,.5322812,.1613053,3.018161,.527409,-1.129483,-.1890619,-9.065101,9.659923,-.03607819,.8314359,.08181661,4.768868,.6339777,-1.14642,-.1883579,3.309173,-3.127882,-.06938176,.3987113,.1400581,6.283042,.5267076,-1.128348,-.2641305,1.223176,.05514952,-.3490649,1.997784,-.04123709,-2.251251,.9483466,-1.02582,.0140469,-1.187406,2.7299,.5877588,-.276114,.4602633,8.305125,.3945001,-1.083957,-.2606679,2.207108,-7.202803,-5.968103,2.129455,-.07789512,-1.137688,.8871769,-1.062465,-.1512189,1.042881,14.27839,-4.242214,.40381,.199778,2.814449,.5803196,-1.175099,-.2410789,-11.08587,11.33404,-.018193,.6772942,.09605043,4.231166,.6239972,-1.224207,-.2883527,3.002206,-2.649612,-.04795418,.4984398,.03251434,4.851611,.6551019,-1.136955,-.2423048,1.058823,-.2489236,-.2462179,1.93314,.09106828,-.1905869,.8171065,-1.014535,-.0082625,-1.448017,2.295788,.3510334,-1.477418,.5432449,5.762796,.4908751,-1.070666,-.237978,1.844589,-5.442448,-4.012768,2.945275,.009854725,.08455959,.814503,-1.071525,-.1777132,.807659,9.925865,-3.324623,-.6367437,.2844581,2.248384,.6544022,-1.218818,-.2952382,-13.45975,13.47153,-.006814585,.5079068,.119723,3.776949,.5836961,-1.409868,-.511433,2.776539,-2.039001,-.02673769,.4145288,.0007829342,2.275883,.6629691,-1.069151,-.09434247,.7293972,-1.222473,-.1533461,2.160357,.04626837,3.852415,.859357,-1.021306,-.1149551,-1.108414,4.178343,.4013665,-2.222814,.6929462,1.392652,.4401662,-1.074251,-.2224002,1.372356,-8.858704,-3.92266,3.020018,-.01458724,1.511186,.8288064,-1.062048,-.1526582,.4921067,14.85522,-3.229936,-.8426604,.3916243,2.678994,.6689264,-1.257023,-.33647,-15.27795,15.04223,.002717715,.302991,.1636851,3.561663,.5283161,-1.635124,-.7329993,3.523939,-2.566337,-.01902543,.5505483,-.06242176,1.065992,.6654236,-.9295823,.04845834,-.299299,-.2001327,-.08019339,1.807806,.09020277,5.095372,.8639936,-1.09374,-.2148608,-.521624,2.119777,.09506454,-1.831439,.6961204,.1102084,.4384319,-1.044181,-.1849257,.9071246,-4.648901,-2.279385,2.356502,-.04169147,1.932557,.829655,-1.061451,-.1458745,.2952267,8.967214,-3.726228,-.5022316,.5684877,3.102347,.6658443,-1.332391,-.4127769,-9.328643,9.046194,.003457775,.3377425,.1530909,3.301209,.4997917,-1.932002,-.9947777,-2.042329,3.58694,-.05642182,.8130478,-.08195988,.1118294,.5617231,-.8707374,.1286999,1.820054,-4.674706,.003317471,.5919018,.1975278,6.686519,.9631727,-1.070378,-.3030579,-.9041938,6.200201,.1232207,-.3650628,.5029403,-2.903162,.3811408,-1.063035,-.1637545,.5853072,-7.889906,-1.200641,1.035018,.1192093,3.267054,.8416151,-1.053655,-.1562286,.2423683,11.28575,-4.363262,-.0731416,.5642088,2.514023,.6670457,-1.366112,-.4718287,-7.876222,7.7469,-.009182309,.4716076,.08320252,3.165603,.5392334,-2.468204,-1.33634,-5.386723,7.072672,-.08329266,.8636876,-.01978177,-.1326218,.2979222,-.9653522,-.02373416,1.81025,-6.467262,.1410706,-.4753717,.3003095,6.551163,1.151083,-.8943186,-.2487152,-.230896,8.512648,.1298402,1.034705,.2303509,-3.924095,.2982717,-1.146999,-.2318784,.08992419,-9.933614,-.886092,-.03071656,.2852012,3.046199,.8599001,-1.032399,-.1645145,.2683599,13.27701,-4.40767,.07709869,.4951727,1.957277,.6630943,-1.46907,-.6135092,-6.506263,6.661315,-.03835383,.7150413,.007784318,2.820577,.6756784,-2.501583,-1.247404,-15.23462,16.33191,-.01204803,.5896471,-.02002023,1.144647,.06177874,-2.438672,-1.127291,5.731172,-10.2135,.0616561,-.7752641,.4708254,4.176847,1.200881,-.1513427,.09792731,-1.612349,9.814289,.05188921,1.716403,-.07039255,-2.815115,.3291874,-1.318511,-.3650554,.4221268,-9.294529,-.0439752,-.8100625,.3742719,1.834166,.822345,-1.016009,-.1820264,.1278426,11.82696,-4.801528,.4947899,.4660378,1.601254,.6702359,-1.84131,-.9781779,-4.610903,4.824662,-.05100806,.6463776,-6377724e-12,2.216875,.861853,-2.376373,-1.108657,-14.89799,15.46458,.04091025,.0976178,-.01048958,2.165834,-.1609171,-4.710318,-2.261963,6.947327,-10.34828,-.1325542,.7508674,.2247553,2.873142,1.2971,.216375,-.1944345,-2.43786,10.11314,.44505,.3111492,.2751323,-1.627906,.2531213,-1.258794,-.3524641,.8425444,-10.85313,-1.154381,-.4638014,-.002781115,.4344498,.8507091,-1.018938,-.1804153,-.06354054,15.7315,-4.386999,.6211115,.5294648,1.580749,.6586655,-1.116416,-.1917524,-10.68233,12.22221,-.03668978,1.054022,.01592132,3.180583,.562737,-1.132341,-.1671286,5.976499,-4.227366,-.09542489,.8664938,.008351793,4.876068,.4492779,-1.087635,-.3173679,.4314407,1.100555,-.4410057,1.677253,-.03005925,-4.201249,1.070902,-1.083031,-.08847705,1.291773,.4546776,.3091894,.726176,.04203659,5.990615,.3704756,-1.057899,-.2246706,2.329563,-1.219656,-5.33526,.8545378,-.03906209,-.9025499,.7797348,-1.073305,-.1522553,1.767063,1.90428,-3.101673,.3995856,.02905192,2.563977,.5753067,-1.113674,-.1759694,-9.754125,10.87391,-.03841093,.9524272,.05680219,4.227034,.6029571,-1.126496,-.1680281,5.332352,-4.575579,-.06761755,.3295335,.1194896,5.570901,.4536185,-1.103074,-.2681801,.06571479,2.396522,-.455128,2.466331,-.1232022,-3.023201,1.086379,-1.053299,-.02697173,.8379121,-.9681458,.5890692,-.4872027,.2936929,7.510139,.3079122,-1.079553,-.2710448,2.462379,-.3713554,-8.534512,1.828242,-.1686398,-1.96134,.8941077,-1.069741,-.1396394,1.657868,3.236313,-2.706344,-.2948122,.1314816,2.868457,.5413403,-1.131649,-.1954455,-7.751595,8.685861,-.04910871,.8992952,.04710143,4.254818,.6821116,-1.156689,-.1884324,3.163519,-3.091522,-.06613927,-.02575883,.1640065,6.073643,.4453468,-1.079224,-.2621389,.9446437,1.448479,-.3969384,2.626638,-.08101186,-3.016355,1.076295,-1.080832,.01033057,-.3500156,-.03281419,.5655512,-1.156742,.453471,8.774122,.2772869,-1.051202,-.2679975,2.719109,-2.190316,-6.878798,2.250481,-.2030252,-2.026527,.9701096,-1.089849,-.1598589,1.564748,6.869187,-3.05367,-.6110435,.1644472,2.370452,.551177,-1.171419,-.2429746,-8.991334,9.571216,-.02772861,.6688262,.07683478,3.785611,.6347635,-1.228554,-.2917562,2.753986,-2.49178,-.04663434,.3118303,.07546506,4.463096,.5955071,-1.093124,-.2447767,.9097406,.5448296,-.2957824,2.024167,-.0005152333,-1.069081,.9369565,-1.056994,.01569507,-.8217491,1.870818,.706193,-1.483928,.5978206,6.864902,.3673332,-1.054871,-.2758129,2.712807,-5.95011,-6.554039,2.447523,-.1895171,-1.454292,.9131738,-1.100218,-.1746241,1.438505,11.15481,-3.266076,-.8837357,.19701,1.991595,.5907821,-1.207267,-.291361,-11.03767,11.40724,-.014168,.5564047,.08476262,3.371255,.6221335,-1.429698,-.5374218,2.837524,-2.221936,-.02422337,.09313758,.0719025,1.869022,.5609035,-1.002274,-.0697281,.4031308,-.3932997,-.1521923,2.390646,-.0689399,2.999661,1.017843,-1.081168,-.1178666,-.496808,3.919299,.6046866,-2.440615,.7891538,2.140835,.274047,-1.050727,-.2307688,2.276396,-9.454407,-5.505176,2.99262,-.2450942,.6078372,.9606765,-1.103752,-.1810202,1.375044,15.89095,-3.438954,-1.265669,.2475172,1.680768,.5978056,-1.244324,-.3378542,-11.11001,11.37784,-.007896794,.4808023,.09249904,3.025816,.5880239,-1.593165,-.7027621,2.220896,-1.437709,-.01534738,.06286958,.06644555,1.091727,.547008,-.9136506,.01344874,.7772636,-1.209396,-.1408978,2.433718,-.1041938,3.791244,1.037916,-1.134968,-.1803315,-.9267335,4.57667,.6851928,-2.805,.8687208,1.161483,.2571688,-1.017037,-.2053943,2.36164,-9.887818,-5.122889,3.287088,-.2594102,.8578927,.959234,-1.118723,-.1934942,1.226023,16.7414,-3.277335,-1.629809,.2765232,1.637713,.6113963,-1.314779,-.4119915,-12.4115,12.41578,.002344284,.2980837,.1414613,2.781731,.4998556,-1.926199,-1.020038,2.5692,-1.081159,-.02266833,.3588668,.008750078,-.2452171,.4796758,-.7780002,.1850647,.04445456,-2.409297,-.07816346,1.54679,-.02807227,5.998176,1.132396,-1.179326,-.357833,-.2392933,6.467883,.5904596,-1.869975,.8045839,-2.498121,.1610633,-1.009956,-.1311896,1.726577,-12.19356,-3.466239,2.343602,-.2252205,2.573681,1.027109,-1.11246,-.2063093,1.233051,20.58946,-4.578074,-1.145643,.3160192,1.420159,.5860212,-1.371689,-.4914196,-10.7661,11.07405,-.01485077,.5936218,.03685482,2.599968,.6002204,-2.436997,-1.377939,.02130141,1.079593,-.01796232,-.03933248,.1610711,-.6901181,.1206416,-.8743368,.0733137,.8734259,-3.743126,-.03151167,1.297596,-.07634926,6.532873,1.435737,-.9810197,-.3521634,-.2855205,7.134674,.6839748,-1.394841,.6952036,-4.633104,-.02173401,-1.122958,-.1691536,1.38236,-11.02913,-2.608171,1.865111,-.1345154,3.112342,1.094134,-1.075586,-.2077415,1.171477,17.9327,-4.656858,-1.036839,.3338295,1.042793,.5739374,-1.465871,-.6364486,-8.833718,9.34365,-.032236,.7552848,-3121341e-12,2.249164,.8094662,-2.448924,-1.270878,-4.823703,5.853058,-.02149127,.03581132,-.001230276,.4892553,-.1597657,-2.419809,-1.071337,1.575648,-4.98358,.009545185,.5032615,.4186266,4.634147,1.433517,-.1383278,-.02797095,-.1943067,6.679623,.411828,-.2744289,-.02118722,-4.337025,.1505072,-1.341872,-.2518572,1.027009,-6.527103,-1.081271,1.015465,.2845789,2.470371,.927812,-1.04064,-.2367454,1.100744,8.827253,-4.560794,-.7287017,.2842503,.6336593,.6327335,-1.877993,-1.025135,-4.311037,4.715016,-.04711631,.6335844,-7665398e-12,1.788017,.9001409,-2.28154,-1.137668,-10.36869,11.36254,.01961739,-.09836174,-.006734567,1.320918,-.2400807,-4.904054,-2.315781,5.735999,-8.626257,-.1255643,1.545446,.139686,2.972897,1.429934,.4077067,-.1833688,-2.450939,9.119433,.4505361,-1.340828,.397369,-1.78537,.09628711,-1.296052,-.3250526,1.813294,-10.31485,-1.38869,1.239733,-.08989196,-.3389637,.963956,-1.062181,-.2423444,.7577592,15.66938,-4.462264,-.574281,.3262259,.9461672,.6232887],__e=[-1.127942,-.1905548,-12.52356,13.75799,-.03624732,1.055453,.01385036,4.17697,.5928345,-1.15526,-.1778135,6.216056,-5.254116,-.08787445,.8434621,.04025734,6.195322,.3111856,-1.125624,-.3217593,.5043919,1.686284,-.3536071,1.476321,-.07899019,-4.522531,1.271691,-1.081801,-.1033234,.999555,.007482946,-.06776018,1.463141,.09492021,5.612723,.1298846,-1.07532,-.2402711,2.141284,-1.203359,-4.945188,1.437221,-.0809675,-1.028378,1.004164,-1.073337,-.1516517,1.639379,2.304669,-3.214244,1.286245,.05613957,2.480902,.4999363,-1.128399,-.1857793,-10.89863,11.72984,-.03768099,.9439285,.04869335,4.845114,.6119211,-1.114002,-.139928,4.9638,-4.6855,-.07780879,.4049736,.1586297,7.770264,.3449006,-1.185472,-.3403543,.6588322,1.133713,-.4118674,2.061191,-.1882768,-4.372586,1.22353,-1.002272,.02000703,.07073269,1.485075,.5005589,.4301494,.3626541,7.921098,.1574766,-1.121006,-.3007777,2.242051,-4.571561,-7.761071,2.053404,-.1524018,-1.886162,1.018208,-1.058864,-.1358673,1.389667,8.633409,-3.437249,.7295429,.15147,2.842513,.5014325,-1.144464,-.2043799,-10.20188,10.71247,-.03256693,.7860205,.06872719,4.824771,.6259836,-1.170104,-.2118626,4.391405,-4.1989,-.07111559,.3890442,.1024831,6.282535,.5365688,-1.129171,-.255288,.2238298,.7314295,-.356273,1.881931,-.03078716,-1.03912,.9096301,-1.042294,.004450203,-.5116033,2.627589,.6098996,-.1264638,.4325281,7.080503,.4583646,-1.082293,-.2723056,2.065076,-8.143133,-7.892212,2.142231,-.0710624,-1.122398,.8338505,-1.071715,-.1426568,1.095351,17.29783,-3.851931,.4360514,.211444,2.970832,.5944389,-1.195909,-.2590449,-11.91037,12.07947,-.01589842,.6297846,.09054772,4.285959,.5933752,-1.245763,-.3316637,4.29366,-3.694011,-.04699947,.4843684,.02130425,4.097549,.6530809,-1.148742,-.1902509,-.2393233,-.2441254,-.2610918,1.846988,.03532866,2.660106,.8358294,-1.01608,-.0744496,-.5053436,4.388855,.6054987,-1.2083,.5817215,2.54357,.4726568,-1.072027,-.210144,1.518378,-10.60119,-6.016546,2.649475,-.05166992,1.571269,.8344622,-1.072365,-.1511201,.747801,19.00732,-3.950387,-.3473907,.3797211,2.782949,.6296808,-1.239423,-.3136289,-13.511,13.49468,-.007070423,.5012315,.1106008,3.803619,.5577948,-1.452524,-.5676944,2.993153,-2.277288,-.02168954,.305672,.01152338,1.852697,.6427228,-1.061421,-.04590521,.6057022,-1.096835,-.1504952,2.344921,-.05491832,5.268322,.9082253,-1.042373,-.1769498,-1.075388,3.831712,.315414,-2.416458,.7909032,-.01492892,.3854049,-1.064159,-.1892684,1.438685,-8.166362,-3.616364,3.275206,-.1203825,2.039491,.8688057,-1.07012,-.1569508,.412476,13.99683,-3.547085,-1.046326,.4973825,2.791231,.6503286,-1.283579,-.3609518,-13.35397,13.15248,-.0004431938,.3769526,.1429824,3.573613,.4998696,-1.657952,-.7627948,1.958222,-.7949816,-.02882837,.5356149,-.05191946,.8869955,.626332,-.95276,.06494189,.5361303,-2.12959,-.0925863,1.604776,.0506777,6.376055,.9138052,-1.080827,-.252312,-.7154262,4.120085,.1878228,-1.492158,.6881655,-1.446611,.4040631,-1.054075,-.1665498,.9191052,-6.636943,-1.894826,2.10781,-.03680499,2.655452,.841384,-1.061127,-.1448849,.2667493,10.34103,-4.285769,-.3874504,.5998752,3.132426,.6652753,-1.347345,-.4287832,-9.305553,9.133813,-.003173527,.3977564,.115142,3.320564,.4998134,-1.927296,-.9901372,-2.593499,4.087421,-.05833993,.8158929,-.04681279,.2423716,.4938052,-.9470092,.07325237,2.064735,-5.16754,-.01313751,.4832169,.1126295,6.970522,1.035022,-1.022557,-.2762616,-.9375748,6.696739,.2200765,-.1133253,.5492505,-3.109391,.3321914,-1.087444,-.1836263,.6225024,-8.576765,-1.107637,.7859427,.09910909,3.112938,.8596261,-1.051544,-.1546262,.2371731,12.00502,-4.527291,.07268862,.5571478,2.532873,.6662,-1.375576,-.4840019,-8.12129,8.05814,-.01445661,.5123314,.05813321,3.203219,.5442318,-2.325221,-1.241463,-7.06343,8.741369,-.0782995,.8844273,-.03471106,.1740583,.2814079,-1.2287,-.2013412,2.949042,-7.371945,.1071753,-.249197,.2265223,6.391504,1.172389,-.7601786,-.1680631,-.7584444,8.541356,.08222291,.6729633,.3206615,-3.70094,.2710054,-1.191166,-.2672347,.2927498,-9.713613,-.4783721,.2352803,.2161949,2.691481,.8745447,-1.030135,-.1653301,.2263443,12.96157,-4.650644,.007055709,.5091975,2.00037,.6603839,-1.508018,-.6460933,-6.402745,6.545995,-.0375032,.6921803,.003309819,2.797527,.6978446,-2.333308,-1.167837,-17.46787,18.6863,-.008948229,.5621946,-.03402626,1.217943,.01149865,-2.665953,-1.226307,7.169725,-11.59434,.0358342,-.3074378,.3412248,4.422122,1.283791,-.09705116,.08312991,-2.160462,10.28235,.03543357,1.032049,.105831,-2.972898,.2418628,-1.329617,-.3699557,.5560117,-9.730113,.09938865,-.3071488,.2510691,1.777111,.8705142,-1.019387,-.1893247,.1194079,12.39436,-4.799224,.2940213,.4841268,1.529724,.6582615,-1.896737,-1.005442,-6.411032,6.54822,-.03227596,.5717262,-8115192e-12,2.296704,.9000749,-2.411116,-1.225587,-17.53629,18.29393,.01247555,.2364616,-.005114637,1.603778,-.2224156,-4.707121,-2.074977,7.9423,-11.32407,-.05415654,.5446811,.1032493,4.010235,1.369802,.1010482,-.4013305,-2.674579,9.779409,.1782506,.7053045,.4200002,-2.400671,.1953165,-1.243526,-.3391255,.8848882,-9.789025,-.3997324,-.9546227,-.1044017,.6010593,.8714462,-1.014633,-.1730009,-.07738934,13.90903,-4.847307,1.076059,.5685743,1.572992,.6561432,-1.122998,-.1881183,-10.30709,11.58932,-.04079495,.9603774,.03079436,4.009235,.5060745,-1.13479,-.1539688,5.478405,-4.21727,-.1043858,.7165008,.01524765,6.473623,.4207882,-1.134957,-.3513318,.7393837,1.354415,-.4764078,1.690441,-.0549264,-5.563523,1.145743,-1.058344,-.05758503,1.16823,.3269824,.1795193,.7849011,.07441853,6.904804,.281879,-1.075194,-.2355813,2.463685,-1.536505,-7.505771,.9619712,-.06465851,-1.355492,.8489847,-1.07903,-.1465328,1.773838,2.310131,-3.136065,.3507952,.04435014,2.819225,.5689008,-1.125833,-.1870849,-9.555833,10.59713,-.04225402,.9164663,.04338796,4.40098,.6056119,-1.12744,-.1551891,4.755621,-4.408806,-.07851763,.2268284,.146007,7.048003,.3525997,-1.143788,-.3170178,.5480669,2.04183,-.4532139,2.302233,-.1887419,-4.489221,1.250967,-1.032849,.007376031,.5666073,-.2312203,.4862894,-.1748294,.357287,8.380522,.1302333,-1.093728,-.2786977,2.641272,-1.507494,-8.731243,1.684055,-.2023377,-2.176398,1.013249,-1.076578,-.1456205,1.693935,2.945003,-2.822673,-.2520033,.1517034,2.649109,.5179094,-1.146417,-.2119353,-7.187525,8.058599,-.05256438,.8375733,.03887093,4.222111,.6695347,-1.173674,-.2067025,2.899359,-2.804918,-.08473899,.003944225,.1340641,6.160887,.4527141,-1.090098,-.2599633,.9180856,1.09271,-.4215019,2.42766,-.09277667,-2.123523,1.058159,-1.08446,.008056181,-.245351,.6619567,.4668118,-.9526719,.4648454,8.001572,.3054194,-1.053728,-.2765784,2.792388,-3.489517,-8.150535,2.195757,-.2017234,-2.128017,.9326589,-1.099348,-.1593939,1.568292,7.247853,-2.933,-.5890481,.172444,2.433484,.5736558,-1.185983,-.2581184,-7.761056,8.317053,-.03351773,.6676667,.05941733,3.820727,.6324032,-1.268591,-.3398067,2.348503,-2.023779,-.05368458,.1083282,.08402858,3.910254,.5577481,-1.071353,-.1992459,.7878387,.1974702,-.3033058,2.335298,-.08205259,.7954454,.9972312,-1.089513,-.03104364,-.5995746,2.330281,.6581939,-1.821467,.6679973,5.090195,.3125161,-1.040214,-.2570934,2.660489,-6.506045,-7.053586,2.763153,-.2433632,-.7648176,.9452937,-1.116052,-.1831993,1.457694,11.63608,-3.216426,-1.045594,.2285002,1.817407,.5810396,-1.230134,-.3136264,-8.909301,9.145006,-.01055387,.4467317,.1016826,3.342964,.563384,-1.442907,-.5593147,2.156447,-1.241657,-.0351213,.3050274,.01797175,1.742358,.5977153,-1.027627,-.06481539,.4351975,-1.051677,-.2030672,1.942684,-.03615993,4.050266,.9801624,-1.08211,-.1578209,-.3397511,4.163851,.6650368,-1.84173,.7062544,.6789881,.3172623,-1.047447,-.197756,2.183364,-8.805249,-5.483962,2.551309,-.177964,1.519501,.9212536,-1.111853,-.1935736,1.394408,13.92405,-3.46543,-1.068432,.2388671,1.455336,.6233425,-1.262238,-.3546341,-10.08703,10.20084,-.001852187,.353758,.1239199,3.056093,.5132052,-1.61381,-.7355585,2.760123,-1.685253,-.02517552,.2914258,.004743448,.8689596,.5674192,-.9462336,.02950767,-.2613816,-.7398653,-.1315558,1.901042,-.06447844,4.969341,1.027342,-1.111481,-.2194054,-.09004538,3.983442,.4871278,-1.965315,.7956121,-.2363225,.2718037,-1.036397,-.1827106,1.964747,-8.870759,-4.208011,2.461215,-.2158905,1.561676,.9436866,-1.113769,-.1947819,1.30072,15.16476,-4.088732,-1.069384,.2836434,1.671451,.6229612,-1.328069,-.4244047,-8.41704,8.552244,-.006813504,.4127422,.09619897,2.854227,.505988,-1.927552,-1.02529,.9529576,.425595,-.03738779,.2584586,.04911004,-.2640913,.4138626,-.8488094,.1435988,.6356807,-2.895732,-.08473961,1.701305,-.1323908,6.499338,1.210928,-1.128313,-.3397048,-.404314,6.265097,.5482395,-2.057614,.8884087,-2.943879,.09760301,-1.039764,-.1494772,1.781915,-11.53012,-3.379232,2.517231,-.2764393,2.588849,1.05212,-1.108447,-.2012251,1.19864,19.25331,-4.423892,-1.257122,.339569,1.48122,.5880175,-1.374185,-.4967434,-7.401318,7.724021,-.02345723,.5979653,.02436346,2.65897,.6014891,-2.310933,-1.29029,-1.301909,2.557806,-.03744449,.08982861,.1090613,-.4398363,.1184329,-1.12473,-.0992183,1.366902,-4.172489,-.05078016,1.393597,-.09323843,6.452721,1.435913,-.8468477,-.2744819,-.43472,6.713362,.6127133,-1.685634,.7360941,-4.535502,-.02920866,-1.165242,-.2008697,1.438778,-10.08936,-2.214771,2.102909,-.1763085,2.859075,1.09347,-1.074614,-.2066374,1.131891,16.30063,-4.801441,-1.11259,.3595785,1.122227,.579461,-1.521515,-.6835604,-5.571044,6.028774,-.04253715,.6875746,-5279456e-12,2.18015,.8487705,-2.240415,-1.171166,-7.182771,8.417068,-.01932866,.1101887,-.01098862,.6242195,-.2393875,-2.712354,-1.19883,3.1802,-6.76813,-.002563386,.7984607,.2764376,4.695358,1.557045,-.03655172,-.02142321,-.913812,7.932786,.3516542,-.7994343,.1786761,-4.208399,.01820576,-1.36861,-.2656212,1.249397,-8.317818,-.8962772,1.423249,.1478381,2.19166,1.007748,-1.041753,-.2453366,1.061102,11.30172,-4.739312,-.9223334,.2982776,.6162931,.6080302,-1.989159,-1.09516,-2.91555,3.275339,-.05735765,.5742174,-7683288e-12,1.7634,.9001342,-2.07002,-1.086338,-10.95898,12.0696,.03780123,-.01774699,-.0005881348,1.333819,-.2605423,-5.249653,-2.38304,6.160406,-9.097138,-.1955319,1.651785,.0006016463,3.021824,1.493574,.4685432,-.2358662,-2.666433,9.685763,.5804928,-1.521875,.5668989,-1.548136,.01688642,-1.296891,-.3449031,1.928548,-11.6756,-1.627615,1.355603,-.1929074,-.6568952,1.009774,-1.067288,-.2410392,.7147961,17.8384,-4.374399,-.6588777,.3329831,1.012066,.6118645],v_e=[-1.310023,-.4407658,-36.4034,36.83292,-.008124762,.5297961,.01188633,3.13832,.5134778,-1.4241,-.5501606,-17.5351,18.22769,-.01539272,.6366826,.002661996,2.659915,.4071138,-1.103436,-.1884105,6.425322,-6.910579,-.02019861,.3553271,-.01589061,5.345985,.8790218,-1.1862,-.4307514,-3.957947,5.979352,-.05348869,1.736117,.03491346,-2.692261,.5610506,-1.006038,-.1305995,4.473513,-3.806719,.1419407,-.02148238,-.05081185,3.735362,.535828,-1.078507,-.1633754,-3.812368,4.3817,.02988122,1.754224,.1472376,3.722798,.4999157,-1.333582,-.4649908,-33.59528,34.04375,-.009384242,.5587511,.00572631,3.073145,.5425529,-1.562624,-.7107068,-14.7817,15.59839,-.01462375,.5050133,.02516017,1.604696,.2902403,-.8930158,.04068077,1.373481,-2.342752,-.02098058,.6248686,-.05258363,7.058214,1.150373,-1.262823,-.4818353,889261e-9,1.92312,-.04979718,1.040693,.1558103,-2.85248,.2420691,-.9968383,-.1200648,1.324342,-.9430889,.1931098,.4436916,-.07320456,4.215931,.7898019,-1.078185,-.1718192,-1.720191,2.358918,.02765637,1.260245,.2021941,3.395483,.5173628,-1.353023,-.4813523,-31.0492,31.40156,-.009510741,.554203,.008135471,3.136646,.5215989,-1.624704,-.7990201,-21.67125,22.46341,-.01163533,.5415746,.02618378,1.139214,.3444357,-.798361,.1417476,9.914841,-10.81503,-.01218845,.3411392,-.06137698,7.445848,1.18008,-1.266679,-.4288977,-5.818701,6.986437,-.08180711,1.397403,.2016916,-1.275731,.2592773,-1.009707,-.1537754,3.496378,-3.013726,.242115,-.2831925,.03003395,3.702862,.774632,-1.075646,-.1768747,-1.347762,1.989004,.01375836,1.76481,.1330018,3.230864,.662621,-1.375269,-.5103569,-34.42661,34.78703,-.008460009,.5408643,.004813323,3.016078,.5062069,-1.821679,-.9766461,-19.26488,19.97912,-.009822567,.3649556,.04316092,.893019,.4166527,-.6633542,.1997841,2.395592,-3.117175,-.01080884,.8983814,-.1375825,6.673463,1.115663,-1.30324,-.3612712,.08292959,.3381364,-.06078648,.3229247,.3680987,.7046755,.3144924,-.9952598,-.2039076,.4026851,.2686684,.1640712,.5186341,-.0120552,2.659613,.8030394,-1.098579,-.2151992,.6558198,-74369e-8,-.001421817,1.073701,.1886875,2.536857,.6673923,-1.457986,-.5906842,-38.12464,38.38539,-.006024357,.4741484,.01209223,2.818432,.5012433,-1.835728,-1.003405,-6.848129,7.601943,-.01277375,.4785598,.03366853,1.097701,.4636635,-.8491348,.009466365,-2.685226,2.00406,-.01168708,.6752316,-.1543371,5.674759,1.039534,-1.083379,-.150679,.7328236,-.5095568,-.08609153,.444882,.4174662,1.481556,.3942551,-1.117089,-.3337605,.2502281,.4036323,.2673899,.2829817,.0224245,2.043207,.7706902,-1.071648,-.21262,.6069466,-.00145629,-.551596,1.046755,.1985021,2.290245,.6876058,-1.483903,-.6309647,-43.80213,44.10537,-.005712161,.5195992,.002028428,2.687114,.5098321,-2.053976,-1.141473,.5109183,.08060391,-.01033983,.4066532,.04869627,1.161722,.4039525,-.6348185,.07651292,-10.31327,10.07598,-.02083688,.7359516,-.2029459,5.013257,1.077649,-1.22863,-.1650496,.04077157,-.7189167,-.0509222,.2959814,.5111496,2.540433,.361533,-1.041883,-.3278413,-.06691911,1.307364,.2166663,.3000595,-.003157136,1.389208,.7999026,-1.103556,-.2443602,.4705347,-.0009296482,-.530992,.9654511,.2142587,2.244723,.6839976,-1.555684,-.6962113,-46.47983,46.7427,-.005034895,.475509,-9502561e-13,2.626569,.5056194,-1.998288,-1.12472,-1.629586,2.187993,-.008284384,.3845258,.0572624,1.185644,.4255812,-1.03257,-.251385,-3.721112,3.506967,-.02186561,.9436049,-.2451412,4.725724,1.039256,-.8597532,.09073332,-2.553741,1.993237,-.04390891,-.2046928,.5515623,1.909127,.3948212,-1.210482,-.4477622,-.2267805,1.219488,.1336186,.6866897,.02808997,1.600403,.7816409,-1.078168,-.2699261,.2537282,.3820684,-.4425103,.5298235,.2185217,1.728679,.6882743,-1.697968,-.8391488,-57.90105,58.1412,-.00340476,.426514,-1796301e-12,2.368442,.5324429,-2.141552,-1.17223,16.77872,-16.4147,-.005732425,.2002199,.06841834,1.485338,.3215763,-1.442946,-.7264245,-9.503706,9.650462,-.02120995,1.419263,-.2893098,3.860731,1.120857,-.5696752,.3411279,-.2931035,-.6512552,-.1068437,-1.085661,.6107549,1.459503,.3210336,-1.313839,-.5921371,-.2332222,1.648196,.2492787,1.381033,-.01993392,.981256,.8316329,-1.087464,-.3195534,.2902095,.3383709,-.8798482,.01494668,.2529703,1.452644,.669387,-2.068582,-1.118605,-50.81598,50.97486,-.003280669,.4067371,-2544951e-12,2.179497,.5778017,-1.744693,-.8537207,22.34361,-22.08318,-.005932616,.1035049,.05742772,1.97788,.2124846,-3.287515,-2.140268,-12.49566,12.40091,-.02409349,1.397821,-.2371627,2.771192,1.170496,.5502311,1.04663,2.193517,-2.2204,-.1064394,-1.017926,.4795457,1.030644,.3177516,-1.719734,-.9536198,-.6586821,1.386361,-.02513065,1.187011,.06542539,.5296055,.808266,-1.0057,-.3028096,.04470957,1.00776,-.8119016,.03153338,.2311321,1.182208,.6824758,-2.728867,-1.580388,-30.79627,30.92586,-.004197673,.3154759,-3897675e-12,1.920567,.6664791,-1.322495,-.7249275,14.7766,-14.68154,-.009044857,.05624314,.06498392,2.047389,.0636754,-6.102376,-3.473018,-9.926071,9.637797,-.01097909,1.103498,-.2424521,2.520748,1.24026,1.351796,1.018588,2.009081,-1.333394,-.1979125,-.3318292,.4476624,.9095235,.2955611,-1.774467,-1.07988,-.0808468,.2577697,-.1149295,.4975303,.002931611,-.3803171,.8002794,-.9898401,-.2542513,-.07530911,1.870355,-1.521918,.2405164,.2964615,1.3348,.6789053,-1.27973,-.4290674,-42.77972,43.43305,-.006541826,.4945086,.01425338,2.685244,.5011313,-1.449506,-.5766374,-16.88496,17.81118,-.01121649,.354502,.02287338,1.904281,.4936998,-1.02198,-.1897574,2.482462,-2.941725,-.01570448,.7532578,-.042568,5.23966,.4983116,-1.162608,-.3428049,3.974358,-1.527935,-.03919201,.8758593,.07291363,-3.455257,.8007426,-.9929985,-.08712006,-.7397313,1.348372,.09511685,.3233584,-.07549148,5.806452,.4990042,-1.084996,-.1739767,.1580475,.908818,.06871433,.5933079,.1188921,3.074079,.4999327,-1.317009,-.4661946,-42.55347,43.12782,-.005727235,.4285447,.02189854,2.60831,.51907,-1.469236,-.6282139,-12.41404,13.48765,-.0120477,.5070285,-.0007280216,1.491533,.3635064,-.9713808,-.08138038,.3709854,-1.041174,-.01814075,.506086,-.02053756,6.161431,1.093736,-1.159057,-.3698074,2.711209,-.6006479,-.04896926,.9273957,.1137712,-3.496828,.2867109,-1.011601,-.0820189,.2105725,.459752,.1478925,.213894,-.0566067,6.057755,.7859121,-1.07802,-.181158,.1646622,.8348426,.1149064,.4985738,.1376605,2.746607,.4999626,-1.325672,-.4769313,-41.11215,41.68293,-.006274997,.4649469,.01119411,2.631267,.5234546,-1.619391,-.8000253,-15.34098,16.32706,-.01012023,.4242255,.02931597,.8925807,.3314765,-.7356979,.1368406,2.972579,-3.535359,-.01318948,.460762,-.07182778,6.2541,1.236299,-1.316217,-.4194427,.03489902,1.289849,-.0475596,1.138222,.1975992,-.8991542,.2290572,-.9502188,-.1172703,1.405202,-.3061919,.1058772,-.3760592,-.01983179,3.562353,.7895959,-1.100117,-.1900567,.492503,.5250225,.1576804,1.042701,.07330743,2.796064,.6749783,-1.354183,-.5130625,-42.19268,42.71772,-.005365373,.4136743,.01235172,2.520122,.5187269,-1.741434,-.9589761,-8.230339,9.296799,-.009600162,.4994969,.02955452,.3667099,.3526999,-.6917347,.2154887,-.8760264,.2334121,-.01909621,.4748033,-.1138514,6.51536,1.225097,-1.293189,-.42187,1.620952,-.7858597,-.0376941,.6636786,.3364945,-.5341017,.2128347,-.9735521,-.1325495,1.007517,.2598258,.06762169,.001421018,-.06915987,3.185897,.8641956,-1.0948,-.1962062,.5755591,.2906259,.2625748,.7644049,.1347492,2.677126,.646546,-1.393063,-.5578338,-41.85249,42.33504,-.00543564,.4743765,.007422477,2.442801,.5211707,-1.939487,-1.128509,-8.974257,9.978383,-.007965597,.294883,.04436763,.2839868,.3440424,-.6011562,.2354877,-3.07982,2.585094,-.02002701,.7793909,-.1598414,5.834678,1.202856,-1.315676,-.3903446,1.7019,-1.304609,-.01045121,.2747707,.4143967,.3197102,.263758,-.9618628,-.1625841,1.187138,.1497802,-5590954e-12,.03178475,-.04153145,2.496096,.8195082,-1.111554,-.2365546,.7831875,.2018684,.2074369,.7395978,.122573,1.876478,.6821167,-1.427879,-.5994879,-35.31016,35.81581,-.006431497,.4554192,.0007348731,2.334619,.5233377,-1.998177,-1.206633,-21.4651,22.42237,-.005857596,.2755663,.06384795,.1358244,.3328437,-.644063,.2058571,2.155499,-2.587968,-.01840023,.8826555,-.2222452,5.847073,1.228387,-1.229071,-.3360441,-.3429599,.6179469,.00202961,.08899319,.5041624,.1882964,.225204,-1.022905,-.2101621,1.915689,-.6498794,-.03463651,.08954605,-.06797854,2.417705,.8568618,-1.082538,-.2007723,.4731009,.4077267,.1324289,.651488,.1702912,2.309383,.6600895,-1.472139,-.6499815,-34.28465,34.69659,-.005747023,.4174167,.001688597,2.323046,.5395191,-2.161176,-1.353089,-22.26827,23.29138,-.005583808,.2364793,.06096656,.001944666,.2861624,-.6593044,.1393558,4.698373,-5.193883,-.0199839,1.095635,-.2391254,5.598103,1.236193,-1.195717,-.2972715,.04648953,.3024588,.005003313,-.3754741,.5247265,-.1381312,.2493896,-1.020139,-.2253524,.3548437,.7030485,-.02107076,.4581395,-.03243757,2.453259,.8323623,-1.09877,-.243578,.8761614,.1941613,-.1990692,.3761139,.1657412,1.590503,.6741417,-1.648007,-.8205121,-44.35106,44.79801,-.004181353,.385483,-1842385e-12,2.000281,.5518363,-2.140986,-1.282239,-3.979213,4.672459,-.005008582,.242192,.06253602,.6612713,.2555851,-1.300502,-.5137898,.5179821,-.4032341,-.02066785,1.087929,-.2615309,4.225887,1.229237,-.696334,.0924106,.06936356,-.3588571,-.05461843,-.5616643,.5484166,-.04776267,.2414935,-1.233179,-.4325498,.6479813,.8368356,.2458875,.6464752,-.02897097,1.561773,.8518598,-1.051023,-.253369,1.004294,.3028083,-1.520108,.1607013,.1619975,1.131094,.6706655,-1.948249,-1.097383,-44.53697,44.94902,-.003579939,.3491605,-2500253e-12,1.740442,.6188022,-2.154253,-1.209559,4.144894,-3.562411,-.005638843,.1067169,.07594858,1.00528,.1072543,-2.513259,-1.507208,-1.602979,1.404154,-.00556075,1.24049,-.2852117,3.485252,1.349321,-.07832214,.3655626,.3856288,.6867894,-.1609523,-.6704306,.5357301,-.6457935,.1479503,-1.354784,-.5454375,.8797469,-1.466514,.713442,.5934903,-.02911178,.8643737,.9030724,-1.048324,-.2738736,.8783074,3.246188,-4.435369,.1251791,.1783486,1.064657,.6522878,-2.770408,-1.618911,-25.04031,25.31674,-.004239279,.3241013,-3764484e-12,1.586843,.7035906,-1.9135,-1.144014,-10.80587,11.53677,-.01003197,.1577515,.05217789,1.225278,.005172771,-5.293208,-2.876463,2.087053,-3.201552,.003892964,.532393,-.2034512,2.61776,1.273597,.906034,.3773409,-.6399945,3.213979,-.09112172,.6494055,.395328,.5047796,.2998695,-1.482179,-.677831,1.161775,-3.004872,.4774797,-.4969248,-.003512074,-1.30719,.7927378,-.9863181,-.1803364,.5810824,4.58057,-3.863454,.5328174,.2272821,1.771114,.6791814],A_e=[1.560219,1.417388,1.206927,10.91949,5.931416,7.304788,1.533049,1.560532,.3685059,13.5504,5.543711,7.792189,1.471043,1.746088,-.9299697,17.20362,5.473384,8.336416,1.355991,2.109348,-3.295855,22.64843,5.454607,9.304656,1.244963,2.547533,-5.841485,27.56879,5.576104,10.43287,1.175532,2.784634,-7.212225,29.75347,6.47298,10.92331,1.082973,3.118094,-8.934293,31.86879,8.473885,11.74019,.96925,3.349574,-10.0381,31.47654,13.38931,12.72547,.8547044,3.151538,-9.095567,25.54995,22.73219,14.10398,.758034,2.311153,-5.170814,12.29669,36.86529,15.98882,1.664273,1.574468,1.422078,9.768247,14.47338,16.44988,1.638295,1.719586,.5786675,12.39846,14.15419,17.28605,1.572623,1.921559,-.7714802,16.09246,14.20954,18.25908,1.468395,2.21197,-2.845869,20.75027,15.24822,19.37622,1.355047,2.556469,-4.96092,24.60237,16.4836,20.65648,1.291642,2.742036,-6.061967,26.02002,18.19144,21.16712,1.194565,2.97212,-7.295779,26.91805,21.2488,22.01819,1.083631,3.047021,-7.766096,24.96261,27.44264,22.91875,.9707994,2.736459,-6.308284,17.6086,37.76291,23.9215,.8574294,1.865155,-2.364707,4.337793,50.92831,25.23432],y_e=[1.632341,1.39523,1.375634,12.38193,5.921102,7.766508,1.597115,1.554617,.3932382,15.05284,5.725234,8.158155,1.522034,1.844545,-1.322862,19.18382,5.440769,8.837119,1.403048,2.290852,-4.013792,24.851,5.521888,9.845547,1.286364,2.774498,-6.648221,29.64151,5.923777,10.97075,1.213544,3.040195,-8.092676,31.86082,6.789782,11.58899,1.122622,3.347465,-9.649016,33.43824,9.347715,12.31374,1.007356,3.543858,-10.5352,32.39842,14.83962,13.31718,.8956642,3.2787,-9.254933,25.57923,24.89677,14.76166,.7985143,2.340404,-4.928274,11.41787,39.61501,16.82448,1.745162,1.639467,1.342721,11.66033,14.90124,17.74031,1.708439,1.819144,.2834399,14.48066,14.59214,18.58679,1.63172,2.094799,-1.378825,18.43198,14.63173,19.62881,1.516536,2.438729,-3.624121,22.98621,15.99782,20.70027,1.405863,2.785191,-5.705236,26.45121,17.6833,21.91903,1.344052,2.951807,-6.683851,27.44271,19.85706,22.29452,1.245827,3.182923,-7.82296,27.91395,23.27254,23.1591,1.132305,3.202593,-8.008429,25.21093,30.00014,24.05306,1.02033,2.820556,-6.238704,17.09276,40.77916,25.09949,.903157,1.863917,-1.955738,3.032665,54.3429,26.4178],b_e=[1.168084,2.156455,-3.980314,19.89302,13.28335,14.35621,1.135488,2.294701,-4.585886,20.90208,13.4784,14.67658,1.107408,2.382765,-5.112357,21.47823,14.93128,14.60882,1.054193,2.592891,-6.115,22.68967,16.35672,15.18999,1.006946,2.70542,-6.69893,22.9183,18.34324,15.70651,.9794044,2.74244,-6.805283,22.25271,20.50797,15.6313,.9413577,2.722009,-6.760707,20.98242,23.42588,16.05011,.8917923,2.59278,-6.152635,17.74141,28.58324,16.5791,.8288391,2.153434,-4.118327,10.78118,36.8171,17.38139,.7623528,1.418187,-.8845235,.7590129,46.29859,19.21657,1.352858,2.048862,-2.053393,14.05874,30.45344,30.4443,1.330497,2.126497,-2.466296,14.67559,30.90738,30.69707,1.286344,2.200436,-2.877228,14.92701,32.36288,30.77223,1.234428,2.289628,-3.404699,14.99436,34.6839,30.84842,1.17866,2.306071,-3.549159,14.11006,37.54188,30.7973,1.151366,2.333005,-3.728627,13.63374,39.05894,30.92599,1.101593,2.299422,-3.565787,11.96745,41.88472,31.02755,1.038322,2.083539,-2.649585,8.037389,47.00869,30.65948,.9596146,1.67147,-.8751538,1.679772,53.45784,30.5452,.8640731,.9858301,1.854956,-6.798097,59.36468,31.10255],x_e=[g_e,__e,v_e],E_e=[A_e,y_e,b_e],MP={getTableValue:function(n,e,t,r,o){var i=540*e,a=54*(t-1),s=9*r;return x_e[n][i+a+s+o]},getTableValueRad:function(n,e,t,r){var o=60*e,i=6*(t-1);return E_e[n][o+i+r]}},TP=9;function V0(n,e,t,r,o){return IP(n).reduce((function(i,a,s){return i+a*MP.getTableValue(e,t,r,s,o)}),0)}function U0(n,e,t,r){return IP(n).reduce((function(o,i,a){return o+i*MP.getTableValueRad(e,t,r,a)}),0)}function IP(n){var e=Math.pow(2*n/Math.PI,.3333333333333333);return[Math.pow(1-e,5),5*Math.pow(1-e,4)*e,10*Math.pow(1-e,3)*Math.pow(e,2),10*Math.pow(1-e,2)*Math.pow(e,3),5*(1-e)*Math.pow(e,4),Math.pow(e,5)]}var Zu={getDistParams:function(n,e,t,r){for(var o=new Array(TP),i=Math.trunc(n),a=n-i,s=0;s<TP;s++){var l=V0(t,r,0,i,s),c=V0(t,r,1,i,s);if(o[s]=(1-e)*(1-a)*l+e*(1-a)*c,i!=10){var u=V0(t,r,0,i+1,s),d=V0(t,r,1,i+1,s);o[s]+=(1-e)*a*u+e*a*d}}return o},getRadiance:function(n,e,t,r){var o=Math.trunc(n),i=n-o,a=(1-e)*(1-i)*U0(t,r,0,o)+e*(1-i)*U0(t,r,1,o);return o!=10&&(a+=(1-e)*i*U0(t,r,0,o+1)+e*i*U0(t,r,1,o+1)),a}};class z0 extends qu{constructor(e,t,r,o){super(e,t,r,o)}interpolate_(e,t,r,o){const i=this.resultBuffer,a=this.sampleValues,s=this.valueSize,l=e*s,c=l-s,u=(r-t)/(o-t),d=1-u;for(let f=0;f!==s;++f)i[f]=a[c+f]*d+a[l+f]*u;return i}}var C_e=[.1787,-1.463,-.3554,.4275,-.0227,5.3251,.1206,-2.5771,-.067,.3703],S_e=[-.0193,-.2592,-.0665,8e-4,-4e-4,.2125,-.0641,-.8989,-.0033,.0452],w_e=[-.0167,-.2608,-.095,.0092,-.0079,.2102,-.0441,-1.6537,-.0109,.0529],M_e=[4.0453,-4.971,-.2155,2.4192],T_e=[.00166,-.00375,.00209,0,-.02903,.06377,-.03202,.00394,.11693,-.21196,.06052,.25886],I_e=[.00275,-.0061,.00317,0,-.04214,.0897,-.04153,.00516,.15346,-.26756,.0667,.26688],R_e=[C_e,S_e,w_e],L_e=[M_e,T_e,I_e],G0={getTableValue:function(n,e,t){return R_e[n][2*e+t]},getTableDataZenith:function(n){return L_e[n]}},RP=5,P_e=.06;function LP(n,e,t){return(1+n[0]*Math.exp(n[1]/Math.cos(e)))*(1+n[2]*Math.exp(n[3]*t)+n[4]*Math.pow(Math.cos(t),2))}function D_e(n){return .212671*n+.71516*n+.072169*n}var li={getDistParams:function(n,e){for(var t=new Array(RP),r=0;r<RP;r++)t[r]=G0.getTableValue(e,r,0)*n+G0.getTableValue(e,r,1);return t},getZenithParams:function(n,e,t){switch(t){case 0:var r=G0.getTableDataZenith(t),o=new pt(r[0],r[1],r[2],r[3]),i=Math.tan((4/9-n/120)*(Math.PI-2*e)),a=new pt(n*i,i,n,1);return o.dot(a)*P_e/LP(this.getDistParams(n,t),0,e);case 1:case 2:r=G0.getTableDataZenith(t);var s=Math.pow(e,2),l=Math.pow(e,3),c=r[0]*l+r[1]*s+r[2]*e+r[3],u=r[4]*l+r[5]*s+r[6]*e+r[7],d=r[8]*l+r[9]*s+r[10]*e+r[11];return o=new N(c,u,d),new N(Math.pow(n,2),n,1).dot(o)/LP(this.getDistParams(n,t),0,e)}},getSunIlluminance:function(n,e){var t=[0,0,0];if(n[1]<0)return t;for(var r=[.605,.54,.445],o=[12.25,7.5,.3],i=.04608*e-.04586,a=1/(n[1]+.15*Math.pow(93.885-Math.acos(n[1])*(180/Math.PI),-1.253)),s=[1.05513096,.993359745,.903543472],l=0;l<3;l++){var c=Math.exp(.008735*-a*Math.pow(r[l],-4.08)),u=Math.exp(-a*i*Math.pow(r[l],-1.3)),d=Math.exp(.0035*-o[l]*a);t[l]=128e3*s[l]/D_e(s[l]),t[l]*=c*u*d}return t},getSunIntegral:function(n,e,t,r){var o=n,i=e,a=t;function s(d){return d*d}var l=1-cos(o),c=((s(Math.PI)-2*s(o-i))*cos(o)-s(Math.PI)*cos(i))/(2*(o-i+Math.PI)*(-o+i+Math.PI)),u=a*((.0892351-.00247875*s(a))*sin(a)+cube(a)+24*a+.029745*a*cos(a))/s(s(a)+36);return 2*Math.PI*(l+c+r*u)}};class xa{constructor(e=1,t=0,r=0){return this.radius=e,this.phi=t,this.theta=r,this}set(e,t,r){return this.radius=e,this.phi=t,this.theta=r,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,r){return this.radius=Math.sqrt(e*e+t*t+r*r),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,r),this.phi=Math.acos(Ht(t/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}const ve={BACKGROUND_BL:{color:0,strength:1},BSDF_DIFFUSE_BL:{color:0,roughness:1,normal:2},BSDF_GLOSSY_BL:{color:0,roughness:1,anisotropy:2,rotation:3,normal:4,tangent:5},BSDF_METALLIC_BL:{baseColor:0,edgeTint:1,ior:2,extinction:3,roughness:4,anisotropy:5,rotation:6,normal:7,tangent:8},BSDF_PRINCIPLED_BL:{baseColor:0,metallic:1,roughness:2,ior:3,alpha:4,normal:5,diffuseRoughness:6,subsurface:7,subsurfaceRadius:8,subsurfaceScale:9,subsurfaceIor:10,subsurfaceAnisotropy:11,specularIORLevel:12,specularTint:13,anisotropic:14,anisotropicRotation:15,tangent:16,transmission:17,clearcoat:18,clearcoatRoughness:19,clearcoatIor:20,clearcoatTint:21,clearcoatNormal:22,sheen:23,sheenRoughness:24,sheenTint:25,emission:26,emissionStrength:27,thinFilmThickness:28,thinFilmIOR:29},BSDF_PRINCIPLED_BF43_BL:{baseColor:0,metallic:1,roughness:2,ior:3,alpha:4,normal:5,subsurface:6,subsurfaceRadius:7,subsurfaceScale:8,subsurfaceIor:9,subsurfaceAnisotropy:10,specularIORLevel:11,specularTint:12,anisotropic:13,anisotropicRotation:14,tangent:15,transmission:16,clearcoat:17,clearcoatRoughness:18,clearcoatIor:19,clearcoatTint:20,clearcoatNormal:21,sheen:22,sheenRoughness:23,sheenTint:24,emission:25,emissionStrength:26},BSDF_PRINCIPLED_BF40_BL:{baseColor:0,subsurface:1,subsurfaceRadius:2,subsurfaceColor:3,subsurfaceIOR:4,subsurfaceAnisotropy:5,metallic:6,specular:7,specularTint:8,roughness:9,anisotropic:10,anisotropicRotation:11,sheen:12,sheenTint:13,clearcoat:14,clearcoatRoughness:15,ior:16,transmission:17,transmissionRoughness:18,emission:19,emissionStrength:20,alpha:21,normal:22,clearcoatNormal:23,tangent:24},BSDF_TRANSLUCENT_BL:{color:0,normal:1},BSDF_TRANSPARENT_BL:{color:0},DIFFUSE_BSDF_BL:{color:0,roughness:1,normal:2},EEVEE_SPECULAR_BL:{baseColor:0,specular:1,roughness:2,emissiveColor:3,transparency:4,normal:5,clearcoat:6,clearcoatRoughness:7,clearcoatNormal:8,ambientOcclusion:9},EMISSION_BL:{color:0,strength:1},LIGHT_PATH_BL:{},MIX_BL:{fac:0,col1:1,col2:2},MIX_SHADER_BL:{fac:0,color1:1,color2:2},NEW_GEOMETRY_BL:{},NORMAL_MAP_BL:{strength:0,normalColor:1},OUTPUT_MATERIAL_BL:{surface:0,volume:1,displacement:2,thickness:3},OUTPUT_WORLD_BL:{surface:0,volume:1},RGB_BL:{},SEPARATE_COLOR_BL:{color:0},TEX_COORD_BL:{},TEX_ENVIRONMENT_BL:{vector:0},TEX_IMAGE_BL:{vector:0},UVMAP_BL:{uv:0},VALUE_BL:{},BITMAP_MX:{uOffset:0,vOffset:1,uTiling:2,vTiling:3,wAngle:4},BITMAP_ENV_MX:{uOffset:0,vOffset:1,uTiling:2,vTiling:3,wAngle:4,normal:5},FALLOFF_MX:{normal:2},MATERIAL_MX:{ambientColor:0,diffuseColor:1,specularColor:2,glossiness:3,specularLevel:4,selfIllum:5,opacity:6,filterColor:7,normal:8,reflection:9,refraction:10,displacement:11},NORMAL_BUMP_MX:{normalColor:0,additionalBump:1,normalMult:2,addBumpMult:3},OPENPBR_SURFACE_MX:{baseWeight:0,baseColor:1,baseMetalness:2,baseDiffuseRoughness:3,specularWeight:4,specularColor:5,specularRoughness:6,specularIOR:7,transmissionWeight:8,transmissionColor:9,transmissionDepth:10,fuzzWeight:11,fuzzColor:12,fuzzRoughness:13,coatWeight:14,coatColor:15,coatRoughness:16,emissionWeight:17,emissionColor:18,emissionLuminance:19,geometryOpacity:20,normal:21,clearcoatNormal:22},OUTPUT_MX:{color:0},PHYSICAL_MX:{base:0,baseColor:1,reflectivity:2,reflColor:3,roughness:4,metalness:5,diffRoughness:6,anisotropy:7,anisoangle:8,transparency:9,transColor:10,transRoughness:11,ior:12,scattering:13,sssColor:14,sssScale:15,emission:16,emitColor:17,clearcoat:18,clearcoatColor:19,clearcoatRoughness:20,normal:21,clearcoatNormal:22,displacement:23,opacity:24},REFLECT_REFRACT_MX:{normal:0},RGB_MX:{},SUB_TRANSFORM_MX:{scale:0,rotate:1,offset:2},VALUE_MX:{},BUMP_2D_MY:{bumpDepth:0,bumpValue:1},COLOR_CONSTANT_MY:{color:0,alpha:1},FILE_MY:{uvCoord:0},FLOAT_CONSTANT_MY:{value:0},LAMBERT_MY:{color:0,ambientColor:1,incandescence:2,matteOpacity:3,diffuse:4,normal:5,translucence:6,transparency:7},OPENPBR_SURFACE_MY:{baseWeight:0,baseColor:1,baseDiffuseRoughness:2,baseMetalness:3,specularWeight:4,specularColor:5,specularRoughness:6,specularIOR:7,transmissionWeight:8,transmissionColor:9,transmissionDepth:10,transmissionScatter:11,fuzzWeight:12,fuzzColor:13,fuzzRoughness:14,coatWeight:15,coatColor:16,coatRoughness:17,emissionLuminance:18,emissionColor:19,geometryOpacity:20,normal:21},PLACE_2D_TEXTURE_MY:{offset:0,repeatUv:1,rotateUv:2},RAMP_MY:{uvCoord:0},SAMPLER_INFO_MY:{viewNorm:0},SHADING_ENGINE_MY:{surface:0,volume:1,displacement:2},SUB_TRANSFORM_MY:{scale:0,rotate:1,offset:2},SURFACE_SHADER_MY:{color:0,glowColor:1,matteOpacity:2,transparency:3},IMAGE_AR:{multiply:0,offset:1,uvcoords:2,soffset:3,toffset:4,sscale:5,tscale:6,sflip:7,tflip:8,swapSt:9,duvdx:10,duvdy:11},LAMBERT_AR:{base:0,baseColor:1,normalCamera:2,opacity:3},MAP_TO_MTL_AR:{color:0},NORMAL_MAP_AR:{inputVal:0,normal:1,strength:2,tangent:3},STANDARD_SURFACE_AR:{base:0,baseColor:1,diffuseRoughness:2,metalness:3,specular:4,specularColor:5,specularRoughness:6,trans:7,transColor:8,transDepth:9,transScatter:10,transExtraRoughness:11,subsurface:12,subsurfaceColor:13,subsurfaceRadius:14,clearcoat:15,clearcoatColor:16,clearcoatRoughness:17,sheen:18,sheenColor:19,sheenRoughness:20,emission:21,emissionColor:22,opacity:23,normal:24,clearcoatNormal:25,specularIOR:26},TRIPLANAR_AR:{inputColor:0,inputColorY:1,inputColorZ:2,scale:3,rotate:4,offset:5,normal:6},TRIPLANAR_UV_AR:{vector:0,normal:1},UV_PROJECTION_AR:{projectionColor:0,uAngle:1,vAngle:2,matrix:3},NORMAL:{},RGB_ALPHA:{},VALUE:{}},it={BACKGROUND_BL:{color:0},BSDF_DIFFUSE_BL:{color:0},BSDF_GLOSSY_BL:{color:0},BSDF_METALLIC_BL:{color:0},BSDF_PRINCIPLED_BL:{color:0},BSDF_PRINCIPLED_BF40_BL:{color:0},BSDF_TRANSLUCENT_BL:{color:0},BSDF_TRANSPARENT_BL:{color:0},EEVEE_SPECULAR_BL:{color:0},EMISSION_BL:{color:0},DIFFUSE_BSDF_BL:{color:0},LIGHT_PATH_BL:{isCameraRay:0,isShadowRay:1,isDiffuseRay:2,isGlossyRay:3,isSingularRay:4,isReflectionRay:5,isTransmissionRay:6,rayLength:7,rayDepth:8,diffuseDepth:9,glossyDepth:10,transparentDepth:11,transmissionDepth:12},MIX_BL:{col:0},MIX_SHADER_BL:{color:0},NEW_GEOMETRY_BL:{position:0,normal:1,tangent:2,trueNormal:3,incoming:4,parametric:5,backfacing:6,pointiness:7,randomPerIsland:8},NORMAL_MAP_BL:{normal:0},OUTPUT_MATERIAL_BL:{outgoingLight:0},OUTPUT_WORLD_BL:{outgoingLight:0},RGB_BL:{color:0},SEPARATE_COLOR_BL:{r:0,g:1,b:2},TEX_COORD_BL:{generated:0,normal:1,uv:2,object:3,camera:4,window:5,reflection:6},TEX_ENVIRONMENT_BL:{color:0},TEX_IMAGE_BL:{color:0,alpha:0},UVMAP_BL:{uv:0},VALUE_BL:{value:0},BITMAP_MX:{color:0,value:1},BITMAP_ENV_MX:{color:0,value:1},FALLOFF_MX:{color:0},MATERIAL_MX:{color:0},NORMAL_BUMP_MX:{normal:0},OPENPBR_SURFACE_MX:{color:0},OUTPUT_MX:{outgoingLight:0},PHYSICAL_MX:{color:0},RGB_MX:{color:0},REFLECT_REFRACT_MX:{color:0},SUB_TRANSFORM_MX:{vector:0,normal:1},VALUE_MX:{value:0},BUMP_2D_MY:{normal:0},COLOR_CONSTANT_MY:{color:0,alpha:1},FILE_MY:{alpha:0,color:1,size:2,transparency:3},FLOAT_CONSTANT_MY:{value:0},LAMBERT_MY:{color:0},OPENPBR_SURFACE_MY:{color:0},PLACE_2D_TEXTURE_MY:{uv:0},RAMP_MY:{alpha:0,color:1},SAMPLER_INFO_MY:{facingRatio:0,flippedNormal:1,matrixEyeToWorld:2,normalCamera:3,pixelCenter:4,pointCamera:5,pointObj:6,pointWorld:7,tangentUCamera:8,tangentVCamera:9,uvCoord:10},SHADING_ENGINE_MY:{outgoingLight:0},SUB_TRANSFORM_MY:{vector:0,normal:1},SURFACE_SHADER_MY:{color:0,glowColor:1,matteOpacity:2,transparency:3},IMAGE_AR:{color:0,alpha:1,transparency:2},LAMBERT_AR:{color:0,alpha:1,transparency:2},MAP_TO_MTL_AR:{color:0},NORMAL_MAP_AR:{value:0},STANDARD_SURFACE_AR:{color:0,transparency:1},TRIPLANAR_AR:{color:0},TRIPLANAR_UV_AR:{uv:0,duvdx:1,duvdy:2},UV_PROJECTION_AR:{uv:0},NORMAL:{normal:0},RGB_ALPHA:{color:0,alpha:1},VALUE:{value:0}};function Ft(n,e="",t={}){let r;switch(n){case"BACKGROUND_BL":r={inputs:[[0,0,0,1],1],outputs:[[0,0,0,0]]};break;case"BSDF_DIFFUSE_BL":case"DIFFUSE_BSDF_BL":r={inputs:[[.8,.8,.8,1],0,[0,0,0]],outputs:[[0,0,0,0]]};break;case"BSDF_PRINCIPLED_BL":r={inputs:[[.8,.8,.8,1],0,.5,1.5,1,[0,0,0],0,[1,.2,.1],.05,1.4,0,.5,[1,1,1,1],0,0,[0,0,0],0,0,.03,1.5,[1,1,1,1],[0,0,0],0,.5,[0,0,0,1],[1,1,1,1],0],outputs:[[0,0,0,0]]};break;case"BSDF_TRANSPARENT_BL":r={inputs:[[1,1,1,1]],outputs:[[0,0,0,0]]};break;case"LIGHT_PATH_BL":r={inputs:[],outputs:[0,0,0,0,0,0,0,0,0,0,0,0,0]};break;case"MIX_BL":r={dataType:"RGBA",clampFactor:!0,blendType:"MIX",clampResult:!1,factorMode:"UNIFORM",inputs:[.5,[.5,.5,.5,1],[.5,.5,.5,1]],outputs:[[0,0,0,0]]};break;case"MIX_SHADER_BL":r={inputs:[.5,[0,0,0,0],[0,0,0,0]],outputs:[[0,0,0,0]]};break;case"OUTPUT_MATERIAL_BL":r={inputs:[[0,0,0,0],[0,0,0,0],[0,0,0],0],outputs:[]};break;case"OUTPUT_WORLD_BL":r={inputs:[[0,0,0,1],[0,0,0,0]],outputs:[]};break;case"RGB_BL":r={inputs:[],outputs:[[.5,.5,.5,1]]};break;case"TEX_ENVIRONMENT_BL":r={projection:"EQUIRECTANGULAR",texture:-1,inputs:[[0,0,0]],outputs:[[0,0,0,0]]};break;case"TEX_IMAGE_BL":r={alphaMode:"STRAIGHT",clampToEdgeNoExtend:!1,projection:"FLAT",projectionBlend:0,texture:-1,inputs:[[0,0,0]],outputs:[[0,0,0,0],0]};break;case"UVMAP_BL":r={uvLayer:"",inputs:[],outputs:[[0,0,0]]};break;case"VALUE_BL":case"VALUE_MX":case"VALUE":r={inputs:[],outputs:[0]};break;case"BITMAP_MX":r={alphaAsMono:!1,alphaAsRGB:!1,alphaSource:"NONE",axis:"XY",clampToEdgeNoExtend:[!1,!1],mapping:"EXPLICIT_MAP_CHANNEL",texture:-1,uvIndex:0,inputs:[0,0,1,1,0],outputs:[[0,0,0,0]]};break;case"PHYSICAL_MX":r={brdfCurve:5,brdfHigh:1,brdfLow:.05,brdfMode:!0,emitLuminance:1500,roughnessInv:!1,thinWalled:!1,transRoughnessInv:!1,transRoughnessLock:!0,inputFactors:[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],inputs:[1,[1,1,1,1],1,[1,1,1,1],.5,0,0,0,0,0,[1,1,1,1],0,1.5,0,[0,0,0,0],0,0,[1,1,1,1],0,[1,1,1,1],0,[0,0,0],[0,0,0],0,1],outputs:[[0,0,0,0]]};break;case"OUTPUT_MX":r={inputs:[[0,0,0,0]],outputs:[]};break;case"RGB_MX":r={inputs:[],outputs:[[0,0,0,1]]};break;case"COLOR_CONSTANT_MY":r={inputs:[[0,0,0],1],outputs:[[0,0,0],0]};break;case"FILE_MY":r={fileHasAlpha:!1,texture:-1,inputs:[[0,0]],outputs:[1,[0,0,0],[2048,2048],[0,0,0]]};break;case"FLOAT_CONSTANT_MY":r={inputs:[0],outputs:[0]};break;case"LAMBERT_MY":r={inputs:[[.5,.5,.5],[0,0,0],[0,0,0],1,.8,[0,0,0],0,[0,0,0]],outputs:[[0,0,0,0]]};break;case"PLACE_2D_TEXTURE_MY":r={uvIndex:0,inputs:[[0,0],[1,1],0],outputs:[[0,0]]};break;case"SHADING_ENGINE_MY":r={inputs:[[0,0,0,0],[0,0,0,0],[0,0,0]],outputs:[]};break;case"LAMBERT_AR":r={inputs:[.7,[1,1,1],[0,0,0],[0,0,0]],outputs:[[0,0,0,0],0,[0,0,0]]};break;case"STANDARD_SURFACE_AR":r={thinWalled:!0,inputs:[1,[.8,.8,.8],0,0,1,[1,1,1],.2,0,[0,0,0],0,[0,0,0],0,0,[1,1,1],[1,1,1],0,[1,1,1],.1,0,[1,1,1],.3,0,[1,1,1],[1,1,1],[0,0,0],[0,0,0],1.5],outputs:[[0,0,0,0],[0,0,0]]};break;case"RGB_ALPHA":r={inputs:[],outputs:[[0,0,0],1]};break;default:console.error("v3d.NodeUtils.createNode: Invalid node:",n)}return r?(r.name=e,r.type=n,["OUTPUT_MATERIAL_BL","OUTPUT_WORLD_BL","OUTPUT_MX","SHADING_ENGINE_MY"].includes(n)?r.is_active_output=!0:r.is_active_output=!1,Object.assign(r,t),{originData:r}):void 0}function Ei(n){return n.originData.type}function ub(n){let e=Ei(n);const t=n.originData;if(e=="BSDF_PRINCIPLED_BL")switch(t.inputs.length){case 27:case 29:e="BSDF_PRINCIPLED_BF43_BL";break;case 25:e="BSDF_PRINCIPLED_BF40_BL"}if(e=="BSDF_GLOSSY_BL"&&t.inputs.length===3&&(e="BSDF_GLOSSY_BF40_BL"),e=="BUMP_BL")switch(t.inputs.length){case 4:e="BUMP_BF44_BL";break;case 6:e="BUMP_BF32_BL"}return e}function Ji(n,e){const t=Ei(n);return Array.isArray(e)?e.includes(t):e===t}function ea(n,e){for(let t=0;t<n.len();t++)if(Ei(n.node(t))==e)return t;return-1}function PP(n,e){for(let t=0;t<n.len();t++)if(n.node(t).originData.name==e)return t;return-1}function xt(n,e,t,r=""){if(!Number.isFinite(t))return console.error("v3d.NodeUtils.findConnectedNode: Invalid input index"),null;typeof e=="object"&&(e=n.nodeIndex(e));for(let o in n.edges){const i=n.edges[o];if(i.to()==e){const a=n.node(i.from());for(let s=0;s<i.connections.length;s++)if(i.connections[s].to===t&&(r===""||Ji(a,r)))return a}}return null}function B_e(n,e,t,r=""){if(!Number.isFinite(t))return console.error("v3d.NodeUtils.findAllConnectedNodes: Invalid input index"),null;typeof e=="object"&&(e=n.nodeIndex(e));const o=[];for(let i in n.edges){const a=n.edges[i];if(a.to()==e){const s=n.node(a.from());if(r&&!Ji(s,r))continue;for(let l=0;l<a.connections.length;l++){const c=a.connections[l];c.to===t&&o.push({node:s,nodeIdx:a.from(),outputIdx:c.from,channelMatrix:c.channelMatrix})}}}return o}function pn(n,e,t){if(!Number.isFinite(t))return console.error("v3d.NodeUtils.isConnInput: Invalid input index"),!1;const r=n.findInEdges(e);for(let o=0;o<r.length;o++){const i=r[o];for(let a=0;a<i.connections.length;a++)if(i.connections[a].to==t)return!0}return!1}function Ju(n,e,t){if(!Number.isFinite(t))return console.error("v3d.NodeUtils.isConnOutput: Invalid output index"),!1;for(let r in n.edges){const o=n.edges[r];if(o.from()==e){for(let i=0;i<o.connections.length;i++)if(o.connections[i].from==t)return!0}}return!1}function Ke(n,e,t,r,o,i){if(!Number.isFinite(t)||!Number.isFinite(o))return void console.error("v3d.NodeUtils.connectNodes: Invalid input/output index");n.edge(e,r)||n.addNewEdge(e,r);const a=n.edge(e,r);a.connections=a.connections||[];const s={from:t,to:o};i&&(s.channelMatrix=i),a.connections.push(s)}function db(n){return n.endsWith("_AR")||n.endsWith("_BL")||n.endsWith("_MX")||n.endsWith("_MY")?n.slice(0,-3):n}function so(n,e){return OR("NODE_"+db(n))+"Uni"+e}function DP(n){const e=new Fn(n.len());for(let t=0;t<e.len();t++)BP(n.node(t),e.node(t));for(let t in n.edges){const r=n.edges[t];e.addNewEdge(r.from(),r.to()).connections=r.connections.slice()}return e}function BP(n,e){e||(e={}),e.originData={};for(const t in n.originData)e.originData[t]=t=="texture"?n.originData[t]:JSON.parse(JSON.stringify(n.originData[t]));return n.attributes&&(e.attributes=JSON.parse(JSON.stringify(n.attributes))),n.params&&(e.params=JSON.parse(JSON.stringify(n.params))),n.inputFactors&&(e.inputFactors=n.inputFactors.slice(0)),n.inputs&&(e.inputs=JSON.parse(JSON.stringify(n.inputs))),n.outputs&&(e.outputs=JSON.parse(JSON.stringify(n.outputs))),e}function NP(n){let e=-1;for(let t=0;t<n.len();t++)if(n.node(t).originData.is_active_output){e=t;break}if(e==-1)n.removeAll();else{const t=new Rh(n.reverse(),e),r=[];for(let o=0;o<n.len();o++)t.hasPathTo(o)||r.push(n.node(o));r.forEach((function(o){n.disconnect(n.nodeIndex(o),!0)}))}}function ed(n,e,t,r=""){if(!Number.isFinite(t))return console.error("v3d.NodeUtils.disconnectInputNode: Invalid input index"),null;typeof e=="object"&&(e=n.nodeIndex(e));for(let o in n.edges){const i=n.edges[o];if(i.to()==e){const a=n.node(i.from());if(r&&!Ji(a,r))continue;for(let s=0;s<i.connections.length;s++){const l=i.connections[s];if(l.to===t)return n.removeEdge(i.from(),e),{node:a,outputIdx:l.from}}}}return null}function N_e(n,e,t,r=""){if(!Number.isFinite(t))return console.error("v3d.NodeUtils.disconnectOutputNode: Invalid output index"),null;typeof e=="object"&&(e=n.nodeIndex(e));for(let o in n.edges){const i=n.edges[o];if(i.from()==e){const a=n.node(i.to());if(r&&!Ji(a,r))continue;for(let s=0;s<i.connections.length;s++){const l=i.connections[s];if(l.from==t)return n.removeEdge(e,i.to()),{node:a,inputIdx:l.to}}}}return null}const O_e=1500/Math.PI,fb={LAMBERT_AR:2,STANDARD_SURFACE_AR:24,BEVEL_BL:1,BSDF_DIFFUSE_BL:2,BSDF_GLASS_BL:3,BSDF_GLOSSY_BL:4,BSDF_GLOSSY_BF40_BL:2,BSDF_METALLIC_BL:7,BSDF_PRINCIPLED_BL:5,BSDF_PRINCIPLED_BF43_BL:5,BSDF_PRINCIPLED_BF40_BL:22,BSDF_REFRACTION_BL:3,BSDF_SHEEN_BL:2,BSDF_TRANSLUCENT_BL:1,BUMP_BL:4,BUMP_BF44_BL:3,BUMP_BF32_BL:5,DIFFUSE_BSDF_BL:2,EEVEE_SPECULAR_BL:5,FRESNEL_BL:1,LAYER_WEIGHT_BL:1,BLINN_MY:5,LAMBERT_MY:5,OPENPBR_SURFACE_MY:21,PHONG_MY:5,PHONG_E_MY:5,SAMPLER_INFO_MY:0},vs=["BSDF_DIFFUSE_BL","BSDF_GLOSSY_BL","BSDF_METALLIC_BL","BSDF_PRINCIPLED_BL","DIFFUSE_BSDF_BL","EEVEE_SPECULAR_BL","EMISSION_BL"],k_e=["PHYSICAL_MX","LAMBERT_AR","OPENPBR_SURFACE_MX","STANDARD_SURFACE_AR","MAP_TO_MTL_AR"],hb=["STANDARD_SURFACE_AR","LAMBERT_MY","LAMBERT_AR","OPENPBR_SURFACE_MY","SURFACE_SHADER_MY"],Lh={color:new Ge(16777215),map:null,opacity:1,alphaMap:null,metalness:.5,metalnessMap:null,roughness:.5,roughnessMap:null,normalMap:null,normalScale:new be(1,1),aoMap:null,aoMapIntensity:1,emissive:new Ge(0),emissiveMap:null,emissiveIntensity:0};class ta extends Nr{constructor(e){super();const t=this;function r(T,R){const O=T.node(R);O.originData.type;for(let W=0;W<O.originData.inputs.length;W++)o(T,R,O.originData,W)}function o(T,R,O,W,ae){if(pn(T,R,W))return!1;const ne=O.name+" "+(ae||"Input "+W),oe=O.inputs[W],F=G(oe);let k,q,j=O.type.slice(-3);switch(j!="_BL"&&j!="_MX"&&(j=F=="float"?"":"_ALPHA"),F){case"float":k=Ft("VALUE"+j,ne),q=it[Ei(k)].value,k.originData.outputs[q]=oe;break;case"vec3":k=Ft("RGB"+j,ne),q=it[Ei(k)].color,k.originData.outputs[q][0]=oe[0],k.originData.outputs[q][1]=oe[1],k.originData.outputs[q][2]=oe[2];break;case"vec4":k=Ft("RGB"+j,ne),q=it[Ei(k)].color,k.originData.outputs[q][0]=oe[0],k.originData.outputs[q][1]=oe[1],k.originData.outputs[q][2]=oe[2],Ji(k,"RGB_ALPHA")?k.originData.outputs[it[Ei(k)].alpha]=oe[3]:k.originData.outputs[q][3]=oe[3];break;default:throw new Error("Unsupported group input")}return T.addNode(k),Ke(T,T.len()-1,q,R,W),!0}function i(T,R,O){const W={inputs:[],outputs:[],removedNodes:[]};W.removedNodes.push(O);const ae=ea(R,"GROUP_INPUT_BL");if(ae>-1){W.removedNodes.push(ae+T.len());const k=T.findInEdges(O),q=R.findOutEdges(ae);for(let j=0;j<k.length;j++){const U=k[j];for(let z=0;z<q.length;z++){const v=q[z];for(let M=0;M<U.connections.length;M++){const S=U.connections[M];for(let I=0;I<v.connections.length;I++){const J=v.connections[I];if(S.to==J.from){let $=s(W.inputs,U.from(),v.to());$||($=new si(U.from(),v.to()),$.connections=[],W.inputs.push($));const B={from:S.from,to:J.to};$.connections.push(B)}}}}}}const ne=ea(R,"GROUP_OUTPUT_BL");W.removedNodes.push(ne+T.len());const oe=T.findOutEdges(O),F=R.findInEdges(ne);for(let k=0;k<oe.length;k++){const q=oe[k];for(let j=0;j<F.length;j++){const U=F[j];for(let z=0;z<q.connections.length;z++){const v=q.connections[z];for(let M=0;M<U.connections.length;M++){const S=U.connections[M];if(v.from==S.to){let I=s(W.outputs,U.from(),q.to());I||(I=new si(U.from(),q.to()),I.connections=[],W.outputs.push(I));const J={from:S.from,to:v.to};I.connections.push(J)}}}}}return W}function a(T,R){Array.isArray(R)||(R=[R]);let O=0;for(let W=0;W<T.len();W++){const ae=T.node(W);for(let ne=0;ne<R.length;ne++){const oe=R[ne];ae.originData.type==oe&&O++}}return O}function s(T,R,O){for(let W=0;W<T.length;W++){const ae=T[W];if(ae.from()==R&&ae.to()==O)return ae}return null}function l(T,R,O){const W=O.type;let ae=T.findInEdges(R);for(let ne=0;ne<ae.length;ne++){const oe=ae[ne];let F=T.node(oe.from()).originData;for(let k=0;k<oe.connections.length;k++){const q=oe.connections[k];if(W=="MATERIAL_MX"&&u(F.type)&&(q.to==ve[W].reflection?F.reflectMode="MAX_ENV_COORDS_REFLECT":q.to==ve[W].refraction&&(F.reflectMode="MAX_ENV_COORDS_REFRACT")),d(W,q.to)){if(F.type=="BITMAP_MX"||F.type=="OUTPUT_MAP_MX"){T.removeEdge(oe.from(),oe.to()),F.type=="OUTPUT_MAP_MX"&&(F=xt(T,oe.from(),0).originData);const j={originData:{name:F.name+"Bump"+ne,type:"BUMP_MX",texture:F.texture,uvIndex:F.uvIndex,inputs:JSON.parse(JSON.stringify(F.inputs)),outputs:[[0,0,0]]}};T.addNode(j),Ke(T,T.len()-1,0,R,q.to),ne=-1,ae=T.findInEdges(R);break}for(let j=0;j<T.len();j++){const U=T.node(j).originData;if(c(U.type)){const z=U.inputs.length-1;Ke(T,oe.from(),q.from,j,z),U.inputFactors[z]=O.inputFactors[q.to]}}}}}}function c(T){return!(!u(T)&&T!="FALLOFF_MX")}function u(T){return T=="BITMAP_ENV_MX"||T=="REFLECT_REFRACT_MX"}function d(T,R){switch(T){case"BITMAP_ENV_MX":case"FALLOFF_MX":case"MATERIAL_MX":case"REFLECT_REFRACT_MX":return R==ve[T].normal;case"OPENPBR_SURFACE_MX":case"PHYSICAL_MX":return R==ve[T].normal||R==ve[T].clearcoatNormal;default:return!1}}function f(T,R,O){const W=O.blendMode.length,ae=T.findInEdges(R),ne=T.findOutEdges(R);for(let oe=0;oe<W;oe++){const F={originData:{name:O.name+"Layer"+oe,type:"COMPOSITE_LAYER_MX",blendMode:oe!=0?O.blendMode[oe]:0,opacity:O.opacity[oe],inputs:[[0,0,0,0]].concat(O.inputs.slice(2*oe,2*oe+2)),outputs:[O.outputs[oe]]}};T.addNode(F);for(let k=0;k<ae.length;k++){const q=ae[k];for(let j=0;j<q.connections.length;j++){const U=q.connections[j];U.to==2*oe&&O.mapEnabled[oe]?Ke(T,q.from(),U.from,T.len()-1,1):U.to==2*oe+1&&O.maskEnabled[oe]&&Ke(T,q.from(),U.from,T.len()-1,2)}}oe>0&&Ke(T,T.len()-2,0,T.len()-1,0)}for(let oe=0;oe<ne.length;oe++){const F=ne[oe];for(let k=0;k<F.connections.length;k++){const q=F.connections[k];Ke(T,T.len()-1,0,F.to(),q.to)}}}function h(T,R,O){const W=O.output,ae=T.findInEdges(R),ne=T.findOutEdges(R),oe={originData:{name:O.name+"Output",type:"OUTPUT_MAP_MX",invert:W.invert,clamp:W.clamp,alphaFromRGB:W.alphaFromRGB,inputs:[[0,0,0,0],W.rgbLevel,W.rgbOffset,W.outputAmount,W.bumpAmount],outputs:[[0,0,0,0]]}};_e(W.colorMap)&&(oe.originData.colorMap=W.colorMap),T.addNode(oe);for(let F=0;F<ne.length;F++){const k=ne[F];for(let q=0;q<k.connections.length;q++){const j=k.connections[q];Ke(T,T.len()-1,0,k.to(),j.to)}}T.disconnect(R,!1);for(let F=0;F<ae.length;F++)T.addEdge(ae[F]);Ke(T,R,0,T.len()-1,0),delete O.output}function p(T,R,O){const W=O.inputs.length/4,ae=T.findInEdges(R),ne=T.findOutEdges(R);for(let oe=0;oe<W;oe++){const F={originData:{name:O.name+"Layer"+oe,type:"LAYERED_TEXTURE_LAYER_MY",inputs:[0,[0,0,0]].concat(O.inputs.slice(4*oe,4*oe+4)),outputs:[0,[0,0,0]]}};T.addNode(F);for(let k=0;k<ae.length;k++){const q=ae[k];for(let j=0;j<q.connections.length;j++){const U=q.connections[j];U.to==4*oe?Ke(T,q.from(),U.from,T.len()-1,2,U.channelMatrix):U.to==4*oe+1?Ke(T,q.from(),U.from,T.len()-1,3,U.channelMatrix):U.to==4*oe+2?Ke(T,q.from(),U.from,T.len()-1,4,U.channelMatrix):U.to==4*oe+3&&Ke(T,q.from(),U.from,T.len()-1,5,U.channelMatrix)}}oe>0&&(Ke(T,T.len()-1,0,T.len()-2,0),Ke(T,T.len()-1,1,T.len()-2,1))}for(let oe=0;oe<ne.length;oe++){const F=ne[oe];for(let k=0;k<F.connections.length;k++){const q=F.connections[k];Ke(T,T.len()-W,q.from,F.to(),q.to,q.channelMatrix)}}}function m(T){return T.type.indexOf("uniform")>-1}function g(T){return T.type.indexOf("varying")>-1}function _(T,R){return R=_e(R)?R:"color",t.nodeVCAliases[T]||R}function A(T,R,O,W){const ae=new gs(T,R,1,O,W,$n.DEFAULT_MAPPING,1001,1001,1006,1006);return ae.name="Node.parametric",ae.needsUpdate=!0,ae}function y(T){return T.isVideoTexture===!0&&T.encoding===3001?"1":!T.isDataTexture||T.encoding!==3001||T.type!=1015&&T.type!=1016?"0":"1"}function b(T,R,O,W,ae){let ne;return R==O?ne=T:R=="float"&&O=="vec3"?ne="vec3("+[T,T,T].join(",")+")":R=="float"&&O=="vec4"?ne="vec4("+[T,T,T,T].join(",")+")":R=="vec3"&&O=="float"||R=="vec4"&&O=="float"?ne="("+[T+"[0]",T+"[1]",T+"[2]"].join("+")+")/3.0":R=="vec3"&&O=="vec4"?ne="vec4("+T+", 1.0)":R=="vec4"&&O=="vec3"?ne="vec3("+[T+"[0]",T+"[1]",T+"[2]"].join(",")+")":R=="float"&&O=="int"?ne="int("+T+")":R=="int"&&O=="float"||R=="bool"&&O=="float"?ne="float("+T+")":console.error("MeshNodeMaterial: Missing type conversion: "+R+" -> "+O),(ae<1||ae!=1&&W=="normal")&&(ne="mix("+W+","+ne+","+H(ae)+")",W=="normal"&&(ne="normalize("+ne+")")),ne}function E(T,R,O,W,ae){let ne;const oe=[],F=ee(O),k=ee(W);for(let q=0;q<k;q++){let j=k==1?ae:ae+"["+q+"]";for(let U=0;U<T.length;U++){const z=T[U],v=R[U];for(let M=0;M<F;M++)v[M][q]&&(j=F==1?z:z+"["+M+"]")}oe.push(j)}return ne=W+"("+oe.join(",")+")",ne}function x(T,R,O,W,ae,ne){for(let oe in T.edges){const F=T.edges[oe];if(F.to()==R){const k=T.node(F.from());for(let q=0;q<F.connections.length;q++){const j=F.connections[q];if(j.to==O){const U=k.originData.type;U!="BITMAP_MX"&&U!="BITMAP_ENV_MX"||G(W)!="float"?ae.push(k.outputs[j.from]):ae.push(k.outputs[j.from+1]),j.channelMatrix&&ne.push(j.channelMatrix)}}}}}function w(T){return{name:"",type:G(T),value:T}}function L(T,R){const O=so(T,R);return{name:O,type:t.nodeTextures[O].isCubeTexture?"uniform samplerCube":"uniform sampler2D",value:""}}function C(T){return{name:"",type:"int",value:T}}function P(T){return D(T?"true":"false")}function D(T){return{name:T,type:"",value:""}}function Q(T,R,O){return O=O||T,{name:"nodeVaryParam"+zg(T),type:"varying "+se(R),value:"",attrBindName:O}}function re(T){return T?1:0}function G(T){return typeof T=="number"?"float":typeof T=="boolean"?"bool":se(T.length)}function se(T){switch(T){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";case 9:return"mat3";case 16:return"mat4"}}function ee(T){switch(T){case"float":case"int":case"bool":return 1;case"vec2":return 2;case"vec3":return 3;case"vec4":return 4;case"mat3":return 9;case"mat4":return 16}}function ie(T,R){switch(T){case"float":return H(R);case"bool":case"int":return String(R);default:const O=[];for(let W=0;W<R.length;W++)O.push(H(R[W]));return T+"("+O.join(",")+")"}}function H(T){return T%1?String(T):String(T)+".0"}this.isMeshNodeMaterial=!0,this.type="MeshNodeMaterial",this.defines={LIGHT_PATH_IS_CAM_RAY:1,WORLD_NODES:0,NORMAL_OUTPUT:0},this.definesFragOnly=new Set(["LIGHT_PATH_IS_CAM_RAY","WORLD_NODES","NORMAL_OUTPUT"]),this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.fog=!0,this.profile="blender",this.nodeTextures={},this.nodeValue=[],this.nodeValueMap={},this.nodeRGB=[],this.nodeRGBMap={},this.nodeTexCoordObject=[],this.nodeTexCoordObjectMap={},this.nodeInputs={},this.needsBoundingBox=!1,this.useFloatTex=!1,this.nodeGraph=null,this.additionalNodeGraphs={},this.nodeChunks={},this.nodeChunksHash=0,this.nodeVCAliases={},this.nodeUVAliases={},this.envMap=null,this.envMapIntensity=1,this.envMapParallaxType=0,this.envMapParallaxMatrix=new Ue,this.envMapParallaxMatrixInv=new Ue,this.materialIndex=0,this.ssrParams=null,_e(e)&&this.setValues(e),this.nodeGraph||(this.nodeGraph=(function(){const T=new Fn(1),R=t.color;return T.node(0).originData={name:"ShadelessOutput",type:"OUTPUT_MATERIAL_BL",inputs:[[R.r,R.g,R.b,1],[0,0,0,0],[0,0,0]],outputs:[],is_active_output:!0},T})()),this.updateNodeGraph=function(T=!1){const R=this.nodeValue,O=this.nodeRGB,W=this.nodeTexCoordObject;this.nodeTextures={},this.nodeRGB=[],this.nodeRGBMap={},this.nodeValue=[],this.nodeValueMap={},this.nodeTexCoordObject=[],this.nodeTexCoordObjectMap={},this.needsBoundingBox=!1,this.nodeChunks={};const ae=this.nodeGraph;if((function(ne){let oe=0,F=0,k=0,q=0,j=0;for(let M=0;M<ne.len();M++){const S=ne.node(M),I=S.originData,J=I.type;let $,B,V,Y,le,me,fe,te,de,we,Ie,Ne,He,je,ct,Vt,En;S.attributes=[],S.params=[],S.inputFactors=[],S.inputs=[],S.outputs=[],_e(I.inputFactors)&&(S.inputFactors=I.inputFactors.slice(0));for(let Rt=0;Rt<I.outputs.length;Rt++){const pe=I.outputs[Rt],Te=I.outputTypes?I.outputTypes[Rt]:G(pe);S.outputs.push({name:OR(db(J))+M+"Out"+Rt,type:Te,clamp:!1,normalize:!1})}switch(J!="OUTPUT_MATERIAL_BL"&&J!="OUTPUT_WORLD_BL"&&J!="OUTPUT_MX"&&J!="SHADING_ENGINE_MY"&&J!="SKYDOME_LIGHT_AR"||S.outputs.push({name:"outgoingLight",type:"",clamp:!1,normalize:!1}),J){case"ATAN_AR":S.params.push(D(I.units));break;case"CLAMP_AR":case"COLOR_TO_FLOAT_AR":case"COLOR_TO_FLOAT_AR":case"FLOAT_TO_INT_AR":case"LENGTH_AR":case"MIX_SHADER_AR":case"RGB_TO_FLOAT_AR":case"RGB_TO_VECTOR_AR":case"RGBA_TO_FLOAT_AR":case"RGB_TO_VECTOR_AR":case"VECTOR_TO_RGB_AR":S.params.push(D(I.mode));break;case"COLOR_CONVERT_AR":S.params.push(D(I.from)),S.params.push(D(I.to));break;case"CHECKERBOARD_AR":case"PLACE_2D_TEXTURE_MY":$=I.uvIndex?"uv"+String(I.uvIndex+1):"uv",B=Q($,2),S.attributes.push({name:$,type:"attribute vec2"}),S.params.push(B);break;case"COMPOSITE_AR":S.params.push(D(I.operation)),S.params.push(D(I.alphaOperation));break;case"FACING_RATIO_AR":case"FACING_RATIO_AR":case"SHADOW_MATTE_AR":case"NORMAL":S.params.push(D("normal"));break;case"COMPARE_AR":S.params.push(D(I.test));break;case"IMAGE_AR":me=I.texture,t.nodeTextures[so(J,oe)]=me,S.params.push(L(J,oe)),oe++,S.params.push(D(y(me)));break;case"LAMBERT_AR":case"BSDF_GLASS_BL":case"BSDF_GLOSSY_BL":case"BLINN_MY":case"LAMBERT_MY":case"PHONG_MY":case"PHONG_E_MY":S.params.push(D("geometryNormal"));break;case"MAP_TO_MTL_AR":S.params.push(P(I.opaqueEnabled));break;case"MATRIX_TRANSFORM_AR":S.params.push(D(I.transformOrder)),S.params.push(D(I.rotationType)),S.params.push(D(I.rotationUnits)),S.params.push(D(I.rotationOrder));break;case"NORMAL_MAP_AR":$="tangent",B=Q($,4),S.attributes.push({name:$,type:"attribute vec4"}),S.params.push(B);break;case"SHUFFLE_AR":case"CHANNELS_MY":S.params.push(D(I.channelR)),S.params.push(D(I.channelG)),S.params.push(D(I.channelB)),S.params.push(D(I.channelA));break;case"STANDARD_SURFACE_AR":S.params.push(D("geometryNormal")),S.params.push(P(I.thinWalled)),(I.inputs[ve[J].clearcoat]>0||pn(ne,M,ve[J].clearcoat))&&(t.defines.USE_CLEARCOAT=""),(I.inputs[ve[J].sheen]>0||pn(ne,M,ve[J].sheen))&&(t.defines.USE_SHEEN=""),S.inputFactors.length=0;break;case"TRIGO_AR":S.params.push(D(I.function)),S.params.push(D(I.units));break;case"TRIPLANAR_AR":S.params.push(D(I.coordSpace)),S.params.push(P(I.inputPerAxis)),S.params.push(P(I.flipOnOppositeDirection)),S.params.push(w(I.blendFactor));break;case"TRIPLANAR_UV_AR":S.params.push(P(I.flipOnOppositeDirection)),I.blendFactor!==void 0&&S.params.push(w(I.blendFactor)),I.projectionAxis!==void 0&&S.params.push(D(I.projectionAxis));break;case"TWO_SIDED_AR":S.params.push(D("faceDirection"));break;case"USER_DATA_COLOR_AR":$=_(I.colorLayer,""),$?(B=Q($,4),S.attributes.push({name:$,type:"attribute vec4"}),S.params.push(B)):S.params.push(D(ie("vec4",I.defaultColor)));break;case"UV_PROJECTION_AR":S.params.push(D(I.projectionType)),S.params.push(D(I.coordSpace));break;case"ATTRIBUTE_BL":case"VERTEX_COLOR_BL":$=_(I.colorLayer,""),$?(B=Q($,4),S.attributes.push({name:$,type:"attribute vec4"}),S.params.push(B)):S.params.push(D("vec4(0.0, 0.0, 0.0, 1.0)"));break;case"BSDF_METALLIC_BL":S.params.push(D("geometryNormal")),S.params.push(D("BSDF_METALLIC_"+I.distribution)),S.params.push(P(I.fresnelType==="PHYSICAL_CONDUCTOR"));break;case"BSDF_PRINCIPLED_BL":S.params.push(D("geometryNormal"));const Rt=ub(S);(I.inputs[ve[Rt].clearcoat]>0||pn(ne,M,ve[Rt].clearcoat))&&(t.defines.USE_CLEARCOAT=""),(I.inputs[ve[Rt].sheen]>0||pn(ne,M,ve[Rt].sheen))&&(t.defines.USE_SHEEN_BLENDER="");break;case"BSDF_REFRACTION_BL":S.params.push(D("geometryNormal")),S.params.push(D("BSDF_REFRACTION_"+I.distribution));break;case"BUMP_BL":S.params.push(w(I.invert));break;case"CAMERA_BL":S.params.push(D("vViewPosition")),a(ne,"OUTPUT_MATERIAL_BL")>0||a(ne,"OUTPUT_WORLD_BL")>0?S.params.push(P(!0)):S.params.push(P(!1));break;case"CLAMP_BL":S.params.push(D(I.clampType=="RANGE"));break;case"COMBINE_COLOR_BL":S.params.push(D("NODE_COMB_COL_"+I.mode));break;case"CURVE_FLOAT_BL":t.useFloatTex?(V=new Float32Array(1024),Y=1):(V=new Uint8Array(1024),Y=255);for(let De=0;De<256;De++){let Bt=Y*(I.curveData[De]/2+.5);V[4*De]=Ht(Bt,0,Y)}me=A(V,256,1023,t.useFloatTex?1015:1009),fe=so(J,F),t.nodeTextures[fe]=me,S.params.push(L(J,F)),F++;break;case"CURVE_RGB_BL":case"CURVE_VEC_BL":t.useFloatTex?(V=new Float32Array(1024),Y=1):(V=new Uint8Array(1024),Y=255);for(let De=0;De<256;De++){let Bt,ce,Se,Me;de=I.curveData.length/256,de>3?(Bt=Y*I.curveData[de*De],ce=Y*I.curveData[de*De+1],Se=Y*I.curveData[de*De+2],Me=Y*I.curveData[de*De+3]):(Bt=Y*(I.curveData[de*De]/2+.5),ce=Y*(I.curveData[de*De+1]/2+.5),Se=Y*(I.curveData[de*De+2]/2+.5),Me=Y),V[4*De]=Ht(Bt,0,Y),V[4*De+1]=Ht(ce,0,Y),V[4*De+2]=Ht(Se,0,Y),V[4*De+3]=Ht(Me,0,Y)}me=A(V,256,1023,t.useFloatTex?1015:1009),fe=so(J,F),t.nodeTextures[fe]=me,S.params.push(L(J,F)),F++;break;case"EEVEE_SPECULAR_BL":S.params.push(D("geometryNormal")),(I.inputs[ve[J].clearcoat]>0||pn(ne,M,ve[J].clearcoat))&&(t.defines.USE_CLEARCOAT="");break;case"FRESNEL_BL":case"LAYER_WEIGHT_BL":case"INCIDENT":case"POSITION":S.params.push(D("vViewPosition"));break;case"GRADIENT_MX":S.params.push(D(ie("float",I.color2Pos))),S.params.push(D(ie("int",I.gradientType))),$=I.uvIndex?"uv"+String(I.uvIndex+1):"uv",B=Q($,2),S.attributes.push({name:$,type:"attribute vec2"}),S.params.push(B),S.params.push(D("vViewPosition")),S.params.push(D("MAPPING_"+I.mapping)),S.params.push(D("AXIS_"+I.axis)),S.params.push(D(ie("ivec2",[re(I.clampToEdgeNoExtend[0]),re(I.clampToEdgeNoExtend[1])])));break;case"GRADIENT_RAMP_MX":t.useFloatTex?(V=new Float32Array(2048),Y=1):(V=new Uint8Array(2048),Y=255);for(let De=0;De<512;De++){let Bt,ce,Se,Me;Bt=Y*I.gradientData[3*De],ce=Y*I.gradientData[3*De+1],Se=Y*I.gradientData[3*De+2],Me=1,V[4*De]=Ht(Bt,0,Y),V[4*De+1]=Ht(ce,0,Y),V[4*De+2]=Ht(Se,0,Y),V[4*De+3]=Ht(Me,0,Y)}me=A(V,512,1023,t.useFloatTex?1015:1009),fe=so(J,F),t.nodeTextures[fe]=me,S.params.push(L(J,F)),F++,S.params.push(D(ie("int",I.gradientType))),$=I.uvIndex?"uv"+String(I.uvIndex+1):"uv",B=Q($,2),S.attributes.push({name:$,type:"attribute vec2"}),S.params.push(B),S.params.push(D("geometryNormal")),S.params.push(D("vViewPosition")),["SPHERICAL_ENVIRONMENT","CYLINDRICAL_ENVIRONMENT","SHRINK_WRAP_ENVIRONMENT","SCREEN"].indexOf(I.mapping)>-1?S.params.push(D("MAPPING_EXPLICIT_MAP_CHANNEL")):S.params.push(D("MAPPING_"+I.mapping)),S.params.push(D("AXIS_"+I.axis)),S.params.push(D(ie("ivec2",[re(I.clampToEdgeNoExtend[0]),re(I.clampToEdgeNoExtend[1])])));break;case"MAPPING_BL":S.params.push(D("NODE_MAPPING_"+I.vectorType));break;case"MAP_RANGE_BL":_e(I.dataType)&&S.params.push(D("NODE_MAP_RANGE_TYPE_"+I.dataType)),S.params.push(D("NODE_MAP_RANGE_INTERP_"+I.interpolationType)),S.params.push(P(I.clamp));break;case"NEW_GEOMETRY_BL":S.params.push(D("faceDirection")),S.params.push(D("vViewPosition")),S.params.push(D("normal")),Ju(ne,M,it.NEW_GEOMETRY_BL.tangent)&&(t.needsBoundingBox=!0);break;case"NORMAL_MAP_BL":$="tangent",B=Q($,4),S.attributes.push({name:$,type:"attribute vec4"}),S.params.push(B),S.params.push(D("vNormal"));break;case"SEPARATE_COLOR_BL":S.params.push(D("NODE_SEP_COL_"+I.mode));break;case"TANGENT_BL":I.directionType==="RADIAL"?(S.params.push(D("TANGENT_AXIS_"+I.axis)),S.params.push(D("vViewPosition")),S.params.push(D("normal")),t.needsBoundingBox=!0):I.directionType==="UV_MAP"&&($="tangent",B=Q($,4),S.attributes.push({name:$,type:"attribute vec4"}),S.params.push(B));break;case"TEX_BRICK_BL":S.params.push(D(ie("float",I.offset))),S.params.push(D(ie("int",I.offsetFrequency))),S.params.push(D(ie("float",I.squash))),S.params.push(D(ie("int",I.squashFrequency)));break;case"TEX_COORD_BL":S.params.push(D(`nodeTexCoordObjectMatrices[${q}]`)),S.params.push(D("vViewPosition")),S.params.push(D("normal")),$="uv",B=Q($,2),S.attributes.push({name:$,type:"attribute vec2"}),S.params.push(B),Ju(ne,M,it.TEX_COORD_BL.generated)&&(t.needsBoundingBox=!0),t.nodeTexCoordObject.push(null),t.nodeTexCoordObjectMap[I.name]=q,q++;break;case"TEX_ENVIRONMENT_BL":case"TEX_IMAGE_BL":if(me=I.texture,t.nodeTextures[so(J,oe)]=me,S.params.push(L(J,oe)),oe++,S.params.push(D(y(me))),J=="TEX_ENVIRONMENT_BL"){const De=I.projection;S.params.push(D("TEX_PROJ_"+De))}else if(J=="TEX_IMAGE_BL"){let De;switch(I.alphaMode||"STRAIGHT"){case"STRAIGHT":De=Ju(ne,M,1)?"TEX_ALPHA_CLEAR":"TEX_ALPHA_PREMUL";break;case"PREMUL":De=Ju(ne,M,1)?"TEX_ALPHA_UNPREMUL":"TEX_ALPHA_CLEAR";break;case"CHANNEL_PACKED":De="TEX_ALPHA_CLEAR";break;case"NONE":De="TEX_ALPHA_ONE";break;default:console.error("MeshNodeMaterial: incorrect TEX_IMAGE_BL alpha mode"),De="TEX_ALPHA_ONE"}S.params.push(D(De)),S.params.push(D("normal"));const Bt=I.projection;S.params.push(D("TEX_PROJ_"+Bt)),S.params.push(w(I.projectionBlend)),S.params.push(P(I.clampToEdgeNoExtend))}break;case"TEX_GABOR_BL":S.params.push(D("TEX_GABOR_"+I.gaborType));break;case"TEX_GRADIENT_BL":S.params.push(D("TEX_GRAD_"+I.gradientType));break;case"TEX_NOISE_BL":_e(I.noiseType)&&S.params.push(D("TEX_NOISE_"+I.noiseType)),S.params.push(D(ie("float",I.falloffFactor))),S.params.push(D(ie("float",I.dispersionFactor)));break;case"TEX_SKY_BL":if(Ie=new N().fromArray(I.sunDirection).angleTo(new N(0,0,1)),I.skyType=="PREETHAM")Ne=li.getDistParams(I.turbidity,0).concat([0,0,0,0]),He=li.getDistParams(I.turbidity,1).concat([0,0,0,0]),je=li.getDistParams(I.turbidity,2).concat([0,0,0,0]),ct=li.getZenithParams(I.turbidity,Ie,0),Vt=li.getZenithParams(I.turbidity,Ie,1),En=li.getZenithParams(I.turbidity,Ie,2);else if(I.skyType=="HOSEK_WILKIE"){const De=Math.max(Math.PI/2-Ie,0);Ne=Zu.getDistParams(I.turbidity,I.groundAlbedo,De,0),He=Zu.getDistParams(I.turbidity,I.groundAlbedo,De,1),je=Zu.getDistParams(I.turbidity,I.groundAlbedo,De,2),ct=Zu.getRadiance(I.turbidity,I.groundAlbedo,De,0),Vt=Zu.getRadiance(I.turbidity,I.groundAlbedo,De,1),En=Zu.getRadiance(I.turbidity,I.groundAlbedo,De,2)}else Ne=He=je=new Array(9).fill(0),ct=Vt=En=0;S.params.push(D("TEX_SKY_"+I.skyType)),S.params.push(w([Ne[0],He[0],je[0]])),S.params.push(w([Ne[1],He[1],je[1]])),S.params.push(w([Ne[2],He[2],je[2]])),S.params.push(w([Ne[3],He[3],je[3]])),S.params.push(w([Ne[4],He[4],je[4]])),S.params.push(w([Ne[5],He[5],je[5]])),S.params.push(w([Ne[6],He[6],je[6]])),S.params.push(w([Ne[7],He[7],je[7]])),S.params.push(w([Ne[8],He[8],je[8]])),S.params.push(w([ct,Vt,En])),S.params.push(w(I.sunDirection));break;case"TEX_VORONOI_BL":S.params.push(D("DISTANCE_"+I.distance)),S.params.push(D("FEATURE_"+I.feature));break;case"TEX_WAVE_BL":S.params.push(D("TEX_WAVE_TYPE_"+I.waveType)),S.params.push(D("TEX_WAVE_PROFILE_"+I.waveProfile)),S.params.push(D(`TEX_WAVE_BANDS_DIR_${I.bandsDirection}`)),S.params.push(D(`TEX_WAVE_RINGS_DIR_${I.ringsDirection}`));break;case"MATH_BL":S.outputs[0].clamp=I.useClamp;break;case"MIX_BL":switch(S.originData.blendType){case"HUE":case"SATURATION":case"VALUE":case"COLOR":t.defines.HSV_NODES=""}I.dataType=="RGBA"&&(S.outputs[0].clamp=I.clampResult);break;case"MIX_RGB_BL":switch(S.originData.blendType){case"HUE":case"SATURATION":case"VALUE":case"COLOR":t.defines.HSV_NODES=""}S.outputs[0].clamp=I.useClamp;break;case"MIX_SHADER_BL":let pe=-1;for(let De=1;De<3;De++){const Bt=xt(ne,M,De);Bt&&Bt.originData.type=="BSDF_TRANSPARENT_BL"&&(pe=De-1)}S.params.push(D(String(pe)));break;case"NORMAL_BL":S.params.push(w(I.outputs[0]));break;case"RGB_BL":case"RGB_MX":te=new pt().fromArray(I.outputs[0]),t.nodeRGB.push(te),t.nodeRGBMap[I.name]=k,S.params.push(D("nodeRGB["+k+"]")),k++;break;case"SUB_TRANSFORM_MX":case"SUB_TRANSFORM_MY":S.params.push(D(I.coordSpace));break;case"UVMAP_BL":U=I.uvLayer,$=t.nodeUVAliases[U]||"uv",B=Q($,2),S.attributes.push({name:$,type:"attribute vec2"}),S.params.push(B);break;case"VALUE_BL":case"VALUE_MX":case"ANIM_CURVE_TA_MY":case"ANIM_CURVE_TU_MY":case"VALUE":te=I.outputs[0],t.nodeValue.push(te),t.nodeValueMap[I.name]=j,S.params.push(D("nodeValue["+j+"]")),j++;break;case"VALTORGB_BL":we=I.curve;const Te=new(we.interpolation=="STEP"?lb:z0)(new Float32Array(we.input),new Float32Array(we.output),4);t.useFloatTex?(V=new Float32Array(1024),Y=1):(V=new Uint8Array(1024),Y=255);for(let De=0;De<256;De++){const Bt=Te.evaluate(De/255);V[4*De]=Y*Bt[0],V[4*De+1]=Y*Bt[1],V[4*De+2]=Y*Bt[2],V[4*De+3]=Y*Bt[3]}me=A(V,256,1023,t.useFloatTex?1015:1009),we.interpolation=="STEP"&&(me.minFilter=1003,me.magFilter=1003),fe=so(J,F),t.nodeTextures[fe]=me,S.params.push(L(J,F)),F++;break;case"VECTOR_ROTATE_BL":S.params.push(D(ie("float",I.invert?-1:1)));break;case"VECT_TRANSFORM_BL":const Ce=I.vectorType,Zt=I.convertFrom,rt=I.convertTo;Ce=="NORMAL"&&(S.outputs[0].normalize=!0);let rn="";Zt==rt?rn="VEC_TRANS_NONE":(rn="VEC_TRANS_"+Zt[0]+"_"+rt[0],Ce!="VECTOR"&&Ce!="NORMAL"||(rn+="_DIR")),S.params.push(D(rn)),a(ne,"OUTPUT_MATERIAL_BL")>0||a(ne,"OUTPUT_WORLD_BL")>0?S.params.push(P(!0)):S.params.push(P(!1));break;case"BITMAP_MX":case"BITMAP_ENV_MX":case"REFLECT_REFRACT_MX":if(me=I.texture,t.nodeTextures[so(J,oe)]=me,S.params.push(L(J,oe)),oe++,J=="BITMAP_MX"){$=I.uvIndex?"uv"+String(I.uvIndex+1):"uv",B=Q($,2),S.attributes.push({name:$,type:"attribute vec2"}),S.params.push(B),S.params.push(D("MAPPING_"+I.mapping)),S.params.push(D("AXIS_"+I.axis));const De=ie("ivec2",[re(I.clampToEdgeNoExtend[0]),re(I.clampToEdgeNoExtend[1])]);S.params.push(D(De))}else S.params.push(D(I.reflectMode)),S.params.push(w(I.IOR));S.params.push(D(y(me))),J!="BITMAP_MX"&&J!="BITMAP_ENV_MX"||(S.params.push(P(I.alphaAsMono)),S.params.push(P(I.alphaAsRGB)),S.outputs.push({name:J.toLowerCase()+"_out1_n"+M,type:"float",clamp:!1,normalize:!1}));break;case"BLEND_MX":S.params.push(P(I.useCurve)),S.params.push(w(I.curveLower)),S.params.push(w(I.curveUpper));break;case"BUMP_MX":me=I.texture,t.nodeTextures[so(J,oe)]=me,S.params.push(L(J,oe)),oe++,S.params.push(D("-vViewPosition")),S.params.push(D("normal")),$=I.uvIndex?"uv"+String(I.uvIndex+1):"uv",B=Q($,2),S.attributes.push({name:$,type:"attribute vec2"}),S.params.push(B);break;case"COLOR_CORRECTION_MX":const Di=ie("ivec4",[I.rewireR,I.rewireG,I.rewireB,I.rewireA]);S.params.push(D(Di)),I.gainPivotGammaLift&&(S.params.push(w(I.gainPivotGammaLift)),S.params.push(P(I.enableR)),S.params.push(P(I.enableG)),S.params.push(P(I.enableB)),S.params.push(C(I.exposureMode)),S.params.push(w(I.printerLights)));break;case"COMPOSITE_LAYER_MX":S.params.push(D(ie("int",I.blendMode)));const xo=pn(ne,M,1)?I.opacity:0;S.params.push(w(xo));break;case"COLOR_MAP_MX":S.params.push(P(I.reverseGamma));break;case"FALLOFF_MX":if(S.params.push(D("-vViewPosition")),I.falloffType!=4)S.params.push(w(I.IOR)),S.params.push(C(I.falloffType));else{const De=I.extrapolateOn!==void 0&&I.extrapolateOn,Bt=I.nearDistance===void 0?0:I.nearDistance,ce=I.farDistance===void 0?100:I.farDistance;S.params.push(P(De)),S.params.push(w(Bt)),S.params.push(w(ce))}break;case"MASK_MX":S.params.push(P(I.maskInverted));break;case"MATERIAL_MX":S.params.push(w(I.inputFactors[ve[J].reflection])),S.params.push(w(I.inputFactors[ve[J].refraction])),I.inputFactors[ve[J].reflection]=1,I.inputFactors[ve[J].refraction]=1,S.params.push(P(I.selfIllumColorOn));break;case"MATTE_SHADOW_MX":S.params.push(D("normal")),S.params.push(P(I.receiveShadows)),S.params.push(w(I.shadowBrightness)),S.params.push(w(I.color));break;case"NOISE_MX":I.coordType==2?($=I.uvIndex?"uv"+String(I.uvIndex+1):"uv",B=Q($,2),S.attributes.push({name:$,type:"attribute vec2"}),S.params.push(B)):S.params.push(D("vViewPosition")),S.params.push(C(I.noiseType)),S.params.push(C(I.coordType));break;case"NORMAL_BUMP_MX":$="tangent",B=Q($,4),S.attributes.push({name:$,type:"attribute vec4"}),S.params.push(B),S.params.push(D("normal"));const Eo="ivec2("+re(I.flip[0])+","+re(I.flip[1])+")";S.params.push(D(Eo));break;case"OPENPBR_SURFACE_MX":case"OPENPBR_SURFACE_MY":S.params.push(D("geometryNormal")),S.params.push(P(I.thinWalled)),(I.inputs[ve[J].coatWeight]>0||pn(ne,M,ve[J].coatWeight))&&(t.defines.USE_CLEARCOAT=""),(I.inputs[ve[J].fuzzWeight]>0||pn(ne,M,ve[J].fuzzWeight))&&(t.defines.USE_SHEEN="");break;case"OUTPUT_MAP_MX":if(S.params.push(P(I.invert)),S.params.push(P(I.clamp)),S.params.push(P(I.alphaFromRGB)),I.colorMap){t.useFloatTex?(le=I.colorMap,V=new Float32Array(1024),Y=1):(le=NR(I.colorMap.slice(),0,1),V=new Uint8Array(1024),Y=255),de=le.length/256;for(let De=0;De<256;De++)V[4*De]=Y*le[de*De],de==3?(V[4*De+1]=Y*le[de*De+1],V[4*De+2]=Y*le[de*De+2]):(V[4*De+1]=V[4*De],V[4*De+2]=V[4*De]),V[4*De+3]=Y;me=A(V,256,1023,t.useFloatTex?1015:1009),fe=so(J,F),t.nodeTextures[fe]=me,S.params.push(L(J,F)),F++}break;case"PHYSICAL_MX":S.params.push(D("geometryNormal")),S.params.push(w(I.emitLuminance));const jn=I.brdfMode===void 0||I.brdfMode,xl=I.brdfLow===void 0?0:I.brdfLow,Sc=I.brdfHigh===void 0?0:I.brdfHigh,wc=I.brdfCurve===void 0?0:I.brdfCurve;S.params.push(P(!jn)),S.params.push(D(ie("float",xl))),S.params.push(D(ie("float",Sc))),S.params.push(D(ie("float",wc))),S.params.push(P(_e(I.roughnessInv)&&I.roughnessInv)),S.params.push(P(_e(I.transRoughnessLock)&&I.transRoughnessLock)),S.params.push(P(_e(I.transRoughnessInv)&&I.transRoughnessInv)),S.params.push(P(_e(I.thinWalled)&&I.thinWalled)),(I.inputs[ve[J].clearcoat]>0||pn(ne,M,ve[J].clearcoat))&&(t.defines.USE_CLEARCOAT="");break;case"PHY_SUN_SKY_ENV_MX":const Vr=15*I.haze+2,Ms=new xa;Ie=Math.PI/2-I.sunPolarAngle;const Mc=Math.PI-I.sunAzimuthAngle;Ms.phi=Ie,Ms.theta=Mc;const oa=new N().setFromSpherical(Ms).toArray();Ne=li.getDistParams(Vr,0),He=li.getDistParams(Vr,1),je=li.getDistParams(Vr,2),ct=li.getZenithParams(Vr,Ie,0),Vt=li.getZenithParams(Vr,Ie,1),En=li.getZenithParams(Vr,Ie,2),ct/=.06,ct*=1e3,S.params.push(w([Ne[0],He[0],je[0]])),S.params.push(w([Ne[1],He[1],je[1]])),S.params.push(w([Ne[2],He[2],je[2]])),S.params.push(w([Ne[3],He[3],je[3]])),S.params.push(w([Ne[4],He[4],je[4]])),S.params.push(w([ct,Vt,En]));const Ed=li.getSunIlluminance(oa,Vr),Ts=[0,0,0];S.params.push(w(oa)),S.params.push(w(Ed)),S.params.push(w(Ts)),S.params.push(w(I.globalIntensity/O_e)),S.params.push(w(I.groundColor));break;case"REFLECT_REFRACT_COLOR_MX":te=I.outputs[0],S.params.push(w(te));break;case"VERTEX_COLOR_MX":$="color",B=Q($,3),S.attributes.push({name:$,type:"attribute vec3"}),S.params.push(B);break;case"BUMP_2D_MY":S.params.push(D("vNormal")),I.bumpInterp>0&&($="tangent",B=Q($,4),S.attributes.push({name:$,type:"attribute vec4"}),S.params.push(B));break;case"COLOR_COMPOSITE_MY":case"COLOR_LOGIC_MY":case"COLOR_MATH_MY":case"CONDITION_MY":case"FLOAT_COMPOSITE_MY":case"FLOAT_LOGIC_MY":case"FLOAT_MATH_MY":case"MULTIPLY_DIVIDE_MY":S.params.push(D(I.operation));break;case"COLOR_CORRECT_MY":S.params.push(P(I.colClamp)),S.params.push(w(I.colClampMin)),S.params.push(w(I.colClampMax)),S.params.push(P(I.alphaClamp)),S.params.push(w(I.alphaClampMin)),S.params.push(w(I.alphaClampMax)),S.params.push(P(I.unpremultiplyInput)),S.params.push(P(I.premultiplyResult));break;case"COLOR_MASK_MY":S.params.push(P(I.maskAlphaIsLuminance));break;case"COMPOSE_MATRIX_MY":S.params.push(P(I.useEulerRotation)),S.params.push(D(I.inputRotateOrder));break;case"FILE_MY":case"ENV_SPHERE_MY":if(me=I.texture,t.nodeTextures[so(J,oe)]=me,S.params.push(L(J,oe)),oe++,S.params.push(D(y(me))),J=="ENV_SPHERE_MY")S.params.push(D("normal"));else{const De=I.fileHasAlpha===!1;S.params.push(P(De&&Ju(ne,M,it.FILE_MY.alpha)))}break;case"RAMP_MY":t.useFloatTex?(V=new Float32Array(2048),Y=1):(V=new Uint8Array(2048),Y=255);for(let De=0;De<512;De++){const Bt=Y*I.rampData[3*De],ce=Y*I.rampData[3*De+1],Se=Y*I.rampData[3*De+2];V[4*De]=Ht(Bt,0,Y),V[4*De+1]=Ht(ce,0,Y),V[4*De+2]=Ht(Se,0,Y),V[4*De+3]=Y}me=A(V,512,1023,t.useFloatTex?1015:1009),fe=so(J,F),t.nodeTextures[fe]=me,S.params.push(L(J,F)),F++,S.params.push(D(ie("int",I.rampType))),S.params.push(D(ie("int",I.wrapS))),S.params.push(D(ie("int",I.wrapT))),t.defines.RAMP_TEX_SIZE=512,t.definesFragOnly.add("RAMP_TEX_SIZE");break;case"SAMPLER_INFO_MY":S.params.push(D("faceDirection")),$="tangent",B=Q($,4),S.attributes.push({name:$,type:"attribute vec4"}),S.params.push(B),$="uv",B=Q($,2),S.attributes.push({name:$,type:"attribute vec2"}),S.params.push(B);break;case"UNIT_CONVERSION_MY":S.params.push(w(I.conversionFactor));break;case"VECTOR_PRODUCT_MY":S.params.push(D(I.operation)),S.params.push(P(I.normalizeOutput));break;case"OSL_NODE":_e(I.texture)&&(me=I.texture,t.nodeTextures[so(J,oe)]=me,S.params.push(L(J,oe)),oe++);const fi=I.globalVariables||[];fi.indexOf("P")>-1&&S.params.push(D("oslGetP(vViewPosition)")),fi.indexOf("I")>-1&&S.params.push(D("oslGetI(vViewPosition)")),fi.indexOf("N")>-1&&S.params.push(D("oslGetN(normal)")),(fi.indexOf("u")>-1||fi.indexOf("v")>-1)&&($="uv",S.attributes.push({name:$,type:"attribute vec2"}),fi.indexOf("u")>-1&&S.params.push(Q($+"_u",1,$+".x")),fi.indexOf("v")>-1&&S.params.push(Q($+"_v",1,"1.0 - "+$+".y")));break;case"RGB_ALPHA":te=new pt().fromArray(I.outputs[0].concat([I.outputs[1]])),t.nodeRGB.push(te),t.nodeRGBMap[I.name]=k,S.params.push(D("nodeRGB["+k+"]")),k++;break;case"U_FLOAT":$="uv",B=Q($,2),S.attributes.push({name:$,type:"attribute vec2"}),S.params.push(B)}}var U;const z={},v={};for(let M=0;M<ne.len();M++){const S=ne.node(M),I=S.originData,J=I.type;for(let $=0;$<I.inputs.length;$++){const B=I.inputs[$],V=I.inputTypes?I.inputTypes[$]:G(B),Y=[],le=[];x(ne,M,$,B,Y,le);const me=d(J,$);if(Y.length){let fe,te;if(fe=S.inputFactors.length?S.inputFactors[$]:1,te=me?"normal":ie(V,B),le.length){const de=Y.map((function(we){return we.name}));S.inputs.push({code:E(de,le,Y[0].type,V,te)})}else Y.length==1||console.error(`MeshNodeMaterial: wrong ${J} node connections`),S.inputs.push({code:b(Y[0].name,Y[0].type,V,te,fe)})}else if(me)S.inputs.push({code:"normal"});else if(typeof B=="string")S.inputs.push({code:B});else{z[V]=z[V]||[],Array.isArray(B)?z[V].push(...B):z[V].push(B),V in v||(v[V]=0);let fe=v[V];S.inputs.push({code:`nodeInputs${zg(V)}[${fe}]`}),v[V]++}}}t.nodeInputs={};for(const M in z)t.nodeInputs[M]=M=="int"||M=="bool"?new Int32Array(z[M]):new Float32Array(z[M])})(ae),(function(ne){const oe=[],F=[],k=[],q=[],j=new F0(ne).order();t.defines.NODE_RGB_NUM=t.nodeRGB.length,t.defines.NODE_VALUE_NUM=t.nodeValue.length,t.defines.NODE_TEX_COORD_NUM=t.nodeTexCoordObject.length,t.definesFragOnly.add("NODE_RGB_NUM"),t.definesFragOnly.add("NODE_VALUE_NUM"),t.definesFragOnly.add("NODE_TEX_COORD_NUM");for(let U=0;U<j.length;U++){const z=ne.node(j[U]),v=z.originData.type;let M,S;if(t.defines["NODE_"+v]="",v!="REFLECT_REFRACT_MX"&&v!="BITMAP_ENV_MX"&&v!="BUMP_BL"&&v!="PHY_SUN_SKY_ENV_MX"&&v!="ENV_SPHERE_MY"&&v!="UV_PROJECTION_AR"&&v!="TRIPLANAR_AR"&&v!="TRIPLANAR_UV_AR"&&v!="SUB_TRANSFORM_MX"&&v!="SUB_TRANSFORM_MY"&&t.definesFragOnly.add("NODE_"+v),v=="OSL_NODE"&&(t.defines.USE_OSL=""),v!="OSL_NODE"){const I="node_"+v.toLowerCase()+"_vert";M=Qe[I]}else M=z.originData.vertCode;if(M&&oe.indexOf(M)<0&&oe.push(M),v!="OSL_NODE"){const I="node_"+v.toLowerCase()+"_frag";S=Qe[I]}else S=z.originData.fragCode;S&&k.indexOf(S)<0&&k.push(S);for(let I=0;I<z.attributes.length;I++){const J=z.attributes[I],$=J.type+" "+J.name+";";J.name!="uv"&&oe.indexOf($)<0&&oe.push($)}for(let I=0;I<z.params.length;I++){const J=z.params[I];if(m(J)){const $=J.type+" "+J.name+";";k.indexOf($)<0&&k.push($)}else if(g(J)){const $=J.type+" "+J.name+";";oe.indexOf($)<0&&oe.push($);const B=J.type+" "+J.name+";";k.indexOf(B)<0&&k.push(B)}}}for(const U in t.nodeInputs){const z=t.nodeInputs[U].length/ee(U);k.push(`uniform ${U} nodeInputs${zg(U)}[${z}];`)}_e(t.defines.USE_OSL)&&k.unshift("#include <node_osl_frag>");for(let U=0;U<j.length;U++){const z=ne.node(j[U]),v=z.originData.type;if(v=="CHECKERBOARD_AR"||v=="IMAGE_AR"||v=="TWO_SIDED_AR"||v=="USER_DATA_COLOR_AR"||v=="ATTRIBUTE_BL"||v=="NEW_GEOMETRY_BL"||v=="NORMAL_MAP_BL"||v=="TANGENT_BL"||v=="TEX_COORD_BL"||v=="UVMAP_BL"||v=="VERTEX_COLOR_BL"||v=="BITMAP_MX"||v=="NOISE_MX"||v=="NORMAL_BUMP_MX"||v=="BUMP_MX"||v=="VERTEX_COLOR_MX"||v=="GRADIENT_MX"||v=="GRADIENT_RAMP_MX"||v=="BUMP_2D_MY"||v=="PLACE_2D_TEXTURE_MY"||v=="SAMPLER_INFO_MY"||v=="OSL_NODE"||v=="U_FLOAT")for(let I=0;I<z.params.length;I++){const J=z.params[I];if(g(J)){const $=J.name+"="+J.attrBindName+";";F.includes($)||(F.push($),J.name.includes("Tangent")&&F.push(["#ifdef USE_SKINNING",`    ${J.name}.xyz = vec4(skinMatrix * vec4(${J.name}.xyz, 0.0)).xyz;`,"#endif"].join(`
`)))}}for(let I=0;I<z.outputs.length;I++){const J=z.outputs[I];J.type&&q.push(J.type+" "+J.name+";")}const M=[];for(let I=0;I<z.params.length;I++){const J=z.params[I];!J.type||m(J)||g(J)?M.push(J.name):M.push(ie(J.type,J.value))}for(let I=0;I<z.inputs.length;I++){const J=z.inputs[I];M.push(J.code)}for(let I=0;I<z.outputs.length;I++){const J=z.outputs[I];M.push(J.name)}let S;switch(S=v!="OSL_NODE"?"node_"+db(v).toLowerCase():z.originData.shaderName,v){case"MATH_BL":case"VECT_MATH_BL":S+="_"+z.originData.operation.toLowerCase();break;case"VECTOR_ROTATE_BL":S+="_"+z.originData.rotationType.toLowerCase();break;case"MIX_BL":S+="_"+z.originData.dataType.toLowerCase(),z.originData.dataType=="RGBA"?S+="_"+z.originData.blendType.toLowerCase():z.originData.dataType=="VECTOR"&&(S+="_"+z.originData.factorMode.toLowerCase());break;case"MIX_RGB_BL":S+="_"+z.originData.blendType.toLowerCase();break;case"TEX_WHITE_NOISE_BL":S+="_"+z.originData.noise_dimension.toLowerCase()}q.push(S+"("+M.join(",")+");");for(let I=0;I<z.outputs.length;I++){const J=z.outputs[I],$=J.name;if(J.clamp){const B=J.type;q.push($+"=clamp("+$+","+B+"(0.0),"+B+"(1.0));")}J.normalize&&q.push($+"=normalize("+$+");")}}t.nodeChunks.node_pars_vertex=oe.join(`
`),t.nodeChunks.node_vertex=F.join(`
`),t.nodeChunks.node_pars_fragment=k.join(`
`),t.nodeChunks.node_fragment=q.join(`
`),t.nodeChunksHash=Eu(JSON.stringify(t.nodeChunks))})(ae),T)if(this.nodeValue.length==R.length&&this.nodeRGB.length==O.length&&this.nodeTexCoordObject.length==W.length){for(let ne=0;ne<this.nodeValue.length;ne++)this.nodeValue[ne]=R[ne];for(let ne=0;ne<this.nodeRGB.length;ne++)this.nodeRGB[ne]=O[ne];for(let ne=0;ne<this.nodeTexCoordObject.length;ne++)this.nodeTexCoordObject[ne]=W[ne]}else console.error("v3d.MeshNodeMaterial: Unable to preserve node variables");this.needsUpdate=!0},(function(T){for(let R=0;R<T.len();R++){const O=T.node(R),W=O.originData.type;if(W!="GROUP_BL")if(W!="REROUTE_BL"){if(W=="OSL_OUTPUT_SELECTOR_MX"){const ae=T.findInEdges(R),ne=T.findOutEdges(R),oe=ae[0],F=oe.connections[0];for(let k=0;k<ne.length;k++){const q=ne[k],j=new si(oe.from(),q.to());j.connections=[];for(let U=0;U<q.connections.length;U++){const z=q.connections[U],v={from:F.from,to:z.to};j.connections.push(v)}T.addEdge(j)}T.disconnect(R,!0),R=-1}}else{T.findInEdges(R).length<1&&r(T,R);const ae=T.findInEdges(R),ne=T.findOutEdges(R),oe=ae[0],F=oe.connections[0];for(let k=0;k<ne.length;k++){const q=ne[k];let j=T.edge(oe.from(),q.to());j||(j=new si(oe.from(),q.to()),j.connections=[],T.addEdge(j));for(let U=0;U<q.connections.length;U++){const z=q.connections[U],v={from:F.from,to:z.to};j.connections.push(v)}}T.disconnect(R,!0),R=-1}else{const ae=O.originData.nodeGraph,ne=t.additionalNodeGraphs[ae];if(r(T,R),ne.len()<=2){const k=T.findInEdges(R),q=T.findOutEdges(R),j=Math.min(k.length,q.length);for(let U=0;U<j;U++){const z=k[U],v=q[U],M=new si(z.from(),v.to());M.connections=[];const S=Math.min(z.connections.length,v.connections.length);for(let I=0;I<S;I++){const J=z.connections[I],$=v.connections[I],B={from:J.from,to:$.to};M.connections.push(B)}T.addEdge(M)}T.disconnect(R,!0),R=-1;continue}const oe=i(T,ne,R);T.insert(ne,oe.inputs,oe.outputs);const F=oe.removedNodes.sort((function(k,q){return q-k}));for(let k=0;k<F.length;k++)T.disconnect(F[k],!0);R=-1}}})(t.nodeGraph),(function(T){for(let O=0;O<T.len();O++){const W=T.node(O),ae=W.originData,ne=ae.type;if(ne=="TEX_IMAGE_BL"&&!pn(T,O,0)){const F={originData:{name:"UVMapGenerated",type:"UVMAP_BL",uvLayer:"",inputs:[],outputs:[[0,0,0]]}};T.addNode(F),Ke(T,T.len()-1,0,O,0)}if((ne=="TEX_BRICK_BL"||ne=="TEX_CHECKER_BL"||ne=="TEX_GABOR_BL"||ne=="TEX_GRADIENT_BL"||ne=="TEX_NOISE_BL"||ne=="TEX_WAVE_BL"||ne=="TEX_VORONOI_BL"||ne=="TEX_SKY_BL")&&!pn(T,O,0)){const F={originData:{name:"TexCoordGenerated",type:"TEX_COORD_BL",inputs:[],outputs:[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]]}};T.addNode(F),Ke(T,T.len()-1,0,O,0)}if(ne=="TEX_ENVIRONMENT_BL"&&!pn(T,O,0)){const F={originData:{name:"TexCoordObject",type:"TEX_COORD_BL",inputs:[],outputs:[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]]}};T.addNode(F),Ke(T,T.len()-1,3,O,0)}const oe=ub(W);if(oe=="STANDARD_SURFACE_AR"&&ae.inputs.length==25&&(console.warn("v3d.MeshNodeMaterial: adding missing params to standard surface node, please reexport your scene"),ae.inputs.push([0,0,0])),oe in fb&&!pn(T,O,fb[oe])){const F={originData:{name:"Normal",type:"NORMAL",inputs:[],outputs:[[0,0,0]]}};T.addNode(F),Ke(T,T.len()-1,it.NORMAL.normal,O,fb[oe])}if(["BSDF_PRINCIPLED_BL","BSDF_PRINCIPLED_BF43_BL","BSDF_PRINCIPLED_BF40_BL","EEVEE_SPECULAR_BL"].includes(oe)&&!pn(T,O,ve[oe].clearcoatNormal)&&(ae.inputs[ve[oe].clearcoat]>0||pn(T,O,ve[oe].clearcoat))){const F={originData:{name:"CoatNormal",type:"NORMAL",inputs:[],outputs:[[0,0,0]]}};T.addNode(F),Ke(T,T.len()-1,it.NORMAL.normal,O,ve[oe].clearcoatNormal)}if(oe!="EEVEE_SPECULAR_BL"||pn(T,O,ve.EEVEE_SPECULAR_BL.ambientOcclusion)||(ae.inputs[ve.EEVEE_SPECULAR_BL.ambientOcclusion]=1),oe=="OSL_NODE"){const F=ae.initializers;for(let k=0;k<F.length;k++){const q=F[k];if(q&&!pn(T,O,k)){const j={originData:{name:oe+"init"+k,type:"OSL_NODE",shaderName:ae.shaderName+"_init_"+k,inputs:[],outputs:[ae.inputs[0]],fragCode:q[0],globalVariables:q[1],initializers:[]}};T.addNode(j),Ke(T,T.len()-1,0,O,k)}}}if(!(oe!="NORMAL_MAP_AR"||pn(T,O,ve.NORMAL_MAP_AR.normal)&&pn(T,O,ve.NORMAL_MAP_AR.tangent))){const F={originData:{name:"SamplerInfo",type:"SAMPLER_INFO_MY",inputs:[[0,0,0]],outputs:[0,!1,[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0],[0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0]]}};T.addNode(F),pn(T,O,ve.NORMAL_MAP_AR.normal)||Ke(T,T.len()-1,it.SAMPLER_INFO_MY.normalCamera,O,ve.NORMAL_MAP_AR.normal),pn(T,O,ve.NORMAL_MAP_AR.tangent)||Ke(T,T.len()-1,it.SAMPLER_INFO_MY.tangentUCamera,O,ve.NORMAL_MAP_AR.tangent)}if(oe=="IMAGE_AR"&&!pn(T,O,ve.IMAGE_AR.uvcoords)){const F={originData:{name:"place2dTexture",type:"PLACE_2D_TEXTURE_MY",inputs:[[0,0],[1,1],0],outputs:[[0,0]],uvIndex:0}};T.addNode(F),Ke(T,T.len()-1,it.PLACE_2D_TEXTURE_MY.uv,O,ve.IMAGE_AR.uvcoords)}if(oe=="FILE_MY"&&!pn(T,O,ve.FILE_MY.uvCoord)){const F={originData:{name:"place2dTexture",type:"PLACE_2D_TEXTURE_MY",inputs:[[0,0],[1,1],0],outputs:[[0,0]],uvIndex:0}};T.addNode(F),Ke(T,T.len()-1,it.PLACE_2D_TEXTURE_MY.uv,O,ve.FILE_MY.uvCoord)}if(oe=="RAMP_MY"&&!pn(T,O,ve.RAMP_MY.uvCoord)){const F={originData:{name:"place2dTexture",type:"PLACE_2D_TEXTURE_MY",inputs:[[0,0],[1,1],0],outputs:[[0,0]],uvIndex:0}};T.addNode(F),Ke(T,T.len()-1,it.PLACE_2D_TEXTURE_MY.uv,O,ve.RAMP_MY.uvCoord)}if(_e(ae.output)&&h(T,O,ae),c(ne)){if(!_e(ae.inputFactors)){ae.inputFactors=[];for(let F=0;F<ae.inputs.length;F++)ae.inputFactors.push(1)}ae.inputs.push([0,0,0]),ae.inputFactors.push(0)}if(oe=="STANDARD_SURFACE_AR"&&!pn(T,O,ve[oe].clearcoatNormal)&&(ae.inputs[ve[oe].clearcoat]>0||pn(T,O,ve[oe].clearcoat))){const F={originData:{name:"CoatNormal",type:"NORMAL",inputs:[],outputs:[[0,0,0]]}};T.addNode(F),Ke(T,T.len()-1,0,O,ve[oe].clearcoatNormal)}if(oe=="MIX_BL"&&ae.outputs.length>1){const F=[-1,-1,-1,-1,-1,-1,-1,-1],k=[-1,-1,-1];switch(ae.dataType){case"RGBA":ae.inputs=[ae.inputs[0],ae.inputs[6],ae.inputs[7]],F[0]=0,F[6]=1,F[7]=2,ae.outputs=[ae.outputs[2]],k[2]=0;break;case"VECTOR":ae.inputs=[ae.inputs[0],ae.inputs[1],ae.inputs[4],ae.inputs[5]],F[0]=0,F[1]=1,F[4]=2,F[5]=3,ae.outputs=[ae.outputs[1]],k[1]=0;break;case"FLOAT":ae.inputs=[ae.inputs[0],ae.inputs[2],ae.inputs[3]],F[0]=0,F[2]=1,F[3]=2,ae.outputs=[ae.outputs[0]],k[0]=0}const q=T.findInEdges(O);for(let U=0;U<q.length;U++){const z=q[U];for(let v=z.connections.length-1;v>=0;v--){const M=z.connections[v];F[M.to]>-1?M.to=F[M.to]:z.connections.splice(v,1)}}const j=T.findOutEdges(O);for(let U=0;U<j.length;U++){const z=j[U];for(let v=z.connections.length-1;v>=0;v--){const M=z.connections[v];k[M.from]>-1?M.from=k[M.from]:z.connections.splice(v,1)}}}if(ne=="BUMP_2D_MY"&&ae.bumpInterp>0){ae.inputs[ve.BUMP_2D_MY.bumpValue]=[0,0,0];const F=T.findInEdges(O);for(let k=0;k<F.length;k++){const q=F[k],j=T.node(q.from()).originData;for(let U=0;U<q.connections.length;U++){const z=q.connections[U];z.to==ve.BUMP_2D_MY.bumpValue&&j.type=="FILE_MY"?z.from=it.FILE_MY.color:z.to==ve.BUMP_2D_MY.bumpValue&&j.type=="IMAGE_AR"&&(z.from=it.IMAGE_AR.color)}}}if(ne!="COLOR_CONSTANT_MY"||pn(T,O,0)||pn(T,O,1)||(ae.type="RGB_ALPHA",ae.inputs=[]),ne!="FLOAT_CONSTANT_MY"||pn(T,O,0)||(ae.type="VALUE",ae.inputs=[]),ne=="TRIPLANAR_AR"){const F=(function(){const q=["scale","rotate","offset"],j=q.map((M=>B_e(T,O,ve.TRIPLANAR_AR[M]))),U=ae.coordSystem==="Y_UP_RIGHT"?"SUB_TRANSFORM_MY":"SUB_TRANSFORM_MX",z={originData:{name:"subTransform",type:U,inputs:q.map((M=>ae.inputs[ve.TRIPLANAR_AR[M]])),outputs:[[0,0,0],[0,0,0]],coordSpace:ae.coordSpace}};T.addNode(z);const v=T.len()-1;return j.forEach(((M,S)=>{M.forEach((I=>{const J=I.nodeIdx,$=I.outputIdx,B=I.channelMatrix;Ke(T,J,$,v,ve[U][q[S]],B)}))})),M=>{const S=T.node(M);S.originData.type=="TRIPLANAR_AR"?Ke(T,v,it[U].normal,M,ve.TRIPLANAR_AR.normal):S.originData.type=="TRIPLANAR_UV_AR"&&(Ke(T,v,it[U].vector,M,ve.TRIPLANAR_UV_AR.vector),Ke(T,v,it[U].normal,M,ve.TRIPLANAR_UV_AR.normal))}})();ae.inputs.push([0,0,0]),F(O);const k=q=>{const j={originData:{name:"triplanarUV",type:"TRIPLANAR_UV_AR",inputs:[[0,0,0],[0,0,0]],outputs:q==4?[[0,0],[0,0],[0,0]]:[[0,0]],flipOnOppositeDirection:ae.flipOnOppositeDirection}};q==4?j.originData.blendFactor=ae.blendFactor:j.originData.projectionAxis=q,T.addNode(j);const U=T.len()-1;return F(U),U};if(ae.inputPerAxis){const q=[ve.TRIPLANAR_AR.inputColor,ve.TRIPLANAR_AR.inputColorY,ve.TRIPLANAR_AR.inputColorZ];for(let j=0;j<3;j++){const U=q[j],z=xt(T,O,U,"IMAGE_AR");if(!z){xt(T,O,U)&&console.error("MeshNodeMaterial: TRIPLANAR_AR texture inputs accept only IMAGE_AR or color.");continue}const v=T.nodeIndex(z);ed(T,v,ve.IMAGE_AR.uvcoords);const M=k(j);Ke(T,M,it.TRIPLANAR_UV_AR.uv,v,ve.IMAGE_AR.uvcoords)}}else{const q=xt(T,O,ve.TRIPLANAR_AR.inputColor,"IMAGE_AR");if(!q){xt(T,O,ve.TRIPLANAR_AR.inputColor)&&console.error("MeshNodeMaterial: TRIPLANAR_AR texture inputs accept only IMAGE_AR or color.");continue}const j=T.nodeIndex(q);if(ed(T,j,ve.IMAGE_AR.uvcoords),ed(T,O,ve.TRIPLANAR_AR.inputColorY),ed(T,O,ve.TRIPLANAR_AR.inputColorZ),ae.blendFactor<.001){const U=k(3);Ke(T,U,it.TRIPLANAR_UV_AR.uv,j,ve.IMAGE_AR.uvcoords)}else{const U=k(4);Ke(T,U,it.TRIPLANAR_UV_AR.uv,j,ve.IMAGE_AR.uvcoords),q.originData.inputs.push([0,0],[0,0]),Ke(T,U,it.TRIPLANAR_UV_AR.duvdx,j,ve.IMAGE_AR.duvdx),Ke(T,U,it.TRIPLANAR_UV_AR.duvdy,j,ve.IMAGE_AR.duvdy)}}}if(ne=="UV_PROJECTION_AR"){const F=N_e(T,O,it.UV_PROJECTION_AR.uv),k=ed(T,O,ve.UV_PROJECTION_AR.projectionColor,"IMAGE_AR");if(!k){console.error("MeshNodeMaterial: UV_PROJECTION_AR.projectionColor input accepts only IMAGE_AR.");continue}const q=k.node;if(F){const j=T.nodeIndex(q);Ke(T,j,k.outputIdx,T.nodeIndex(F.node),F.inputIdx),ed(T,j,ve.IMAGE_AR.uvcoords),Ke(T,O,it.UV_PROJECTION_AR.uv,j,ve.IMAGE_AR.uvcoords)}}}let R=0;for(let O=0;O<T.len();O++){const W=T.node(O).originData,ae=W.type;ae!="MATERIAL_MX"&&ae!="PHYSICAL_MX"&&ae!="OPENPBR_SURFACE_MX"||(l(T,O,W),ae=="MATERIAL_MX"&&(R=W.IOR))}for(let O=0;O<T.len();O++){const W=T.node(O).originData,ae=W.type;u(ae)&&(W.IOR=R),u(ae)&&!_e(W.reflectMode)&&(W.reflectMode="MAX_ENV_COORDS_REFLECT")}for(let O=0;O<T.len();O++){const W=T.node(O).originData;W.type=="COMPOSITE_MX"&&(f(T,O,W),T.disconnect(O,!0))}for(let O=0;O<T.len();O++){const W=T.node(O).originData;W.type=="LAYERED_TEXTURE_MY"&&(p(T,O,W),T.disconnect(O,!0))}if(t.hasNode("SKYDOME_LIGHT_AR"))for(let O=0;O<T.len();O++){const W=T.node(O).originData;if(W.type=="FILE_MY"||W.type=="IMAGE_AR"){const ae={originData:{name:"envSphere",type:"ENV_SPHERE_MY",inputs:[[-1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]],outputs:[0,[0,0,0]],texture:W.texture}};T.addNode(ae);const ne=T.findOutEdges(O);for(let oe=0;oe<ne.length;oe++){const F=ne[oe];for(let k=0;k<F.connections.length;k++){const q=F.connections[k];q.from<2&&Ke(T,T.len()-1,q.from,F.to(),q.to)}}T.disconnect(O,!0),O=-1}}for(let O=0;O<T.len();O++){const W=T.node(O).originData;if(W.type=="ENV_SPHERE_MY"&&W.inputs.length==2){const ae=T.findInEdges(O);for(let ne=0;ne<ae.length;ne++){const oe=ae[ne],F=T.node(oe.from()).originData;F.type!="FILE_MY"&&F.type!="IMAGE_AR"||(W.inputs.splice(0,1),W.texture=F.texture,T.removeEdge(oe.from(),oe.to()))}}}for(let O=0;O<T.len();O++){const W=T.node(O).originData;switch(W.type){case"BSDF_DIFFUSE_BL":case"BSDF_GLOSSY_BL":case"BSDF_TRANSLUCENT_BL":case"DIFFUSE_BSDF_BL":o(T,O,W,ve[W.type].color,"Color");break;case"BSDF_METALLIC_BL":o(T,O,W,ve[W.type].baseColor,"Base Color");break;case"BSDF_PRINCIPLED_BL":o(T,O,W,ve.BSDF_PRINCIPLED_BL.baseColor,"Color");break;case"MATERIAL_MX":o(T,O,W,ve.MATERIAL_MX.ambientColor,"Ambient Color")&&(W.inputFactors[0]=1),o(T,O,W,ve.MATERIAL_MX.diffuseColor,"Diffuse Color")&&(W.inputFactors[1]=1);break;case"PHYSICAL_MX":o(T,O,W,ve.PHYSICAL_MX.baseColor,"Base Color")&&(W.inputFactors[1]=1);break;case"OPENPBR_SURFACE_MX":o(T,O,W,ve.OPENPBR_SURFACE_MY.baseColor,"Base Color")&&(W.inputFactors[1]=1);break;case"OPENPBR_SURFACE_MY":o(T,O,W,ve.OPENPBR_SURFACE_MY.baseColor,"Base Color");break;case"STANDARD_SURFACE_AR":o(T,O,W,ve.STANDARD_SURFACE_AR.baseColor,"Base Color")}}})(t.nodeGraph),NP(t.nodeGraph),this.updateNodeGraph()}static nodeGraphFromExtGraph(e){let t=e.nodes,r=e.edges;const o=t.slice().sort((function(s,l){return s.name.localeCompare(l.name)})),i=[];for(let s=0;s<r.length;s++){const l=r[s],c=Object.assign({},l);c.fromNode=o.indexOf(t[l.fromNode]),c.toNode=o.indexOf(t[l.toNode]),i.push(c)}t=o,r=i;const a=new Fn(t.length);for(let s=0;s<t.length;s++)t[s],BP({originData:t[s]},a.node(s));for(let s=0;s<r.length;s++){const l=r[s];a.edge(l.fromNode,l.toNode)||a.addNewEdge(l.fromNode,l.toNode);const c=a.edge(l.fromNode,l.toNode);if(c.connections=c.connections||[],_e(l.fromChannel)||_e(l.toChannel)){let u=null;for(let h=0;h<c.connections.length;h++){const p=c.connections[h];if(p.from==l.fromOutput&&p.to==l.toInput&&p.channelMatrix){u=p.channelMatrix;break}}if(!u){u=[[0,0,0],[0,0,0],[0,0,0]];const h={from:l.fromOutput,to:l.toInput,channelMatrix:u};c.connections.push(h)}const d=l.fromChannel||0,f=l.toChannel||0;u[d][f]=1}else{const u={from:l.fromOutput,to:l.toInput};c.connections.push(u)}}return NP(a),a}static nodeGraphTraverse(e,t){for(let r=0;r<e.len();r++)t(e.node(r))}hasNode(e){for(let t=0;t<this.nodeGraph.len();t++)if(this.nodeGraph.node(t).originData.type==e)return!0;return!1}traverseNodes(e){for(let t=0;t<this.nodeGraph.len();t++)e(this.nodeGraph.node(t))}findNodeByName(e){for(let t=0;t<this.nodeGraph.len();t++){const r=this.nodeGraph.node(t);if(r.originData.name===e)return r}return null}get color(){return this.getStandardProp("color")}set color(e){}get opacity(){return this.getStandardProp("opacity")}set opacity(e){}connectTexture(e,t,r){let o,i,a;switch(this.profile){case"blender":o="TEX_IMAGE_BL",i="UVMAP_BL",a="vector";break;case"max":o="BITMAP_MX";break;case"maya":o="FILE_MY",i="PLACE_2D_TEXTURE_MY",a="uvCoord";break;default:return void console.error("v3d.connectTexture: Invalid material profile:",this.profile)}const s=Ft(o,e.name||"Texture",{texture:e}),l=so(o,Object.keys(this.nodeTextures).length);this.nodeTextures[l]=e;const c=this.nodeGraph;if(c){let u=PP(c,t);const d=ve[Ei(c.node(u))][r],f=xt(c,u,d);f&&(c.disconnect(c.nodeIndex(f),!0),u=PP(c,t)),c.addNode(s),Ke(c,c.len()-1,it[o].color,u,d),i&&(c.addNode(Ft(i,s.name+"UV")),Ke(c,c.len()-1,it[i].uv,c.len()-2,ve[o][a]))}else console.error("v3d.connectTexture: Unable to connect texture to empty graph")}needsLightPathDir(){return!!(this.hasNode("LIGHT_PATH_BL")||this.hasNode("RAY_SWITCH_AR")||"USE_OSL"in this.defines)}canUseGTAO(){return(this.hasNode("DIFFUSE_BSDF_BL")||this.hasNode("BSDF_DIFFUSE_BL")||this.hasNode("SUBSURFACE_SCATTERING_BL")||this.hasNode("PHYSICAL_MX")||this.hasNode("OPENPBR_SURFACE_MX")||this.hasNode("OPENPBR_SURFACE_MY")||this.hasNode("STANDARD_SURFACE_AR")||this.hasNode("BSDF_GLASS_BL")||this.hasNode("BSDF_GLOSSY_BL")||this.hasNode("BSDF_METALLIC_BL")||this.hasNode("BSDF_PRINCIPLED_BL")||this.hasNode("EEVEE_SPECULAR_BL"))&&this.gtaoVisible}worldMaterialColor(){const e=this.nodeGraph;let t=ea(e,"OUTPUT_WORLD_BL");if(t>=0){const r=xt(e,t,0);if(!r||r.originData.type!="BACKGROUND_BL")return null;if(e.findInEdges(e.nodeIndex(r)).length==0)return new Ge().fromArray(r.originData.inputs[0]).multiplyScalar(r.originData.inputs[1]);if(pn(e,e.nodeIndex(r),1))return null;const o=xt(e,e.nodeIndex(r),0);if(!o||(o.originData.type!="MIX_BL"||o.originData.dataType!="RGBA")&&o.originData.type!="MIX_RGB_BL"||o.originData.blendType!="MIX")return null;const i=xt(e,e.nodeIndex(o),0);return i&&i.originData.type=="LIGHT_PATH_BL"?pn(e,e.nodeIndex(o),2)?null:Ju(e,e.nodeIndex(i),0)?new Ge().fromArray(o.originData.inputs[2]):null:null}if(t=ea(e,"OUTPUT_MX"),t>=0&&e.findInEdges(t).length==0)return new Ge().fromArray(e.node(t).originData.inputs[0]);if(t=ea(e,"SKYDOME_LIGHT_AR"),t>=0){if(e.findInEdges(t).length==0){const o=e.node(t);return new Ge().fromArray(o.originData.inputs[0]).multiplyScalar(o.originData.inputs[1])}const r=xt(e,t,0);if(!r||r.originData.type!="RAY_SWITCH_AR")return null;if(e.findInEdges(e.nodeIndex(r)).length==0)return new Ge().fromArray(r.originData.inputs[0])}return null}useAddTransparency(){const e=this.nodeGraph,t=ea(e,"OUTPUT_MATERIAL_BL");if(t>=0){const r=xt(e,t,0);if(r&&r.originData.type=="ADD_SHADER_BL"){const o=xt(e,e.nodeIndex(r),0),i=xt(e,e.nodeIndex(r),1);if(o&&i&&(o.originData.type=="BSDF_TRANSPARENT_BL"||i.originData.type=="BSDF_TRANSPARENT_BL"))return!0}}return!1}getMainShaderNode(){const e=this.nodeGraph;if(!e)return null;let t=ea(e,"OUTPUT_MATERIAL_BL");if(t>=0){const r=xt(e,t,ve.OUTPUT_MATERIAL_BL.surface);if(r){if(Ji(r,"MIX_SHADER_BL")){let o=xt(e,r,ve.MIX_SHADER_BL.fac,"SEPARATE_COLOR_BL"),i=xt(e,r,ve.MIX_SHADER_BL.color1,["DIFFUSE_BSDF_BL","BSDF_DIFFUSE_BL"]),a=xt(e,r,ve.MIX_SHADER_BL.color2,vs);if(o&&i&&a||(o=xt(e,r,ve.MIX_SHADER_BL.fac,"LIGHT_PATH_BL"),i=xt(e,r,ve.MIX_SHADER_BL.color1,"BSDF_TRANSPARENT_BL"),a=xt(e,r,ve.MIX_SHADER_BL.color2,"EMISSION_BL"),o&&i&&a)||(o=xt(e,r,ve.MIX_SHADER_BL.fac),i=xt(e,r,ve.MIX_SHADER_BL.color1,"BSDF_TRANSPARENT_BL"),a=xt(e,r,ve.MIX_SHADER_BL.color2,vs),!o&&i&&a))return a}else if(Ji(r,vs))return r}}if(t=ea(e,"OUTPUT_MX"),t>=0){const r=xt(e,t,ve.OUTPUT_MX.color,k_e);if(r)return r}if(t=ea(e,"SHADING_ENGINE_MY"),t>=0){const r=xt(e,t,ve.SHADING_ENGINE_MY.surface,hb);if(r)return r}return null}getInputColor(e,t){const r=xt(this.nodeGraph,e,t);if(!r)return new Ge().fromArray(e.originData.inputs[t]);if(Ji(r,["RGB_BL","RGB_MX","RGB_ALPHA"])){const o=this.nodeRGB[this.nodeRGBMap[r.originData.name]];return new Ge().fromArray(o.toArray())}}getInputValue(e,t){const r=xt(this.nodeGraph,e,t);if(r){if(Ji(r,["VALUE_BL","VALUE_MX","VALUE"]))return this.nodeValue[this.nodeValueMap[r.originData.name]]}else{const o=e.originData.inputs[t];if(typeof o=="number")return o;console.error(`v3d.MeshNodeMaterial: Invalid ${Ei(e)} input value at index ${t}`)}}getInputTexture(e,t){const r=xt(this.nodeGraph,e,t);if(r&&Ji(r,["TEX_IMAGE_BL","BITMAP_MX","FILE_MY","IMAGE_AR"]))return r.originData.texture}getStandardProp(e){if(!(e in Lh))return void console.error(`v3d.MeshNodeMaterial: Invalid standard property: "${e}"`);const t=this.getMainShaderNode();if(!t)return Lh[e];const r=Ei(t),o=ub(t),i=this.nodeGraph;let a,s,l,c,u,d,f,h,p;switch(e){case"color":if(a=vs.includes(r)&&xt(i,t,ve[o].baseColor??ve[o].color,"MIX_BL"),a&&a.originData.blendType=="MULTIPLY"){const A=xt(i,a,ve.MIX_BL.fac),y=xt(i,a,ve.MIX_BL.col1),b=xt(i,a,ve.MIX_BL.col2);if(!A&&(y&&!b||!y&&b)){const E=this.getInputColor(a,y?ve.MIX_BL.col2:ve.MIX_BL.col1);if(E)return E}}else{let A,y;switch(r){case"BSDF_PRINCIPLED_BL":case"EEVEE_SPECULAR_BL":A=this.getInputColor(t,ve[o].baseColor);break;case"PHYSICAL_MX":case"STANDARD_SURFACE_AR":case"LAMBERT_AR":A=this.getInputColor(t,ve[o].baseColor),A||(A=Lh.color.clone()),y=this.getInputValue(t,ve[o].base),_e(y)&&A.multiplyScalar(y);break;case"OPENPBR_SURFACE_MX":case"OPENPBR_SURFACE_MY":A=this.getInputColor(t,ve[o].baseColor),A||(A=Lh.color.clone()),y=this.getInputValue(t,ve[o].baseWeight),_e(y)&&A.multiplyScalar(y);break;default:A=this.getInputColor(t,ve[o].color)}if(A)return A}break;case"map":if(a=vs.includes(r)&&xt(i,t,ve[o].baseColor??ve[o].color,"MIX_BL"),a&&a.originData.blendType=="MULTIPLY"){const A=xt(i,a,ve.MIX_BL.fac),y=xt(i,a,ve.MIX_BL.col1),b=xt(i,a,ve.MIX_BL.col2);if(!A&&(y&&!b||!y&&b)){const E=this.getInputTexture(a,y?ve.MIX_BL.col1:ve.MIX_BL.col2);if(E)return E}}else if(["BSDF_PRINCIPLED_BL","EEVEE_SPECULAR_BL","PHYSICAL_MX","OPENPBR_SURFACE_MX","OPENPBR_SURFACE_MY","STANDARD_SURFACE_AR","LAMBERT_AR"].includes(r)){const A=this.getInputTexture(t,ve[o].baseColor);if(A)return A}else{const A=this.getInputTexture(t,ve[o].color);if(A)return A}break;case"opacity":if(p=ea(i,"OUTPUT_MATERIAL_BL"),p>=0){const A=xt(i,p,ve.OUTPUT_MATERIAL_BL.surface,"MIX_SHADER_BL");if(A){const y=xt(i,A,ve.MIX_SHADER_BL.fac),b=xt(i,A,ve.MIX_SHADER_BL.color1,"BSDF_TRANSPARENT_BL"),E=xt(i,A,ve.MIX_SHADER_BL.color2,vs);if(!y&&b&&E){const x=this.getInputValue(A,ve.MIX_SHADER_BL.fac);if(_e(x))return x}}}switch(r){case"BSDF_PRINCIPLED_BL":const A=this.getInputValue(t,ve[o].alpha);if(_e(A))return A;break;case"EEVEE_SPECULAR_BL":case"PHYSICAL_MX":if(l=this.getInputValue(t,ve[o].transparency),_e(l))return 1-l;break;case"OPENPBR_SURFACE_MX":case"OPENPBR_SURFACE_MY":if(c=this.getInputValue(t,ve[o].geometryOpacity),_e(c))return c;break;case"LAMBERT_MY":case"SURFACE_SHADER_MY":if(l=this.getInputColor(t,ve[o].transparency),l)return 1-(l.r+l.g+l.b)/3;break;case"STANDARD_SURFACE_AR":case"LAMBERT_AR":if(c=this.getInputColor(t,ve[o].opacity),c)return(c.r+c.g+c.b)/3}break;case"metalness":if(this.getStandardProp("metalnessMap"))return 1;switch(r){case"BSDF_PRINCIPLED_BL":if(u=this.getInputValue(t,ve[o].metallic),_e(u))return u;break;case"PHYSICAL_MX":case"STANDARD_SURFACE_AR":if(u=this.getInputValue(t,ve[o].metalness),_e(u))return u;break;case"OPENPBR_SURFACE_MX":case"OPENPBR_SURFACE_MY":if(u=this.getInputValue(t,ve[o].baseMetalness),_e(u))return u;break;case"BSDF_DIFFUSE_BL":case"DIFFUSE_BSDF_BL":case"LAMBERT_MY":case"LAMBERT_AR":case"EMISSION_BL":case"SURFACE_SHADER_MY":case"MAP_TO_MTL_AR":return 0;case"BSDF_GLOSSY_BL":case"BSDF_METALLIC_BL":return 1;case"EEVEE_SPECULAR_BL":return .5}break;case"metalnessMap":switch(r){case"BSDF_PRINCIPLED_BL":if(s=xt(i,t,ve[o].metallic,"SEPARATE_COLOR_BL"),s&&(d=this.getInputTexture(s,ve.SEPARATE_COLOR_BL.color),d))return d;break;case"PHYSICAL_MX":case"STANDARD_SURFACE_AR":if(d=this.getInputTexture(t,ve[o].metalness),d)return d;break;case"OPENPBR_SURFACE_MX":case"OPENPBR_SURFACE_MY":if(d=this.getInputTexture(t,ve[o].baseMetalness),d)return d;break;case"BSDF_DIFFUSE_BL":case"BSDF_GLOSSY_BL":case"BSDF_METALLIC_BL":case"DIFFUSE_BSDF_BL":case"EEVEE_SPECULAR_BL":case"EMISSION_BL":case"LAMBERT_MY":case"LAMBERT_AR":case"SURFACE_SHADER_MY":case"MAP_TO_MTL_AR":return null}break;case"roughness":if(this.getStandardProp("roughnessMap"))return 1;switch(r){case"BSDF_PRINCIPLED_BL":case"BSDF_GLOSSY_BL":case"BSDF_METALLIC_BL":case"EEVEE_SPECULAR_BL":case"PHYSICAL_MX":if(f=this.getInputValue(t,ve[o].roughness),_e(f))return f;break;case"OPENPBR_SURFACE_MX":case"OPENPBR_SURFACE_MY":case"STANDARD_SURFACE_AR":if(f=this.getInputValue(t,ve[o].specularRoughness),_e(f))return f;break;case"BSDF_DIFFUSE_BL":case"DIFFUSE_BSDF_BL":case"LAMBERT_MY":case"LAMBERT_AR":return 1;case"EMISSION_BL":case"SURFACE_SHADER_MY":case"MAP_TO_MTL_AR":return .9}break;case"roughnessMap":switch(r){case"BSDF_PRINCIPLED_BL":case"BSDF_GLOSSY_BL":case"BSDF_METALLIC_BL":case"EEVEE_SPECULAR_BL":if(s=xt(i,t,ve[o].roughness,"SEPARATE_COLOR_BL"),s&&(h=this.getInputTexture(s,ve.SEPARATE_COLOR_BL.color),h))return h;break;case"PHYSICAL_MX":if(h=this.getInputTexture(t,ve[o].roughness),h)return h;break;case"OPENPBR_SURFACE_MX":case"OPENPBR_SURFACE_MY":case"STANDARD_SURFACE_AR":if(h=this.getInputTexture(t,ve[o].specularRoughness),h)return h;break;case"BSDF_DIFFUSE_BL":case"DIFFUSE_BSDF_BL":case"EMISSION_BL":case"LAMBERT_MY":case"SURFACE_SHADER_MY":case"MAP_TO_MTL_AR":return null}break;case"aoMap":if(p=ea(i,"OUTPUT_MATERIAL_BL"),p>=0){const A=xt(i,p,ve.OUTPUT_MATERIAL_BL.surface,"MIX_SHADER_BL");if(A){const y=xt(i,A,ve.MIX_SHADER_BL.fac,"SEPARATE_COLOR_BL"),b=xt(i,A,ve.MIX_SHADER_BL.color1,["DIFFUSE_BSDF_BL","BSDF_DIFFUSE_BL"]),E=xt(i,A,ve.MIX_SHADER_BL.color2,vs);if(y&&b&&E){const x=this.getInputTexture(y,ve.SEPARATE_COLOR_BL.color);if(x)return x}}}else{let A;switch(r){case"PHYSICAL_MX":case"STANDARD_SURFACE_AR":if(A=this.getInputTexture(t,ve[o].base),A)return A;break;case"OPENPBR_SURFACE_MX":case"OPENPBR_SURFACE_MY":if(A=this.getInputTexture(t,ve[o].baseWeight),A)return A}}break;case"aoMapIntensity":break;case"normalMap":if(vs.includes(r)){const A=ve[o].normal;if(_e(A)){const y=xt(i,t,A,"NORMAL_MAP_BL");if(y){const b=this.getInputTexture(y,ve.NORMAL_MAP_BL.normalColor);if(b)return b}}}else if(hb.includes(r)){const A=ve[o].normal;if(_e(A)){const y=xt(i,t,A,"BUMP_2D_MY");if(y){const b=this.getInputTexture(y,ve.BUMP_2D_MY.bumpValue);if(b)return b}}}else if(r=="PHYSICAL_MX"||r=="OPENPBR_SURFACE_MX"){const A=xt(i,t,ve[o].normal,"NORMAL_BUMP_MX");if(A){const y=this.getInputTexture(A,ve.NORMAL_BUMP_MX.normalColor);if(y)return y}}break;case"normalScale":if(vs.includes(r)){const A=ve[o].normal;if(_e(A)){const y=xt(i,t,A,"NORMAL_MAP_BL");if(y){const b=this.getInputValue(y,ve.NORMAL_MAP_BL.strength);if(_e(b))return new be(b,b)}}}else if(hb.includes(r)){const A=ve[o].normal;if(_e(A)){const y=xt(i,t,A,"BUMP_2D_MY");if(y){const b=this.getInputValue(y,ve.BUMP_2D_MY.bumpDepth);if(_e(b))return new be(b,b)}}}else if(r=="PHYSICAL_MX"||r=="OPENPBR_SURFACE_MX"){const A=xt(i,t,ve[o].normal,"NORMAL_BUMP_MX");if(A){const y=this.getInputValue(A,ve.NORMAL_BUMP_MX.normalMult);if(_e(y))return new be(y,y)}}break;case"emissive":if(this.getStandardProp("emissiveMap"))return new Ge(1,1,1);let m;switch(r){case"BSDF_PRINCIPLED_BL":m=this.getInputColor(t,ve[o].emission);break;case"EEVEE_SPECULAR_BL":m=this.getInputColor(t,ve[o].emissiveColor);break;case"PHYSICAL_MX":m=this.getInputColor(t,ve[o].emitColor);break;case"OPENPBR_SURFACE_MX":case"OPENPBR_SURFACE_MY":case"STANDARD_SURFACE_AR":m=this.getInputColor(t,ve[o].emissionColor)}if(m)return m;break;case"emissiveMap":let g;switch(r){case"BSDF_PRINCIPLED_BL":g=this.getInputTexture(t,ve[o].emission);break;case"EEVEE_SPECULAR_BL":g=this.getInputTexture(t,ve[o].emissiveColor);break;case"PHYSICAL_MX":g=this.getInputTexture(t,ve[o].emitColor);break;case"OPENPBR_SURFACE_MX":case"OPENPBR_SURFACE_MY":case"STANDARD_SURFACE_AR":g=this.getInputTexture(t,ve[o].emissionColor)}if(g)return g;break;case"emissiveIntensity":let _;switch(r){case"BSDF_PRINCIPLED_BL":_=this.getInputValue(t,ve[o].emissionStrength);break;case"EEVEE_SPECULAR_BL":_=1;break;case"PHYSICAL_MX":case"STANDARD_SURFACE_AR":_=this.getInputValue(t,ve[o].emission);break;case"OPENPBR_SURFACE_MX":_=this.getInputValue(t,ve[o].emissionWeight);break;case"OPENPBR_SURFACE_MY":_=this.getInputValue(t,ve[o].emissionLuminance/1e3)}if(_e(_))return _}return Lh[e]}isUnlit(){const e=this.getMainShaderNode();return!(!e||!Ji(e,["EMISSION_BL","SURFACE_SHADER_MY","MAP_TO_MTL_AR"]))}copy(e){super.copy(e),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this.fog=e.fog,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.envMapParallaxType=e.envMapParallaxType,this.envMapParallaxMatrix.copy(e.envMapParallaxMatrix),this.envMapParallaxMatrixInv.copy(e.envMapParallaxMatrixInv),this.materialIndex=e.materialIndex,this.profile=e.profile,this.nodeTextures=Object.assign({},e.nodeTextures),this.nodeRGB=[];for(let t=0;t<e.nodeRGB.length;t++)this.nodeRGB.push(e.nodeRGB[t].clone());this.nodeRGBMap=Object.assign({},e.nodeRGBMap),this.nodeTexCoordObject=e.nodeTexCoordObject.slice(),this.nodeTexCoordObjectMap=Object.assign({},e.nodeTexCoordObjectMap),this.nodeValue=e.nodeValue.slice(),this.nodeValueMap=Object.assign({},e.nodeValueMap),this.nodeInputs={};for(const t in e.nodeInputs)this.nodeInputs[t]=e.nodeInputs[t].slice();this.needsBoundingBox=e.needsBoundingBox,this.useFloatTex=e.useFloatTex,this.nodeGraph=DP(e.nodeGraph),this.additionalNodeGraphs={};for(const t in e.additionalNodeGraphs)this.additionalNodeGraphs[t]=DP(e.additionalNodeGraphs[t]);return this.nodeChunks=Object.assign({},e.nodeChunks),this.nodeChunksHash=e.nodeChunksHash,this.nodeVCAliases=Object.assign({},e.nodeVCAliases),this.nodeUVAliases=Object.assign({},e.nodeUVAliases),this}}const na={enabled:!1,files:{},add:function(n,e){this.enabled!==!1&&(this.files[n]=e)},get:function(n){if(this.enabled!==!1)return this.files[n]},remove:function(n){delete this.files[n]},clear:function(){this.files={}}};class OP{constructor(e,t,r){const o=this;let i,a=!1,s=0,l=0;const c=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=r,this.itemStart=function(u){l++,a===!1&&o.onStart!==void 0&&o.onStart(u,s,l),a=!0},this.itemEnd=function(u){s++,o.onProgress!==void 0&&o.onProgress(u,s,l),s===l&&(a=!1,o.onLoad!==void 0&&o.onLoad())},this.itemError=function(u){o.onError!==void 0&&o.onError(u)},this.resolveURL=function(u){return i?i(u):u},this.setURLModifier=function(u){return i=u,this},this.addHandler=function(u,d){return c.push(u,d),this},this.removeHandler=function(u){const d=c.indexOf(u);return d!==-1&&c.splice(d,2),this},this.getHandler=function(u){for(let d=0,f=c.length;d<f;d+=2){const h=c[d],p=c[d+1];if(h.global&&(h.lastIndex=0),h.test(u))return p}return null}}}const pb=new OP;class Ci{constructor(e){this.manager=e!==void 0?e:pb,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const r=this;return new Promise((function(o,i){r.load(e,o,t,i)}))}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}const As={};class F_e extends Error{constructor(e,t){super(e),this.response=t}}class Si extends Ci{constructor(e){super(e)}load(e,t,r,o){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const i=na.get(e);if(i!==void 0)return this.manager.itemStart(e),setTimeout((()=>{t&&t(i),this.manager.itemEnd(e)}),0),i;if(As[e]!==void 0)return void As[e].push({onLoad:t,onProgress:r,onError:o});As[e]=[],As[e].push({onLoad:t,onProgress:r,onError:o});const a=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),s=this.mimeType,l=this.responseType;fetch(a).then((c=>{if(c.status===200||c.status===0){if(c.status===0&&console.warn("v3d.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||c.body===void 0||c.body.getReader===void 0)return c;const u=As[e],d=c.body.getReader(),f=c.headers.get("Content-Length")||c.headers.get("X-File-Size"),h=f?parseInt(f):0,p=h!==0;let m=0;const g=new ReadableStream({start(_){(function A(){d.read().then((({done:y,value:b})=>{if(y)_.close();else{m+=b.byteLength;const E=new ProgressEvent("progress",{lengthComputable:p,loaded:m,total:h});for(let x=0,w=u.length;x<w;x++){const L=u[x];L.onProgress&&L.onProgress(E)}_.enqueue(b),A()}}))})()}});return new Response(g)}throw new F_e(`fetch for "${c.url}" responded with ${c.status}: ${c.statusText}`,c)})).then((c=>{switch(l){case"arraybuffer":return c.arrayBuffer();case"blob":return c.blob();case"document":return c.text().then((u=>new DOMParser().parseFromString(u,s)));case"json":return c.json();default:if(s===void 0)return c.text();{const u=/charset="?([^;"\s]*)"?/i.exec(s),d=u&&u[1]?u[1].toLowerCase():void 0,f=new TextDecoder(d);return c.arrayBuffer().then((h=>f.decode(h)))}}})).then((c=>{na.add(e,c);const u=As[e];delete As[e];for(let d=0,f=u.length;d<f;d++){const h=u[d];h.onLoad&&h.onLoad(c)}})).catch((c=>{const u=As[e];if(u===void 0)throw this.manager.itemError(e),c;delete As[e];for(let d=0,f=u.length;d<f;d++){const h=u[d];h.onError&&h.onError(c)}this.manager.itemError(e)})).finally((()=>{this.manager.itemEnd(e)})),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class V_e extends Ci{constructor(e){super(e)}load(e,t,r,o){const i=this,a=[],s=new dl,l=new Si(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(i.withCredentials);let c=0;function u(d){l.load(e[d],(function(f){const h=i.parse(f,!0);a[d]={width:h.width,height:h.height,format:h.format,mipmaps:h.mipmaps},c+=1,c===6&&(h.mipmapCount===1&&(s.minFilter=1006),s.image=a,s.format=h.format,s.needsUpdate=!0,t&&t(s))}),r,o)}if(Array.isArray(e))for(let d=0,f=e.length;d<f;++d)u(d);else l.load(e,(function(d){const f=i.parse(d,!0);if(f.isCubemap){const h=f.mipmaps.length/f.mipmapCount;for(let p=0;p<h;p++){a[p]={mipmaps:[]};for(let m=0;m<f.mipmapCount;m++)a[p].mipmaps.push(f.mipmaps[p*f.mipmapCount+m]),a[p].format=f.format,a[p].width=f.width,a[p].height=f.height}s.image=a}else s.image.width=f.width,s.image.height=f.height,s.mipmaps=f.mipmaps;f.mipmapCount===1&&(s.minFilter=1006),s.format=f.format,s.needsUpdate=!0,t&&t(s)}),r,o);return s}}class mb extends Ci{constructor(e){super(e)}load(e,t,r,o){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const i=this,a=na.get(e);if(a!==void 0)return i.manager.itemStart(e),setTimeout((function(){t&&t(a),i.manager.itemEnd(e)}),0),a;const s=lh("img");function l(){u(),na.add(e,this),t&&t(this),i.manager.itemEnd(e)}function c(d){u(),o&&o(d),i.manager.itemError(e),i.manager.itemEnd(e)}function u(){s.removeEventListener("load",l,!1),s.removeEventListener("error",c,!1)}return s.addEventListener("load",l,!1),s.addEventListener("error",c,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(s.crossOrigin=this.crossOrigin),i.manager.itemStart(e),s.src=e,s}}class U_e extends Ci{constructor(e){super(e)}load(e,t,r,o){const i=new s0,a=new mb(this.manager);a.setCrossOrigin(this.crossOrigin),a.setPath(this.path);let s=0;function l(c){a.load(e[c],(function(u){i.images[c]=u,s++,s===6&&(i.needsUpdate=!0,t&&t(i))}),void 0,o)}for(let c=0;c<e.length;++c)l(c);return i}}class kP extends Ci{constructor(e){super(e)}load(e,t,r,o){const i=this,a=new gs,s=new Si(this.manager);return s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setPath(this.path),s.setWithCredentials(i.withCredentials),s.load(e,(function(l){const c=i.parse(l);c&&(c.image!==void 0?a.image=c.image:c.data!==void 0&&(a.image.width=c.width,a.image.height=c.height,a.image.data=c.data),a.wrapS=c.wrapS!==void 0?c.wrapS:1001,a.wrapT=c.wrapT!==void 0?c.wrapT:1001,a.magFilter=c.magFilter!==void 0?c.magFilter:1006,a.minFilter=c.minFilter!==void 0?c.minFilter:1006,a.anisotropy=c.anisotropy!==void 0?c.anisotropy:1,c.encoding!==void 0&&(a.encoding=c.encoding),c.flipY!==void 0&&(a.flipY=c.flipY),c.format!==void 0&&(a.format=c.format),c.type!==void 0&&(a.type=c.type),c.mipmaps!==void 0&&(a.mipmaps=c.mipmaps,a.minFilter=1008),c.mipmapCount===1&&(a.minFilter=1006),c.generateMipmaps!==void 0&&(a.generateMipmaps=c.generateMipmaps),a.needsUpdate=!0,t&&t(a,c))}),r,o),a}}class gb extends Ci{constructor(e){super(e)}load(e,t,r,o){const i=new $n,a=new mb(this.manager);return a.setCrossOrigin(this.crossOrigin),a.setPath(this.path),a.load(e,(function(s){i.image=s,i.needsUpdate=!0,t!==void 0&&t(i)}),r,o),i}}class FP extends Ci{constructor(e){super(e),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&console.warn("v3d.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("v3d.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,t,r,o){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const i=this,a=na.get(e);if(a!==void 0)return i.manager.itemStart(e),setTimeout((function(){t&&t(a),i.manager.itemEnd(e)}),0),a;const s={};s.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",s.headers=this.requestHeader,fetch(e,s).then((function(l){return l.blob()})).then((function(l){return createImageBitmap(l,Object.assign(i.options,{colorSpaceConversion:"none"}))})).then((function(l){na.add(e,l),t&&t(l),i.manager.itemEnd(e)})).catch((function(l){o&&o(l),i.manager.itemError(e),i.manager.itemEnd(e)})),i.manager.itemStart(e)}}class Ea{static decodeText(e){if(typeof TextDecoder<"u")return new TextDecoder().decode(e);let t="";for(let r=0,o=e.length;r<o;r++)t+=String.fromCharCode(e[r]);try{return decodeURIComponent(escape(t))}catch{return t}}static extractUrlBase(e){const t=e.lastIndexOf("/");return t===-1?"./":e.slice(0,t+1)}static resolveURL(e,t){return typeof e!="string"||e===""?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}let H0;class _b{static getContext(){return H0===void 0&&(H0=new(window.AudioContext||window.webkitAudioContext)),H0}static setContext(e){H0=e}}class z_e extends Ci{constructor(e){super(e)}load(e,t,r,o){const i=this,a=new Si(this.manager);a.setResponseType("arraybuffer"),a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,(function(s){try{const l=s.slice(0);_b.getContext().decodeAudioData(l,(function(c){t(c)}))}catch(l){o?o(l):console.error(l),i.manager.itemError(e)}}),r,o)}}class fl extends kt{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new Ge(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}}const VP=new N;class UP extends fl{constructor(e,t,r=0,o=Math.PI/3,i=0,a=2){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(kt.DefaultUp),this.updateMatrix(),this.target=new kt,this.distance=r,this.angle=o,this.penumbra=i,this.decay=a,this.shadow=new u1e,this.isFreeLight=!1}get power(){return 4*this.intensity*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this.isFreeLight=e.isFreeLight,this}updateMatrixWorld(e){super.updateMatrixWorld(e),this.isFreeLight&&this.updateFreeLightTarget()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.isFreeLight&&this.updateFreeLightTarget()}updateFreeLightTarget(){VP.set(0,0,-1).applyQuaternion(this.quaternion).normalize(),this.target.position.addVectors(this.position,VP),this.target.updateMatrixWorld()}}const zP=new Ue,Ph=new N,vb=new N;class GP extends g0{constructor(){super(new gr(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new be(4,2),this._viewportCount=6,this._viewports=[new pt(2,1,1,1),new pt(0,1,1,1),new pt(3,1,1,1),new pt(1,1,1,1),new pt(3,0,1,1),new pt(1,0,1,1)],this._cubeDirections=[new N(1,0,0),new N(-1,0,0),new N(0,0,1),new N(0,0,-1),new N(0,1,0),new N(0,-1,0)],this._cubeUps=[new N(0,1,0),new N(0,1,0),new N(0,1,0),new N(0,1,0),new N(0,0,1),new N(0,0,-1)]}updateMatrices(e,t=0){const r=this.camera,o=this.matrix,i=e.distance||r.far;i!==r.far&&(r.far=i,r.updateProjectionMatrix()),Ph.setFromMatrixPosition(e.matrixWorld),r.position.copy(Ph),vb.copy(r.position),vb.add(this._cubeDirections[t]),r.up.copy(this._cubeUps[t]),r.lookAt(vb),r.updateMatrixWorld(),o.makeTranslation(-Ph.x,-Ph.y,-Ph.z),zP.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),this._frustum.setFromProjectionMatrix(zP)}}class HP extends fl{constructor(e,t,r=0,o=2){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=r,this.decay=o,this.shadow=new GP}get power(){return 4*this.intensity*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class G_e extends GP{constructor(){super(),this.isRectAreaLightShadow=!0}}class WP extends fl{constructor(e,t,r=10,o=10){super(e,t),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=r,this.height=o,this.shadow=new G_e}get power(){return 2*this.intensity*Math.PI}set power(e){this.intensity=e/(2*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this.shadow=e.shadow.clone(),this}}class H_e extends fl{constructor(e,t,r){super(e,r),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(kt.DefaultUp),this.updateMatrix(),this.groundColor=new Ge(t)}copy(e,t){return super.copy(e,t),this.groundColor.copy(e.groundColor),this}}class td{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new N)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const r=e.x,o=e.y,i=e.z,a=this.coefficients;return t.copy(a[0]).multiplyScalar(.282095),t.addScaledVector(a[1],.488603*o),t.addScaledVector(a[2],.488603*i),t.addScaledVector(a[3],.488603*r),t.addScaledVector(a[4],r*o*1.092548),t.addScaledVector(a[5],o*i*1.092548),t.addScaledVector(a[6],.315392*(3*i*i-1)),t.addScaledVector(a[7],r*i*1.092548),t.addScaledVector(a[8],.546274*(r*r-o*o)),t}getIrradianceAt(e,t){const r=e.x,o=e.y,i=e.z,a=this.coefficients;return t.copy(a[0]).multiplyScalar(.886227),t.addScaledVector(a[1],1.023328*o),t.addScaledVector(a[2],1.023328*i),t.addScaledVector(a[3],1.023328*r),t.addScaledVector(a[4],.858086*r*o),t.addScaledVector(a[5],.858086*o*i),t.addScaledVector(a[6],.743125*i*i-.247708),t.addScaledVector(a[7],.858086*r*i),t.addScaledVector(a[8],.429043*(r*r-o*o)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let r=0;r<9;r++)this.coefficients[r].addScaledVector(e.coefficients[r],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let r=0;r<9;r++)this.coefficients[r].lerp(e.coefficients[r],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(e,t=0){const r=this.coefficients;for(let o=0;o<9;o++)r[o].fromArray(e,t+3*o);return this}toArray(e=[],t=0){const r=this.coefficients;for(let o=0;o<9;o++)r[o].toArray(e,t+3*o);return e}static getBasisAt(e,t){const r=e.x,o=e.y,i=e.z;t[0]=.282095,t[1]=.488603*o,t[2]=.488603*i,t[3]=.488603*r,t[4]=1.092548*r*o,t[5]=1.092548*o*i,t[6]=.315392*(3*i*i-1),t[7]=1.092548*r*i,t[8]=.546274*(r*r-o*o)}}class Dh extends fl{constructor(e=new td,t=1){super(void 0,t),this.isLightProbe=!0,this.type="LightProbe",this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}}class W_e extends Dh{constructor(e,t,r=1){super(void 0,r),this.isHemisphereLightProbe=!0,this.type="HemisphereLightProbe";const o=new Ge().set(e),i=new Ge().set(t),a=new N(o.r,o.g,o.b),s=new N(i.r,i.g,i.b),l=Math.sqrt(Math.PI),c=l*Math.sqrt(.75);this.sh.coefficients[0].copy(a).add(s).multiplyScalar(l),this.sh.coefficients[1].copy(a).sub(s).multiplyScalar(c)}}const Ab=new Ue;class W0{constructor({maxFar:e=1e5,projectionMatrix:t=null}={}){this.vertices={near:[new N,new N,new N,new N],far:[new N,new N,new N,new N]},t&&this.setFromProjectionMatrix(t,e)}setFromProjectionMatrix(e,t){const r=e.elements[11]===0;return Ab.copy(e).invert(),this.vertices.near[0].set(1,1,-1),this.vertices.near[1].set(1,-1,-1),this.vertices.near[2].set(-1,-1,-1),this.vertices.near[3].set(-1,1,-1),this.vertices.near.forEach((function(o){o.applyMatrix4(Ab)})),this.vertices.far[0].set(1,1,1),this.vertices.far[1].set(1,-1,1),this.vertices.far[2].set(-1,-1,1),this.vertices.far[3].set(-1,1,1),this.vertices.far.forEach((function(o){o.applyMatrix4(Ab);const i=Math.abs(o.z);r?o.z*=Math.min(t/i,1):o.multiplyScalar(Math.min(t/i,1))})),this.vertices}split(e,t,r){for(;e.length>t.length;)t.push(new W0);t.length=e.length;for(let o=0;o<e.length;o++){const i=t[o];if(o===0||r)for(let a=0;a<4;a++)i.vertices.near[a].copy(this.vertices.near[a]);else for(let a=0;a<4;a++)i.vertices.near[a].lerpVectors(this.vertices.near[a],this.vertices.far[a],e[o-1]);if(o===e.length-1)for(let a=0;a<4;a++)i.vertices.far[a].copy(this.vertices.far[a]);else for(let a=0;a<4;a++)i.vertices.far[a].lerpVectors(this.vertices.near[a],this.vertices.far[a],e[o])}}toSpace(e,t){for(let r=0;r<4;r++)t.vertices.near[r].copy(this.vertices.near[r]).applyMatrix4(e),t.vertices.far[r].copy(this.vertices.far[r]).applyMatrix4(e)}}const jP=new N,j_e=new N,Q_e=new N,QP=new Ue;new Ue;const Bh=new Tn,yb=new W0,bb=[],xb=[];class $_e extends g0{constructor(){super(new ya(-5,5,5,-5,.5,500)),this.esmBlurRadius=0,this.pancakeDepth=!0,this.isDirectionalLightShadowCascade=!0}updateMatrices(e){const t=this.camera,r=this.matrix,o=jP.setFromMatrixPosition(t.matrixWorld),i=j_e.setFromMatrixPosition(e.matrixWorld);t.position.copy(i);const a=Q_e.setFromMatrixPosition(e.target.matrixWorld);t.lookAt(a),t.position.copy(o),t.updateMatrixWorld();const s=QP.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse);this._frustum.setFromProjectionMatrix(s),this.pancakeDepth&&(this._frustum.planes[5].constant=1/0),r.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),r.multiply(s)}}class Y_e extends g0{constructor({numCascades:e=1,maxDistance:t=500,fade:r=0,lightMargin:o=1,noLastCascadeCutOff:i=!0,customSplitsCallback:a=null}={}){super(new ya(-5,5,5,-5,.5,500)),this.numCascades=e,this.exponent=.5,this.customSplitsCallback=a,this.maxDistance=t,this.fade=r,this.lightMargin=o,this.noLastCascadeCutOff=i,this.cascadesFitToScene=!1,this.mainFrustum=new W0,this._frustums=[],this._breaks=[],this._cascades=[],this._sceneViewProjectionMatrix=new Ue,this._sceneViewCamera=null,this._needsCascadeFrustumsUpdate=!0,this.createCascades(),this.isDirectionalLightShadowCSM=!0}createCascades(){const e=this._cascades;for(;e.length>this.numCascades;)e.pop().dispose();for(let t=e.length;t<this.numCascades;t++){const r=new $_e;r.mapSize.copy(this.mapSize),r.copy(this),e.push(r)}for(let t=0;t<e.length;t++){const r=e[t];r.mapSize.copy(this.mapSize),r.copy(this)}this.updateMapSize()}initCascades(e){e.updateProjectionMatrix(),this.mainFrustum.setFromProjectionMatrix(e.projectionMatrix,this.maxDistance),this.mainFrustum.split(this._breaks,this._frustums,this.cascadesFitToScene)}updateShadowBounds(e){const t=this._frustums;for(let r=0;r<t.length;r++){const o=this._cascades[r],i=this._cascades[r].camera,a=t[r],s=a.vertices.near,l=a.vertices.far,c=l[0];let u;u=c.distanceTo(l[2])>c.distanceTo(s[2])?l[2]:s[2];let d=c.distanceTo(u);if(this.fade>0){const f=Math.min(e.far,this.maxDistance),h=e.near,p=a.vertices.far[0].z/(f-h);d+=this.fade*Math.pow(p,2)*(f-h)}i.left=-d/2,i.right=d/2,i.top=d/2,i.bottom=-d/2,i.near=0,i.far=d+this.lightMargin,i.updateProjectionMatrix(),o.bias=this.bias,o.normalBias=this.normalBias,o.esmBlurRadius=o.radius/((i.right-i.left)/2)}}getBreaks(e){const t=e.near,r=Math.min(e.far,this.maxDistance),o=this.numCascades,i=this.exponent,a=this._breaks;a.length=0,this.customSplitsCallback?this.customSplitsCallback(o,t,r,a,i):(function(s,l,c,u,d){bb.length=0,xb.length=0,(function(f,h,p,m){for(let g=1;g<f;g++)m.push(h*(p/h)**(g/f)/p);m.push(1)})(s,l,c,xb),(function(f,h,p,m){for(let g=1;g<f;g++)m.push((h+(p-h)*g/f)/p);m.push(1)})(s,l,c,bb);for(let f=1;f<s;f++)d.push(Aa(bb[f-1],xb[f-1],u));d.push(1)})(o,t,r,i,a)}updateCascadePositions(e){const t=this._frustums;for(let r=0;r<t.length;r++){const o=this._cascades[r],i=this._cascades[r].camera,a=(i.right-i.left)/o.mapSize.x,s=(i.top-i.bottom)/o.mapSize.y;i.updateMatrixWorld(!0);const l=QP.multiplyMatrices(i.matrixWorldInverse,e.matrixWorld);t[r].toSpace(l,yb);const c=yb.vertices.near,u=yb.vertices.far;Bh.makeEmpty();for(let f=0;f<4;f++)Bh.expandByPoint(c[f]),Bh.expandByPoint(u[f]);const d=Bh.getCenter(jP);d.z=Bh.max.z+this.lightMargin,d.x=Math.floor(d.x/a)*a,d.y=Math.floor(d.y/s)*s,d.applyMatrix4(i.matrixWorld),i.position.copy(d),i.updateMatrixWorld()}}update(e,t){!this._needsCascadeFrustumsUpdate&&this._sceneViewCamera===e&&this._sceneViewProjectionMatrix.equals(e.projectionMatrix)||(this.updateFrustums(e),this.updateMatrices(t),this._sceneViewCamera=e,this._sceneViewProjectionMatrix.copy(e.projectionMatrix),this._needsCascadeFrustumsUpdate=!1),this.updateCascadePositions(e)}getCascadeRange(e,t){const r=this._breaks,o=r[t],i=r[t-1]||0;e.x=i,e.y=o,this.noLastCascadeCutOff&&t==r.length-1&&(e.y=1/0)}updateFrustums(e){this.getBreaks(e),this.initCascades(e),this.updateShadowBounds(e)}updateMatrices(e){for(let t=0;t<this._cascades.length;t++)this._cascades[t].updateMatrices(e)}updateMapSize(e){e&&this.mapSize.copy(e);const t=this.mapSize;for(let r=0;r<this._cascades.length;r++)this._cascades[r].mapSize.copy(t);this.updateMaps()}updateMaps(){for(let e=0;e<this._cascades.length;e++){const t=this._cascades[e];t.dispose(),t.map=null,t._additionalMap2D=null,t._additionalMapCube=null}}dispose(){for(let e=0;e<this._cascades.length;e++)this._cascades[e].dispose();super.dispose()}copy(e){return super.copy(e),this.numCascades=e.numCascades,this.exponent=e.exponent,this.maxDistance=e.maxDistance,this.fade=e.fade,this.lightMargin=e.lightMargin,this.noLastCascadeCutOff=e.noLastCascadeCutOff,this.createCascades(),this}clone(){return new this.constructor().copy(this)}setCascadesFitToScene(e){this.cascadesFitToScene=e,this._needsCascadeFrustumsUpdate=!0}setExponent(e){this.exponent=e,this._needsCascadeFrustumsUpdate=!0}setFade(e){this.fade=e,this._needsCascadeFrustumsUpdate=!0}setMaxDistance(e){this.maxDistance=e,this._needsCascadeFrustumsUpdate=!0}setNoLastCascadeCutOff(e){this.noLastCascadeCutOff=e,this._needsCascadeFrustumsUpdate=!0}setNumCascades(e){this.numCascades=e,this._needsCascadeFrustumsUpdate=!0,this.createCascades()}setLightMargin(e){this.lightMargin=e,this._needsCascadeFrustumsUpdate=!0}}const $P=new N;class YP extends fl{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(kt.DefaultUp),this.updateMatrix(),this.target=new kt,this.shadow=new Y_e,this.isFreeLight=!1}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this.isFreeLight=e.isFreeLight,this}updateMatrixWorld(e){super.updateMatrixWorld(e),this.isFreeLight&&this.updateFreeLightTarget()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.isFreeLight&&this.updateFreeLightTarget()}updateFreeLightTarget(){$P.set(0,0,-1).applyQuaternion(this.quaternion).normalize(),this.target.position.addVectors(this.position,$P),this.target.updateMatrixWorld()}}class XP extends fl{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}class X_e extends Dh{constructor(e,t=1){super(void 0,t),this.isAmbientLightProbe=!0,this.type="AmbientLightProbe";const r=new Ge().set(e);this.sh.coefficients[0].set(r.r,r.g,r.b).multiplyScalar(2*Math.sqrt(Math.PI))}}const qP=new Ue,KP=new Ue,ic=new Ue;class q_e{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new gr,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new gr,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(e){const t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep,ic.copy(e.projectionMatrix);const r=t.eyeSep/2,o=r*t.near/t.focus,i=t.near*Math.tan(ss*t.fov*.5)/t.zoom;let a,s;KP.elements[12]=-r,qP.elements[12]=r,a=-i*t.aspect+o,s=i*t.aspect+o,ic.elements[0]=2*t.near/(s-a),ic.elements[8]=(s+a)/(s-a),this.cameraL.projectionMatrix.copy(ic),a=-i*t.aspect-o,s=i*t.aspect-o,ic.elements[0]=2*t.near/(s-a),ic.elements[8]=(s+a)/(s-a),this.cameraR.projectionMatrix.copy(ic)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(KP),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(qP)}}class Ca{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=performance.now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=performance.now();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}const ac=new N,ZP=new It,K_e=new N,sc=new N;class JP extends kt{constructor(){super(),this.type="AudioListener",this.context=_b.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new Ca}getInput(){return this.gain}removeFilter(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(e){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}updateMatrixWorld(e){super.updateMatrixWorld(e);const t=this.context.listener,r=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(ac,ZP,K_e),sc.set(0,0,-1).applyQuaternion(ZP),t.positionX){const o=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime(ac.x,o),t.positionY.linearRampToValueAtTime(ac.y,o),t.positionZ.linearRampToValueAtTime(ac.z,o),t.forwardX.linearRampToValueAtTime(sc.x,o),t.forwardY.linearRampToValueAtTime(sc.y,o),t.forwardZ.linearRampToValueAtTime(sc.z,o),t.upX.linearRampToValueAtTime(r.x,o),t.upY.linearRampToValueAtTime(r.y,o),t.upZ.linearRampToValueAtTime(r.z,o)}else t.setPosition(ac.x,ac.y,ac.z),t.setOrientation(sc.x,sc.y,sc.z,r.x,r.y,r.z)}}class eD extends kt{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(this.isPlaying===!0)return void console.warn("v3d.Audio: Audio is already playing.");if(this.hasPlaybackControl===!1)return void console.warn("v3d.Audio: this Audio has no playback control.");this._startedAt=this.context.currentTime+e;const t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl!==!1)return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("v3d.Audio: this Audio has no playback control.")}stop(){if(this.hasPlaybackControl!==!1)return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("v3d.Audio: this Audio has no playback control.")}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(e){return e||(e=[]),this._connected===!0?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){if(this.detune=e,this.source.detune!==void 0)return this.isPlaying===!0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(this.hasPlaybackControl!==!1)return this.playbackRate=e,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("v3d.Audio: this Audio has no playback control.")}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return this.hasPlaybackControl===!1?(console.warn("v3d.Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(this.hasPlaybackControl!==!1)return this.loop=e,this.isPlaying===!0&&(this.source.loop=this.loop),this;console.warn("v3d.Audio: this Audio has no playback control.")}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}}const lc=new N,tD=new It,Z_e=new N,cc=new N;class J_e extends eD{constructor(e){super(e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}fromAudio(e){return this.panner.disconnect(this.gain),this.listener=e.listener,this.context=e.context,this.gain=e.gain,this.autoplay=e.autoplay,this.buffer=e.buffer,this.detune=e.detune,this.loop=e.loop,this.loopStart=e.loopStart,this.loopEnd=e.loopEnd,this.offset=e.offset,this.duration=e.duration,this.playbackRate=e.playbackRate,this.isPlaying=e.isPlaying,this.hasPlaybackControl=e.hasPlaybackControl,this.audio=e.audio,this.sourceType=e.sourceType,this._startedAt=e._startedAt,this._progress=e._progress,this._connected=e._connected,this.filters=e.filters.slice(0),this.panner.connect(this.gain),this}disconnect(){super.disconnect(),this.panner.disconnect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(e){return this.panner.refDistance=e,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(e){return this.panner.rolloffFactor=e,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(e){return this.panner.distanceModel=e,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(e){return this.panner.maxDistance=e,this}setDirectionalCone(e,t,r){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=r,this}updateMatrixWorld(e){if(super.updateMatrixWorld(e),this.hasPlaybackControl===!0&&this.isPlaying===!1)return;this.matrixWorld.decompose(lc,tD,Z_e),cc.set(0,0,1).applyQuaternion(tD);const t=this.panner;if(t.positionX){const r=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime(lc.x,r),t.positionY.linearRampToValueAtTime(lc.y,r),t.positionZ.linearRampToValueAtTime(lc.z,r),t.orientationX.linearRampToValueAtTime(cc.x,r),t.orientationY.linearRampToValueAtTime(cc.y,r),t.orientationZ.linearRampToValueAtTime(cc.z,r)}else t.setPosition(lc.x,lc.y,lc.z),t.setOrientation(cc.x,cc.y,cc.z)}}class eve{constructor(e,t=2048){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=t,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let e=0;const t=this.getFrequencyData();for(let r=0;r<t.length;r++)e+=t[r];return e/t.length}}class nD extends qu{constructor(e,t,r,o){super(e,t,r,o),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:2400,endingEnd:2400}}intervalChanged_(e,t,r){const o=this.parameterPositions;let i=e-2,a=e+1,s=o[i],l=o[a];if(s===void 0)switch(this.getSettings_().endingStart){case 2401:i=e,s=2*t-r;break;case 2402:i=o.length-2,s=t+o[i]-o[i+1];break;default:i=e,s=r}if(l===void 0)switch(this.getSettings_().endingEnd){case 2401:a=e,l=2*r-t;break;case 2402:a=1,l=r+o[1]-o[0];break;default:a=e-1,l=t}const c=.5*(r-t),u=this.valueSize;this._weightPrev=c/(t-s),this._weightNext=c/(l-r),this._offsetPrev=i*u,this._offsetNext=a*u}interpolate_(e,t,r,o){const i=this.resultBuffer,a=this.sampleValues,s=this.valueSize,l=e*s,c=l-s,u=this._offsetPrev,d=this._offsetNext,f=this._weightPrev,h=this._weightNext,p=(r-t)/(o-t),m=p*p,g=m*p,_=-f*g+2*f*m-f*p,A=(1+f)*g+(-1.5-2*f)*m+(-.5+f)*p+1,y=(-1-h)*g+(1.5+h)*m+.5*p,b=h*g-h*m;for(let E=0;E!==s;++E)i[E]=_*a[u+E]+A*a[c+E]+y*a[l+E]+b*a[d+E];return i}}function wi(n,e,t){return uc(n)?new n.constructor(n.subarray(e,t!==void 0?t:n.length)):n.slice(e,t)}function Eb(n,e,t){return!n||!t&&n.constructor===e?n:typeof e.BYTES_PER_ELEMENT=="number"?new e(n):Array.prototype.slice.call(n)}function uc(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}function rD(n){const e=n.length,t=new Array(e);for(let r=0;r!==e;++r)t[r]=r;return t.sort((function(r,o){return n[r]-n[o]})),t}function Cb(n,e,t){const r=n.length,o=new n.constructor(r);for(let i=0,a=0;a!==r;++i){const s=t[i]*e;for(let l=0;l!==e;++l)o[a++]=n[s+l]}return o}function oD(n,e,t,r){let o=1,i=n[0];for(;i!==void 0&&i[r]===void 0;)i=n[o++];if(i===void 0)return;let a=i[r];if(a!==void 0)if(Array.isArray(a))do a=i[r],a!==void 0&&(e.push(i.time),t.push.apply(t,a)),i=n[o++];while(i!==void 0);else if(a.toArray!==void 0)do a=i[r],a!==void 0&&(e.push(i.time),a.toArray(t,t.length)),i=n[o++];while(i!==void 0);else do a=i[r],a!==void 0&&(e.push(i.time),t.push(a)),i=n[o++];while(i!==void 0)}function tve(n,e,t,r,o=30){const i=n.clone();i.name=e;const a=[];i.tracks.forEach((l=>{if(l.times.length===0)return;const c=[Math.max(t/o,l.times[0]),Math.min(r/o,l.times[l.times.length-1])];if(c[0]>c[1])return;const u=l.times.findIndex((x=>x>=c[0])),d=l.times.findLastIndex((x=>x<=c[1])),f=l.getValueSize();let h=[],p=uc(l.times)?l.times.subarray(u,d+1):l.times.slice(u,d+1),m=[],g=[],_=uc(l.values)?l.values.subarray(u*f,(d+1)*f):l.values.slice(u*f,(d+1)*f),A=[];const y=u>d;let b,E;(y||c[0]<l.times[u])&&(h=[c[0]],g=l.createInterpolant().evaluate(h[0])),c[0]!==c[1]&&(y||c[1]>l.times[d])&&(m=[c[1]],A=l.createInterpolant().evaluate(m[0])),uc(l.times)?(b=new l.times.constructor(h.length+p.length+m.length),b.set(h),b.set(p,h.length),b.set(m,h.length+p.length)):b=h.concat(p,m),uc(l.values)?(E=new l.values.constructor(g.length+_.length+A.length),E.set(g),E.set(_,g.length),E.set(A,g.length+_.length)):E=g.concat(_,A),l.times=b,l.values=E,a.push(l)}));const s=a.reduce(((l,c)=>Math.min(l,c.times[0])),1/0);return a.forEach((l=>l.shift(-s))),i.tracks=a,i.resetDuration(),i}function nve(n,e=0,t=n,r=30){r<=0&&(r=30);const o=t.tracks.length,i=e/r;for(let a=0;a<o;++a){const s=t.tracks[a],l=s.ValueTypeName;if(l==="bool"||l==="string")continue;const c=n.tracks.find((function(_){return _.name===s.name&&_.ValueTypeName===l}));if(c===void 0)continue;let u=0;const d=s.getValueSize();s.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(u=d/3);let f=0;const h=c.getValueSize();c.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(f=h/3);const p=s.times.length-1;let m;if(i<=s.times[0]){const _=u,A=d-u;m=wi(s.values,_,A)}else if(i>=s.times[p]){const _=p*d+u,A=_+d-u;m=wi(s.values,_,A)}else{const _=s.createInterpolant(),A=u,y=d-u;_.evaluate(i),m=wi(_.resultBuffer,A,y)}l==="quaternion"&&new It().fromArray(m).normalize().conjugate().toArray(m);const g=c.times.length;for(let _=0;_<g;++_){const A=_*h+f;if(l==="quaternion")It.multiplyQuaternionsFlat(c.values,A,m,0,c.values,A);else{const y=h-2*f;for(let b=0;b<y;++b)c.values[A+b]-=m[b]}}}return n.blendMode=2501,n}var rve=Object.freeze({__proto__:null,arraySlice:wi,convertArray:Eb,flattenJSON:oD,getKeyframeOrder:rD,isTypedArray:uc,makeClipAdditive:nve,sortedArray:Cb,subclip:tve});class Sa{constructor(e,t,r,o){if(e===void 0)throw new Error("v3d.KeyframeTrack: track name is undefined");if(t===void 0||t.length===0)throw new Error("v3d.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=Eb(t,this.TimeBufferType),this.values=Eb(r,this.ValueBufferType),this.setInterpolation(o||this.DefaultInterpolation)}InterpolantFactoryMethodDiscrete(e){return new lb(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new z0(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new nD(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case 2300:t=this.InterpolantFactoryMethodDiscrete;break;case 2301:t=this.InterpolantFactoryMethodLinear;break;case 2302:t=this.InterpolantFactoryMethodSmooth}if(t===void 0){const r="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0){if(e===this.DefaultInterpolation)throw new Error(r);this.setInterpolation(this.DefaultInterpolation)}return console.warn("v3d.KeyframeTrack:",r),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return 2300;case this.InterpolantFactoryMethodLinear:return 2301;case this.InterpolantFactoryMethodSmooth:return 2302}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){const t=this.times;for(let r=0,o=t.length;r!==o;++r)t[r]+=e}return this}scale(e){if(e!==1){const t=this.times;for(let r=0,o=t.length;r!==o;++r)t[r]*=e}return this}trim(e,t){const r=this.times,o=r.length;let i=0,a=o-1;for(;i!==o&&r[i]<e;)++i;for(;a!==-1&&r[a]>t;)--a;if(++a,i!==0||a!==o){i>=a&&(a=Math.max(a,1),i=a-1);const s=this.getValueSize();this.times=wi(r,i,a),this.values=wi(this.values,i*s,a*s)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!==0&&(console.error("v3d.KeyframeTrack: Invalid value size in track.",this),e=!1);const r=this.times,o=this.values,i=r.length;i===0&&(console.error("v3d.KeyframeTrack: Track is empty.",this),e=!1);let a=null;for(let s=0;s!==i;s++){const l=r[s];if(typeof l=="number"&&isNaN(l)){console.error("v3d.KeyframeTrack: Time is not a valid number.",this,s,l),e=!1;break}if(a!==null&&a>l){console.error("v3d.KeyframeTrack: Out of order keys.",this,s,l,a),e=!1;break}a=l}if(o!==void 0&&uc(o))for(let s=0,l=o.length;s!==l;++s){const c=o[s];if(isNaN(c)){console.error("v3d.KeyframeTrack: Value is not a valid number.",this,s,c),e=!1;break}}return e}optimize(){const e=wi(this.times),t=wi(this.values),r=this.getValueSize(),o=this.getInterpolation()===2302,i=e.length-1;let a=1;for(let s=1;s<i;++s){let l=!1;const c=e[s];if(c!==e[s+1]&&(s!==1||c!==e[0]))if(o)l=!0;else{const u=s*r,d=u-r,f=u+r;for(let h=0;h!==r;++h){const p=t[u+h];if(p!==t[d+h]||p!==t[f+h]){l=!0;break}}}if(l){if(s!==a){e[a]=e[s];const u=s*r,d=a*r;for(let f=0;f!==r;++f)t[d+f]=t[u+f]}++a}}if(i>0){e[a]=e[i];for(let s=i*r,l=a*r,c=0;c!==r;++c)t[l+c]=t[s+c];++a}return a!==e.length?(this.times=wi(e,0,a),this.values=wi(t,0,a*r)):(this.times=e,this.values=t),this}clone(){const e=wi(this.times,0),t=wi(this.values,0),r=new this.constructor(this.name,e,t);return r.createInterpolant=this.createInterpolant,r}}Sa.prototype.TimeBufferType=Float32Array,Sa.prototype.ValueBufferType=Float32Array,Sa.prototype.DefaultInterpolation=2301;class Nh extends Sa{}Nh.prototype.ValueTypeName="vector";class dc extends Sa{}dc.prototype.ValueTypeName="string",dc.prototype.ValueBufferType=Array,dc.prototype.DefaultInterpolation=2300,dc.prototype.InterpolantFactoryMethodLinear=void 0,dc.prototype.InterpolantFactoryMethodSmooth=void 0;class iD extends qu{constructor(e,t,r,o){super(e,t,r,o)}interpolate_(e,t,r,o){const i=this.resultBuffer,a=this.sampleValues,s=this.valueSize,l=(r-t)/(o-t);let c=e*s;for(let u=c+s;c!==u;c+=4)It.slerpFlat(i,0,a,c-s,a,c,l);return i}}class fc extends Sa{InterpolantFactoryMethodLinear(e){return new iD(this.times,this.values,this.getValueSize(),e)}}fc.prototype.ValueTypeName="quaternion",fc.prototype.DefaultInterpolation=2301,fc.prototype.InterpolantFactoryMethodSmooth=void 0;class hc extends Sa{}hc.prototype.ValueTypeName="number";class Sb extends Sa{}Sb.prototype.ValueTypeName="color";class pc extends Sa{}pc.prototype.ValueTypeName="bool",pc.prototype.ValueBufferType=Array,pc.prototype.DefaultInterpolation=2300,pc.prototype.InterpolantFactoryMethodLinear=void 0,pc.prototype.InterpolantFactoryMethodSmooth=void 0;class aD{constructor(e,t,r){let o,i,a;switch(this.binding=e,this.valueSize=r,t){case"quaternion":o=this._slerp,i=this._slerpAdditive,a=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*r),this._workIndex=5;break;case"string":case"bool":o=this._select,i=this._select,a=this._setAdditiveIdentityOther,this.buffer=new Array(5*r);break;default:o=this._lerp,i=this._lerpAdditive,a=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*r)}this._mixBufferRegion=o,this._mixBufferRegionAdditive=i,this._setIdentity=a,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){const r=this.buffer,o=this.valueSize,i=e*o+o;let a=this.cumulativeWeight;if(a===0){for(let s=0;s!==o;++s)r[i+s]=r[s];a=t}else{a+=t;const s=t/a;this._mixBufferRegion(r,i,0,s,o)}this.cumulativeWeight=a}accumulateAdditive(e){const t=this.buffer,r=this.valueSize,o=r*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(t,o,0,e,r),this.cumulativeWeightAdditive+=e}apply(e){const t=this.valueSize,r=this.buffer,o=e*t+t,i=this.cumulativeWeight,a=this.cumulativeWeightAdditive,s=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,i<1){const l=t*this._origIndex;this._mixBufferRegion(r,o,l,1-i,t)}a>0&&this._mixBufferRegionAdditive(r,o,this._addIndex*t,1,t);for(let l=t,c=t+t;l!==c;++l)if(r[l]!==r[l+t]){s.setValue(r,o);break}}saveOriginalState(){const e=this.binding,t=this.buffer,r=this.valueSize,o=r*this._origIndex;e.getValue(t,o);for(let i=r,a=o;i!==a;++i)t[i]=t[o+i%r];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=3*this.valueSize;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let r=e;r<t;r++)this.buffer[r]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let r=0;r<this.valueSize;r++)this.buffer[t+r]=this.buffer[e+r]}_select(e,t,r,o,i){if(o>=.5)for(let a=0;a!==i;++a)e[t+a]=e[r+a]}_slerp(e,t,r,o){It.slerpFlat(e,t,e,t,e,r,o)}_slerpAdditive(e,t,r,o,i){const a=this._workIndex*i;It.multiplyQuaternionsFlat(e,a,e,t,e,r),It.slerpFlat(e,t,e,t,e,a,o)}_lerp(e,t,r,o,i){const a=1-o;for(let s=0;s!==i;++s){const l=t+s;e[l]=e[l]*a+e[r+s]*o}}_lerpAdditive(e,t,r,o,i){for(let a=0;a!==i;++a){const s=t+a;e[s]=e[s]+e[r+a]*o}}}const ove=new RegExp("[\\[\\]\\.]","g"),wb="[^\\[\\]\\.]",ive="[^"+"\\[\\]\\.".replace("\\.","")+"]";/((?:WC+[\/:])*)/.source.replace("WC",wb);const ave=/(WCOD+)?/.source.replace("WCOD",ive),sve=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",wb),lve=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",wb),cve=new RegExp("^"+ave+sve+lve+"$"),uve=["material","materials","bones","map"];class dve{constructor(e,t,r){const o=r||Kt.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,o)}getValue(e,t){this.bind();const r=this._targetGroup.nCachedObjects_,o=this._bindings[r];o!==void 0&&o.getValue(e,t)}setValue(e,t){const r=this._bindings;for(let o=this._targetGroup.nCachedObjects_,i=r.length;o!==i;++o)r[o].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,r=e.length;t!==r;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,r=e.length;t!==r;++t)e[t].unbind()}}class Kt{constructor(e,t,r){this.path=t,this.parsedPath=r||Kt.parseTrackName(t),this.node=Kt.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,r){return e&&e.isAnimationObjectGroup?new Kt.Composite(e,t,r):new Kt(e,t,r)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(ove,"")}static parseTrackName(e){const t=cve.exec(e);if(t===null)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const r={nodeName:t[1],objectName:t[2],objectIndex:t[3],propertyName:t[4],propertyIndex:t[5]},o=r.nodeName&&r.nodeName.lastIndexOf(".");if(o!==void 0&&o!==-1){const i=r.nodeName.substring(o+1);uve.indexOf(i)!==-1&&(r.nodeName=r.nodeName.substring(0,o),r.objectName=i)}if(r.propertyName===null||r.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return r}static findNode(e,t){if(t===void 0||t===""||t==="."||t===-1||t===e.name||t===e.uuid)return e;if(e.skeleton){const r=e.skeleton.getBoneByName(t);if(r!==void 0)return r}if(e.children){const r=function(i){for(let a=0;a<i.length;a++){const s=i[a];if(s.name===t||s.uuid===t)return s;const l=r(s.children);if(l)return l}return null},o=r(e.children);if(o)return o}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){const r=this.resolvedProperty;for(let o=0,i=r.length;o!==i;++o)e[t++]=r[o]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const r=this.resolvedProperty;for(let o=0,i=r.length;o!==i;++o)r[o]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const r=this.resolvedProperty;for(let o=0,i=r.length;o!==i;++o)r[o]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const r=this.resolvedProperty;for(let o=0,i=r.length;o!==i;++o)r[o]=e[t++];if(this.targetObject.matrixWorldNeedsUpdate=!0,this.propertyName==="morphTargetInfluences"){const o=this.targetObject.getAuxClippingMeshes();for(let i=0;i<o.length;i++){const a=o[i];if(a.morphTargetInfluences){const s=this.targetObject.morphTargetInfluences;for(let l=0;l<s.length;l++){const c=s[l];a.morphTargetInfluences[l]=c}}}}}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,r=t.objectName,o=t.propertyName;let i=t.propertyIndex;if(e||(e=Kt.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e)return void console.error("v3d.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");if(r){let c=t.objectIndex;switch(r){case"materials":if(!e.material)return void console.error("v3d.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("v3d.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("v3d.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);e=e.skeleton.bones;for(let u=0;u<e.length;u++)if(e[u].name===c){c=u;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material)return void console.error("v3d.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.map)return void console.error("v3d.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);e=e.material.map;break;case"constraints":if(e.constraints===void 0)return void console.error("v3d.PropertyBinding: Can not bind to constraints of node undefined.",this);e=e.constraints,c=c.replace(/"/g,"");for(let u=0;u<e.length;u++)if(e[u].name===c){c=u;break}break;default:if(e[r]===void 0)return void console.error("v3d.PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[r]}if(c!==void 0){if(e[c]===void 0)return void console.error("v3d.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[c]}}let a=e[o];if(a===void 0){const c=t.nodeName;return void console.error("v3d.PropertyBinding: Trying to update property for track: "+c+"."+o+" but it wasn't found.",e)}let s=this.Versioning.None;this.targetObject=e,e.isMeshNodeMaterial||e.needsUpdate===void 0?e.matrixWorldNeedsUpdate!==void 0&&(s=this.Versioning.MatrixWorldNeedsUpdate):s=this.Versioning.NeedsUpdate;let l=this.BindingType.Direct;if(i!==void 0){if(o==="morphTargetInfluences"){if(!e.geometry)return void console.error("v3d.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!e.geometry.morphAttributes)return void console.error("v3d.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);e.morphTargetDictionary[i]!==void 0&&(i=e.morphTargetDictionary[i]),this.propertyName=o}else if(o=="nodeValue"){if(i=i.replace(/"/g,""),!e.nodeValueMap)return void console.error("v3d.PropertyBinding: Trying to animate nodes in non-node material",this);if(i=e.nodeValueMap[i],i===void 0)return void console.error("v3d.PropertyBinding: Animated node not found ",this)}if(l=this.BindingType.ArrayElement,o=="nodeRGB"){if(i=i.replace(/"/g,""),!e.nodeRGBMap)return void console.error("v3d.PropertyBinding: Trying to animate nodes in non-node material",this);if(i=e.nodeRGBMap[i],i===void 0)return void console.error("v3d.PropertyBinding: Animated node not found ",this);l=this.BindingType.HasFromToArray,a=e.nodeRGB[i]}this.resolvedProperty=a,this.propertyIndex=i}else a.fromArray!==void 0&&a.toArray!==void 0?(l=this.BindingType.HasFromToArray,this.resolvedProperty=a):Array.isArray(a)?(l=this.BindingType.EntireArray,this.resolvedProperty=a,o==="morphTargetInfluences"&&(this.propertyName=o)):this.propertyName=o;this.getValue=this.GetterByBindingType[l],this.setValue=this.SetterByBindingTypeAndVersioning[l][s]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}Kt.Composite=dve,Kt.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Kt.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},Kt.prototype.GetterByBindingType=[Kt.prototype._getValue_direct,Kt.prototype._getValue_array,Kt.prototype._getValue_arrayElement,Kt.prototype._getValue_toArray],Kt.prototype.SetterByBindingTypeAndVersioning=[[Kt.prototype._setValue_direct,Kt.prototype._setValue_direct_setNeedsUpdate,Kt.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Kt.prototype._setValue_array,Kt.prototype._setValue_array_setNeedsUpdate,Kt.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Kt.prototype._setValue_arrayElement,Kt.prototype._setValue_arrayElement_setNeedsUpdate,Kt.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Kt.prototype._setValue_fromArray,Kt.prototype._setValue_fromArray_setNeedsUpdate,Kt.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class fve{constructor(){this.isAnimationObjectGroup=!0,this.uuid=ji(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const e={};this._indicesByUUID=e;for(let r=0,o=arguments.length;r!==o;++r)e[arguments[r].uuid]=r;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const t=this;this.stats={objects:{get total(){return t._objects.length},get inUse(){return this.total-t.nCachedObjects_}},get bindingsPerObject(){return t._bindings.length}}}add(){const e=this._objects,t=this._indicesByUUID,r=this._paths,o=this._parsedPaths,i=this._bindings,a=i.length;let s,l=e.length,c=this.nCachedObjects_;for(let u=0,d=arguments.length;u!==d;++u){const f=arguments[u],h=f.uuid;let p=t[h];if(p===void 0){p=l++,t[h]=p,e.push(f);for(let m=0,g=a;m!==g;++m)i[m].push(new Kt(f,r[m],o[m]))}else if(p<c){s=e[p];const m=--c,g=e[m];t[g.uuid]=p,e[p]=g,t[h]=m,e[m]=f;for(let _=0,A=a;_!==A;++_){const y=i[_],b=y[m];let E=y[p];y[p]=b,E===void 0&&(E=new Kt(f,r[_],o[_])),y[m]=E}}else e[p]!==s&&console.error("v3d.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=c}remove(){const e=this._objects,t=this._indicesByUUID,r=this._bindings,o=r.length;let i=this.nCachedObjects_;for(let a=0,s=arguments.length;a!==s;++a){const l=arguments[a],c=l.uuid,u=t[c];if(u!==void 0&&u>=i){const d=i++,f=e[d];t[f.uuid]=u,e[u]=f,t[c]=d,e[d]=l;for(let h=0,p=o;h!==p;++h){const m=r[h],g=m[d],_=m[u];m[u]=g,m[d]=_}}}this.nCachedObjects_=i}uncache(){const e=this._objects,t=this._indicesByUUID,r=this._bindings,o=r.length;let i=this.nCachedObjects_,a=e.length;for(let s=0,l=arguments.length;s!==l;++s){const c=arguments[s].uuid,u=t[c];if(u!==void 0)if(delete t[c],u<i){const d=--i,f=e[d],h=--a,p=e[h];t[f.uuid]=u,e[u]=f,t[p.uuid]=d,e[d]=p,e.pop();for(let m=0,g=o;m!==g;++m){const _=r[m],A=_[d],y=_[h];_[u]=A,_[d]=y,_.pop()}}else{const d=--a,f=e[d];d>0&&(t[f.uuid]=u),e[u]=f,e.pop();for(let h=0,p=o;h!==p;++h){const m=r[h];m[u]=m[d],m.pop()}}}this.nCachedObjects_=i}subscribe_(e,t){const r=this._bindingsIndicesByPath;let o=r[e];const i=this._bindings;if(o!==void 0)return i[o];const a=this._paths,s=this._parsedPaths,l=this._objects,c=l.length,u=this.nCachedObjects_,d=new Array(c);o=i.length,r[e]=o,a.push(e),s.push(t),i.push(d);for(let f=u,h=l.length;f!==h;++f){const p=l[f];d[f]=new Kt(p,e,t)}return d}unsubscribe_(e){const t=this._bindingsIndicesByPath,r=t[e];if(r!==void 0){const o=this._paths,i=this._parsedPaths,a=this._bindings,s=a.length-1,l=a[s];t[e[s]]=r,a[r]=l,a.pop(),i[r]=i[s],i.pop(),o[r]=o[s],o.pop()}}}class hve{constructor(e,t,r=null,o=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=r,this.blendMode=o;const i=t.tracks,a=i.length,s=new Array(a),l={endingStart:2400,endingEnd:2400};for(let c=0;c!==a;++c){const u=i[c].createInterpolant(null);s[c]=u,u.settings=l}this._interpolantSettings=l,this._interpolants=s,this._propertyBindings=new Array(a),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=2201,this._loopCount=-1,this._pingIsEven=!0,this._startTime=null,this.time=0,this.timeStart=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!0,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0,this.autoParams={loop:2201,repetitions:1/0}}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this._pingIsEven=!0,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t,r=!1){return this.loop=e,this.repetitions=t,r&&(this.autoParams.loop=e,this.autoParams.repetitions=t),this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,r){if(e.fadeOut(t),this.fadeIn(t),r){const o=this._clip.duration,i=e._clip.duration,a=i/o,s=o/i;e.warp(1,a,t),this.warp(s,1,t)}return this}crossFadeTo(e,t,r){return e.crossFadeFrom(this,t,r)}stopFading(){const e=this._weightInterpolant;return e!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,r){const o=this._mixer,i=o.time,a=this.timeScale;let s=this._timeScaleInterpolant;s===null&&(s=o._lendControlInterpolant(),this._timeScaleInterpolant=s);const l=s.parameterPositions,c=s.sampleValues;return l[0]=i,l[1]=i+r,c[0]=e/a,c[1]=t/a,this}stopWarping(){const e=this._timeScaleInterpolant;return e!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,r,o){if(!this.enabled)return void this._updateWeight(e);const i=this._startTime;if(i!==null){const l=(e-i)*r;if(l<0||r===0)return;this._startTime=null,t=r*l}t*=this._updateTimeScale(e);const a=this._updateTime(t),s=this._updateWeight(e);if(s>0){const l=this._interpolants,c=this._propertyBindings;if(this.blendMode===2501)for(let u=0,d=l.length;u!==d;++u)l[u].evaluate(a),c[u].accumulateAdditive(s);else for(let u=0,d=l.length;u!==d;++u)l[u].evaluate(a),c[u].accumulate(o,s)}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;const r=this._weightInterpolant;if(r!==null){const o=r.evaluate(e)[0];t*=o,e>r.parameterPositions[1]&&(this.stopFading(),o===0&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;const r=this._timeScaleInterpolant;r!==null&&(t*=r.evaluate(e)[0],e>r.parameterPositions[1]&&(this.stopWarping(),t===0?this.paused=!0:this.timeScale=t))}return this._effectiveTimeScale=t,t}_loopIsPing(e){return this.loop!==2202||e==-1?!0:!(1&e)===this._pingIsEven}_updateTime(e){if(e===0)return this.time;if(this.loop!==2200&&this.repetitions<=0)return this.clampWhenFinished?this.paused=!0:this.enabled=!1,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1}),this.time;var t=this.timeStart,r=Math.max(t,this._clip.duration),o=r-t;if(this.loop===2200)return this.time+=e,this._loopCount===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1)),(this.time<t||this.time>r)&&(this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=Ht(this.time,t,r),this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})),this.time;var i=this.loop===2202,a=this._loopIsPing(this._loopCount)?1:-1;this.time+=a*e;var s=this.time<t||this.time>r,l=!1;if(this._loopCount===-1&&(l=s,this._loopCount=l?-1:0,this._pingIsEven=!l,e>=0?this._setEndings(!0,this.repetitions===0,i):this._setEndings(this.repetitions===0,!0,i)),s){var c=Math.floor((this.time-t)/o);this._loopCount+=Math.abs(c);var u=this.repetitions-this._loopCount;if(u<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=Ht(this.time,t,r),this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1});else{if(u==1){var d=e<0;this._setEndings(d,!d,i)}else this._setEndings(!1,!1,i);var f=(this.time-t)%o;f<0&&(f+=o),this.time=i?r-f:f+t,l||this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:c})}}return this.time}_setEndings(e,t,r){const o=this._interpolantSettings;r?(o.endingStart=2401,o.endingEnd=2401):(o.endingStart=e?this.zeroSlopeAtStart?2401:2400:2402,o.endingEnd=t?this.zeroSlopeAtEnd?2401:2400:2402)}_scheduleFading(e,t,r){const o=this._mixer,i=o.time;let a=this._weightInterpolant;a===null&&(a=o._lendControlInterpolant(),this._weightInterpolant=a);const s=a.parameterPositions,l=a.sampleValues;return s[0]=i,l[0]=t,s[1]=i+e,l[1]=r,this}}class j0{constructor(e,t=-1,r,o=2500){this.name=e,this.tracks=r,this.duration=t,this.blendMode=o,this.uuid=ji(),this.objectUUID="",this.duration<0&&this.resetDuration()}static parse(e){const t=[],r=e.tracks,o=1/(e.fps||1);for(let a=0,s=r.length;a!==s;++a)t.push(mve(r[a]).scale(o));const i=new this(e.name,e.duration,t,e.blendMode);return i.uuid=e.uuid,i}static CreateFromMorphTargetSequence(e,t,r,o){const i=t.length,a=[];for(let s=0;s<i;s++){let l=[],c=[];l.push((s+i-1)%i,s,(s+1)%i),c.push(0,1,0);const u=rD(l);l=Cb(l,1,u),c=Cb(c,1,u),o||l[0]!==0||(l.push(i),c.push(c[0])),a.push(new hc(".morphTargetInfluences["+t[s].name+"]",l,c).scale(1/r))}return new this(e,-1,a)}static findByName(e,t){let r=e;if(!Array.isArray(e)){const o=e;r=o.geometry&&o.geometry.animations||o.animations}for(let o=0;o<r.length;o++)if(r[o].name===t)return r[o];return null}static CreateClipsFromMorphTargetSequences(e,t,r){const o={},i=/^([\w-]*?)([\d]+)$/;for(let s=0,l=e.length;s<l;s++){const c=e[s],u=c.name.match(i);if(u&&u.length>1){const d=u[1];let f=o[d];f||(o[d]=f=[]),f.push(c)}}const a=[];for(const s in o)a.push(this.CreateFromMorphTargetSequence(s,o[s],t,r));return a}resetDuration(){let e=0;for(let t=0,r=this.tracks.length;t!==r;++t){const o=this.tracks[t];e=Math.max(e,o.times[o.times.length-1])}return this.duration=e,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}}function pve(n){switch(n.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return hc;case"vector":case"vector2":case"vector3":case"vector4":return Nh;case"color":return Sb;case"quaternion":return fc;case"bool":case"boolean":return pc;case"string":return dc}throw new Error("v3d.KeyframeTrack: Unsupported typeName: "+n)}function mve(n){if(n.type===void 0)throw new Error("v3d.KeyframeTrack: track type undefined, can not parse");const e=pve(n.type);if(n.times===void 0){const t=[],r=[];oD(n.keys,t,r,"value"),n.times=t,n.values=r}return e.parse!==void 0?e.parse(n):new e(n.name,n.times,n.values,n.interpolation)}const gve=new Float32Array(1);class sD extends ti{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){const r=e._localRoot||this._root,o=e._clip.tracks,i=o.length,a=e._propertyBindings,s=e._interpolants,l=r.uuid,c=this._bindingsByRootAndName;let u=c[l];u===void 0&&(u={},c[l]=u);for(let d=0;d!==i;++d){const f=o[d],h=f.name;let p=u[h];if(p!==void 0)++p.referenceCount,a[d]=p;else{if(p=a[d],p!==void 0){p._cacheIndex===null&&(++p.referenceCount,this._addInactiveBinding(p,l,h));continue}const m=t&&t._propertyBindings[d].binding.parsedPath;p=new aD(Kt.create(r,h,m),f.ValueTypeName,f.getValueSize()),++p.referenceCount,this._addInactiveBinding(p,l,h),a[d]=p}s[d].resultBuffer=p.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(e._cacheIndex===null){const r=(e._localRoot||this._root).uuid,o=e._clip.uuid,i=this._actionsByClip[o];this._bindAction(e,i&&i.knownActions[0]),this._addInactiveAction(e,o,r)}const t=e._propertyBindings;for(let r=0,o=t.length;r!==o;++r){const i=t[r];i.useCount++===0&&(this._lendBinding(i),i.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const t=e._propertyBindings;for(let r=0,o=t.length;r!==o;++r){const i=t[r];--i.useCount===0&&(i.restoreOriginalState(),this._takeBackBinding(i))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const t=e._cacheIndex;return t!==null&&t<this._nActiveActions}_addInactiveAction(e,t,r){const o=this._actions,i=this._actionsByClip;let a=i[t];if(a===void 0)a={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,i[t]=a;else{const s=a.knownActions;e._byClipCacheIndex=s.length,s.push(e)}e._cacheIndex=o.length,o.push(e),a.actionByRoot[r]=e}_removeInactiveAction(e){const t=this._actions,r=t[t.length-1],o=e._cacheIndex;r._cacheIndex=o,t[o]=r,t.pop(),e._cacheIndex=null;const i=e._clip.uuid,a=this._actionsByClip,s=a[i],l=s.knownActions,c=l[l.length-1],u=e._byClipCacheIndex;c._byClipCacheIndex=u,l[u]=c,l.pop(),e._byClipCacheIndex=null,delete s.actionByRoot[(e._localRoot||this._root).uuid],l.length===0&&delete a[i],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const t=e._propertyBindings;for(let r=0,o=t.length;r!==o;++r){const i=t[r];--i.referenceCount===0&&this._removeInactiveBinding(i)}}_lendAction(e){const t=this._actions,r=e._cacheIndex,o=this._nActiveActions++,i=t[o];e._cacheIndex=o,t[o]=e,i._cacheIndex=r,t[r]=i}_takeBackAction(e){const t=this._actions,r=e._cacheIndex,o=--this._nActiveActions,i=t[o];e._cacheIndex=o,t[o]=e,i._cacheIndex=r,t[r]=i}_addInactiveBinding(e,t,r){const o=this._bindingsByRootAndName,i=this._bindings;let a=o[t];a===void 0&&(a={},o[t]=a),a[r]=e,e._cacheIndex=i.length,i.push(e)}_removeInactiveBinding(e){const t=this._bindings,r=e.binding,o=r.rootNode.uuid,i=r.path,a=this._bindingsByRootAndName,s=a[o],l=t[t.length-1],c=e._cacheIndex;l._cacheIndex=c,t[c]=l,t.pop(),delete s[i],Object.keys(s).length===0&&delete a[o]}_lendBinding(e){const t=this._bindings,r=e._cacheIndex,o=this._nActiveBindings++,i=t[o];e._cacheIndex=o,t[o]=e,i._cacheIndex=r,t[r]=i}_takeBackBinding(e){const t=this._bindings,r=e._cacheIndex,o=--this._nActiveBindings,i=t[o];e._cacheIndex=o,t[o]=e,i._cacheIndex=r,t[r]=i}_lendControlInterpolant(){const e=this._controlInterpolants,t=this._nActiveControlInterpolants++;let r=e[t];return r===void 0&&(r=new z0(new Float32Array(2),new Float32Array(2),1,gve),r.__cacheIndex=t,e[t]=r),r}_takeBackControlInterpolant(e){const t=this._controlInterpolants,r=e.__cacheIndex,o=--this._nActiveControlInterpolants,i=t[o];e.__cacheIndex=o,t[o]=e,i.__cacheIndex=r,t[r]=i}clipAction(e,t,r){const o=t||this._root,i=o.uuid;let a=typeof e=="string"?j0.findByName(o,e):e;const s=a!==null?a.uuid:e,l=this._actionsByClip[s];let c=null;if(r===void 0&&(r=a!==null?a.blendMode:2500),l!==void 0){const d=l.actionByRoot[i];if(d!==void 0&&d.blendMode===r)return d;c=l.knownActions[0],a===null&&(a=c._clip)}if(a===null)return null;const u=new hve(this,a,t,r);return this._bindAction(u,c),this._addInactiveAction(u,s,i),u}existingAction(e,t){const r=t||this._root,o=r.uuid,i=typeof e=="string"?j0.findByName(r,e):e,a=i?i.uuid:e,s=this._actionsByClip[a];return s!==void 0&&s.actionByRoot[o]||null}stopAllAction(){const e=this._actions;for(let t=this._nActiveActions-1;t>=0;--t)e[t].stop();return this}update(e){e*=this.timeScale;const t=this._actions,r=this._nActiveActions,o=this.time+=e,i=Math.sign(e),a=this._accuIndex^=1;for(let c=0;c!==r;++c)t[c]._update(o,e,i,a);const s=this._bindings,l=this._nActiveBindings;for(let c=0;c!==l;++c)s[c].apply(a);return this}setTime(e){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const t=this._actions,r=e.uuid,o=this._actionsByClip,i=o[r];if(i!==void 0){const a=i.knownActions;for(let s=0,l=a.length;s!==l;++s){const c=a[s];this._deactivateAction(c);const u=c._cacheIndex,d=t[t.length-1];c._cacheIndex=null,c._byClipCacheIndex=null,d._cacheIndex=u,t[u]=d,t.pop(),this._removeInactiveBindingsForAction(c)}delete o[r]}}uncacheRoot(e){const t=e.uuid,r=this._actionsByClip;for(const i in r){const a=r[i].actionByRoot[t];a!==void 0&&(this._deactivateAction(a),this._removeInactiveAction(a))}const o=this._bindingsByRootAndName[t];if(o!==void 0)for(const i in o){const a=o[i];a.restoreOriginalState(),this._removeInactiveBinding(a)}}uncacheAction(e,t){const r=this.existingAction(e,t);r!==null&&(this._deactivateAction(r),this._removeInactiveAction(r))}}class Q0{constructor(e){this.value=e}clone(){return new Q0(this.value.clone===void 0?this.value:this.value.clone())}}let _ve=0;class vve extends ti{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:_ve++}),this.name="",this.usage=35044,this.uniforms=[]}add(e){return this.uniforms.push(e),this}remove(e){const t=this.uniforms.indexOf(e);return t!==-1&&this.uniforms.splice(t,1),this}setName(e){return this.name=e,this}setUsage(e){return this.usage=e,this}dispose(){return this.dispatchEvent({type:"dispose"}),this}copy(e){this.name=e.name,this.usage=e.usage;const t=e.uniforms;this.uniforms.length=0;for(let r=0,o=t.length;r<o;r++)this.uniforms.push(t[r].clone());return this}clone(){return new this.constructor().copy(this)}}class Ave extends At{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}}class yve{constructor(e,t,r,o,i){this.isGLBufferAttribute=!0,this.buffer=e,this.type=t,this.itemSize=r,this.elementSize=o,this.count=i,this.version=0}set needsUpdate(e){e===!0&&this.version++}setBuffer(e){return this.buffer=e,this}setType(e,t){return this.type=e,this.elementSize=t,this}setItemSize(e){return this.itemSize=e,this}setCount(e){return this.count=e,this}}class bve{constructor(e=1,t=0,r=0){return this.radius=e,this.theta=t,this.y=r,this}set(e,t,r){return this.radius=e,this.theta=t,this.y=r,this}copy(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,r){return this.radius=Math.sqrt(e*e+r*r),this.theta=Math.atan2(e,r),this.y=t,this}clone(){return new this.constructor().copy(this)}}const lD=new be;class xve{constructor(e=new be(1/0,1/0),t=new be(-1/0,-1/0)){this.isBox2=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,r=e.length;t<r;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const r=lD.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return lD.copy(e).clamp(this.min,this.max).sub(e).length()}intersect(e){return this.min.max(e.min),this.max.min(e.max),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const cD=new N,$0=new N;class wa{constructor(e=new N,t=new N){this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){cD.subVectors(e,this.start),$0.subVectors(this.end,this.start);const r=$0.dot($0);let o=$0.dot(cD)/r;return t&&(o=Ht(o,0,1)),o}closestPointToPoint(e,t,r){const o=this.closestPointToPointParameter(e,t);return this.delta(r).multiplyScalar(o).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return new this.constructor().copy(this)}}const uD=new N;class dD extends kt{constructor(e,t){super(),this.light=e,this.matrixAutoUpdate=!1,this.color=t,this.type="SpotLightHelper";const r=new At,o=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let a=0,s=1,l=32;a<l;a++,s++){const c=a/l*Math.PI*2,u=s/l*Math.PI*2;o.push(Math.cos(c),Math.sin(c),1,Math.cos(u),Math.sin(u),1)}r.setAttribute("position",new mt(o,3));const i=new _r({fog:!1,toneMapped:!1});this.cone=new ai(r,i),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),this.parent?(this.parent.updateWorldMatrix(!0),this.matrix.copy(this.parent.matrixWorld).invert().multiply(this.light.matrixWorld)):this.matrix.copy(this.light.matrixWorld),this.matrixWorld.copy(this.light.matrixWorld);const e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),uD.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(uD),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const hl=new N,Y0=new Ue,Mb=new Ue;class fD extends ai{constructor(e){const t=hD(e),r=new At,o=[],i=[],a=new Ge(0,0,1),s=new Ge(0,1,0);for(let l=0;l<t.length;l++){const c=t[l];c.parent&&c.parent.isBone&&(o.push(0,0,0),o.push(0,0,0),i.push(a.r,a.g,a.b),i.push(s.r,s.g,s.b))}r.setAttribute("position",new mt(o,3)),r.setAttribute("color",new mt(i,3)),super(r,new _r({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=e,this.bones=t,this.matrixAutoUpdate=!1}updateMatrixWorld(e){this.parent?this.matrix.copy(this.parent.matrixWorld).invert().multiply(this.root.matrixWorld):this.matrix.copy(this.root.matrixWorld);const t=this.bones,r=this.geometry,o=r.getAttribute("position");Mb.copy(this.root.matrixWorld).invert();for(let i=0,a=0;i<t.length;i++){const s=t[i];s.parent&&s.parent.isBone&&(Y0.multiplyMatrices(Mb,s.matrixWorld),hl.setFromMatrixPosition(Y0),o.setXYZ(a,hl.x,hl.y,hl.z),Y0.multiplyMatrices(Mb,s.parent.matrixWorld),hl.setFromMatrixPosition(Y0),o.setXYZ(a+1,hl.x,hl.y,hl.z),a+=2)}r.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose()}}function hD(n){const e=[];n.isBone===!0&&e.push(n);for(let t=0;t<n.children.length;t++)e.push.apply(e,hD(n.children[t]));return e}class pD extends Mt{constructor(e,t,r){super(new yP(t,4,3),new pr({wireframe:!0,fog:!1,toneMapped:!1})),this.light=e,this.color=r,this.type="PointLightHelper",this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.parent?(this.parent.updateWorldMatrix(!0),this.matrix.copy(this.parent.matrixWorld).invert().multiply(this.light.matrixWorld)):this.matrix.copy(this.light.matrixWorld),this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const Eve=new N,mD=new Ge,gD=new Ge;class Cve extends kt{constructor(e,t,r){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=r,this.type="HemisphereLightHelper";const o=new AP(t);o.rotateY(.5*Math.PI),this.material=new pr({wireframe:!0,fog:!1,toneMapped:!1}),this.color===void 0&&(this.material.vertexColors=!0);const i=o.getAttribute("position"),a=new Float32Array(3*i.count);o.setAttribute("color",new Xe(a,3)),this.add(new Mt(o,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const e=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{const t=e.geometry.getAttribute("color");mD.copy(this.light.color),gD.copy(this.light.groundColor);for(let r=0,o=t.count;r<o;r++){const i=r<o/2?mD:gD;t.setXYZ(r,i.r,i.g,i.b)}t.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),e.lookAt(Eve.setFromMatrixPosition(this.light.matrixWorld).negate())}}class Sve extends ai{constructor(e=10,t=10,r=4473924,o=8947848){r=new Ge(r),o=new Ge(o);const i=t/2,a=e/t,s=e/2,l=[],c=[];for(let d=0,f=0,h=-s;d<=t;d++,h+=a){l.push(-s,0,h,s,0,h),l.push(h,0,-s,h,0,s);const p=d===i?r:o;p.toArray(c,f),f+=3,p.toArray(c,f),f+=3,p.toArray(c,f),f+=3,p.toArray(c,f),f+=3}const u=new At;u.setAttribute("position",new mt(l,3)),u.setAttribute("color",new mt(c,3)),super(u,new _r({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}class wve extends ai{constructor(e=10,t=16,r=8,o=64,i=4473924,a=8947848){i=new Ge(i),a=new Ge(a);const s=[],l=[];if(t>1)for(let u=0;u<t;u++){const d=u/t*(2*Math.PI),f=Math.sin(d)*e,h=Math.cos(d)*e;s.push(0,0,0),s.push(f,0,h);const p=1&u?i:a;l.push(p.r,p.g,p.b),l.push(p.r,p.g,p.b)}for(let u=0;u<r;u++){const d=1&u?i:a,f=e-e/r*u;for(let h=0;h<o;h++){let p=h/o*(2*Math.PI),m=Math.sin(p)*f,g=Math.cos(p)*f;s.push(m,0,g),l.push(d.r,d.g,d.b),p=(h+1)/o*(2*Math.PI),m=Math.sin(p)*f,g=Math.cos(p)*f,s.push(m,0,g),l.push(d.r,d.g,d.b)}}const c=new At;c.setAttribute("position",new mt(s,3)),c.setAttribute("color",new mt(l,3)),super(c,new _r({vertexColors:!0,toneMapped:!1})),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}class Tb extends ai{constructor(e,t=16776960){const r=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),o=new At;o.setIndex(new Xe(r,1)),o.setAttribute("position",new mt([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),super(o,new _r({color:t,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){const t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}dispose(){this.geometry.dispose(),this.material.dispose()}}const _D=new N,X0=new N,vD=new N;class AD extends kt{constructor(e,t,r){super(),this.light=e,this.matrixAutoUpdate=!1,this.color=r,this.type="DirectionalLightHelper",t===void 0&&(t=1);let o=new At;o.setAttribute("position",new mt([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));const i=new _r({fog:!1,toneMapped:!1});this.lightPlane=new Ki(o,i),this.add(this.lightPlane),o=new At,o.setAttribute("position",new mt([0,0,0,0,0,1],3)),this.targetLine=new Ki(o,i),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),this.parent?(this.parent.updateWorldMatrix(!0),this.matrix.copy(this.parent.matrixWorld).invert().multiply(this.light.matrixWorld)):this.matrix.copy(this.light.matrixWorld),_D.setFromMatrixPosition(this.light.matrixWorld),X0.setFromMatrixPosition(this.light.target.matrixWorld),vD.subVectors(X0,_D),this.lightPlane.lookAt(X0),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(X0),this.targetLine.scale.z=vD.length()}}class Mve extends kt{constructor(e){super(),this.csm=e,this.displayFrustum=!0,this.displayPlanes=!0,this.displayShadowBounds=!0;const t=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new Float32Array(24),o=new At;o.setIndex(new Xe(t,1)),o.setAttribute("position",new Xe(r,3,!1));const i=new ai(o,new _r);this.add(i),this.frustumLines=i,this.cascadeLines=[],this.cascadePlanes=[],this.shadowLines=[]}updateVisibility(){const e=this.displayFrustum&&this.visible,t=this.displayPlanes&&this.visible,r=this.displayShadowBounds&&this.visible,o=this.frustumLines,i=this.cascadeLines,a=this.cascadePlanes,s=this.shadowLines;for(let l=0,c=i.length;l<c;l++){const u=i[l],d=a[l],f=s[l];u.visible=e,d.visible=e&&t,f.visible=r,f.traverse((h=>{h.visible=r}))}o.visible=e}update(){const e=this.csm,t=e._sceneViewCamera;if(!t||e._needsUpdate)return;const r=e._cascades,o=r.length,i=e.mainFrustum,a=e._frustums,s=this.frustumLines.geometry.getAttribute("position"),l=this.cascadeLines,c=this.cascadePlanes,u=this.shadowLines;for(this.position.copy(t.position),this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.updateWorldMatrix(!1,!0);l.length>o;){this.remove(l.pop()),this.remove(c.pop());const h=u.pop();h.children[0].dispose(),this.remove(h)}for(;l.length<o;){const h=new Tb(new Tn,16777215),p=new pr({transparent:!0,opacity:.1,depthWrite:!1,side:2}),m=new Mt(new ms,p),g=new qi,_=new Tb(new Tn,16776960);g.add(_),this.add(h),this.add(m),this.add(g),l.push(h),c.push(m),u.push(g)}for(let h=0;h<o;h++){const p=a[h],m=r[h].camera,g=p.vertices.far,_=l[h],A=c[h],y=u[h],b=y.children[0];_.box.min.copy(g[2]),_.box.max.copy(g[0]),_.box.max.z+=1e-4,A.position.addVectors(g[0],g[2]),A.position.multiplyScalar(.5),A.scale.subVectors(g[0],g[2]),A.scale.z=1e-4,this.remove(y),y.position.copy(m.position),y.quaternion.copy(m.quaternion),y.scale.copy(m.scale),y.updateWorldMatrix(!1,!0),this.attach(y),b.box.min.set(m.bottom,m.left,-m.far),b.box.max.set(m.top,m.right,-m.near)}const d=i.vertices.near,f=i.vertices.far;s.setXYZ(0,f[0].x,f[0].y,f[0].z),s.setXYZ(1,f[3].x,f[3].y,f[3].z),s.setXYZ(2,f[2].x,f[2].y,f[2].z),s.setXYZ(3,f[1].x,f[1].y,f[1].z),s.setXYZ(4,d[0].x,d[0].y,d[0].z),s.setXYZ(5,d[3].x,d[3].y,d[3].z),s.setXYZ(6,d[2].x,d[2].y,d[2].z),s.setXYZ(7,d[1].x,d[1].y,d[1].z),s.needsUpdate=!0}dispose(){const e=this.frustumLines,t=this.cascadeLines,r=this.cascadePlanes,o=this.shadowLines;e.geometry.dispose(),e.material.dispose();const i=this.csm.cascades;for(let a=0;a<i;a++){const s=t[a],l=r[a],c=o[a].children[0];s.dispose(),l.geometry.dispose(),l.material.dispose(),c.dispose()}}}const q0=new N,rr=new fh;class Tve extends ai{constructor(e){const t=new At,r=new _r({color:16777215,vertexColors:!0,toneMapped:!1}),o=[],i=[],a={};function s(p,m){l(p),l(m)}function l(p){o.push(0,0,0),i.push(0,0,0),a[p]===void 0&&(a[p]=[]),a[p].push(o.length/3-1)}s("n1","n2"),s("n2","n4"),s("n4","n3"),s("n3","n1"),s("f1","f2"),s("f2","f4"),s("f4","f3"),s("f3","f1"),s("n1","f1"),s("n2","f2"),s("n3","f3"),s("n4","f4"),s("p","n1"),s("p","n2"),s("p","n3"),s("p","n4"),s("u1","u2"),s("u2","u3"),s("u3","u1"),s("c","t"),s("p","c"),s("cn1","cn2"),s("cn3","cn4"),s("cf1","cf2"),s("cf3","cf4"),t.setAttribute("position",new mt(o,3)),t.setAttribute("color",new mt(i,3)),super(t,r),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=a,this.update();const c=new Ge(16755200),u=new Ge(16711680),d=new Ge(43775),f=new Ge(16777215),h=new Ge(3355443);this.setColors(c,u,d,f,h)}setColors(e,t,r,o,i){const a=this.geometry.getAttribute("color");a.setXYZ(0,e.r,e.g,e.b),a.setXYZ(1,e.r,e.g,e.b),a.setXYZ(2,e.r,e.g,e.b),a.setXYZ(3,e.r,e.g,e.b),a.setXYZ(4,e.r,e.g,e.b),a.setXYZ(5,e.r,e.g,e.b),a.setXYZ(6,e.r,e.g,e.b),a.setXYZ(7,e.r,e.g,e.b),a.setXYZ(8,e.r,e.g,e.b),a.setXYZ(9,e.r,e.g,e.b),a.setXYZ(10,e.r,e.g,e.b),a.setXYZ(11,e.r,e.g,e.b),a.setXYZ(12,e.r,e.g,e.b),a.setXYZ(13,e.r,e.g,e.b),a.setXYZ(14,e.r,e.g,e.b),a.setXYZ(15,e.r,e.g,e.b),a.setXYZ(16,e.r,e.g,e.b),a.setXYZ(17,e.r,e.g,e.b),a.setXYZ(18,e.r,e.g,e.b),a.setXYZ(19,e.r,e.g,e.b),a.setXYZ(20,e.r,e.g,e.b),a.setXYZ(21,e.r,e.g,e.b),a.setXYZ(22,e.r,e.g,e.b),a.setXYZ(23,e.r,e.g,e.b),a.setXYZ(24,t.r,t.g,t.b),a.setXYZ(25,t.r,t.g,t.b),a.setXYZ(26,t.r,t.g,t.b),a.setXYZ(27,t.r,t.g,t.b),a.setXYZ(28,t.r,t.g,t.b),a.setXYZ(29,t.r,t.g,t.b),a.setXYZ(30,t.r,t.g,t.b),a.setXYZ(31,t.r,t.g,t.b),a.setXYZ(32,r.r,r.g,r.b),a.setXYZ(33,r.r,r.g,r.b),a.setXYZ(34,r.r,r.g,r.b),a.setXYZ(35,r.r,r.g,r.b),a.setXYZ(36,r.r,r.g,r.b),a.setXYZ(37,r.r,r.g,r.b),a.setXYZ(38,o.r,o.g,o.b),a.setXYZ(39,o.r,o.g,o.b),a.setXYZ(40,i.r,i.g,i.b),a.setXYZ(41,i.r,i.g,i.b),a.setXYZ(42,i.r,i.g,i.b),a.setXYZ(43,i.r,i.g,i.b),a.setXYZ(44,i.r,i.g,i.b),a.setXYZ(45,i.r,i.g,i.b),a.setXYZ(46,i.r,i.g,i.b),a.setXYZ(47,i.r,i.g,i.b),a.setXYZ(48,i.r,i.g,i.b),a.setXYZ(49,i.r,i.g,i.b),a.needsUpdate=!0}update(){const e=this.geometry,t=this.pointMap;rr.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),lr("c",t,e,rr,0,0,-1),lr("t",t,e,rr,0,0,1),lr("n1",t,e,rr,-1,-1,-1),lr("n2",t,e,rr,1,-1,-1),lr("n3",t,e,rr,-1,1,-1),lr("n4",t,e,rr,1,1,-1),lr("f1",t,e,rr,-1,-1,1),lr("f2",t,e,rr,1,-1,1),lr("f3",t,e,rr,-1,1,1),lr("f4",t,e,rr,1,1,1),lr("u1",t,e,rr,.7,1.1,-1),lr("u2",t,e,rr,-.7,1.1,-1),lr("u3",t,e,rr,0,2,-1),lr("cf1",t,e,rr,-1,0,1),lr("cf2",t,e,rr,1,0,1),lr("cf3",t,e,rr,0,-1,1),lr("cf4",t,e,rr,0,1,1),lr("cn1",t,e,rr,-1,0,-1),lr("cn2",t,e,rr,1,0,-1),lr("cn3",t,e,rr,0,-1,-1),lr("cn4",t,e,rr,0,1,-1),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function lr(n,e,t,r,o,i,a){q0.set(o,i,a).unproject(r);const s=e[n];if(s!==void 0){const l=t.getAttribute("position");for(let c=0,u=s.length;c<u;c++)l.setXYZ(s[c],q0.x,q0.y,q0.z)}}const K0=new Tn;class Ive extends ai{constructor(e,t=16776960){const r=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),o=new Float32Array(24),i=new At;i.setIndex(new Xe(r,1)),i.setAttribute("position",new Xe(o,3)),super(i,new _r({color:t,toneMapped:!1})),this.object=e,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(e){if(e!==void 0&&console.warn("v3d.BoxHelper: .update() has no longer arguments."),this.object!==void 0&&K0.setFromObject(this.object),K0.isEmpty())return;const t=K0.min,r=K0.max,o=this.geometry.attributes.position,i=o.array;i[0]=r.x,i[1]=r.y,i[2]=r.z,i[3]=t.x,i[4]=r.y,i[5]=r.z,i[6]=t.x,i[7]=t.y,i[8]=r.z,i[9]=r.x,i[10]=t.y,i[11]=r.z,i[12]=r.x,i[13]=r.y,i[14]=t.z,i[15]=t.x,i[16]=r.y,i[17]=t.z,i[18]=t.x,i[19]=t.y,i[20]=t.z,i[21]=r.x,i[22]=t.y,i[23]=t.z,o.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(e){return this.object=e,this.update(),this}copy(e,t){return super.copy(e,t),this.object=e.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class Rve extends Ki{constructor(e,t=1,r=16776960){const o=r,i=new At;i.setAttribute("position",new mt([1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],3)),i.computeBoundingSphere(),super(i,new _r({color:o,toneMapped:!1})),this.type="PlaneHelper",this.plane=e,this.size=t;const a=new At;a.setAttribute("position",new mt([1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],3)),a.computeBoundingSphere(),this.add(new Mt(a,new pr({color:o,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(e){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}const yD=new N;let Z0,Ib;class Lve extends kt{constructor(e=new N(0,0,1),t=new N(0,0,0),r=1,o=16776960,i=.2*r,a=.2*i){super(),this.type="ArrowHelper",Z0===void 0&&(Z0=new At,Z0.setAttribute("position",new mt([0,0,0,0,1,0],3)),Ib=new tb(0,.5,1,5,1),Ib.translate(0,-.5,0)),this.position.copy(t),this.line=new Ki(Z0,new _r({color:o,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Mt(Ib,new pr({color:o,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(r,i,a)}setDirection(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{yD.set(e.z,0,-e.x).normalize();const t=Math.acos(e.y);this.quaternion.setFromAxisAngle(yD,t)}}setLength(e,t=.2*e,r=.2*t){this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(r,t,r),this.cone.position.y=e,this.cone.updateMatrix()}setColor(e){this.line.material.color.set(e),this.cone.material.color.set(e)}copy(e){return super.copy(e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}class Pve extends ai{constructor(e=1){const t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],r=new At;r.setAttribute("position",new mt(t,3)),r.setAttribute("color",new mt([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3)),super(r,new _r({vertexColors:!0,toneMapped:!1})),this.type="AxesHelper"}setColors(e,t,r){const o=new Ge,i=this.geometry.attributes.color.array;return o.set(e),o.toArray(i,0),o.toArray(i,3),o.set(t),o.toArray(i,6),o.toArray(i,9),o.set(r),o.toArray(i,12),o.toArray(i,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class bD{constructor(){this.type="ShapePath",this.color=new Ge,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new I0,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){return this.currentPath.lineTo(e,t),this}quadraticCurveTo(e,t,r,o){return this.currentPath.quadraticCurveTo(e,t,r,o),this}bezierCurveTo(e,t,r,o,i,a){return this.currentPath.bezierCurveTo(e,t,r,o,i,a),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(e){function t(g,_){const A=_.length;let y=!1;for(let b=A-1,E=0;E<A;b=E++){let x=_[b],w=_[E],L=w.x-x.x,C=w.y-x.y;if(Math.abs(C)>Number.EPSILON){if(C<0&&(x=_[E],L=-L,w=_[b],C=-C),g.y<x.y||g.y>w.y)continue;if(g.y===x.y){if(g.x===x.x)return!0}else{const P=C*(g.x-x.x)-L*(g.y-x.y);if(P===0)return!0;if(P<0)continue;y=!y}}else{if(g.y!==x.y)continue;if(w.x<=g.x&&g.x<=x.x||x.x<=g.x&&g.x<=w.x)return!0}}return y}const r=ba.isClockWise,o=this.subPaths;if(o.length===0)return[];let i,a,s;const l=[];if(o.length===1)return a=o[0],s=new $u,s.curves=a.curves,l.push(s),l;let c=!r(o[0].getPoints());c=e?!c:c;const u=[],d=[];let f,h,p=[],m=0;d[m]=void 0,p[m]=[];for(let g=0,_=o.length;g<_;g++)a=o[g],f=a.getPoints(),i=r(f),i=e?!i:i,i?(!c&&d[m]&&m++,d[m]={s:new $u,p:f},d[m].s.curves=a.curves,c&&m++,p[m]=[]):p[m].push({h:a,p:f[0]});if(!d[0])return(function(g){const _=[];for(let A=0,y=g.length;A<y;A++){const b=g[A],E=new $u;E.curves=b.curves,_.push(E)}return _})(o);if(d.length>1){let g=!1,_=0;for(let A=0,y=d.length;A<y;A++)u[A]=[];for(let A=0,y=d.length;A<y;A++){const b=p[A];for(let E=0;E<b.length;E++){const x=b[E];let w=!0;for(let L=0;L<d.length;L++)t(x.p,d[L].p)&&(A!==L&&_++,w?(w=!1,u[L].push(x)):g=!0);w&&u[A].push(x)}}_>0&&g===!1&&(p=u)}for(let g=0,_=d.length;g<_;g++){s=d[g].s,l.push(s),h=p[g];for(let A=0,y=h.length;A<y;A++)s.holes.push(h[A].h)}return l}}const ys=Dve();function Dve(){const n=new ArrayBuffer(4),e=new Float32Array(n),t=new Uint32Array(n),r=new Uint32Array(512),o=new Uint32Array(512);for(let l=0;l<256;++l){const c=l-127;c<-27?(r[l]=0,r[256|l]=32768,o[l]=24,o[256|l]=24):c<-14?(r[l]=1024>>-c-14,r[256|l]=1024>>-c-14|32768,o[l]=-c-1,o[256|l]=-c-1):c<=15?(r[l]=c+15<<10,r[256|l]=c+15<<10|32768,o[l]=13,o[256|l]=13):c<128?(r[l]=31744,r[256|l]=64512,o[l]=24,o[256|l]=24):(r[l]=31744,r[256|l]=64512,o[l]=13,o[256|l]=13)}const i=new Uint32Array(2048),a=new Uint32Array(64),s=new Uint32Array(64);for(let l=1;l<1024;++l){let c=l<<13,u=0;for(;!(8388608&c);)c<<=1,u-=8388608;c&=-8388609,u+=947912704,i[l]=c|u}for(let l=1024;l<2048;++l)i[l]=939524096+(l-1024<<13);for(let l=1;l<31;++l)a[l]=l<<23;a[31]=1199570944,a[32]=2147483648;for(let l=33;l<63;++l)a[l]=2147483648+(l-32<<23);a[63]=3347054592;for(let l=1;l<64;++l)l!==32&&(s[l]=1024);return{floatView:e,uint32View:t,baseTable:r,shiftTable:o,mantissaTable:i,exponentTable:a,offsetTable:s}}function mc(n){Math.abs(n)>65504&&console.warn("v3d.DataUtils.toHalfFloat(): Value out of range."),n=Ht(n,-65504,65504),ys.floatView[0]=n;const e=ys.uint32View[0],t=e>>23&511;return ys.baseTable[t]+((8388607&e)>>ys.shiftTable[t])}function J0(n){const e=n>>10;return ys.uint32View[0]=ys.mantissaTable[ys.offsetTable[e]+(1023&n)]+ys.exponentTable[e],ys.floatView[0]}var Bve=Object.freeze({__proto__:null,fromHalfFloat:J0,toHalfFloat:mc});class xD extends xi{constructor(e,t,r){super(),this.damp=t,this.shader=Tt.afterimage,this.uniforms=_o.clone(this.shader.uniforms),this.uniforms.damp.value=this.damp,this.textureComp=new nn(e.x,e.y,r),this.textureComp.texture.name="AfterImage.comp",this.textureOld=new nn(e.x,e.y,r),this.textureOld.texture.name="AfterImage.old",this.shaderMaterial=new Dn({uniforms:this.uniforms,vertexShader:this.shader.vertexShader,fragmentShader:this.shader.fragmentShader}),this.compFsQuad=new Xi(this.shaderMaterial);const o=new pr;this.copyFsQuad=new Xi(o)}dispose(){this.textureComp.dispose(),this.textureOld.dispose()}render(e,t,r){this.uniforms.tOld.value=this.textureOld.texture,this.uniforms.tNew.value=r.texture,this.uniforms.damp.value=this.damp,e.setRenderTarget(this.textureComp),this.compFsQuad.render(e),this.copyFsQuad.material.map=this.textureComp.texture,this.renderToScreen?(e.setRenderTarget(null),this.copyFsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(),this.copyFsQuad.render(e));const o=this.textureOld;this.textureOld=this.textureComp,this.textureComp=o}setSize(e,t){this.textureComp.setSize(e,t),this.textureOld.setSize(e,t)}}class pl extends xi{constructor(e,t,r,o,i){super(),this.strength=t!==void 0?t:1,this.radius=Ht(r),this.threshold=o,this.resolution=e!==void 0?new be(e.x,e.y):new be(256,256),i=i||{minFilter:1006,magFilter:1006,format:1023},this.clearColor=new Ge(0,0,0),this.renderTargetsHorizontal=[],this.renderTargetsVertical=[],this.nMips=5;let a=Math.round(this.resolution.x/2),s=Math.round(this.resolution.y/2);this.renderTargetBright=new nn(a,s,i),this.renderTargetBright.texture.name="BloomPass.bright",this.renderTargetBright.texture.generateMipmaps=!1;for(let d=0;d<this.nMips;d++){const f=new nn(a,s,i);f.texture.name="BloomPass.h"+d,f.texture.generateMipmaps=!1,this.renderTargetsHorizontal.push(f);const h=new nn(a,s,i);h.texture.name="BloomPass.v"+d,h.texture.generateMipmaps=!1,this.renderTargetsVertical.push(h),a=Math.round(a/2),s=Math.round(s/2)}const l=Tt.bloomLumHighPass;this.highPassUniforms=_o.clone(l.uniforms),this.highPassUniforms.luminosityThreshold.value=o,this.highPassUniforms.smoothWidth.value=.01,this.materialHighPassFilter=new Dn({type:"BloomHighPass",uniforms:this.highPassUniforms,vertexShader:l.vertexShader,fragmentShader:l.fragmentShader,defines:{}}),this.separableBlurMaterials=[];const c=[3,5,7,9,11];a=Math.round(this.resolution.x/2),s=Math.round(this.resolution.y/2);for(let d=0;d<this.nMips;d++)this.separableBlurMaterials.push(this.getSeparableBlurMaterial(c[d],c[d]/3)),this.separableBlurMaterials[d].uniforms.texSize.value=new be(a,s),a=Math.round(a/2),s=Math.round(s/2);this.compositeMaterial=this.getCompositeMaterial(this.nMips),this.compositeMaterial.uniforms.blurTexture1.value=this.renderTargetsVertical[0].texture,this.compositeMaterial.uniforms.blurTexture2.value=this.renderTargetsVertical[1].texture,this.compositeMaterial.uniforms.blurTexture3.value=this.renderTargetsVertical[2].texture,this.compositeMaterial.uniforms.blurTexture4.value=this.renderTargetsVertical[3].texture,this.compositeMaterial.uniforms.blurTexture5.value=this.renderTargetsVertical[4].texture,this.compositeMaterial.uniforms.bloomStrength.value=t,this.compositeMaterial.uniforms.bloomRadius.value=.1,this.compositeMaterial.needsUpdate=!0,this.compositeMaterial.uniforms.bloomFactors.value=[1,.8,.6,.4,.2],this.bloomTintColors=[new N(1,1,1),new N(1,1,1),new N(1,1,1),new N(1,1,1),new N(1,1,1)],this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors;const u=Tt.copy;this.copyUniforms=_o.clone(u.uniforms),this.copyUniforms.opacity.value=1,this.materialCopy=new Dn({type:"BloomCopy",defines:Object.assign({},u.defines),uniforms:this.copyUniforms,vertexShader:u.vertexShader,fragmentShader:u.fragmentShader,blending:5,blendEquation:100,blendEquationAlpha:100,blendSrc:204,blendDst:201,blendSrcAlpha:200,blendDstAlpha:201,depthTest:!1,depthWrite:!1,transparent:!0}),this.enabled=!0,this.needsSwap=!1,this._oldClearColor=new Ge,this.oldClearAlpha=1,this.basic=new pr,this.fsQuad=new Xi(null)}dispose(){for(let e=0;e<this.renderTargetsHorizontal.length;e++)this.renderTargetsHorizontal[e].dispose();for(let e=0;e<this.renderTargetsVertical.length;e++)this.renderTargetsVertical[e].dispose();this.renderTargetBright.dispose()}setSize(e,t){let r=Math.round(e/2),o=Math.round(t/2);this.renderTargetBright.setSize(r,o);for(let i=0;i<this.nMips;i++)this.renderTargetsHorizontal[i].setSize(r,o),this.renderTargetsVertical[i].setSize(r,o),this.separableBlurMaterials[i].uniforms.texSize.value=new be(r,o),r=Math.round(r/2),o=Math.round(o/2)}render(e,t,r,o,i){e.getClearColor(this._oldClearColor),this.oldClearAlpha=e.getClearAlpha();const a=e.autoClear;e.autoClear=!1,e.setClearColor(this.clearColor,0),i&&e.state.buffers.stencil.setTest(!1),this.renderToScreen&&(this.fsQuad.material=this.basic,this.basic.map=r.texture,e.setRenderTarget(null),e.clear(),this.fsQuad.render(e)),this.highPassUniforms.tDiffuse.value=r.texture,this.highPassUniforms.luminosityThreshold.value=this.threshold,this.fsQuad.material=this.materialHighPassFilter,e.setRenderTarget(this.renderTargetBright),e.clear(),this.fsQuad.render(e);let s=this.renderTargetBright;for(let l=0;l<this.nMips;l++)this.fsQuad.material=this.separableBlurMaterials[l],this.separableBlurMaterials[l].uniforms.colorTexture.value=s.texture,this.separableBlurMaterials[l].uniforms.direction.value=pl.BlurDirectionX,e.setRenderTarget(this.renderTargetsHorizontal[l]),e.clear(),this.fsQuad.render(e),this.separableBlurMaterials[l].uniforms.colorTexture.value=this.renderTargetsHorizontal[l].texture,this.separableBlurMaterials[l].uniforms.direction.value=pl.BlurDirectionY,e.setRenderTarget(this.renderTargetsVertical[l]),e.clear(),this.fsQuad.render(e),s=this.renderTargetsVertical[l];this.fsQuad.material=this.compositeMaterial,this.compositeMaterial.uniforms.bloomStrength.value=this.strength,this.compositeMaterial.uniforms.bloomRadius.value=Ht(this.radius),this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,e.setRenderTarget(this.renderTargetsHorizontal[0]),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.renderTargetsHorizontal[0].texture,i&&e.state.buffers.stencil.setTest(!0),this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(r),this.fsQuad.render(e)),e.setClearColor(this._oldClearColor,this.oldClearAlpha),e.autoClear=a}getSeparableBlurMaterial(e,t){return new Dn({type:"BloomSeparableBlur",defines:{KERNEL_RADIUS:e,SIGMA:t},uniforms:{colorTexture:{value:null},texSize:{value:new be(.5,.5)},direction:{value:new be(.5,.5)}},vertexShader:Qe.pp_plane_vert,fragmentShader:Qe.pp_bloom_separable_blur_frag})}getCompositeMaterial(e){return new Dn({type:"BloomComposite",defines:{NUM_MIPS:e},uniforms:{blurTexture1:{value:null},blurTexture2:{value:null},blurTexture3:{value:null},blurTexture4:{value:null},blurTexture5:{value:null},dirtTexture:{value:null},bloomStrength:{value:1},bloomFactors:{value:null},bloomTintColors:{value:null},bloomRadius:{value:0}},vertexShader:Qe.pp_plane_vert,fragmentShader:Qe.pp_bloom_composite_frag})}}pl.BlurDirectionX=new be(1,0),pl.BlurDirectionY=new be(0,1);class Rb extends xi{constructor(e,t,r){super(),this.scene=e,this.camera=t;const o=r.width||window.innerWidth||1,i=r.height||window.innerHeight||1,a=new nn(o,i,{minFilter:1006,magFilter:1006,format:1023});this.renderTargetDepth=a.clone(),this.renderTargetDepth.texture.name="BokehPass.depth",this.materialDepth=new Gu,this.materialDepth.depthPacking=3201,this.materialDepth.blending=0;const s=Tt.bokeh,l=_o.clone(s.uniforms);l.tDepth.value=this.renderTargetDepth.texture,l.focus.value=_e(r.focus)?r.focus:1,l.aperture.value=_e(r.aperture)?r.aperture:1,l.maxblur.value=_e(r.maxblur)?r.maxblur:1,l.depthLeakThreshold.value=_e(r.depthLeakThreshold)?r.depthLeakThreshold:.2,l.nearClip.value=t.near,l.farClip.value=t.far,l.aspect.value=t.aspect,Object.defineProperties(this,{focus:{get:function(){return this.uniforms.focus.value},set:function(c){this.uniforms.focus.value=c}},aperture:{get:function(){return this.uniforms.aperture.value},set:function(c){this.uniforms.aperture.value=c}},maxblur:{get:function(){return this.uniforms.maxblur.value},set:function(c){this.uniforms.maxblur.value=c}},depthLeakThreshold:{get:function(){return this.uniforms.depthLeakThreshold.value},set:function(c){this.uniforms.depthLeakThreshold.value=c}}}),this.materialBokeh=new Dn({type:"Bokeh",defines:Object.assign({},s.defines),uniforms:l,vertexShader:s.vertexShader,fragmentShader:s.fragmentShader}),this.uniforms=l,this.camera2=new ya(-1,1,1,-1,0,1),this.scene2=new jr,this.quad2=new Mt(new ms(2,2),null),this.quad2.frustumCulled=!1,this.scene2.add(this.quad2),this.oldClearColor=new Ge,this.oldClearAlpha=1}render(e,t,r,o,i){this.quad2.material=this.materialBokeh,this.scene.overrideMaterial=this.materialDepth,e.getClearColor(this.oldClearColor),this.oldClearAlpha=e.getClearAlpha(),e.autoClear,e.autoClear=!1,e.setClearColor(16777215),e.setClearAlpha(1),e.setRenderTarget(this.renderTargetDepth),e.clear(),e.render(this.scene,this.camera),this.uniforms.tColor.value=r.texture,this.uniforms.nearClip.value=this.camera.near,this.uniforms.farClip.value=this.camera.far,this.uniforms.aspect.value=this.camera.aspect,this.renderToScreen?(e.setRenderTarget(null),e.render(this.scene2,this.camera2)):(e.setRenderTarget(t),e.clear(),e.render(this.scene2,this.camera2)),this.scene.overrideMaterial=null,e.setClearColor(this.oldClearColor),e.setClearAlpha(this.oldClearAlpha),e.autoClear=this.oldAutoClear}setCamera(e){this.camera=e}setSize(e,t){this.renderTargetDepth.setSize(e,t)}dispose(){this.renderTargetDepth.dispose()}}class bs extends xi{constructor(e,t){super(),this.textureID=t!==void 0?t:"tDiffuse",e instanceof Dn?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=_o.clone(e.uniforms),this.material=new Dn({type:"ShaderPass",defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new Xi(this.material)}render(e,t,r){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=r.texture),this.fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))}dispose(){this.material.dispose()}}class Lb extends bs{constructor(){super(Tt.brightness_contrast),this.material.type="Grayscale"}get brightness(){return this.uniforms.brightness.value}set brightness(e){this.uniforms.brightness.value=e}get contrast(){return this.uniforms.contrast.value}set contrast(e){this.uniforms.contrast.value=e}}class e1 extends bs{constructor(e,t,r,o){super(Tt.fxaa),this.material.type="FXAA",this.width=r!==void 0?r:512,this.height=o!==void 0?o:256,this.needsSwap=!1}setSize(e,t){this.width=e,this.height=t,this.uniforms.resolution.value.set(1/e,1/t)}}class Pb extends bs{constructor(){super(Tt.grayscale),this.material.type="Grayscale"}}let Oh,Db,nd,t1;function n1(n,e=1/0,t=null){Db||(Db=new ms(2,2,1,1)),nd||(nd=new Dn({uniforms:{blitTexture:new Q0(n)},vertexShader:`
            varying vec2 vUv;
            void main(){
                vUv = uv;
                gl_Position = vec4(position.xy * 1.0,0.,.999999);
            }`,fragmentShader:`
            uniform sampler2D blitTexture;
            varying vec2 vUv;

            void main(){
                gl_FragColor = vec4(vUv.xy, 0, 1);

                #ifdef IS_SRGB
                gl_FragColor = LinearTosRGB(texture2D(blitTexture, vUv));
                #else
                gl_FragColor = texture2D(blitTexture, vUv);
                #endif
            }`})),nd.uniforms.blitTexture.value=n,nd.defines.IS_SRGB=n.encoding==3001,nd.needsUpdate=!0,t1||(t1=new Mt(Db,nd),t1.frustumCulled=!1);const r=new gr,o=new jr;o.add(t1),t===null&&(t=Oh=new U2({antialias:!1}));const i=Math.min(n.image.width,e),a=Math.min(n.image.height,e);t.setSize(i,a),t.clear(),t.render(o,r);const s=document.createElement("canvas"),l=s.getContext("2d");s.width=i,s.height=a,l.drawImage(t.domElement,0,0,i,a);const c=new oP(s);return c.minFilter=n.minFilter,c.magFilter=n.magFilter,c.wrapS=n.wrapS,c.wrapT=n.wrapT,c.name=n.name,Oh&&(Oh.forceContextLoss(),Oh.dispose(),Oh=null),c}class r1{constructor(){this.pluginCallbacks=[],this.register((function(e){return new Vve(e)}))}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,r,o){const i=new Fve,a=[];for(let s=0,l=this.pluginCallbacks.length;s<l;s++)a.push(this.pluginCallbacks[s](i));i.setPlugins(a),i.write(e,t,o).catch(r)}parseAsync(e,t){const r=this;return new Promise((function(o,i){r.parse(e,o,i,t)}))}}const In={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123,FLOAT:5126,UNSIGNED_INT:5125,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,REPEAT:10497},ci={};ci[1003]=In.NEAREST,ci[1004]=In.NEAREST_MIPMAP_NEAREST,ci[1005]=In.NEAREST_MIPMAP_LINEAR,ci[1006]=In.LINEAR,ci[1007]=In.LINEAR_MIPMAP_NEAREST,ci[1008]=In.LINEAR_MIPMAP_LINEAR,ci[1001]=In.CLAMP_TO_EDGE,ci[1e3]=In.REPEAT,ci[1002]=In.MIRRORED_REPEAT;const ED={scale:"scale",position:"translation",quaternion:"rotation",morphTargetInfluences:"weights"};function kh(n,e){return n.length===e.length&&n.every((function(t,r){return t===e[r]}))}function Nve(n){return new TextEncoder().encode(n).buffer}function Ove(n){return kh(n.elements,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}function kve(n,e,t){const r={min:new Array(n.itemSize).fill(Number.POSITIVE_INFINITY),max:new Array(n.itemSize).fill(Number.NEGATIVE_INFINITY)};for(let o=e;o<e+t;o++)for(let i=0;i<n.itemSize;i++){let a;n.itemSize>4?a=n.array[o*n.itemSize+i]:(i===0?a=n.getX(o):i===1?a=n.getY(o):i===2?a=n.getZ(o):i===3&&(a=n.getW(o)),n.normalized===!0&&(a=io(a,n.array))),r.min[i]=Math.min(r.min[i],a),r.max[i]=Math.max(r.max[i],a)}return r}function CD(n){return 4*Math.ceil(n/4)}function Bb(n,e=0){const t=CD(n.byteLength);if(t!==n.byteLength){const r=new Uint8Array(t);if(r.set(new Uint8Array(n)),e!==0)for(let o=n.byteLength;o<t;o++)r[o]=e;return r.buffer}return n}function SD(){return typeof document>"u"&&typeof OffscreenCanvas<"u"?new OffscreenCanvas(1,1):document.createElement("canvas")}function wD(n,e){if(n.toBlob!==void 0)return new Promise((r=>n.toBlob(r,e)));let t;return e==="image/jpeg"?t=.92:e==="image/webp"&&(t=.8),n.convertToBlob({type:e,quality:t})}class Fve{constructor(){this.plugins=[],this.options={},this.pending=[],this.buffers=[],this.byteOffset=0,this.buffers=[],this.nodeMap=new Map,this.skins=[],this.extensionsUsed={},this.uids=new Map,this.uid=0,this.json={asset:{version:"2.0",generator:"Verge3D"}},this.cache={meshes:new Map,attributes:new Map,attributesNormalized:new Map,materials:new Map,textures:new Map,images:new Map}}setPlugins(e){this.plugins=e}async write(e,t,r={}){this.options=Object.assign({binary:!1,trs:!1,onlyVisible:!0,maxTextureSize:1/0,animations:[],includeCustomExtensions:!1},r),this.options.animations.length>0&&(this.options.trs=!0),this.processInput(e),await Promise.all(this.pending);const o=this,i=o.buffers,a=o.json;r=o.options;const s=o.extensionsUsed,l=new Blob(i,{type:"application/octet-stream"}),c=Object.keys(s);if(c.length>0&&(a.extensionsUsed=c),a.buffers&&a.buffers.length>0&&(a.buffers[0].byteLength=l.size),r.binary===!0){const u=new FileReader;u.readAsArrayBuffer(l),u.onloadend=function(){const d=Bb(u.result),f=new DataView(new ArrayBuffer(8));f.setUint32(0,d.byteLength,!0),f.setUint32(4,5130562,!0);const h=Bb(Nve(JSON.stringify(a)),32),p=new DataView(new ArrayBuffer(8));p.setUint32(0,h.byteLength,!0),p.setUint32(4,1313821514,!0);const m=new ArrayBuffer(12),g=new DataView(m);g.setUint32(0,1179937895,!0),g.setUint32(4,2,!0);const _=12+p.byteLength+h.byteLength+f.byteLength+d.byteLength;g.setUint32(8,_,!0);const A=new Blob([m,p,h,f,d],{type:"application/octet-stream"}),y=new FileReader;y.readAsArrayBuffer(A),y.onloadend=function(){t(y.result)}}}else if(a.buffers&&a.buffers.length>0){const u=new FileReader;u.readAsDataURL(l),u.onloadend=function(){const d=u.result;a.buffers[0].uri=d,t(a)}}else t(a)}serializeUserData(e,t){if(Object.keys(e.userData).length===0)return;const r=this.options,o=this.extensionsUsed;try{const i=JSON.parse(JSON.stringify(e.userData));if(r.includeCustomExtensions&&i.gltfExtensions){t.extensions===void 0&&(t.extensions={});for(const a in i.gltfExtensions)t.extensions[a]=i.gltfExtensions[a],o[a]=!0;delete i.gltfExtensions}Object.keys(i).length>0&&(t.extras=i)}catch(i){console.warn("v3d.GLTFExporter: userData of '"+e.name+"' won't be serialized because of JSON.stringify error - "+i.message)}}getUID(e,t=!1){if(this.uids.has(e)===!1){const r=new Map;r.set(!0,this.uid++),r.set(!1,this.uid++),this.uids.set(e,r)}return this.uids.get(e).get(t)}isNormalizedNormalAttribute(e){if(this.cache.attributesNormalized.has(e))return!1;const t=new N;for(let r=0,o=e.count;r<o;r++)if(Math.abs(t.fromBufferAttribute(e,r).length()-1)>5e-4)return!1;return!0}createNormalizedNormalAttribute(e){const t=this.cache;if(t.attributesNormalized.has(e))return t.attributesNormalized.get(e);const r=e.clone(),o=new N;for(let i=0,a=r.count;i<a;i++)o.fromBufferAttribute(r,i),o.x===0&&o.y===0&&o.z===0?o.setX(1):o.normalize(),r.setXYZ(i,o.x,o.y,o.z);return t.attributesNormalized.set(e,r),r}buildMetalRoughTexture(e,t){if(e===t)return e;function r(f){return f.encoding===3001?function(h){return h<.04045?.0773993808*h:Math.pow(.9478672986*h+.0521327014,2.4)}:function(h){return h}}console.warn("v3d.GLTFExporter: Merged metalnessMap and roughnessMap textures."),e instanceof dl&&(e=n1(e)),t instanceof dl&&(t=n1(t));const o=e==null?void 0:e.image,i=t==null?void 0:t.image,a=Math.max((o==null?void 0:o.width)||0,(i==null?void 0:i.width)||0),s=Math.max((o==null?void 0:o.height)||0,(i==null?void 0:i.height)||0),l=SD();l.width=a,l.height=s;const c=l.getContext("2d");c.fillStyle="#00ffff",c.fillRect(0,0,a,s);const u=c.getImageData(0,0,a,s);if(o){c.drawImage(o,0,0,a,s);const f=r(e),h=c.getImageData(0,0,a,s).data;for(let p=2;p<h.length;p+=4)u.data[p]=256*f(h[p]/256)}if(i){c.drawImage(i,0,0,a,s);const f=r(t),h=c.getImageData(0,0,a,s).data;for(let p=1;p<h.length;p+=4)u.data[p]=256*f(h[p]/256)}c.putImageData(u,0,0);const d=(e||t).clone();return d.source=new Qg(l),d.encoding=3e3,d}processBuffer(e){const t=this.json,r=this.buffers;return t.buffers||(t.buffers=[{byteLength:0}]),r.push(e),0}processBufferView(e,t,r,o,i){const a=this.json;let s;a.bufferViews||(a.bufferViews=[]),s=t===In.UNSIGNED_BYTE?1:t===In.UNSIGNED_SHORT?2:4;const l=CD(o*e.itemSize*s),c=new DataView(new ArrayBuffer(l));let u=0;for(let f=r;f<r+o;f++)for(let h=0;h<e.itemSize;h++){let p;e.itemSize>4?p=e.array[f*e.itemSize+h]:(h===0?p=e.getX(f):h===1?p=e.getY(f):h===2?p=e.getZ(f):h===3&&(p=e.getW(f)),e.normalized===!0&&(p=io(p,e.array))),t===In.FLOAT?c.setFloat32(u,p,!0):t===In.UNSIGNED_INT?c.setUint32(u,p,!0):t===In.UNSIGNED_SHORT?c.setUint16(u,p,!0):t===In.UNSIGNED_BYTE&&c.setUint8(u,p),u+=s}const d={buffer:this.processBuffer(c.buffer),byteOffset:this.byteOffset,byteLength:l};return i!==void 0&&(d.target=i),i===In.ARRAY_BUFFER&&(d.byteStride=e.itemSize*s),this.byteOffset+=l,a.bufferViews.push(d),{id:a.bufferViews.length-1,byteLength:0}}processBufferViewImage(e){const t=this,r=t.json;return r.bufferViews||(r.bufferViews=[]),new Promise((function(o){const i=new FileReader;i.readAsArrayBuffer(e),i.onloadend=function(){const a=Bb(i.result),s={buffer:t.processBuffer(a),byteOffset:t.byteOffset,byteLength:a.byteLength};t.byteOffset+=a.byteLength,o(r.bufferViews.push(s)-1)}}))}processAccessor(e,t,r,o){const i=this.json;let a;if(e.array.constructor===Float32Array)a=In.FLOAT;else if(e.array.constructor===Uint32Array)a=In.UNSIGNED_INT;else if(e.array.constructor===Uint16Array)a=In.UNSIGNED_SHORT;else{if(e.array.constructor!==Uint8Array)throw new Error("v3d.GLTFExporter: Unsupported bufferAttribute component type.");a=In.UNSIGNED_BYTE}if(r===void 0&&(r=0),o===void 0&&(o=e.count),o===0)return null;const s=kve(e,r,o);let l;t!==void 0&&(l=e===t.index?In.ELEMENT_ARRAY_BUFFER:In.ARRAY_BUFFER);const c=this.processBufferView(e,a,r,o,l),u={bufferView:c.id,byteOffset:c.byteOffset,componentType:a,count:o,max:s.max,min:s.min,type:{1:"SCALAR",2:"VEC2",3:"VEC3",4:"VEC4",16:"MAT4"}[e.itemSize]};return e.normalized===!0&&(u.normalized=!0),i.accessors||(i.accessors=[]),i.accessors.push(u)-1}processImage(e,t,r,o="image/png"){if(e!==null){const i=this,a=i.cache,s=i.json,l=i.options,c=i.pending;a.images.has(e)||a.images.set(e,{});const u=a.images.get(e),d=o+":flipY/"+r.toString();if(u[d]!==void 0)return u[d];s.images||(s.images=[]);const f={mimeType:o},h=SD();h.width=Math.min(e.width,l.maxTextureSize),h.height=Math.min(e.height,l.maxTextureSize);const p=h.getContext("2d");if(r===!0&&(p.translate(0,h.height),p.scale(1,-1)),e.data!==void 0){t!==1023&&console.error("GLTFExporter: Only RGBAFormat is supported."),(e.width>l.maxTextureSize||e.height>l.maxTextureSize)&&console.warn("GLTFExporter: Image size is bigger than maxTextureSize",e);const g=new Uint8ClampedArray(e.height*e.width*4);for(let _=0;_<g.length;_+=4)g[_+0]=e.data[_+0],g[_+1]=e.data[_+1],g[_+2]=e.data[_+2],g[_+3]=e.data[_+3];p.putImageData(new ImageData(g,e.width,e.height),0,0)}else p.drawImage(e,0,0,h.width,h.height);l.binary===!0?c.push(wD(h,o).then((g=>i.processBufferViewImage(g))).then((g=>{f.bufferView=g}))):h.toDataURL!==void 0?f.uri=h.toDataURL(o):c.push(wD(h,o).then((g=>new FileReader().readAsDataURL(g))).then((g=>{f.uri=g})));const m=s.images.push(f)-1;return u[d]=m,m}throw new Error("v3d.GLTFExporter: No valid image data found. Unable to process texture.")}processSampler(e){const t=this.json;t.samplers||(t.samplers=[]);const r={magFilter:ci[e.magFilter],minFilter:ci[e.minFilter],wrapS:ci[e.wrapS],wrapT:ci[e.wrapT]};return t.samplers.push(r)-1}processTexture(e){const t=this.options,r=this.cache,o=this.json;if(r.textures.has(e))return r.textures.get(e);o.textures||(o.textures=[]),e instanceof dl&&(e=n1(e,t.maxTextureSize));let i=e.userData.mimeType;i==="image/webp"&&(i="image/png");const a={sampler:this.processSampler(e),source:this.processImage(e.image,e.format,e.flipY,i)};e.name&&(a.name=e.name),this._invokeAll((function(l){l.writeTexture&&l.writeTexture(e,a)}));const s=o.textures.push(a)-1;return r.textures.set(e,s),s}processMaterial(e){const t=this.cache,r=this.json;if(t.materials.has(e))return t.materials.get(e);if(e.isShaderMaterial)return console.warn("GLTFExporter: v3d.ShaderMaterial not supported."),null;r.materials||(r.materials=[]);const o={pbrMetallicRoughness:{}};e.isMeshNodeMaterial!==!0&&e.isMeshStandardMaterial!==!0&&e.isMeshBasicMaterial!==!0&&console.warn("GLTFExporter: Use MeshNodeMaterial, MeshStandardMaterial, or MeshBasicMaterial for best results.");const i=e.color.toArray().concat([e.opacity]);kh(i,[1,1,1,1])||(o.pbrMetallicRoughness.baseColorFactor=i),e.isMeshNodeMaterial?(o.pbrMetallicRoughness.metallicFactor=e.getStandardProp("metalness"),o.pbrMetallicRoughness.roughnessFactor=e.getStandardProp("roughness")):e.isMeshStandardMaterial?(o.pbrMetallicRoughness.metallicFactor=e.metalness,o.pbrMetallicRoughness.roughnessFactor=e.roughness):(o.pbrMetallicRoughness.metallicFactor=.5,o.pbrMetallicRoughness.roughnessFactor=.5);const a=e.isMeshNodeMaterial?e.getStandardProp("metalnessMap"):e.metalnessMap,s=e.isMeshNodeMaterial?e.getStandardProp("roughnessMap"):e.roughnessMap;if(a||s){const h=this.buildMetalRoughTexture(a,s),p={index:this.processTexture(h)};o.pbrMetallicRoughness.metallicRoughnessTexture=p}const l=e.isMeshNodeMaterial?e.getStandardProp("map"):e.map;if(l){const h={index:this.processTexture(l)};o.pbrMetallicRoughness.baseColorTexture=h}let c=e.isMeshNodeMaterial?e.getStandardProp("emissive"):e.emissive;if(c){const h=e.isMeshNodeMaterial?e.getStandardProp("emissiveIntensity"):e.emissiveIntensity;c=c.clone().multiplyScalar(h);const p=Math.max(c.r,c.g,c.b);p>1&&(c.multiplyScalar(1/p),console.warn("v3d.GLTFExporter: Some emissive components exceed 1; emissive has been limited")),p>0&&(o.emissiveFactor=c.toArray());const m=e.isMeshNodeMaterial?e.getStandardProp("emissiveMap"):e.emissiveMap;if(m){const g={index:this.processTexture(m)};o.emissiveTexture=g}}const u=e.isMeshNodeMaterial?e.getStandardProp("normalMap"):e.normalMap;if(u){const h={index:this.processTexture(u)},p=e.isMeshNodeMaterial?e.getStandardProp("normalScale"):e.normalScale;p&&p.x!==1&&(h.scale=p.x),o.normalTexture=h}const d=e.isMeshNodeMaterial?e.getStandardProp("aoMap"):e.aoMap;if(d){const h={index:this.processTexture(d),texCoord:1},p=e.isMeshNodeMaterial?e.getStandardProp("aoMapIntensity"):e.aoMapIntensity;p!==1&&(h.strength=p),o.occlusionTexture=h}e.transparent?o.alphaMode="BLEND":e.alphaTest>0&&(o.alphaMode="MASK",o.alphaCutoff=e.alphaTest),e.side===2&&(o.doubleSided=!0),e.name!==""&&(o.name=e.name),this.serializeUserData(e,o),this._invokeAll((function(h){h.writeMaterial&&h.writeMaterial(e,o)}));const f=r.materials.push(o)-1;return t.materials.set(e,f),f}processMesh(e){const t=this.cache,r=this.json,o=[e.geometry.uuid];if(Array.isArray(e.material))for(let y=0,b=e.material.length;y<b;y++)o.push(e.material[y].uuid);else o.push(e.material.uuid);const i=o.join(":");if(t.meshes.has(i))return t.meshes.get(i);const a=e.geometry;let s;s=e.isLineSegments?In.LINES:e.isLineLoop?In.LINE_LOOP:e.isLine?In.LINE_STRIP:e.isPoints?In.POINTS:e.material.wireframe?In.LINES:In.TRIANGLES;const l={},c={},u=[],d=[],f={uv:"TEXCOORD_0",uv2:"TEXCOORD_1",color:"COLOR_0",skinWeight:"WEIGHTS_0",skinIndex:"JOINTS_0"},h=a.getAttribute("normal");h===void 0||this.isNormalizedNormalAttribute(h)||(console.warn("v3d.GLTFExporter: Creating normalized normal attribute from the non-normalized one."),a.setAttribute("normal",this.createNormalizedNormalAttribute(h)));let p=null;for(let y in a.attributes){if(y.slice(0,5)==="morph")continue;const b=a.attributes[y];if(y=f[y]||y.toUpperCase(),/^(POSITION|NORMAL|TANGENT|TEXCOORD_\d+|COLOR_\d+|JOINTS_\d+|WEIGHTS_\d+)$/.test(y)||(y="_"+y),t.attributes.has(this.getUID(b))){c[y]=t.attributes.get(this.getUID(b));continue}p=null;const E=b.array;y!=="JOINTS_0"||E instanceof Uint16Array||E instanceof Uint8Array||(console.warn('GLTFExporter: Attribute "skinIndex" converted to type UNSIGNED_SHORT.'),p=new Xe(new Uint16Array(E),b.itemSize,b.normalized));const x=this.processAccessor(p||b,a);x!==null&&(c[y]=x,t.attributes.set(this.getUID(b),x))}if(h!==void 0&&a.setAttribute("normal",h),Object.keys(c).length===0)return null;if(e.morphTargetInfluences!==void 0&&e.morphTargetInfluences.length>0){const y=[],b=[],E={};if(e.morphTargetDictionary!==void 0)for(const x in e.morphTargetDictionary)E[e.morphTargetDictionary[x]]=x;for(let x=0;x<e.morphTargetInfluences.length;++x){const w={};let L=!1;for(const C in a.morphAttributes){if(C!=="position"&&C!=="normal"){L||(console.warn("GLTFExporter: Only POSITION and NORMAL morph are supported."),L=!0);continue}const P=a.morphAttributes[C][x],D=C.toUpperCase(),Q=a.attributes[C];if(t.attributes.has(this.getUID(P,!0))){w[D]=t.attributes.get(this.getUID(P,!0));continue}const re=P.clone();if(!a.morphTargetsRelative)for(let G=0,se=P.count;G<se;G++)for(let ee=0;ee<P.itemSize;ee++)ee===0&&re.setX(G,P.getX(G)-Q.getX(G)),ee===1&&re.setY(G,P.getY(G)-Q.getY(G)),ee===2&&re.setZ(G,P.getZ(G)-Q.getZ(G)),ee===3&&re.setW(G,P.getW(G)-Q.getW(G));w[D]=this.processAccessor(re,a),t.attributes.set(this.getUID(Q,!0),w[D])}d.push(w),y.push(e.morphTargetInfluences[x]),e.morphTargetDictionary!==void 0&&b.push(E[x])}l.weights=y,b.length>0&&(l.extras={},l.extras.targetNames=b)}const m=Array.isArray(e.material);if(m&&a.groups.length===0)return null;const g=m?e.material:[e.material],_=m?a.groups:[{materialIndex:0,start:void 0,count:void 0}];for(let y=0,b=_.length;y<b;y++){const E={mode:s,attributes:c};if(this.serializeUserData(a,E),d.length>0&&(E.targets=d),a.index!==null){let w=this.getUID(a.index);_[y].start===void 0&&_[y].count===void 0||(w+=":"+_[y].start+":"+_[y].count),t.attributes.has(w)?E.indices=t.attributes.get(w):(E.indices=this.processAccessor(a.index,a,_[y].start,_[y].count),t.attributes.set(w,E.indices)),E.indices===null&&delete E.indices}const x=this.processMaterial(g[_[y].materialIndex]);x!==null&&(E.material=x),u.push(E)}l.primitives=u,r.meshes||(r.meshes=[]),this._invokeAll((function(y){y.writeMesh&&y.writeMesh(e,l)}));const A=r.meshes.push(l)-1;return t.meshes.set(i,A),A}processCamera(e){const t=this.json;t.cameras||(t.cameras=[]);const r=e.isOrthographicCamera,o={type:r?"orthographic":"perspective"};return r?o.orthographic={xmag:2*e.right,ymag:2*e.top,zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near}:o.perspective={aspectRatio:e.aspect,yfov:ih(e.fov),zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near},e.name!==""&&(o.name=e.type),t.cameras.push(o)-1}processAnimation(e,t){const r=this.json,o=this.nodeMap;r.animations||(r.animations=[]);const i=(e=r1.Utils.mergeMorphTargetTracks(e.clone(),t)).tracks,a=[],s=[];for(let l=0;l<i.length;++l){const c=i[l],u=Kt.parseTrackName(c.name);let d=Kt.findNode(t,u.nodeName);const f=ED[u.propertyName];if(u.objectName==="bones"&&(d=d.isSkinnedMesh===!0?d.skeleton.getBoneByName(u.objectIndex):void 0),!d||!f)return console.warn('v3d.GLTFExporter: Could not export animation track "%s".',c.name),null;const h=1;let p,m=c.values.length/c.times.length;f===ED.morphTargetInfluences&&(m/=d.morphTargetInfluences.length),c.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline===!0?(p="CUBICSPLINE",m/=3):p=c.getInterpolation()===2300?"STEP":"LINEAR",s.push({input:this.processAccessor(new Xe(c.times,h)),output:this.processAccessor(new Xe(c.values,m)),interpolation:p}),a.push({sampler:s.length-1,target:{node:o.get(d),path:f}})}return r.animations.push({name:e.name||"clip_"+r.animations.length,samplers:s,channels:a}),r.animations.length-1}processSkin(e){const t=this.json,r=this.nodeMap,o=t.nodes[r.get(e)],i=e.skeleton;if(i===void 0)return null;const a=e.skeleton.bones[0];if(a===void 0)return null;const s=[],l=new Float32Array(16*i.bones.length),c=new Ue;for(let u=0;u<i.bones.length;++u)s.push(r.get(i.bones[u])),c.copy(i.boneInverses[u]),c.multiply(e.bindMatrix).toArray(l,16*u);return t.skins===void 0&&(t.skins=[]),t.skins.push({inverseBindMatrices:this.processAccessor(new Xe(l,16)),joints:s,skeleton:r.get(a)}),o.skin=t.skins.length-1}processNode(e){const t=this.json,r=this.options,o=this.nodeMap;if(e.isAuxClippingMesh)return null;let i=!1;if(r.onlyVisible&&!e.visible&&(e.traverse((function(l){l.visible&&(i=!0)})),!i))return null;t.nodes||(t.nodes=[]);const a={};if(r.trs){const l=e.quaternion.toArray(),c=e.position.toArray(),u=e.scale.toArray();kh(l,[0,0,0,1])||(a.rotation=l),kh(c,[0,0,0])||(a.translation=c),kh(u,[1,1,1])||(a.scale=u)}else e.matrixAutoUpdate&&e.updateMatrix(),Ove(e.matrix)===!1&&(a.matrix=e.matrix.elements);if(e.name!==""&&(a.name=String(e.name)),this.serializeUserData(e,a),(e.isMesh||e.isLine||e.isPoints)&&!i){const l=this.processMesh(e);l!==null&&(a.mesh=l)}else e.isCamera&&!i&&(a.camera=this.processCamera(e));if(e.isSkinnedMesh&&!i&&this.skins.push(e),e.children.length>0){const l=[];for(let c=0,u=e.children.length;c<u;c++){const d=e.children[c],f=this.processNode(d);f!==null&&l.push(f)}l.length>0&&(a.children=l)}this._invokeAll((function(l){l.writeNode&&l.writeNode(e,a)}));const s=t.nodes.push(a)-1;return o.set(e,s),s}processScene(e){const t=this.json,r=this.options;t.scenes||(t.scenes=[],t.scene=0);const o={};e.name!==""&&(o.name=e.name),t.scenes.push(o);const i=[];for(let a=0,s=e.children.length;a<s;a++){const l=e.children[a];if(l.visible||r.onlyVisible===!1){const c=this.processNode(l);c!==null&&i.push(c)}}i.length>0&&(o.nodes=i),this.serializeUserData(e,o)}processObjects(e){const t=new jr;t.name="AuxScene";for(let r=0;r<e.length;r++)t.children.push(e[r]);this.processScene(t)}processInput(e){const t=this.options;e=e instanceof Array?e:[e],this._invokeAll((function(o){o.beforeParse&&o.beforeParse(e)}));const r=[];for(let o=0;o<e.length;o++)e[o]instanceof jr?this.processScene(e[o]):r.push(e[o]);r.length>0&&this.processObjects(r);for(let o=0;o<this.skins.length;++o)this.processSkin(this.skins[o]);for(let o=0;o<t.animations.length;++o)this.processAnimation(t.animations[o],e[0]);this._invokeAll((function(o){o.afterParse&&o.afterParse(e)}))}_invokeAll(e){for(let t=0,r=this.plugins.length;t<r;t++)e(this.plugins[t])}}let Vve=class{constructor(n){this.writer=n,this.name="KHR_materials_unlit"}writeMaterial(n,e){if(!(n.isMeshBasicMaterial||n.isMeshNodeMaterial&&n.isUnlit()))return;const t=this.writer.extensionsUsed;e.extensions=e.extensions||{},e.extensions[this.name]={},t[this.name]=!0,e.pbrMetallicRoughness.metallicFactor=0,e.pbrMetallicRoughness.roughnessFactor=.9}};r1.Utils={insertKeyframe:function(n,e){const r=n.getValueSize(),o=new n.TimeBufferType(n.times.length+1),i=new n.ValueBufferType(n.values.length+r),a=n.createInterpolant(new n.ValueBufferType(r));let s;if(n.times.length===0){o[0]=e;for(let l=0;l<r;l++)i[l]=0;s=0}else if(e<n.times[0]){if(Math.abs(n.times[0]-e)<.001)return 0;o[0]=e,o.set(n.times,1),i.set(a.evaluate(e),0),i.set(n.values,r),s=0}else if(e>n.times[n.times.length-1]){if(Math.abs(n.times[n.times.length-1]-e)<.001)return n.times.length-1;o[o.length-1]=e,o.set(n.times,0),i.set(n.values,0),i.set(a.evaluate(e),n.values.length),s=o.length-1}else for(let l=0;l<n.times.length;l++){if(Math.abs(n.times[l]-e)<.001)return l;if(n.times[l]<e&&n.times[l+1]>e){o.set(n.times.slice(0,l+1),0),o[l+1]=e,o.set(n.times.slice(l+1),l+2),i.set(n.values.slice(0,(l+1)*r),0),i.set(a.evaluate(e),(l+1)*r),i.set(n.values.slice((l+1)*r),(l+2)*r),s=l+1;break}}return n.times=o,n.values=i,s},mergeMorphTargetTracks:function(n,e){const t=[],r={},o=n.tracks;for(let i=0;i<o.length;++i){let a=o[i];const s=Kt.parseTrackName(a.name),l=Kt.findNode(e,s.nodeName);if(s.propertyName!=="morphTargetInfluences"||s.propertyIndex===void 0){t.push(a);continue}if(a.createInterpolant!==a.InterpolantFactoryMethodDiscrete&&a.createInterpolant!==a.InterpolantFactoryMethodLinear){if(a.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline)throw new Error("v3d.GLTFExporter: Cannot merge tracks with glTF CUBICSPLINE interpolation.");console.warn("v3d.GLTFExporter: Morph target interpolation mode not yet supported. Using LINEAR instead."),a=a.clone(),a.setInterpolation(2301)}const c=l.morphTargetInfluences.length,u=l.morphTargetDictionary[s.propertyIndex];if(u===void 0)throw new Error("v3d.GLTFExporter: Morph target name not found: "+s.propertyIndex);let d;if(r[l.uuid]===void 0){d=a.clone();const h=new d.ValueBufferType(c*d.times.length);for(let p=0;p<d.times.length;p++)h[p*c+u]=d.values[p];d.name=(s.nodeName||"")+".morphTargetInfluences",d.values=h,r[l.uuid]=d,t.push(d);continue}const f=a.createInterpolant(new a.ValueBufferType(1));d=r[l.uuid];for(let h=0;h<d.times.length;h++)d.values[h*c+u]=f.evaluate(d.times[h]);for(let h=0;h<a.times.length;h++){const p=this.insertKeyframe(d,a.times[h]);d.values[p*c+u]=a.values[h]}}return n.tracks=t,n}};class Nb extends xi{constructor(e,t){super(),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(e,t,r){const o=e.getContext(),i=e.state;let a,s;i.buffers.color.setMask(!1),i.buffers.depth.setMask(!1),i.buffers.color.setLocked(!0),i.buffers.depth.setLocked(!0),this.inverse?(a=0,s=1):(a=1,s=0),i.buffers.stencil.setTest(!0),i.buffers.stencil.setOp(o.REPLACE,o.REPLACE,o.REPLACE),i.buffers.stencil.setFunc(o.ALWAYS,a,4294967295),i.buffers.stencil.setClear(s),i.buffers.stencil.setLocked(!0),e.setRenderTarget(r),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera),i.buffers.color.setLocked(!1),i.buffers.depth.setLocked(!1),i.buffers.stencil.setLocked(!1),i.buffers.stencil.setFunc(o.EQUAL,1,4294967295),i.buffers.stencil.setOp(o.KEEP,o.KEEP,o.KEEP),i.buffers.stencil.setLocked(!0)}setCamera(e){this.camera=e}}class MD extends xi{constructor(){super(),this.needsSwap=!1}render(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}}function Ob(n,e,t,r,o){if(n=n.subarray||n.slice?n:n.buffer,t=t.subarray||t.slice?t:t.buffer,n=e?n.subarray?n.subarray(e,o&&e+o):n.slice(e,o&&e+o):n,t.set)t.set(n,r);else for(let i=0;i<n.length;i++)t[i+r]=n[i];return t}class rd{constructor(){this.positions=[],this.previous=[],this.next=[],this.side=[],this.width=[],this.indices_array=[],this.uvs=[],this.counters=[],this.geometry=new At,this.widthCallback=null}setGeometry(e,t){if(this.widthCallback=t,this.positions=[],this.counters=[],e instanceof Float32Array||e instanceof Array)for(let r=0;r<e.length;r+=3){const o=r/e.length;this.positions.push(e[r],e[r+1],e[r+2]),this.positions.push(e[r],e[r+1],e[r+2]),this.counters.push(o),this.counters.push(o)}this.process()}compareV3(e,t){const r=6*e,o=6*t;return this.positions[r]===this.positions[o]&&this.positions[r+1]===this.positions[o+1]&&this.positions[r+2]===this.positions[o+2]}copyV3(e){const t=6*e;return[this.positions[t],this.positions[t+1],this.positions[t+2]]}process(){const e=this.positions.length/6;this.previous=[],this.next=[],this.side=[],this.width=[],this.indices_array=[],this.uvs=[];for(let o=0;o<e;o++)this.side.push(1),this.side.push(-1);let t,r;for(let o=0;o<e;o++)t=this.widthCallback?this.widthCallback(o/(e-1)):1,this.width.push(t),this.width.push(t);for(let o=0;o<e;o++)this.uvs.push(o/(e-1),0),this.uvs.push(o/(e-1),1);r=this.compareV3(0,e-1)?this.copyV3(e-2):this.copyV3(0),this.previous.push(r[0],r[1],r[2]),this.previous.push(r[0],r[1],r[2]);for(let o=0;o<e-1;o++)r=this.copyV3(o),this.previous.push(r[0],r[1],r[2]),this.previous.push(r[0],r[1],r[2]);for(let o=1;o<e;o++)r=this.copyV3(o),this.next.push(r[0],r[1],r[2]),this.next.push(r[0],r[1],r[2]);r=this.compareV3(e-1,0)?this.copyV3(1):this.copyV3(e-1),this.next.push(r[0],r[1],r[2]),this.next.push(r[0],r[1],r[2]);for(let o=0;o<e-1;o++){const i=2*o;this.indices_array.push(i,i+1,i+2),this.indices_array.push(i+2,i+1,i+3)}this.attributes?(this.attributes.position.copyArray(new Float32Array(this.positions)),this.attributes.position.needsUpdate=!0,this.attributes.previous.copyArray(new Float32Array(this.previous)),this.attributes.previous.needsUpdate=!0,this.attributes.next.copyArray(new Float32Array(this.next)),this.attributes.next.needsUpdate=!0,this.attributes.side.copyArray(new Float32Array(this.side)),this.attributes.side.needsUpdate=!0,this.attributes.width.copyArray(new Float32Array(this.width)),this.attributes.width.needsUpdate=!0,this.attributes.uv.copyArray(new Float32Array(this.uvs)),this.attributes.uv.needsUpdate=!0,this.attributes.counters.copyArray(new Float32Array(this.counters)),this.attributes.counters.needsUpdate=!0,this.attributes.index.copyArray(new Uint16Array(this.indices_array)),this.attributes.index.needsUpdate=!0):this.attributes={position:new Xe(new Float32Array(this.positions),3),previous:new Xe(new Float32Array(this.previous),3),next:new Xe(new Float32Array(this.next),3),side:new Xe(new Float32Array(this.side),1),width:new Xe(new Float32Array(this.width),1),uv:new Xe(new Float32Array(this.uvs),2),counters:new Xe(new Float32Array(this.counters),1),index:new Xe(new Uint16Array(this.indices_array),1)},this.geometry.setAttribute("position",this.attributes.position),this.geometry.setAttribute("previous",this.attributes.previous),this.geometry.setAttribute("next",this.attributes.next),this.geometry.setAttribute("side",this.attributes.side),this.geometry.setAttribute("width",this.attributes.width),this.geometry.setAttribute("uv",this.attributes.uv),this.geometry.setAttribute("counters",this.attributes.counters),this.geometry.setIndex(this.attributes.index)}advance(e){const t=this.attributes.position.array,r=this.attributes.previous.array,o=this.attributes.next.array,i=t.length;Ob(t,0,r,0,i),Ob(t,6,t,0,i-6),t[i-6]=e.x,t[i-5]=e.y,t[i-4]=e.z,t[i-3]=e.x,t[i-2]=e.y,t[i-1]=e.z,Ob(t,6,o,0,i-6),o[i-6]=e.x,o[i-5]=e.y,o[i-4]=e.z,o[i-3]=e.x,o[i-2]=e.y,o[i-1]=e.z,this.attributes.position.needsUpdate=!0,this.attributes.previous.needsUpdate=!0,this.attributes.next.needsUpdate=!0}static updateAttributes(e){const t=e.attributes.position.array;e.attributes.previous.array,e.attributes.next.array;const r=new rd;r.positions=t,r.process(),e.attributes.previous=r.attributes.previous,e.attributes.previous.needsUpdate=!0,e.attributes.next=r.attributes.next,e.attributes.next.needsUpdate=!0}}class Uve{constructor(e){this.headEdge=this.tailEdge=e,this.headIndex=e.index0,this.tailIndex=e.index1,this.indexCount=2}mergeStrip(e){const t=this.headIndex,r=e.headIndex,o=this.tailIndex,i=e.tailIndex;t==r?(this.headEdge.linkToEdge(e.headEdge),e.headEdge.linkToEdge(this.headEdge),this.headEdge=e.tailEdge,this.headIndex=e.tailIndex,this.indexCount+=e.indexCount-1):t==i?(this.headEdge.linkToEdge(e.tailEdge),e.tailEdge.linkToEdge(this.headEdge),this.headEdge=e.headEdge,this.headIndex=e.headIndex,this.indexCount+=e.indexCount-1):o==r?(this.tailEdge.linkToEdge(e.headEdge),e.headEdge.linkToEdge(this.tailEdge),this.tailEdge=e.tailEdge,this.tailIndex=e.tailIndex,this.indexCount+=e.indexCount-1):o==i&&(this.tailEdge.linkToEdge(e.tailEdge),e.tailEdge.linkToEdge(this.tailEdge),this.tailEdge=e.headEdge,this.tailIndex=e.headIndex,this.indexCount+=e.indexCount-1)}getIndicesFlat(){const e=new Float32Array(this.indexCount);let t=0,r=null,o=this.headEdge,i=e[t++]=this.headIndex;for(;o!==null;){i=o.index0==i?o.index1:o.index0,e[t++]=i;let a=o.edge0;a!=r&&a!==null||(a=o.edge1),a==r&&(a=null),r=o,o=a}return e}}class zve{constructor(e,t){this.index0=e,this.index1=t,this.edge0=null,this.edge1=null}linkToEdge(e){this.edge0===null?this.edge0=e:this.edge1===null&&(this.edge1=e)}}function TD(n,e,t){const r=n.headIndex,o=n.tailIndex;return e[r][0]||e[o][0]||t[r][0]||t[o][0]||null}function Gve(n){const e=n.length%2?n.length-1:n.length,t={},r={};for(let s=0;s<e;s+=2){const l=new Uve(new zve(n[s],n[s+1])),c=l.headIndex,u=l.tailIndex;t[c]=t[c]||[],t[u]=t[u]||[],r[c]=r[c]||[],r[u]=r[u]||[],t[c].push(l),r[u].push(l)}const o=new k0;for(const s in t)t[s].length&&o.push(new wP(t[s]),s);const i=[];let a=o.first&&o.first.value[0];for(;a;){let s=a.headIndex;t[s].splice(t[s].indexOf(a),1);let l=a.tailIndex;r[l].splice(r[l].indexOf(a),1),t[s].length==0&&o.removeNodeByKey(s);let c=TD(a,t,r);for(;c!==null;)s=c.headIndex,t[s].splice(t[s].indexOf(c),1),l=c.tailIndex,r[l].splice(r[l].indexOf(c),1),t[s].length==0&&o.removeNodeByKey(s),a.mergeStrip(c),c=TD(a,t,r);i.push(a),a=o.first&&o.first.value[0]}return i}class ID{constructor(){this.geometry=new At}fromBufferGeometry(e){const t=e.getAttribute("position"),r=e.getIndex();if(t===void 0)return;const o=[];if(r!==null)Gve(r.array).forEach((function(m){const g=new rd,_=new Float32Array(3*m.indexCount);m.getIndicesFlat().forEach((function(A,y){_.set(t.array.subarray(3*A,3*A+3),3*y)})),g.setGeometry(_),o.push(g)}));else{const m=new rd;m.setGeometry(t.array),o.push(m)}let i=[],a=[],s=[],l=[],c=[],u=[],d=[],f=[],h=0;o.forEach((function(m){i=i.concat(m.positions),a=a.concat(m.previous),s=s.concat(m.next),l=l.concat(m.side),c=c.concat(m.width),u=u.concat(m.uvs),d=d.concat(m.counters);const g=m.indices_array.map((function(_){return _+h}));f=f.concat(g),h+=m.positions.length/3})),this.geometry.setAttribute("position",new Xe(new Float32Array(i),3)),this.geometry.setAttribute("previous",new Xe(new Float32Array(a),3)),this.geometry.setAttribute("next",new Xe(new Float32Array(s),3)),this.geometry.setAttribute("side",new Xe(new Float32Array(l),1)),this.geometry.setAttribute("width",new Xe(new Float32Array(c),1)),this.geometry.setAttribute("uv",new Xe(new Float32Array(u),2)),this.geometry.setAttribute("counters",new Xe(new Float32Array(d),1));const p=DR(f)>65535?Uint32Array:Uint16Array;this.geometry.setIndex(new Xe(new p(f),1))}}class Ma extends xi{constructor(e,t,r,o){super(),this.renderScene=t,this.renderCamera=r,this.selectedObjects=o!==void 0?o:[],this.visibleEdgeColor=new pt(1,1,1,1),this.hiddenEdgeColor=new pt(.1,.04,.02,1),this.edgeGlow=0,this.usePatternTexture=!1,this.edgeThickness=1,this.edgeStrength=3,this.downSampleRatio=2,this.pulsePeriod=0,this.renderToScreen=!1,this.resolution=e!==void 0?new be(e.x,e.y):new be(256,256);const i=Math.round(this.resolution.x/this.downSampleRatio),a=Math.round(this.resolution.y/this.downSampleRatio);this.renderTargetMaskBuffer=new nn(this.resolution.x,this.resolution.y),this.renderTargetMaskBuffer.texture.name="OutlinePass.mask",this.renderTargetMaskBuffer.texture.generateMipmaps=!1,this.renderTargetDepthBuffer=new nn(this.resolution.x,this.resolution.y),this.renderTargetDepthBuffer.texture.name="OutlinePass.depth",this.renderTargetDepthBuffer.texture.generateMipmaps=!1,this.renderTargetMaskDownSampleBuffer=new nn(i,a),this.renderTargetMaskDownSampleBuffer.texture.name="OutlinePass.depthDownSample",this.renderTargetMaskDownSampleBuffer.texture.generateMipmaps=!1,this.renderTargetBlurBuffer1=new nn(i,a),this.renderTargetBlurBuffer1.texture.name="OutlinePass.blur1",this.renderTargetBlurBuffer1.texture.generateMipmaps=!1,this.renderTargetBlurBuffer2=new nn(Math.round(i/2),Math.round(a/2)),this.renderTargetBlurBuffer2.texture.name="OutlinePass.blur2",this.renderTargetBlurBuffer2.texture.generateMipmaps=!1,this.edgeDetectionMaterial=this.getEdgeDetectionMaterial(),this.renderTargetEdgeBuffer1=new nn(i,a),this.renderTargetEdgeBuffer1.texture.name="OutlinePass.edge1",this.renderTargetEdgeBuffer1.texture.generateMipmaps=!1,this.renderTargetEdgeBuffer2=new nn(Math.round(i/2),Math.round(a/2)),this.renderTargetEdgeBuffer2.texture.name="OutlinePass.edge2",this.renderTargetEdgeBuffer2.texture.generateMipmaps=!1,this.separableBlurMaterial1=this.getSeparableBlurMaterial(4),this.separableBlurMaterial1.uniforms.texSize.value=new be(i,a),this.separableBlurMaterial1.uniforms.kernelRadius.value=1,this.separableBlurMaterial2=this.getSeparableBlurMaterial(4),this.separableBlurMaterial2.uniforms.texSize.value=new be(Math.round(i/2),Math.round(a/2)),this.separableBlurMaterial2.uniforms.kernelRadius.value=4,this.overlayMaterial=this.getOverlayMaterial();const s=Tt.copy;this.copyUniforms=_o.clone(s.uniforms),this.copyUniforms.opacity.value=1,this.materialCopy=new Dn({defines:Object.assign({},s.defines),uniforms:this.copyUniforms,vertexShader:s.vertexShader,fragmentShader:s.fragmentShader,blending:0,depthTest:!1,depthWrite:!1,transparent:!0}),this.enabled=!0,this.needsSwap=!1,this.oldClearColor=new Ge,this.oldClearAlpha=1,this.basic=new pr({toneMapped:!1}),this.fsQuad=new Xi(null),this.camera=new ya(-1,1,1,-1,0,1),this.tempPulseColor1=new pt,this.tempPulseColor2=new pt,this.textureMatrix=new Ue,this.visibilityState=new WeakMap,this._depthMaterial=new Gu({blending:0,depthPacking:3201,side:2}),this._maskMaterial=new CP({side:2})}dispose(){this.renderTargetMaskBuffer.dispose(),this.renderTargetDepthBuffer.dispose(),this.renderTargetMaskDownSampleBuffer.dispose(),this.renderTargetBlurBuffer1.dispose(),this.renderTargetBlurBuffer2.dispose(),this.renderTargetEdgeBuffer1.dispose(),this.renderTargetEdgeBuffer2.dispose()}setSize(e,t){this.renderTargetMaskBuffer.setSize(e,t);let r=Math.round(e/this.downSampleRatio),o=Math.round(t/this.downSampleRatio);this.renderTargetMaskDownSampleBuffer.setSize(r,o),this.renderTargetBlurBuffer1.setSize(r,o),this.renderTargetEdgeBuffer1.setSize(r,o),this.separableBlurMaterial1.uniforms.texSize.value=new be(r,o),r=Math.round(r/2),o=Math.round(o/2),this.renderTargetBlurBuffer2.setSize(r,o),this.renderTargetEdgeBuffer2.setSize(r,o),this.separableBlurMaterial2.uniforms.texSize.value=new be(r,o)}saveVisibilityState(){const e=this;e.renderScene.traverse((function(t){(t.isMesh||t.isSprite||t.isPoints||t.isLine)&&e.visibilityState.set(t,t.visible)}))}restoreVisibilityState(){const e=this;e.renderScene.traverse((function(t){(t.isMesh||t.isSprite||t.isPoints||t.isLine)&&(t.visible=e.visibilityState.get(t))}))}changeVisibilityOfSelectedObjects(e){const t=this;function r(o){(o.isMesh||o.isSprite||o.isPoints||o.isLine)&&t.visibilityState.get(o)&&(o.visible=e)}for(let o=0;o<t.selectedObjects.length;o++){const i=t.selectedObjects[o];r(i);const a=i.children;for(let s=0;s<a.length;s++){const l=a[s];l.isMesh&&l.isMaterialGeneratedMesh&&r(l)}}}changeVisibilityOfNonSelectedObjects(e){const t=this,r=[];function o(i){(i.isMesh||i.isSprite||i.isPoints||i.isLine)&&t.visibilityState.get(i)&&r.push(i)}for(let i=0;i<t.selectedObjects.length;i++){const a=t.selectedObjects[i];o(a);const s=a.children;for(let l=0;l<s.length;l++){const c=s[l];c.isMesh&&c.isMaterialGeneratedMesh&&o(c)}}t.renderScene.traverse((function(i){if((i.isMesh||i.isSprite||i.isPoints||i.isLine)&&t.visibilityState.get(i)){let a=!1;for(let s=0;s<r.length;s++)if(r[s].id===i.id){a=!0;break}a||(i.visible=e)}}))}updateTextureMatrix(){this.textureMatrix.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),this.textureMatrix.multiply(this.renderCamera.projectionMatrix),this.textureMatrix.multiply(this.renderCamera.matrixWorldInverse)}render(e,t,r,o,i){if(this.renderToScreen&&(this.fsQuad.material=this.basic,this.basic.map=r.texture,e.setRenderTarget(null),e.clear(),this.fsQuad.render(e)),this.selectedObjects.length===0)return;e.getClearColor(this.oldClearColor),this.oldClearAlpha=e.getClearAlpha();const a=e.autoClear;e.autoClear=!1,i&&e.context.disable(e.context.STENCIL_TEST),e.setClearColor(16777215,1);const s=this.renderScene.background;if(this.renderScene.background=null,this.renderScene.traverse((function(l){l.isAnnotationControl&&(l._doUpdateSave=l.doUpdate,l.doUpdate=!1)})),this.saveVisibilityState(),e.setRenderTarget(this.renderTargetDepthBuffer),e.clear(),this.changeVisibilityOfSelectedObjects(!1),this.changeVisibilityOfNonSelectedObjects(!0),this.renderScene.overrideMaterial=this._depthMaterial,e.render(this.renderScene,this.renderCamera),this.updateTextureMatrix(),e.setRenderTarget(this.renderTargetMaskBuffer),e.clear(),this.changeVisibilityOfSelectedObjects(!0),this.changeVisibilityOfNonSelectedObjects(!1),this.renderScene.overrideMaterial=this._maskMaterial,this.renderScene.overrideMaterial.cameraNearFar=new be(this.renderCamera.near,this.renderCamera.far),this.renderScene.overrideMaterial.depthTexture=this.renderTargetDepthBuffer.texture,this.renderScene.overrideMaterial.textureMatrix=this.textureMatrix,e.render(this.renderScene,this.renderCamera),this.renderScene.overrideMaterial=null,this.restoreVisibilityState(),this.renderScene.background=s,this.fsQuad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.renderTargetMaskBuffer.texture,e.setRenderTarget(this.renderTargetMaskDownSampleBuffer),e.clear(),this.fsQuad.render(e),this.tempPulseColor1.copy(this.visibleEdgeColor),this.tempPulseColor2.copy(this.hiddenEdgeColor),this.pulsePeriod>0){const l=.625+.75*Math.cos(.01*performance.now()/this.pulsePeriod)/2;this.tempPulseColor1.multiplyScalar(l),this.tempPulseColor2.multiplyScalar(l)}this.fsQuad.material=this.edgeDetectionMaterial,this.edgeDetectionMaterial.uniforms.maskTexture.value=this.renderTargetMaskDownSampleBuffer.texture,this.edgeDetectionMaterial.uniforms.texSize.value=new be(this.renderTargetMaskDownSampleBuffer.width,this.renderTargetMaskDownSampleBuffer.height),this.edgeDetectionMaterial.uniforms.visibleEdgeColor.value=this.tempPulseColor1,this.edgeDetectionMaterial.uniforms.hiddenEdgeColor.value=this.tempPulseColor2,e.setRenderTarget(this.renderTargetEdgeBuffer1),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.separableBlurMaterial1,this.separableBlurMaterial1.uniforms.colorTexture.value=this.renderTargetEdgeBuffer1.texture,this.separableBlurMaterial1.uniforms.direction.value=Ma.BlurDirectionX,this.separableBlurMaterial1.uniforms.kernelRadius.value=this.edgeThickness,e.setRenderTarget(this.renderTargetBlurBuffer1),e.clear(),this.fsQuad.render(e),this.separableBlurMaterial1.uniforms.colorTexture.value=this.renderTargetBlurBuffer1.texture,this.separableBlurMaterial1.uniforms.direction.value=Ma.BlurDirectionY,e.setRenderTarget(this.renderTargetEdgeBuffer1),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.separableBlurMaterial2,this.separableBlurMaterial2.uniforms.colorTexture.value=this.renderTargetEdgeBuffer1.texture,this.separableBlurMaterial2.uniforms.direction.value=Ma.BlurDirectionX,e.setRenderTarget(this.renderTargetBlurBuffer2),e.clear(),this.fsQuad.render(e),this.separableBlurMaterial2.uniforms.colorTexture.value=this.renderTargetBlurBuffer2.texture,this.separableBlurMaterial2.uniforms.direction.value=Ma.BlurDirectionY,e.setRenderTarget(this.renderTargetEdgeBuffer2),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.overlayMaterial,this.overlayMaterial.uniforms.maskTexture.value=this.renderTargetMaskBuffer.texture,this.overlayMaterial.uniforms.edgeTexture1.value=this.renderTargetEdgeBuffer1.texture,this.overlayMaterial.uniforms.edgeTexture2.value=this.renderTargetEdgeBuffer2.texture,this.overlayMaterial.uniforms.patternTexture.value=this.patternTexture,this.overlayMaterial.uniforms.edgeStrength.value=this.edgeStrength,this.overlayMaterial.uniforms.edgeGlow.value=this.edgeGlow,this.overlayMaterial.uniforms.usePatternTexture.value=this.usePatternTexture,i&&e.context.enable(e.context.STENCIL_TEST),this.renderToScreen?e.setRenderTarget(null):e.setRenderTarget(r),this.fsQuad.render(e),e.setClearColor(this.oldClearColor,this.oldClearAlpha),e.autoClear=a,this.renderScene.traverse((function(l){l.isAnnotationControl&&(l.doUpdate=l._doUpdateSave)}))}getEdgeDetectionMaterial(){return new Dn({type:"OutlineEdgeDetection",defines:{HIDDEN_EDGE_ALPHA:1},uniforms:{maskTexture:{value:null},texSize:{value:new be(.5,.5)},visibleEdgeColor:{value:new pt(1,1,1,1)},hiddenEdgeColor:{value:new pt(1,1,1,1)}},vertexShader:Qe.pp_plane_vert,fragmentShader:Qe.pp_outline_edge_frag})}getSeparableBlurMaterial(e){return new Dn({type:"OutlineSeparableBlur",defines:{MAX_RADIUS:e},uniforms:{colorTexture:{value:null},texSize:{value:new be(.5,.5)},direction:{value:new be(.5,.5)},kernelRadius:{value:1}},vertexShader:Qe.pp_plane_vert,fragmentShader:Qe.pp_outline_blur_frag})}getOverlayMaterial(){return new Dn({type:"OutlineOverlay",uniforms:{maskTexture:{value:null},edgeTexture1:{value:null},edgeTexture2:{value:null},patternTexture:{value:null},edgeStrength:{value:1},edgeGlow:{value:1},usePatternTexture:{value:0}},vertexShader:Qe.pp_plane_vert,fragmentShader:Qe.pp_outline_overlay_frag,blending:5,blendEquation:100,blendEquationAlpha:100,blendSrc:204,blendDst:205,blendSrcAlpha:201,blendDstAlpha:201,depthTest:!1,depthWrite:!1,transparent:!0})}setCamera(e){this.renderCamera=e}}Ma.BlurDirectionX=new be(1,0),Ma.BlurDirectionY=new be(0,1);class o1 extends xi{constructor(e,t,r,o,i){super(),this.scene=e,this.camera=t,this.overrideMaterial=r,this.clearColor=o,this.clearAlpha=i!==void 0?i:0,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new Ge}render(e,t,r){const o=e.autoClear;let i,a;e.autoClear=!1,this.overrideMaterial!==void 0&&(a=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor&&(e.getClearColor(this._oldClearColor),i=e.getClearAlpha(),e.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:r),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),this.clearColor&&e.setClearColor(this._oldClearColor,i),this.overrideMaterial!==void 0&&(this.scene.overrideMaterial=a),e.autoClear=o}setCamera(e){this.camera=e}}class i1{constructor(e,t,r,o,i){this._domElement=e,this._keyCodes=Array.isArray(t)?t:[t],this._callback=r,this._repeats=o,this._period=i,this._timer=0,this._counter=0,this._keydownCb=(function(a){this._keyCodes.includes(a.code)&&(this._timer||(this._timer=window.setTimeout((function(){this._counter=0,this._timer=null}).bind(this),1e3*i)),++this._counter>=o&&(this._timer&&(window.clearTimeout(this._timer),this._timer=null),this._counter=0,this._callback()))}).bind(this),this._domElement.addEventListener("keydown",this._keydownCb,!1)}dispose(){this._domElement.removeEventListener("keydown",this._keydownCb,!1),this._timer&&window.clearTimeout(this._timer)}}class Fh extends xi{constructor(e,t,r,o){super(),this.scene=e,this.camera=t,this.sampleLevel=4,this.unbiased=!0,this.clearColor=r!==void 0?r:0,this.clearAlpha=o!==void 0?o:0,this._oldClearColor=new Ge;const i=Tt.copy;this.copyUniformsAccum=_o.clone(i.uniforms),this.copyMaterialAccum=new Dn({type:"SSAACopyAccum",defines:Object.assign({},i.defines),uniforms:this.copyUniformsAccum,vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,premultipliedAlpha:!0,transparent:!0,blending:2,depthTest:!1,depthWrite:!1}),this.fsQuadAccum=new Xi(this.copyMaterialAccum),this.copyUniformsFinal=_o.clone(i.uniforms),this.copyMaterialFinal=new Dn({type:"SSAACopyFinal",defines:Object.assign({},i.defines),uniforms:this.copyUniformsFinal,vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,premultipliedAlpha:!1,transparent:!1,blending:0,depthTest:!1,depthWrite:!1}),this.fsQuadFinal=new Xi(this.copyMaterialFinal),this.iterative=!1,this.iterativeFrame=0}_getJitterOffsets(){return Hve[Math.max(0,Math.min(this.sampleLevel,5))]}_isLastIterativeFrame(){const e=this._getJitterOffsets();return this.iterativeFrame==e.length-1}dispose(){this.sampleRenderTarget&&(this.sampleRenderTarget.dispose(),this.sampleRenderTarget=null,this.accumRenderTarget.dispose(),this.accumRenderTarget=null)}setSize(e,t){this.sampleRenderTarget&&(this.sampleRenderTarget.setSize(e,t),this.accumRenderTarget.setSize(e,t))}render(e,t,r){this.sampleRenderTarget||(this.sampleRenderTarget=r.clone(),this.sampleRenderTarget.texture.name="SSAARenderPass.sample",this.accumRenderTarget=r.clone(),this.accumRenderTarget.texture.name="SSAARenderPass.accum");const o=this._getJitterOffsets(),i=e.autoClear;e.autoClear=!1,e.getClearColor(this._oldClearColor);const a=e.getClearAlpha(),s=1/o.length;this.copyUniformsAccum.tDiffuse.value=this.sampleRenderTarget.texture;const l=r.width,c=r.height,u=this.camera.view?this.camera.view.offsetX:0,d=this.camera.view?this.camera.view.offsetY:0;let f,h;this.iterative?(f=this.iterativeFrame,h=performance.now()):f=0;const p=o.length;for(let m=f;m<p;m++){this.dispatchEvent({type:"iteration",frame:m});const g=o[m];this.camera.setViewOffset&&this.camera.setViewOffset(l,c,u+.0625*g[0],d+.0625*g[1],l,c);let _=s;if(this.unbiased&&(_+=.03125*((m+.5)/o.length-.5)),this.copyUniformsAccum.opacity.value=_,e.setClearColor(this.clearColor,this.clearAlpha),e.setRenderTarget(this.sampleRenderTarget),e.clear(),e.render(this.scene,this.camera),this.iterative?e.setRenderTarget(this.accumRenderTarget):e.setRenderTarget(this.renderToScreen?null:t),m===0&&(e.setClearColor(0,0),e.clear()),this.fsQuadAccum.render(e),this.iterativeFrame=m,this.iterative&&performance.now()-h>4)break}this.iterative&&(this._isLastIterativeFrame()?(this.copyUniformsFinal.tDiffuse.value=this.accumRenderTarget.texture,e.setRenderTarget(this.renderToScreen?null:t),this.fsQuadFinal.render(e),this.iterativeFrame=0):this.iterativeFrame++),this.camera.setViewOffset&&this.camera.setViewOffset(l,c,u,d,l,c),e.autoClear=i,e.setClearColor(this._oldClearColor,a)}isLastIterativeFrame(){console.error("isLastIterativeFrame() deprectated, use pass event listener instead")}setCamera(e){this.camera=e}}const Hve=[[[0,0]],[[4,4],[-4,-4]],[[-2,-6],[6,-2],[-6,2],[2,6]],[[1,-3],[-1,3],[5,1],[-3,-5],[-5,5],[-7,-1],[3,7],[7,-7]],[[1,1],[-1,-3],[-3,2],[4,-1],[-5,-2],[2,5],[5,3],[3,-5],[-2,6],[0,-7],[-4,-6],[-6,4],[-8,0],[7,-4],[6,7],[-7,-8]],[[-4,-7],[-7,-5],[-3,-5],[-5,-4],[-1,-4],[-2,-2],[-6,-1],[-4,0],[-7,1],[-1,2],[-6,3],[-3,3],[-7,6],[-3,6],[-5,7],[-1,7],[5,-7],[1,-6],[6,-5],[4,-4],[2,-3],[7,-2],[1,-1],[4,-1],[2,1],[6,2],[0,4],[4,4],[2,5],[7,5],[5,6],[3,7]]];class RD extends xi{constructor(e,t,r){super(),this.enabled=!0,this.needsSwap=!1,r=r||{},this.objects=r.objects||[],this.steps=_e(r.steps)||10,this.stride=_e(r.stride)||30,this.binarySearchSteps=_e(r.binarySearchSteps)||4,this.renderTargetScale=_e(r.renderTargetScale)||.5,this.thickness=_e(r.thickness)||.01,this.maxDistance=_e(r.maxDistance)||100,this.jitter=_e(r.jitter)||1,this.useRefract=_e(r.useRefract)||!1,this.renderAfter=_e(r.renderAfter)||[],this.simpleRefraction=_e(r.simpleRefraction)||!1,this.scene=e,this.camera=t,this._prevClearColor=new Ge,this._depthBuffer=new nn(256,256,{minFilter:1003,magFilter:1003,format:1023,type:1016}),this._depthBuffer.texture.name="SSRPass.Depth",this._depthBuffer.texture.generateMipmaps=!1,this._depthMaterial=new Gu,this._depthMaterial.depthPacking=3202,this._backfaceDepthBuffer=this._depthBuffer.clone(),this._backfaceDepthBuffer.texture.name="SSRPass.Depth",this._backfaceDepthMaterial=new Gu,this._backfaceDepthMaterial.depthPacking=3202,this._backfaceDepthMaterial.side=1,this.basic=new pr,this.fsQuad=new Xi(null)}_setLayer(e,t){e.layers.set(t),e.isMesh&&e.isMaterialGeneratedMesh&&e.parent.layers.enable(t)}dispose(){this._depthBuffer.dispose(),this._backfaceDepthBuffer.dispose();for(let e=0;e<this.objects.length;e++){const t=this.objects[e],r=t.material;r&&(this._setLayer(t,0),delete r.defines.USE_SSR,delete r.defines.USE_SSR_REFRACT,delete r.defines.SSR_SIMPLE_REFRACT,delete r.defines.MAX_STEPS,delete r.defines.BINARY_SEARCH_ITERATIONS,r.ssrParams=null,r.needsUpdate=!0)}this.objects.splice(0);for(let e=0;e<this.renderAfter.length;e++){const t=this.renderAfter[e];this._setLayer(t,0)}this.renderAfter.splice(0)}setCamera(e){this.camera=e}setSize(e,t){e*=this.renderTargetScale,t*=this.renderTargetScale,this._depthBuffer.setSize(e,t),this._backfaceDepthBuffer.setSize(e,t)}_assignMaterialParams(e,t){e.ssrParams=e.ssrParams||{};const r=e.ssrParams;r.invProjectionMatrix=r.invProjectionMatrix||new Ue,r.invProjectionMatrix.copy(this.camera.projectionMatrix).invert(),r.sourceBuffer=t,r.depthBuffer=this._depthBuffer,r.backfaceDepthBuffer=this._backfaceDepthBuffer,r.stride=this.stride,r.thickness=this.thickness,r.maxDistance=this.maxDistance,r.jitter=this.jitter}render(e,t,r,o,i){e.getClearColor(this._prevClearColor);const a=e.getClearAlpha(),s=e.autoClear;e.autoClear=!0,e.setClearColor(0,0);const l=this.scene.background;this.scene.background=null;const c=this.camera.layers.mask,u=this.camera.ignoreShadowLayers,d=this.scene.overrideMaterial;this.fsQuad.material=this.basic,this.basic.map=r.texture,e.setRenderTarget(t),e.clear(),this.fsQuad.render(e),this.useRefract||(this._depthMaterial.side=2),this.camera.layers.enable(this.useRefract?3:5),this.useRefract&&this.simpleRefraction||(this.scene.overrideMaterial=this._depthMaterial,e.setRenderTarget(this._depthBuffer),e.clear(),e.render(this.scene,this.camera)),this.useRefract||(this.scene.overrideMaterial=this._backfaceDepthMaterial,e.setRenderTarget(this._backfaceDepthBuffer),e.clear(),e.render(this.scene,this.camera)),this.scene.overrideMaterial=d,this.scene.traverse((f=>{f.isLight&&(f.userData.oldLayersMask=f.layers.mask,f.layers.enable(this.useRefract?5:3),this.renderAfter.length&&f.layers.enable(this.useRefract?6:4))}));for(let f=0;f<this.objects.length;f++){const h=this.objects[f],p=h.material;p&&p.isMeshNodeMaterial&&(this._setLayer(h,this.useRefract?5:3),_e(p.defines.USE_SSR)||(p.defines.USE_SSR="",p.needsUpdate=!0),this.useRefract&&(_e(p.defines.USE_SSR_REFRACT)||(p.defines.USE_SSR_REFRACT="",p.needsUpdate=!0),this.simpleRefraction&&(_e(p.defines.SSR_SIMPLE_REFRACT)||(p.defines.SSR_SIMPLE_REFRACT="",p.needsUpdate=!0))),p.defines.MAX_STEPS!==this.steps&&(p.defines.MAX_STEPS=Math.floor(this.steps),p.needsUpdate=!0),p.defines.BINARY_SEARCH_ITERATIONS!==this.binarySearchSteps&&(p.defines.BINARY_SEARCH_ITERATIONS=Math.floor(this.binarySearchSteps),p.needsUpdate=!0),this._assignMaterialParams(p,t))}for(let f=0;f<this.renderAfter.length;f++){const h=this.renderAfter[f];this._setLayer(h,this.useRefract?6:4)}this.camera.layers.set(this.useRefract?5:3),this.camera.ignoreShadowLayers=!0,e.autoClear=!1,e.setRenderTarget(r),e.render(this.scene,this.camera),this.renderAfter.length&&(this.camera.layers.set(this.useRefract?6:4),e.render(this.scene,this.camera)),this.scene.background=l,this.camera.layers.mask=c,this.camera.ignoreShadowLayers=u,this.scene.traverse((f=>{f.isLight&&"oldLayersMask"in f.userData&&(f.layers.mask=f.userData.oldLayersMask,delete f.userData.oldLayersMask)})),this.renderToScreen&&(this.fsQuad.material=this.basic,this.basic.map=r.texture,e.setRenderTarget(null),e.clear(),this.fsQuad.render(e)),e.setClearColor(this._prevClearColor,a),e.autoClear=s}}class kb extends bs{constructor(){super(Tt.tonemap),this.material.type="ToneMap"}}var LD=function(n){return URL.createObjectURL(new Blob([n],{type:"text/javascript"}))};try{URL.revokeObjectURL(LD(""))}catch{LD=function(e){return"data:application/javascript;charset=UTF-8,"+encodeURI(e)}}var Uo=Uint8Array,zo=Uint16Array,od=Uint32Array,Fb=new Uo([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Vb=new Uo([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),PD=new Uo([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),DD=function(n,e){for(var t=new zo(31),r=0;r<31;++r)t[r]=e+=1<<n[r-1];var o=new od(t[30]);for(r=1;r<30;++r)for(var i=t[r];i<t[r+1];++i)o[i]=i-t[r]<<5|r;return[t,o]},BD=DD(Fb,2),Wve=BD[0],Ub=BD[1];Wve[28]=258,Ub[258]=28;for(var jve=DD(Vb,0),ND=jve[1],OD=new zo(32768),zn=0;zn<32768;++zn){var gc=(43690&zn)>>>1|(21845&zn)<<1;gc=(61680&(gc=(52428&gc)>>>2|(13107&gc)<<2))>>>4|(3855&gc)<<4,OD[zn]=((65280&gc)>>>8|(255&gc)<<8)>>>1}var Vh=function(n,e,t){for(var r=n.length,o=0,i=new zo(e);o<r;++o)++i[n[o]-1];var a,s=new zo(e);for(o=0;o<e;++o)s[o]=s[o-1]+i[o-1]<<1;for(a=new zo(r),o=0;o<r;++o)n[o]&&(a[o]=OD[s[n[o]-1]++]>>>15-n[o]);return a},_c=new Uo(288);for(zn=0;zn<144;++zn)_c[zn]=8;for(zn=144;zn<256;++zn)_c[zn]=9;for(zn=256;zn<280;++zn)_c[zn]=7;for(zn=280;zn<288;++zn)_c[zn]=8;var a1=new Uo(32);for(zn=0;zn<32;++zn)a1[zn]=5;var Qve=Vh(_c,9),$ve=Vh(a1,5),kD=function(n){return(n/8|0)+(7&n&&1)},FD=function(n,e,t){(t==null||t>n.length)&&(t=n.length);var r=new(n instanceof zo?zo:n instanceof od?od:Uo)(t-e);return r.set(n.subarray(e,t)),r},xs=function(n,e,t){t<<=7&e;var r=e/8|0;n[r]|=t,n[r+1]|=t>>>8},Uh=function(n,e,t){t<<=7&e;var r=e/8|0;n[r]|=t,n[r+1]|=t>>>8,n[r+2]|=t>>>16},zb=function(n,e){for(var t=[],r=0;r<n.length;++r)n[r]&&t.push({s:r,f:n[r]});var o=t.length,i=t.slice();if(!o)return[zD,0];if(o==1){var a=new Uo(t[0].s+1);return a[t[0].s]=1,[a,1]}t.sort((function(E,x){return E.f-x.f})),t.push({s:-1,f:25001});var s=t[0],l=t[1],c=0,u=1,d=2;for(t[0]={s:-1,f:s.f+l.f,l:s,r:l};u!=o-1;)s=t[t[c].f<t[d].f?c++:d++],l=t[c!=u&&t[c].f<t[d].f?c++:d++],t[u++]={s:-1,f:s.f+l.f,l:s,r:l};var f=i[0].s;for(r=1;r<o;++r)i[r].s>f&&(f=i[r].s);var h=new zo(f+1),p=Gb(t[u-1],h,0);if(p>e){r=0;var m=0,g=p-e,_=1<<g;for(i.sort((function(E,x){return h[x.s]-h[E.s]||E.f-x.f}));r<o;++r){var A=i[r].s;if(!(h[A]>e))break;m+=_-(1<<p-h[A]),h[A]=e}for(m>>>=g;m>0;){var y=i[r].s;h[y]<e?m-=1<<e-h[y]++-1:++r}for(;r>=0&&m;--r){var b=i[r].s;h[b]==e&&(--h[b],++m)}p=e}return[new Uo(h),p]},Gb=function(n,e,t){return n.s==-1?Math.max(Gb(n.l,e,t+1),Gb(n.r,e,t+1)):e[n.s]=t},VD=function(n){for(var e=n.length;e&&!n[--e];);for(var t=new zo(++e),r=0,o=n[0],i=1,a=function(l){t[r++]=l},s=1;s<=e;++s)if(n[s]==o&&s!=e)++i;else{if(!o&&i>2){for(;i>138;i-=138)a(32754);i>2&&(a(i>10?i-11<<5|28690:i-3<<5|12305),i=0)}else if(i>3){for(a(o),--i;i>6;i-=6)a(8304);i>2&&(a(i-3<<5|8208),i=0)}for(;i--;)a(o);i=1,o=n[s]}return[t.subarray(0,r),e]},zh=function(n,e){for(var t=0,r=0;r<e.length;++r)t+=n[r]*e[r];return t},Hb=function(n,e,t){var r=t.length,o=kD(e+2);n[o]=255&r,n[o+1]=r>>>8,n[o+2]=255^n[o],n[o+3]=255^n[o+1];for(var i=0;i<r;++i)n[o+i+4]=t[i];return 8*(o+4+r)},UD=function(n,e,t,r,o,i,a,s,l,c,u){xs(e,u++,t),++o[256];for(var d=zb(o,15),f=d[0],h=d[1],p=zb(i,15),m=p[0],g=p[1],_=VD(f),A=_[0],y=_[1],b=VD(m),E=b[0],x=b[1],w=new zo(19),L=0;L<A.length;++L)w[31&A[L]]++;for(L=0;L<E.length;++L)w[31&E[L]]++;for(var C=zb(w,7),P=C[0],D=C[1],Q=19;Q>4&&!P[PD[Q-1]];--Q);var re,G,se,ee,ie=c+5<<3,H=zh(o,_c)+zh(i,a1)+a,T=zh(o,f)+zh(i,m)+a+14+3*Q+zh(w,P)+(2*w[16]+3*w[17]+7*w[18]);if(ie<=H&&ie<=T)return Hb(e,u,n.subarray(l,l+c));if(xs(e,u,1+(T<H)),u+=2,T<H){re=Vh(f,h),G=f,se=Vh(m,g),ee=m;var R=Vh(P,D);for(xs(e,u,y-257),xs(e,u+5,x-1),xs(e,u+10,Q-4),u+=14,L=0;L<Q;++L)xs(e,u+3*L,P[PD[L]]);u+=3*Q;for(var O=[A,E],W=0;W<2;++W){var ae=O[W];for(L=0;L<ae.length;++L){var ne=31&ae[L];xs(e,u,R[ne]),u+=P[ne],ne>15&&(xs(e,u,ae[L]>>>5&127),u+=ae[L]>>>12)}}}else re=Qve,G=_c,se=$ve,ee=a1;for(L=0;L<s;++L)if(r[L]>255){ne=r[L]>>>18&31,Uh(e,u,re[ne+257]),u+=G[ne+257],ne>7&&(xs(e,u,r[L]>>>23&31),u+=Fb[ne]);var oe=31&r[L];Uh(e,u,se[oe]),u+=ee[oe],oe>3&&(Uh(e,u,r[L]>>>5&8191),u+=Vb[oe])}else Uh(e,u,re[r[L]]),u+=G[r[L]];return Uh(e,u,re[256]),u+G[256]},Yve=new od([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),zD=new Uo(0),Xve=function(n,e,t,r,o,i){var a=n.length,s=new Uo(r+a+5*(1+Math.ceil(a/7e3))+o),l=s.subarray(r,s.length-o),c=0;if(!e||a<8)for(var u=0;u<=a;u+=65535){var d=u+65535;d<a?c=Hb(l,c,n.subarray(u,d)):(l[u]=i,c=Hb(l,c,n.subarray(u,a)))}else{for(var f=Yve[e-1],h=f>>>13,p=8191&f,m=(1<<t)-1,g=new zo(32768),_=new zo(m+1),A=Math.ceil(t/3),y=2*A,b=function(v){return(n[v]^n[v+1]<<A^n[v+2]<<y)&m},E=new od(25e3),x=new zo(288),w=new zo(32),L=0,C=0,P=(u=0,0),D=0,Q=0;u<a;++u){var re=b(u),G=32767&u,se=_[re];if(g[G]=se,_[re]=G,D<=u){var ee=a-u;if((L>7e3||P>24576)&&ee>423){c=UD(n,l,0,E,x,w,C,P,Q,u-Q,c),P=L=C=0,Q=u;for(var ie=0;ie<286;++ie)x[ie]=0;for(ie=0;ie<30;++ie)w[ie]=0}var H=2,T=0,R=p,O=G-se&32767;if(ee>2&&re==b(u-O))for(var W=Math.min(h,ee)-1,ae=Math.min(32767,u),ne=Math.min(258,ee);O<=ae&&--R&&G!=se;){if(n[u+H]==n[u+H-O]){for(var oe=0;oe<ne&&n[u+oe]==n[u+oe-O];++oe);if(oe>H){if(H=oe,T=O,oe>W)break;var F=Math.min(O,oe-2),k=0;for(ie=0;ie<F;++ie){var q=u-O+ie+32768&32767,j=q-g[q]+32768&32767;j>k&&(k=j,se=q)}}}O+=(G=se)-(se=g[G])+32768&32767}if(T){E[P++]=268435456|Ub[H]<<18|ND[T];var U=31&Ub[H],z=31&ND[T];C+=Fb[U]+Vb[z],++x[257+U],++w[z],D=u+H,++L}else E[P++]=n[u],++x[n[u]]}}c=UD(n,l,i,E,x,w,C,P,Q,u-Q,c)}return FD(s,0,r+kD(c)+o)},qve=(function(){for(var n=new od(256),e=0;e<256;++e){for(var t=e,r=9;--r;)t=(1&t&&3988292384)^t>>>1;n[e]=t}return n})(),Kve=function(){var n=-1;return{p:function(e){for(var t=n,r=0;r<e.length;++r)t=qve[255&t^e[r]]^t>>>8;n=t},d:function(){return~n}}},Zve=function(n,e,t,r,o){return Xve(n,e.level==null?6:e.level,e.mem==null?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(n.length)))):12+e.mem,t,r,!0)},GD=function(n,e){var t={};for(var r in n)t[r]=n[r];for(var r in e)t[r]=e[r];return t},Qr=function(n,e,t){for(;t;++e)n[e]=t,t>>>=8};function Jve(n,e){return Zve(n,e||{},0,0)}var HD=function(n,e,t,r){for(var o in n){var i=n[o],a=e+o;i instanceof Uo?t[a]=[i,r]:Array.isArray(i)?t[a]=[i[0],GD(r,i[1])]:HD(i,a+"/",t,r)}},WD=typeof TextEncoder<"u"&&new TextEncoder,eAe=typeof TextDecoder<"u"&&new TextDecoder,tAe=0;try{eAe.decode(zD,{stream:!0}),tAe=1}catch{}function s1(n,e){if(WD)return WD.encode(n);for(var t=n.length,r=new Uo(n.length+(n.length>>1)),o=0,i=function(c){r[o++]=c},a=0;a<t;++a){if(o+5>r.length){var s=new Uo(o+8+(t-a<<1));s.set(r),r=s}var l=n.charCodeAt(a);l<128||e?i(l):l<2048?(i(192|l>>6),i(128|63&l)):l>55295&&l<57344?(i(240|(l=65536+(1047552&l)|1023&n.charCodeAt(++a))>>18),i(128|l>>12&63),i(128|l>>6&63),i(128|63&l)):(i(224|l>>12),i(128|l>>6&63),i(128|63&l))}return FD(r,0,o)}var Wb=function(n){var e=0;if(n)for(var t in n){var r=n[t].length;if(r>65535)throw"extra field too long";e+=r+4}return e},jD=function(n,e,t,r,o,i,a,s){var l=r.length,c=t.extra,u=s&&s.length,d=Wb(c);Qr(n,e,a!=null?33639248:67324752),e+=4,a!=null&&(n[e++]=20,n[e++]=t.os),n[e]=20,e+=2,n[e++]=t.flag<<1|(i==null&&8),n[e++]=o&&8,n[e++]=255&t.compression,n[e++]=t.compression>>8;var f=new Date(t.mtime==null?Date.now():t.mtime),h=f.getFullYear()-1980;if(h<0||h>119)throw"date not in range 1980-2099";if(Qr(n,e,h<<25|f.getMonth()+1<<21|f.getDate()<<16|f.getHours()<<11|f.getMinutes()<<5|f.getSeconds()>>>1),e+=4,i!=null&&(Qr(n,e,t.crc),Qr(n,e+4,i),Qr(n,e+8,t.size)),Qr(n,e+12,l),Qr(n,e+14,d),e+=16,a!=null&&(Qr(n,e,u),Qr(n,e+6,t.attrs),Qr(n,e+10,a),e+=14),n.set(r,e),e+=l,d)for(var p in c){var m=c[p],g=m.length;Qr(n,e,+p),Qr(n,e+2,g),n.set(m,e+4),e+=4+g}return u&&(n.set(s,e),e+=u),e},nAe=function(n,e,t,r,o){Qr(n,e,101010256),Qr(n,e+8,t),Qr(n,e+10,t),Qr(n,e+12,r),Qr(n,e+16,o)};function rAe(n,e){e||(e={});var t={},r=[];HD(n,"",t,e);var o=0,i=0;for(var a in t){var s=t[a],l=s[0],c=s[1],u=c.level==0?0:8,d=(w=s1(a)).length,f=c.comment,h=f&&s1(f),p=h&&h.length,m=Wb(c.extra);if(d>65535)throw"filename too long";var g=u?Jve(l,c):l,_=g.length,A=Kve();A.p(l),r.push(GD(c,{size:l.length,crc:A.d(),c:g,f:w,m:h,u:d!=a.length||h&&f.length!=p,o,compression:u})),o+=30+d+m+_,i+=76+2*(d+m)+(p||0)+_}for(var y=new Uo(i+22),b=o,E=i-o,x=0;x<r.length;++x){var w=r[x];jD(y,w.o,w,w.f,w.u,w.c.length);var L=30+w.f.length+Wb(w.extra);y.set(w.c,w.o+L),jD(y,o,w,w.f,w.u,w.c.length,w.o,w.m),o+=16+L+(w.m?w.m.length:0)}return nAe(y,o,r.length,E,b),y}class QD{async parse(e,t={}){t=Object.assign({ar:{anchoring:{type:"plane"},planeAnchoring:{alignment:"horizontal"}},quickLookCompatible:!0,maxTextureSize:1024},t);const r={},o="model.usda";r[o]=null;let i=$D();i+=iAe(t);const a={},s={};e.traverseVisible((c=>{if(c.isMesh){const u=c.geometry,d=c.material;if(d.isMeshNodeMaterial||d.isMeshStandardMaterial){const f="geometries/Geometry_"+u.id+".usda";if(!(f in r)){const h=cAe(u);r[f]=sAe(h)}d.uuid in a||(a[d.uuid]=d),i+=lAe(c,u,d)}else console.warn("v3d.USDZExporter: Unsupported material type (USDZ only supports MeshNodeMaterial and MeshStandardMaterial)",c)}else c.isCamera&&(i+=vAe(c))})),i+=aAe(),i+=mAe(a,s,t.quickLookCompatible),r[o]=s1(i),i=null;for(const c in s){let u=s[c];u.isCompressedTexture===!0&&(u=n1(u));const d=oAe(u.image,u.flipY,t.maxTextureSize),f=await new Promise((h=>d.toBlob(h,"image/png",1)));r[`textures/Texture_${c}.png`]=new Uint8Array(await f.arrayBuffer())}let l=0;for(const c in r){const u=r[c];l+=34+c.length;const d=63&l;if(d!==4){const f=new Uint8Array(64-d);r[c]=[u,{extra:{12345:f}}]}l=u.length}return rAe(r,{level:0})}}function oAe(n,e,t){if(typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas||typeof ImageBitmap<"u"&&n instanceof ImageBitmap){const r=t/Math.max(n.width,n.height),o=document.createElement("canvas");o.width=n.width*Math.min(1,r),o.height=n.height*Math.min(1,r);const i=o.getContext("2d");return e===!0&&(i.translate(0,o.height),i.scale(1,-1)),i.drawImage(n,0,0,o.width,o.height),o}throw new Error("v3d.USDZExporter: No valid image data found. Unable to process texture.")}const lo=7;function $D(){return`#usda 1.0
(
    customLayerData = {
        string creator = "Verge3D"
    }
    defaultPrim = "Root"
    metersPerUnit = 1
    upAxis = "Y"
)

`}function iAe(n){return`def Xform "Root"
{
    def Scope "Scenes" (
        kind = "sceneLibrary"
    )
    {
        def Xform "Scene" (
            customData = {
                bool preliminary_collidesWithEnvironment = 0
                string sceneName = "Scene"
            }
            sceneName = "Scene"
        )
        {
        token preliminary:anchoring:type = "${n.ar.anchoring.type}"
        token preliminary:planeAnchoring:alignment = "${n.ar.planeAnchoring.alignment}"

`}function aAe(){return`
        }
    }
}

`}function sAe(n){let e=$D();return e+=n,s1(e)}function lAe(n,e,t){const r="Object_"+n.id,o=YD(n.matrixWorld);return n.matrixWorld.determinant()<0&&console.warn("v3d.USDZExporter: USDZ does not support negative scales",n),`def Xform "${r}" (
    prepend references = @./geometries/Geometry_${e.id}.usda@</Geometry>
    prepend apiSchemas = ["MaterialBindingAPI"]
)
{
    matrix4d xformOp:transform = ${o}
    uniform token[] xformOpOrder = ["xformOp:transform"]

    rel material:binding = </Materials/Material_${t.id}>
}

`}function YD(n){const e=n.elements;return`(${l1(e,0)}, ${l1(e,4)}, ${l1(e,8)}, ${l1(e,12)})`}function l1(n,e){return`(${n[e+0]}, ${n[e+1]}, ${n[e+2]}, ${n[e+3]})`}function cAe(n){return`
def "Geometry"
{
${uAe(n)}
}
`}function uAe(n){const e=n.attributes,t=e.position.count;return`
    def Mesh "Geometry"
    {
        int[] faceVertexCounts = [${dAe(n)}]
        int[] faceVertexIndices = [${fAe(n)}]
        normal3f[] normals = [${jb(e.normal,t)}] (
            interpolation = "vertex"
        )
        point3f[] points = [${jb(e.position,t)}]
${pAe(e)}
        uniform token subdivisionScheme = "none"
    }
`}function dAe(n){const e=n.index!==null?n.index.count:n.attributes.position.count;return Array(e/3).fill(3).join(", ")}function fAe(n){const e=n.index,t=[];if(e!==null)for(let r=0;r<e.count;r++)t.push(e.getX(r));else{const r=n.attributes.position.count;for(let o=0;o<r;o++)t.push(o)}return t.join(", ")}function jb(n,e){if(n===void 0)return console.warn("USDZExporter: Normals missing."),Array(e).fill("(0, 0, 0)").join(", ");const t=[];for(let r=0;r<n.count;r++){const o=n.getX(r),i=n.getY(r),a=n.getZ(r);t.push(`(${o.toPrecision(lo)}, ${i.toPrecision(lo)}, ${a.toPrecision(lo)})`)}return t.join(", ")}function hAe(n){const e=[];for(let t=0;t<n.count;t++){const r=n.getX(t),o=n.getY(t);e.push(`(${r.toPrecision(lo)}, ${1-o.toPrecision(lo)})`)}return e.join(", ")}function pAe(n){let e="";for(let r=0;r<4;r++){const o=r>0?r:"",i=n["uv"+o];i!==void 0&&(e+=`
        texCoord2f[] primvars:st${o} = [${hAe(i)}] (
            interpolation = "vertex"
        )`)}const t=n.color;return t!==void 0&&(e+=`
    color3f[] primvars:displayColor = [${jb(t,t.count)}] (
        interpolation = "vertex"
        )`),e}function mAe(n,e,t=!1){const r=[];for(const o in n){const i=n[o];r.push(gAe(i,e,t))}return`def "Materials"
{
${r.join("")}
}

`}function gAe(n,e,t=!1){const r="            ",o=[],i=[];function a(b,E,x){const w=b.source.id+(b.flipY?"_flipped":"");e[w]=b;const L={1e3:"repeat",1001:"clamp",1002:"mirror"},C=b.repeat.clone(),P=b.offset.clone(),D=b.rotation,Q=Math.sin(D),re=Math.cos(D);return P.y=1-P.y-C.y,t?(P.x=P.x/C.x,P.y=P.y/C.y,P.x+=Q/C.x,P.y+=re-1):(P.x+=Q*C.x,P.y+=(1-re)*C.y),`
        def Shader "PrimvarReader_${E}"
        {
            uniform token info:id = "UsdPrimvarReader_float2"
            float2 inputs:fallback = (0.0, 0.0)
            token inputs:varname = "st"
            float2 outputs:result
        }

        def Shader "Transform2d_${E}"
        {
            uniform token info:id = "UsdTransform2d"
            token inputs:in.connect = </Materials/Material_${n.id}/PrimvarReader_${E}.outputs:result>
            float inputs:rotation = ${(D*(180/Math.PI)).toFixed(lo)}
            float2 inputs:scale = ${qD(C)}
            float2 inputs:translation = ${qD(P)}
            float2 outputs:result
        }

        def Shader "Texture_${b.id}_${E}"
        {
            uniform token info:id = "UsdUVTexture"
            asset inputs:file = @textures/Texture_${w}.png@
            float2 inputs:st.connect = </Materials/Material_${n.id}/Transform2d_${E}.outputs:result>
            ${x!==void 0?"float4 inputs:scale = "+_Ae(x):""}
            token inputs:sourceColorSpace = "${b.encoding===3e3?"raw":"sRGB"}"
            token inputs:wrapS = "${L[b.wrapS]}"
            token inputs:wrapT = "${L[b.wrapT]}"
            float outputs:r
            float outputs:g
            float outputs:b
            float3 outputs:rgb
            ${n.transparent||n.alphaTest>0?"float outputs:a":""}
        }`}n.side===2&&console.warn("v3d.USDZExporter: USDZ does not support double sided materials",n);const s=n.isMeshNodeMaterial?n.getStandardProp("map"):n.map,l=n.isMeshNodeMaterial?n.getStandardProp("color"):n.color;s!==null?(o.push(`${r}color3f inputs:diffuseColor.connect = </Materials/Material_${n.id}/Texture_${s.id}_diffuse.outputs:rgb>`),n.transparent?o.push(`${r}float inputs:opacity.connect = </Materials/Material_${n.id}/Texture_${s.id}_diffuse.outputs:a>`):n.alphaTest>0&&(o.push(`${r}float inputs:opacity.connect = </Materials/Material_${n.id}/Texture_${s.id}_diffuse.outputs:a>`),o.push(`${r}float inputs:opacityThreshold = ${n.alphaTest}`)),i.push(a(s,"diffuse",l))):o.push(`${r}color3f inputs:diffuseColor = ${XD(l)}`);const c=n.isMeshNodeMaterial?n.getStandardProp("emissiveMap"):n.emissiveMap,u=n.isMeshNodeMaterial?n.getStandardProp("emissiveIntensity"):n.emissiveIntensity;let d=n.isMeshNodeMaterial?n.getStandardProp("emissive"):n.emissive;d=d.clone().multiplyScalar(u),c!==null?(o.push(`${r}color3f inputs:emissiveColor.connect = </Materials/Material_${n.id}/Texture_${c.id}_emissive.outputs:rgb>`),i.push(a(c,"emissive"))):d.getHex()>0&&o.push(`${r}color3f inputs:emissiveColor = ${XD(d)}`);const f=n.isMeshNodeMaterial?n.getStandardProp("normalMap"):n.normalMap;f!==null&&(o.push(`${r}normal3f inputs:normal.connect = </Materials/Material_${n.id}/Texture_${f.id}_normal.outputs:rgb>`),i.push(a(f,"normal")));const h=n.isMeshNodeMaterial?n.getStandardProp("aoMap"):n.aoMap;h!==null&&(o.push(`${r}float inputs:occlusion.connect = </Materials/Material_${n.id}/Texture_${h.id}_occlusion.outputs:r>`),i.push(a(h,"occlusion")));const p=n.isMeshNodeMaterial?n.getStandardProp("roughnessMap"):n.roughnessMap,m=n.isMeshNodeMaterial?n.getStandardProp("roughness"):n.roughness;p!==null&&m===1?(o.push(`${r}float inputs:roughness.connect = </Materials/Material_${n.id}/Texture_${p.id}_roughness.outputs:g>`),i.push(a(p,"roughness"))):o.push(`${r}float inputs:roughness = ${m}`);const g=n.isMeshNodeMaterial?n.getStandardProp("metalnessMap"):n.metalnessMap,_=n.isMeshNodeMaterial?n.getStandardProp("metalness"):n.metalness;g!==null&&_===1?(o.push(`${r}float inputs:metallic.connect = </Materials/Material_${n.id}/Texture_${g.id}_metallic.outputs:b>`),i.push(a(g,"metallic"))):o.push(`${r}float inputs:metallic = ${_}`);const A=n.isMeshNodeMaterial?n.getStandardProp("alphaMap"):n.alphaMap,y=n.isMeshNodeMaterial?n.getStandardProp("opacity"):n.opacity;return A!==null?(o.push(`${r}float inputs:opacity.connect = </Materials/Material_${n.id}/Texture_${A.id}_opacity.outputs:r>`),o.push(`${r}float inputs:opacityThreshold = 0.0001`),i.push(a(A,"opacity"))):o.push(`${r}float inputs:opacity = ${y}`),n.isMeshPhysicalMaterial&&(o.push(`${r}float inputs:clearcoat = ${n.clearcoat}`),o.push(`${r}float inputs:clearcoatRoughness = ${n.clearcoatRoughness}`),o.push(`${r}float inputs:ior = ${n.ior}`)),`
    def Material "Material_${n.id}"
    {
        def Shader "PreviewSurface"
        {
            uniform token info:id = "UsdPreviewSurface"
${o.join(`
`)}
            int inputs:useSpecularWorkflow = 0
            token outputs:surface
        }

        token outputs:surface.connect = </Materials/Material_${n.id}/PreviewSurface.outputs:surface>

${i.join(`
`)}

    }
`}function XD(n){return`(${n.r}, ${n.g}, ${n.b})`}function _Ae(n){return`(${n.r}, ${n.g}, ${n.b}, 1.0)`}function qD(n){return`(${n.x}, ${n.y})`}function vAe(n){const e=n.name?n.name:"Camera_"+n.id,t=YD(n.matrixWorld);return n.matrixWorld.determinant()<0&&console.warn("v3d.USDZExporter: USDZ does not support negative scales",n),n.isOrthographicCamera?`def Camera "${e}"
        {
            matrix4d xformOp:transform = ${t}
            uniform token[] xformOpOrder = ["xformOp:transform"]

            float2 clippingRange = (${n.near.toPrecision(lo)}, ${n.far.toPrecision(lo)})
            float horizontalAperture = ${(10*(Math.abs(n.left)+Math.abs(n.right))).toPrecision(lo)}
            float verticalAperture = ${(10*(Math.abs(n.top)+Math.abs(n.bottom))).toPrecision(lo)}
            token projection = "orthographic"
        }

    `:`def Camera "${e}"
        {
            matrix4d xformOp:transform = ${t}
            uniform token[] xformOpOrder = ["xformOp:transform"]

            float2 clippingRange = (${n.near.toPrecision(lo)}, ${n.far.toPrecision(lo)})
            float focalLength = ${n.getFocalLength().toPrecision(lo)}
            float focusDistance = ${n.focus.toPrecision(lo)}
            float horizontalAperture = ${n.getFilmWidth().toPrecision(lo)}
            token projection = "perspective"
            float verticalAperture = ${n.getFilmHeight().toPrecision(lo)}
        }

    `}class Qb extends ti{constructor(e,t){super(),this.object=e,this.domElement=t!==void 0?t:document,this.enabled=!0,this.allowMouseOverIframes=!1,this.iframePointerEventsStatus=new WeakMap}lockIframeEvents(){const e=document.getElementsByTagName("iframe");for(let t=0;t<e.length;t++){const r=e[t];this.iframePointerEventsStatus.set(r,r.style.pointerEvents),r.style.pointerEvents="none"}}unlockIframeEvents(){const e=document.getElementsByTagName("iframe");for(let t=0;t<e.length;t++){const r=e[t],o=this.iframePointerEventsStatus.get(r)||"auto";r.style.pointerEvents=o}}}var tt={BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CTRL:17,ALT:18,PAUSE_BREAK:19,CAPS_LOCK:20,ESCAPE:27,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT_ARROW:37,UP_ARROW:38,RIGHT_ARROW:39,DOWN_ARROW:40,INSERT:45,DELETE:46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,LEFT_WINDOW_KEY:91,RIGHT_WINDOW_KEY:92,SELECT_KEY:93,NUMPAD_0:96,NUMPAD_1:97,NUMPAD_2:98,NUMPAD_3:99,NUMPAD_4:100,NUMPAD_5:101,NUMPAD_6:102,NUMPAD_7:103,NUMPAD_8:104,NUMPAD_9:105,MULTIPLY:106,ADD:107,SUBTRACT:109,DECIMAL_POINT:110,DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,NUM_LOCK:144,SCROLL_LOCK:145,SEMI_COLON:186,EQUAL_SIGN:187,COMMA:188,DASH:189,PERIOD:190,FORWARD_SLASH:191,GRAVE_ACCENT:192,OPEN_BRACKET:219,BACK_SLASH:220,CLOSE_BRAKET:221,SINGLE_QUOTE:222};class $b{constructor(e,t=null){this.isKeyDown={};for(const r in tt)this.isKeyDown[tt[r]]=!1;if(this.onKeyDown=null,this.onKeyUp=null,this._domElement=e,this._keydownCb=(function(r){this.isKeyDown[r.keyCode]=!0,this.onKeyDown&&this.onKeyDown(r)}).bind(this),this._keyupCb=(function(r){this.isKeyDown[r.keyCode]=!1,this.onKeyUp&&this.onKeyUp(r)}).bind(this),this._mobileControlTouchStartCb=(function(r){this._keydownCb({keyCode:tt.W})}).bind(this),this._mobileControlTouchEndCb=(function(r){this._keyupCb({keyCode:tt.W})}).bind(this),this._domElement.addEventListener("keydown",this._keydownCb,!1),this._domElement.addEventListener("keyup",this._keyupCb,!1),t&&nr.isTouchDevice()){const r=document.createElement("div");r.className="v3d-mobile-forward",t.appendChild(r),r.addEventListener("touchstart",this._mobileControlTouchStartCb),r.addEventListener("touchend",this._mobileControlTouchEndCb),this._mobileForwardElement=r}}dispose(){this._domElement.removeEventListener("keydown",this._keydownCb,!1),this._domElement.removeEventListener("keyup",this._keyupCb,!1),this._mobileForwardElement&&(this._mobileForwardElement.removeEventListener("touchstart",this._mobileControlTouchStartCb),this._mobileForwardElement.removeEventListener("touchend",this._mobileControlTouchEndCb),this._mobileForwardElement.remove())}}const c1=new N,u1=new N,Yb=new N;class d1{constructor(){this.posFrom=new N,this.targetFrom=new N,this.posTo=new N,this.targetTo=new N,this.sphericalFrom=new xa,this.sphericalTo=new xa,this.finishCb=function(){},this.movementType=0,this.active=!1,this.duration=0,this.clock=new Ca}setup({posFrom:e=new N,targetFrom:t=new N,posTo:r=new N,targetTo:o=new N,finishCb:i=function(){},movementType:a=0}){if(this.posFrom.copy(e),this.targetFrom.copy(t),this.posTo.copy(r),this.targetTo.copy(o),this.finishCb=i,this.movementType=a,this.movementType===1){c1.copy(this.posFrom).sub(this.targetFrom),this.sphericalFrom.setFromVector3(c1),c1.copy(this.posTo).sub(this.targetTo),this.sphericalTo.setFromVector3(c1);const s=sh(this.sphericalFrom.theta);let l=sh(this.sphericalTo.theta);const c=Math.abs(s-l);c>Math.PI&&(l=s+Math.sign(s-l)*(2*Math.PI-c)),this.sphericalFrom.theta=s,this.sphericalTo.theta=l}return this}start(e){this.active=!0,this.duration=e,this.clock.start()}update(e=function(t,r,o){}){let t=this.clock.getElapsedTime()/this.duration;if(t=t2(t,0,1),Yb.lerpVectors(this.targetFrom,this.targetTo,t),this.movementType===0)u1.lerpVectors(this.posFrom,this.posTo,t);else if(this.movementType===1){const r=Aa(this.sphericalFrom.radius,this.sphericalTo.radius,t),o=Aa(this.sphericalFrom.phi,this.sphericalTo.phi,t),i=Aa(this.sphericalFrom.theta,this.sphericalTo.theta,t);u1.setFromSphericalCoords(r,o,i),u1.add(Yb)}e(t,u1,Yb),t>=1&&(this.active=!1,this.finishCb())}}const KD=new N;class Xb{constructor(){this.posFrom=new N,this.targetFrom=new N,this.posTo=new N,this.targetTo=new N,this.zoomFrom=0,this.zoomTo=0,this.finishCb=function(){},this.active=!1,this.duration=0,this.clock=new Ca}setup({posFrom:e=new N,targetFrom:t=new N,posTo:r=new N,targetTo:o=new N,zoomFrom:i=0,zoomTo:a=0,finishCb:s=function(){}}){return this.posFrom.copy(e),this.targetFrom.copy(t),this.posTo.copy(r),this.targetTo.copy(o),this.zoomFrom=i,this.zoomTo=a,this.finishCb=s,this}start(e){this.active=!0,this.duration=e,this.clock.start()}update(e=function(t,r,o){}){let t=this.clock.getElapsedTime()/this.duration;t=t2(t,0,1),KD.lerpVectors(this.targetFrom,this.targetTo,t);let r=Aa(this.zoomFrom,this.zoomTo,t);e(t,KD,r),t>=1&&(this.active=!1,this.finishCb())}}const jt={minDistance:0,maxDistance:1/0,minZoom:0,maxZoom:1/0,minPolarAngle:0,maxPolarAngle:Math.PI,minAzimuthAngle:-1/0,maxAzimuthAngle:1/0,autoRotate:!1,autoRotateSpeed:2,enablePan:!0,panInertia:.05,panSpeed:1.3,panSpeedKey:15,screenSpacePanning:!0,enableRotate:!0,rotateInertia:.05,rotateInertiaTouch:.05,rotateSpeed:1.2,rotateSpeedTouch:.7,enableZoom:!0,enableCtrlZoom:!1,zoomInertia:.05,zoomInertiaTouch:.05,zoomSpeed:5,zoomSpeedTouch:1,enableDamping:!0,enableTurnover:!1,enableKeys:!0},AAe=new N(0,1,0),yAe=new It().setFromAxisAngle(new N(0,0,1),Math.PI),cr={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY_PAN:4},ZD=1e-6,ui=new N,JD=new N,bAe=new It,xAe=new It,e6={type:"change"},qb={type:"start"},Kb={type:"end"};class Zb extends Qb{constructor(e,t){super(e,t),this.domElement.style.touchAction="none",this.targetObj=new kt,this.minDistance=jt.minDistance,this.maxDistance=jt.maxDistance,this.minZoom=jt.minZoom,this.maxZoom=jt.maxZoom,this.minPolarAngle=jt.minPolarAngle,this.maxPolarAngle=jt.maxPolarAngle,this.minAzimuthAngle=jt.minAzimuthAngle,this.maxAzimuthAngle=jt.maxAzimuthAngle,this.enableDamping=jt.enableDamping,this.enableZoom=jt.enableZoom,this.enableCtrlZoom=jt.enableCtrlZoom,this.zoomSpeed=jt.zoomSpeed,this.zoomSpeedTouch=jt.zoomSpeedTouch,this.zoomInertia=jt.zoomInertia,this.zoomInertiaTouch=jt.zoomInertiaTouch,this.enableRotate=jt.enableRotate,this.rotateSpeed=jt.rotateSpeed,this.rotateSpeedTouch=jt.rotateSpeedTouch,this.rotateInertia=jt.rotateInertia,this.rotateInertiaTouch=jt.rotateInertiaTouch,this.enablePan=jt.enablePan,this.panSpeed=jt.panSpeed,this.screenSpacePanning=jt.screenSpacePanning,this.panSpeedKey=jt.panSpeedKey,this.panInertia=jt.panInertia,this.autoRotate=jt.autoRotate,this.autoRotateSpeed=jt.autoRotateSpeed,this.enableTurnover=jt.enableTurnover,this.enableKeys=jt.enableKeys,this.mouseButtons={ROTATE:ql.LEFT,ZOOM:ql.MIDDLE,PAN:ql.RIGHT},this.target0=this.targetObj.position.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,Object.defineProperty(this,"inTween",{get:()=>re.active||G.active,set(z){re.active=z}}),this.getPolarAngle=function(){return i.phi},this.getAzimuthalAngle=function(){return i.theta},this.getDistance=function(){return this.object.position.distanceTo(this.targetObj.position)},this.saveState=function(){r.targetObj.updateWorldMatrix(!0,!1),r.target0.setFromMatrixPosition(r.targetObj.matrixWorld),r.position0.copy(r.object.position),r.zoom0=r.object.zoom},this.forceMouseUp=function(){oe()},this.reset=function(){r.targetObj.updateWorldMatrix(!0,!1);const z=ui.copy(r.target0);r.targetObj.worldToLocal(z),r.targetObj.position.add(z),r.object.position.copy(r.position0),r.object.zoom=r.zoom0,r.object.updateProjectionMatrix(),r.dispatchEvent(e6),r.update(),o=cr.NONE},this.update=(function(){const z=new N,v=new N,M=new N,S=new It;let I=!1,J=!1;return function(){const $=r.object.position;if(r.targetObj.updateWorldMatrix(!0,!1),re.active)re.update((function(B,V,Y){if($.copy(V),z.copy(Y),r.object.lookAt(z),B>=1){a.set(0,0,0),l.set(0,0,0),s=1,E.set(0,0);for(let le in u)u[le]=0;m.set(0,0),Q.getDelta()}}));else if(G.active)G.update((function(B,V,Y){if(z.copy(V),r.object.lookAt(z),r.object.zoom=Y,r.object.updateProjectionMatrix(),B>=1){a.set(0,0,0),l.set(0,0,0),s=1,E.set(0,0);for(let le in u)u[le]=0;m.set(0,0),Q.getDelta()}}));else{z.setFromMatrixPosition(r.targetObj.matrixWorld),v.copy($).sub(z);const B=bAe.setFromUnitVectors(r.object.up,AAe),V=xAe.copy(B).invert();if(v.applyQuaternion(B),i.setFromVector3(v),r.autoRotate&&o===cr.NONE&&ee(2*Math.PI/60/60*r.autoRotateSpeed),i.theta+=a.theta,i.phi+=a.phi,r.enableTurnover){I&&(i.phi-=2*a.phi),J!=I&&o==cr.NONE&&(J=I),J&&(i.theta-=2*a.theta);const Y=i.phi;(Y<=0||Y>=Math.PI)&&(I=!I,i.theta+=Math.PI,i.phi=Y>0?2*Math.PI-Y:Math.abs(Y))}else isFinite(r.minAzimuthAngle)&&isFinite(r.maxAzimuthAngle)&&(i.theta=r2(i.theta,r.minAzimuthAngle,r.maxAzimuthAngle)),i.phi=Math.max(r.minPolarAngle,Math.min(r.maxPolarAngle,i.phi));i.makeSafe(),r.object.isPerspectiveCamera?(i.radius*=s,i.radius=Math.max(r.minDistance,Math.min(r.maxDistance,i.radius))):r.object.isOrthographicCamera&&(r.object.zoom/=s,r.object.zoom=Math.max(r.minZoom,Math.min(r.maxZoom,r.object.zoom)),r.object.updateProjectionMatrix()),z.add(l),v.setFromSpherical(i),v.applyQuaternion(V),$.copy(z).add(v),r.object.lookAt(z),I&&(r.enableTurnover?r.object.quaternion.multiply(yAe):I=!1),a.set(0,0,0),l.set(0,0,0),(function(){const Y=Q.getDelta();let le,me;p.copy(m),m.x=r.enableDamping?Cr(m.x,0,Y,_,.1):0,m.y=r.enableDamping?Cr(m.y,0,Y,_,.1):0,p.sub(m),(function(){const fe=r.domElement===document?r.domElement.body:r.domElement,te=fe.clientWidth,de=fe.clientHeight;if(!(!te||!de)){ee(2*Math.PI*p.x/te*g),we=2*Math.PI*p.y/de*g,a.phi-=we;var we}})(),b.copy(E),E.x=r.enableDamping?Cr(E.x,0,Y,r.panInertia,.1):0,E.y=r.enableDamping?Cr(E.y,0,Y,r.panInertia,.1):0,b.sub(E),b.multiplyScalar(r.panSpeed);for(let fe in u)d.isKeyDown[fe]?le=u[fe]=1:(me=u[fe],u[fe]=Cr(u[fe],0,Y,r.panInertia,.1),le=me-u[fe]),r.enabled&&r.enableKeys&&r.enablePan&&(le*=60*Y*r.panSpeedKey,fe==tt.A||fe==tt.LEFT_ARROW?b.x+=le:fe==tt.D||fe==tt.RIGHT_ARROW?b.x-=le:fe==tt.W||fe==tt.UP_ARROW?b.y+=le:fe!=tt.S&&fe!=tt.DOWN_ARROW||(b.y-=le));(function(fe,te){const de=r.domElement===document?r.domElement.body:r.domElement,we=de.clientWidth,Ie=de.clientHeight;if(!(!we||!Ie))if(r.object.isPerspectiveCamera){r.targetObj.updateWorldMatrix(!0,!1);const Ne=ui.setFromMatrixPosition(r.targetObj.matrixWorld),He=r.object.position;let je=JD.copy(He).sub(Ne).length();je*=Math.tan(r.object.fov/2*ss),H(2*fe*je/Ie,r.object.matrix),T(2*te*je/Ie,r.object.matrix)}else r.object.isOrthographicCamera?(H(fe*(r.object.right-r.object.left)/r.object.zoom/we,r.object.matrix),T(te*(r.object.top-r.object.bottom)/r.object.zoom/Ie,r.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),r.enablePan=!1)})(b.x,b.y),s=C,C=r.enableDamping?Cr(C,1,Y,D,.001):1,s/=C})()}return r.targetObj.position.copy(z),!!(c||M.distanceToSquared(r.object.position)>ZD||8*(1-S.dot(r.object.quaternion))>ZD)&&(r.dispatchEvent(e6),M.copy(r.object.position),S.copy(r.object.quaternion),c=!1,!0)}})(),this.dispose=function(){r.domElement.removeEventListener("contextmenu",U),r.domElement.removeEventListener("mousedown",ae),r.domElement.removeEventListener("wheel",F),r.domElement.removeEventListener("touchstart",k),r.domElement.removeEventListener("touchend",j),r.domElement.removeEventListener("touchmove",q),document.removeEventListener("mousemove",ne),document.removeEventListener("mouseup",oe),document.removeEventListener("mouseleave",oe),d.dispose()},this.tween=(function(){return function(v,M,S,I,J){r.targetObj.updateWorldMatrix(!0,!1);const $=ui.setFromMatrixPosition(r.targetObj.matrixWorld);r.object.parent&&(v=JD.copy(v),r.object.parent.worldToLocal(v)),v.manhattanDistanceTo(r.object.position)<1e-5&&M.manhattanDistanceTo($)<1e-5?I!==void 0&&I():re.setup({posFrom:r.object.position,targetFrom:$,posTo:v,targetTo:M,finishCb:I,movementType:J}).start(S)}})(),this.tweenZoomTo=function(z,v,M,S){if(!r.object.isOrthographicCamera)return void console.warn("v3d.OrbitControls: .tweenZoomTo() works only for orthographic camera");r.targetObj.updateWorldMatrix(!0,!1);const I=ui.setFromMatrixPosition(r.targetObj.matrixWorld);G.setup({zoomFrom:r.object.zoom,targetFrom:I,zoomTo:v,targetTo:z,finishCb:S}).start(M)};const r=this;let o=cr.NONE;const i=new xa,a=new xa;let s=1;const l=new N;let c=!1;const u={};u[tt.W]=u[tt.S]=u[tt.A]=u[tt.D]=u[tt.UP_ARROW]=u[tt.DOWN_ARROW]=u[tt.LEFT_ARROW]=u[tt.RIGHT_ARROW]=0;const d=new $b(window);d.onKeyDown=function(z){r.enableKeys?z.keyCode in u&&(u[z.keyCode]=1):d.isKeyDown[z.keyCode]=!1};const f=new be,h=new be,p=new be,m=new be;let g=1,_=1;const A=new be,y=new be,b=new be,E=new be,x=new be,w=new be,L=new be;let C=1,P=1,D=1;const Q=new Ca,re=new d1,G=new Xb;function se(z=1){return Math.pow(.95,P*z)}function ee(z){a.theta-=z}function ie(z,v){h.set(z,v),m.add(h).sub(f),f.copy(h)}function H(z,v){ui.setFromMatrixColumn(v,0),ui.multiplyScalar(-z),l.add(ui)}function T(z,v){r.screenSpacePanning===!0?ui.setFromMatrixColumn(v,1):(ui.setFromMatrixColumn(v,0),ui.crossVectors(r.object.up,ui)),ui.multiplyScalar(z),l.add(ui)}function R(z){r.object.isPerspectiveCamera?C/=z:r.object.isOrthographicCamera?(C/=z,c=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),r.enableZoom=!1)}function O(z){r.object.isPerspectiveCamera?C*=z:r.object.isOrthographicCamera?(C*=z,c=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),r.enableZoom=!1)}function W(z){(function(v,M){y.set(v,M),E.add(y).sub(A),A.copy(y)})(z.clientX,z.clientY)}function ae(z){if(r.enabled!==!1){switch(z.preventDefault(),z.button){case r.mouseButtons.ROTATE:if(r.enableRotate===!1)return;(function(v){f.set(v.clientX,v.clientY)})(z),o=cr.ROTATE;break;case r.mouseButtons.ZOOM:case r.mouseButtons.PAN:if(r.enablePan===!1)return;(function(v){A.set(v.clientX,v.clientY)})(z),o=cr.PAN}o!==cr.NONE&&(document.addEventListener("mousemove",ne),document.addEventListener("mouseup",oe),document.addEventListener("mouseleave",oe),r.allowMouseOverIframes&&r.lockIframeEvents(),r.dispatchEvent(qb))}}function ne(z){if(r.enabled!==!1)switch(z.preventDefault(),o){case cr.ROTATE:if(r.enableRotate===!1)return;(function(v){ie(v.clientX,v.clientY),g=r.rotateSpeed,_=r.rotateInertia})(z);break;case cr.DOLLY:if(r.enableZoom===!1)return;(function(v){w.set(v.clientX,v.clientY),L.subVectors(w,x),L.y>0?R(se()):L.y<0&&O(se()),x.copy(w),r.update()})(z);break;case cr.PAN:if(r.enablePan===!1)return;W(z)}}function oe(z){r.enabled!==!1&&(document.removeEventListener("mousemove",ne),document.removeEventListener("mouseup",oe),document.removeEventListener("mouseleave",oe),r.allowMouseOverIframes&&r.unlockIframeEvents(),r.dispatchEvent(Kb),o=cr.NONE)}function F(z){r.enabled===!1||r.enableZoom===!1||o!==cr.NONE&&o!==cr.ROTATE||r.enableCtrlZoom&&!z.ctrlKey||(z.preventDefault(),z.stopPropagation(),r.dispatchEvent(qb),(function(v){P=r.zoomSpeed,D=r.zoomInertia,v.deltaY<0?O(se(Math.abs(v.deltaY)/100)):v.deltaY>0&&R(se(Math.abs(v.deltaY)/100)),r.update()})(z),r.dispatchEvent(Kb))}function k(z){if(r.enabled!==!1){switch(z.touches.length){case 1:if(r.enableRotate===!1)return;(function(v){f.set(v.touches[0].pageX,v.touches[0].pageY)})(z),o=cr.TOUCH_ROTATE;break;case 2:if(r.enableZoom===!1&&r.enablePan===!1)return;(function(v){if(r.enableZoom){P=r.zoomSpeedTouch,D=r.zoomInertiaTouch;let M=v.touches[0].pageX-v.touches[1].pageX,S=v.touches[0].pageY-v.touches[1].pageY,I=Math.sqrt(M*M+S*S);x.set(0,I)}if(r.enablePan){let M=.5*(v.touches[0].pageX+v.touches[1].pageX),S=.5*(v.touches[0].pageY+v.touches[1].pageY);A.set(M,S)}r.update()})(z),o=cr.TOUCH_DOLLY_PAN;break;default:o=cr.NONE}o!==cr.NONE&&r.dispatchEvent(qb)}}function q(z){if(r.enabled!==!1)switch(z.preventDefault(),z.touches.length){case 1:if(r.enableRotate===!1||o!==cr.TOUCH_ROTATE)return;(function(v){ie(v.touches[0].pageX,v.touches[0].pageY),g=r.rotateSpeedTouch,_=r.rotateInertiaTouch})(z);break;case 2:if(r.enableZoom===!1&&r.enablePan===!1||o!==cr.TOUCH_DOLLY_PAN)return;(function(v){let M=v.touches[0].pageX-v.touches[1].pageX,S=v.touches[0].pageY-v.touches[1].pageY,I=Math.sqrt(M*M+S*S);w.set(0,I),L.subVectors(w,x),x.copy(w);let J=.5*(v.touches[0].pageX+v.touches[1].pageX),$=.5*(v.touches[0].pageY+v.touches[1].pageY);y.set(J,$),b.subVectors(y,A),A.copy(y),r.enableZoom&&Math.abs(L.length())>Math.abs(b.length())&&(L.y>0?O(se()):L.y<0&&R(se())),r.enablePan&&Math.abs(L.length())<Math.abs(b.length())&&E.add(b),r.update()})(z);break;default:o=cr.NONE}}function j(z){r.enabled!==!1&&(r.dispatchEvent(Kb),o=cr.NONE)}function U(z){r.enabled!==!1&&z.preventDefault()}r.domElement.addEventListener("contextmenu",U),r.domElement.addEventListener("mousedown",ae),r.domElement.addEventListener("wheel",F,{passive:!1}),r.domElement.addEventListener("touchstart",k,{passive:!0}),r.domElement.addEventListener("touchend",j),r.domElement.addEventListener("touchmove",q,{passive:!1}),this.update()}}const or={enableCollisions:!0,gazeLevel:1.8,enablePan:!0,panInertia:.05,panSpeedKey:.15,enableRotate:!0,rotateInertia:.05,rotateInertiaTouch:.05,rotateSpeed:.9,rotateSpeedTouch:.75,storyHeight:3,enableZoom:!0,enableCtrlZoom:!1,zoomInertia:.05,zoomSpeed:30,zoomSpeedKey:.2,enableDamping:!0,enableKeys:!0},t6=new be,n6=new N,Jb=new N,r6=new N;class e3 extends Qb{constructor(t,r){super(t,r);Ls(this,"_raycaster",new _0(new N,new N(0,-1,0)));Ls(this,"_onCollisionMesh",!1);Ls(this,"_lastPosition",new N);Ls(this,"_enableCollisions",or.enableCollisions);Ls(this,"_nearestPoint",new N);Ls(this,"_lastIntersection",new N);Ls(this,"_toMeshSpaceMatrix",new Ue);Ls(this,"_ppTarget",{point:new N,distance:0,faceIndex:0});const o=this;this.screen={left:0,top:0,width:0,height:0},this.enableDamping=or.enableDamping,this.enableRotate=or.enableRotate,this.rotateSpeed=or.rotateSpeed,this.rotateSpeedTouch=or.rotateSpeedTouch,this.rotateInertia=or.rotateInertia,this.rotateInertiaTouch=or.rotateInertiaTouch,this.enableZoom=or.enableZoom,this.enableCtrlZoom=or.enableCtrlZoom,this.zoomSpeed=or.zoomSpeed,this.zoomSpeedKey=or.zoomSpeedKey,this.zoomInertia=or.zoomInertia,this.enablePan=or.enablePan,this.panSpeedKey=or.panSpeedKey,this.panInertia=or.panInertia,this.enableKeys=or.enableKeys,this.gazeLevel=or.gazeLevel,this.storyHeight=or.storyHeight,this.collisionMeshes=[],this._raycaster.params.checkVisibility=!1;let i=!1;Object.defineProperty(this,"enablePointerLock",{get:()=>i,set(M){i!==M&&(i=M,z())}}),Object.defineProperty(this,"inTween",{get:()=>re.active||G.active});const a=new Ca,s=1e-6,l=new N,c=new N,u=new N,d=new It,f=new N,h={};let p;h[tt.W]=h[tt.S]=h[tt.A]=h[tt.D]=h[tt.UP_ARROW]=h[tt.DOWN_ARROW]=h[tt.LEFT_ARROW]=h[tt.RIGHT_ARROW]=0;let m=!1;const g=new xa,_=new xa,A=new be;let y=1,b=1;const E=new be,x=new be;let w=0,L=0,C=1,P=1;const D=new be,Q=new be,re=new d1,G=new Xb,se={type:"change"},ee={type:"start"},ie={type:"end"};this.handleResize=function(){if(this.domElement===document)this.screen.left=0,this.screen.top=0,this.screen.width=window.innerWidth,this.screen.height=window.innerHeight;else{const M=this.domElement.getBoundingClientRect(),S=this.domElement.ownerDocument.documentElement;this.screen.left=M.left+window.pageXOffset-S.clientLeft,this.screen.top=M.top+window.pageYOffset-S.clientTop,this.screen.width=M.width,this.screen.height=M.height}},this.handleEvent=function(M){typeof this[M.type]=="function"&&this[M.type](M)};const H=function(M,S){return t6.set((M-.5*o.screen.width-o.screen.left)/(.5*o.screen.width),(o.screen.height+2*(o.screen.top-S))/o.screen.width)};function T(M){o.enabled!==!1&&(M.preventDefault(),o.enableRotate!==!1&&(x.copy(H(M.pageX,M.pageY).negate()),E.copy(x),m=!0,document.addEventListener("mousemove",R),document.addEventListener("mouseup",O),document.addEventListener("mouseleave",O),o.allowMouseOverIframes&&o.lockIframeEvents(),o.dispatchEvent(ee)))}function R(M){if(o.enabled!==!1&&(M.preventDefault(),m)){if(o.enableRotate===!1)return;x.copy(H(M.pageX,M.pageY).negate()),A.add(x).sub(E),E.copy(x),y=o.rotateSpeed,b=o.rotateInertia}}function O(M){o.enabled!==!1&&(M.preventDefault(),m=!1,document.removeEventListener("mousemove",R),document.removeEventListener("mouseup",O),document.removeEventListener("mouseleave",O),o.allowMouseOverIframes&&o.unlockIframeEvents(),o.dispatchEvent(ie))}function W(M){if(o.enabled!==!1&&o.enableZoom!==!1&&(!o.enableCtrlZoom||M.ctrlKey)){switch(M.preventDefault(),M.stopPropagation(),M.deltaMode){case 2:L-=.025*M.deltaY,C=o.zoomSpeed,P=o.zoomInertia;break;case 1:L-=.01*M.deltaY,C=o.zoomSpeed,P=o.zoomInertia;break;default:L-=25e-5*M.deltaY,C=o.zoomSpeed,P=o.zoomInertia}o.dispatchEvent(ee),o.dispatchEvent(ie)}}function ae(M){if(o.enabled===!1)return;const S=M.targetTouches[0];m=!0,x.copy(H(S.pageX,S.pageY).negate()),E.copy(x),o.dispatchEvent(ee)}function ne(M){if(o.enabled===!1)return;M.preventDefault();const S=M.targetTouches[0];o.enableRotate!==!1&&(x.copy(H(S.pageX,S.pageY).negate()),A.add(x).sub(E),E.copy(x),y=o.rotateSpeedTouch,b=o.rotateInertiaTouch)}function oe(M){if(o.enabled!==!1){if(M.targetTouches.length===0)m=!1;else{if(o.enableRotate===!1)return;m=!0,x.copy(H(M.targetTouches[0].pageX,M.targetTouches[0].pageY).negate()),E.copy(x)}o.dispatchEvent(ie)}}function F(M){o.enabled!==!1&&M.preventDefault()}function k(M){o.domElement.requestPointerLock()}function q(M){document.pointerLockElement===o.domElement?(o.dispatchEvent(ee),document.addEventListener("mousemove",U)):(o.dispatchEvent(ie),document.removeEventListener("mousemove",U))}function j(M){console.error("Pointer lock failed")}function U(M){var S,I;M.preventDefault(),o.enabled&&o.enableRotate&&(A.add((S=M.movementX,I=M.movementY,t6.set(S,-I).multiplyScalar(2/o.screen.width)).negate()),y=o.rotateSpeed,b=o.rotateInertia)}function z(){v(),o.domElement.addEventListener("contextmenu",F),o.enablePointerLock?(o.domElement.addEventListener("click",k),document.addEventListener("pointerlockchange",q),document.addEventListener("pointerlockerror",j)):o.domElement.addEventListener("mousedown",T),o.domElement.addEventListener("wheel",W,{passive:!1}),o.domElement.addEventListener("touchstart",ae,{passive:!0}),o.domElement.addEventListener("touchend",oe),o.domElement.addEventListener("touchmove",ne,{passive:!1}),p=new $b(window,o.domElement.parentElement),p.onKeyDown=function(M){o.enableKeys?M.keyCode in h&&(h[M.keyCode]=1):p.isKeyDown[M.keyCode]=!1}}function v(){o.domElement.removeEventListener("contextmenu",F),o.domElement.removeEventListener("click",k),document.removeEventListener("pointerlockchange",q),document.removeEventListener("pointerlockerror",j),document.removeEventListener("mousemove",U),o.domElement.removeEventListener("mousedown",T),o.domElement.removeEventListener("wheel",W),o.domElement.removeEventListener("touchstart",ae),o.domElement.removeEventListener("touchend",oe),o.domElement.removeEventListener("touchmove",ne),document.removeEventListener("mousemove",R),document.removeEventListener("mouseup",O),document.removeEventListener("mouseleave",O),p&&p.dispose()}this.update=function(){re.active?re.update((function(S,I,J){if(o.object.position.copy(I),o.object.lookAt(J),S>=1){_.set(0,0,0),A.set(0,0),w=0,L=0,D.set(0,0),Q.set(0,0);for(const $ in h)h[$]=0;a.getDelta()}})):G.active?G.update((function(S,I,J){if(o.object.lookAt(I),o.object.zoom=J,o.object.updateProjectionMatrix(),S>=1){_.set(0,0,0),A.set(0,0),w=0,L=0,D.set(0,0),Q.set(0,0);for(let $ in h)h[$]=0;a.getDelta()}})):(o.object.matrixAutoUpdate&&o.object.updateMatrix(),o.object.getLocalDirection(f),g.setFromVector3(f),g.theta+=_.theta*y,g.phi+=_.phi*y,g.makeSafe(),f.setFromSpherical(g),l.copy(f).add(o.object.position),o.object.lookAtLocal(l),o.object.isPerspectiveCamera?o.object.position.addScaledVector(f,w):o.object.isOrthographicCamera&&(o.object.zoom*=1+.15*w,o.object.updateProjectionMatrix()),c.copy(f).cross(o.object.up).setLength(-D.x),c.add(u.copy(o.object.up).setLength(D.y)),o.object.position.add(c),(function(){const S=a.getDelta();_.set(_.radius,A.y,A.x),A.x=o.enableDamping?Cr(A.x,0,S,b,.001):0,A.y=o.enableDamping?Cr(A.y,0,S,b,.001):0,_.set(_.radius,_.phi-A.y,_.theta-A.x),D.copy(Q),Q.x=o.enableDamping?Cr(Q.x,0,S,1,.001):0,Q.y=o.enableDamping?Cr(Q.y,0,S,1,.001):0,D.sub(Q),D.multiplyScalar(1),w=L,L=o.enableDamping?Cr(L,0,S,P,.001):0,w-=L,w*=C;for(const I in h){const J=I==tt.A||I==tt.LEFT_ARROW||I==tt.D||I==tt.RIGHT_ARROW,$=I==tt.W||I==tt.UP_ARROW||I==tt.S||I==tt.DOWN_ARROW,B=J?o.panInertia:o.zoomInertia,V=J?o.panSpeedKey:o.zoomSpeedKey,Y=.001;let le;if(p.isKeyDown[I])le=h[I]=1;else{const me=h[I];h[I]=Cr(h[I],0,S,B,Y),le=me-h[I]}o.enabled&&o.enableKeys&&(J&&!o.enablePan||$&&!o.enableZoom||(le*=60*S*V,I==tt.A||I==tt.LEFT_ARROW?D.x+=le:I==tt.D||I==tt.RIGHT_ARROW?D.x-=le:I==tt.W||I==tt.UP_ARROW?w+=le:I!=tt.S&&I!=tt.DOWN_ARROW||(w-=le)))}})()),this._handleCollisions();let M=!1;this._lastPosition.distanceToSquared(o.object.position)>s&&(this._lastPosition.copy(o.object.position),M=!0),d.dot(o.object.quaternion)<1-s&&(d.copy(o.object.quaternion),M=!0),M&&o.dispatchEvent(se)},this.forceMouseUp=function(){O({preventDefault:function(){}})},this.dispose=v,this.releaseFromCollision=function(){this._onCollisionMesh=!1},this.tween=function(M,S,I,J,$){o.object.parent&&(M=n6.copy(M),o.object.parent.worldToLocal(M));const B=o.object.getWorldPosition(Jb),V=r6.subVectors(S,B).length(),Y=o.object.getWorldDirection(r6).multiplyScalar(V).add(B),le=1e-5;M.manhattanDistanceTo(o.object.position)<le&&S.manhattanDistanceTo(Y)<le?J!==void 0&&J():re.setup({posFrom:o.object.position,targetFrom:Y,posTo:M,targetTo:S,finishCb:J,movementType:$}).start(I)},this.tweenZoomTo=function(M,S,I,J){if(!o.object.isOrthographicCamera)return void console.warn("v3d.FirstPersonControls: .tweenZoomTo() works only for orthographic camera");const $=o.object.getWorldPosition(n6),B=Jb.subVectors(M,$).length(),V=o.object.getWorldDirection(Jb).multiplyScalar(B).add($);G.setup({zoomFrom:o.object.zoom,targetFrom:V,zoomTo:S,targetTo:M,finishCb:J}).start(I)},z(),this.handleResize(),this.update()}set enableCollisions(t){this._enableCollisions=t,t||this.releaseFromCollision()}get enableCollisions(){return this._enableCollisions}_handleCollisions(){if(!this._enableCollisions||this.collisionMeshes.length==0)return;this._raycaster.ray.origin.copy(this.object.position),this._raycaster.far=this.storyHeight;const t=this._raycaster.intersectObjects(this.collisionMeshes,!1);if(t.length>0){const r=t[0];this.object.position.y=r.point.y+this.gazeLevel,this._onCollisionMesh=!0}else if(this._onCollisionMesh){let r=1/0;for(const o of this.collisionMeshes){if(!o.geometry.boundsTree){console.warn("v3d.FirstPersonControls: no bounding tree found on "+o.name);continue}this._toMeshSpaceMatrix.copy(o.matrixWorld).invert(),this._lastIntersection.copy(this.object.position),this._lastIntersection.y-=this.gazeLevel,this._lastIntersection.applyMatrix4(this._toMeshSpaceMatrix);const i=this._ppTarget;o.geometry.boundsTree.closestPointToPoint(this._lastIntersection,i),i.distance<r&&(this._nearestPoint.copy(i.point),this._nearestPoint.applyMatrix4(o.matrixWorld),r=i.distance)}isFinite(r)?(this.object.position.copy(this._nearestPoint),this.object.position.y+=this.gazeLevel):this.object.position.copy(this._lastPosition)}}}const Gn={panInertia:.05,panInertiaTouch:.05,panSpeed:20,panSpeedKey:.4,panSpeedTouch:15,rotateInertia:.05,rotateInertiaTouch:.05,rotateSpeed:.9,rotateSpeedTouch:.75,zoomInertia:.05,zoomInertiaTouch:.05,zoomSpeed:150,zoomSpeedKey:.5,zoomSpeedTouch:20,enableDamping:!0,enableRotate:!0,enableZoom:!0,enableCtrlZoom:!1,enablePan:!0,enableKeys:!0,minAzimuthAngle:-1/0,maxAzimuthAngle:1/0,minPolarAngle:0,maxPolarAngle:Math.PI};class t3 extends Qb{constructor(e,t){super(e,t);var r=this,o=-1,i=0,a=1,s=2,l=3,c=4;this.screen={left:0,top:0,width:0,height:0},this.enableDamping=Gn.enableDamping,this.enableRotate=Gn.enableRotate,this.rotateSpeed=Gn.rotateSpeed,this.rotateSpeedTouch=Gn.rotateSpeedTouch,this.rotateInertia=Gn.rotateInertia,this.rotateInertiaTouch=Gn.rotateInertiaTouch,this.enableZoom=Gn.enableZoom,this.enableCtrlZoom=Gn.enableCtrlZoom,this.zoomSpeed=Gn.zoomSpeed,this.zoomSpeedKey=Gn.zoomSpeedKey,this.zoomSpeedTouch=Gn.zoomSpeedTouch,this.zoomInertia=Gn.zoomInertia,this.zoomInertiaTouch=Gn.zoomInertiaTouch,this.enablePan=Gn.enablePan,this.panSpeed=Gn.panSpeed,this.panSpeedKey=Gn.panSpeedKey,this.panSpeedTouch=Gn.panSpeedTouch,this.panInertia=Gn.panInertia,this.panInertiaTouch=Gn.panInertiaTouch,this.enableKeys=Gn.enableKeys,this.minAzimuthAngle=Gn.minAzimuthAngle,this.maxAzimuthAngle=Gn.maxAzimuthAngle,this.minPolarAngle=Gn.minPolarAngle,this.maxPolarAngle=Gn.maxPolarAngle,this.mouseButtons={ROTATE:ql.LEFT,ZOOM:ql.MIDDLE,PAN:ql.RIGHT},Object.defineProperty(this,"inTween",{get:()=>oe.active||F.active});var u=new Ca,d=1e-6,f=new N,h=new N,p=new N,m=new be,g=new N,_=new It,A=o,y=new N,b={};b[tt.W]=b[tt.S]=b[tt.A]=b[tt.D]=b[tt.UP_ARROW]=b[tt.DOWN_ARROW]=b[tt.LEFT_ARROW]=b[tt.RIGHT_ARROW]=0;var E=new $b(window);E.onKeyDown=function(te){r.enableKeys?te.keyCode in b&&(b[te.keyCode]=1):E.isKeyDown[te.keyCode]=!1};var x=new xa,w=new xa,L=new be,C=1,P=1,D=new be,Q=new be,re=0,G=0,se=1,ee=1,ie=0,H=0,T=new be,R=new be,O=1,W=1,ae=new be,ne=new be,oe=new d1;const F=new Xb;var k={type:"change"},q={type:"start"},j={type:"end"};this.handleResize=function(){if(this.domElement===document)this.screen.left=0,this.screen.top=0,this.screen.width=window.innerWidth,this.screen.height=window.innerHeight;else{var te=this.domElement.getBoundingClientRect(),de=this.domElement.ownerDocument.documentElement;this.screen.left=te.left+window.pageXOffset-de.clientLeft,this.screen.top=te.top+window.pageYOffset-de.clientTop,this.screen.width=te.width,this.screen.height=te.height}},this.handleEvent=function(te){typeof this[te.type]=="function"&&this[te.type](te)};var U,z,v,M,S=(U=new be,function(te,de){return U.set((te-r.screen.left)/r.screen.width,(de-r.screen.top)/r.screen.height),U}),I=(function(){var te=new be;return function(de,we){return te.set((de-.5*r.screen.width-r.screen.left)/(.5*r.screen.width),(r.screen.height+2*(r.screen.top-we))/r.screen.width),te}})();function J(te){if(r.enabled!==!1){switch(te.preventDefault(),te.button){case r.mouseButtons.ROTATE:if(r.enableRotate===!1)return;Q.copy(I(te.pageX,te.pageY).negate()),D.copy(Q),A=i;break;case r.mouseButtons.ZOOM:case r.mouseButtons.PAN:if(r.enablePan===!1)return;ae.copy(S(te.pageX,te.pageY)),ne.copy(ae),A=te.button==r.mouseButtons.PAN?s:a}document.addEventListener("mousemove",$),document.addEventListener("mouseup",B),document.addEventListener("mouseleave",B),r.allowMouseOverIframes&&r.lockIframeEvents(),r.dispatchEvent(q)}}function $(te){if(r.enabled!==!1){if(te.preventDefault(),A===i){if(r.enableRotate===!1)return;Q.copy(I(te.pageX,te.pageY).negate()),L.add(Q).sub(D),D.copy(Q),C=r.rotateSpeed,P=r.rotateInertia}else if(A===s||A===a){if(r.enablePan===!1)return;ne.copy(S(te.pageX,te.pageY)),R.add(ne).sub(ae),ae.copy(ne),O=r.panSpeed,W=r.panInertia}}}function B(te){r.enabled!==!1&&(te.preventDefault(),A=o,document.removeEventListener("mousemove",$),document.removeEventListener("mouseup",B),document.removeEventListener("mouseleave",B),r.allowMouseOverIframes&&r.unlockIframeEvents(),r.dispatchEvent(j))}function V(te){if(r.enabled!==!1&&r.enableZoom!==!1&&(!r.enableCtrlZoom||te.ctrlKey)){switch(te.preventDefault(),te.stopPropagation(),te.deltaMode){case 2:G-=.025*te.deltaY,se=r.zoomSpeed,ee=r.zoomInertia;break;case 1:G-=.01*te.deltaY,se=r.zoomSpeed,ee=r.zoomInertia;break;default:G-=25e-5*te.deltaY,se=r.zoomSpeed,ee=r.zoomInertia}r.dispatchEvent(q),r.dispatchEvent(j)}}function Y(te){if(r.enabled!==!1){var de=te.touches[0],we=te.touches[1];if(te.touches.length===1){if(r.enableRotate===!1)return;A=l,Q.copy(I(de.pageX,de.pageY).negate()),D.copy(Q)}else{if(r.enableZoom===!1&&r.enablePan===!1)return;if(A=c,r.enableZoom){var Ie=S(de.pageX-we.pageX,de.pageY-we.pageY);ie=H=Ie.length()}if(r.enablePan){var Ne=S((de.pageX+we.pageX)/2,(de.pageY+we.pageY)/2);ae.copy(Ne),ne.copy(ae)}}r.dispatchEvent(q)}}function le(te){if(r.enabled!==!1){te.preventDefault();var de=te.touches[0],we=te.touches[1];if(te.touches.length===1){if(r.enableRotate===!1)return;Q.copy(I(de.pageX,de.pageY).negate()),L.add(Q).sub(D),D.copy(Q),C=r.rotateSpeedTouch,P=r.rotateInertiaTouch}else{if(r.enableZoom===!1&&r.enablePan===!1)return;var Ie=S(de.pageX-we.pageX,de.pageY-we.pageY),Ne=(H=Ie.length())-ie;ie=H;var He=S((de.pageX+we.pageX)/2,(de.pageY+we.pageY)/2);ne.copy(He);var je=m.subVectors(ne,ae),ct=je.length();ae.copy(ne),r.enableZoom&&Math.abs(Ne)>Math.abs(ct)&&(G+=Ne,se=r.zoomSpeedTouch,ee=r.zoomInertiaTouch),r.enablePan&&Math.abs(Ne)<=Math.abs(ct)&&(R.add(je),O=r.panSpeedTouch,W=r.panInertiaTouch)}}}function me(te){if(r.enabled!==!1){switch(te.touches.length){case 0:A=o;break;case 1:if(r.enableRotate===!1)return;A=l,Q.copy(I(te.touches[0].pageX,te.touches[0].pageY).negate()),D.copy(Q)}r.dispatchEvent(j)}}function fe(te){r.enabled!==!1&&te.preventDefault()}this.update=(new N,function(){oe.active?oe.update((function(de,we,Ie){if(r.object.position.copy(we),r.object.lookAt(Ie),de>=1){for(var Ne in w.set(0,0,0),L.set(0,0),re=0,G=0,T.set(0,0),R.set(0,0),b)b[Ne]=0;u.getDelta()}})):F.active?F.update((function(de,we,Ie){if(r.object.lookAt(we),r.object.zoom=Ie,r.object.updateProjectionMatrix(),de>=1){w.set(0,0,0),L.set(0,0),re=0,G=0,T.set(0,0),R.set(0,0);for(let Ne in b)b[Ne]=0;u.getDelta()}})):(r.object.getLocalDirection(y),x.setFromVector3(y),x.theta+=w.theta*C,x.phi+=w.phi*C,x.theta=Math.max(r.minAzimuthAngle,Math.min(r.maxAzimuthAngle,x.theta)),x.phi=Math.max(r.minPolarAngle,Math.min(r.maxPolarAngle,x.phi)),x.makeSafe(),y.setFromSpherical(x),f.copy(y).add(r.object.position),r.object.lookAtLocal(f),r.object.isPerspectiveCamera?r.object.position.addScaledVector(y,re):r.object.isOrthographicCamera&&(r.object.zoom*=1+.15*re,r.object.updateProjectionMatrix()),h.copy(y).cross(r.object.up).setLength(-T.x),h.add(p.copy(r.object.up).setLength(T.y)),r.object.position.add(h),(function(){var de=u.getDelta();for(var we in w.set(w.radius,L.y,L.x),L.x=r.enableDamping?Cr(L.x,0,de,P,.001):0,L.y=r.enableDamping?Cr(L.y,0,de,P,.001):0,w.set(w.radius,w.phi-L.y,w.theta-L.x),T.copy(R),R.x=r.enableDamping?Cr(R.x,0,de,W,.001):0,R.y=r.enableDamping?Cr(R.y,0,de,W,.001):0,T.sub(R),T.multiplyScalar(O),re=G,G=r.enableDamping?Cr(G,0,de,ee,.001):0,re-=G,re*=se,b){var Ie=we==tt.A||we==tt.LEFT_ARROW||we==tt.D||we==tt.RIGHT_ARROW,Ne=we==tt.W||we==tt.UP_ARROW||we==tt.S||we==tt.DOWN_ARROW,He=Ie?r.panInertia:r.zoomInertia,je=Ie?r.panSpeedKey:r.zoomSpeedKey;if(E.isKeyDown[we])var ct=b[we]=1;else{var Vt=b[we];b[we]=Cr(b[we],0,de,He,.001),ct=Vt-b[we]}r.enabled&&r.enableKeys&&(Ie&&!r.enablePan||Ne&&!r.enableZoom||(ct*=60*de*je,we==tt.A||we==tt.LEFT_ARROW?T.x+=ct:we==tt.D||we==tt.RIGHT_ARROW?T.x-=ct:we==tt.W||we==tt.UP_ARROW?re+=ct:we!=tt.S&&we!=tt.DOWN_ARROW||(re-=ct)))}})());var te=!1;g.distanceToSquared(r.object.position)>d&&(g.copy(r.object.position),te=!0),_.dot(r.object.quaternion)<1-d&&(_.copy(r.object.quaternion),te=!0),te&&r.dispatchEvent(k)}),this.forceMouseUp=function(){B({preventDefault:function(){}})},this.dispose=function(){this.domElement.removeEventListener("contextmenu",fe),this.domElement.removeEventListener("mousedown",J),this.domElement.removeEventListener("wheel",V),this.domElement.removeEventListener("touchstart",Y),this.domElement.removeEventListener("touchend",me),this.domElement.removeEventListener("touchmove",le),document.removeEventListener("mousemove",$),document.removeEventListener("mouseup",B),document.removeEventListener("mouseleave",B),E.dispose()},this.tween=(z=new N,v=new N,M=new N,function(te,de,we,Ie,Ne){r.object.parent&&(te=z.copy(te),r.object.parent.worldToLocal(te));var He=r.object.getWorldPosition(v),je=M.subVectors(de,He).length(),ct=r.object.getWorldDirection(M).multiplyScalar(je).add(He),Vt=1e-5;te.manhattanDistanceTo(r.object.position)<Vt&&de.manhattanDistanceTo(ct)<Vt?Ie!==void 0&&Ie():oe.setup({posFrom:r.object.position,targetFrom:ct,posTo:te,targetTo:de,finishCb:Ie,movementType:Ne}).start(we)}),this.tweenZoomTo=(function(){const te=new N,de=new N;return function(we,Ie,Ne,He){if(!r.object.isOrthographicCamera)return void console.warn("v3d.FlyingControls: .tweenZoomTo() works only for orthographic camera");const je=r.object.getWorldPosition(te);let ct=de.subVectors(we,je).length();const Vt=r.object.getWorldDirection(de).multiplyScalar(ct).add(je);F.setup({zoomFrom:r.object.zoom,targetFrom:Vt,zoomTo:Ie,targetTo:we,finishCb:He}).start(Ne)}})(),this.domElement.addEventListener("contextmenu",fe),this.domElement.addEventListener("mousedown",J),this.domElement.addEventListener("wheel",V,{passive:!1}),this.domElement.addEventListener("touchstart",Y,{passive:!0}),this.domElement.addEventListener("touchend",me),this.domElement.addEventListener("touchmove",le,{passive:!1}),this.handleResize(),this.update()}}const EAe={ORBIT:jt,FIRST_PERSON:or,FLYING:Gn};class n3{constructor(e="ORBIT",t=!0,r=1,o=1){this.type=e,this.enablePan=t,this.enableZoom=!0,this.enableCtrlZoom=!1,this.enableKeys=!0,this.rotateSpeed=r,this.moveSpeed=o,this.orbitMinDistance=jt.minDistance,this.orbitMaxDistance=jt.maxDistance,this.orbitMinZoom=jt.minZoom,this.orbitMaxZoom=jt.maxZoom,this.orbitMinPolarAngle=jt.minPolarAngle,this.orbitMaxPolarAngle=jt.maxPolarAngle,this.orbitMinAzimuthAngle=jt.minAzimuthAngle,this.orbitMaxAzimuthAngle=jt.maxAzimuthAngle,this.orbitEnableTurnover=jt.enableTurnover,this.orbitTarget=new kt,this.enableCollisions=or.enableCollisions,this.collisionMaterial=null,this.gazeLevel=or.gazeLevel,this.storyHeight=or.storyHeight,this.enablePointerLock=!1}copy(e){return this.type=e.type,this.enablePan=e.enablePan,this.enableZoom=e.enableZoom,this.enableCtrlZoom=e.enableCtrlZoom,this.enableKeys=e.enableKeys,this.rotateSpeed=e.rotateSpeed,this.moveSpeed=e.moveSpeed,this.orbitMinDistance=e.orbitMinDistance,this.orbitMaxDistance=e.orbitMaxDistance,this.orbitMinZoom=e.orbitMinZoom,this.orbitMaxZoom=e.orbitMaxZoom,this.orbitMinPolarAngle=e.orbitMinPolarAngle,this.orbitMaxPolarAngle=e.orbitMaxPolarAngle,this.orbitMinAzimuthAngle=e.orbitMinAzimuthAngle,this.orbitMaxAzimuthAngle=e.orbitMaxAzimuthAngle,this.orbitEnableTurnover=e.orbitEnableTurnover,this.orbitTarget=e.orbitTarget,this.enableCollisions=e.enableCollisions,this.collisionMaterial=e.collisionMaterial,this.gazeLevel=e.gazeLevel,this.storyHeight=e.storyHeight,this.enablePointerLock=e.enablePointerLock,this}clone(){return new this.constructor().copy(this)}assignToControls(e,t){const r=EAe[this.type];switch(this.type){case"ORBIT":e.targetObj=this.orbitTarget,e.minDistance=this.orbitMinDistance,e.maxDistance=this.orbitMaxDistance,e.minZoom=this.orbitMinZoom,e.maxZoom=this.orbitMaxZoom,e.minPolarAngle=this.orbitMinPolarAngle,e.maxPolarAngle=this.orbitMaxPolarAngle,e.minAzimuthAngle=this.orbitMinAzimuthAngle,e.maxAzimuthAngle=this.orbitMaxAzimuthAngle,e.enableTurnover=this.orbitEnableTurnover;break;case"FLYING":e.panSpeedTouch=r.panSpeedTouch*this.moveSpeed,e.zoomSpeedKey=r.zoomSpeedKey*this.moveSpeed;break;case"FIRST_PERSON":e.enableCollisions=this.enableCollisions,e.gazeLevel=this.gazeLevel,e.storyHeight=this.storyHeight,e.zoomSpeedKey=r.zoomSpeedKey*this.moveSpeed,e.enablePointerLock=this.enablePointerLock;const o=this;e.collisionMeshes=[],t.traverse((function(i){const a=i.material;a&&o.collisionMaterial&&a.name==o.collisionMaterial.name&&e.collisionMeshes.push(i)}));break;default:return void console.error("ControlSettings: unsupported control type")}e.enablePan=this.enablePan,e.enableZoom=this.enableZoom,e.enableCtrlZoom=this.enableCtrlZoom,e.enableKeys=this.enableKeys,e.rotateSpeed=r.rotateSpeed*this.rotateSpeed,e.rotateSpeedTouch=r.rotateSpeedTouch*this.rotateSpeed,e.panSpeed=r.panSpeed*this.moveSpeed,e.panSpeedKey=r.panSpeedKey*this.moveSpeed,e.zoomSpeed=r.zoomSpeed*this.moveSpeed,e.zoomSpeedTouch=r.zoomSpeedTouch*this.moveSpeed}}function CAe(){throw new Error("BufferGeometryUtils: computeTangents renamed to computeMikkTSpaceTangents.")}function SAe(n,e,t=!0){if(!e||!e.isReady)throw new Error("BufferGeometryUtils: Initialized MikkTSpace library required.");if(!n.hasAttribute("position")||!n.hasAttribute("normal")||!n.hasAttribute("uv"))throw new Error('BufferGeometryUtils: Tangents require "position", "normal", and "uv" attributes.');function r(a){if(a.normalized){const s=new Float32Array(a.getCount()*a.itemSize);for(let l=0,c=0;l<a.getCount();l++)s[c++]=a.getX(l),s[c++]=a.getY(l),a.itemSize>2&&(s[c++]=a.getZ(l));return s}return a.array instanceof Float32Array?a.array:new Float32Array(a.array)}const o=n.index?n.toNonIndexed():n,i=e.generateTangents(r(o.attributes.position),r(o.attributes.normal),r(o.attributes.uv));if(t)for(let a=3;a<i.length;a+=4)i[a]*=-1;return o.setAttribute("tangent",new Xe(i,4)),n!==o&&n.copy(o),n}function o6(n,e=!1){const t=n[0].index!==null,r=new Set(Object.keys(n[0].attributes)),o=new Set(Object.keys(n[0].morphAttributes)),i={},a={},s=n[0].morphTargetsRelative,l=new At;let c=0;for(let u=0;u<n.length;++u){const d=n[u];let f=0;if(t!==(d.index!==null))return console.error("v3d.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+u+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(const h in d.attributes){if(!r.has(h))return console.error("v3d.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+u+'. All geometries must have compatible attributes; make sure "'+h+'" attribute exists among all geometries, or in none of them.'),null;i[h]===void 0&&(i[h]=[]),i[h].push(d.attributes[h]),f++}if(f!==r.size)return console.error("v3d.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+u+". Make sure all geometries have the same number of attributes."),null;if(s!==d.morphTargetsRelative)return console.error("v3d.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+u+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(const h in d.morphAttributes){if(!o.has(h))return console.error("v3d.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+u+".  .morphAttributes must be consistent throughout all geometries."),null;a[h]===void 0&&(a[h]=[]),a[h].push(d.morphAttributes[h])}if(e){let h;if(t)h=d.index.count;else{if(d.attributes.position===void 0)return console.error("v3d.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+u+". The geometry must have either an index or a position attribute"),null;h=d.attributes.position.count}l.addGroup(c,h,u),c+=h}}if(t){let u=0;const d=[];for(let f=0;f<n.length;++f){const h=n[f].index;for(let p=0;p<h.count;++p)d.push(h.getX(p)+u);u+=n[f].attributes.position.count}l.setIndex(d)}for(const u in i){const d=r3(i[u]);if(!d)return console.error("v3d.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+u+" attribute."),null;l.setAttribute(u,d)}for(const u in a){const d=a[u][0].length;if(d===0)break;l.morphAttributes=l.morphAttributes||{},l.morphAttributes[u]=[];for(let f=0;f<d;++f){const h=[];for(let m=0;m<a[u].length;++m)h.push(a[u][m][f]);const p=r3(h);if(!p)return console.error("v3d.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+u+" morphAttribute."),null;l.morphAttributes[u].push(p)}}return l}function r3(n){let e,t,r,o=-1,i=0;for(let c=0;c<n.length;++c){const u=n[c];if(e===void 0&&(e=u.array.constructor),e!==u.array.constructor)return console.error("v3d.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(t===void 0&&(t=u.itemSize),t!==u.itemSize)return console.error("v3d.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(r===void 0&&(r=u.normalized),r!==u.normalized)return console.error("v3d.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;if(o===-1&&(o=u.gpuType),o!==u.gpuType)return console.error("v3d.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.gpuType must be consistent across matching attributes."),null;i+=u.array.length}const a=new e(i),s=new Xe(a,t,r);let l=0;for(let c=0;c<n.length;++c)a.set(n[c].array,l),l+=n[c].array.length;return o!==void 0&&(s.gpuType=o),s}function f1(n){return n.isInstancedBufferAttribute?new InstancedBufferAttribute().copy(n):new Xe().copy(n)}function wAe(){console.error("v3d.BufferGeometryUtils.interleaveAttributes has been removed")}function MAe(){console.error("v3d.BufferGeometryUtils.deinterleaveAttribute has been removed")}function TAe(){console.error("v3d.BufferGeometryUtils.deinterleaveGeometry has been removed")}function IAe(n){let e=0;for(const r in n.attributes){const o=n.getAttribute(r);e+=o.count*o.itemSize*o.array.BYTES_PER_ELEMENT}const t=n.getIndex();return e+=t?t.count*t.itemSize*t.array.BYTES_PER_ELEMENT:0,e}function RAe(n,e=1e-4){e=Math.max(e,Number.EPSILON);const t={},r=n.getIndex(),o=n.getAttribute("position"),i=r?r.count:o.count;let a=0;const s=Object.keys(n.attributes),l={},c={},u=[],d=["getX","getY","getZ","getW"],f=["setX","setY","setZ","setW"];for(let g=0,_=s.length;g<_;g++){const A=s[g],y=n.attributes[A];l[A]=new Xe(new y.array.constructor(y.count*y.itemSize),y.itemSize,y.normalized);const b=n.morphAttributes[A];b&&(c[A]=new Xe(new b.array.constructor(b.count*b.itemSize),b.itemSize,b.normalized))}const h=Math.log10(1/e),p=Math.pow(10,h);for(let g=0;g<i;g++){const _=r?r.getX(g):g;let A="";for(let y=0,b=s.length;y<b;y++){const E=s[y],x=n.getAttribute(E),w=x.itemSize;for(let L=0;L<w;L++)A+=~~(x[d[L]](_)*p)+","}if(A in t)u.push(t[A]);else{for(let y=0,b=s.length;y<b;y++){const E=s[y],x=n.getAttribute(E),w=n.morphAttributes[E],L=x.itemSize,C=l[E],P=c[E];for(let D=0;D<L;D++){const Q=d[D],re=f[D];if(C[re](a,x[Q](_)),w)for(let G=0,se=w.length;G<se;G++)P[G][re](a,w[G][Q](_))}}t[A]=a,u.push(a),a++}}const m=n.clone();for(const g in n.attributes){const _=l[g];if(m.setAttribute(g,new Xe(_.array.slice(0,a*_.itemSize),_.itemSize,_.normalized)),g in c)for(let A=0;A<c[g].length;A++){const y=c[g][A];m.morphAttributes[g][A]=new Xe(y.array.slice(0,a*y.itemSize),y.itemSize,y.normalized)}}return m.setIndex(u),m}function LAe(n,e){if(e===0)return console.warn("v3d.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),n;if(e===2||e===1){let t=n.getIndex();if(t===null){const a=[],s=n.getAttribute("position");if(s===void 0)return console.error("v3d.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),n;for(let l=0;l<s.count;l++)a.push(l);n.setIndex(a),t=n.getIndex()}const r=t.count-2,o=[];if(e===2)for(let a=1;a<=r;a++)o.push(t.getX(0)),o.push(t.getX(a)),o.push(t.getX(a+1));else for(let a=0;a<r;a++)a%2==0?(o.push(t.getX(a)),o.push(t.getX(a+1)),o.push(t.getX(a+2))):(o.push(t.getX(a+2)),o.push(t.getX(a+1)),o.push(t.getX(a)));o.length/3!==r&&console.error("v3d.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const i=n.clone();return i.setIndex(o),i.clearGroups(),i}return console.error("v3d.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),n}function PAe(n){if(n.geometry.isBufferGeometry!==!0)return console.error("v3d.BufferGeometryUtils: Geometry is not of type BufferGeometry."),null;const e=new N,t=new N,r=new N,o=new N,i=new N,a=new N,s=new N,l=new N,c=new N;function u(ie,H,T,R,O,W,ae,ne){e.fromBufferAttribute(H,O),t.fromBufferAttribute(H,W),r.fromBufferAttribute(H,ae);const oe=ie.morphTargetInfluences;if(T&&oe){s.set(0,0,0),l.set(0,0,0),c.set(0,0,0);for(let F=0,k=T.length;F<k;F++){const q=oe[F],j=T[F];q!==0&&(o.fromBufferAttribute(j,O),i.fromBufferAttribute(j,W),a.fromBufferAttribute(j,ae),R?(s.addScaledVector(o,q),l.addScaledVector(i,q),c.addScaledVector(a,q)):(s.addScaledVector(o.sub(e),q),l.addScaledVector(i.sub(t),q),c.addScaledVector(a.sub(r),q)))}e.add(s),t.add(l),r.add(c)}ie.isSkinnedMesh&&(ie.boneTransform(O,e),ie.boneTransform(W,t),ie.boneTransform(ae,r)),ne[3*O+0]=e.x,ne[3*O+1]=e.y,ne[3*O+2]=e.z,ne[3*W+0]=t.x,ne[3*W+1]=t.y,ne[3*W+2]=t.z,ne[3*ae+0]=r.x,ne[3*ae+1]=r.y,ne[3*ae+2]=r.z}const d=n.geometry,f=n.material;let h,p,m;const g=d.index,_=d.attributes.position,A=d.morphAttributes.position,y=d.morphTargetsRelative,b=d.attributes.normal,E=d.morphAttributes.position,x=d.groups,w=d.drawRange;let L,C,P,D,Q,re,G;const se=new Float32Array(_.count*_.itemSize),ee=new Float32Array(b.count*b.itemSize);if(g!==null)if(Array.isArray(f))for(L=0,P=x.length;L<P;L++)for(Q=x[L],re=Math.max(Q.start,w.start),G=Math.min(Q.start+Q.count,w.start+w.count),C=re,D=G;C<D;C+=3)h=g.getX(C),p=g.getX(C+1),m=g.getX(C+2),u(n,_,A,y,h,p,m,se),u(n,b,E,y,h,p,m,ee);else for(re=Math.max(0,w.start),G=Math.min(g.count,w.start+w.count),L=re,P=G;L<P;L+=3)h=g.getX(L),p=g.getX(L+1),m=g.getX(L+2),u(n,_,A,y,h,p,m,se),u(n,b,E,y,h,p,m,ee);else if(Array.isArray(f))for(L=0,P=x.length;L<P;L++)for(Q=x[L],re=Math.max(Q.start,w.start),G=Math.min(Q.start+Q.count,w.start+w.count),C=re,D=G;C<D;C+=3)h=C,p=C+1,m=C+2,u(n,_,A,y,h,p,m,se),u(n,b,E,y,h,p,m,ee);else for(re=Math.max(0,w.start),G=Math.min(_.count,w.start+w.count),L=re,P=G;L<P;L+=3)h=L,p=L+1,m=L+2,u(n,_,A,y,h,p,m,se),u(n,b,E,y,h,p,m,ee);return{positionAttribute:_,normalAttribute:b,morphedPositionAttribute:new mt(se,3),morphedNormalAttribute:new mt(ee,3)}}function i6(n){if(n.groups.length===0)return console.warn("v3d.BufferGeometryUtils.mergeGroups(): No groups are defined. Nothing to merge."),n;let e=n.groups;if(e=e.sort(((a,s)=>a.materialIndex!==s.materialIndex?a.materialIndex-s.materialIndex:a.start-s.start)),n.getIndex()===null){const a=n.getAttribute("position"),s=[];for(let l=0;l<a.count;l+=3)s.push(l,l+1,l+2);n.setIndex(s)}const t=n.getIndex(),r=[];for(let a=0;a<e.length;a++){const s=e[a],l=s.start,c=l+s.count;for(let u=l;u<c;u++)r.push(t.getX(u))}n.dispose(),n.setIndex(r);let o=0;for(let a=0;a<e.length;a++){const s=e[a];s.start=o,o+=s.count}let i=e[0];n.groups=[i];for(let a=1;a<e.length;a++){const s=e[a];i.materialIndex===s.materialIndex?i.count+=s.count:(i=s,n.groups.push(i))}return n}function DAe(n,e=Math.PI/3){const t=Math.cos(e),r=100*(1+1e-10),o=[new N,new N,new N],i=new N,a=new N,s=new N,l=new N;function c(m){return`${~~(m.x*r)},${~~(m.y*r)},${~~(m.z*r)}`}const u=n.toNonIndexed(),d=u.attributes.position,f={};for(let m=0,g=d.count/3;m<g;m++){const _=3*m,A=o[0].fromBufferAttribute(d,_+0),y=o[1].fromBufferAttribute(d,_+1),b=o[2].fromBufferAttribute(d,_+2);i.subVectors(b,y),a.subVectors(A,y);const E=new N().crossVectors(i,a).normalize();for(let x=0;x<3;x++){const w=c(o[x]);w in f||(f[w]=[]),f[w].push(E)}}const h=new Float32Array(3*d.count),p=new Xe(h,3,!1);for(let m=0,g=d.count/3;m<g;m++){const _=3*m,A=o[0].fromBufferAttribute(d,_+0),y=o[1].fromBufferAttribute(d,_+1),b=o[2].fromBufferAttribute(d,_+2);i.subVectors(b,y),a.subVectors(A,y),s.crossVectors(i,a).normalize();for(let E=0;E<3;E++){const x=f[c(o[E])];l.set(0,0,0);for(let w=0,L=x.length;w<L;w++){const C=x[w];s.dot(C)>t&&l.add(C)}l.normalize(),p.setXYZ(_+E,l.x,l.y,l.z)}}return u.setAttribute("normal",p),u}function BAe(n,e){const t={};for(let r=0;r<n.length;r++){const o=n[r],i=o.geometry,a=o.material;let s=[];s.push(a.name),s.push(o.visible),s.push(o.disableChildRendering),s.push(o.castShadow),s.push(o.receiveShadow),s.push(o.renderOrder),s=s.concat(o.groupNames);const l=Object.keys(i.attributes);s=s.concat(l);const c=Object.keys(i.morphAttributes);s=s.concat(c),s=s.join(),t[s]=t[s]||[],t[s].indexOf(o)==-1&&t[s].push(o)}for(let r in t){const o=t[r];if(o.length<2)continue;const i=[];let a=!0;for(let d=0;d<o.length;d++){const f=o[d],h=f.geometry;f.updateWorldMatrix(!0,!1),i.push(h.clone().applyMatrix4(f.matrixWorld)),h.boundsTree||(a=!1)}const s=o[0],l=s.material,c=`${l.name}_x${o.length}_batch`,u=this.mergeBufferGeometries(i);if(u){const d=new Mt(u,l);d.name=c,d.visible=s.visible,d.disableChildRendering=s.disableChildRendering,d.castShadow=s.castShadow,d.receiveShadow=s.receiveShadow,d.renderOrder=s.renderOrder,d.groupNames=s.groupNames;for(let f=0;f<o.length;f++){const h=o[f];h.parent.remove(h)}a&&u.computeBoundsTree({verbose:!1}),console.log("Adding batch object:",c),e.add(d)}else console.warn("Failed to create batch object:",c)}}var NAe=Object.freeze({__proto__:null,batchMeshes:BAe,computeMikkTSpaceTangents:SAe,computeMorphedAttributes:PAe,computeTangents:CAe,deepCloneAttribute:f1,deinterleaveAttribute:MAe,deinterleaveGeometry:TAe,estimateBytesUsed:IAe,interleaveAttributes:wAe,mergeBufferAttributes:r3,mergeBufferGeometries:o6,mergeGroups:i6,mergeVertices:RAe,toCreasedNormals:DAe,toTrianglesDrawMode:LAe});const a6=["alphaMap","aoMap","bumpMap","displacementMap","emissiveMap","envMap","lightMap","map","metalnessMap","normalMap","roughnessMap","specularMap"];function OAe(n,e,t){switch(n.type){case"MeshNodeMaterial":n.traverseNodes((r=>{r.originData.texture===e&&(r.originData.texture=t)}));for(const r in n.nodeTextures)n.nodeTextures[r]===e&&(n.nodeTextures[r]=t);break;case"MeshStandardMaterial":a6.forEach((r=>{n[r]===e&&(n[r]=t)}));break;default:return void console.error("replaceTexture: Unsupported material type "+n.type)}t.encoding=e.encoding,t.wrapS=e.wrapS,t.wrapT=e.wrapT}function o3(n){if(a6.forEach((function(e){n[e]&&n[e].isTexture&&n[e].dispose()})),n.type=="MeshNodeMaterial")for(const e in n.nodeTextures)n.nodeTextures[e]&&n.nodeTextures[e].dispose()}function s6(n,e,t){const r=new Fn,o={};if(r.addNode(Ft("LIGHT_PATH_BL","Light Path")),r.addNode(Ft("TEX_ENVIRONMENT_BL","Lighting Texture",{texture:e})),o[so("TEX_ENVIRONMENT_BL",0)]=e,t instanceof Ge){const i=t.toArray([0,0,0,1]);r.addNode(Ft("RGB_BL","Background Color",{outputs:[i]}))}else r.addNode(Ft("TEX_ENVIRONMENT_BL","Background  Texture",{texture:t})),o[so("TEX_ENVIRONMENT_BL",1)]=t;return r.addNode(Ft("MIX_BL","Mix")),Ke(r,0,it.LIGHT_PATH_BL.isCameraRay,3,ve.MIX_BL.fac),Ke(r,1,it.TEX_ENVIRONMENT_BL.color,3,ve.MIX_BL.col1),Ke(r,2,it[Ei(r.node(2))].color,3,ve.MIX_BL.col2),r.addNode(Ft("BACKGROUND_BL","Background")),Ke(r,3,it.MIX_BL.col,4,ve.BACKGROUND_BL.color),r.addNode(Ft("OUTPUT_WORLD_BL","Output")),Ke(r,4,it.BACKGROUND_BL.color,5,ve.OUTPUT_WORLD_BL.surface),new ta({name:n,nodeGraph:r,nodeTextures:o})}function i3(n,e,t,r="blender"){let o=new Fn;switch(r){case"blender":if(t<1){o.addNode(Ft("BSDF_TRANSPARENT_BL","Transparent"));const s=Ft("DIFFUSE_BSDF_BL","Diffuse");e.toArray(s.originData.inputs[ve.DIFFUSE_BSDF_BL.color]),o.addNode(s);const l=Ft("MIX_SHADER_BL","Mix");l.originData.inputs[ve.MIX_SHADER_BL.fac]=t,o.addNode(l),Ke(o,0,it.BSDF_TRANSPARENT_BL.color,2,ve.MIX_SHADER_BL.color1),Ke(o,1,it.DIFFUSE_BSDF_BL.color,2,ve.MIX_SHADER_BL.color2)}else{const s=Ft("DIFFUSE_BSDF_BL","Diffuse");e.toArray(s.originData.inputs[ve.DIFFUSE_BSDF_BL.color]),o.addNode(s)}o.addNode(Ft("OUTPUT_MATERIAL_BL","Output")),Ke(o,o.len()-2,it[Ei(o.node(o.len()-2))].color,o.len()-1,ve.OUTPUT_MATERIAL_BL.surface);break;case"max":const i=Ft("LAMBERT_AR","Diffuse");i.originData.inputs[ve.LAMBERT_AR.base]=1,e.toArray(i.originData.inputs[ve.LAMBERT_AR.baseColor]),i.originData.inputs[ve.LAMBERT_AR.opacity][0]=t,i.originData.inputs[ve.LAMBERT_AR.opacity][1]=t,i.originData.inputs[ve.LAMBERT_AR.opacity][2]=t,o.addNode(i),o.addNode(Ft("OUTPUT_MX","Output")),Ke(o,0,it.LAMBERT_AR.color,1,ve.OUTPUT_MX.color);break;case"maya":const a=Ft("LAMBERT_MY","Diffuse");e.toArray(a.originData.inputs[ve.LAMBERT_MY.color]),a.originData.inputs[ve.LAMBERT_MY.diffuse]=1,a.originData.inputs[ve.LAMBERT_MY.transparency][0]=1-t,a.originData.inputs[ve.LAMBERT_MY.transparency][1]=1-t,a.originData.inputs[ve.LAMBERT_MY.transparency][2]=1-t,o.addNode(a),o.addNode(Ft("SHADING_ENGINE_MY","Output")),Ke(o,0,it.LAMBERT_MY.color,1,ve.SHADING_ENGINE_MY.surface);break;default:console.error("createDiffuseMaterial: Incorrect material profile - "+r),o=null}return new ta({name:n,nodeGraph:o,profile:r})}function kAe(n="blender",e={}){let t=new Fn,r=e.color??"white",o=e.emissive??"black";const i=e.opacity??1,a=e.metalness??0,s=e.roughness??1,l=e.emissiveIntensity??1;let c,u;switch(r instanceof Ge||(r=new Ge(r)),o instanceof Ge||(o=new Ge(o)),n){case"blender":c=Ft("RGB_BL","color"),r.toArray(c.originData.outputs[it.RGB_BL.color]),t.addNode(c),u=Ft("RGB_BL","emissive"),o.toArray(u.originData.outputs[it.RGB_BL.color]),t.addNode(u),t.addNode(Ft("VALUE_BL","opacity",{outputs:[i]})),t.addNode(Ft("VALUE_BL","metalness",{outputs:[a]})),t.addNode(Ft("VALUE_BL","roughness",{outputs:[s]})),t.addNode(Ft("VALUE_BL","emissiveIntensity",{outputs:[l]})),t.addNode(Ft("BSDF_PRINCIPLED_BL","Shader")),Ke(t,0,it.RGB_BL.color,6,ve.BSDF_PRINCIPLED_BL.baseColor),Ke(t,1,it.RGB_BL.color,6,ve.BSDF_PRINCIPLED_BL.emission),Ke(t,2,it.VALUE_BL.value,6,ve.BSDF_PRINCIPLED_BL.alpha),Ke(t,3,it.VALUE_BL.value,6,ve.BSDF_PRINCIPLED_BL.metallic),Ke(t,4,it.VALUE_BL.value,6,ve.BSDF_PRINCIPLED_BL.roughness),Ke(t,5,it.VALUE_BL.value,6,ve.BSDF_PRINCIPLED_BL.emissionStrength),t.addNode(Ft("OUTPUT_MATERIAL_BL","Output")),Ke(t,6,it.BSDF_PRINCIPLED_BL.color,7,ve.OUTPUT_MATERIAL_BL.surface);break;case"max":c=Ft("RGB_MX","color"),r.toArray(c.originData.outputs[it.RGB_MX.color]),t.addNode(c),u=Ft("RGB_MX","emissive"),o.toArray(u.originData.outputs[it.RGB_BL.color]),t.addNode(u),t.addNode(Ft("VALUE_MX","opacity",{outputs:[i]})),t.addNode(Ft("VALUE_MX","metalness",{outputs:[a]})),t.addNode(Ft("VALUE_MX","roughness",{outputs:[s]})),t.addNode(Ft("VALUE_MX","emissiveIntensity",{outputs:[l]})),t.addNode(Ft("PHYSICAL_MX","Shader")),Ke(t,0,it.RGB_MX.color,6,ve.PHYSICAL_MX.baseColor),Ke(t,1,it.RGB_MX.color,6,ve.PHYSICAL_MX.emitColor),Ke(t,2,it.VALUE_BL.value,6,ve.PHYSICAL_MX.opacity),Ke(t,3,it.VALUE_MX.value,6,ve.PHYSICAL_MX.metalness),Ke(t,4,it.VALUE_MX.value,6,ve.PHYSICAL_MX.roughness),Ke(t,5,it.VALUE_MX.value,6,ve.PHYSICAL_MX.emission),t.addNode(Ft("OUTPUT_MX","Output")),Ke(t,6,it.PHYSICAL_MX.color,7,ve.OUTPUT_MX.color);break;case"maya":c=Ft("COLOR_CONSTANT_MY","color"),r.toArray(c.originData.inputs[ve.COLOR_CONSTANT_MY.color]),r.toArray(c.originData.outputs[ve.COLOR_CONSTANT_MY.color]),t.addNode(c),u=Ft("COLOR_CONSTANT_MY","emissive"),o.toArray(u.originData.inputs[ve.COLOR_CONSTANT_MY.color]),o.toArray(u.originData.outputs[ve.COLOR_CONSTANT_MY.color]),t.addNode(u),t.addNode(Ft("FLOAT_CONSTANT_MY","opacity",{outputs:[i]})),t.addNode(Ft("FLOAT_CONSTANT_MY","metalness",{outputs:[a]})),t.addNode(Ft("FLOAT_CONSTANT_MY","roughness",{outputs:[s]})),t.addNode(Ft("FLOAT_CONSTANT_MY","emissiveIntensity",{outputs:[l]})),t.addNode(Ft("STANDARD_SURFACE_AR","Shader")),Ke(t,0,it.COLOR_CONSTANT_MY.color,6,ve.STANDARD_SURFACE_AR.baseColor),Ke(t,1,it.COLOR_CONSTANT_MY.color,6,ve.STANDARD_SURFACE_AR.emissionColor),Ke(t,2,it.FLOAT_CONSTANT_MY.value,6,ve.STANDARD_SURFACE_AR.opacity),Ke(t,3,it.FLOAT_CONSTANT_MY.value,6,ve.STANDARD_SURFACE_AR.metalness),Ke(t,4,it.FLOAT_CONSTANT_MY.value,6,ve.STANDARD_SURFACE_AR.specularRoughness),Ke(t,5,it.FLOAT_CONSTANT_MY.value,6,ve.STANDARD_SURFACE_AR.emission),t.addNode(Ft("SHADING_ENGINE_MY","Output")),Ke(t,6,it.STANDARD_SURFACE_AR.color,7,ve.SHADING_ENGINE_MY.surface);break;default:console.error("createStandardPBRMaterial: Incorrect material profile - "+n),t=null}return new ta({name:name??"",nodeGraph:t,profile:n})}var FAe=Object.freeze({__proto__:null,createDiffuseMaterial:i3,createEnvironmentMaterial:s6,createStandardPBRMaterial:kAe,disposeTextures:o3,replaceTexture:OAe});const l6=new Ge,c6=new Ue;function VAe(n){const e=new qi,t=n.count,r=n.geometry,o=n.material;for(let i=0;i<t;i++){const a=new Mt(r,o);n.getMatrixAt(i,a.matrix),a.matrix.decompose(a.position,a.quaternion,a.scale),e.add(a)}return e.copy(n),e.updateWorldMatrix(!1,!0),e}function UAe(n){if(Array.isArray(n.material)===!1)return console.warn("v3d.SceneUtils.createMeshesFromMultiMaterialMesh(): The given mesh has no multiple materials."),n;const e=new qi;e.copy(n);const t=i6(n.geometry),r=t.index,o=t.groups,i=Object.keys(t.attributes);for(let a=0;a<o.length;a++){const s=o[a],l=s.start,c=l+s.count,u=new At,d=n.material[s.materialIndex];for(let h=0;h<i.length;h++){const p=i[h],m=t.attributes[p],g=m.itemSize,_=s.count*g,A=new m.array.constructor(_),y=new Xe(A,g);for(let b=l,E=0;b<c;b++,E++){const x=r.getX(b);g>=1&&y.setX(E,m.getX(x)),g>=2&&y.setY(E,m.getY(x)),g>=3&&y.setZ(E,m.getZ(x)),g>=4&&y.setW(E,m.getW(x))}u.setAttribute(p,y)}const f=new Mt(u,d);f.isMaterialGeneratedMesh=!0,f.name=e.name+"MatMesh"+a,e.add(f)}return e}function zAe(n){const e=[],t=[];for(let o=0;o<n.children.length;o++){const i=n.children[o];i.isMesh&&i.isMaterialGeneratedMesh&&(e.push(i.geometry),t.push(i.material))}if(e.length==0)return n;const r=new Mt;return r.copy(n),r.geometry=o6(e,!0),r.material=t,r}function GAe(n,e){const t=new qi;for(let r=0,o=e.length;r<o;r++)new Mt(n,e[r]).isMaterialGeneratedMesh=!0,t.add();return t}function HAe(n,e,t){let r=t;const o=new N;return n.updateWorldMatrix(!0,!0),n.traverseVisible((i=>{const{geometry:a}=i;if(a!==void 0){const{position:s}=a.attributes;if(s!==void 0)for(let l=0,c=s.count;l<c;l++)i.isMesh?i.getVertexPosition(l,o):o.fromBufferAttribute(s,l),i.isSkinnedMesh||o.applyMatrix4(i.matrixWorld),r=e(r,o)}})),r}function WAe(n,e){const t=f1(n.instanceMatrix),r=n.instanceColor?f1(n.instanceColor):null,o=new Map;for(const a in n.geometry.attributes){const s=n.geometry.attributes[a];s.isInstancedBufferAttribute&&o.set(s,f1(s))}const i=[];for(let a=0;a<n.count;a++)i.push(a);i.sort(e);for(let a=0;a<i.length;a++){const s=i[a];c6.fromArray(t.array,s*n.instanceMatrix.itemSize),c6.toArray(n.instanceMatrix.array,a*n.instanceMatrix.itemSize),n.instanceColor&&(l6.fromArray(r.array,s*n.instanceColor.itemSize),l6.toArray(n.instanceColor.array,a*n.instanceColor.itemSize));for(const l in n.geometry.attributes){const c=n.geometry.attributes[l];if(c.isInstancedBufferAttribute){const u=o.get(c);c.setX(a,u.getX(s)),c.itemSize>1&&c.setY(a,u.getY(s)),c.itemSize>2&&c.setZ(a,u.getZ(s)),c.itemSize>3&&c.setW(a,u.getW(s))}}}}function jAe(n,e){if(oh(e))return a3(n,e);const t=this.getMaterialsByName(n,e);return t.length?t[0]:null}function QAe(n,e){if(oh(e)){const r=a3(n,e);return r?[r]:[]}const t=[];if(n.scene!==null){n.scene.traverse((function(o){o.material&&o.material.name===e&&t.indexOf(o.material)===-1&&t.push(o.material)}));const r=n.scene.worldMaterial;r!==null&&r.name===e&&t.indexOf(r)===-1&&t.push(r)}return t}function a3(n,e){let t=null;if(n.scene!==null){n.scene.traverse((o=>{o.material&&o.material.uuid===e&&(t=o.material)}));const r=n.scene.worldMaterial;r!==null&&r.uuid===e&&(t=r)}return t}function u6(n){const e=[];if(n.scene!==null){n.scene.traverse((r=>{r.material&&!e.includes(r.material)&&e.push(r.material)}));const t=n.scene.worldMaterial;t===null||e.includes(t)||e.push(t)}return e}function $Ae(n,e){const t=oh(e);for(let r=0;r<n.actions.length;r++){const o=n.actions[r],i=o.getClip();if((t?i.uuid:i.name)==e)return o}return null}function YAe(n,e){const t=oh(e),r=[];for(let o=0;o<n.actions.length;o++){const i=n.actions[o],a=i.getClip();(t?a.uuid:a.name)==e&&r.push(i)}return r}function XAe(n,e){for(let t=0;t<n.actions.length;t++){const r=n.actions[t];if(r.getClip().objectUUID==e)return r}return null}function d6(n,e){return!!e._propertyBindings.find((function(t){const r=t.binding.node;return r&&r.findRoot()===n}))}function h1(n){const e=new Tn;return e.expandByObject(n),e}function f6(n,e){const t=new N,r=2*n.getSize(t).length(),o=new gr(45,e,r/1e4,r);return o.position.copy(n.max).multiplyScalar(2),o.lookAt(n.getCenter(t)),o}function h6(n,e){const t=new kt;e.getCenter(t.position),n.controlSettings=new n3,n.controlSettings.orbitMinDistance=n.near,n.controlSettings.orbitMaxDistance=n.far,n.controlSettings.orbitTarget=t}function qAe(n,e){e.traverse((t=>{if(!t.material)return;const r=Array.isArray(t.material)?t.material:[t.material];for(let o=0;o<r.length;o++){const i=r[o];if(i.clippingPlanes)for(let a=i.clippingPlanes.length-1;a>=0;a--)i.clippingPlanes[a]===n.plane&&i.clippingPlanes.splice(a,1)}}))}var KAe=Object.freeze({__proto__:null,assignDefaultControls:h6,calcSceneBox:h1,checkActionIsUsed:d6,createDefaultCamera:f6,createEnvironmentMaterial:s6,createMeshesFromInstancedMesh:VAe,createMeshesFromMultiMaterialMesh:UAe,createMultiMaterialMesh:zAe,createMultiMaterialObject:GAe,getAllMaterials:u6,getAnimationActionByName:$Ae,getAnimationActionByObjectUUID:XAe,getAnimationActionsByName:YAe,getMaterialByName:jAe,getMaterialByUUID:a3,getMaterialsByName:QAe,reduceVertices:HAe,removeClipPlanesFromMats:qAe,sortInstancedMesh:WAe});const ZAe="MADE WITH VERGE3D TRIAL",p6={Afterimage:xD,Bloom:pl,Bokeh:Rb,"Brightness/Contrast":Lb,FXAA:e1,Grayscale:Pb,Mask:Nb,Outline:Ma,Render:o1,SSAA:Fh,SSR:RD,ToneMapping:kb,"Copy/Other":bs},JAe={[yR]:"RG",[vR]:"RGBA",[AR]:"DEPTH",[IR]:"RGBA_BPTC",[TR]:"RGBA_ASTC_4x4",[bR]:"RGB_S3TC_DXT1",[xR]:"RGBA_S3TC_DXT5",[ER]:"RGB_PVRTC_4BPPV1",[CR]:"RGBA_PVRTC_4BPPV1",[SR]:"RGB_ETC1",[wR]:"RGB_ETC2",[MR]:"RGB_ETC2_EAC"};class vo{static getPageParams(e){let t=(e=e||window).location.href.toString();const r={};if(t.indexOf("?")==-1)return r;const o=t.split("#")[0].split("?")[1].split("&");for(let i=0;i<o.length;i++){const a=o[i].split("="),s=decodeURIComponent(a[0]);a.length==1?r[s]="":r[s]=decodeURIComponent(a[1])}return r}static updatePageParam(e,t,r){let o,i,a=null,s="",l=e.split("?"),c=l[0],u=l[1],d="";if(u){o=u.split("#"),i=o[0],a=o[1],a&&(u=i),l=u.split("&");for(let f=0;f<l.length;f++)l[f].split("=")[0]!=t&&(s+=d+l[f],d="&")}else o=c.split("#"),i=o[0],a=o[1],i&&(c=i);return a&&(r+="#"+a),c+"?"+s+(d+""+t+"="+r)}static loadScript(e,t,r,o){function i(l){s.removeEventListener("load",i,!1),s.removeEventListener("error",a,!1),t.removeChild(s),r(l)}function a(l){s.removeEventListener("load",i,!1),s.removeEventListener("error",a,!1),t.removeChild(s),o(l)}const s=document.createElement("script");s.addEventListener("load",i,!1),s.addEventListener("error",a,!1),t.appendChild(s),s.src=e}static drawWatermark(e){setTimeout((function(){typeof __V3D_DEVTOOLS__<"u"&&__V3D_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:"4.10.0",v3dl:kg}}))}),0);const t=e.container;if(Eu(kg)!=3483952072)return;const r=["color: #fff;","opacity: 0.5;","font-size: 18px;","font-family: sans-serif;","text-align: center;","text-decoration: none;","position: absolute;","bottom: 1%;","right: 1%;","user-select: none;","z-index: 9999;","text-shadow: 1px 1px #000;"].join(`
`),o=document.createElement("div");o.innerHTML=`<a href="https://www.soft8soft.com/verge3d-trial/" target="_blank" style="${r}">${ZAe}</a>`,t.appendChild(o),setTimeout((function(){t.contains(o)&&Eu(o.textContent)==890310108||e.dispose()}),1e3)}static isXML(e){return e.match(/.*\.xml$/)!==null}static isJS(e){return e.match(/.*\.js$/)!==null}static addToAppList(e){const t=ch();t.v3d&&(t.v3d.apps=t.v3d.apps||[],t.v3d.apps.indexOf(e)==-1&&t.v3d.apps.push(e))}static removeFromAppList(e){const t=ch();if(t.v3d&&t.v3d.apps){const r=t.v3d.apps.indexOf(e);r>-1&&t.v3d.apps.splice(r,1)}}static printPerformanceInfo(e,t){t=t||1;const r=e.renderer.info;r.reset();const o=e.frame;for(let s=0;s<r.programs.length;s++)r.programs[s].profile.calcRenderTime=!0;let i;function a(s,l){i==s&&(s+=" "),i=s,l?console.log("%c"+s,"color:red"):console.log(s)}setTimeout((function(){if(a("--- Verge3D Performance Profile ("+t+"s) ---"),!e.scene)return void a("Scene not loaded");const s=e.frame-o,l=Math.round(e._loadingTime);a(`Scene Loading Time: ${l}ms`,l>1e4);const c=e._loadSceneURL.indexOf(".xz",e._loadSceneURL.length-3)!=-1;a("Asset Compression: "+(c?"yes":"no"),c==0);const u=Math.round(r.numShaderCompiles);a(`Shader Compilations: ${u}`,u>100);const d=s/t;a("FPS: "+d,d<30);const f=Math.round(r.render.calls/s);a("Render Calls: "+f,f>1e3);const h=Math.round(r.render.triangles/s);a("Triangles Rendered: "+h,h>1e6),a("Geometry Buffers: "+r.memory.geometries,r.memory.geometries>200),a("HDR Rendering: "+(e.useHDR?"yes":"no")),a("Order-Independent Transparency: "+(e.renderer.useOIT?"yes":"no"));const p=e.renderer.getDrawingBufferSize(new be);a("Viewport Resolution: "+p.x+"x"+p.y),a(`Pixel Ratio: ${e.renderer.getPixelRatio()} (current) / ${window.devicePixelRatio} (device)`);let m="N/A";switch(e._envIBLMode){case 0:m="PMREM",m+=` ${e._pmremMaxTileSize} px`;break;case 1:m="Light Probe",m+=` ${e._pmremMaxTileSize} px`}a(`Image-Based Lighting: ${m}`);let g=0,_=0,A=0,y=0,b=0,E=0;e.scene.traverse((function(D){D.isLight&&(g++,D.castShadow&&D.shadow&&(y++,b=D.shadow.mapSize.width,E=D.shadow.mapSize.height)),D.isCubeReflectionProbe&&_++,D.isPlaneReflectionProbe&&A++})),a("Lights: "+g,g>10),a(`Reflection Probes: ${_} (cube) / ${A} (plane) `,_>3||A>1);const x=[];e.postprocessing&&(e.postprocessing.gtaoGenerator&&x.push("GTAO"),e.postprocessing.composer.passes.forEach((function(D){for(let Q in p6)if(D instanceof p6[Q])return void x.push(Q);x.push("Undefined")}))),a(`Post-Processing: ${x.length?x.join(","):"N/A"}`);let w="N/A";if(y&&e.renderer.shadowMap&&e.renderer.shadowMap.enabled){switch(e.renderer.shadowMap.type){case 0:w="Basic";break;case 1:w="Bilinear";break;case 2:w="PCF";break;case 3:w="ESM";break;default:w="Unknown"}w+=` ${b}x${E}x${y}`}a("Shadow Map: "+w,y>4||b>2048||E>2048);const L=r.programs.slice(0);a("Materials and Shaders: "+L.length,L>100),L.sort((function(D,Q){return Q.profile.renderTime-D.profile.renderTime}));let C=0;for(let D=0;D<L.length;D++){const Q=L[D];Q.profile.calcRenderTime=!1;const re=Q.profile.materials,G=Q.profile.renderTime/s;let se;se=G>=.1?String(Math.round(10*G)/10)+"ms":G>0&&G<.1?String(Math.round(1e3*G)/1e3)+"ms":"N/R",a("    "+(re.size==0?"System Material":Array.from(re).join(","))+" - "+Q.name+" - "+se,G>16),C+=G,Q.profile.renderTime=0}a("Total Render Time: "+String(Math.round(10*C)/10)+"ms",C>16),a("Textures & Render Buffers: "+r.memory.textures,r.memory.textures>100);const P=Array.from(r.memory.textureSpecs.values());P.sort((function(D,Q){return D.type<Q.type?1:D.type>Q.type?-1:D.width!=Q.width?Q.width-D.width:Q.height-D.height}));for(let D=0;D<P.length;D++){const Q=P[D],re=Q.type=="Texture"?"- "+JAe[Q.format]:"",G=Q.isCube?"x6":"";a(`    ${Q.name||"N/A"} - ${Q.type} - ${Q.width}x${Q.height}${G} ${re}`,Q.width>=4096||Q.height>=4096)}if(r.render.customCounter){const D=r.render.customCounter/s;a(`Custom Counter: ${Math.round(10*D)/10} iter/frame`)}}),1e3*t)}static printMaterialsStats(e){const t=u6(e).filter((a=>a.type=="MeshNodeMaterial")),r=new Map;t.forEach((a=>{a.traverseNodes((s=>{const l=s.originData.type;r.has(l)||r.set(l,0),r.set(l,r.get(l)+1)}))}));const o=Array.from(r);o.sort(((a,s)=>s[1]-a[1])),console.log("Total Node Materials:",t.length);const i=e.renderer.info.programs.filter((a=>a.name=="MeshNodeMaterial"));console.log("Total Node Shaders:",i.length),console.log("Node Stats:"),o.forEach((a=>{console.log(`    ${a[0]} - ${a[1]}`)}))}static registerServiceKeys(e){vo.unregisterServiceKeys(e),e._serviceKeyListeners=e._serviceKeyListeners||[];const t=e._serviceKeyListeners;t.push(new i1(window,"KeyP",(function(){vo.printPerformanceInfo(e,1)}),3,1)),t.push(new i1(window,"KeyF",(function(){e.stats?e.hideFPS():e.showFPS()}),3,1)),t.push(new i1(window,"KeyH",(function(){e.enableRender?e.disableRendering():e.enableRendering()}),3,1)),t.push(new i1(window,["Backquote","IntlBackslash"],(()=>{let r;vo.showServiceKeysHelp(e),e.controls&&(r=e.controls.enableKeys,e.controls.enableKeys=!1);const o=i=>{switch(i.code){case"KeyW":e.hasDebugMode("wireframes")?e.disableDebugMode("wireframes"):e.enableDebugMode("wireframes");break;case"KeyL":e.hasDebugMode("lights")?e.disableDebugMode("lights"):e.enableDebugMode("lights");break;case"KeyS":e.hasDebugMode("skeletons")?e.disableDebugMode("skeletons"):e.enableDebugMode("skeletons");break;case"KeyP":vo.printPerformanceInfo(e,1);break;case"KeyF":e.stats?e.hideFPS():e.showFPS();break;case"KeyH":e.enableRender?e.disableRendering():e.enableRendering();break;case"KeyN":e.hasDebugMode("normals")?e.disableDebugMode("normals"):e.enableDebugMode("normals");break;case"KeyG":{const a=new r1,s={onlyVisible:!0,binary:!0,trs:!0,animations:[]};for(let l=0;l<e.actions.length;l++){const c=e.actions[l].getClip();s.animations.includes(c)||s.animations.push(c)}a.parse(e.scene,(function(l){const c=URL.createObjectURL(new Blob([l],{type:"application/octet-stream"})),u=document.createElement("a");u.href=c,u.download="scene.glb",document.body.appendChild(u),u.click()}),(function(l){console.error("GLTFExporter: export failed: "+l)}),s)}break;case"KeyU":new QD().parse(e.scene).then((function(a){const s=URL.createObjectURL(new Blob([a],{type:"application/octet-stream"})),l=document.createElement("a");l.href=s,l.download="scene.usdz",document.body.appendChild(l),l.click()}),(function(a){console.error("USDZExporter: export failed: "+a)}));break;case"KeyM":vo.printMaterialsStats(e);break;case"KeyT":e.pause(e)}window.removeEventListener("keydown",o),vo.hideServiceKeysHelp(e),e.controls&&(e.controls.enableKeys=r)};window.addEventListener("keydown",o)}),3,1))}static unregisterServiceKeys(e){Array.isArray(e._serviceKeyListeners)&&(e._serviceKeyListeners.forEach((t=>t.dispose())),e._serviceKeyListeners.length=0)}static showServiceKeysHelp(e){const t=e.container,r=["color: #fff;","font-size: 14px;","font-family: monospace;","text-decoration: none;","position: absolute;",`top: ${e.stats?60:10}px;`,"left: 10px;","user-select: none;","z-index: 9999;","text-shadow: 1px 1px #000;"].join(`
`),o=document.createElement("div");o.id="v3d-debug-info-help",o.style=r,o.innerHTML="Service Tools:<br>[F] FPS counter<br>[P] performance profile<br>[H] halt/resume render<br>[W] wireframes<br>[L] lights<br>[S] skeletons<br>[N] normals",o.innerHTML+="<br>[G] glTF export<br>[U] USDZ export<br>[M] materials stats<br>[T] terminate",t.appendChild(o)}static hideServiceKeysHelp(e){e.container.querySelector("#v3d-debug-info-help").remove()}}const m6={prepareRenderer:function(n){nr.getGPUVendor(n),nr.getGPUModel(n);const e=nr.checkAndroid();n.compatSettings.gtaoDisableBkgFix=e}},g6=new N,eye=new It,_6=new N;class tye extends kt{constructor(e=document.createElement("div")){super(),this.isCSS3DObject=!0,this.element=e,this.element.style.position="absolute",this.element.style.userSelect="none",this.element.style.pointerEvents="auto",this.element.setAttribute("draggable",!1),this.addEventListener("removed",(function(){this.traverse((function(t){t.element instanceof t.element.ownerDocument.defaultView.Element&&t.element.parentNode!==null&&t.element.remove()}))}))}copy(e,t){return super.copy(e,t),this.element=e.element.cloneNode(!0),this}}const Ta=new Ue,nye=new Ue;class v6{constructor(e){const t=this;let r,o,i,a;const s={camera:{style:""},objects:new WeakMap};this.domElement=e;const l=document.createElement("div");l.id="v3d-css-render-view",l.style.transformOrigin="0 0",l.style.pointerEvents="none",l.style.position="absolute",l.style.zIndex="-2",e.appendChild(l),this.viewElement=l;const c=document.createElement("div");function u(m){return Math.abs(m)<1e-10?0:m}function d(m){const g=m.elements;return"matrix3d("+u(g[0])+","+u(-g[1])+","+u(g[2])+","+u(g[3])+","+u(g[4])+","+u(-g[5])+","+u(g[6])+","+u(g[7])+","+u(g[8])+","+u(-g[9])+","+u(g[10])+","+u(g[11])+","+u(g[12])+","+u(-g[13])+","+u(g[14])+","+u(g[15])+")"}function f(m){const g=m.elements;return"translate(-50%,-50%)"+("matrix3d("+u(g[0])+","+u(g[1])+","+u(g[2])+","+u(g[3])+","+u(-g[4])+","+u(-g[5])+","+u(-g[6])+","+u(-g[7])+","+u(g[8])+","+u(g[9])+","+u(g[10])+","+u(g[11])+","+u(g[12])+","+u(g[13])+","+u(g[14])+","+u(g[15])+")")}function h(m){m.isCSS3DObject&&(m.element.style.display="none");for(let g=0,_=m.children.length;g<_;g++)h(m.children[g])}function p(m,g,_,A){if(m.visible!==!1){if(m.isCSS3DObject){const y=m.layers.test(_.layers)===!0,b=m.element;if(b.style.display=y===!0?"":"none",y===!0){let E;m.onBeforeRender(t,g,_),m.isCSS3DSprite?(Ta.copy(_.matrixWorldInverse),Ta.transpose(),m.rotation2D!==0&&Ta.multiply(nye.makeRotationZ(m.rotation2D)),m.matrixWorld.decompose(g6,eye,_6),Ta.setPosition(g6),Ta.scale(_6),Ta.elements[3]=0,Ta.elements[7]=0,Ta.elements[11]=0,Ta.elements[15]=1,E=f(Ta)):E=f(m.matrixWorld);const x=s.objects.get(m);if(x===void 0||x.style!==E){b.style.transform=E;const w={style:E};s.objects.set(m,w)}b.parentNode!==c&&c.appendChild(b),m.onAfterRender(t,g,_)}}for(let y=0,b=m.children.length;y<b;y++)p(m.children[y],g,_)}else h(m)}c.id="v3d-css-render-camera",c.style.transformStyle="preserve-3d",l.appendChild(c),this.getSize=function(){return{width:r,height:o}},this.render=function(m,g){const _=g.projectionMatrix.elements[5]*a;let A,y;g.view&&g.view.enabled?(l.style.transform=`translate(${-g.view.offsetX*(r/g.view.width)}px, ${-g.view.offsetY*(o/g.view.height)}px)`,l.style.transform+=`scale(${g.view.fullWidth/g.view.width}, ${g.view.fullHeight/g.view.height})`):l.style.transform="",m.matrixWorldAutoUpdate===!0&&m.updateMatrixWorld(),g.parent===null&&g.matrixWorldAutoUpdate===!0&&g.updateMatrixWorld(),g.isOrthographicCamera&&(A=-(g.right+g.left)/2,y=(g.top+g.bottom)/2);const b=g.view&&g.view.enabled?g.view.height/g.view.fullHeight:1,E=g.isOrthographicCamera?`scale(${b})scale(`+_+")translate("+u(A)+"px,"+u(y)+"px)"+d(g.matrixWorldInverse):`scale(${b})translateZ(`+_+"px)"+d(g.matrixWorldInverse),x=(g.isPerspectiveCamera?"perspective("+_+"px) ":"")+E+"translate("+i+"px,"+a+"px)";s.camera.style!==x&&(c.style.transform=x,s.camera.style=x),p(m,m,g)},this.setSize=function(m,g){r=m,o=g,i=r/2,a=o/2,l.style.width=m+"px",l.style.height=g+"px",c.style.width=m+"px",c.style.height=g+"px"}}}function Gh(n){this.sourceTexture=n,this.camera=new ya(-1,1,1,-1,0,1),this.shader=new Dn({type:"CubeCopy",uniforms:{faceIdx:{value:0},cubemap:{value:null}},vertexShader:`
        uniform int faceIdx;

        varying vec3 vCubeDirection;

        vec3 uvToCubeDirection(vec2 uv, int face) {
            vec3 dir;
            uv = 2.0 * uv - 1.0;

            if (face == 0) {
                dir = vec3(1.0, -uv.y, -uv.x);
            } else if (face == 1) {
                dir = vec3(-1.0, -uv.y, uv.x);
            } else if (face == 2) {
                dir = vec3(uv.x, 1.0, uv.y);
            } else if (face == 3) {
                dir = vec3(uv.x, -1.0, -uv.y);
            } else if (face == 4) {
                dir = vec3(uv.x, -uv.y, 1.0);
            } else if (face == 5) {
                dir = vec3(-uv.x, -uv.y, -1.0);
            }
            return dir;
        }

        void main() {
            vCubeDirection = uvToCubeDirection(uv, faceIdx);
            gl_Position = vec4(position, 1.0);
        }
        `,fragmentShader:`
        uniform samplerCube cubemap;

        varying vec3 vCubeDirection;

        void main() {
            gl_FragColor = textureCube(cubemap, vCubeDirection);

            #include <tonemapping_fragment>

            gl_FragColor = linearToOutputTexel(gl_FragColor);
        }
        `}),this.shader.map=n,this.shader.uniforms.cubemap.value=n,this.planeMesh=new Mt(new ms(2,2),this.shader),this.scene=new jr,this.scene.add(this.camera),this.scene.add(this.planeMesh)}function s3(n,e,t,{camPos:r=new N,clipStart:o=.1,clipEnd:i=100}={}){nr.checkHalfFloatTex(e,!0)||(console.warn("v3d.RenderUtils: disabling half float cubemaps"),t.texture.type=1009);const a=new a0(o,i,t);a.position.copy(r);let s=n.worldMaterial;if(s!==null&&s.isMeshNodeMaterial){const l=new Mt(new nc(1,1,1),s);l.material.side=1,l.material.defines.WORLD_NODES=1,new a0(.1,10,t).update(e,l),l.geometry.disposeBoundsTree&&l.geometry.disposeBoundsTree(),l.geometry.dispose();const c=n.background;n.background=null;const u=e.autoClearColor;e.autoClearColor=!1,a.update(e,n),e.autoClearColor=u,n.background=c}else a.update(e,n);return a.renderTarget}function A6(n,e,t,r){e.isMeshNodeMaterial||console.error("v3d.RenderUtils.renderWorldNodeMatToCubemap(): material is not an instance of MeshNodeMaterial.");const o=new jr;o.worldMaterial=e;const i=new hh(t,r);return i.texture.name="WorldNodesCubemap",s3(o,n,i)}function rye(n){const e=n.layers.mask;return n.layers.set(0),n.isArrayCamera&&(n.layers.enable(1),n.layers.enable(2)),n.layers.enable(3),n.layers.enable(4),n.layers.enable(5),n.layers.enable(6),n.layers.enable(7),e}Gh.prototype={constructor:Gh,render:function(n,e,t=1){var r=n.toneMapping,o=n.toneMappingExposure,i=n.getRenderTarget();n.toneMapping=1,n.toneMappingExposure=t;for(var a=0;a<6;a++)n.setRenderTarget(e,a),this.shader.uniforms.faceIdx.value=a,n.render(this.scene,this.camera);n.toneMapping=r,n.toneMappingExposure=o,n.setRenderTarget(i)},dispose:function(){this.planeMesh.geometry.dispose(),this.planeMesh.material.dispose()}};var oye=Object.freeze({__proto__:null,assignAllLayersMask:rye,renderSceneToCubemap:s3,renderWorldNodeMatToCubemap:A6});const p1=new Tn,Hh=new ni,iye=new Ue,aye=new N,sye=new N;class l3 extends kt{constructor(e=256){super(),this.isCubeReflectionProbe=!0,this.type="CubeReflectionProbe",this.influenceType=1,this.influenceDistance=1,this.parallaxType=1,this.parallaxDistance=1,this.probeClipStart=.1,this.probeClipEnd=100,this.probeIntensity=1,this.visibilityGroup=null,this.visibilityGroupInv=!1,this.influenceGroup=null,this.influenceGroupInv=!1,this._renderTargetCube=new hh(e,{encoding:3001,format:1023,generateMipmaps:!0,minFilter:1008,type:1016}),this._renderTargetCube.texture.name="CubeReflectionProbe.ini",this._exposureRenderTargetCube=this._renderTargetCube.clone(),this._renderTargetCube.texture.name="CubeReflectionProbe.exp",this.renderTarget=null,this.matrixWorldInverse=new Ue}setSize(e){this._renderTargetCube.setSize(e,e),this._exposureRenderTargetCube.setSize(e,e)}setEncoding(e){this._renderTargetCube.texture.encoding=e,this._exposureRenderTargetCube.texture.encoding=e}intersectsMesh(e){let t=!1;const r=e.geometry,o=r.boundsTree,i=iye;switch(i.copy(e.matrixWorld).invert(),i.multiply(this.matrixWorld),this.influenceType){case 0:t=!0;break;case 1:Hh.center.setScalar(0),Hh.radius=this.influenceDistance,Hh.applyMatrix4(i),o?t=o.intersectsSphere(Hh):(r.boundingBox===null&&r.computeBoundingBox(),t=r.boundingBox.intersectsSphere(Hh));break;case 2:const a=aye.setScalar(0),s=sye.setScalar(2*this.influenceDistance);p1.setFromCenterAndSize(a,s),o?t=o.intersectsBox(p1,i):(p1.applyMatrix4(i),r.boundingBox===null&&r.computeBoundingBox(),t=r.boundingBox.intersectsBox(p1))}return t}update(e,t){const r={};e.traverse((l=>{!l.isCubeReflectionProbe&&this._isVisible(l)||(r[l.id]=l.layers.mask,l.layers.disableAll())}));const o=e.worldMaterial,i=o!==null&&o.isMeshNodeMaterial&&o.needsLightPathDir();let a;i&&(a=o.defines.LIGHT_PATH_IS_CAM_RAY,o.defines.LIGHT_PATH_IS_CAM_RAY=0),s3(e,t,this._renderTargetCube,{camPos:this.position,clipStart:this.probeClipStart,clipEnd:this.probeClipEnd}),this._exposureRenderTargetCube.texture.type=this._renderTargetCube.texture.type;const s=new Gh(this._renderTargetCube.texture);s.render(t,this._exposureRenderTargetCube,this.probeIntensity),s.dispose(),this.renderTarget=this.onUpdate(this._exposureRenderTargetCube),i&&(o.defines.LIGHT_PATH_IS_CAM_RAY=a),e.traverse((l=>{!l.isCubeReflectionProbe&&this._isVisible(l)||(l.layers.mask=r[l.id])}))}onUpdate(e){return e}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}copy(e){return super.copy(e),this.influenceType=e.influenceType,this.influenceDistance=e.influenceDistance,this.parallaxType=e.parallaxType,this.parallaxDistance=e.parallaxDistance,this.probeClipStart=e.probeClipStart,this.probeClipEnd=e.probeClipEnd,this.probeIntensity=e.probeIntensity,this.visibilityGroup=e.visibilityGroup,this.visibilityGroupInv=e.visibilityGroupInv,this.influenceGroup=e.influenceGroup,this.influenceGroupInv=e.influenceGroupInv,this.setSize(e._renderTargetCube.width),this.matrixWorldInverse.copy(e.matrixWorldInverse),this}dispose(){this._renderTargetCube!==null&&this._renderTargetCube.dispose(),this._exposureRenderTargetCube!==null&&this._exposureRenderTargetCube.dispose(),this.renderTarget!==null&&(this.renderTarget.dispose(),this.renderTarget=null),this.dispatchEvent({type:"dispose"})}_isVisible(e){return this.visibilityGroup===null||!e.isMesh?!0:e.groupNames.indexOf(this.visibilityGroup)!==-1^this.visibilityGroupInv}}class c3{constructor(e,t){if(this.renderer=e,t===void 0){const r=e.getSize(new be);this._pixelRatio=e.getPixelRatio(),this._width=r.width,this._height=r.height,(t=new nn(Math.floor(this._width*this._pixelRatio),Math.floor(this._height*this._pixelRatio))).texture.name="EffectComposer.rt1"}else this._pixelRatio=1,this._width=t.width,this._height=t.height;this.renderTarget1=t,this.renderTarget2=t.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],this.copyPass=new bs(Tt.copy),this.clock=new Ca}swapBuffers(){const e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}addPass(e){this.passes.push(e),e.setSize(Math.floor(this._width*this._pixelRatio),Math.floor(this._height*this._pixelRatio))}insertPass(e,t){this.passes.splice(t,0,e),e.setSize(Math.floor(this._width*this._pixelRatio),Math.floor(this._height*this._pixelRatio))}removePass(e){const t=this.passes.indexOf(e);t!==-1&&this.passes.splice(t,1)}isLastEnabledPass(e){for(let t=e+1;t<this.passes.length;t++)if(this.passes[t].enabled)return!1;return!0}render(e){e===void 0&&(e=this.clock.getDelta());const t=this.renderer.getRenderTarget();let r=!1;for(let o=0,i=this.passes.length;o<i;o++){const a=this.passes[o];if(a.enabled!==!1){if(a.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(o),a.render(this.renderer,this.writeBuffer,this.readBuffer,e,r),a.needsSwap){if(r){const s=this.renderer.getContext(),l=this.renderer.state.buffers.stencil;l.setFunc(s.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),l.setFunc(s.EQUAL,1,4294967295)}this.swapBuffers()}a instanceof Nb?r=!0:a instanceof MD&&(r=!1)}}this.renderer.setRenderTarget(t)}reset(e){if(e===void 0){const t=this.renderer.getSize(new be);this._pixelRatio=this.renderer.getPixelRatio(),this._width=t.width,this._height=t.height,(e=this.renderTarget1.clone()).setSize(Math.floor(this._width*this._pixelRatio),Math.floor(this._height*this._pixelRatio))}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(e,t){this._width=e,this._height=t;const r=Math.floor(this._width*this._pixelRatio),o=Math.floor(this._height*this._pixelRatio);this.renderTarget1.setSize(r,o),this.renderTarget2.setSize(r,o);for(let i=0;i<this.passes.length;i++)this.passes[i].setSize(r,o)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}getPixelRatio(){return this._pixelRatio}dispose(){this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.copyPass.dispose()}getActiveSSAAPass(){return this.passes[0]instanceof Fh?this.passes[0]:null}insertPassAfter(e,t){let r=0;for(let o=0;o<this.passes.length;o++)t.indexOf(this.passes[o])>-1&&(r=o+1);this.insertPass(e,r)}enableAllPasses(){for(let e=0;e<this.passes.length;e++)this.passes[e].enabled=!0}disableAllPasses(){for(let e=0;e<this.passes.length;e++)this.passes[e].enabled=!1}setStencil(e){this.renderTarget1.stencilBuffer=e,this.renderTarget1.dispose(),this.renderTarget2.stencilBuffer=e,this.renderTarget2.dispose()}}var y6=(()=>{var n=Xr&&Xr.tagName.toUpperCase()==="SCRIPT"&&Xr.src||new URL("configurator.iife.js",document.baseURI).href;return function(e){e=(e=e||{})!==void 0?e:{};var t,r,o=Object.assign;e.ready=new Promise((function(B,V){t=B,r=V}));var i,a,s,l,c,u,d=o({},e),f=typeof window=="object",h=typeof importScripts=="function",p=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string",m="";p?(m=h?require("path").dirname(m)+"/":__dirname+"/",u=()=>{c||(l=require("fs"),c=require("path"))},i=function(B,V){var Y=U(B);return Y?V?Y:Y.toString():(u(),B=c.normalize(B),l.readFileSync(B,V?null:"utf8"))},s=B=>{var V=i(B,!0);return V.buffer||(V=new Uint8Array(V)),V},a=(B,V,Y)=>{var le=U(B);le&&V(le),u(),B=c.normalize(B),l.readFile(B,(function(me,fe){me?Y(me):V(fe.buffer)}))},process.argv.length>1&&process.argv[1].replace(/\\/g,"/"),process.argv.slice(2),process.on("uncaughtException",(function(B){if(!(B instanceof J))throw B})),process.on("unhandledRejection",(function(B){throw B})),e.inspect=function(){return"[Emscripten Module object]"}):(f||h)&&(h?m=self.location.href:typeof document<"u"&&document.currentScript&&(m=document.currentScript.src),n&&(m=n),m=m.indexOf("blob:")!==0?m.substr(0,m.replace(/[?#].*/,"").lastIndexOf("/")+1):"",i=B=>{try{var V=new XMLHttpRequest;return V.open("GET",B,!1),V.send(null),V.responseText}catch(le){var Y=U(B);if(Y)return(function(me){for(var fe=[],te=0;te<me.length;te++){var de=me[te];de>255&&(de&=255),fe.push(String.fromCharCode(de))}return fe.join("")})(Y);throw le}},h&&(s=B=>{try{var V=new XMLHttpRequest;return V.open("GET",B,!1),V.responseType="arraybuffer",V.send(null),new Uint8Array(V.response)}catch(le){var Y=U(B);if(Y)return Y;throw le}}),a=(B,V,Y)=>{var le=new XMLHttpRequest;le.open("GET",B,!0),le.responseType="arraybuffer",le.onload=()=>{if(le.status==200||le.status==0&&le.response)V(le.response);else{var me=U(B);me?V(me.buffer):Y()}},le.onerror=Y,le.send(null)}),e.print||console.log.bind(console);var g,_,A=e.printErr||console.warn.bind(console);o(e,d),d=null,e.arguments&&e.arguments,e.thisProgram&&e.thisProgram,e.quit&&e.quit,e.wasmBinary&&(g=e.wasmBinary),e.noExitRuntime,typeof WebAssembly!="object"&&H("no native wasm support detected");var y=!1;function b(B){return e["_"+B]}function E(B,V,Y,le,me){var fe={string:function(ct){var Vt=0;if(ct!=null&&ct!==0){var En=1+(ct.length<<2);(function(Rt,pe,Te){(function(Ce,Zt,rt,rn){if(!(rn>0))return 0;for(var Di=rt,xo=rt+rn-1,Eo=0;Eo<Ce.length;++Eo){var jn=Ce.charCodeAt(Eo);if(jn>=55296&&jn<=57343&&(jn=65536+((1023&jn)<<10)|1023&Ce.charCodeAt(++Eo)),jn<=127){if(rt>=xo)break;Zt[rt++]=jn}else if(jn<=2047){if(rt+1>=xo)break;Zt[rt++]=192|jn>>6,Zt[rt++]=128|63&jn}else if(jn<=65535){if(rt+2>=xo)break;Zt[rt++]=224|jn>>12,Zt[rt++]=128|jn>>6&63,Zt[rt++]=128|63&jn}else{if(rt+3>=xo)break;Zt[rt++]=240|jn>>18,Zt[rt++]=128|jn>>12&63,Zt[rt++]=128|jn>>6&63,Zt[rt++]=128|63&jn}}Zt[rt]=0})(Rt,L,pe,Te)})(ct,Vt=I(En),En)}return Vt},array:function(ct){var Vt=I(ct.length);return(function(En,Rt){w.set(En,Rt)})(ct,Vt),Vt}};function te(ct){return V==="string"?(Vt=ct)?(function(Rt,pe,Te){for(var Ce=pe+Te,Zt=pe;Rt[Zt]&&!(Zt>=Ce);)++Zt;if(Zt-pe>16&&Rt.subarray&&P)return P.decode(Rt.subarray(pe,Zt));for(var rt="";pe<Zt;){var rn=Rt[pe++];if(128&rn){var Di=63&Rt[pe++];if((224&rn)!=192){var xo=63&Rt[pe++];if((rn=(240&rn)==224?(15&rn)<<12|Di<<6|xo:(7&rn)<<18|Di<<12|xo<<6|63&Rt[pe++])<65536)rt+=String.fromCharCode(rn);else{var Eo=rn-65536;rt+=String.fromCharCode(55296|Eo>>10,56320|1023&Eo)}}else rt+=String.fromCharCode((31&rn)<<6|Di)}else rt+=String.fromCharCode(rn)}return rt})(L,Vt,En):"":V==="boolean"?!!ct:ct;var Vt,En}var de=b(B),we=[],Ie=0;if(le)for(var Ne=0;Ne<le.length;Ne++){var He=fe[Y[Ne]];He?(Ie===0&&(Ie=M()),we[Ne]=He(le[Ne])):we[Ne]=le[Ne]}var je=de.apply(null,we);return je=(function(ct){return Ie!==0&&S(Ie),te(ct)})(je)}var x,w,L,C,P=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function D(B,V){return B%V>0&&(B+=V-B%V),B}function Q(B){x=B,e.HEAP8=w=new Int8Array(B),e.HEAP16=new Int16Array(B),e.HEAP32=new Int32Array(B),e.HEAPU8=L=new Uint8Array(B),e.HEAPU16=new Uint16Array(B),e.HEAPU32=new Uint32Array(B),e.HEAPF32=new Float32Array(B),e.HEAPF64=new Float64Array(B)}e.INITIAL_MEMORY;var re=[],G=[],se=[],ee=0,ie=null;function H(B){e.onAbort&&e.onAbort(B),A(B="Aborted("+B+")"),y=!0,B+=". Build with -s ASSERTIONS=1 for more info.";var V=new WebAssembly.RuntimeError(B);throw r(V),V}e.preloadedImages={},e.preloadedAudios={};var T,R,O="data:application/octet-stream;base64,";function W(B){return B.startsWith(O)}function ae(B){return B.startsWith("file://")}function ne(B){try{if(B==T&&g)return new Uint8Array(g);var V=U(B);if(V)return V;if(s)return s(B);throw"both async and sync fetching of the wasm failed"}catch(Y){H(Y)}}function oe(B){for(;B.length>0;){var V=B.shift();if(typeof V!="function"){var Y=V.func;typeof Y=="number"?V.arg===void 0?k(Y)():k(Y)(V.arg):Y(V.arg===void 0?null:V.arg)}else V(e)}}W(T="data:application/octet-stream;base64,AGFzbQEAAAABIwdgAX8AYAABf2ABfwF/YAN/f38Bf2ADf39/AGACf38AYAAAAg0CAWEBYQACAWEBYgADAxoZBAMCAAIFBgQCAAQDAQEBAQIAAQEBAAAAAAQFAXABAQEFBwEBgAKAgAIGCQF/AUHQpIADCwdBEAFjAgABZAAIAWUAEQFmABABZwAPAWgADgFpABoBagAZAWsAGAFsABcBbQAWAW4AFQFvAQABcAAUAXEAEwFyABIKl6QBGf0DAQJ/IAJBgARPBEAgACABIAIQARoPCyAAIAJqIQMCQCAAIAFzQQNxRQRAAkAgAEEDcUUEQCAAIQIMAQsgAkUEQCAAIQIMAQsgACECA0AgAiABLQAAOgAAIAFBAWohASACQQFqIgJBA3FFDQEgAiADSQ0ACwsCQCADQXxxIgBBwABJDQAgAiAAQUBqIgRLDQADQCACIAEoAgA2AgAgAiABKAIENgIEIAIgASgCCDYCCCACIAEoAgw2AgwgAiABKAIQNgIQIAIgASgCFDYCFCACIAEoAhg2AhggAiABKAIcNgIcIAIgASgCIDYCICACIAEoAiQ2AiQgAiABKAIoNgIoIAIgASgCLDYCLCACIAEoAjA2AjAgAiABKAI0NgI0IAIgASgCODYCOCACIAEoAjw2AjwgAUFAayEBIAJBQGsiAiAETQ0ACwsgACACTQ0BA0AgAiABKAIANgIAIAFBBGohASACQQRqIgIgAEkNAAsMAQsgA0EESQRAIAAhAgwBCyAAIANBBGsiBEsEQCAAIQIMAQsgACECA0AgAiABLQAAOgAAIAIgAS0AAToAASACIAEtAAI6AAIgAiABLQADOgADIAFBBGohASACQQRqIgIgBE0NAAsLIAIgA0kEQANAIAIgAS0AADoAACABQQFqIQEgAkEBaiICIANHDQALCwujAQEBfyACQX9zIQICQCABRQ0AIAFBAXEEfyAALQAAIAJB/wFxc0ECdEGwCGooAgAgAkEIdnMhAiAAQQFqIQAgAUEBawUgAQshAyABQQFGDQADQCAALQABIAAtAAAgAkH/AXFzQQJ0QbAIaigCACACQQh2cyIBQf8BcXNBAnRBsAhqKAIAIAFBCHZzIQIgAEECaiEAIANBAmsiAw0ACwsgAkF/cwtRAQJ/QaAIKAIAIgEgAEEDakF8cSICaiEAAkAgAkEAIAAgAU0bDQAgAD8AQRB0SwRAIAAQAEUNAQtBoAggADYCACABDwtB1KDAAEEwNgIAQX8L8QwBB38CQCAARQ0AIABBCGsiAyAAQQRrKAIAIgFBeHEiAGohBQJAIAFBAXENACABQQNxRQ0BIAMgAygCACIBayIDQeigwAAoAgBJDQEgACABaiEAIANB7KDAACgCAEcEQCABQf8BTQRAIAMoAggiAiABQQN2IgRBA3RBgKHAAGpGGiACIAMoAgwiAUYEQEHYoMAAQdigwAAoAgBBfiAEd3E2AgAMAwsgAiABNgIMIAEgAjYCCAwCCyADKAIYIQYCQCADIAMoAgwiAUcEQCADKAIIIgIgATYCDCABIAI2AggMAQsCQCADQRRqIgIoAgAiBA0AIANBEGoiAigCACIEDQBBACEBDAELA0AgAiEHIAQiAUEUaiICKAIAIgQNACABQRBqIQIgASgCECIEDQALIAdBADYCAAsgBkUNAQJAIAMgAygCHCICQQJ0QYijwABqIgQoAgBGBEAgBCABNgIAIAENAUHcoMAAQdygwAAoAgBBfiACd3E2AgAMAwsgBkEQQRQgBigCECADRhtqIAE2AgAgAUUNAgsgASAGNgIYIAMoAhAiAgRAIAEgAjYCECACIAE2AhgLIAMoAhQiAkUNASABIAI2AhQgAiABNgIYDAELIAUoAgQiAUEDcUEDRw0AQeCgwAAgADYCACAFIAFBfnE2AgQgAyAAQQFyNgIEIAAgA2ogADYCAA8LIAMgBU8NACAFKAIEIgFBAXFFDQACQCABQQJxRQRAIAVB8KDAACgCAEYEQEHwoMAAIAM2AgBB5KDAAEHkoMAAKAIAIABqIgA2AgAgAyAAQQFyNgIEIANB7KDAACgCAEcNA0HgoMAAQQA2AgBB7KDAAEEANgIADwsgBUHsoMAAKAIARgRAQeygwAAgAzYCAEHgoMAAQeCgwAAoAgAgAGoiADYCACADIABBAXI2AgQgACADaiAANgIADwsgAUF4cSAAaiEAAkAgAUH/AU0EQCAFKAIIIgIgAUEDdiIEQQN0QYChwABqRhogAiAFKAIMIgFGBEBB2KDAAEHYoMAAKAIAQX4gBHdxNgIADAILIAIgATYCDCABIAI2AggMAQsgBSgCGCEGAkAgBSAFKAIMIgFHBEAgBSgCCCICQeigwAAoAgBJGiACIAE2AgwgASACNgIIDAELAkAgBUEUaiICKAIAIgQNACAFQRBqIgIoAgAiBA0AQQAhAQwBCwNAIAIhByAEIgFBFGoiAigCACIEDQAgAUEQaiECIAEoAhAiBA0ACyAHQQA2AgALIAZFDQACQCAFIAUoAhwiAkECdEGIo8AAaiIEKAIARgRAIAQgATYCACABDQFB3KDAAEHcoMAAKAIAQX4gAndxNgIADAILIAZBEEEUIAYoAhAgBUYbaiABNgIAIAFFDQELIAEgBjYCGCAFKAIQIgIEQCABIAI2AhAgAiABNgIYCyAFKAIUIgJFDQAgASACNgIUIAIgATYCGAsgAyAAQQFyNgIEIAAgA2ogADYCACADQeygwAAoAgBHDQFB4KDAACAANgIADwsgBSABQX5xNgIEIAMgAEEBcjYCBCAAIANqIAA2AgALIABB/wFNBEAgAEEDdiIBQQN0QYChwABqIQACf0HYoMAAKAIAIgJBASABdCIBcUUEQEHYoMAAIAEgAnI2AgAgAAwBCyAAKAIICyECIAAgAzYCCCACIAM2AgwgAyAANgIMIAMgAjYCCA8LQR8hAiADQgA3AhAgAEH///8HTQRAIABBCHYiASABQYD+P2pBEHZBCHEiAXQiAiACQYDgH2pBEHZBBHEiAnQiBCAEQYCAD2pBEHZBAnEiBHRBD3YgASACciAEcmsiAUEBdCAAIAFBFWp2QQFxckEcaiECCyADIAI2AhwgAkECdEGIo8AAaiEBAkACQAJAQdygwAAoAgAiBEEBIAJ0IgdxRQRAQdygwAAgBCAHcjYCACABIAM2AgAgAyABNgIYDAELIABBAEEZIAJBAXZrIAJBH0YbdCECIAEoAgAhAQNAIAEiBCgCBEF4cSAARg0CIAJBHXYhASACQQF0IQIgBCABQQRxaiIHQRBqKAIAIgENAAsgByADNgIQIAMgBDYCGAsgAyADNgIMIAMgAzYCCAwBCyAEKAIIIgAgAzYCDCAEIAM2AgggA0EANgIYIAMgBDYCDCADIAA2AggLQfigwABB+KDAACgCAEEBayIAQX8gABs2AgALC5IvAQt/IwBBEGsiCyQAAkACQAJAAkACQAJAAkACQAJAAkACQCAAQfQBTQRAQdigwAAoAgAiBkEQIABBC2pBeHEgAEELSRsiB0EDdiICdiIBQQNxBEAgAUF/c0EBcSACaiIDQQN0IgFBiKHAAGooAgAiBEEIaiEAAkAgBCgCCCICIAFBgKHAAGoiAUYEQEHYoMAAIAZBfiADd3E2AgAMAQsgAiABNgIMIAEgAjYCCAsgBCADQQN0IgFBA3I2AgQgASAEaiIBIAEoAgRBAXI2AgQMDAsgB0HgoMAAKAIAIgpNDQEgAQRAAkBBAiACdCIAQQAgAGtyIAEgAnRxIgBBACAAa3FBAWsiACAAQQx2QRBxIgJ2IgFBBXZBCHEiACACciABIAB2IgFBAnZBBHEiAHIgASAAdiIBQQF2QQJxIgByIAEgAHYiAUEBdkEBcSIAciABIAB2aiIDQQN0IgBBiKHAAGooAgAiBCgCCCIBIABBgKHAAGoiAEYEQEHYoMAAIAZBfiADd3EiBjYCAAwBCyABIAA2AgwgACABNgIICyAEQQhqIQAgBCAHQQNyNgIEIAQgB2oiAiADQQN0IgEgB2siA0EBcjYCBCABIARqIAM2AgAgCgRAIApBA3YiAUEDdEGAocAAaiEFQeygwAAoAgAhBAJ/IAZBASABdCIBcUUEQEHYoMAAIAEgBnI2AgAgBQwBCyAFKAIICyEBIAUgBDYCCCABIAQ2AgwgBCAFNgIMIAQgATYCCAtB7KDAACACNgIAQeCgwAAgAzYCAAwMC0HcoMAAKAIAIglFDQEgCUEAIAlrcUEBayIAIABBDHZBEHEiAnYiAUEFdkEIcSIAIAJyIAEgAHYiAUECdkEEcSIAciABIAB2IgFBAXZBAnEiAHIgASAAdiIBQQF2QQFxIgByIAEgAHZqQQJ0QYijwABqKAIAIgEoAgRBeHEgB2shAyABIQIDQAJAIAIoAhAiAEUEQCACKAIUIgBFDQELIAAoAgRBeHEgB2siAiADIAIgA0kiAhshAyAAIAEgAhshASAAIQIMAQsLIAEoAhghCCABIAEoAgwiBEcEQCABKAIIIgBB6KDAACgCAEkaIAAgBDYCDCAEIAA2AggMCwsgAUEUaiICKAIAIgBFBEAgASgCECIARQ0DIAFBEGohAgsDQCACIQUgACIEQRRqIgIoAgAiAA0AIARBEGohAiAEKAIQIgANAAsgBUEANgIADAoLQX8hByAAQb9/Sw0AIABBC2oiAEF4cSEHQdygwAAoAgAiCUUNAEEAIAdrIQMCQAJAAkACf0EAIAdBgAJJDQAaQR8gB0H///8HSw0AGiAAQQh2IgAgAEGA/j9qQRB2QQhxIgJ0IgAgAEGA4B9qQRB2QQRxIgF0IgAgAEGAgA9qQRB2QQJxIgB0QQ92IAEgAnIgAHJrIgBBAXQgByAAQRVqdkEBcXJBHGoLIgZBAnRBiKPAAGooAgAiAkUEQEEAIQAMAQtBACEAIAdBAEEZIAZBAXZrIAZBH0YbdCEBA0ACQCACKAIEQXhxIAdrIgUgA08NACACIQQgBSIDDQBBACEDIAIhAAwDCyAAIAIoAhQiBSAFIAIgAUEddkEEcWooAhAiAkYbIAAgBRshACABQQF0IQEgAg0ACwsgACAEckUEQEEAIQRBAiAGdCIAQQAgAGtyIAlxIgBFDQMgAEEAIABrcUEBayIAIABBDHZBEHEiAnYiAUEFdkEIcSIAIAJyIAEgAHYiAUECdkEEcSIAciABIAB2IgFBAXZBAnEiAHIgASAAdiIBQQF2QQFxIgByIAEgAHZqQQJ0QYijwABqKAIAIQALIABFDQELA0AgACgCBEF4cSAHayIBIANJIQIgASADIAIbIQMgACAEIAIbIQQgACgCECIBBH8gAQUgACgCFAsiAA0ACwsgBEUNACADQeCgwAAoAgAgB2tPDQAgBCgCGCEGIAQgBCgCDCIBRwRAIAQoAggiAEHooMAAKAIASRogACABNgIMIAEgADYCCAwJCyAEQRRqIgIoAgAiAEUEQCAEKAIQIgBFDQMgBEEQaiECCwNAIAIhBSAAIgFBFGoiAigCACIADQAgAUEQaiECIAEoAhAiAA0ACyAFQQA2AgAMCAsgB0HgoMAAKAIAIgJNBEBB7KDAACgCACEDAkAgAiAHayIBQRBPBEBB4KDAACABNgIAQeygwAAgAyAHaiIANgIAIAAgAUEBcjYCBCACIANqIAE2AgAgAyAHQQNyNgIEDAELQeygwABBADYCAEHgoMAAQQA2AgAgAyACQQNyNgIEIAIgA2oiACAAKAIEQQFyNgIECyADQQhqIQAMCgsgB0HkoMAAKAIAIghJBEBB5KDAACAIIAdrIgE2AgBB8KDAAEHwoMAAKAIAIgIgB2oiADYCACAAIAFBAXI2AgQgAiAHQQNyNgIEIAJBCGohAAwKC0EAIQAgB0EvaiIJAn9BsKTAACgCAARAQbikwAAoAgAMAQtBvKTAAEJ/NwIAQbSkwABCgKCAgICABDcCAEGwpMAAIAtBDGpBcHFB2KrVqgVzNgIAQcSkwABBADYCAEGUpMAAQQA2AgBBgCALIgFqIgZBACABayIFcSICIAdNDQlBkKTAACgCACIEBEBBiKTAACgCACIDIAJqIgEgA00NCiABIARLDQoLQZSkwAAtAABBBHENBAJAAkBB8KDAACgCACIDBEBBmKTAACEAA0AgAyAAKAIAIgFPBEAgASAAKAIEaiADSw0DCyAAKAIIIgANAAsLQQAQBCIBQX9GDQUgAiEGQbSkwAAoAgAiA0EBayIAIAFxBEAgAiABayAAIAFqQQAgA2txaiEGCyAGIAdNDQUgBkH+////B0sNBUGQpMAAKAIAIgQEQEGIpMAAKAIAIgMgBmoiACADTQ0GIAAgBEsNBgsgBhAEIgAgAUcNAQwHCyAGIAhrIAVxIgZB/v///wdLDQQgBhAEIgEgACgCACAAKAIEakYNAyABIQALAkAgAEF/Rg0AIAdBMGogBk0NAEG4pMAAKAIAIgEgCSAGa2pBACABa3EiAUH+////B0sEQCAAIQEMBwsgARAEQX9HBEAgASAGaiEGIAAhAQwHC0EAIAZrEAQaDAQLIAAiAUF/Rw0FDAMLQQAhBAwHC0EAIQEMBQsgAUF/Rw0CC0GUpMAAQZSkwAAoAgBBBHI2AgALIAJB/v///wdLDQEgAhAEIQFBABAEIQAgAUF/Rg0BIABBf0YNASAAIAFNDQEgACABayIGIAdBKGpNDQELQYikwABBiKTAACgCACAGaiIANgIAQYykwAAoAgAgAEkEQEGMpMAAIAA2AgALAkACQAJAQfCgwAAoAgAiBQRAQZikwAAhAANAIAEgACgCACIDIAAoAgQiAmpGDQIgACgCCCIADQALDAILQeigwAAoAgAiAEEAIAAgAU0bRQRAQeigwAAgATYCAAtBACEAQZykwAAgBjYCAEGYpMAAIAE2AgBB+KDAAEF/NgIAQfygwABBsKTAACgCADYCAEGkpMAAQQA2AgADQCAAQQN0IgNBiKHAAGogA0GAocAAaiICNgIAIANBjKHAAGogAjYCACAAQQFqIgBBIEcNAAtB5KDAACAGQShrIgNBeCABa0EHcUEAIAFBCGpBB3EbIgBrIgI2AgBB8KDAACAAIAFqIgA2AgAgACACQQFyNgIEIAEgA2pBKDYCBEH0oMAAQcCkwAAoAgA2AgAMAgsgAC0ADEEIcQ0AIAMgBUsNACABIAVNDQAgACACIAZqNgIEQfCgwAAgBUF4IAVrQQdxQQAgBUEIakEHcRsiAGoiAjYCAEHkoMAAQeSgwAAoAgAgBmoiASAAayIANgIAIAIgAEEBcjYCBCABIAVqQSg2AgRB9KDAAEHApMAAKAIANgIADAELQeigwAAoAgAgAUsEQEHooMAAIAE2AgALIAEgBmohAkGYpMAAIQACQAJAAkACQAJAAkADQCACIAAoAgBHBEAgACgCCCIADQEMAgsLIAAtAAxBCHFFDQELQZikwAAhAANAIAUgACgCACICTwRAIAIgACgCBGoiBCAFSw0DCyAAKAIIIQAMAAsACyAAIAE2AgAgACAAKAIEIAZqNgIEIAFBeCABa0EHcUEAIAFBCGpBB3EbaiIJIAdBA3I2AgQgAkF4IAJrQQdxQQAgAkEIakEHcRtqIgYgByAJaiIIayECIAUgBkYEQEHwoMAAIAg2AgBB5KDAAEHkoMAAKAIAIAJqIgA2AgAgCCAAQQFyNgIEDAMLIAZB7KDAACgCAEYEQEHsoMAAIAg2AgBB4KDAAEHgoMAAKAIAIAJqIgA2AgAgCCAAQQFyNgIEIAAgCGogADYCAAwDCyAGKAIEIgBBA3FBAUYEQCAAQXhxIQUCQCAAQf8BTQRAIAYoAggiAyAAQQN2IgBBA3RBgKHAAGpGGiADIAYoAgwiAUYEQEHYoMAAQdigwAAoAgBBfiAAd3E2AgAMAgsgAyABNgIMIAEgAzYCCAwBCyAGKAIYIQcCQCAGIAYoAgwiAUcEQCAGKAIIIgAgATYCDCABIAA2AggMAQsCQCAGQRRqIgAoAgAiAw0AIAZBEGoiACgCACIDDQBBACEBDAELA0AgACEEIAMiAUEUaiIAKAIAIgMNACABQRBqIQAgASgCECIDDQALIARBADYCAAsgB0UNAAJAIAYgBigCHCIDQQJ0QYijwABqIgAoAgBGBEAgACABNgIAIAENAUHcoMAAQdygwAAoAgBBfiADd3E2AgAMAgsgB0EQQRQgBygCECAGRhtqIAE2AgAgAUUNAQsgASAHNgIYIAYoAhAiAARAIAEgADYCECAAIAE2AhgLIAYoAhQiAEUNACABIAA2AhQgACABNgIYCyAFIAZqIQYgAiAFaiECCyAGIAYoAgRBfnE2AgQgCCACQQFyNgIEIAIgCGogAjYCACACQf8BTQRAIAJBA3YiAEEDdEGAocAAaiECAn9B2KDAACgCACIBQQEgAHQiAHFFBEBB2KDAACAAIAFyNgIAIAIMAQsgAigCCAshACACIAg2AgggACAINgIMIAggAjYCDCAIIAA2AggMAwtBHyEAIAJB////B00EQCACQQh2IgAgAEGA/j9qQRB2QQhxIgN0IgAgAEGA4B9qQRB2QQRxIgF0IgAgAEGAgA9qQRB2QQJxIgB0QQ92IAEgA3IgAHJrIgBBAXQgAiAAQRVqdkEBcXJBHGohAAsgCCAANgIcIAhCADcCECAAQQJ0QYijwABqIQQCQEHcoMAAKAIAIgNBASAAdCIBcUUEQEHcoMAAIAEgA3I2AgAgBCAINgIAIAggBDYCGAwBCyACQQBBGSAAQQF2ayAAQR9GG3QhACAEKAIAIQEDQCABIgMoAgRBeHEgAkYNAyAAQR12IQEgAEEBdCEAIAMgAUEEcWoiBCgCECIBDQALIAQgCDYCECAIIAM2AhgLIAggCDYCDCAIIAg2AggMAgtB5KDAACAGQShrIgNBeCABa0EHcUEAIAFBCGpBB3EbIgBrIgI2AgBB8KDAACAAIAFqIgA2AgAgACACQQFyNgIEIAEgA2pBKDYCBEH0oMAAQcCkwAAoAgA2AgAgBSAEQScgBGtBB3FBACAEQSdrQQdxG2pBL2siACAAIAVBEGpJGyICQRs2AgQgAkGgpMAAKQIANwIQIAJBmKTAACkCADcCCEGgpMAAIAJBCGo2AgBBnKTAACAGNgIAQZikwAAgATYCAEGkpMAAQQA2AgAgAkEYaiEAA0AgAEEHNgIEIABBCGohASAAQQRqIQAgASAESQ0ACyACIAVGDQMgAiACKAIEQX5xNgIEIAUgAiAFayIEQQFyNgIEIAIgBDYCACAEQf8BTQRAIARBA3YiAEEDdEGAocAAaiECAn9B2KDAACgCACIBQQEgAHQiAHFFBEBB2KDAACAAIAFyNgIAIAIMAQsgAigCCAshACACIAU2AgggACAFNgIMIAUgAjYCDCAFIAA2AggMBAtBHyEAIAVCADcCECAEQf///wdNBEAgBEEIdiIAIABBgP4/akEQdkEIcSICdCIAIABBgOAfakEQdkEEcSIBdCIAIABBgIAPakEQdkECcSIAdEEPdiABIAJyIAByayIAQQF0IAQgAEEVanZBAXFyQRxqIQALIAUgADYCHCAAQQJ0QYijwABqIQMCQEHcoMAAKAIAIgJBASAAdCIBcUUEQEHcoMAAIAEgAnI2AgAgAyAFNgIAIAUgAzYCGAwBCyAEQQBBGSAAQQF2ayAAQR9GG3QhACADKAIAIQEDQCABIgIoAgRBeHEgBEYNBCAAQR12IQEgAEEBdCEAIAIgAUEEcWoiAygCECIBDQALIAMgBTYCECAFIAI2AhgLIAUgBTYCDCAFIAU2AggMAwsgAygCCCIAIAg2AgwgAyAINgIIIAhBADYCGCAIIAM2AgwgCCAANgIICyAJQQhqIQAMBQsgAigCCCIAIAU2AgwgAiAFNgIIIAVBADYCGCAFIAI2AgwgBSAANgIIC0HkoMAAKAIAIgAgB00NAEHkoMAAIAAgB2siATYCAEHwoMAAQfCgwAAoAgAiAiAHaiIANgIAIAAgAUEBcjYCBCACIAdBA3I2AgQgAkEIaiEADAMLQdSgwABBMDYCAEEAIQAMAgsCQCAGRQ0AAkAgBCgCHCICQQJ0QYijwABqIgAoAgAgBEYEQCAAIAE2AgAgAQ0BQdygwAAgCUF+IAJ3cSIJNgIADAILIAZBEEEUIAYoAhAgBEYbaiABNgIAIAFFDQELIAEgBjYCGCAEKAIQIgAEQCABIAA2AhAgACABNgIYCyAEKAIUIgBFDQAgASAANgIUIAAgATYCGAsCQCADQQ9NBEAgBCADIAdqIgBBA3I2AgQgACAEaiIAIAAoAgRBAXI2AgQMAQsgBCAHQQNyNgIEIAQgB2oiBSADQQFyNgIEIAMgBWogAzYCACADQf8BTQRAIANBA3YiAEEDdEGAocAAaiECAn9B2KDAACgCACIBQQEgAHQiAHFFBEBB2KDAACAAIAFyNgIAIAIMAQsgAigCCAshACACIAU2AgggACAFNgIMIAUgAjYCDCAFIAA2AggMAQtBHyEAIANB////B00EQCADQQh2IgAgAEGA/j9qQRB2QQhxIgJ0IgAgAEGA4B9qQRB2QQRxIgF0IgAgAEGAgA9qQRB2QQJxIgB0QQ92IAEgAnIgAHJrIgBBAXQgAyAAQRVqdkEBcXJBHGohAAsgBSAANgIcIAVCADcCECAAQQJ0QYijwABqIQECQAJAIAlBASAAdCICcUUEQEHcoMAAIAIgCXI2AgAgASAFNgIADAELIANBAEEZIABBAXZrIABBH0YbdCEAIAEoAgAhBwNAIAciASgCBEF4cSADRg0CIABBHXYhAiAAQQF0IQAgASACQQRxaiICKAIQIgcNAAsgAiAFNgIQCyAFIAE2AhggBSAFNgIMIAUgBTYCCAwBCyABKAIIIgAgBTYCDCABIAU2AgggBUEANgIYIAUgATYCDCAFIAA2AggLIARBCGohAAwBCwJAIAhFDQACQCABKAIcIgJBAnRBiKPAAGoiACgCACABRgRAIAAgBDYCACAEDQFB3KDAACAJQX4gAndxNgIADAILIAhBEEEUIAgoAhAgAUYbaiAENgIAIARFDQELIAQgCDYCGCABKAIQIgAEQCAEIAA2AhAgACAENgIYCyABKAIUIgBFDQAgBCAANgIUIAAgBDYCGAsCQCADQQ9NBEAgASADIAdqIgBBA3I2AgQgACABaiIAIAAoAgRBAXI2AgQMAQsgASAHQQNyNgIEIAEgB2oiAiADQQFyNgIEIAIgA2ogAzYCACAKBEAgCkEDdiIAQQN0QYChwABqIQVB7KDAACgCACEEAn9BASAAdCIAIAZxRQRAQdigwAAgACAGcjYCACAFDAELIAUoAggLIQAgBSAENgIIIAAgBDYCDCAEIAU2AgwgBCAANgIIC0HsoMAAIAI2AgBB4KDAACADNgIACyABQQhqIQALIAtBEGokACAAC9YCAQF/AkAgAUUNACAAQQA6AAAgACABaiICQQFrQQA6AAAgAUEDSQ0AIABBADoAAiAAQQA6AAEgAkEDa0EAOgAAIAJBAmtBADoAACABQQdJDQAgAEEAOgADIAJBBGtBADoAACABQQlJDQAgAEEAIABrQQNxIgJqIgBBADYCACAAIAEgAmtBfHEiAmoiAUEEa0EANgIAIAJBCUkNACAAQQA2AgggAEEANgIEIAFBCGtBADYCACABQQxrQQA2AgAgAkEZSQ0AIABBADYCGCAAQQA2AhQgAEEANgIQIABBADYCDCABQRBrQQA2AgAgAUEUa0EANgIAIAFBGGtBADYCACABQRxrQQA2AgAgAiAAQQRxQRhyIgJrIgFBIEkNACAAIAJqIQADQCAAQgA3AxggAEIANwMQIABCADcDCCAAQgA3AwAgAEEgaiEAIAFBIGsiAUEfSw0ACwsLAwABC7AEAQd/AkAgACgCACIGQYCAgAhPBEAgACgCBCEEDAELIAAgBkEIdCIGNgIAIAAgACgCECIDQQFqNgIQIAAgAyAAKAIMai0AACAAKAIEQQh0ciIENgIECwJ/IAEvAQAiBSAGQQt2bCIDIARLBEAgASAFQYAQIAVrQQV2ajsBACABIAJBBHRqQQRqIQhBAiEFQQgMAQsgACAEIANrIgQ2AgQgASAFIAVBBXZrOwEAIAYgA2siBkH///8HTQRAIAAgBkEIdCIGNgIAIAAgACgCECIDQQFqNgIQIAAgAyAAKAIMai0AACAEQQh0ciIENgIECyABLwECIgUgBkELdmwiAyAESwRAIAEgBUGAECAFa0EFdmo7AQIgASACQQR0akGEAmohCEEKIQVBCAwBCyAAIAQgA2siBDYCBCABIAUgBUEFdms7AQIgAUGEBGohCCAGIANrIQNBEiEFQYACCyEGIAAgBTYCaEEBIQEDQCAIIAFBAXQiAWohCQJAIANB////B0sEQCADIQIMAQsgACADQQh0IgI2AgAgACAAKAIQIgNBAWo2AhAgACADIAAoAgxqLQAAIARBCHRyIgQ2AgQLAkAgCS8BACIHIAJBC3ZsIgMgBE0EQCAAIAQgA2siBDYCBCAAIAIgA2siAzYCACAJIAcgB0EFdms7AQAgAUEBciEBDAELIAAgAzYCACAJIAdBgBAgB2tBBXZqOwEACyABIAZJDQALIAAgASAGayAFajYCaAvIHwEQfwJAIAAoAigiASAAKAIgIglNDQAgACgCaCICRQ0AIAAoAlQiAyAAKAIkTw0AIAAoAjAgA00NACAAIAIgASAJayIBIAIgASACSRsiBms2AmggCSADQX9zaiEEIAMgCU8EQCAAKAIsIARqIQQLIAAoAhgiAyAEai0AACEBIAAgCUEBajYCICADIAlqIAE6AAACQCAGQQFrIgdFDQAgB0EBcQRAIAAoAhgiAkEAIARBAWoiASABIAAoAixGGyIEai0AACEDIAAgACgCICIBQQFqNgIgIAEgAmogAzoAACAGQQJrIQcLIAZBAkYNAANAIAAoAhgiAkEAIARBAWoiASABIAAoAixGGyIGai0AACEDIAAgACgCICIBQQFqNgIgIAEgAmogAzoAACAAKAIYIgJBACAGQQFqIgEgASAAKAIsRhsiBGotAAAhAyAAIAAoAiAiAUEBajYCICABIAJqIAM6AAAgB0ECayIHDQALCyAAKAIgIgkgACgCJE0NACAAIAk2AiQLAkACQCAJIAAoAihPDQAgAEHcDWohDiAAQeAVaiEPIABB1ABqIRADQCAAKAIQIgMgACgCFEsNASAAIAAoAmQiCkEFdGogACgCdCAJcSIIQQF0aiIMIQYCQCAAKAIAIgVBgICACE8EQCAAKAIEIQQMAQsgACAFQQh0IgU2AgAgACADQQFqIgE2AhAgACAAKAIMIANqLQAAIAAoAgRBCHRyIgQ2AgQgASEDCwJAIAYvAXgiASAFQQt2bCICIARLBEAgACACNgIAIAYgAUGAECABa0EFdmo7AXggCUEBayEFIAlFBEAgACgCLCAFaiEFCyAAKAJwIAlxIAAoAmwiAXQgACgCJCIGBH8gACgCGCAFai0AAAVBAAtBCCABa3ZqIQ1BASEFAkAgCkEGTQRAA0AgBUEBdCIFIAAgDUGADGxqakHkHWohBgJAIAJB////B0sEQCACIQEMAQsgACACQQh0IgE2AgAgACADQQFqIgI2AhAgACAAKAIMIANqLQAAIARBCHRyIgQ2AgQgAiEDCwJAIAYvAQAiCCABQQt2bCICIARNBEAgACAEIAJrIgQ2AgQgACABIAJrIgI2AgAgBiAIIAhBBXZrOwEAIAVBAXIhBQwBCyAAIAI2AgAgBiAIQYAQIAhrQQV2ajsBAAsgBUGAAkkNAAwCCwALIAkgACgCVCIBQX9zaiEFIAEgCU8EQCAAKAIsIAVqIQULIAYEfyAAKAIYIAVqLQAABUEACyEGQQEhBUGAAiEHA0AgACANQYAMbGogBkEBdCIGIAdxIgwgB2ogBWpBAXRqQeQdaiELAkAgAkH///8HSwRAIAIhCAwBCyAAIAJBCHQiCDYCACAAIANBAWoiATYCECAAIAAoAgwgA2otAAAgBEEIdHIiBDYCBCABIQMLIAsCfyAEIAsvAQAiASAIQQt2bCICTyIKRQRAIAAgAjYCACABQYAQIAFrQQV2agwBCyAAIAQgAmsiBDYCBCAAIAggAmsiAjYCAEEAIQcgASABQQV2aws7AQAgByAMcyEHIAVBAXQgCnIiBUGAAkkNAAsLIAAgCUEBajYCICAAKAIYIAlqIAU6AAAgACgCICIJIAAoAiRLBEAgACAJNgIkC0EAIQIgACAAKAJkIgFBBE8EfyABQQlNBEAgACABQQNrNgJkDAMLIAFBBmsFQQALNgJkDAELIAAgBCACayIENgIEIAAgBSACayICNgIAIAYgASABQQV2azsBeCAAIApBAXRqIgshBgJAIAJB////B0sEQCADIQEMAQsgACACQQh0IgI2AgAgACADQQFqIgE2AhAgACAAKAIMIANqLQAAIARBCHRyIgQ2AgQLAkAgBi8B+AMiCiACQQt2bCIDIARNBEAgACAEIANrIgQ2AgQgACACIANrIgI2AgAgBiAKIApBBXZrOwH4AwJAIAJB////B0sEQCABIQYMAQsgACACQQh0IgI2AgAgACABQQFqIgY2AhAgACAAKAIMIAFqLQAAIARBCHRyIgQ2AgQLAkAgCy8BkAQiASACQQt2bCIFIARLBEAgCyABQYAQIAFrQQV2ajsBkAQgBUH///8HTQRAIAAgBUEIdCIFNgIAIAAgBkEBajYCECAAIAAoAgwgBmotAAAgBEEIdHIiBDYCBAsgDC8B2AQiAyAFQQt2bCIBIARNBEAgACAEIAFrNgIEIAAgBSABazYCACAMIAMgA0EFdms7AdgEDAILIAAgATYCACAMIANBgBAgA2tBBXZqOwHYBCAAQQE2AmggAEEJQQsgACgCZEEHSRs2AmQMAwsgACAEIAVrIgQ2AgQgCyABIAFBBXZrOwGQBAJAIAIgBWsiAkH///8HSwRAIAYhAQwBCyAAIAJBCHQiAjYCACAAIAZBAWoiATYCECAAIAAoAgwgBmotAAAgBEEIdHIiBDYCBAsCQCALLwGoBCIGIAJBC3ZsIgMgBEsEQCAAIAM2AgAgCyAGQYAQIAZrQQV2ajsBqAQgACgCWCECDAELIAAgBCADayIENgIEIAsgBiAGQQV2azsBqAQgAiADayICQf///wdNBEAgACACQQh0IgI2AgAgACABQQFqNgIQIAAgACgCDCABai0AACAEQQh0ciIENgIECwJAIAsvAcAEIgMgAkELdmwiASAESwRAIAAgATYCACALIANBgBAgA2tBBXZqOwHABCAAKAJcIQIMAQsgACAEIAFrNgIEIAAgAiABazYCACALIAMgA0EFdms7AcAEIAAoAmAhAiAAIAAoAlw2AmALIAAgACgCWDYCXAsgACAAKAJUNgJYIAAgAjYCVAsgAEEIQQsgACgCZEEHSRs2AmQgACAPIAgQCQwBCyAAIAM2AgAgBiAKQYAQIAprQQV2ajsB+AMgACAAKAJcNgJgIAAgACkCVDcCWCAAQQdBCiAAKAJkQQdJGzYCZCAAIA4gCBAJIAAoAmgiAUECa0EDIAFBBkkbIQMgACgCACECQQEhBANAIARBAXQiBCAAIANBB3RqaiEGAkAgAkGAgIAITwRAIAAoAgQhBQwBCyAAIAJBCHQiAjYCACAAIAAoAhAiAUEBajYCECAAIAEgACgCDGotAAAgACgCBEEIdHIiBTYCBAsCQCAGLwHYByIIIAJBC3ZsIgEgBU0EQCAAIAUgAWsiBTYCBCAAIAIgAWsiAjYCACAGIAggCEEFdms7AdgHIARBAXIhBAwBCyAAIAE2AgAgBiAIQYAQIAhrQQV2ajsB2AcgASECCyAEQcAASQ0ACyAEQUBqIgNBA00EQCAAIAM2AlQMAQsgACAEQQFxQQJyIgc2AlQgA0EBdiEBIANBDU0EQCAAIAcgAUEBayIKdCIINgJUQQEhByAQIAhBAXRqQQAgBGtBAXRqQYIMaiEGQQAhCwNAIAYgB0EBdCIHaiEMAkAgAkH///8HSwRAIAIhAQwBCyAAIAJBCHQiATYCACAAIAAoAhAiA0EBajYCECAAIAMgACgCDGotAAAgBUEIdHIiBTYCBAsCQCAMLwEAIgMgAUELdmwiAiAFTQRAIAAgBSACayIFNgIEIAAgASACayICNgIAIAwgAyADQQV2azsBACAAQQEgC3QgCGoiCDYCVCAHQQFyIQcMAQsgACACNgIAIAwgA0GAECADa0EFdmo7AQALIAtBAWoiCyAKRw0ACwwBCyABQQVrIQQDQAJAIAJB////B0sEQCACIQMMAQsgACACQQh0IgM2AgAgACAAKAIQIgFBAWo2AhAgASAAKAIMai0AACAFQQh0ciEFCyAAIANBAXYiAjYCACAAIAUgAmsiBkEfdSIBIAdBAXRqQQFqIgc2AlQgACABIAJxIAZqIgU2AgQgBEEBayIEDQALIAAgB0EEdCIHNgJUIANB////D00EQCAAIAJBCHQiAjYCACAAIAAoAhAiAUEBajYCECAAIAEgACgCDGotAAAgBUEIdHIiBTYCBAsgAAJ/IAAvAb4NIgEgAkELdmwiBCAFTQRAIAAgBSAEayIFNgIEIAAgB0EBciIHNgJUIAAgASABQQV2azsBvg0gAiAEayEEQQMMAQsgACABQYAQIAFrQQV2ajsBvg1BAgtBAXQiA2pBvA1qIQYgBEH///8HTQRAIAAgBEEIdCIENgIAIAAgACgCECIBQQFqNgIQIAAgASAAKAIMai0AACAFQQh0ciIFNgIECwJAIAYvAQAiASAEQQt2bCICIAVNBEAgACAFIAJrIgU2AgQgBiABIAFBBXZrOwEAIAAgB0ECaiIHNgJUIAQgAmshAiADQQFyIQMMAQsgBiABQYAQIAFrQQV2ajsBAAsgACADQQF0IgNqQbwNaiEGIAJB////B00EQCAAIAJBCHQiAjYCACAAIAAoAhAiAUEBajYCECAAIAEgACgCDGotAAAgBUEIdHIiBTYCBAsCQCAGLwEAIgEgAkELdmwiBCAFTQRAIAAgBSAEayIFNgIEIAYgASABQQV2azsBACAAIAdBBGoiBzYCVCACIARrIQQgA0EBciEDDAELIAYgAUGAECABa0EFdmo7AQALIARB////B00EQCAAIARBCHQiBDYCACAAIAAoAhAiAUEBajYCECAAIAEgACgCDGotAAAgBUEIdHIiBTYCBAsgACADQQF0akG8DWoiAS8BACICIARBC3ZsIgMgBU0EQCAAIAUgA2s2AgQgACAEIANrNgIAIAEgAiACQQV2azsBACAAIAdBCGo2AlQMAQsgACADNgIAIAEgAkGAECACa0EFdmo7AQALQQAhAiAAKAJUIgYgACgCJE8NAyAAKAIwIAZNDQMgACAAKAJoIgMgACgCKCAAKAIgIgprIgEgAyABIANJGyIIazYCaCAKIAZBf3NqIQIgBiAKTwRAIAAoAiwgAmohAgsgACgCGCIDIAJqLQAAIQEgACAKQQFqNgIgIAMgCmogAToAAAJAIAhBAWsiBUUNACAFQQFxBEAgACgCGCIGQQAgAkEBaiIBIAEgACgCLEYbIgJqLQAAIQMgACAAKAIgIgFBAWo2AiAgASAGaiADOgAAIAhBAmshBQsgCEECRg0AA0AgACgCGCIGQQAgAkEBaiIBIAEgACgCLEYbIgJqLQAAIQMgACAAKAIgIgFBAWo2AiAgASAGaiADOgAAIAAoAhgiBkEAIAJBAWoiASABIAAoAixGGyICai0AACEDIAAgACgCICIBQQFqNgIgIAEgBmogAzoAACAFQQJrIgUNAAsLIAAoAiAiCSAAKAIkTQ0AIAAgCTYCJAsgCSAAKAIoSQ0ACwtBASECIAAoAgAiAUH///8HSw0AIAAgAUEIdDYCACAAIAAoAhAiAUEBajYCECAAIAEgACgCDGotAAAgACgCBEEIdHI2AgQLIAILJgEBfyAABEAgACgCsAkiASgCPARAIAEoAhgQBQsgARAFIAAQBQsLMgEBfyAAIAApA4ABIAIgACgCECICayIDrXw3A4ABIAAgASACaiADIAAoAhgQA603AxgLgQEBAn8CQAJAIAJBBE8EQCAAIAFyQQNxDQEDQCAAKAIAIAEoAgBHDQIgAUEEaiEBIABBBGohACACQQRrIgJBA0sNAAsLIAJFDQELA0AgAC0AACIDIAEtAAAiBEYEQCABQQFqIQEgAEEBaiEAIAJBAWsiAg0BDAILCyADIARrDwtBAAsJAEG8oCAoAgALCQBBsKAgKAIAC9QzAhR/An4CQAJAAkACQAJAAkACQAJAAn8Cf0HQoMAAKAIAIgEoAiQEQCABKAIADAELIAFBADoAKCABQgA3AwAgAUIANwMYIAFByABqQeQAEAcgAUEMNgKsAUEACyEAQcCgICgCACENIAFBtKAgKAIAIg42AhAgAUHgAGohDyABQbYBaiEQIAFBsAFqIREgAUGoAWohCANAAkACQAJAAkACQAJAAkACQAJAAkAgCAJ/AkACQAJAIAAOCgECAAoLDAQFBgcOC0GwoCAoAgAhAyABKAKsASECQbSgICgCACEAQbigICgCACEGIAEoAqgBDAILIAggASgCqAEiAGpBCGpBtKAgKAIAIgJBsKAgKAIAakG4oCAoAgAgAmsiAiABKAKsASAAayIAIAAgAksbIgAQAkG0oCBBtKAgKAIAIABqNgIAQQAhAyABQQAgASgCqAEgAGoiACAAIAEoAqwBIgJGGzYCqAEgACACRw0LIAFBATYCACARQYAIQQYQDQRAQQUhAwwMCyAQQQJBABADIAEoALgBRwRAQQchAwwMC0EGIQMgEC0AAA0LIAEgAS0AtwEiADYCICAAQQ9LDQtBAiEDIABBBEsNC0EBIAB0QRNxRQ0LC0G0oCAoAgAiAEG4oCAoAgAiBkYEQEEAIQMMCwtBsKAgKAIAIgMgAGotAAAiAkUEQEG0oCAgAEEBajYCACABIAA2AhBBBiEAIAFBBjYCAAwMCyABQQA2AqgBIAFBAjYCACABIAJBAnRBBGoiAjYCrAEgASACNgJAQQALIgVqQQhqIAAgA2ogBiAAayIAIAIgBWsiAiAAIAJJGyIAEAJBtKAgIABBtKAgKAIAajYCAEEAIQMgAUEAIAEoAqgBIABqIgAgACABKAKsASICRhs2AqgBIAAgAkcNCSABIABBBGsiADYCrAEgESAAQQAQAyABIAEoAqwBIgVqKACwAUcEQEEHIQMMCgsgAUECNgKoASABLACxASIEQT9xBEBBBiEDDAoLQQIhAEJ/IRVCfyEUIARBwABxRQ0FIAEoAgQiAkUEQCABQgA3AwgLIAVBAiAFQQJLGyEGA0AgACAGRgRAQQchAwwLCyAAIAhqLQAIIQMgASAAQQFqIgA2AqgBIAEgASkDCCADQf8Aca0gAq2GhCIUNwMIIANBgAFxRQRAAkAgAw0AIAJFDQBBByEDDAwLIAFBADYCBAwHC0EHIQMgASACQQdqIgI2AgQgAkE/Rw0ACwwJCwJ/IAFBkAFqIQYDQEG4oCAoAgAhAkGwoCAoAgAhBCABKAIEIgVFBEAgAUIANwMIC0G0oCAoAgAiACACIAAgAksbIQICQANAAkAgACACRgRAQQAhAyACIQAMAQsgACAEai0AACEDQbSgICAAQQFqIgA2AgAgASABKQMIIANB/wBxrSAFrYaEIhQ3AwggA0GAAXFFBEAgAw0DIAVFDQNBByEDDAELQQchAyABIAVBB2oiBTYCBCAFQT9HDQELCyABIAEpA4ABIAAgASgCECIAayICrXw3A4ABIAEgACAEaiACIAEoAhgQA603AxggAwwCCyABQQA2AgQCQAJAAkACQAJAIAEoAngOAwACAQMLIAEgFDcDiAFBByABKQNYIBRSDQUaIAFBATYCeAwDCyABIAEpA5gBIBR8NwOYASABIAZBGCABKAKgARADNgKgASABQQE2AnggASABKQOIAUIBfSIUNwOIAQwCCyABQQI2AnggASABKQOQASAUfDcDkAELIAEpA4gBIRQLIBRCAFINAAtBAQsiA0EBRw0IIAFBBzYCAAsCQCABKQOAASIUQbSgICgCACIAIAEoAhAiBGutfEIDg1ANAEGwoCAoAgAhBkG4oCAoAgAgAEYEQCAAIQIMBAtBtKAgIABBAWoiAjYCAEEHIQMgACAGai0AAA0IAkAgFCACIARrrXxCA4NQDQBBsKAgKAIAIQYgAkG4oCAoAgBGDQRBtKAgIABBAmoiBTYCACACIAZqLQAADQkgFCAFIARrrXxCA4NQBEAgBSEADAILQbCgICgCACEGQbigICgCACAFRgRAIAUhAgwFC0G0oCAgAEEDaiICNgIAIAUgBmotAAANCSAUIAIgBGutfEIDg1ANAEG4oCAoAgAgAkYEQEGwoCAoAgAhBgwFC0G0oCAgAEEEajYCAAwJCyACIQALIAFBsKAgKAIAIAAQDEEHIQMgDyABQZABakEYEA0NByABQQg2AgALAn9BtKAgKAIAIQBBuKAgKAIAIQUDQEEAIAAgBUYNARogASkDGCEUIAEoAgQhA0G0oCAgAEEBaiICNgIAQQdBsKAgKAIAIABqLQAAIBQgA62Ip0H/AXFHDQEaIAEgA0EIaiIDNgIEIAIhACADQSBJDQALIAFBADYCBCABQgA3AxhBAQsiA0EBRw0GIAFBCTYCACABQQw2AqwBC0EAIQMgASABKAKoASIAakGwAWpBtKAgKAIAIgJBsKAgKAIAakG4oCAoAgAgAmsiAiABKAKsASAAayIAIAAgAksbIgAQAkG0oCBBtKAgKAIAIABqNgIAIAFBACABKAKoASAAaiIAIAAgASgCrAFGIgAbNgKoASAARQ0FQQchAAJAIAEvALoBQdm0AUcNACABQbQBakEGQQAQAyABKACwAUcNACABNQC0ASABKQOAAUICiFINACABLQC4AQ0AQQFBByABKAIgIAEtALkBRhshAAsgACEDDAULIAEgBiACEAxBACEDDAQLIAEgFDcDMCAEQQBIBEAgASgCBCICRQRAIAFCADcDCAsgACAFIAAgBUsbIQQDQCAAIARGBEBBByEDDAYLIAAgCGotAAghAyABIABBAWoiADYCqAEgASABKQMIIANB/wBxrSACrYaEIhU3AwgCQCADQYABcUUEQCADDQEgAkUNAUEHIQMMBwtBByEDIAEgAkEHaiICNgIEIAJBP0cNAQwGCwsgAUEANgIECyABIBU3AzggBSAAa0ECSQRAQQchAwwECyABIABBAWoiAjYCqAEgACAIai0ACEEhRwRAQQYhAwwECyABIABBAmoiBDYCqAEgAiAIai0ACEEBRwRAQQYhAwwEC0EHIQMgBCAFRg0DIAEgAEEDajYCqAEgASgCsAkhAEEGIQICQCAEIAhqLQAIIgNBJ0sNACAAIANBAXFBAnIgA0EBdkELanQiBTYCMAJ/AkAgACgCPCIDRQ0AQQQhAiAFIAAoAjRLDQIgACAFNgIsIANBAkcNACAFIABBOGoiAygCAE0NACAAKAIYEAUgACAAKAIwEAYiAjYCGCACDQBBAwwBCyAAQQA2AkAgAEEBOgBQIABBADYCaCAAQeTdAWohA0EACyECIANBADYCAAsgAiIDDQMgASgCqAEiACABKAKsASICIAAgAksbIQMCQANAIAAgA0YNASABIABBAWoiAjYCqAEgACAIaiEFIAIhACAFLQAIRQ0AC0EGIQMMBAsgAUEANgKoASABQgA3A1AgAUIANwNIIAFBAzYCAAsgAUG0oCAoAgA2AhAgAUHAoCAoAgA2AhQCfyABKAKwCSIEQejdAWohBSAEQfgAaiEKIARB5N0BaiELA38gBCgCQCEDAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAQbSgICgCACIAQbigICgCACICTwRAIANBB0YNAUEADBELIAMOCQECAwQFBgcACQ8LIAQoAkwhAwwHC0EBIQZBtKAgIABBAWo2AgBBsKAgKAIAIABqLQAAIgBFDQggAEEBRyAAQd8BTXFFBEAgBEGAAjsBUCAEKAI8RQRAIARBwKAgKAIAIgJBvKAgKAIAajYCGCAEQcSgICgCACACazYCLAsgBEIANwIcIARCADcCJAwLCyAELQBQRQ0KQQcMDgtBtKAgIABBAWo2AgBBsKAgKAIAIABqLQAAIQAgBEECNgJAIAQgBCgCSCAAQQh0ajYCSAwMC0G0oCAgAEEBajYCAEGwoCAoAgAgAGotAAAhACAEQQM2AkAgBCAAIAQoAkhqQQFqNgJIDAsLQbSgICAAQQFqNgIAQbCgICgCACAAai0AACEAIARBBDYCQCAEIABBCHQ2AkwMCgtBtKAgIABBAWo2AgBBsKAgKAIAIABqLQAAIQAgBCAEKAJENgJAIAQgACAEKAJMakEBajYCTAwJC0G0oCAgAEEBajYCAEEHIQZBsKAgKAIAIABqLQAAIgBB4AFLDQNBACEDIARBfyAAQS1JBH9BAAUgAEEtayIAIABB/wFxQS1uIgJBLWxrIQAgAkEBagt0QX9zNgJ0IABB/wFxQQlPBEAgAEEJayIAIABB/wFxQQluIgJBCWxrIQAgAkEBaiEDCyAEIAM2AnAgBCAAQf8BcSIANgJsIAAgA2pBBEsNAyAEQX8gA3RBf3M2AnBBACEAIARBADYCZCAEQgA3AlwgBEIANwJUA0AgCiAAQQF0IgJqQYAIOwEAIAogAkECcmpBgAg7AQAgAEECaiIAQbbuAEcNAAsgBEEGNgJAIARBBTYCCCAEQv////8PNwIAC0EHIAQoAkwiBkEFSQ0IGiAEKAIIIgMEQEG0oCAoAgAhAEG4oCAoAgAhBwNAQQAgACAHRg0KGiAEKAIEIQxBtKAgIABBAWoiAjYCAEGwoCAoAgAgAGotAAAhACAEIANBAWsiAzYCCCAEIAAgDEEIdHI2AgQgAiEAIAMNAAsLIARBBzYCQCAEIAZBBWsiAzYCTAsgBCAEKAIgIgBBxKAgKAIAQcCgICgCAGsiAiAEKAJIIgYgAiAGSRsiAmogBCgCLCIGIAYgAGsgAksbNgIoQbigICgCACIGQbSgICgCACICayEAAkACQCAEKALk3QEiB0UEQCADDQFBACEDCyAHIAtqQQRqQbCgICgCACACaiAAIAMgB2siAkEqIAdrIgMgAiADSRsiAiAAIAJJGyIAEAICfyAAIAQoAuTdASIDaiICIAQoAkxGBEAgAyALaiAAakEEakE/IAJrEAcgBCgC5N0BIABqDAELIAJBFE0EQCAEIAI2AuTdAUG0oCBBtKAgKAIAIABqNgIADAMLIAJBFWsLIQIgBEEANgIQIAQgBTYCDCAEIAI2AhRBByEGIAQQCkUNAyAEKAIQIgcgACAEKALk3QEiAmpLDQMgBCAEKAJMIAdrIgM2AkwgAiAHSwRAIAQgAiAHayIANgLk3QECQCAFIgIgByALakEEaiIDRg0AIAMgACACaiIHa0EAIABBAXRrTQRAIAIgAyAAEAIMAQsgAiADc0EDcSEGAkACQCACIANJBEAgBg0CIAJBA3FFDQEDQCAARQ0EIAIgAy0AADoAACADQQFqIQMgAEEBayEAIAJBAWoiAkEDcQ0ACwwBCwJAIAYNACAHQQNxBEADQCAARQ0FIAIgAEEBayIAaiIGIAAgA2otAAA6AAAgBkEDcQ0ACwsgAEEDTQ0AA0AgAiAAQQRrIgBqIAAgA2ooAgA2AgAgAEEDSw0ACwsgAEUNAgNAIAIgAEEBayIAaiAAIANqLQAAOgAAIAANAAsMAgsgAEEDTQ0AA0AgAiADKAIANgIAIANBBGohAyACQQRqIQIgAEEEayIAQQNLDQALCyAARQ0AA0AgAiADLQAAOgAAIAJBAWohAiADQQFqIQMgAEEBayIADQALCwwCC0G0oCBBtKAgKAIAIAcgAmtqIgI2AgAgBEEANgLk3QFBuKAgKAIAIgYgAmshAAsgAEEVTwRAQbCgICgCACEHIAQgAjYCECAEIAc2AgwgBCAGQRVrIAIgA2ogACADQRVqSRs2AhRBByEGIAQQCkUNAyAEKAJMIgAgBCgCECICQbSgICgCAGsiA0kNAyAEIAAgA2siAzYCTEG0oCAgAjYCAEG4oCAoAgAgAmsiAEEUSw0BCyAFQbCgICgCACACaiADIAAgACADSxsiABACIAQgADYC5N0BQbSgIEG0oCAoAgAgAGo2AgALIAQoAiAiAiAEKAIcIgNrIQAgBCAEKAI8BH8gBCgCLCACRgRAIARBADYCIAtBvKAgKAIAQcCgICgCAGogBCgCGCADaiAAEAIgBCgCIAUgAgs2AhxBwKAgQcCgICgCACAAaiICNgIAIAQgBCgCSCAAayIANgJIIABFBEBBByEGIAQoAkwNAiAEKAJoDQIgBCgCBA0CIARBADYCQAwFC0EAIQYgAkHEoCAoAgBGDQFBtKAgKAIAQbigICgCAEcNBiAEKALk3QEgBCgCTE8NBgwBCyAEKAJMIgNFDQFBACEGIAAgAk8NAANAQcSgICgCACIHQcCgICgCACIMTQ0BIAQgAyADIAQoAiwgBCgCICISayITIAIgAGsiAiAHIAxrIgcgAiAHSRsiAiACIBNLGyICIAIgA0sbIgJrNgJMIBIgBCgCGGpBsKAgKAIAIABqIAIQAiAEIAQoAiAgAmoiADYCICAAIAQoAiRLBEAgBCAANgIkCyAEIAQoAjwEfyAEKAIsIABGBEAgBEEANgIgC0G8oCAoAgBBwKAgKAIAakGwoCAoAgBBtKAgKAIAaiACEAIgBCgCIAUgAAs2AhxBwKAgQcCgICgCACACajYCAEG0oCBBtKAgKAIAIAJqIgA2AgAgBCgCTCIDRQ0CQbigICgCACICIABLDQALCyAGDAULIARBADYCQAwDCyAAQRh0QRh1QQBODQEgBEEBNgJAIAQgAEEQdEGAgPwAcTYCSCAAQcABTwRAIARBBTYCRCAEQQA6AFEMAwtBByAELQBRDQMaIARBBjYCRCAAQaABSQ0CIARCADcCVEEAIQAgBEEANgJkIARCADcCXANAIAogAEEBdCICakGACDsBACAKIAJBAnJqQYAIOwEAIABBAmoiAEG27gBHDQALCyAEQQU2AgggBEL/////DzcCAAwBCyAAQQJLBH9BBwUgBEKDgICAgAE3AkAMAQsLCyEDIAEgASkDSEG0oCAoAgAgASgCEGutfCIUNwNIIAEgASkDUEHAoCAoAgAgASgCFCICayIArXwiFTcDUCABKQMwIBRUBEBBByEDDAMLIAEpAzggFVQEQEEHIQMMAwsCQCABAn4CQAJAIAEoAiBBAWsOBAADAwEDC0G8oCAoAgAgAmogACABKAIYEAOtDAELQbygICgCACACaiEFIAEpAxhCf4UhFAJAIABFDQAgAEEBcQR/IAUxAAAgFEL/AYOFp0EDdEGwEGopAwAgFEIIiIUhFCAFQQFqIQUgAEEBawUgAAshAiAAQQFGDQADQCAFMQABIAUxAAAgFEL/AYOFp0EDdEGwEGopAwAgFEIIiIUiFEL/AYOFp0EDdEGwEGopAwAgFEIIiIUhFCAFQQJqIQUgAkECayICDQALCyAUQn+FCzcDGAsgA0EBRw0CAkAgASkDMCIUQn9RDQAgFCABKQNIUQ0AQQchAwwDCyABKQNQIRUCQCABKQM4IhRCf1EEQCAVIRQMAQtBByEDIBQgFVINAwsgASABKQNoIBR8NwNoIAEgASgCIEGQCGoxAAAgASkDYCABKQNIIAE1AkB8fHw3A2AgASAPQRggASgCcBADNgJwIAFBBDYCACABIAEpA1hCAXw3A1gLAkAgASkDSCIUQgODUA0AQQAhA0G0oCAoAgAiAEG4oCAoAgAiAkYNAkG0oCAgAEEBaiIFNgIAQbCgICgCACAAai0AAARAQQchAwwDCyABIBRCAXwiFTcDSCAVQgODUA0AIAIgBUYNAkG0oCAgAEECaiIENgIAQbCgICgCACAFai0AAARAQQchAwwDCyABIBRCAnwiFTcDSCAVQgODUA0AIAIgBEYNAkG0oCAgAEEDaiIFNgIAQbCgICgCACAEai0AAARAQQchAwwDCyABIBRCA3wiFTcDSCAVQgODUA0AIAIgBUYNAkG0oCAgAEEEajYCAEEHIQNBsKAgKAIAIAVqLQAADQIgASAUQgR8NwNICyABQQU2AgALAkACQAJAAkACQCABKAIgIgBBAWsOBAACAgECC0G0oCAoAgAhAEG4oCAoAgAhBQNAIAAgBUYEQEEAIQMMBgsgASkDGCEUIAEoAgQhA0G0oCAgAEEBaiICNgIAQbCgICgCACAAai0AACAUIAOtiKdB/wFxRwRAQQchAwwGCyABIANBCGoiAzYCBCACIQAgA0EgSQ0ACyABQgA3AxgMAgtBtKAgKAIAIQBBuKAgKAIAIQUDQCAAIAVGBEBBACEDDAULIAEpAxghFCABKAIEIQNBtKAgIABBAWoiAjYCAEGwoCAoAgAgAGotAAAgFCADrYinQf8BcUcEQEEHIQMMBQsgASADQQhqIgM2AgQgAiEAIANBwABJDQALIAFCADcDGAwBCyABKAIEIgIgAEGQCGotAAAiBU8NAEEAIQNBtKAgKAIAIgBBuKAgKAIAIgRGDQIDQAJAIABBAWohACACQQFqIgIgBUYNACAAIARHDQEMAwsLQbSgICAANgIACyABQQA2AgRBASEAIAFBATYCAAwCC0G0oCAgBDYCACABIAI2AgRBASEAIAIgBUkNACABQQE2AgAMAQsLAkAgASgCJEUEQAJAAkAgAw4CAAMBC0EHQQhBtKAgKAIAQbigICgCAEYbIQMLQcCgICANNgIAQbSgICAONgIAIAMMAgsCQCADDQAgDkG0oCAoAgBHDQAgDUHAoCAoAgBHDQAgAS0AKCEAIAFBAToAKCAAQQN0DAILIAFBADoAKAsgAwsOCQcGBwABAgMEBAULQQEhCQwFC0ECIQkMBAtBBCEJDAMLQQUhCQwCC0EGIQkMAQtBByEJC0HQoMAAKAIAEAsLIAkL9wQCA38DfkHAoCBCgICAgICAgAQ3AgBBvKAgQdCgIDYCAEG0oCBCADcCAEGwoCBBsCA2AgADQCAAQQJ0QbAIakEAQQBBAEEAIABBAXYiAUEBcWtBoIbi7X5xQQAgAEEBcWtBoIbi7X5xIAFzQQF2IgFzQQF2IgJBAXFrQaCG4u1+cUEAIAFBAXFrQaCG4u1+cSACc0EBdiIBc0EBdiICQQFxa0GghuLtfnFBACABQQFxa0GghuLtfnEgAnNBAXYiAXNBAXYiAkEBcWtBoIbi7X5xQQAgAUEBcWtBoIbi7X5xIAJzQQF2czYCACAAQQFqIgBBgAJHDQALA0AgBadBA3RBsBBqQgBCAEIAQgAgBUIBiCIDQgGDfULCnpy83fKVtkmDQgAgBUIBg31Cwp6cvN3ylbZJgyADhUIBiCIDhUIBiCIEQgGDfULCnpy83fKVtkmDQgAgA0IBg31Cwp6cvN3ylbZJgyAEhUIBiCIDhUIBiCIEQgGDfULCnpy83fKVtkmDQgAgA0IBg31Cwp6cvN3ylbZJgyAEhUIBiCIDhUIBiCIEQgGDfULCnpy83fKVtkmDQgAgA0IBg31Cwp6cvN3ylbZJgyAEhUIBiIU3AwAgBUIBfCIFQoACUg0AC0HQoMAAAn9BuAkQBiIABEAgAEECNgIkIABBqN4BEAYiAQR/IAFBgICABDYCNCABQQI2AjwgAUEANgIYIAFBADYCOCABBUEACyIBNgKwCSABBEAgAEEAOgAoIABCADcDACAAQgA3AxggAEHIAGpB5AAQByAAQQw2AqwBIAAMAgsgABAFC0EACyIANgIAIAAEf0EABUEAEAtBAQsLEAAjACAAa0FwcSIAJAAgAAsGACAAJAALBAAjAAsRAEG0oCAoAgBBuKAgKAIARgsJAEHAoCAoAgALFwBBxKAgIABBgIAgIABBgIAgSRs2AgALCwBBwKAgIAA2AgALFwBBuKAgIABBgIAgIABBgIAgSRs2AgALCwBBtKAgIAA2AgALCyoDAEGACAsF/Td6WFoAQZEICw8EBAQICAgQEBAgICBAQEAAQaAICwNQEmA=")||(R=T,T=e.locateFile?e.locateFile(R,m):m+R);var F=[];function k(B){var V=F[B];return V||(B>=F.length&&(F.length=B+1),F[B]=V=C.get(B)),V}function q(B){try{return _.grow(B-x.byteLength+65535>>>16),Q(_.buffer),1}catch{}}var j=typeof atob=="function"?atob:function(B){var V,Y,le,me,fe,te,de="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",we="",Ie=0;B=B.replace(/[^A-Za-z0-9\+\/\=]/g,"");do V=de.indexOf(B.charAt(Ie++))<<2|(me=de.indexOf(B.charAt(Ie++)))>>4,Y=(15&me)<<4|(fe=de.indexOf(B.charAt(Ie++)))>>2,le=(3&fe)<<6|(te=de.indexOf(B.charAt(Ie++))),we+=String.fromCharCode(V),fe!==64&&(we+=String.fromCharCode(Y)),te!==64&&(we+=String.fromCharCode(le));while(Ie<B.length);return we};function U(B){if(W(B))return(function(V){if(typeof p=="boolean"&&p){var Y=Buffer.from(V,"base64");return new Uint8Array(Y.buffer,Y.byteOffset,Y.byteLength)}try{for(var le=j(V),me=new Uint8Array(le.length),fe=0;fe<le.length;++fe)me[fe]=le.charCodeAt(fe);return me}catch{throw new Error("Converting base64 string to bytes failed.")}})(B.slice(O.length))}var z={b:function(B,V,Y){L.copyWithin(B,V,V+Y)},a:function(B){var V=L.length,Y=2147483648;if((B>>>=0)>Y)return!1;for(var le=1;le<=4;le*=2){var me=V*(1+.2/le);if(me=Math.min(me,B+100663296),q(Math.min(Y,D(Math.max(B,me),65536))))return!0}return!1}};(function(){var B={a:z};function V(me,fe){var te,de=me.exports;e.asm=de,Q((_=e.asm.c).buffer),C=e.asm.o,te=e.asm.d,G.unshift(te),(function(){if(ee--,e.monitorRunDependencies&&e.monitorRunDependencies(ee),ee==0&&ie){var we=ie;ie=null,we()}})()}function Y(me){V(me.instance)}function le(me){return(function(){if(!g&&(f||h)){if(typeof fetch=="function"&&!ae(T))return fetch(T,{credentials:"same-origin"}).then((function(fe){if(!fe.ok)throw"failed to load wasm binary file at '"+T+"'";return fe.arrayBuffer()})).catch((function(){return ne(T)}));if(a)return new Promise((function(fe,te){a(T,(function(de){fe(new Uint8Array(de))}),te)}))}return Promise.resolve().then((function(){return ne(T)}))})().then((function(fe){return WebAssembly.instantiate(fe,B)})).then((function(fe){return fe})).then(me,(function(fe){A("failed to asynchronously prepare wasm: "+fe),H(fe)}))}if(ee++,e.monitorRunDependencies&&e.monitorRunDependencies(ee),e.instantiateWasm)try{return e.instantiateWasm(B,V)}catch(me){return A("Module.instantiateWasm callback failed with error: "+me),!1}(g||typeof WebAssembly.instantiateStreaming!="function"||W(T)||ae(T)||typeof fetch!="function"?le(Y):fetch(T,{credentials:"same-origin"}).then((function(me){return WebAssembly.instantiateStreaming(me,B).then(Y,(function(fe){return A("wasm streaming compile failed: "+fe),A("falling back to ArrayBuffer instantiation"),le(Y)}))}))).catch(r)})(),e.___wasm_call_ctors=function(){return(e.___wasm_call_ctors=e.asm.d).apply(null,arguments)},e._init_decompressor=function(){return(e._init_decompressor=e.asm.e).apply(null,arguments)},e._decompress=function(){return(e._decompress=e.asm.f).apply(null,arguments)},e._get_in_buffer_ptr=function(){return(e._get_in_buffer_ptr=e.asm.g).apply(null,arguments)},e._get_out_buffer_ptr=function(){return(e._get_out_buffer_ptr=e.asm.h).apply(null,arguments)},e._in_buffer_set_pos=function(){return(e._in_buffer_set_pos=e.asm.i).apply(null,arguments)},e._in_buffer_set_size=function(){return(e._in_buffer_set_size=e.asm.j).apply(null,arguments)},e._out_buffer_set_pos=function(){return(e._out_buffer_set_pos=e.asm.k).apply(null,arguments)},e._out_buffer_set_size=function(){return(e._out_buffer_set_size=e.asm.l).apply(null,arguments)},e._get_curr_output_length=function(){return(e._get_curr_output_length=e.asm.m).apply(null,arguments)},e._is_input_end_reached=function(){return(e._is_input_end_reached=e.asm.n).apply(null,arguments)};var v,M=e.stackSave=function(){return(M=e.stackSave=e.asm.p).apply(null,arguments)},S=e.stackRestore=function(){return(S=e.stackRestore=e.asm.q).apply(null,arguments)},I=e.stackAlloc=function(){return(I=e.stackAlloc=e.asm.r).apply(null,arguments)};function J(B){this.name="ExitStatus",this.message="Program terminated with exit("+B+")",this.status=B}function $(B){function V(){v||(v=!0,e.calledRun=!0,y||(oe(G),t(e),e.onRuntimeInitialized&&e.onRuntimeInitialized(),(function(){if(e.postRun)for(typeof e.postRun=="function"&&(e.postRun=[e.postRun]);e.postRun.length;)Y=e.postRun.shift(),se.unshift(Y);var Y;oe(se)})()))}ee>0||((function(){if(e.preRun)for(typeof e.preRun=="function"&&(e.preRun=[e.preRun]);e.preRun.length;)Y=e.preRun.shift(),re.unshift(Y);var Y;oe(re)})(),ee>0||(e.setStatus?(e.setStatus("Running..."),setTimeout((function(){setTimeout((function(){e.setStatus("")}),1),V()}),1)):V()))}if(e.cwrap=function(B,V,Y,le){var me=(Y=Y||[]).every((function(fe){return fe==="number"}));return V!=="string"&&me&&!le?b(B):function(){return E(B,V,Y,arguments)}},ie=function B(){v||$(),v||(ie=B)},e.run=$,e.preInit)for(typeof e.preInit=="function"&&(e.preInit=[e.preInit]);e.preInit.length>0;)e.preInit.pop()();return $(),e.ready}})();const b6=["","Memory allocation failed","Memory usage limit reached","Unsupported check; not verifying file integrity","Not an .xz file","Unsupported options in the .xz headers","File is corrupt","Unknown decompression bug"];class Wh{constructor(e){this.manager=e!==void 0?e:pb,this.crossOrigin="Anonymous",this.xz=null}init(){return this.xz?Promise.resolve():y6().then((e=>{this._emInitDecompressor=e.cwrap("init_decompressor","number"),this._emDecompress=e.cwrap("decompress","number"),this._emGetInBufferPtr=e.cwrap("get_in_buffer_ptr","number"),this._emGetOutBufferPtr=e.cwrap("get_out_buffer_ptr","number"),this._emInBufferSetPos=e.cwrap("in_buffer_set_pos",null,["number"]),this._emInBufferSetSize=e.cwrap("in_buffer_set_size",null,["number"]),this._emOutBufferSetPos=e.cwrap("out_buffer_set_pos",null,["number"]),this._emOutBufferSetSize=e.cwrap("out_buffer_set_size",null,["number"]),this._emGetCurrOutputLength=e.cwrap("get_curr_output_length","number"),this._emIsInputEndReached=e.cwrap("is_input_end_reached","number"),this.xz=e}))}load(e,t,r,o){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e);const i=this,a=na.get(e);if(a!==void 0)return i.manager.itemStart(e),setTimeout((function(){t&&t(a),i.manager.itemEnd(e)}),0),a;const s=this.init(),l=new XMLHttpRequest;return l.open("GET",e,!0),l.addEventListener("load",(function(c){const u=c.target.response;this.status===200||this.status===0?(this.status===0&&console.warn("v3d.XZLoader: HTTP Status 0 received."),s.then((()=>{i.decompressArrayBuffer(u,(function(d){setTimeout((function(){t&&t(d),i.manager.itemEnd(e),na.add(e,d)}),1)}),(function(d){r&&r((2+1*d)/3)}),(function(d){o&&o(d),i.manager.itemEnd(e),i.manager.itemError(e)}))}))):(o&&o(c),i.manager.itemEnd(e),i.manager.itemError(e))}),!1),r&&l.addEventListener("progress",(function(c){let u;u=c.lengthComputable?c.loaded/c.total:1,r(2*u/3)}),!1),l.addEventListener("error",(function(c){o&&o(c),i.manager.itemEnd(e),i.manager.itemError(e)}),!1),l.responseType="arraybuffer",l.send(null),i.manager.itemStart(e),l}setCrossOrigin(e){return this.crossOrigin=e,this}setPath(e){return this.path=e,this}decompressArrayBuffer(e,t,r,o){const i=this;function a(m){const g=i._emGetInBufferPtr();i.xz.HEAPU8.set(m,g),i._emInBufferSetPos(0),i._emInBufferSetSize(m.length),s()}function s(){i._emOutBufferSetPos(0)}const l=i._emInitDecompressor();if(l!=0)return console.error("XZLoader._emInitDecompressor: error code "+l+" ("+b6[l]+")"),void(o&&o(l));const c=new Uint8Array(e),u=c.length,d=[];let f=0,h=Math.min(524288,u),p=0;a(c.subarray(f,h)),(function m(){const g=i._emDecompress();if(g)console.error("XZLoader._emDecompress: error code "+g+" ("+b6[g]+")"),o&&o(g);else{const _=i._emGetCurrOutputLength();if(d.push((function(A){const y=i._emGetOutBufferPtr();return new Uint8Array(i.xz.HEAPU8.subarray(y,y+A))})(_)),s(),i._emIsInputEndReached()&&(f=h,h=Math.min(h+524288,u),a(c.subarray(f,h))),r&&r(f/u),f==h){const A=d.reduce((function(E,x,w,L){return E+x.length}),0),y=new Uint8Array(A);let b=0;d.forEach((function(E){y.set(E,b),b+=E.length})),t&&t(y.buffer)}else p++,p%2==0?setTimeout(m,1):m()}})()}}class u3 extends Ci{constructor(e){super(e),this.reversed=!1}load(e,t,r,o){const i=this,a=new Si(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.load(e,(function(s){t(i.parse(s))}),r,o)}parse(e){function t(r){var o,i=[];r.forEach((function(s){s.type.toLowerCase()==="m"?(o=[s],i.push(o)):s.type.toLowerCase()!=="z"&&o.push(s)}));var a=[];return i.forEach((function(s){var l={type:"m",x:s[s.length-1].x,y:s[s.length-1].y};a.push(l);for(var c=s.length-1;c>0;c--){var u=s[c];l={type:u.type},u.x2!==void 0&&u.y2!==void 0?(l.x1=u.x2,l.y1=u.y2,l.x2=u.x1,l.y2=u.y1):u.x1!==void 0&&u.y1!==void 0&&(l.x1=u.x1,l.y1=u.y1),l.x=s[c-1].x,l.y=s[c-1].y,a.push(l)}})),a}return typeof opentype>"u"?(console.warn("v3d.TTFLoader: The loader requires opentype.js. Make sure it's included before using the loader."),null):(function(r,o){for(var i=Math.round,a={},s=1e3/(r.unitsPerEm||2048),l=r.encoding.cmap.glyphIndexMap,c=Object.keys(l),u=0;u<c.length;u++){var d=c[u],f=r.glyphs.glyphs[l[d]];if(d!==void 0){var h={ha:i(f.advanceWidth*s),x_min:i(f.xMin*s),x_max:i(f.xMax*s),o:""};o&&(f.path.commands=t(f.path.commands)),f.path.commands.forEach((function(p){p.type.toLowerCase()==="c"&&(p.type="b"),h.o+=p.type.toLowerCase()+" ",p.x!==void 0&&p.y!==void 0&&(h.o+=i(p.x*s)+" "+i(p.y*s)+" "),p.x1!==void 0&&p.y1!==void 0&&(h.o+=i(p.x1*s)+" "+i(p.y1*s)+" "),p.x2!==void 0&&p.y2!==void 0&&(h.o+=i(p.x2*s)+" "+i(p.y2*s)+" ")})),a[String.fromCodePoint(f.unicode)]=h}}return{glyphs:a,familyName:r.getEnglishName("fullName"),ascender:i(r.tables.os2.sTypoAscender*s),descender:i(r.tables.os2.sTypoDescender*s),lineGap:r.tables.os2.sTypoLineGap*s,underlinePosition:r.tables.post.underlinePosition,underlineThickness:r.tables.post.underlineThickness,boundingBox:{xMin:r.tables.head.xMin*s,xMax:r.tables.head.xMax*s,yMin:r.tables.head.yMin*s,yMax:r.tables.head.yMax*s},resolution:1e3,original_font_information:r.tables.name}})(opentype.parse(e),this.reversed)}}class d3 extends kP{constructor(e){super(e),this.type=1016,nr.isSafariWithUint16Bug()&&(console.warn("Safari 11/12 detected. Applying workaround for half-float texture bug"),this.type=1015)}parse(e){const t=function(l,c){switch(l){case 1:console.error("v3d.RGBELoader Read Error: "+(c||""));break;case 2:console.error("v3d.RGBELoader Write Error: "+(c||""));break;case 3:console.error("v3d.RGBELoader Bad File Format: "+(c||""));break;default:console.error("v3d.RGBELoader: Error: "+(c||""))}return-1},r=function(l,c,u){c=c||1024;let d=l.pos,f=-1,h=0,p="",m=String.fromCharCode.apply(null,new Uint16Array(l.subarray(d,d+128)));for(;0>(f=m.indexOf(`
`))&&h<c&&d<l.byteLength;)p+=m,h+=m.length,d+=128,m+=String.fromCharCode.apply(null,new Uint16Array(l.subarray(d,d+128)));return-1<f&&(l.pos+=h+f+1,p+m.slice(0,f))},o=function(l,c,u,d){const f=l[c+3],h=Math.pow(2,f-128)/255;u[d+0]=l[c+0]*h,u[d+1]=l[c+1]*h,u[d+2]=l[c+2]*h,u[d+3]=1},i=function(l,c,u,d){const f=l[c+3],h=Math.pow(2,f-128)/255;u[d+0]=mc(Math.min(l[c+0]*h,65504)),u[d+1]=mc(Math.min(l[c+1]*h,65504)),u[d+2]=mc(Math.min(l[c+2]*h,65504)),u[d+3]=mc(1)},a=new Uint8Array(e);a.pos=0;const s=(function(l){const c=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,u=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,d=/^\s*FORMAT=(\S+)\s*$/,f=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,h={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let p,m;if(l.pos>=l.byteLength||!(p=r(l)))return t(1,"no header found");if(!(m=p.match(/^#\?(\S+)/)))return t(3,"bad initial token");for(h.valid|=1,h.programtype=m[1],h.string+=p+`
`;p=r(l),p!==!1;)if(h.string+=p+`
`,p.charAt(0)!=="#"){if((m=p.match(c))&&(h.gamma=parseFloat(m[1])),(m=p.match(u))&&(h.exposure=parseFloat(m[1])),(m=p.match(d))&&(h.valid|=2,h.format=m[1]),(m=p.match(f))&&(h.valid|=4,h.height=parseInt(m[1],10),h.width=parseInt(m[2],10)),2&h.valid&&4&h.valid)break}else h.comments+=p+`
`;return 2&h.valid?4&h.valid?h:t(3,"missing image size specifier"):t(3,"missing format specifier")})(a);if(s!==-1){const l=s.width,c=s.height,u=(function(d,f,h){const p=f;if(p<8||p>32767||d[0]!==2||d[1]!==2||128&d[2])return new Uint8Array(d);if(p!==(d[2]<<8|d[3]))return t(3,"wrong scanline width");const m=new Uint8Array(4*f*h);if(!m.length)return t(4,"unable to allocate buffer space");let g=0,_=0;const A=4*p,y=new Uint8Array(4),b=new Uint8Array(A);let E=h;for(;E>0&&_<d.byteLength;){if(_+4>d.byteLength)return t(1);if(y[0]=d[_++],y[1]=d[_++],y[2]=d[_++],y[3]=d[_++],y[0]!=2||y[1]!=2||(y[2]<<8|y[3])!=p)return t(3,"bad rgbe scanline format");let x,w=0;for(;w<A&&_<d.byteLength;){x=d[_++];const C=x>128;if(C&&(x-=128),x===0||w+x>A)return t(3,"bad scanline data");if(C){const P=d[_++];for(let D=0;D<x;D++)b[w++]=P}else b.set(d.subarray(_,_+x),w),w+=x,_+=x}const L=p;for(let C=0;C<L;C++){let P=0;m[g]=b[C+P],P+=p,m[g+1]=b[C+P],P+=p,m[g+2]=b[C+P],P+=p,m[g+3]=b[C+P],g+=4}E--}return m})(a.subarray(a.pos),l,c);if(u!==-1){let d,f,h;switch(this.type){case 1015:h=u.length/4;const p=new Float32Array(4*h);for(let g=0;g<h;g++)o(u,4*g,p,4*g);d=p,f=1015;break;case 1016:h=u.length/4;const m=new Uint16Array(4*h);for(let g=0;g<h;g++)i(u,4*g,m,4*g);d=m,f=1016;break;default:console.error("v3d.RGBELoader: unsupported type: ",this.type)}return{width:l,height:c,data:d,header:s.string,gamma:s.gamma,exposure:s.exposure,type:f}}}return null}setDataType(e){return this.type=e,this}load(e,t,r,o){return super.load(e,(function(i,a){switch(i.type){case 1015:case 1016:i.encoding=3e3,i.minFilter=1006,i.magFilter=1006,i.generateMipmaps=!1,i.flipY=!0}t&&t(i,a)}),r,o)}}const x6=new Tn,E6=new Ue,lye=new N,cye=new N,jh=new pt,C6=new ph,f3=new Map;class uye extends kt{constructor(){super(),this.isPlaneReflectionProbe=!0,this.type="PlaneReflectionProbe",this.influenceDistance=1,this.falloff=.5,this.probeClipStart=.1,this.planeSize=new be(1,1),this.qualityFactor=.75,this.visibilityGroup=null,this.visibilityGroupInv=!1,this.boundingBox=new Tn,this.normal=new N,this.textureMatrix=new Ue,this.virtualCamera=new gr,this.reflectorWorldPosition=new N,this.cameraWorldPosition=new N,this.rotationMatrix=new Ue,this.view=new N,this.lookAtPosition=new N(0,0,-1),this.reflectorPlane=new Vo,this.clipPlane=new pt,this.target=new N;const e={minFilter:1006,magFilter:1006,format:1023,encoding:3001};this.renderTarget=new nn(1024,1024,e),this.renderTarget.texture.name="PlaneReflectionProbe",this.matrixWorldInverse=new Ue}_calcLocalBounding(){const e=lye.setScalar(0),t=cye.set(2*this.planeSize.x,2*this.influenceDistance/this.scale.y,2*this.planeSize.y);this.boundingBox.setFromCenterAndSize(e,t)}_isOutOfFrustum(e){const t=E6.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse);C6.setFromProjectionMatrix(t);const r=x6.copy(this.boundingBox).applyMatrix4(this.matrixWorld);return!C6.intersectsBox(r)}_traverseDisableOther(e){!e.isPlaneReflectionProbe&&this._isVisible(e)||(f3.set(e,e.layers.mask),e.layers.disableAll());const t=e.children;for(let r=0;r<t.length;r++)this._traverseDisableOther(t[r])}makeMultisampleRenderTarget(e){this.renderTarget.samples=e}setSize(e,t){this.renderTarget.setSize(this.qualityFactor*e,this.qualityFactor*t)}setEncoding(e){this.renderTarget.texture.encoding=e}intersectsMesh(e){let t=!1;const r=e.geometry,o=E6;o.copy(e.matrixWorld).invert(),o.multiply(this.matrixWorld);const i=this.boundingBox,a=x6.copy(i).applyMatrix4(o);return r.boundingBox===null&&r.computeBoundingBox(),t=r.boundingBox.intersectsBox(a),t&&r.boundsTree&&(t=r.boundsTree.intersectsBox(i,o)),t}update(e,t,r){if(this._calcLocalBounding(),this._isOutOfFrustum(t))return;const o=this.reflectorWorldPosition;o.setFromMatrixPosition(this.matrixWorld);const i=this.cameraWorldPosition;i.setFromMatrixPosition(t.matrixWorld);const a=this.rotationMatrix;a.extractRotation(this.matrixWorld);const s=this.normal;s.set(0,1,0),s.applyMatrix4(a);const l=this.view;if(l.subVectors(o,i),l.dot(s)>0)return;this._traverseDisableOther(e),l.reflect(s).negate(),l.add(o),a.extractRotation(t.matrixWorld);const c=this.lookAtPosition;c.set(0,0,-1),c.applyMatrix4(a),c.add(i);const u=this.target;u.subVectors(o,c),u.reflect(s).negate(),u.add(o);const d=this.virtualCamera;d.position.copy(l),d.up.set(0,1,0),d.up.applyMatrix4(a),d.up.reflect(s),d.lookAt(u),d.far=t.far,d.updateMatrixWorld();const f=d.projectionMatrix;f.copy(t.projectionMatrix);const h=this.textureMatrix;h.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),h.multiply(f),h.multiply(d.matrixWorldInverse);const p=this.reflectorPlane;p.setFromNormalAndCoplanarPoint(s,o),p.applyMatrix4(d.matrixWorldInverse);const m=this.clipPlane;m.set(p.normal.x,p.normal.y,p.normal.z,p.constant),jh.x=(Math.sign(m.x)+f.elements[8])/f.elements[0],jh.y=(Math.sign(m.y)+f.elements[9])/f.elements[5],jh.z=-1,jh.w=(1+f.elements[10])/f.elements[14],m.multiplyScalar(2/m.dot(jh)),f.elements[2]=m.x,f.elements[6]=m.y,f.elements[10]=m.z+1-this.probeClipStart,f.elements[14]=m.w;const g=r.getRenderTarget(),_=r.xr.enabled,A=r.shadowMap.autoUpdate,y=r.useOIT;r.xr.enabled=!1,r.shadowMap.autoUpdate=!1,r.useOIT=!1,r.setRenderTarget(this.renderTarget),r.state.buffers.depth.setMask(!0),r.autoClear===!1&&r.clear(),r.render(e,d),r.xr.enabled=_,r.shadowMap.autoUpdate=A,r.useOIT=y,r.setRenderTarget(g);const b=t.viewport;b!==void 0&&r.state.viewport(b),f3.forEach(((E,x)=>{x.layers.mask=E})),f3.clear()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}copy(e){return super.copy(e),this.influenceDistance=e.influenceDistance,this.probeClipStart=e.probeClipStart,this.visibilityGroup=e.visibilityGroup,this.visibilityGroupInv=e.visibilityGroupInv,this}dispose(){this.renderTarget!==null&&(this.renderTarget.dispose(),this.renderTarget=null),this.dispatchEvent({type:"dispose"})}_isVisible(e){return this.visibilityGroup===null||!e.isMesh?!0:e.groupNames.indexOf(this.visibilityGroup)!==-1^this.visibilityGroupInv}}class S6{static init(e,t){e!==void 0&&t!==void 0||console.error("RectAreaLightUniformsLib: Missing LTC data (required in Verge3D)");const r=new Float32Array(e),o=new Float32Array(t);qe.LTC_FLOAT_1=new gs(r,64,64,1023,1015,300,1001,1001,1006,1003,1),qe.LTC_FLOAT_2=new gs(o,64,64,1023,1015,300,1001,1001,1006,1003,1),qe.LTC_FLOAT_1.name="RectArea.ltc1",qe.LTC_FLOAT_2.name="RectArea.ltc2",qe.LTC_FLOAT_1.needsUpdate=!0,qe.LTC_FLOAT_2.needsUpdate=!0;const i=new Uint16Array(e.length);e.forEach((function(s,l){i[l]=mc(s)}));const a=new Uint16Array(t.length);t.forEach((function(s,l){a[l]=mc(s)})),qe.LTC_HALF_1=new gs(i,64,64,1023,1016,300,1001,1001,1006,1003,1),qe.LTC_HALF_2=new gs(a,64,64,1023,1016,300,1001,1001,1006,1003,1),qe.LTC_HALF_1.needsUpdate=!0,qe.LTC_HALF_2.needsUpdate=!0}}class h3{constructor(e){this.isFont=!0,this.type="Font",this.data=e}generateShapes(e,t=100,r="left",o="topBaseline",i=-1,a=!1){const s=[],l=dye(e,t,this.data,r,o,i,a);for(let c=0,u=l.length;c<u;c++)Array.prototype.push.apply(s,l[c].toShapes());return s}}function dye(n,e,t,r,o,i,a){const s=String(n).split(`
`),l=[];for(let g=0;g<s.length;g++){let _=s[g];l[g]=Array.from(_)}let c=e/t.resolution;a&&(c*=(t.ascender-t.descender)/(t.boundingBox.yMax-t.boundingBox.yMin)),t.lineGap=t.lineGap||0,i===-1?i=(t.ascender-t.descender+t.lineGap)*c:i*=e;const u=[];let d=0,f=0;const h=l.length,p=i*h,m=i-i*Math.abs(t.descender)/t.ascender;switch(o){case"topBaseline":default:f=0;break;case"top":f=-m;break;case"center":f=h>1?.5*p-m:-t.ascender/2*c;break;case"bottom":f=p-i-t.descender*c;break;case"bottomBaseline":f=p-i}for(let g=0;g<l.length;g++){const _=l[g];switch(r){case"left":default:d=0;break;case"center":d=-w6(_,c,t)/2;break;case"right":d=-w6(_,c,t)}for(let A=0;A<_.length;A++){const y=fye(_[A],c,d,f,t);d+=y.offsetX,u.push(y.path)}f-=i}return u}function fye(n,e,t,r,o){const i=o.glyphs[n]||o.glyphs["?"];if(!i)return void console.error('v3d.Font: character "'+n+'" does not exists in font family '+o.familyName+".");const a=new bD;let s,l,c,u,d,f,h,p;if(i.o){const m=i._cachedOutline||(i._cachedOutline=i.o.split(" "));for(let g=0,_=m.length;g<_;)switch(m[g++]){case"m":s=m[g++]*e+t,l=m[g++]*e+r,a.moveTo(s,l);break;case"l":s=m[g++]*e+t,l=m[g++]*e+r,a.lineTo(s,l);break;case"q":c=m[g++]*e+t,u=m[g++]*e+r,d=m[g++]*e+t,f=m[g++]*e+r,a.quadraticCurveTo(d,f,c,u);break;case"b":c=m[g++]*e+t,u=m[g++]*e+r,d=m[g++]*e+t,f=m[g++]*e+r,h=m[g++]*e+t,p=m[g++]*e+r,a.bezierCurveTo(d,f,h,p,c,u)}}return{offsetX:i.ha*e,path:a}}function w6(n,e,t){let r=0;for(var o=0;o<n.length;o++){const i=n[o];r+=(t.glyphs[i]||t.glyphs["?"]).ha*e}return r}const M6=new N,T6=new N;class hye extends kt{constructor(){super(),this.isClippingPlaneObject=!0,this.type="ClippingPlaneObject",this.plane=new Vo,this.clippingGroup=null,this.clipShadows=!1,this.negated=!1,this.clipIntersection=!1,this.crossSection=!1,this.crossSectionColor=new Ge(16711680),this.crossSectionOpacity=1,this.crossSectionRenderSide=0,this.crossSectionSize=100,this._crossMatProfile="blender"}updatePlane(){this.updateWorldMatrix(!0,!1),this.getWorldPosition(M6);const e=this.matrixWorld.elements;T6.set(e[4],e[5],e[6]).normalize(),this.plane.setFromNormalAndCoplanarPoint(T6,M6),this.negated&&this.plane.negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.updatePlane()}needsClippingPlane(e){return e.isMesh&&(e.groupNames.indexOf(this.clippingGroup)>=0||this.clippingGroup===null)&&!e.isAuxClippingMesh}assignToObject(e,t=0){const r=this.plane,o=e.material,i=e.geometry;if(o.clippingPlanes=o.clippingPlanes||[],o.clippingPlanes.indexOf(r)==-1&&o.clippingPlanes.push(r),o.clipShadows=this.clipShadows,o.clipIntersection=this.clipIntersection,this.crossSection){this.cleanupAuxMeshes(e);const a=new pr;a.depthWrite=!1,a.depthTest=!1,a.colorWrite=!1,a.stencilWrite=!0,a.stencilFunc=519,a.clipShadows=this.clipShadows,a.clipIntersection=this.clipIntersection;const s=!!e.isSkinnedMesh,l=e.morphTargetInfluences,c=_e(l)&&l.length>0,u=a.clone();let d;u.name="ClipCrossSectionStencilBack",u.side=1,u.clippingPlanes=[r],u.stencilFail=34055,u.stencilZFail=34055,u.stencilZPass=34055,s?(d=new x0(i,u),d.skeleton=e.skeleton):d=new Mt(i,u),d.renderOrder=t,d.name="ClipCrossSectionStencilBack",d.isAuxClippingMesh=!0,c&&(d.morphTargetInfluences=l.slice(),d.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),e.add(d);const f=a.clone();let h;f.name="ClipCrossSectionStencilFront",f.side=0,f.clippingPlanes=[r],f.stencilFail=34056,f.stencilZFail=34056,f.stencilZPass=34056,s?(h=new x0(i,f),h.skeleton=e.skeleton):h=new Mt(i,f),h.renderOrder=t+.1,h.name="ClipCrossSectionStencilFront",h.isAuxClippingMesh=!0,c&&(h.morphTargetInfluences=l.slice(),h.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),e.add(h),o.isMeshNodeMaterial&&(this._crossMatProfile=o.profile)}}createCrossSectionPlane(e,t){this.cleanupAuxMeshes();const r=new i3("ClipCrossSectionColor",this.crossSectionColor,this.crossSectionOpacity,this._crossMatProfile);r.clippingPlanes=e.filter((a=>a!==this.plane)),r.clipShadows=this.clipShadows,r.clipIntersection=this.clipIntersection,r.stencilWrite=!0,r.stencilRef=0,r.stencilFunc=517,r.stencilFail=7681,r.stencilZFail=7681,r.stencilZPass=7681,r.side=this.crossSectionRenderSide,this.crossSectionOpacity<1&&(r.transparent=!0,r.premultipliedAlpha=!0,r.blending=5,r.blendEquation=100,r.blendSrc=201,r.blendDst=205);const o=new ms(this.crossSectionSize,this.crossSectionSize);this.negated?o.rotateX(-Math.PI/2):o.rotateX(Math.PI/2);const i=new Mt(o,r);i.name="ClipCrossSectionColor",i.isAuxClippingMesh=!0,i.renderOrder=t,i.onAfterRender=function(a){a.clearStencil()},this.add(i)}cleanupAuxMeshes(e=null){if(e)for(let t=e.children.length-1;t>=0;t--){const r=e.children[t];r.isAuxClippingMesh&&r.material.clippingPlanes[0]==this.plane&&(r.geometry.dispose(),r.material.dispose(),e.remove(r))}else for(let t=this.children.length-1;t>=0;t--){const r=this.children[t];r.isAuxClippingMesh&&(r.geometry.dispose(),r.material.dispose(),this.remove(r))}}copy(e){return super.copy(e),this.plane=e.plane,this.clippingGroup=e.clippingGroup,this.clipShadows=e.clipShadows,this.negated=e.negated,this.clipIntersection=e.clipIntersection,this.crossSection=e.crossSection,this.crossSectionColor.copy(e.crossSectionColor),this.crossSectionOpacity=e.crossSectionOpacity,this.crossSectionRenderSide=e.crossSectionRenderSide,this.crossSectionSize=e.crossSectionSize,this._crossMatProfile=e._crossMatProfile,this}}class id{constuctor(){this.isConstraint=!0,this.name="",this.type="Constraint",this.mute=!1}_updateObjMatrixWorld(e){e.matrixAutoUpdate&&e.matrix.compose(e.position,e.quaternion,e.scale),e.parent==null?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(e.parent.matrixWorld,e.matrix)}update(e){this.mute}copy(e){return this.name=e.name,this.mute=e.mute,this}clone(){return new this.constructor().copy(this)}}class Ao extends id{constructor(e){super(),this.isTargetConstraint=!0,this.type="TargetConstraint",this.target=e}copy(e){return super.copy(e),this.target=e.target,this}clone(){return new this.constructor(this.target).copy(this)}}const I6=new Ue,pye=new It().setFromAxisAngle(new N(1,0,0),-Math.PI/2);class R6 extends Ao{constructor(e){super(e),this.isChildOfConstraint=!0,this.type="ChildOfConstraint",this.offsetMatrix=new Ue,this.fixCameraLightRotation=!1}copy(e){return super.copy(e),this.offsetMatrix.copy(e.offsetMatrix),this.fixCameraLightRotation=e.fixCameraLightRotation,this}update(e){super.update(e),this.mute||(I6.multiplyMatrices(this.target.matrixWorld,this.offsetMatrix),I6.decompose(e.position,e.quaternion,e.scale),this.fixCameraLightRotation&&(e.isCamera||e.isLight)&&e.quaternion.multiply(pye))}}const yo=new N,mye=new It,gye=new N;class L6 extends Ao{constructor(e){super(e),this.isCopyLocationConstraint=!0,this.type="CopyLocationConstraint",this.useX=!0,this.useY=!0,this.useZ=!0,this.invertX=!1,this.invertY=!1,this.invertZ=!1,this.useOffset=!1,this.influence=1,this._firstIteration=!0,this._objPosInit=new N,this._offset=new N}copy(e){return super.copy(e),this.useX=e.useX,this.useY=e.useY,this.useZ=e.useZ,this.invertX=e.invertX,this.invertY=e.invertY,this.invertZ=e.invertZ,this.useOffset=e.useOffset,this.influence=e.influence,this._firstIteration=!1,this}update(e){super.update(e),this.mute||(this.target.matrixWorld.decompose(yo,mye,gye),this._firstIteration&&(this._updateObjMatrixWorld(e),e.getWorldPositionNU(this._objPosInit),this._offset.subVectors(yo,this._objPosInit),this._firstIteration=!1),this.useX?(this.invertX&&(yo.x=-yo.x),this.useOffset&&(yo.x-=this._offset.x)):yo.x=this._objPosInit.x,this.useY?(this.invertY&&(yo.y=-yo.y),this.useOffset&&(yo.y-=this._offset.y)):yo.y=this._objPosInit.y,this.useZ?(this.invertZ&&(yo.z=-yo.z),this.useOffset&&(yo.z-=this._offset.z)):yo.z=this._objPosInit.z,e.position.lerpVectors(this._objPosInit,yo,this.influence),e.parent&&e.parent.worldToLocal(e.position))}}const _ye=new It().setFromAxisAngle(new N(1,0,0),-Math.PI/2),p3=new N,ad=new It,m3=new N;class P6 extends Ao{constructor(e){super(e),this.isCopyRotationConstraint=!0,this.type="CopyRotationConstraint",this.useX=!0,this.useY=!0,this.useZ=!0,this.invertX=!1,this.invertY=!1,this.invertZ=!1,this.mixMode="REPLACE",this.influence=1,this.fixCameraLightRotation=!1,this._firstIteration=!0,this._objQuatInit=new It}copy(e){return super.copy(e),this.useX=e.useX,this.useY=e.useY,this.useZ=e.useZ,this.invertX=e.invertX,this.invertY=e.invertY,this.invertZ=e.invertZ,this.mixMode=e.mixMode,this.influence=e.influence,this.fixCameraLightRotation=e.fixCameraLightRotation,this._firstIteration=!1,this}update(e){super.update(e),this.mute||(this.target.matrixWorld.decompose(p3,ad,m3),this._firstIteration&&(this._updateObjMatrixWorld(e),e.matrixWorld.decompose(p3,this._objQuatInit,m3),this._firstIteration=!1),e.quaternion.copy(this._objQuatInit),(this.useX||this.useY||this.useZ)&&(this.mixMode=="REPLACE"||this.mixMode=="ADD"||(this.mixMode=="BEFORE"?ad.multiply(e.quaternion):this.mixMode=="AFTER"?ad.premultiply(e.quaternion):this.mixMode),e.quaternion.slerp(ad,this.influence)),e.parent&&(e.parent.matrixWorld.decompose(p3,ad,m3),e.quaternion.premultiply(ad.invert())),this.fixCameraLightRotation&&(e.isCamera||e.isLight)&&e.quaternion.multiply(_ye))}}const D6=new N,B6=new It,xn=new N;class N6 extends Ao{constructor(e){super(e),this.isCopyScaleConstraint=!0,this.type="CopyScaleConstraint",this.useX=!0,this.useY=!0,this.useZ=!0,this.power=1,this.useMakeUniform=!1,this.useOffset=!1,this.useAdd=!1,this.influence=1,this._objInitScale=new N,this._volumeScaleFactor=new N,this._firstIteration=!0}copy(e){return super.copy(e),this.useX=e.useX,this.useY=e.useY,this.useZ=e.useZ,this.power=e.power,this.useMakeUniform=e.useMakeUniform,this.useOffset=e.useOffset,this.useAdd=e.useAdd,this.influence=e.influence,this._firstIteration=!1,this}update(e){if(super.update(e),!this.mute){if(this.target.matrixWorld.decompose(D6,B6,xn),this._firstIteration&&(this._updateObjMatrixWorld(e),e.matrixWorld.decompose(D6,B6,this._objInitScale),this._volumeScaleFactor.set(Math.pow(xn.x-this._objInitScale.x,3),Math.pow(xn.y-this._objInitScale.y,3),Math.pow(xn.z-this._objInitScale.z,3)),this._firstIteration=!1),this.useMakeUniform){let t=1;this.useX&&(t*=xn.x),this.useY&&(t*=xn.y),this.useZ&&(t*=xn.z),t=Math.pow(Math.cbrt(t),this.power),xn.set(t,t,t),this.useOffset&&(this.useAdd?(xn.add(this._objInitScale),xn.addScalar(-1)):xn.multiply(this._objInitScale))}else xn.set(this.useX?Math.pow(xn.x,this.power):this._objInitScale.x,this.useY?Math.pow(xn.y,this.power):this._objInitScale.y,this.useZ?Math.pow(xn.z,this.power):this._objInitScale.z),this.useOffset&&(this.useAdd?xn.set(this.useX?xn.x+this._objInitScale.x-1:xn.x,this.useY?xn.y+this._objInitScale.y-1:xn.y,this.useZ?xn.z+this._objInitScale.z-1:xn.z):xn.set(this.useX?xn.x*this._objInitScale.x:xn.x,this.useY?xn.y*this._objInitScale.y:xn.y,this.useZ?xn.z*this._objInitScale.z:xn.z));e.scale.copy(this._objInitScale),e.scale.lerp(xn,this.influence)}}}const vye=new It().setFromAxisAngle(new N(1,0,0),-Math.PI/2),m1=new Ue,O6=new N,k6=new It,F6=new N;class V6 extends Ao{constructor(e){super(e),this.isCopyTransformsConstraint=!0,this.type="CopyTransformsConstraint",this.mixMode="REPLACE",this.influence=1,this.fixCameraLightRotation=!1,this._firstIteration=!0,this._objMatrixWorldInit=new Ue}copy(e){return super.copy(e),this.mixMode=e.mixMode,this.influence=e.influence,this.fixCameraLightRotation=e.fixCameraLightRotation,this._firstIteration=!0,this}update(e){super.update(e),this.mute||(this._firstIteration&&(this._updateObjMatrixWorld(e),this._objMatrixWorldInit.copy(e.matrixWorld),this._firstIteration=!1),m1.copy(this.target.matrixWorld),this.mixMode=="REPLACE"||(this.mixMode=="BEFORE"?m1.multiply(this._objMatrixWorldInit):this.mixMode=="AFTER"&&m1.premultiply(this._objMatrixWorldInit)),m1.decompose(O6,k6,F6),this._objMatrixWorldInit.decompose(e.position,e.quaternion,e.scale),e.position.lerp(O6,this.influence),e.quaternion.slerp(k6,this.influence),e.scale.lerp(F6,this.influence),this.fixCameraLightRotation&&(e.isCamera||e.isLight)&&e.quaternion.multiply(vye))}}const Aye=new It().setFromAxisAngle(new N(1,0,0),-Math.PI/2),g3=new N,vc=new It,_3=new N,U6=new N,ml=new N,gl=new N,sd=new N,v3={X:0,Y:1,Z:2,"-X":3,"-Y":4,"-Z":5},A3={0:new N(1,0,0),1:new N(0,1,0),2:new N(0,0,1),3:new N(-1,0,0),4:new N(0,-1,0),5:new N(0,0,-1)};class z6 extends Ao{constructor(e){super(e),this.isDampedTrackConstraint=!0,this.type="DampedTrackConstraint",this.trackAxis="X",this.influence=1,this.fixCameraLightRotation=!1,this._firstIteration=!0}copy(e){return super.copy(e),this.trackAxis=e.trackAxis,this.influence=e.influence,this.fixCameraLightRotation=e.fixCameraLightRotation,this._firstIteration=!1,this}update(e){if(super.update(e),!this.mute&&(this.target.matrixWorld.decompose(g3,vc,_3),this._firstIteration&&(this._updateObjMatrixWorld(e),this._firstIteration=!1),e.matrixWorld.decompose(U6,vc,_3),ml.subVectors(g3,U6),ml.length()!=0)){let t;if(ml.normalize(),gl.copy(A3[v3[this.trackAxis]]),gl.applyQuaternion(vc),gl.length()==0&&gl.copy(A3[v3[this.trackAxis]]),gl.normalize(),sd.crossVectors(gl,ml),t=gl.angleTo(ml),sd.length()<Number.EPSILON&&(Math.abs(t)<Math.PI-.01||(t=Math.PI,ml.copy(A3[(v3[this.trackAxis]+2)%6]),ml.applyQuaternion(vc),sd.crossVectors(gl,ml),sd.length()==0)))return;sd.normalize(),e.quaternion.premultiply(vc.setFromAxisAngle(sd,t)),e.parent&&(e.parent.matrixWorld.decompose(g3,vc,_3),e.quaternion.premultiply(vc.invert())),this.fixCameraLightRotation&&(e.isCamera||e.isLight)&&e.quaternion.multiply(Aye)}}}const yye={X:new N(1,0,0),Y:new N(0,1,0),Z:new N(0,0,1),"-X":new N(-1,0,0),"-Y":new N(0,-1,0),"-Z":new N(0,0,-1)},vr=new N,kr=new N,Fr=new N,gn=new N;class G6 extends Ao{constructor(e){super(e),this.isFloorConstraint=!0,this.type="FloorConstraint",this.floorLocation="Y",this.offset=0,this.useRotation=!1}copy(e){return super.copy(e),this.floorLocation=e.floorLocation,this.offset=e.offset,this.useRotation=e.useRotation,this}update(e){if(super.update(e),this.mute)return;const t=e.position;gn.copy(this.target.position);const r=this.target.scale,o=this.offset;if(this.useRotation){let i;switch(vr.copy(yye[this.floorLocation]),vr.applyQuaternion(this.target.quaternion),this.floorLocation){case"X":gn.x+=o*r.x,Fr.subVectors(t,gn),i=vr.dot(Fr),vr.multiplyScalar(i),kr.subVectors(Fr,vr).add(gn),kr.x>t.x?t.copy(kr):t.x=Math.max(t.x,gn.x);break;case"Y":gn.y+=o*r.y,Fr.subVectors(t,gn),i=vr.dot(Fr),vr.multiplyScalar(i),kr.subVectors(Fr,vr).add(gn),kr.y>t.y?t.copy(kr):t.y=Math.max(t.y,gn.y);break;case"Z":gn.z+=o*r.z,Fr.subVectors(t,gn),i=vr.dot(Fr),vr.multiplyScalar(i),kr.subVectors(Fr,vr).add(gn),kr.z>t.z?t.copy(kr):t.z=Math.max(t.z,gn.z);break;case"-X":gn.x+=o*r.x,Fr.subVectors(t,gn),i=vr.dot(Fr),vr.multiplyScalar(i),kr.subVectors(Fr,vr).add(gn),kr.x<t.x?t.copy(kr):t.x=Math.min(t.x,gn.x);break;case"-Y":gn.y+=o*r.y,Fr.subVectors(t,gn),i=vr.dot(Fr),vr.multiplyScalar(i),kr.subVectors(Fr,vr).add(gn),kr.y<t.y?t.copy(kr):t.y=Math.min(t.y,gn.y);break;case"-Z":gn.z+=o*r.z,Fr.subVectors(t,gn),i=vr.dot(Fr),vr.multiplyScalar(i),kr.subVectors(Fr,vr).add(gn),kr.z<t.z?t.copy(kr):t.z=Math.min(t.z,gn.z)}}else switch(this.floorLocation){case"X":t.x=Math.max(t.x,gn.x+o);break;case"Y":t.y=Math.max(t.y,gn.y+o);break;case"Z":t.z=Math.max(t.z,gn.z+o);break;case"-X":t.x=Math.min(t.x,gn.x+o);break;case"-Y":t.y=Math.min(t.y,gn.y+o);break;case"-Z":t.z=Math.min(t.z,gn.z+o)}}}const y3=new N,bye=new It,xye=new N,H6=new N;class W6 extends Ao{constructor(e){super(e),this.isLimitDistanceConstraint=!0,this.type="LimitDistanceConstraint",this.distance=0,this.limitMode="LIMITDIST_ONSURFACE",this.useTransformLimit=!1,this.influence=1,this._objPosInit=new N,this._distInit=0,this._sfac=1,this._clampSurf=0}copy(e){return super.copy(e),this.distance=e.distance,this.limitMode=e.limitMode,this.useTransformLimit=e.useTransformLimit,this.influence=e.influence,this}update(e){super.update(e),this.mute||(this._sfac=1,this._clampSurf=0,this.target.matrixWorld.decompose(y3,bye,xye),this._updateObjMatrixWorld(e),e.getWorldPositionNU(this._objPosInit),H6.subVectors(this._objPosInit,y3),this._distInit=H6.length(),this.limitMode=="LIMITDIST_INSIDE"?this._distInit>=this.distance&&(this._clampSurf=1,this._distInit!=0&&(this._sfac=this.distance/this._distInit)):this.limitMode=="LIMITDIST_OUTSIDE"?this._distInit<=this.distance&&(this._clampSurf=1,this._distInit!=0&&(this._sfac=this.distance/this._distInit)):this.limitMode=="LIMITDIST_ONSURFACE"&&this._distInit-this.distance!=0&&(this._clampSurf=1,this._distInit!=0&&(this._sfac=this.distance/this._distInit)),this._clampSurf&&(e.position.lerpVectors(this._objPosInit,y3,(1-this._sfac)*this.influence),e.parent&&e.parent.worldToLocal(e.position)))}}const _l=new N,g1=new N,ld=new N,b3=new Ue;class j6 extends Ao{constructor(e=null){super(e),this.isLimitLocationConstraint=!0,this.type="LimitLocationConstraint",this.space=2,this.min=new N().setScalar(-1/0),this.max=new N().setScalar(1/0)}copy(e){return super.copy(e),this.min.copy(e.min),this.max.copy(e.max),this.space=e.space,this}update(e){if(super.update(e),!this.mute)switch(this.space){case 0:this._updateObjMatrixWorld(e),_l.setFromMatrixPosition(e.matrixWorld),_l.clamp(this.min,this.max),ld.copy(_l),e.parent!==null&&ld.applyMatrix4(b3.copy(e.parent.matrixWorld).invert()),e.position.copy(ld);break;case 1:this.target!==null&&(this._updateObjMatrixWorld(e),this._updateObjMatrixWorld(this.target),_l.setFromMatrixPosition(e.matrixWorld),g1.copy(_l),g1.applyMatrix4(b3.copy(this.target.matrixWorld).invert()),g1.clamp(this.min,this.max),_l.copy(g1),_l.applyMatrix4(this.target.matrixWorld),ld.copy(_l),e.parent!==null&&ld.applyMatrix4(b3.copy(e.parent.matrixWorld).invert()),e.position.copy(ld));break;default:e.position.clamp(this.min,this.max)}}}const Ia=new $i;class Q6 extends id{constructor(){super(),this.isLimitRotationConstraint=!0,this.type="LimitRotationConstraint",this.axis="Y",this.min=0,this.max=2*Math.PI}copy(e){return super.copy(e),this.axis=e.axis,this.min=e.min,this.max=e.max,this}update(e){super.update(e),this.mute||(this.axis=="X"?(Ia.setFromQuaternion(e.quaternion,"XYZ"),Ia.x=this._clampAngle(Ia.x,this.min,this.max)):this.axis=="Y"?(Ia.setFromQuaternion(e.quaternion,"YZX"),Ia.y=this._clampAngle(Ia.y,this.min,this.max)):this.axis=="Z"&&(Ia.setFromQuaternion(e.quaternion,"ZXY"),Ia.z=this._clampAngle(Ia.z,this.min,this.max)),e.quaternion.setFromEuler(Ia))}_clampAngle(e,t,r){return Math.abs(r-t)<2*Math.PI&&(e=r2(e,t,r)),e}}class $6 extends id{constructor(){super(),this.isLimitScaleConstraint=!0,this.type="LimitScaleConstraint",this.min=new N().setScalar(-1/0),this.max=new N().setScalar(1/0)}copy(e){return super.copy(e),this.min.copy(e.min),this.max.copy(e.max),this}update(e){super.update(e),this.mute||e.scale.clamp(this.min,this.max)}}const Eye=new It().setFromAxisAngle(new N(1,0,0),-Math.PI/2),x3=new N,Y6=new N,_1=new N,v1=new N,E3=new N,C3=new Vo,Cye=new N,X6=new N,q6=new It;class K6 extends Ao{constructor(e){super(e),this.isLockedTrackConstraint=!0,this.type="LockedTrackConstraint",this.trackAxis="X",this.lockAxis="Y",this.fixCameraLightRotation=!1}copy(e){return super.copy(e),this.trackAxis=e.trackAxis,this.lockAxis=e.lockAxis,this.fixCameraLightRotation=e.fixCameraLightRotation,this}update(e){if(super.update(e),this.mute||(_1.set(this.trackAxis=="X"?1:this.trackAxis=="-X"?-1:0,this.trackAxis=="Y"?1:this.trackAxis=="-Y"?-1:0,this.trackAxis=="Z"?1:this.trackAxis=="-Z"?-1:0),v1.set(this.lockAxis=="X"?1:0,this.lockAxis=="Y"?1:0,this.lockAxis=="Z"?1:0),Math.abs(_1.dot(v1))==1))return;x3.setFromMatrixPosition(e.matrixWorld),Y6.setFromMatrixPosition(this.target.matrixWorld),C3.setFromNormalAndCoplanarPoint(v1,x3),C3.projectPoint(Y6,E3).sub(x3);const t=Cye.crossVectors(_1,E3).dot(v1)>0?1:-1;e.setRotationFromAxisAngle(C3.normal,t*_1.angleTo(E3)),e.parent&&(e.parent.matrixWorld.decompose(X6,q6,X6),e.quaternion.premultiply(q6.invert())),this.fixCameraLightRotation&&(e.isCamera||e.isLight)&&e.quaternion.multiply(Eye)}}const Z6=new N(0,1,0),Sye=new It().setFromAxisAngle(new N(1,0,0),-Math.PI/2),J6=new Vo,eB=new N,tB=new N,Ra=new N,cd=new N,S3=new N,nB=new Ue,rB=new N,oB=new It;class iB extends Ao{constructor(e){super(e),this.isTrackToConstraint=!0,this.type="TrackToConstraint",this.trackAxis="X",this.upAxis="Y",this.fixCameraLightRotation=!1}copy(e){return super.copy(e),this.trackAxis=e.trackAxis,this.upAxis=e.upAxis,this.fixCameraLightRotation=e.fixCameraLightRotation,this}update(e){if(super.update(e),this.mute)return;const t=this.trackAxis[this.trackAxis.length-1],r=this.upAxis[this.upAxis.length-1],o=this.trackAxis[0]=="-",i=this.upAxis[0]=="-";if(t==r)return;eB.setFromMatrixPosition(e.matrixWorld),tB.setFromMatrixPosition(this.target.matrixWorld),Ra.subVectors(tB,eB),Ra.lengthSq()?Ra.normalize():Ra.set(0,-1,0),J6.set(Ra,0),Math.abs(Ra.dot(Z6))!=1?J6.projectPoint(Z6,cd).normalize():cd.set(0,0,-1),o&&Ra.negate(),i&&cd.negate();let a=t=="X"?Ra:r=="X"?cd:null,s=t=="Y"?Ra:r=="Y"?cd:null,l=t=="Z"?Ra:r=="Z"?cd:null;a?s?l||(l=S3.crossVectors(a,s)):s=S3.crossVectors(l,a):a=S3.crossVectors(s,l),nB.makeBasis(a,s,l),e.setRotationFromMatrix(nB),e.parent&&(e.parent.matrixWorld.decompose(rB,oB,rB),e.quaternion.premultiply(oB.invert())),this.fixCameraLightRotation&&(e.isCamera||e.isLight)&&e.quaternion.multiply(Sye)}}class aB extends Ao{constructor(e){super(e),this.isFixOrthoZoomConstraint=!0,this._orthoZoom=1}copy(e){super.copy(e),this._orthoZoom=e._orthoZoom}update(e){if(super.update(e),this.mute)return;const t=this.target;if(e.parent!==t||!t.isOrthographicCamera)return void console.error("FixOrthoZoom: object should be a direct child of the orthographic camera");const r=this._orthoZoom/t.zoom;e.position.multiplyScalar(r),e.scale.multiplyScalar(r),this._orthoZoom=t.zoom}}const sB=new N,wye=new N,A1=new It,ud=new Tn,Mi=new ni;class lB extends Ao{constructor(e){super(e),this.isCanvasFitConstraint=!0,this.type="CanvasFitConstraint",this.edgeH="NONE",this.edgeV="NONE",this.offset=0,this.fitShape="BOX",this.xr=null}copy(e){return super.copy(e),this.edgeH=e.edgeH,this.edgeV=e.edgeV,this.offset=e.offset,this.fitShape=e.fitShape,this.xr=e.xr,this}update(e){if(super.update(e),this.mute)return;if(e.parent!==this.target)return void console.error(`CanvasFitConstraint: object ${e.name} should be a direct child of the camera`);let t,r,o,i;t=this.xr&&this.xr.enabled&&this.xr.isPresenting?this.xr.getCamera():this.target;const a=this.edgeH=="LEFT"?-1:this.edgeH=="RIGHT"?1:0,s=this.edgeV=="BOTTOM"?-1:this.edgeV=="TOP"?1:0;t.isPerspectiveCamera&&(o=ih(t.fov/2),r=Math.atan(t.aspect*Math.tan(o)),this.edgeH=="LEFT"&&(r*=a),this.edgeV=="BOTTOM"&&(o*=s),i=Math.abs(e.position.z)),e.geometry;let l=0,c=0,u=0,d=0;if(e.matrix.compose(e.position,e.quaternion,e.scale),this.fitShape=="BOX")if(ud.makeEmpty(),e.resolveMultiMaterial().forEach((function(f){f.geometry&&(f.geometry.boundingBox==null&&f.geometry.computeBoundingBox(),ud.union(f.geometry.boundingBox))})),ud.isEmpty())l=-a*this.offset,c=-s*this.offset;else{ud.applyMatrix4(e.matrix);const f=ud.getCenter(sB).sub(e.position),h=ud.getSize(wye).addScalar(2*this.offset);l=-(.5*h.x*a+f.x),c=-(.5*h.y*s+f.y),u=h.x,d=h.y}else if(this.fitShape=="SPHERE")if(Mi.makeEmpty(),e.resolveMultiMaterial().forEach((function(f){f.geometry&&(f.geometry.boundingSphere===null&&f.geometry.computeBoundingSphere(),Mi.isEmpty()?Mi.copy(f.geometry.boundingSphere):Mi.union(f.geometry.boundingSphere))})),Mi.isEmpty())l=-a*this.offset,c=-s*this.offset;else{Mi.applyMatrix4(e.matrix),Mi.radius+=this.offset;const f=sB.copy(Mi.center).sub(e.position);l=-(Mi.radius*a+f.x),c=-(Mi.radius*s+f.y),t.isPerspectiveCamera&&(l/=Math.cos(r),c/=Math.cos(o)),u=2*Mi.radius,d=2*Mi.radius}else l=-a*this.offset,c=-s*this.offset;this.edgeH=="STRETCH"?(e.position.x=l,u!==0&&(e.scale.applyQuaternion(A1.copy(e.quaternion)),t.isPerspectiveCamera?e.scale.x*=2*i*Math.tan(r)/u:e.scale.x*=(t.right-t.left)/t.zoom/u,e.scale.applyQuaternion(A1.copy(e.quaternion).invert()))):this.edgeH!=="NONE"&&(t.isPerspectiveCamera?e.position.x=i*Math.tan(r)+l:e.position.x=(a<0?t.left:t.right)/t.zoom+l),this.edgeV=="STRETCH"?(e.position.y=c,d!==0&&(e.scale.applyQuaternion(A1.copy(e.quaternion)),t.isPerspectiveCamera?e.scale.y*=2*i*Math.tan(o)/d:e.scale.y*=(t.top-t.bottom)/t.zoom/d,e.scale.applyQuaternion(A1.copy(e.quaternion).invert()))):this.edgeV!=="NONE"&&(t.isPerspectiveCamera?e.position.y=i*Math.tan(o)+c:e.position.y=(s<0?t.bottom:t.top)/t.zoom+c)}}class cB extends id{constructor(){super(),this.isCanvasBreakpointsConstraint=!0,this.type="CanvasBreakpointsConstraint",this.minWidth=0,this.maxWidth=1/0,this.minHeight=0,this.maxHeight=1/0,this.orientation="ALL",this.appInstance=null}copy(e){return super.copy(e),this.minWidth=e.minWidth,this.maxWidth=e.maxWidth,this.minHeight=e.minHeight,this.maxHeight=e.maxHeight,this.orientation=e.orientation,this.appInstance=e.appInstance,this}update(e){if(super.update(e),this.mute||!this.appInstance)return;const t=this.appInstance.getWidth(),r=this.appInstance.getHeight();let o;switch(this.orientation){case"ALL":o=!0;break;case"LANDSCAPE":o=t/r>=1;break;case"PORTRAIT":o=t/r<1}if(this.appInstance.getCamera()!==e||t>=this.minWidth&&t<=this.maxWidth&&r>=this.minHeight&&r<=this.maxHeight&&o)t>=this.minWidth&&t<=this.maxWidth&&r>=this.minHeight&&r<=this.maxHeight&&o?e.traverse((i=>{i.internVisible=!0})):e.traverse((i=>{i.internVisible=!1}));else{let i=this.findAlternativeCamera(e,this.appInstance.scene,t,r);i&&this.appInstance.setCamera(i)}}findAlternativeCamera(e,t,r,o){let i,a,s=!1;return e&&t.traverse((function(l){if(!s&&l.isCamera&&l!=e)for(let c=0;c<l.constraints.length;c++){let u=l.constraints[c];if(u.isCanvasBreakpointsConstraint){switch(u.orientation){case"ALL":i=!0;break;case"LANDSCAPE":i=r/o>=1;break;case"PORTRAIT":i=r/o<1}r>=u.minWidth&&r<=u.maxWidth&&o>=u.minHeight&&o<=u.maxHeight&&i&&(a?(console.error("CanvasBreakpointsConstraint: two or more alternative cameras"),s=!0):a=l)}}})),a}}const uB=function(n){return!!n&&!!n.dtype&&new RegExp("function View[0-9]+d(:?"+n.dtype+")+").test(String(n.constructor))},w3=function(n){return!!n&&n.data!==void 0&&Array.isArray(n.shape)&&n.offset!==void 0&&n.stride!==void 0};function $r(n){return Array.isArray(n)||ArrayBuffer.isView(n)}function Sn(n){if(n){if(uB(n)||w3(n))return n.dtype==="generic"?Sn.GENERIC_NDARRAY:Sn.NDARRAY;if($r(n))return Sn.ARRAY_OF_ARRAYS;throw new Error("Unhandled data type. Got type: "+typeof n)}}function Mye(n){return n[0].toUpperCase()+n.slice(1)}Sn.ARRAY_OF_ARRAYS="Arr",Sn.NDARRAY="Nd",Sn.GENERIC_NDARRAY="GenNd",Sn.PACKED="PackArr";const Tye=function(n,e,t,r,o,i){var a,s=[],l=!1;for(a=0;a<n.splineDimension;a++){var c=$r(n.knots)&&$r(n.knots[a]);c&&(l=!0),s.push("Deg"+n.degree[a]+(c?"":"Uniform")+Mye(n.boundary[a]))}var u=[[l?"NU":"",n.weights?"RBS":"BS"].join("")+n.dimension+"D",s.join("_")];return r&&u.push(r+"Pts"),o&&u.push(o+"Wts"),i&&u.push(i+"Kts"),e&&u.push("debug"),t&&u.push("chk"),u.join("_")},Go=function(n,e){return function(t,r){t===void 0||Array.isArray(t)||(t=[t]);for(var o=[],i=0;i<t.length;i++)o.push(Go.sum(t[i]));if(r)for(t=0;t<o.length;t++)r[t]!==void 0&&(o[t]="("+o[t]+" + "+r[t]+") % "+r[t]);return n+o.join("_")}};function M3(n){return function(e,t){e===void 0||Array.isArray(e)||(e=[e]);for(var r=[],o=0;o<e.length;o++)r.push(Go.sum(e[o]));if(t)for(e=0;e<r.length;e++)t[e]!==void 0&&(r[e]="("+r[e]+" + "+t[e]+") % "+t[e]);return n(r)}}function T3(n,e){var t;if(e)switch(Sn(e)){case Sn.ARRAY_OF_ARRAYS:return M3((function(r){return n+"["+r.join("][")+"]"}));case Sn.GENERIC_NDARRAY:return M3((function(r){return n+".get("+r.join(",")+")"}));case Sn.NDARRAY:return M3((function(r){var o=[n+"Offset"];for(t=0;t<r.length;t++)o.push(n+"Stride"+t+" * ("+r[t]+")");return n+"["+o.join(" + ")+"]"}));case Sn.PACKED:default:return}}Go.sum=function(n){return(n=(n=Array.isArray(n)?n:[n]).filter((function(e){return e!==void 0&&e!==0}))).length===0&&n.push(0),n.join(" + ")};const Iye=function(n){var e,t={};return(e=T3("x",n.points))&&(t.point=e),(e=T3("w",n.weights))&&(t.weight=e),(e=T3("k",n.knots))&&(t.knot=e),t};var Es=[],dB=[];const Rye=function(n,e,t){if(e!==1)throw new Error("Numerical derivative not implemented for order n = "+e+".");var r,o=arguments[this.splineDimension+3]===void 0?1e-4:arguments[this.splineDimension+3];for(Es.length=this.splineDimension,r=0;r<this.splineDimension;r++)Es[r+1]=arguments[r+3];var i,a,s,l=this.domain,c=l[t][0],u=l[t][1],d=Es[t+1],f=(u-c)*o;for(this.boundary[t]==="closed"?(i=c+(d-c-f+(s=u-c))%s,a=c+(d-c+f+s)%s,f*=2):(i=Math.min(u,Math.max(c,d-f)),f=(a=Math.min(u,Math.max(c,d+f)))-i),Es[t+1]=i,Es[0]=dB,this.evaluate.apply(null,Es),Es[t+1]=a,Es[0]=n,this.evaluate.apply(null,Es),r=0;r<this.dimension;r++)n[r]=(n[r]-dB[r])/f;return n},Qh=function(n,e){for(var t=1,r=0,o=[];r<n.length;r++)t*=Array.isArray(n[r])?n[r][1]-n[r][0]:n[r],o[r]=Array.isArray(n[r])?n[r][0]:0;for(var i=0;i<t;i++)for(e(o.slice()),r=n.length-1;r>=0;r--){if(o[r]!==(Array.isArray(n[r])?n[r][1]:n[r])-1){o[r]++;break}o[r]=Array.isArray(n[r])?n[r][0]:0}},$h=function(n,e,t,r){var o,i=[];switch(Sn(r)){case Sn.NDARRAY:for(i.push("  const "+e+" = "+t+".data;"),i.push("  const "+e+"Offset = "+t+".offset;"),o=0;o<r.dimension;o++)i.push("  const "+e+"Stride"+o+" = "+t+".stride["+o+"];");break;case Sn.ARRAY_OF_ARRAYS:i.push("  const "+e+" = "+t+";")}return i.join(`
`)},I3=function(n,e,t){if(n){if(w3(n))return e+".shape["+t+"]";for(var r=e,o=0;o<t;o++)r+="[0]";return r+".length"}return"this.size["+t+"]"};var fB={},hB={};const pB=function(n,e,t,r,o,i,a){var s,l,c,u,d,f,h=e.splineDimension,p=e.points,m=e.degree,g=e.weights,_=g!==void 0,A=e.knots,y=e.dimension,b=e.boundary;if(a!=null){Array.isArray(a)||(a=[a]);var E=0;for(s=0;s<h;s++)a[s]===void 0&&(a[s]=0),E+=a[s];if(_&&E>1)throw new Error("Analytical derivative not implemented for rational b-splines with order n = "+E+".")}i&&(n="Basis"+n),a&&(n="Der"+a.join("_")+"_"+n);var x=fB[n];if(r)var w=typeof r=="function"?r:console.log;if(x)return r&&w(hB[n]),x.bind(e);var L=[],C="evaluate"+n,P=t.point;i&&(P=function(z,v){for(var M=[],S=0;S<z.length;S++){for(var I=z[S],J=[],$=0;$<I.length;$++)I[$]!==0&&J.push(I[$]);I=J.join(" + "),v[S]&&(I="("+I+" + "+v[S]+") % "+v[S]),M.push(I+" === "+ee(S))}return"(("+M.join(" && ")+") ? 1 : 0)"});var D=t.weight,Q=t.knot,re=Go("k"),G=Go("x"),se=Go("w"),ee=Go("i"),ie=Go("t"),H=r?"domain":"d",T=Go(r?"size":"s"),R=Go(r?"knotIndex":"j"),O=!0;for(d=0;d<h;d++)$r(A)&&$r(A[d])&&(O=!1);function W(z){L.push("  "+(z||""))}function ae(z){r&&W(z)}if(i)var ne=[];var oe=[];for(s=0;s<h;s++)i&&ne.push(ee([s])),oe.push(ie([s]));for(L.push("function "+C+" ("+(i?"":"out, ")+oe.join(", ")+(i?", "+ne.join(", "):"")+") {"),W("let h, m, a, b;"),o&&(W("const "+H+" = this.domain;"),W("for (let i = 0; i < this.splineDimension; i++) {"),W("  a = arguments[i + 1];"),W("  if (a < "+H+"[i][0] || a > "+H+"[i][1] || a === undefined || isNaN(a)) {"),W("    throw new Error('Invalid Spline parameter in dimension '+i+'. Valid domain is ['+"+H+"[i][0]+', '+"+H+"[i][1]+']. but got t'+i+' = '+arguments[i + 1]+'.');"),W("  }"),W("}")),d=0;d<h;d++)W("let "+T(d)+" = "+I3(p,"this.points",d)+";");function F(z,v,M){return"("+z+") ? ("+v+") : ("+M+")"}L.push($h(0,"x","this.points",p)),_&&L.push($h(0,"w","this.weights",g)),O||L.push($h(0,"k","this.knots",A));var k=[];for(d=0;d<h;d++)switch(Sn(A)){case Sn.NDARRAY:k[d]=!0;break;case Sn.ARRAY_OF_ARRAYS:k[d]=$r(A[d])}for(d=0;d<h;d++)if(k[d])for(ae(`
  // Bisect to locate the knot interval in dimension `+d+`
`),W("let "+R(d)+" = 0;"),W("h = "+T(d)+";"),W("while(h > "+R(d)+" + 1) {"),W("  m = 0.5 * (h + "+R(d)+") | 0;"),W("  if ("+Q([d,"m"])+" > "+ie(d)+") h = m;"),W("  else "+R(d)+" = m;"),W("}"),ae(`
  // Fetch knots for dimension `+d+`
`),s=1-m[d];s<=m[d];s++)b[d]==="closed"?W(s<0?"let "+re([d,s+m[d]-1])+" = "+F(R(d)+" < "+-s,Q([d,0])+" + "+Q([d,[T(d),R(d),s]])+" - "+Q([d,[T(d)]]),Q([d,[R(d),s]]))+";":s>0?"let "+re([d,s+m[d]-1])+" = "+F(R(d)+" + "+s+" > "+T(d),Q([d,T(d)])+" + "+Q([d,s+" + "+R(d)+" - "+T(d)])+" - "+Q([d,0]),Q([d,[R(d),s]]))+";":"let "+re([d,s+m[d]-1])+" = "+Q([d,[R(d),s]])+";"):W("let "+re([d,s+m[d]-1])+" = "+Q([d,[R(d),s]])+";");else{for(ae(`
  // Directly compute knot interval for dimension `+d+`
`),b[d]==="closed"?W(R(d)+" = ("+ie(d)+" | 0) % "+T(d)+";"):(W(R(d)+" = ("+ie(d)+" | 0);"),W("if ("+R(d)+" < "+m[d]+") "+R(d)+" = "+m[d]+";"),W("if ("+R(d)+" > "+T(d)+" - 1) "+R(d)+" = "+T(d)+" - 1;")),ae(`
  // Compute and clamp knots for dimension `+d+`
`),s=1-m[d];s<=m[d];s++)W("let "+(f=re([d,s+m[d]-1]))+" = "+R(d)+" + "+s+";");if(b[d]==="clamped")for(s=1-m[d];s<=m[d];s++)f=re([d,s+m[d]-1]),s<0&&W("if ("+f+" < "+m[d]+") "+f+" = "+m[d]+";"),s>0&&W("if ("+f+" > "+T(d)+") "+f+" = "+T(d)+";");b[d]==="closed"&&(ae(`
  // Wrap the B-Spline parameter for closed boundary`),W(ie(d)+" %= "+T(d)+";"))}for(d=0,c=[];d<h;d++)c[d]=m[d]+1;for(_&&(ae(`
  // Fetch weights
`),Qh(c,(function(z){for(var v=[],M=[],S=0;S<h;S++)v[S]=[R(S),z[S]-m[S]],b[S]==="closed"&&z[S]-m[S]<0&&(M[S]=T(S));W("let "+se(z)+" = "+D(v,M)+";")}))),r&&W(_?`
  // Fetch points and project into homogeneous (weighted) coordinates
`:`
  // Fetch points
`),Qh(c,(function(z){for(var v=[],M=[],S=0;S<h;S++)v[S]=[R(S),z[S]-m[S]],b[S]==="closed"&&z[S]-m[S]<0&&(M[S]=T(S));if(i)W(_?"let "+G(z)+" = "+P(v,M)+" * "+se(z)+";":"let "+G(z)+" = "+P(v,M)+";");else for(S=0;S<y;S++){var I=z.concat(S);v[h]=S,W(_?"let "+G(I)+" = "+P(v,M)+" * "+se(z)+";":"let "+G(I)+" = "+P(v,M)+";")}})),ae(`
`),ae("// Perform De Boor's algorithm"),d=c.length-1;d>=0;d--)for(c[d]=[m[d],m[d]+1],s=0;s<m[d];s++)for(ae(`
  // Degree `+m[d]+" evaluation in dimension "+d+", step "+(s+1)+`
`),l=m[d];l>s;l--){var q=a&&m[d]-s-a[d]<=0;q?(W("m = 1 / ("+re([d,l-s+m[d]-1])+" - "+re([d,l-1])+");"),_&&(W("a = ("+ie(d)+" - "+re([d,l-1])+") * m;"),W("b = 1 - a;"))):(W("a = ("+ie(d)+" - "+re([d,l-1])+") / ("+re([d,l-s+m[d]-1])+" - "+re([d,l-1])+");"),W("b = 1 - a;")),_&&Qh(c,(function(z){var v=z.slice(),M=z.slice();v[d]=l,M[d]=l-1,q&&_&&W("h = "+se(v)+";"),W(se(v)+" = b * "+se(M)+" + a * "+se(v)+";")})),Qh(c,(function(z){var v,M,S,I=z.slice(),J=z.slice();if(I[d]=l,J[d]=l-1,q){var $=s+1;if(i)v=_?"h * "+se(J)+" / "+se(I)+" * ":"",M=G(I)+(_?" / h":""),S=G(J)+(_?" / "+se(J):""),W(G(I)+" = "+$+" * "+v+"("+M+" - "+S+") * m;");else{var B=I.slice(),V=J.slice();for(u=0;u<y;u++)B[h]=V[h]=u,v=_?"h * "+se(J)+" / "+se(I)+" * ":"",M=G(B)+(_?" / h":""),S=G(V)+(_?" / "+se(J):""),W(G(B)+" = "+$+" * "+v+"("+M+" - "+S+") * m;")}}else if(i)W(G(I)+" = b * "+G(J)+" + a * "+G(I)+";");else for(u=0;u<y;u++)I[h]=J[h]=u,W(G(I)+" = b * "+G(J)+" + a * "+G(I)+";")})),ae(`
`)}if(r&&W(_?`
  // Project back from homogeneous coordinates and return final output
`:`
  // Return final output
`),i)W(_?"return "+G(m)+" / "+se(m)+";":"return "+G(m)+";");else for(d=0;d<y;d++)W(_?"out["+d+"] = "+G(m.concat([d]))+" / "+se(m)+";":"out["+d+"] = "+G(m.concat([d]))+";");if(i||W("return out;"),L.push("}"),r){var j=L.join(`
`);w(j),hB[n]=j}const U=new Function([L.join(`
`),"; return ",C].join(""))();return fB[n]=U,U.bind(e)};var mB={};const Lye=function(n,e,t,r){var o,i,a,s,l,c,u,d,f=mB[n];if(f)return f.bind(e);var h=[],p="transform"+n;h.push("function "+p+"(m) {"),h.push("let i, w;"),h.push($h(0,"x","this.points",e.points));var m=Go(r?"size":"s");for(o=0;o<e.splineDimension;o++)h.push("let "+m(o)+" = "+I3(e.points,"this.points",o)+";");for(s=[],o=0;o<e.splineDimension;o++)a="i"+o,s.push(a),h.push("for ("+a+" = "+m(o)+"- 1; "+a+" >= 0; "+a+"--) {");for(o=0;o<e.dimension;o++)h.push("x"+o+" = "+t.point(s.concat([o])));for(l=[],o=0;o<e.dimension;o++)l.push("m["+((e.dimension+1)*(o+1)-1)+"] * x"+o);for(l.push("m["+((e.dimension+1)*(e.dimension+1)-1)+"]"),h.push("const w = ("+l.join(" + ")+") || 1.0;"),o=0;o<e.dimension;o++){for(l=[],c=e.dimension,i=0;i<c;i++)l.push("m["+(i*(c+1)+o)+"] * x"+i);l.push("m["+(i*(c+1)+o)+"]"),d=t.point(s.concat([o])),u="("+l.join(" + ")+") / w",h.push(d+" = "+u+";")}for(o=e.splineDimension-1;o>=0;o--)h.push("}");h.push("return this;"),h.push("}");const g=new Function([h.join(`
`),"; return ",p].join(""))();return r&&console.log(h.join(`
`)),mB[n]=g,g.bind(e)};var gB={};const Pye=function(n,e,t,r,o){var i=gB[n];if(i)return i.bind(e);var a,s,l,c=e.degree,u=e.knots,d=e.splineDimension,f=e.boundary,h=[],p="support"+n,m=t.knot,g=Go("t"),_=r?"domain":"d",A=Go(r?"size":"s"),y=Go(r?"knotIndex":"i"),b=!0;for(l=0;l<d;l++)$r(u)&&$r(u[l])&&(b=!1);function E(D){h.push("  "+(D||""))}var x=[];for(a=0;a<d;a++)x.push(g([a]));h.push("function "+p+" (out, "+x.join(", ")+") {");var w=0;function L(D,Q){E(Q===void 0?"out["+w+++"] = "+D.join(" + ")+";":"out["+w+++"] = ("+D.join(" + ")+" + "+Q+") % "+Q+";")}for(E("let h, m;"),E("let c = 0;"),o&&(E("const "+_+" = this.domain;"),E("for (let i = 0; i < this.splineDimension; i++) {"),E("  a = arguments[i + 1];"),E("  if (a < "+_+"[i][0] || a > "+_+"[i][1] || a === undefined || isNaN(a)) {"),E("    throw new Error('Invalid Spline parameter in dimension '+i+'. Valid domain is ['+"+_+"[i][0]+', '+"+_+"[i][1]+']. but got t'+i+' = '+arguments[i + 1]+'.');"),E("  }"),E("}")),l=0;l<d;l++)E("let "+A(l)+" = "+I3(e.points,"this.points",l)+";");b||h.push($h(0,"k","this.knots",u));var C=[];for(l=0;l<d;l++)switch(Sn(u)){case Sn.NDARRAY:C[l]=!0;break;case Sn.ARRAY_OF_ARRAYS:C[l]=$r(u[l])}for(l=0;l<d;l++)C[l]?(E("let "+y(l)+" = 0;"),E("h = "+A(l)+";"),E("while(h > "+y(l)+" + 1) {"),E("  m = 0.5 * (h + "+y(l)+") | 0;"),E("  if ("+m([l,"m"])+" > "+g(l)+") h = m;"),E("  else "+y(l)+" = m;"),E("}")):f[l]==="closed"?E(y(l)+" = ("+g(l)+" | 0) % "+A(l)+";"):(E(y(l)+" = ("+g(l)+" | 0);"),E("if ("+y(l)+" < "+c[l]+") "+y(l)+" = "+c[l]+";"),E("if ("+y(l)+" > "+A(l)+" - 1) "+y(l)+" = "+A(l)+" - 1;"));for(l=0,s=[];l<d;l++)s[l]=c[l]+1;Qh(s,(function(D){for(var Q=[],re=[],G=0;G<d;G++)Q[G]=[y(G),D[G]-c[G]],f[G]==="closed"&&D[G]-c[G]<0&&(re[G]=A(G));for(G=0;G<d;G++)L(Q[G],re[G])})),E("out.length = "+w+";"),E("return out;"),h.push("}"),r&&console.log(h.join(`
`));const P=new Function([h.join(`
`),"; return ",p].join(""))();return gB[n]=P,P.bind(e)};var y1={open:"open",closed:"closed",clamped:"clamped"};function b1(n){return n==null}function Dye(n,e,t,r,o,i){var a,s;!n||$r(n)||uB(n)?(i=i||{},this.weights=r,this.knots=t,this.degree=e,this.points=n,this.boundary=o,this.debug=i.debug,this.checkBounds=!!i.checkBounds,Object.defineProperty(this,"size",{value:i.size,writable:!0,configurable:!0})):(i=n,this.debug=n.debug,this.checkBounds=!!n.checkBounds,this.weights=n.weights,this.knots=n.knots,this.degree=n.degree,this.boundary=n.boundary,this.points=n.points,Object.defineProperty(this,"size",{value:i.size,writable:!0,configurable:!0}));var l=Sn(this.points),c=Sn(this.weights),u=Sn(this.knots);if(this.points)switch(l){case Sn.GENERIC_NDARRAY:case Sn.NDARRAY:Object.defineProperties(this,{splineDimension:{value:this.points.shape.length-1,writable:!1,configurable:!0},dimension:{value:this.points.shape[this.points.shape.length-1],writable:!1,configurable:!0},size:{get:function(){return this.points.shape.slice(0,this.points.shape.length-1)},set:function(){throw new Error("Cannot assign to read only property 'size'")},configurable:!0}});break;case Sn.ARRAY_OF_ARRAYS:var d=0,f=this.size||[];f.length=0;for(var h=this.points;$r(h[0]);h=h[0])d++,f.push(h.length);if(d===0)throw new Error("Expected an array of points");Object.defineProperties(this,{splineDimension:{value:d,writable:!1,configurable:!0},dimension:{value:h.length,writable:!1,configurable:!0},size:{get:function(){var A=[];A.length=0;for(var y=0,b=this.points;y<this.splineDimension;y++,b=b[0])A[y]=b.length;return A},set:function(){throw new Error("Cannot assign to read only property 'size'")},configurable:!0}});break;case Sn.PACKED:default:throw new Error("Expected either a packed array, array of arrays, or ndarray of points")}else{if(this.size===void 0||this.size===null)throw new Error("Either points or a control hull size must be provided.");if($r(this.size)||Object.defineProperty(this,"size",{value:[this.size],writable:!0,configurable:!0}),this.size.length===0)throw new Error("`size` must be a number or an array of length at least one.");Object.defineProperties(this,{splineDimension:{value:this.size.length,writable:!1,configurable:!0},dimension:{value:0,writable:!1,configurable:!0}})}if($r(this.degree)){for(a=0;a<this.splineDimension;a++)if(b1(this.degree[a]))throw new Error("Missing degree in dimension "+(a+1))}else{var p=!b1(this.degree),m=b1(this.degree)?2:this.degree;for(this.degree=[],a=0;a<this.splineDimension;a++)if(this.size[a]<=m){if(p)throw new Error("Expected at least "+(m+1)+" points for degree "+m+" spline in dimension "+(a+1)+" but got only "+this.size[a]);this.degree[a]=this.size[a]-1}else this.degree[a]=m}if(s=typeof this.boundary!="string"?"open":this.boundary,!y1[s])throw new Error("Boundary type must be one of "+Object.keys(y1)+". Got "+s);for(this.boundary=$r(this.boundary)?this.boundary:[],this.boundary.length=this.splineDimension,a=0;a<this.splineDimension;a++)if(this.boundary[a]=b1(this.boundary[a])?s:this.boundary[a],!y1[s])throw new Error("Boundary type must be one of "+Object.keys(y1)+". Got "+s+" for dimension "+(a+1));if(u===Sn.ARRAY_OF_ARRAYS)for($r(this.knots)&&this.knots.length>0&&!$r(this.knots[0])&&(this.knots=[this.knots]),a=0;a<this.splineDimension;a++){if(this.size[a]<=this.degree[a])throw new Error("Expected at least "+(this.degree[a]+1)+" points in dimension "+(a+1)+" but got "+this.size[a]+".");if($r(this.knots[a])){if(this.boundary[a]!=="closed"&&this.knots[a].length!==this.degree[a]+this.size[a]+1)throw new Error("Expected "+(this.degree[a]+this.size[a]+1)+" knots in dimension "+(a+1)+" but got "+this.knots[a].length+".");if(this.boundary[a]==="closed"&&this.knots[a].length!==this.size[a]+1&&this.knots[a].length!==this.size[a]+this.degree[a]+1)throw new Error("Expected "+(this.size[a]+1)+" knots for closed spline in dimension "+(a+1)+" but got "+this.knots[a].length+".")}}var g=Tye(this,this.debug,this.checkBounds,l,c,u);if(g!==this.__cacheKey){this.__cacheKey=g;var _=Iye(this);this.evaluate=pB(this.__cacheKey,this,_,this.debug,this.checkBounds,!1),this.transform=Lye(this.__cacheKey,this,_,this.debug),this.support=Pye(this.__cacheKey,this,_,this.debug,this.checkBounds),this.evaluator=function(A,y){return pB(this.__cacheKey,this,_,this.debug,this.checkBounds,y,A)}}return this.numericalDerivative=Rye.bind(this),this}function Bye(){var n,e=[],t=this.points;t?w3(t)&&(n=t.shape):n=this.size;for(var r=0;r<this.splineDimension;r++){var o=n?n[r]:t.length,i=this.degree[r],a=this.boundary[r]==="closed";if(this.knots&&this.knots[r]){var s=this.knots[r];e[r]=[s[a?0:i],s[o]]}else e[r]=[a?0:i,o];t&&(t=t[0])}return e}function x1(n,e,t,r,o,i){const a=function(l,c,u,d,f,h){return s(l,c,u,d,f,h),a},s=Dye.bind(a);return Object.defineProperty(a,"domain",{get:Bye}),s(n,e,t,r,o,i),a}const Nye=new It().setFromAxisAngle(new N(1,0,0),-Math.PI/2),Ac={X:new N(1,0,0),Y:new N(0,1,0),Z:new N(0,0,1),"-X":new N(-1,0,0),"-Y":new N(0,-1,0),"-Z":new N(0,0,-1)},Oye=new N(0,1,0),_B=new N(0,0,1),R3={DEFAULT:0,MATRIX:1},E1={ONLY_CONSTRAINT:0,CONSTRAINT_FIRST:1},Yh=new N,La=new It,vB=new N,C1=new N,AB=new N,kye=new N,dd=new N,fd=new N,Fye=new N,Xh=new Ue,S1=new It,Ho=[0,0,0];class yB extends id{constructor(){super(),this.isMotionPathConstraint=!0,this.type="MotionPathConstraint",this.curve=null,this.firstDerivativeEvaluator=null,this.secondDerivativeEvaluatorForNonUniformBSplines=null,this.derivativeEvaluatorForWeights0=null,this.derivativeEvaluatorForWeights1=null,this.derivativeEvaluatorForWeights2=null,this.degree=3,this.cvs=[],this.knots=[],this.weights=[],this.value=0,this.follow=!0,this.frontAxis="Z",this.upAxis="Y",this.worldUpVector=new N(0,1,0),this.useChordLength=!1,this.chordsNum=0,this.chordLengths=[],this.bank=!1,this.bankScale=1,this.bankLimit=1/0,this.useFixedLocation=!1,this.fixedValue=0,this.usePointsTilt=!1,this.pointsTilt=[],this.pointsTiltEvaluator=null,this.offsetValue=0,this.useClampValue=!1,this.useCyclic=!1,this.useObjOffset=!1,this.useRelative=!1,this.usePosOffset=!0,this.objOffsetMode=R3.DEFAULT,this.objOffsetRotMode=E1.ONLY_CONSTRAINT,this.influence=1,this.fixCameraLightRotation=!1,this._firstIteration=!0,this._objMatrixWorldInit=new Ue,this._objPosWorldInit=new N,this._objRotWorldInit=new It}copy(e){super.copy(e),this.degree=e.degree,this.cvs=[];for(let t=0;t<e.cvs.length;++t)this.cvs.push(e.cvs[t]);this.knots=[];for(let t=0;t<e.knots.length;++t)this.knots.push(e.knots[t]);this.weights=[];for(let t=0;t<e.weights.length;++t)this.weights.push(e.weights[t]);this.value=e.value,this.follow=e.follow,this.frontAxis=e.frontAxis,this.upAxis=e.upAxis,this.worldUpVector.copy(e.worldUpVector),this.useChordLength=e.useChordLength,this.chordsNum=e.chordsNum,this.bank=e.bank,this.bankScale=e.bankScale,this.bankLimit=e.bankLimit,this.useFixedLocation=e.useFixedLocation,this.fixedValue=e.fixedValue,this.usePointsTilt=e.usePointsTilt,this.pointsTilt=[];for(let t=0;t<e.pointsTilt.length;++t)this.pointsTilt.push(e.pointsTilt[t]);return this.offsetValue=e.offsetValue,this.useClampValue=e.useClampValue,this.useCyclic=e.useCyclic,this.useObjOffset=e.useObjOffset,this.useRelative=e.useRelative,this.usePosOffset=e.usePosOffset,this.objOffsetMode=e.objOffsetMode,this.objOffsetRotMode=e.objOffsetRotMode,this.influence=e.influence,this.fixCameraLightRotation=e.fixCameraLightRotation,this._firstIteration=!0,this}init(){const e=[],t=this.cvs;for(let a=0;a<t.length;a+=3)e.push([t[a],t[a+1],t[a+2]]);this.curve=x1({points:e,knots:this.knots,weights:this.weights,degree:this.degree}),this.firstDerivativeEvaluator=this.curve.evaluator(1);let r=x1({points:e,knots:this.knots,degree:this.degree});this.secondDerivativeEvaluatorForNonUniformBSplines=r.evaluator(2);const o=[];for(let a=0;a<this.weights.length;++a)o.push([this.weights[a]]);let i=x1({points:o,knots:this.knots,degree:this.degree});if(this.derivativeEvaluatorForWeights0=i.evaluator(0),this.derivativeEvaluatorForWeights1=i.evaluator(1),this.derivativeEvaluatorForWeights2=i.evaluator(2),this.usePointsTilt){const a=[];for(let l=0;l<this.pointsTilt.length;++l)a.push([this.pointsTilt[l]]);const s=x1({points:a,knots:this.knots,weights:this.weights,degree:this.degree});this.pointsTiltEvaluator=s.evaluator(0)}else this.pointsTiltEvaluator=null;if(this.useChordLength)if(this.chordLengths=[],this.chordsNum<=0){let a=this.degree==1?1:32;this._calcChordLengths(this.chordLengths,this.cvs.length/3*a)}else this._calcChordLengths(this.chordLengths,this.chordsNum)}update(e){if(super.update(e),this.mute)return;this._firstIteration&&(this._updateObjMatrixWorld(e),e.matrixWorld.decompose(this._objPosWorldInit,this._objRotWorldInit,vB),this._objMatrixWorldInit.copy(e.matrixWorld),this.useRelative&&(this._calcPosition(Yh,0),this._objPosWorldInit.sub(Yh),this._objMatrixWorldInit.setPosition(this._objPosWorldInit)),this.usePosOffset||(this._objPosWorldInit.set(0,0,0),this._objMatrixWorldInit.setPosition(this._objPosWorldInit)),this._firstIteration=!1);let t=this.useFixedLocation?this.fixedValue:this.value+this.offsetValue;this.useCyclic?t-=Math.floor(t):t=this.useClampValue?Ht(t,0,1):Math.max(0,t),this.useChordLength&&(t=this._convertParamToChordLength(t,this.chordLengths));const r=this.curve.domain,o=t*(r[0][1]-r[0][0])+r[0][0];if(this._calcPosition(e.position,o),!this.follow&&this.useObjOffset&&(C1.addVectors(e.position,this._objPosWorldInit),e.position.lerpVectors(this._objPosWorldInit,C1,this.influence)),this.follow&&Math.abs(Ac[this.frontAxis].dot(Ac[this.upAxis]))!=1){const i=this._calcTangent(C1,o),a=AB.copy(i).normalize();if(this._calcCurveRotMat(Xh,a,this.worldUpVector),this._calcFrontAndUpVecsRotQuat(La,Ac[this.frontAxis],Ac[this.upAxis]),e.quaternion.setFromRotationMatrix(Xh).multiply(La),this.bank){const s=this._calcSecondDerivative(AB,o,e.position,i),l=this._calcCurvature(i,s),c=kye.copy(Ac[this.upAxis]).applyQuaternion(e.quaternion);let u=this._calcBankAngle(l,i,s,c);u=this._limitAngle(u*this.bankScale,this.bankLimit),La.setFromAxisAngle(Ac[this.frontAxis],u),e.quaternion.multiply(La)}else if(this.usePointsTilt){this.pointsTiltEvaluator(Ho,o);let s=Ho[0];La.setFromAxisAngle(Ac[this.frontAxis],s),e.quaternion.multiply(La)}if(this.useObjOffset){if(this.objOffsetMode==R3.MATRIX){const s=C1.setScalar(1);Xh.compose(e.position,e.quaternion,s),this.objOffsetRotMode==E1.CONSTRAINT_FIRST&&Xh.multiply(this._objMatrixWorldInit),Xh.decompose(Yh,La,vB)}else this.objOffsetMode==R3.DEFAULT&&(Yh.addVectors(e.position,this._objPosWorldInit),this.objOffsetRotMode==E1.ONLY_CONSTRAINT?La.copy(e.quaternion):this.objOffsetRotMode==E1.CONSTRAINT_FIRST&&La.multiplyQuaternions(e.quaternion,this._objRotWorldInit));e.position.lerpVectors(this._objPosWorldInit,Yh,this.influence),e.quaternion.slerpQuaternions(this._objRotWorldInit,La,this.influence)}this.fixCameraLightRotation&&(e.isCamera||e.isLight)&&e.quaternion.multiply(Nye)}}_calcPosition(e,t){return this.curve.evaluate(Ho,t),e.fromArray(Ho)}_calcTangent(e,t){return this.firstDerivativeEvaluator(Ho,t),e.fromArray(Ho)}_calcCurveRotMat(e,t,r){const o=dd.copy(r),i=fd.crossVectors(o,t).normalize();return o.crossVectors(t,i),e.makeBasis(i,o,t),e}_calcFrontAndUpVecsRotQuat(e,t,r){e.setFromUnitVectors(t,_B);const o=dd.copy(Oye),i=fd.copy(r).applyQuaternion(e),a=i.dot(o);if(Math.abs(a)!=1){const s=Fye.crossVectors(i,o).dot(_B)>0?1:-1;S1.setFromAxisAngle(t,i.angleTo(o)*s),e.multiply(S1)}else a<0&&(S1.setFromAxisAngle(t,Math.PI),e.multiply(S1));return e}_calcBankAngle(e,t,r,o){const i=dd.copy(t).add(r).normalize();return e*(fd.crossVectors(i,t).normalize().dot(o)>0?1:-1)}_calcCurvature(e,t){return dd.crossVectors(e,t).length()/Math.pow(e.length(),3)}_calcSecondDerivative(e,t,r,o){this.secondDerivativeEvaluatorForNonUniformBSplines(Ho,t);const i=dd.fromArray(Ho);this.derivativeEvaluatorForWeights1(Ho,t);const a=Ho[0];this.derivativeEvaluatorForWeights2(Ho,t);const s=Ho[0];this.derivativeEvaluatorForWeights0(Ho,t);const l=Ho[0];return e.copy(i).sub(fd.copy(o).multiplyScalar(2*a)),e.sub(fd.copy(r).multiplyScalar(s)),e.divideScalar(l),e}_limitAngle(e,t){return e>0?Math.min(e,t):Math.max(e,-t)}_calcChordLengths(e,t){let r=1/Math.max(1,t-1),o=0,i=0;const a=this.curve.domain;let s=a[0][0],l=a[0][1]-a[0][0];const c=dd,u=fd;this._calcPosition(c,s);for(let d=0;d<t;++d)this._calcPosition(u,o*l+s),i+=c.subVectors(u,c).length(),e.push(i),c.copy(u),o+=r;return e}_convertParamToChordLength(e,t){if(e<=0)return 0;if(e>=1)return 1;let r=e*t[t.length-1],o=0,i=0,a=t.length-1;for(;o<a;)i=o+Math.floor((a-o)/2),r>t[i]?o=i+1:a=i-1;return r>t[a]?a+=(r-t[a])/(t[a+1]-t[a]):a-=1-(r-t[a-1])/(t[a]-t[a-1]),a/(t.length-1)}}const Vye=new It().setFromAxisAngle(new N(1,0,0),-Math.PI/2),bB=new N,Uye=new It,xB=new N,L3=new $i,w1=new Ue,P3=new Ue,EB={X:0,Y:1,Z:2,"-X":0,"-Y":1,"-Z":2},M1=["x","y","z"],zye=new N,Gye=new N,Hye=new N,D3=new $i;function B3(n,e,t,r=!1){if(e===t)return n;const o=n.y,i=n.z;return e==="Z_UP_RIGHT"&&t==="Y_UP_RIGHT"?(n.y=i,n.z=r?o:-o):e==="Y_UP_RIGHT"&&t==="Z_UP_RIGHT"?(n.y=r?i:-i,n.z=o):console.error("transformCoordsSpace: Unsupported coordinate space"),n}const CB=(function(){const n=new $i,e=new $i,t=new N;return function(r,o){const i=n.copy(r).reorder("YZX"),a=e.copy(i).makeAlternative(),s=t.setFromEuler(i).lengthSq(),l=t.setFromEuler(a).lengthSq();return o.copy(s<l?i:a),B3(o,"Y_UP_RIGHT","Z_UP_RIGHT")}})();class SB extends Ao{constructor(e){super(e),this.isTransformationConstraint=!0,this.type="TransformationConstraint",this.coordSystem="Y_UP_RIGHT",this.fromMin=new N,this.fromMax=new N,this.toMin=new N,this.toMax=new N,this.mapFrom="POSITION",this.mapTo="POSITION",this.mapToAxisFromAxis=["X","Y","Z"],this.mixMode="REPLACE",this.ownerSpaceObj=null,this.targetSpaceObj=null,this.ownerSpace=0,this.targetSpace=0,this.useMotionExtrapolate=!1,this.influence=1,this.fixCameraLightRotation=!1,this._firstIteration=!0,this._objMatrixWorldInit=new Ue,this._objMatrixInit=new Ue}copy(e){return super.copy(e),this.coordSystem=e.coordSystem,this.fromMin.copy(e.fromMin),this.fromMax.copy(e.fromMax),this.toMin.copy(e.toMin),this.toMax.copy(e.toMax),this.mapFrom=e.mapFrom,this.mapTo=e.mapTo,this.mapToAxisFromAxis=e.mapToAxisFromAxis,this.mixMode=e.mixMode,this.ownerSpaceObj=e.ownerSpaceObj,this.targetSpaceObj=e.targetSpaceObj,this.ownerSpace=e.ownerSpace,this.targetSpace=e.targetSpace,this.useMotionExtrapolate=e.useMotionExtrapolate,this.influence=e.influence,this.fixCameraLightRotation=e.fixCameraLightRotation,this._firstIteration=!0,this}update(e){if(super.update(e),this.mute)return;this._firstIteration&&(this._updateObjMatrixWorld(e),this._objMatrixWorldInit.copy(e.matrixWorld),this._objMatrixInit.copy(e.matrix),this._firstIteration=!1);const t=w1;if(this.targetSpace==0)t.copy(this.target.matrixWorld);else if(this.targetSpace==2)t.copy(this.target.matrix);else if(this.targetSpace==1){if(!this.targetSpaceObj)return;t.copy(this.targetSpaceObj.matrixWorld).invert(),t.multiply(this.target.matrixWorld)}if(t.decomposeE(bB,L3,xB),this.ownerSpace==0&&e.parent)this._objMatrixWorldInit.decomposeE(e.position,e.rotation,e.scale);else if(this.ownerSpace==2)this._objMatrixInit.decomposeE(e.position,e.rotation,e.scale);else if(this.ownerSpace==1){if(!this.ownerSpaceObj)return;P3.copy(this.ownerSpaceObj.matrixWorld).invert(),P3.multiply(this._objMatrixWorldInit),P3.decomposeE(e.position,e.rotation,e.scale)}const r=zye;if(this.mapFrom=="POSITION")r.copy(bB);else if(this.mapFrom=="ROTATION")if(this.coordSystem=="Z_UP_RIGHT"){const d=CB(L3,D3);B3(d,this.coordSystem,"Y_UP_RIGHT"),r.copy(d)}else r.copy(L3);else this.mapFrom=="SCALE"&&r.copy(xB);const o=Gye.set(0,0,0),i=r,a=this.fromMin,s=this.fromMax;for(const d of M1)s[d]-a[d]!=0&&(this.useMotionExtrapolate||(i[d]=Math.min(Math.max(i[d],a[d]),s[d])),o[d]=(i[d]-a[d])/(s[d]-a[d]));const l=this.toMin,c=this.toMax,u=Hye;for(let d=0;d<3;d++){const f=M1[d];this.mapToAxisFromAxis[d].indexOf("-")>-1?u[f]=l[f]+(1-o[M1[EB[this.mapToAxisFromAxis[d]]]])*(c[f]-l[f]):u[f]=l[f]+o[M1[EB[this.mapToAxisFromAxis[d]]]]*(c[f]-l[f])}if(this.mapTo=="POSITION")this.mixMode=="ADD"?u.add(e.position):this.mixMode,e.position.lerp(u,this.influence);else if(this.mapTo=="ROTATION"){const d=Uye;if(this.mixMode=="ADD"){const f=D3.set(0,0,0,"XYZ");this.coordSystem=="Z_UP_RIGHT"?(CB(e.rotation,f),B3(f,this.coordSystem,"Y_UP_RIGHT"),f.x+=u.x,f.y+=u.y,f.z+=u.z,f.order="YZX"):f.set(e.rotation.x+u.x,e.rotation.y+u.y,e.rotation.z+u.z),d.setFromEuler(f)}else{const f=D3.setFromVector3(u);this.coordSystem=="Z_UP_RIGHT"&&(f.order="YZX"),d.setFromEuler(f),this.mixMode=="AFTER"?d.premultiply(e.quaternion):this.mixMode=="BEFORE"?d.multiply(e.quaternion):this.mixMode}e.quaternion.slerp(d,this.influence)}else this.mapTo=="SCALE"&&(this.mixMode=="REPLACE"||this.mixMode=="MULTIPLY"&&u.multiply(e.scale),e.scale.lerp(u,this.influence));if(this.ownerSpace==0&&e.parent)e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrix.multiplyMatrices(w1.copy(e.parent.matrixWorld).invert(),e.matrixWorld),e.matrix.decompose(e.position,e.quaternion,e.scale);else if(this.ownerSpace==1){if(!this.ownerSpaceObj)return;e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorld.premultiply(w1.copy(this.ownerSpaceObj.matrixWorld)),e.matrix.copy(e.matrixWorld),e.parent&&e.matrix.premultiply(w1.copy(e.parent.matrixWorld).invert()),e.matrix.decompose(e.position,e.quaternion,e.scale)}this.mapTo=="ROTATION"&&this.fixCameraLightRotation&&(e.isCamera||e.isLight)&&e.quaternion.multiply(Vye)}}const wB=["IMAGE_AR","SKYDOME_LIGHT_AR","TEXTURE_BL","TEX_IMAGE_BL","TEX_ENVIRONMENT_BL","BITMAP_MX","BITMAP_ENV_MX","REFLECT_REFRACT_MX","FILE_MY","AI_SKYDOME_LIGHT_MY","OSL_NODE"];class MB extends Ci{constructor(e){super(e),this.ktx2Loader=null,this.pluginCallbacks=[],this.register((function(t){return new Qye(t)})),this.register((function(t){return new $ye(t)})),this.register((function(t){return new Xye(t)})),this.register((function(t){return new qye(t)})),this.register((function(t){return new Kye(t)})),this.register((function(t){return new Zye(t)})),this.register((function(t){return new Jye(t)})),this.register((function(t){return new e2e(t)})),this.register((function(t){return new t2e(t)})),this.register((function(t){return new n2e(t)})),this.register((function(t){return new r2e(t)})),this.onProgress=null}load(e,t,r,o){const i=this;let a;i.onProgress=r||function(){},a=this.resourcePath!==""?this.resourcePath:this.path!==""?this.path:Ea.extractUrlBase(e);const s=e.indexOf(".xz",e.length-3)!=-1;let l;s?l=new Wh(i.manager):(l=new Si(i.manager),l.setResponseType("arraybuffer"));const c=function(d){i.onProgress&&i.onProgress(.3*d*100)};let u=c;l instanceof Si&&(u=function(d){const f=d.lengthComputable?d.loaded/d.total:1;c(f)}),l.load(e,(function(d){try{i.parse(d,a,t,o,s)}catch(f){o!==void 0&&o(f.constructor===Error?f:new Error("v3d.GLTFLoader: Unable to parse model."))}}),u,o)}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(){return console.error("v3d.GLTFLoader: Mesh optimization is not supported, please use LZMA compression."),this}setDRACOLoader(){return console.error("v3d.GLTFLoader: Draco compression is not supported, please use LZMA compression."),this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,r,o,i){let a;const s={},l={};if(typeof e=="string")a=e;else if(Ea.decodeText(new Uint8Array(e,0,4))===TB){try{s[Hn.KHR_BINARY_GLTF]=new Yye(e)}catch(f){return void(o&&o(f))}a=s[Hn.KHR_BINARY_GLTF].content}else a=Ea.decodeText(new Uint8Array(e));const c=JSON.parse(a);if(c.asset===void 0||c.asset.version[0]<2)return void(o&&o(new Error("v3d.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.")));const u=this,d=new h2e(c,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,loadBinXZ:i,onProgress:function(f){u.onProgress&&u.onProgress(f)}});for(let f=0;f<this.pluginCallbacks.length;f++){const h=this.pluginCallbacks[f](d);l[h.name]=h,s[h.name]=!0}if(c.extensionsUsed)for(let f=0;f<c.extensionsUsed.length;++f){const h=c.extensionsUsed[f],p=c.extensionsRequired||[];h===Hn.KHR_MATERIALS_UNLIT?s[h]=new jye:p.indexOf(h)>=0&&l[h]===void 0&&console.warn('v3d.GLTFLoader: Unknown extension "'+h+'".')}d.setExtensions(s),d.setPlugins(l),d.parse((function(f){u.onProgress&&u.onProgress(100),r(f)}),o)}parseAsync(e,t){const r=this;return new Promise((function(o,i){r.parse(e,t,o,i)}))}}function Wye(){let n={};return{get:function(e){return n[e]},add:function(e,t){n[e]=t},remove:function(e){delete n[e]},removeAll:function(){n={}}}}const Hn={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_TEXTURE_BASISU:"KHR_texture_basisu",EXT_TEXTURE_WEBP:"EXT_texture_webp",S8S_V3D_ANIMATION:"S8S_v3d_animation",S8S_V3D_CAMERA:"S8S_v3d_camera",S8S_V3D_MATERIALS:"S8S_v3d_materials",S8S_V3D_MESH:"S8S_v3d_mesh",S8S_V3D_NODE:"S8S_v3d_node",S8S_V3D_SCENE:"S8S_v3d_scene",S8S_V3D_TEXTURE:"S8S_v3d_texture",S8S_V3D_LIGHTS:"S8S_v3d_lights",S8S_V3D_LIGHT_PROBES:"S8S_v3d_light_probes",S8S_V3D_CURVES:"S8S_v3d_curves",S8S_V3D_CLIPPING_PLANES:"S8S_v3d_clipping_planes"};class jye{constructor(){this.name=Hn.KHR_MATERIALS_UNLIT}getMaterialType(){return pr}extendParams(e,t,r){const o=[];e.color=new Ge(1,1,1),e.opacity=1;const i=t.pbrMetallicRoughness;if(i){if(Array.isArray(i.baseColorFactor)){const a=i.baseColorFactor;e.color.fromArray(a),e.opacity=a[3]}i.baseColorTexture!==void 0&&o.push(r.assignTexture(e,"map",i.baseColorTexture,3001))}return Promise.all(o)}}class Qye{constructor(e){this.parser=e,this.name=Hn.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,r=t.json,o=r.textures[e];if(!o.extensions||!o.extensions[this.name])return null;const i=o.extensions[this.name],a=t.options.ktx2Loader;if(!a){if(r.extensionsRequired&&r.extensionsRequired.indexOf(this.name)>=0)throw new Error("v3d.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,i.source,a)}}class $ye{constructor(e){this.parser=e,this.name=Hn.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,r=this.parser,o=r.json,i=o.textures[e];if(!i.extensions||!i.extensions[t])return null;const a=i.extensions[t],s=o.images[a.source];let l=r.textureLoader;if(s.uri){const c=r.options.manager.getHandler(s.uri);c!==null&&(l=c)}return this.detectSupport().then((function(c){if(c)return r.loadTextureImage(e,a.source,l);if(o.extensionsRequired&&o.extensionsRequired.indexOf(t)>=0)throw new Error("v3d.GLTFLoader: WebP required by asset but unsupported.");return r.loadTexture(e)}))}detectSupport(){return this.isSupported||(this.isSupported=new Promise((function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(t.height===1)}}))),this.isSupported}}const TB="glTF",IB={JSON:1313821514,BIN:5130562};class Yye{constructor(e){this.name=Hn.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,12);if(this.header={magic:Ea.decodeText(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==TB)throw new Error("v3d.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("v3d.GLTFLoader: Legacy binary file detected.");const r=this.header.length-12,o=new DataView(e,12);let i=0;for(;i<r;){const a=o.getUint32(i,!0);i+=4;const s=o.getUint32(i,!0);if(i+=4,s===IB.JSON){const l=new Uint8Array(e,12+i,a);this.content=Ea.decodeText(l)}else if(s===IB.BIN){const l=12+i;this.body=e.slice(l,l+a)}i+=a}if(this.content===null)throw new Error("v3d.GLTFLoader: JSON content not found.")}}class Xye{constructor(e){this.parser=e,this.name=Hn.S8S_V3D_LIGHTS,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let r=0,o=t.length;r<o;r++){const i=t[r];i.extensions&&i.extensions[this.name]&&i.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,i.extensions[this.name].light)}}_loadLight(e){const t=this.parser,r="light:"+e;let o=t.cache.get(r);if(o)return o;const i=t.json,a=((i.extensions&&i.extensions[this.name]||{}).lights||[])[e];let s;const l=new Ge().fromArray(a.color),c=a.intensity??1;switch(a.type){case"point":s=new HP(l,c);break;case"directional":s=new YP(l,c);break;case"spot":s=new UP(l,c);break;case"area":s=new WP(l,c,a.width,a.height);break;case"ambient":s=new XP(l,c);break;default:console.error("v3d.GLTFLoader: Invalid light type",a.type)}let u;return _e(a.distance)&&(s.distance=a.distance),_e(a.decay)&&(s.decay=a.decay,a.profile!="blender"||_e(a.power)||(s.userData.usePowerUnits=!0,s.power=c)),_e(a.power)&&(s.userData.usePowerUnits=!0,s.power=a.power),_e(a.angle)&&(s.angle=a.angle),_e(a.penumbra)&&(s.penumbra=a.penumbra),s.isRectAreaLight&&S6.init(a.ltcMat1,a.ltcMat2),_e(a.shadow)?(s.castShadow=a.shadow.enabled,s.shadow.bias=a.shadow.bias,s.shadow.expBias=a.shadow.expBias,s.shadow.slopeScaledBias=a.shadow.slopeScaledBias,s.shadow.radius=a.shadow.radius,s.shadow.mapSize.width=a.shadow.mapSize,s.shadow.mapSize.height=a.shadow.mapSize,s.shadow.camera.near=a.shadow.cameraNear,s.shadow.camera.far=a.shadow.cameraFar,s.isSpotLight?(s.shadow.camera.fov=Fg(a.shadow.cameraFov),s.shadow.useMinFov90=a.profile==="blender"):s.isDirectionalLight&&(_e(a.shadow.cameraOrthoLeft)&&_e(a.shadow.cameraOrthoRight)&&_e(a.shadow.cameraOrthoBottom)&&_e(a.shadow.cameraOrthoTop)&&(s.shadow.camera.left=a.shadow.cameraOrthoLeft,s.shadow.camera.right=a.shadow.cameraOrthoRight,s.shadow.camera.bottom=a.shadow.cameraOrthoBottom,s.shadow.camera.top=a.shadow.cameraOrthoTop),s.shadow.maxDistance=a.shadow.cameraFar,_e(a.shadow.csm)&&(_e(a.shadow.csm.count)&&(s.shadow.numCascades=a.shadow.csm.count),_e(a.shadow.csm.maxDistance)&&(s.shadow.maxDistance=a.shadow.csm.maxDistance),_e(a.shadow.csm.fade)&&(s.shadow.fade=a.shadow.csm.fade),_e(a.shadow.csm.exponent)&&(s.shadow.exponent=a.shadow.csm.exponent),_e(a.shadow.csm.lightMargin)&&(s.shadow.lightMargin=a.shadow.csm.lightMargin)),s.shadow.createCascades()),s.shadow.camera.updateProjectionMatrix()):s.castShadow=!1,s.name=a.name?t.createUniqueName(a.name):"",(s.isDirectionalLight||s.isSpotLight)&&_e(a.target)?(s.isFreeLight=!1,u=t.getDependency("node",a.target)):((s.isDirectionalLight||s.isSpotLight)&&(s.isFreeLight=!0),u=Promise.resolve()),u.then((d=>(d&&(s.target=d),o=Promise.resolve(s),t.cache.add(r,o),o)))}createNodeAttachment(e){const t=this,r=this.parser,o=r.json.nodes[e],i=(o.extensions&&o.extensions[this.name]||{}).light;return i===void 0?null:this._loadLight(i).then((function(a){return r._getNodeRef(t.cache,i,a)}))}}class qye{constructor(e){this.parser=e,this.name=Hn.S8S_V3D_LIGHT_PROBES,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let r=0,o=t.length;r<o;r++){const i=t[r];i.extensions&&i.extensions[this.name]&&i.extensions[this.name].lightProbe!==void 0&&e._addNodeRef(this.cache,i.extensions[this.name].lightProbe)}}_loadLightProbe(e){const t=this.parser,r="lightProbe:"+e;let o=t.cache.get(r);if(o)return o;const i=t.json,a=((i.extensions&&i.extensions[this.name]||{}).lightProbes||[])[e];let s;const l=a.type||"CUBEMAP";if(l=="CUBEMAP"||l=="SPHERE"){switch(s=new l3,a.influenceType){case"ELIPSOID":s.influenceType=1;break;case"BOX":s.influenceType=2}switch(a.parallaxType){case"ELIPSOID":s.parallaxType=1;break;case"BOX":s.parallaxType=2}s.parallaxDistance=a.parallaxDistance,s.probeClipEnd=a.clipEnd,s.probeIntensity=a.intensity,_e(a.influenceGroup)&&(s.influenceGroup=a.influenceGroup),_e(a.influenceGroupInv)&&(s.influenceGroupInv=a.influenceGroupInv)}else s=new uye,s.falloff=a.falloff,_e(a.planeSize)&&s.planeSize.set(a.planeSize[0],a.planeSize[1]);return s.influenceDistance=a.influenceDistance,s.probeClipStart=a.clipStart,s.visibilityGroup=a.visibilityGroup,s.visibilityGroupInv=a.visibilityGroupInv,s.name=t.createUniqueName(a.name||"lightProbe_"+e),o=Promise.resolve(s),t.cache.add(r,o),o}createNodeAttachment(e){const t=this,r=this.parser,o=r.json.nodes[e],i=(o.extensions&&o.extensions[this.name]||{}).lightProbe;return i===void 0?null:this._loadLightProbe(i).then((function(a){return r._getNodeRef(t.cache,i,a)}))}}class Kye{constructor(e){this.parser=e,this.name=Hn.S8S_V3D_CURVES,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let r=0,o=t.length;r<o;r++){const i=t[r];i.extensions&&i.extensions[this.name]&&i.extensions[this.name].curve!==void 0&&e._addNodeRef(this.cache,i.extensions[this.name].curve)}}_loadOpenType(){return new Promise((function(e){i2("opentype.js",(function(){e()}),(function(){console.error("GLTFLoader: opentype.js module not found, please copy it to your app directory"),e()}))}))}_loadFont(e){const t=this.parser,r="font:"+e;let o=t.cache.get(r);if(o)return o;const i=t.json,a=((i.extensions&&i.extensions[this.name]||{}).fonts||[])[e];let s=a.uri,l=!1;return a.bufferView!==void 0&&(s=t.getDependency("bufferView",a.bufferView).then((function(c){l=!0;const u=new Blob([c],{type:a.mimeType});return s=URL.createObjectURL(u),s}))),Promise.all([this._loadOpenType(),s]).then((function(c){if(s=c[1],typeof opentype>"u")return null;const u=new u3;return u.setCrossOrigin(t.options.crossOrigin),new Promise((function(d,f){u.load(Ea.resolveURL(s,t.options.path),d,void 0,f)})).then((function(d){return new h3(d)}),(function(d){return null}))})).then((function(c){return l===!0&&URL.revokeObjectURL(s),o=Promise.resolve(c),t.cache.add(r,o),o}))}_loadCurve(e){const t=this.parser,r="curve:"+e;let o=t.cache.get(r);if(o)return o;const i=t.json,a=((i.extensions&&i.extensions[this.name]||{}).curves||[])[e];let s,l=a.type;const c=[];return c.push(this._loadFont(a.font)),a.material!==void 0?c.push(t.getDependency("material",a.material)):c.push(BB(t.cache)),Promise.all(c).then((function(u){const d=u[0],f=u[1];if(d===null&&(l="empty"),l==="font"){const h=a.bevelSize>0||a.bevelThickness>0,p=new Ih(a.text,{font:d,size:a.size,height:a.height,curveSegments:a.curveSegments,bevelEnabled:h,bevelThickness:a.bevelThickness,bevelSize:a.bevelSize,bevelSegments:a.bevelSegments,alignX:a.alignX,alignY:a.alignY,lineHeight:a.lineHeight,scaledEmSize:a.scaledEmSize});s=new Mt(p,f)}else s=new kt;return s.name=t.createUniqueName(a.name||"curve_"+e),o=Promise.resolve(s),t.cache.add(r,o),o}))}createNodeAttachment(e){const t=this,r=this.parser,o=r.json.nodes[e],i=(o.extensions&&o.extensions[this.name]||{}).curve;return i===void 0?null:this._loadCurve(i).then((function(a){return r._getNodeRef(t.cache,i,a)}))}}class Zye{constructor(e){this.parser=e,this.name=Hn.S8S_V3D_CLIPPING_PLANES,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let r=0,o=t.length;r<o;r++){const i=t[r];i.extensions&&i.extensions[this.name]&&i.extensions[this.name].clippingPlane!==void 0&&e._addNodeRef(this.cache,i.extensions[this.name].clippingPlane)}}_loadClippingPlane(e){const t=this.parser,r="clippingPlane:"+e;let o=t.cache.get(r);if(o)return o;const i=t.json,a=((i.extensions&&i.extensions[this.name]||{}).clippingPlanes||[])[e],s=new hye;return s.clippingGroup=a.clippingGroup,s.clipShadows=a.clipShadows,s.negated=a.negated,s.clipIntersection=a.clipIntersection,s.crossSection=a.crossSection,s.crossSectionColor=new Ge().fromArray(a.color),s.crossSectionOpacity=a.opacity,s.crossSectionSize=a.size,_e(a.renderSide)&&(s.crossSectionRenderSide=DB[a.renderSide]),s.name=t.createUniqueName(a.name||"clippingPlane_"+e),o=Promise.resolve(s),t.cache.add(r,o),o}createNodeAttachment(e){const t=this,r=this.parser,o=r.json.nodes[e],i=(o.extensions&&o.extensions[this.name]||{}).clippingPlane;return i===void 0?null:this._loadClippingPlane(i).then((function(a){return r._getNodeRef(t.cache,i,a)}))}}class Jye{constructor(e){this.name=Hn.S8S_V3D_SCENE,this.parser=e}beforeRoot(){let e=this.parser.json.asset.generator||"";e.indexOf("Verge3D")>-1&&(e.match(/(\d+).(\d+).(\d+)/)||(e+=" v0.0.0"),VR(e,"4.10.0",2)<0&&console.warn("Loading glTF asset in older version of Verge3D runtime. Please update your application!"))}afterRoot(e){const t=this.parser,r=t.json,o=r.scenes[r.scene||0],i=e.scene,a=_e(o.extensions)?o.extensions[Hn.S8S_V3D_SCENE]:void 0,s=[],l=[],c=[];let u;return u=o&&a&&_e(a.worldMaterial)?t.getDependency("material",a.worldMaterial):Promise.resolve(),u.then((d=>{const f={};d&&(f.material=d),e.world=f})).then((()=>(t.assignedMaterials.forEach((function(d){d.isMeshNodeMaterial&&d.traverseNodes((function(f){f.originData.type==="TEX_COORD_BL"&&_e(f.originData.object)&&f.originData.object>-1&&(s.push(t.getDependency("node",f.originData.object)),l.push(f),c.push(d))}))})),Promise.all(s)))).then((d=>{for(let p=0;p<d.length;p++){const m=d[p],g=l[p],_=c[p],A=_.nodeTexCoordObjectMap[g.originData.name];_.nodeTexCoordObject[A]=m}const f=[];for(let p=0;p<e.cameras.length;p++){const m=e.cameras[p];let g=!1;m.traverseAncestors((function(_){_==i&&(g=!0)})),g&&f.push(m)}e.cameras=f;const h={};if(o){const p=_e(o.extensions)?o.extensions[Hn.S8S_V3D_SCENE]:void 0;if(p){if(_e(p.shadowMap)){switch(h.shadowMap={enabled:!0},p.shadowMap.type){case"BASIC":h.shadowMap.type=0;break;case"BILINEAR":h.shadowMap.type=1;break;case"PCFSOFT":console.warn("v3d.GLTFLoader: PCF Bilinear shadows deprecated since Verge3D 4.7, using PCF (with poisson disk sampling) instead"),h.shadowMap.type=2;break;case"PCF":case"PCFPOISSON":h.shadowMap.type=2;break;case"ESM":h.shadowMap.type=3}let m;m=p.shadowMap.renderSingleSided?p.shadowMap.renderReverseSided?1:0:2,i.traverse((function(g){const _=g.material;_&&(_.shadowSide=m)})),h.esmDistanceScale=p.shadowMap.esmDistanceScale}if(_e(p.aaMethod)&&(h.aaMethod=p.aaMethod),_e(p.useHDR)&&(h.useHDR=p.useHDR),_e(p.useOIT)&&(h.useOIT=p.useOIT),_e(p.unitsScaleFactor)&&(h.unitsScaleFactor=p.unitsScaleFactor),_e(p.toneMapping)){switch(p.toneMapping.type){case"logarithmicMax":h.toneMapping=6,h.toneMappingBrightness=p.toneMapping.brightness,h.toneMappingContrast=p.toneMapping.contrast,h.toneMappingMidTones=p.toneMapping.midTones,h.toneMappingPhysicalScale=p.toneMapping.physicalScale,h.toneMappingChromaticAdaptation=p.toneMapping.chromaticAdaptation,h.toneMappingWhiteColor=new Ge().fromArray(p.toneMapping.whiteColor),h.toneMappingColorDifferentiation=p.toneMapping.colorDifferentiation,h.toneMappingExteriorDaylight=p.toneMapping.exteriorDaylight;break;case"physicalMax":h.toneMapping=7,h.toneMappingWhiteBalance=new Ge().fromArray(p.toneMapping.whiteBalance),h.toneMappingHighlights=p.toneMapping.highlights,h.toneMappingMidTones=p.toneMapping.midTones,h.toneMappingShadows=p.toneMapping.shadows,h.toneMappingSaturation=p.toneMapping.saturation,h.toneMappingPhysicalScale=p.toneMapping.physicalScale,h.toneMappingAperture=p.toneMapping.aperture,h.toneMappingShutter=p.toneMapping.shutter,h.toneMappingISO=p.toneMapping.iso,h.toneMappingVignetting=p.toneMapping.vignetting;break;case"filmicBlender":h.toneMapping=8;break;case"agxBlender":h.toneMapping=9;break;case"pbrNeutral":h.toneMapping=10}switch(p.toneMapping.look){case"NONE":h.toneMappingLook=0;break;case"AGX_PUNCHY":h.toneMappingLook=1;break;default:p.toneMapping.type==="agxBlender"&&console.warn(`v3d.GLTFLoader: ${p.toneMapping.look} look is not supported, fallback to None`),h.toneMappingLook=0}}if(_e(p.pmremMaxTileSize)&&(h.pmremMaxTileSize=p.pmremMaxTileSize),_e(p.iblEnvironmentMode))switch(p.iblEnvironmentMode){case"PMREM":default:h.iblEnvironmentMode=0;break;case"PROBE_CUBEMAP":console.warn("v3d.GLTFLoader: Cubemap probes deprecated since Verge3D 4.3, using PMREM instead"),h.iblEnvironmentMode=0;break;case"PROBE":h.iblEnvironmentMode=1;break;case"NONE":h.iblEnvironmentMode=2}_e(p.postprocessing)&&(i.postprocessing=p.postprocessing)}}e.renderer=h}))}}class e2e{constructor(e){this.name=Hn.S8S_V3D_NODE,this.parser=e}extendNodeParams(e,t){const r=t.extensions&&t.extensions[this.name];if(!r)return e;if(r.hidden&&(e.visible=!1),e.isMesh&&(_e(r.useCastShadows)?e.castShadow=r.useCastShadows:_e(e.material.castShadow)&&(e.castShadow=e.material.castShadow),_e(r.useShadows)?e.receiveShadow=r.useShadows:_e(e.material.receiveShadow)&&(e.receiveShadow=e.material.receiveShadow)),_e(r.objectIndex)&&(e.objectIndex=r.objectIndex),_e(r.objectColor)&&(e.objectColor=new Ge().fromArray(r.objectColor),e.objectAlpha=_e(r.objectColor[3])?r.objectColor[3]:1),e.renderOrder=r.renderOrder,e.frustumCulled=r.frustumCulling,_e(r.groupNames)&&(e.groupNames=r.groupNames),_e(r.hidpiCompositing)&&(e.hidpiCompositing=r.hidpiCompositing),e.isMesh&&e.material.isMeshNodeMaterial){const o=e.material;(o.hasNode("MATTE_SHADOW_MX")||o.hasNode("SHADOW_MATTE_AR")||o.hasNode("AI_SHADOW_MATTE_MY"))&&(o.transparent=!1,o.premultipliedAlpha=!0,VB(o),e.renderOrder-=1e3,e.castShadow=!1,e.receiveShadow=!0)}return this.processConstraints(e,r.constraints)}processConstraints(e,t=[]){if(e.isMaterialGeneratedMesh)return e;const r=this.parser,o=[];for(let i=0;i<t.length;i++){const a=t[i];_e(a.target)?o.push(r.getDependency("node",a.target)):o.push(Promise.resolve(null))}return Promise.all(o).then((function(i){for(let a=0;a<t.length;a++){const s=t[a],l=i[a];let c;switch(s.type){case"copyLocation":c=new L6(l),c.useX=!_e(s.useX)||s.useX,c.useY=!_e(s.useY)||s.useY,c.useZ=!_e(s.useZ)||s.useZ,c.invertX=!!_e(s.invertX)&&s.invertX,c.invertY=!!_e(s.invertY)&&s.invertY,c.invertZ=!!_e(s.invertZ)&&s.invertZ,c.useOffset=!_e(s.useOffset)||s.useOffset,c.influence=_e(s.influence)?s.influence:1;break;case"copyRotation":c=new P6(l),c.useX=!_e(s.useX)||s.useX,c.useY=!_e(s.useY)||s.useY,c.useZ=!_e(s.useZ)||s.useZ,c.invertX=!!_e(s.invertX)&&s.invertX,c.invertY=!!_e(s.invertY)&&s.invertY,c.invertZ=!!_e(s.invertZ)&&s.invertZ,c.mixMode=_e(s.mixMode)?s.mixMode:"REPLACE",c.influence=_e(s.influence)?s.influence:1,c.fixCameraLightRotation=!!_e(s.fixCameraLightRotation)&&s.fixCameraLightRotation;break;case"copyScale":c=new N6(l),c.useX=!_e(s.useX)||s.useX,c.useY=!_e(s.useY)||s.useY,c.useZ=!_e(s.useZ)||s.useZ,c.power=_e(s.power)?s.power:1,c.useMakeUniform=!!_e(s.useMakeUniform)&&s.useMakeUniform,c.useOffset=!!_e(s.useOffset)&&s.useOffset,c.useAdd=!!_e(s.useAdd)&&s.useAdd,c.influence=_e(s.influence)?s.influence:1;break;case"copyTransforms":c=new V6(l),c.mixMode=_e(s.mixMode)?s.mixMode:"REPLACE",c.influence=_e(s.influence)?s.influence:1,c.fixCameraLightRotation=!!_e(s.fixCameraLightRotation)&&s.fixCameraLightRotation;break;case"dampedTrack":c=new z6(l),c.trackAxis=s.trackAxis,c.influence=_e(s.influence)?s.influence:1,c.fixCameraLightRotation=!!_e(s.fixCameraLightRotation)&&s.fixCameraLightRotation;break;case"limitDistance":c=new W6(l),c.distance=_e(s.distance)?s.distance:0,c.limitMode=_e(s.limitMode)?s.limitMode:"LIMITDIST_INSIDE",c.useTransformLimit=!!_e(s.useTransformLimit)&&s.useTransformLimit,c.influence=_e(s.influence)?s.influence:1;break;case"limitLocation":switch(c=new j6(l),s.space){case"CUSTOM":c.space=1;break;case"WORLD":c.space=0;break;default:c.space=2}c.min.set(Number(s.minX),Number(s.minY),Number(s.minZ)),c.max.set(Number(s.maxX),Number(s.maxY),Number(s.maxZ));break;case"limitRotation":c=new Q6,c.axis=s.axis,c.min=s.min,c.max=s.max;break;case"limitScale":c=new $6,c.min.set(Number(s.minX),Number(s.minY),Number(s.minZ)),c.max.set(Number(s.maxX),Number(s.maxY),Number(s.maxZ));break;case"lockedTrack":c=new K6(l),c.trackAxis=s.trackAxis,c.lockAxis=s.lockAxis,c.fixCameraLightRotation=!!_e(s.fixCameraLightRotation)&&s.fixCameraLightRotation;break;case"trackTo":c=new iB(l),c.trackAxis=s.trackAxis,c.upAxis=s.upAxis,c.fixCameraLightRotation=!!_e(s.fixCameraLightRotation)&&s.fixCameraLightRotation;break;case"childOf":c=new R6(l),c.offsetMatrix=new Ue().fromArray(s.offsetMatrix),c.fixCameraLightRotation=!!_e(s.fixCameraLightRotation)&&s.fixCameraLightRotation;break;case"floor":c=new G6(l),c.floorLocation=s.floorLocation,c.offset=s.offset,c.useRotation=!!_e(s.useRotation)&&s.useRotation;break;case"fixOrthoZoom":c=new aB(l);break;case"canvasFit":c=new lB(l),c.edgeH=s.edgeH,c.edgeV=s.edgeV,c.fitShape=s.fitShape,c.offset=s.offset,s.fitShape=="SPHERE"&&e.resolveMultiMaterial().forEach((function(u){u.geometry&&u.geometry.computeBoundingSphere()}));break;case"canvasBreakpoints":c=new cB,c.minWidth=Number(s.minWidth),c.maxWidth=Number(s.maxWidth),c.minHeight=Number(s.minHeight),c.maxHeight=Number(s.maxHeight),c.orientation=s.orientation;break;case"motionPath":c=new yB,c.degree=s.degree,c.cvs=[];for(let u=0;u<s.cvs.length;++u)c.cvs.push(Number(s.cvs[u]));c.knots=[];for(let u=0;u<s.knots.length;++u)c.knots.push(Number(s.knots[u]));c.weights=[];for(let u=0;u<s.weights.length;++u)c.weights.push(Number(s.weights[u]));if(c.value=_e(s.value)?s.value:0,c.follow=!!_e(s.follow)&&s.follow,c.frontAxis=_e(s.frontAxis)?s.frontAxis:"Z",c.upAxis=_e(s.upAxis)?s.upAxis:"Y",c.worldUpVector=_e(s.worldUpVector)?new N().fromArray(s.worldUpVector).normalize():new N(0,1,0),c.useChordLength=!!_e(s.useChordLength)&&s.useChordLength,c.bank=!!_e(s.bank)&&s.bank,c.bankScale=_e(s.bankScale)?s.bankScale:1,c.bankLimit=_e(s.bankLimit)?s.bankLimit:1/0,c.useFixedLocation=!!_e(s.useFixedLocation)&&s.useFixedLocation,c.fixedValue=_e(s.fixedValue)?s.fixedValue:0,c.usePointsTilt=!!_e(s.usePointsTilt)&&s.usePointsTilt,c.pointsTilt=[],_e(s.pointsTilt))for(let u=0;u<s.pointsTilt.length;++u)c.pointsTilt.push(Number(s.pointsTilt[u]));c.offsetValue=_e(s.offsetValue)?s.offsetValue:0,c.useClampValue=!!_e(s.useClampValue)&&s.useClampValue,c.useCyclic=!!_e(s.useCyclic)&&s.useCyclic,c.useObjOffset=!!_e(s.useObjOffset)&&s.useObjOffset,c.useRelative=!!_e(s.useRelative)&&s.useRelative,c.usePosOffset=!_e(s.usePosOffset)||s.usePosOffset,c.objOffsetMode=_e(s.objOffsetMode)?s.objOffsetMode:0,c.objOffsetRotMode=_e(s.objOffsetRotMode)?s.objOffsetRotMode:0,c.influence=_e(s.influence)?s.influence:1,c.fixCameraLightRotation=!!_e(s.fixCameraLightRotation)&&s.fixCameraLightRotation,c.init();break;case"transformation":switch(c=new SB(l),c.fromMin.set(Number(s.fromMin[0]),Number(s.fromMin[1]),Number(s.fromMin[2])),c.fromMax.set(Number(s.fromMax[0]),Number(s.fromMax[1]),Number(s.fromMax[2])),c.toMin.set(Number(s.toMin[0]),Number(s.toMin[1]),Number(s.toMin[2])),c.toMax.set(Number(s.toMax[0]),Number(s.toMax[1]),Number(s.toMax[2])),c.mapToAxisFromAxis=s.mapToAxisFromAxis,c.mapFrom=s.mapFrom,c.mapTo=s.mapTo,s.ownerSpace){case"CUSTOM":c.ownerSpace=1;break;case"LOCAL":c.ownerSpace=2;break;default:c.ownerSpace=0}switch(s.targetSpace){case"CUSTOM":c.targetSpace=1;break;case"LOCAL":c.targetSpace=2;break;default:c.targetSpace=0}_e(s.ownerSpaceObj)&&r.getDependency("node",s.ownerSpaceObj).then((u=>{c.ownerSpaceObj=u})),_e(s.targetSpaceObj)&&r.getDependency("node",s.targetSpaceObj).then((u=>{c.targetSpaceObj=u})),c.useMotionExtrapolate=s.useMotionExtrapolate,c.mixMode=s.mixMode,c.influence=s.influence,c.fixCameraLightRotation=!!_e(s.fixCameraLightRotation)&&s.fixCameraLightRotation}c&&(c.name=s.name,c.mute=s.mute,e.constraints.push(c))}return e}))}}class t2e{constructor(e){this.name=Hn.S8S_V3D_CAMERA,this.parser=e}extendCameraParams(e,t){const r=this.parser,o=t.extensions&&t.extensions[this.name];if(!o)return Promise.resolve(e);if(e.controlSettings=new n3(o.controls,o.enablePan,o.rotateSpeed,o.moveSpeed),e.viewportFit.type=3,_e(o.viewportFitType))switch(o.viewportFitType){case"VERTICAL":e.viewportFit.type=1;break;case"HORIZONTAL":e.viewportFit.type=2;break;case"AUTO":e.viewportFit.type=3;break;case"FILL":e.viewportFit.type=4;break;case"OVERSCAN":e.viewportFit.type=5}_e(o.viewportFitInitialAspect)&&(e.viewportFit.initialAspect=o.viewportFitInitialAspect),_e(o.orbitMinDistance)&&(e.controlSettings.orbitMinDistance=o.orbitMinDistance),_e(o.orbitMaxDistance)&&(e.controlSettings.orbitMaxDistance=o.orbitMaxDistance),_e(o.orbitMinZoom)&&(e.controlSettings.orbitMinZoom=o.orbitMinZoom),_e(o.orbitMaxZoom)&&(e.controlSettings.orbitMaxZoom=o.orbitMaxZoom),_e(o.orbitMinPolarAngle)&&(e.controlSettings.orbitMinPolarAngle=o.orbitMinPolarAngle),_e(o.orbitMaxPolarAngle)&&(e.controlSettings.orbitMaxPolarAngle=o.orbitMaxPolarAngle),_e(o.orbitMinAzimuthAngle)&&(e.controlSettings.orbitMinAzimuthAngle=o.orbitMinAzimuthAngle),_e(o.orbitMaxAzimuthAngle)&&(e.controlSettings.orbitMaxAzimuthAngle=o.orbitMaxAzimuthAngle);const i=[];if(_e(o.orbitTarget))if(o.orbitTarget instanceof Array){const a=new kt;a.position.fromArray(o.orbitTarget),i.push(Promise.resolve(a))}else i.push(r.getDependency("node",o.orbitTarget));else i.push(Promise.resolve());return _e(o.fpsCollisionMaterial)?i.push(r.getDependency("material",o.fpsCollisionMaterial)):i.push(Promise.resolve()),_e(o.fpsGazeLevel)&&(e.controlSettings.gazeLevel=o.fpsGazeLevel),_e(o.fpsStoryHeight)&&(e.controlSettings.storyHeight=o.fpsStoryHeight),_e(o.enablePointerLock)&&(e.controlSettings.enablePointerLock=o.enablePointerLock),Promise.all(i).then((a=>(a[0]&&(e.controlSettings.orbitTarget=a[0]),a[1]&&(e.controlSettings.collisionMaterial=a[1]),e)))}}class n2e{constructor(e){this.name=Hn.S8S_V3D_MATERIALS,this.parser=e}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?ta:null}extendMaterialParams(e,t){const r=this.parser.json,o=r.materials[e];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const i=o.extensions[this.name],a=[];if(_e(i.nodeGraph)){const s=ta.nodeGraphFromExtGraph(i.nodeGraph);t.nodeGraph=s,ta.nodeGraphTraverse(s,(c=>{const u=c.originData;wB.indexOf(u.type)>-1&&_e(u.texture)?a.push(this.assignTextureNode(u)):u.type=="RAMP_MY"&&(u.wrapS=T1[u.wrapS]||1e3,u.wrapT=T1[u.wrapT]||1e3)}));const l=r.extensions&&r.extensions[this.name]||{};if(l&&l.nodeGraphs){t.additionalNodeGraphs={};for(let c in l.nodeGraphs){const u=ta.nodeGraphFromExtGraph(l.nodeGraphs[c]);t.additionalNodeGraphs[c]=u,ta.nodeGraphTraverse(u,(d=>{const f=d.originData;wB.indexOf(f.type)>-1&&a.push(this.assignTextureNode(f))}))}}}return _e(i.profile)&&(t.profile=i.profile),_e(i.renderSide)&&(t.side=DB[i.renderSide]),_e(i.useShadows)&&(t.receiveShadow=i.useShadows),_e(i.useCastShadows)&&(t.castShadow=i.useCastShadows),_e(i.depthWrite)&&(t.depthWrite=i.depthWrite),_e(i.depthPrepass)&&(t.depthPrepass=i.depthPrepass),_e(i.depthTest)&&(t.depthTest=i.depthTest),_e(i.dithering)&&(t.dithering=i.dithering),_e(i.materialIndex)&&(t.materialIndex=i.materialIndex),i.alphaToCoverage===!0&&(t.alphaToCoverage=!0),_e(i.gtaoVisible)&&(t.gtaoVisible=i.gtaoVisible),delete t.metalness,delete t.roughness,Promise.all(a)}assignTextureNode(e){return this.parser.getDependency("texture",e.texture).then((function(t){e.texture=t}))}assignTransparency(e,t,r){const o=t.extensions[this.name]||{};if(e.premultipliedAlpha=r==Kh.BLEND,r==Kh.BLEND)if(_e(o.blendMode)){const i=o.blendMode;e.blending=5,_e(i.blendEquation)&&(e.blendEquation=PB[i.blendEquation]),_e(i.blendEquationAlpha)&&(e.blendEquationAlpha=PB[i.blendEquationAlpha]),_e(i.srcRGB)&&(e.blendSrc=I1[i.srcRGB]),_e(i.dstRGB)&&(e.blendDst=I1[i.dstRGB]),_e(i.srcAlpha)&&(e.blendSrcAlpha=I1[i.srcAlpha]),_e(i.dstAlpha)&&(e.blendDstAlpha=I1[i.dstAlpha])}else e.useAddTransparency()?e.blending=2:VB(e)}}class r2e{constructor(e){this.parser=e,this.name=Hn.S8S_V3D_TEXTURE,this.textureLoaderRGBE=new d3,this.textureLoaderRGBE.setCrossOrigin(this.parser.options.crossOrigin),this.textureLoaderRGBE.setRequestHeader(this.parser.options.requestHeader)}loadTexture(e){const t=this.name,r=this.parser,o=r.json,i=o.textures[e];if(!i.extensions||!i.extensions[t])return null;const a=i.extensions[t];if(!_e(a.source))return null;const s=o.images[a.source];let l=r.textureLoader;if((s.uri||"").split(".").pop()=="hdr"||s.mimeType=="image/vnd.radiance"?l=this.textureLoaderRGBE:(s.uri||"").split(".").pop()!="xz"&&s.mimeType!="application/x-xz"||(l=new Wh),s.uri){const c=r.options.manager.getHandler(s.uri);c!==null&&(l=c)}return r.loadTextureImage(e,a.source,l)}extendTextureParams(e,t,r){const o=this.name;if(!t.extensions||!t.extensions[o])return null;const i=t.extensions[o],a=i.colorSpace.startsWith("linear")||i.colorSpace=="non-color"?3e3:3001;e.encoding=a,(r instanceof d3||r instanceof Wh)&&(e.minFilter=1006),_e(i.anisotropy)&&(e.anisotropy=i.anisotropy),_e(i.uvTransform)&&(e.matrix=new ao().fromArray(i.uvTransform),e.matrixAutoUpdate=!1)}}class RB extends qu{constructor(e,t,r,o){super(e,t,r,o)}copySampleValue_(e){const t=this.resultBuffer,r=this.sampleValues,o=this.valueSize,i=e*o*3+o;for(let a=0;a!==o;a++)t[a]=r[i+a];return t}interpolate_(e,t,r,o){const i=this.resultBuffer,a=this.sampleValues,s=this.valueSize,l=2*s,c=3*s,u=o-t,d=(r-t)/u,f=d*d,h=f*d,p=e*c,m=p-c,g=-2*h+3*f,_=h-f,A=1-g,y=_-f+d;for(let b=0;b!==s;b++){const E=a[m+b+s],x=a[m+b+l]*u,w=a[p+b+s],L=a[p+b]*u;i[b]=A*E+y*x+g*w+_*L}return i}}const o2e=new It;class i2e extends RB{interpolate_(e,t,r,o){const i=super.interpolate_(e,t,r,o);return o2e.fromArray(i).normalize().toArray(i),i}}const Cs={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},qh={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},LB={9728:1003,9729:1006,9984:1004,9985:1007,9986:1005,9987:1008},T1={33071:1001,33648:1002,10497:1e3},PB={32774:100,32778:101,32779:102},I1={0:200,1:201,768:202,769:203,770:204,771:205,772:206,773:207,774:208,775:209,776:210},N3={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},a2e={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},Ss={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences",intensity:"intensity",power:"power"},s2e={CUBICSPLINE:void 0,LINEAR:2301,STEP:2300},Kh={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"},DB={FRONT:0,BACK:1,DOUBLE:2,TWO_PASS_DOUBLE:3};function BB(n){return n.DefaultMaterial===void 0&&(n.DefaultMaterial=new Xu({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:0,receiveShadow:!0,castShadow:!0})),n.DefaultMaterial}function Zh(n,e,t){for(const r in t.extensions)n[r]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[r]=t.extensions[r])}function yc(n,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(n.userData,e.extras):console.warn("v3d.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function l2e(n,e,t){let r=!1,o=!1,i=!1;for(let c=0,u=e.length;c<u;c++){const d=e[c];if(d.POSITION!==void 0&&(r=!0),d.NORMAL!==void 0&&(o=!0),d.COLOR_0!==void 0&&(i=!0),r&&o&&i)break}if(!r&&!o&&!i)return Promise.resolve(n);const a=[],s=[],l=[];for(let c=0,u=e.length;c<u;c++){const d=e[c];if(r){const f=d.POSITION!==void 0?t.getDependency("accessor",d.POSITION):n.attributes.position;a.push(f)}if(o){const f=d.NORMAL!==void 0?t.getDependency("accessor",d.NORMAL):n.attributes.normal;s.push(f)}if(i){const f=d.COLOR_0!==void 0?t.getDependency("accessor",d.COLOR_0):n.attributes.color;l.push(f)}}return Promise.all([Promise.all(a),Promise.all(s),Promise.all(l)]).then((function(c){const u=c[0],d=c[1],f=c[2];return r&&(n.morphAttributes.position=u),o&&(n.morphAttributes.normal=d),i&&(n.morphAttributes.color=f),n.morphTargetsRelative=!0,n}))}function c2e(n,e){if(n.updateMorphTargets(),e.weights!==void 0)for(let t=0,r=e.weights.length;t<r;t++)n.morphTargetInfluences[t]=e.weights[t];if(e.extras&&Array.isArray(e.extras.targetNames)){const t=e.extras.targetNames;if(n.morphTargetInfluences.length===t.length){n.morphTargetDictionary={};for(let r=0,o=t.length;r<o;r++)n.morphTargetDictionary[t[r]]=r}else console.warn("v3d.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function u2e(n){return n.indices+":"+d2e(n.attributes)+":"+n.mode}function d2e(n){let e="";const t=Object.keys(n).sort();for(let r=0,o=t.length;r<o;r++)e+=t[r]+":"+n[t[r]]+";";return e}function O3(n){switch(n){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("v3d.GLTFLoader: Unsupported normalized accessor component type.")}}function f2e(n){return n.search(/\.jpe?g($|\?)/i)>0||n.search(/^data\:image\/jpeg/)===0?"image/jpeg":n.search(/\.webp($|\?)/i)>0||n.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}new Ue;class h2e{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.onProgress=t.onProgress||function(){},this.cache=new Wye,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let r=!1,o=!1,i=-1;typeof navigator<"u"&&(r=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,o=navigator.userAgent.indexOf("Firefox")>-1,i=o?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),typeof createImageBitmap>"u"||r||o&&i<98?this.textureLoader=new gb(this.options.manager):this.textureLoader=new FP(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new Si(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0),this.assignedMaterials=[]}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const r=this,o=this.json,i=this.extensions;this.cache.removeAll(),this._invokeAll((function(a){return a._markDefs&&a._markDefs()})),Promise.all(this._invokeAll((function(a){return a.beforeRoot&&a.beforeRoot()}))).then((function(){return Promise.all([r.getDependencies("scene"),r.getDependencies("animation"),r.getDependencies("camera")])})).then((function(a){const s={scene:a[0][o.scene||0],scenes:a[0],animations:a[1],cameras:a[2],asset:o.asset,parser:r,userData:{}};Zh(i,s,o),yc(s,o),Promise.all(r._invokeAll((function(l){return l.afterRoot&&l.afterRoot(s)}))).then((function(){e(s)}))})).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],r=this.json.meshes||[];for(let o=0,i=t.length;o<i;o++){const a=t[o].joints;for(let s=0,l=a.length;s<l;s++)e[a[s]].isBone=!0}for(let o=0,i=e.length;o<i;o++){const a=e[o];a.mesh!==void 0&&(this._addNodeRef(this.meshCache,a.mesh),a.skin!==void 0&&(r[a.mesh].isSkinnedMesh=!0)),a.camera!==void 0&&this._addNodeRef(this.cameraCache,a.camera)}}_addNodeRef(e,t){t!==void 0&&(e.refs[t]===void 0&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,r){if(e.refs[t]<=1)return r;const o=r.clone(),i=(a,s)=>{const l=this.associations.get(a);l!=null&&this.associations.set(s,l);for(const[c,u]of a.children.entries())i(u,s.children[c])};return i(r,o),o.name+="_instance_"+e.uses[t]++,o}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let r=0;r<t.length;r++){const o=e(t[r]);if(o)return o}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const r=[];for(let o=0;o<t.length;o++){const i=e(t[o]);i&&r.push(i)}return r}getDependency(e,t){const r=e+":"+t;let o=this.cache.get(r);if(!o){switch(e){case"scene":o=this.loadScene(t);break;case"node":o=this.loadNode(t);break;case"mesh":o=this._invokeOne((function(i){return i.loadMesh&&i.loadMesh(t)}));break;case"accessor":o=this.loadAccessor(t);break;case"bufferView":o=this._invokeOne((function(i){return i.loadBufferView&&i.loadBufferView(t)}));break;case"buffer":o=this.loadBuffer(t);break;case"material":o=this._invokeOne((function(i){return i.loadMaterial&&i.loadMaterial(t)}));break;case"texture":o=this._invokeOne((function(i){return i.loadTexture&&i.loadTexture(t)}));break;case"skin":o=this.loadSkin(t);break;case"animation":o=this.loadAnimation(t);break;case"camera":o=this.loadCamera(t);break;default:throw new Error("Unknown type: "+e)}this.cache.add(r,o)}return o}getDependencies(e){let t=this.cache.get(e);if(!t){const r=this,o=this.json[e+(e==="mesh"?"es":"s")]||[];t=Promise.all(o.map((function(i,a){return r.getDependency(e,a)}))),this.cache.add(e,t)}return t}loadBuffer(e){const t=this,r=this.json.buffers[e];if(r.type&&r.type!=="arraybuffer")throw new Error("v3d.GLTFLoader: "+r.type+" buffer type is not supported.");if(r.uri===void 0&&e===0)return Promise.resolve(this.extensions[Hn.KHR_BINARY_GLTF].body);const o=this.options;return new Promise((function(i){let a,s;o.loadBinXZ?(a=Ea.resolveURL(r.uri,o.path)+".xz",s=new Wh):(a=Ea.resolveURL(r.uri,o.path),s=t.fileLoader);const l=function(u){if(t.onProgress){const d=100*(.3+.7*u);t.onProgress(d)}};let c=l;s instanceof Si&&(c=function(u){const d=u.lengthComputable?u.loaded/u.total:1;l(d)}),s.load(a,i,c)}))}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then((function(r){const o=t.byteLength||0,i=t.byteOffset||0;return r.slice(i,i+o)}))}loadAccessor(e){const t=this.json,r=this.json.accessors[e];if(r.bufferView===void 0&&r.sparse===void 0){const i=N3[r.type],a=qh[r.componentType],s=r.normalized===!0,l=new a(r.count*i);return Promise.resolve(new Xe(l,i,s))}const o=[];return r.bufferView!==void 0?o.push(this.getDependency("bufferView",r.bufferView)):o.push(null),r.sparse!==void 0&&(o.push(this.getDependency("bufferView",r.sparse.indices.bufferView)),o.push(this.getDependency("bufferView",r.sparse.values.bufferView))),Promise.all(o).then((function(i){const a=i[0],s=N3[r.type],l=qh[r.componentType],c=l.BYTES_PER_ELEMENT*s,u=r.byteOffset||0,d=r.bufferView!==void 0?t.bufferViews[r.bufferView].byteStride:void 0,f=r.normalized===!0;let h,p;if(d&&d!==c&&console.error("v3d.GLTFLoader: Interleaved attributes are not supported"),h=a===null?new l(r.count*s):new l(a,u,r.count*s),p=new Xe(h,s,f),r.sparse!==void 0){const m=N3.SCALAR,g=qh[r.sparse.indices.componentType],_=r.sparse.indices.byteOffset||0,A=r.sparse.values.byteOffset||0,y=new g(i[1],_,r.sparse.count*m),b=new l(i[2],A,r.sparse.count*s);a!==null&&(p=new Xe(p.array.slice(),p.itemSize,p.normalized));for(let E=0,x=y.length;E<x;E++){const w=y[E];if(p.setX(w,b[E*s]),s>=2&&p.setY(w,b[E*s+1]),s>=3&&p.setZ(w,b[E*s+2]),s>=4&&p.setW(w,b[E*s+3]),s>=5)throw new Error("v3d.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return p}))}loadTexture(e){const t=this.json,r=this.options,o=t.textures[e].source,i=t.images[o];let a=this.textureLoader;if(i.uri){const s=r.manager.getHandler(i.uri);s!==null&&(a=s)}return this.loadTextureImage(e,o,a)}loadTextureImage(e,t,r){const o=this,i=this.json,a=i.textures[e],s=i.images[t],l=(s.uri||s.bufferView)+":"+a.sampler;if(this.textureCache[l])return this.textureCache[l];const c=this.loadImageSource(t,r).then((function(u){u.flipY=!1,u.name=a.name||s.name||"";const d=(i.samplers||{})[a.sampler]||{};return u.magFilter=LB[d.magFilter]||1006,u.minFilter=LB[d.minFilter]||1008,u.wrapS=T1[d.wrapS]||1e3,u.wrapT=T1[d.wrapT]||1e3,o._invokeAll((function(f){return f.extendTextureParams&&f.extendTextureParams(u,a,r)})),o.associations.set(u,{textures:e}),u})).catch((function(){return null}));return this.textureCache[l]=c,c}loadImageSource(e,t){const r=this,o=this.json,i=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then((d=>d.clone()));const a=o.images[e],s=self.URL||self.webkitURL;let l=a.uri||"",c=!1;if(a.bufferView!==void 0)l=r.getDependency("bufferView",a.bufferView).then((function(d){c=!0;const f=new Blob([d],{type:a.mimeType});return l=s.createObjectURL(f),l}));else if(a.uri===void 0)throw new Error("v3d.GLTFLoader: Image "+e+" is missing URI and bufferView");const u=Promise.resolve(l).then((function(d){return new Promise((function(f,h){let p=f;t.isImageBitmapLoader===!0&&(p=function(m){const g=new $n(m);g.needsUpdate=!0,f(g)}),t.load(Ea.resolveURL(d,i.path),p,void 0,h)}))})).then((function(d){return d instanceof ArrayBuffer?r.plugins[Hn.S8S_V3D_TEXTURE].textureLoaderRGBE.loadAsync(s.createObjectURL(new Blob([d],{type:"image/vnd.radiance"}))):Promise.resolve(d)})).then((function(d){return c===!0&&s.revokeObjectURL(l),d.userData.mimeType=a.mimeType||f2e(a.uri),d})).catch((function(d){return console.error("v3d.GLTFLoader: Couldn't load texture",l),new $n}));return this.sourceCache[e]=u,u}assignTexture(e,t,r,o){return this.getDependency("texture",r.index).then((function(i){return i?(r.texCoord===void 0||r.texCoord==0||t==="aoMap"&&r.texCoord==1||console.warn("v3d.GLTFLoader: Custom UV set "+r.texCoord+" for texture "+t+" not yet supported."),o!==void 0&&(i.encoding=o),e[t]=i,i):null}))}assignFinalMaterial(e,t,r){const o=e.geometry;let i=e.material;const a=o.attributes.tangent===void 0,s=o.attributes.color!==void 0&&!i.isMeshNodeMaterial,l=o.attributes.normal===void 0,c=i.isMeshNodeMaterial&&(i.nodeValue.length||i.nodeRGB.length),u=i.isMeshNodeMaterial&&i.hasNode("TEX_COORD_BL"),d=i.isMeshNodeMaterial&&Object.getOwnPropertyNames(t).length>0&&i.hasNode("UVMAP_BL"),f=i.isMeshNodeMaterial&&Object.getOwnPropertyNames(r).length>0&&(i.hasNode("ATTRIBUTE_BL")||i.hasNode("VERTEX_COLOR_BL"));if(e.isPoints){const h="PointsMaterial:"+i.uuid;let p=this.cache.get(h);p||(p=new $2,Nr.prototype.copy.call(p,i),p.color.copy(i.color),p.map=i.map,p.sizeAttenuation=!1,this.cache.add(h,p)),i=p}else if(e.isLine){const h="LineBasicMaterial:"+i.uuid;let p=this.cache.get(h);p||(p=new _r,Nr.prototype.copy.call(p,i),p.color.copy(i.color),this.cache.add(h,p)),i=p}if(a||s||l||c||u||d||f){let h="ClonedMaterial:"+i.uuid+":";a&&(h+="derivative-tangents:"),s&&(h+="vertex-colors:"),l&&(h+="flat-shading:");const p=ji();c&&(h=p),u&&(h=p),d&&(h=p),f&&(h=p);let m=this.cache.get(h);m||(m=i.clone(),s&&(m.vertexColors=!0),l&&(m.flatShading=!0),a&&(m.normalScale&&(m.normalScale.y*=-1),m.clearcoatNormalScale&&(m.clearcoatNormalScale.y*=-1)),m.isMeshNodeMaterial&&(Object.assign(m.nodeUVAliases,t),Object.assign(m.nodeVCAliases,r),m.updateNodeGraph()),this.cache.add(h,m),this.associations.set(m,this.associations.get(i))),i=m}i.aoMap&&o.attributes.uv2===void 0&&o.attributes.uv!==void 0&&o.setAttribute("uv2",o.attributes.uv),e.material=i,this.assignedMaterials.includes(i)||this.assignedMaterials.push(i)}getMaterialType(){return Xu}loadMaterial(e){const t=this,r=this.json,o=this.extensions,i=r.materials[e];let a;const s={},l=i.extensions||{},c=[];if(i.doubleSided===!0&&(s.side=2),l[Hn.KHR_MATERIALS_UNLIT]){const d=o[Hn.KHR_MATERIALS_UNLIT];a=d.getMaterialType(),c.push(d.extendParams(s,i,t))}else{const d=i.pbrMetallicRoughness||{};if(s.color=new Ge(1,1,1),s.opacity=1,Array.isArray(d.baseColorFactor)){const f=d.baseColorFactor;s.color.fromArray(f),s.opacity=f[3]}d.baseColorTexture!==void 0&&c.push(t.assignTexture(s,"map",d.baseColorTexture,3001)),s.metalness=d.metallicFactor!==void 0?d.metallicFactor:1,s.roughness=d.roughnessFactor!==void 0?d.roughnessFactor:1,d.metallicRoughnessTexture!==void 0&&(c.push(t.assignTexture(s,"metalnessMap",d.metallicRoughnessTexture)),c.push(t.assignTexture(s,"roughnessMap",d.metallicRoughnessTexture))),a=this._invokeOne((function(f){return f.getMaterialType&&f.getMaterialType(e)})),c.push(Promise.all(this._invokeAll((function(f){return f.extendMaterialParams&&f.extendMaterialParams(e,s)}))))}const u=i.alphaMode||Kh.OPAQUE;if(u===Kh.BLEND?(s.transparent=!0,a!==ta&&(s.depthWrite=!1)):(s.transparent=!1,u===Kh.MASK&&(s.alphaTest=i.alphaCutoff!==void 0?i.alphaCutoff:.5)),i.normalTexture!==void 0&&a!==pr&&(c.push(t.assignTexture(s,"normalMap",i.normalTexture)),s.normalScale=new be(1,1),i.normalTexture.scale!==void 0)){const d=i.normalTexture.scale;s.normalScale.set(d,d)}return i.occlusionTexture!==void 0&&a!==pr&&(c.push(t.assignTexture(s,"aoMap",i.occlusionTexture)),i.occlusionTexture.strength!==void 0&&(s.aoMapIntensity=i.occlusionTexture.strength)),i.emissiveFactor!==void 0&&a!==pr&&(s.emissive=new Ge().fromArray(i.emissiveFactor)),i.emissiveTexture!==void 0&&a!==pr&&c.push(t.assignTexture(s,"emissiveMap",i.emissiveTexture,3001)),Promise.all(c).then((function(){const d=new a(s);i.name&&(d.name=i.name),d.map&&(d.map.encoding=3001),d.emissiveMap&&(d.emissiveMap.encoding=3001);const f=t.plugins[Hn.S8S_V3D_MATERIALS];return d.isMeshNodeMaterial&&f.assignTransparency(d,i,u),d.isMeshStandardMaterial&&d.normalScale&&f&&_e(f.profile)&&f.profile=="max"&&(d.normalScale.y=-d.normalScale.y),yc(d,i),t.associations.set(d,{materials:e}),i.extensions&&Zh(o,d,i),d}))}createUniqueName(e){const t=e;let r=t;for(let o=1;this.nodeNamesUsed[r];++o)r=t+"_"+o;return this.nodeNamesUsed[r]=!0,r}loadGeometries(e){const t=this;this.extensions;const r=this.primitiveCache,o=[];for(let i=0,a=e.length;i<a;i++){const s=e[i],l=u2e(s),c=r[l];if(c)o.push(c.promise);else{let u=m2e(new At,s,t);r[l]={primitive:s,promise:u},o.push(u)}}return Promise.all(o)}loadMesh(e){const t=this,r=this.json,o=this.extensions,i=r.meshes[e],a=i.primitives,s=[],l=_e(i.extensions)?i.extensions[Hn.S8S_V3D_MESH]:void 0;for(let c=0,u=a.length;c<u;c++){const d=a[c].material===void 0?BB(this.cache):this.getDependency("material",a[c].material);s.push(d)}return s.push(t.loadGeometries(a)),Promise.all(s).then((function(c){const u=c.slice(0,c.length-1),d=c[c.length-1],f=[];for(let p=0,m=d.length;p<m;p++){const g=d[p],_=a[p];let A;const y=u[p];if(_.mode===Cs.TRIANGLES||_.mode===Cs.TRIANGLE_STRIP||_.mode===Cs.TRIANGLE_FAN||_.mode===void 0)A=i.isSkinnedMesh===!0?new x0(g,y):new Mt(g,y),A.isSkinnedMesh!==!0||A.geometry.attributes.skinWeight.normalized||A.normalizeSkinWeights(),_.mode===Cs.TRIANGLE_STRIP?A.geometry=OB(A.geometry,1):_.mode===Cs.TRIANGLE_FAN&&(A.geometry=OB(A.geometry,2));else if(_.mode===Cs.LINES)if(l){const x=new ID;x.fromBufferGeometry(g);const w=new sb({color:_e(l.lineColor)?new Ge().fromArray(l.lineColor):new Ge(1,1,1),lineWidth:_e(l.lineWidth)?l.lineWidth:1,sizeAttenuation:0});A=new Mt(x.geometry,w),A.userData.originalLineGeom=g}else A=new ai(g,y);else if(_.mode===Cs.LINE_STRIP)A=new Ki(g,y);else if(_.mode===Cs.LINE_LOOP)A=new eP(g,y);else{if(_.mode!==Cs.POINTS)throw new Error("v3d.GLTFLoader: Primitive mode unsupported: "+_.mode);A=new nP(g,y)}Object.keys(A.geometry.morphAttributes).length>0&&c2e(A,i),A.name=t.createUniqueName(i.name||"mesh_"+e),yc(A,i),_.extensions&&Zh(o,A,_);const b={},E={};if(A.material.isMeshNodeMaterial&&l){if(l.uvLayers)for(let x in l.uvLayers)b[x]=kB(l.uvLayers[x]);if(l.colorLayers)for(let x in l.colorLayers)E[x]=FB(l.colorLayers[x])}t.assignFinalMaterial(A,b,E),f.push(A)}for(let p=0,m=f.length;p<m;p++)t.associations.set(f[p],{meshes:e,primitives:p});if(f.length===1)return f[0];const h=new qi;t.associations.set(h,{meshes:e});for(let p=0,m=f.length;p<m;p++)f[p].name=t.createUniqueName(i.name+"MatMesh"+p),f[p].isMaterialGeneratedMesh=!0,h.add(f[p]);return h}))}loadCamera(e){let t;const r=this.json.cameras[e],o=r[r.type];if(o)return r.type==="perspective"?t=new gr(Fg(o.yfov),o.aspectRatio||1,o.znear||1,o.zfar||2e6):r.type==="orthographic"&&(t=new ya(-o.xmag,o.xmag,o.ymag,-o.ymag,o.znear,o.zfar)),r.name&&(t.name=r.name),yc(t,r),this._invokeOne((function(i){return i.extendCameraParams&&i.extendCameraParams(t,r)}));console.warn("v3d.GLTFLoader: Missing camera parameters.")}loadSkin(e){const t=this.json.skins[e],r=[];for(let o=0,i=t.joints.length;o<i;o++)r.push(this.getDependency("node",t.joints[o]));return t.inverseBindMatrices!==void 0?r.push(this.getDependency("accessor",t.inverseBindMatrices)):r.push(null),Promise.all(r).then((function(o){const i=o.pop(),a=o,s=[],l=[];for(let c=0,u=a.length;c<u;c++){const d=a[c];if(d){s.push(d);const f=new Ue;i!==null&&f.fromArray(i.array,16*c),l.push(f)}else console.warn('v3d.GLTFLoader: Joint "%s" could not be found.',t.joints[c])}return new E0(s,l)}))}loadAnimation(e){const t=this.json.animations[e],r=[],o=[],i=[],a=[],s=[];for(let l=0,c=t.channels.length;l<c;l++){const u=t.channels[l],d=t.samplers[u.sampler],f=u.target,h=f.node,p=t.parameters!==void 0?t.parameters[d.input]:d.input,m=t.parameters!==void 0?t.parameters[d.output]:d.output;r.push(this.getDependency("node",h)),o.push(this.getDependency("accessor",p)),i.push(this.getDependency("accessor",m)),a.push(d),s.push(f)}return Promise.all([Promise.all(r),Promise.all(o),Promise.all(i),Promise.all(a),Promise.all(s),this.getDependencies("material")]).then((function(l){const c=l[0],u=l[1],d=l[2],f=l[3],h=l[4],p=[];for(let A=0,y=c.length;A<y;A++){const b=c[A],E=u[A],x=d[A],w=f[A],L=h[A];if(b===void 0)continue;let C;b.updateMatrix();let P="";switch(Ss[L.path]){case Ss.weights:C=hc;break;case Ss.rotation:C=fc;break;case Ss.translation:case Ss.scale:C=Nh;break;case Ss.intensity:C=hc;break;default:if(L.path.indexOf("constraint")>-1)C=hc,P="constraints["+L.path.match(/".*"/g)[0]+"]."+L.path.match(/[^\\.]*$/g)[0];else{let se;C=Nh,L.path.indexOf("nodeValue")>-1?(se=L.path.match(/".*"/g)[0],P="material.nodeValue["+se+"]"):L.path.indexOf("nodeRGB")>-1&&(se=L.path.match(/".*"/g)[0],P="material.nodeRGB["+se+"]")}}const D=b.name?b.name:b.uuid,Q=w.interpolation!==void 0?s2e[w.interpolation]:2301,re=[];if(Ss[L.path]===Ss.weights)b.traverse((function(se){se.morphTargetInfluences&&re.push(se.name?se.name:se.uuid)}));else if(L.path.indexOf("material")>-1){const se=l[5];b.traverse((function(ee){if(!ee.isMesh||!ee.material.isMeshNodeMaterial)return;let ie=!1;if(L.extras){ie=se[L.extras.material].name===ee.material.name;const H=L.path.match(/\["(.*)"\]/);ie=ie&&H!==null&&ee.material.findNodeByName(H[1])!==null}else ie=!0;ie&&re.push(ee.name?ee.name:ee.uuid)}))}else re.push(D);let G=x.array;if(x.normalized){const se=O3(G.constructor),ee=new Float32Array(G.length);for(let ie=0,H=G.length;ie<H;ie++)ee[ie]=G[ie]*se;G=ee}for(let se=0,ee=re.length;se<ee;se++){const ie=new C(re[se]+"."+(P!==""?P:Ss[L.path]),E.array,G,Q);w.interpolation==="CUBICSPLINE"&&(ie.createInterpolant=function(H){return new(this instanceof fc?i2e:RB)(this.times,this.values,this.getValueSize()/3,H)},ie.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),p.push(ie)}}const m=t.name?t.name:"animation_"+e,g={clip:new j0(m,void 0,p),nodeId:c[0].id,auto:!0,loop:2201,repetitions:1/0,startAt:0},_=_e(t.extensions)?t.extensions[Hn.S8S_V3D_ANIMATION]:void 0;if(_){g.auto=_.auto;const A=_.repeatInfinite?1/0:_.repeatCount;switch(_.loop){case"ONCE":g.loop=2200;break;case"REPEAT":g.loop=2201,g.repetitions=A;break;case"PING_PONG":g.loop=2202,g.repetitions=A}g.startAt=_.offset}return g}))}createNodeMesh(e){const t=this.json,r=this,o=t.nodes[e];return o.mesh===void 0?null:r.getDependency("mesh",o.mesh).then((function(i){const a=r._getNodeRef(r.meshCache,o.mesh,i);return o.weights!==void 0&&a.traverse((function(s){if(s.isMesh)for(let l=0,c=o.weights.length;l<c;l++)s.morphTargetInfluences[l]=o.weights[l]})),a}))}loadNode(e){const t=this.json,r=this.extensions,o=this,i=t.nodes[e],a=i.name?o.createUniqueName(i.name):"";return(function(){const s=[],l=o._invokeOne((function(c){return c.createNodeMesh&&c.createNodeMesh(e)}));return l&&s.push(l),i.camera!==void 0&&s.push(o.getDependency("camera",i.camera).then((function(c){return o._getNodeRef(o.cameraCache,i.camera,c)}))),o._invokeAll((function(c){return c.createNodeAttachment&&c.createNodeAttachment(e)})).forEach((function(c){s.push(c)})),Promise.all(s)})().then((function(s){let l;if(l=i.isBone===!0?new jL:s.length>1?new qi:s.length===1?s[0]:new kt,l!==s[0])for(let c=0,u=s.length;c<u;c++)l.add(s[c]);if(i.name&&(l.userData.name=i.name,l.name=a),yc(l,i),i.extensions&&Zh(r,l,i),i.matrix!==void 0){const c=new Ue;c.fromArray(i.matrix),l.applyMatrix4(c)}else i.translation!==void 0&&l.position.fromArray(i.translation),i.rotation!==void 0&&l.quaternion.fromArray(i.rotation),i.scale!==void 0&&l.scale.fromArray(i.scale);return o.associations.has(l)||o.associations.set(l,{}),o.associations.get(l).nodes=e,l})).then((function(s){return s.resolveMultiMaterial().forEach((l=>{o._invokeOne((function(c){if(l!==s)return c.extendNodeParams&&c.extendNodeParams(l,i)}))})),o._invokeOne((function(l){return l.extendNodeParams&&l.extendNodeParams(s,i)}))}))}loadScene(e){const t=this.json,r=this.extensions,o=this.json.scenes[e],i=this,a=new jr;o.name&&(a.name=i.createUniqueName(o.name)),yc(a,o),o.extensions&&Zh(r,a,o);const s=o.nodes||[],l=[];for(let c=0,u=s.length;c<u;c++)l.push(NB(s[c],a,t,i));return Promise.all(l).then((function(){return i.associations=(c=>{const u=new Map;for(const[d,f]of i.associations)(d instanceof Nr||d instanceof $n)&&u.set(d,f);return c.traverse((d=>{const f=i.associations.get(d);f!=null&&u.set(d,f)})),u})(a),a}))}}function NB(n,e,t,r){const o=t.nodes[n];return r.getDependency("node",n).then((function(i){return o.skin===void 0?i:r.getDependency("skin",o.skin).then((function(a){return i.traverse((function(s){s.isSkinnedMesh&&s.bind(a,s.matrixWorld)})),i}))})).then((function(i){e.add(i),(i.isDirectionalLight||i.isSpotLight)&&i.isFreeLight&&e.add(i.target);const a=[];if(o.children){const s=o.children;for(let l=0,c=s.length;l<c;l++){const u=s[l];a.push(NB(u,i,t,r))}}return Promise.all(a)}))}function p2e(n,e,t){const r=e.attributes,o=new Tn;if(r.POSITION===void 0)return;{const s=t.json.accessors[r.POSITION],l=s.min,c=s.max;if(l===void 0||c===void 0)return void console.warn("v3d.GLTFLoader: Missing min/max properties for accessor POSITION.");if(o.set(new N(l[0],l[1],l[2]),new N(c[0],c[1],c[2])),s.normalized){const u=O3(qh[s.componentType]);o.min.multiplyScalar(u),o.max.multiplyScalar(u)}}const i=e.targets;if(i!==void 0){const s=new N,l=new N;for(let c=0,u=i.length;c<u;c++){const d=i[c];if(d.POSITION!==void 0){const f=t.json.accessors[d.POSITION],h=f.min,p=f.max;if(h!==void 0&&p!==void 0){if(l.setX(Math.max(Math.abs(h[0]),Math.abs(p[0]))),l.setY(Math.max(Math.abs(h[1]),Math.abs(p[1]))),l.setZ(Math.max(Math.abs(h[2]),Math.abs(p[2]))),f.normalized){const m=O3(qh[f.componentType]);l.multiplyScalar(m)}s.max(l)}else console.warn("v3d.GLTFLoader: Missing min/max properties for accessor POSITION.")}}o.expandByVector(s)}n.boundingBox=o;const a=new ni;o.getCenter(a.center),a.radius=o.min.distanceTo(o.max)/2,n.boundingSphere=a}function m2e(n,e,t){const r=e.attributes,o=[];function i(a,s){return t.getDependency("accessor",a).then((function(l){n.setAttribute(s,l)}))}for(const a in r){const s=a2e[a]||g2e(a)||a.toLowerCase();s in n.attributes||o.push(i(r[a],s))}if(e.indices!==void 0&&!n.index){const a=t.getDependency("accessor",e.indices).then((function(s){n.setIndex(s)}));o.push(a)}return yc(n,e),p2e(n,e,t),Promise.all(o).then((function(){return e.targets!==void 0?l2e(n,e.targets,t):n}))}function OB(n,e){let t=n.getIndex();if(t===null){const a=[],s=n.getAttribute("position");if(s===void 0)return console.error("v3d.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),n;for(let l=0;l<s.count;l++)a.push(l);n.setIndex(a),t=n.getIndex()}const r=t.count-2,o=[];if(e===2)for(let a=1;a<=r;a++)o.push(t.getX(0)),o.push(t.getX(a)),o.push(t.getX(a+1));else for(let a=0;a<r;a++)a%2==0?(o.push(t.getX(a)),o.push(t.getX(a+1)),o.push(t.getX(a+2))):(o.push(t.getX(a+2)),o.push(t.getX(a+1)),o.push(t.getX(a)));o.length/3!==r&&console.error("v3d.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const i=n.clone();return i.setIndex(o),i}function g2e(n){return n.indexOf("TEXCOORD_")>-1?kB(n):n.indexOf("COLOR_")>-1?FB(n):""}function kB(n){return n=="TEXCOORD_0"?"uv":"uv"+String(Number(n.split("TEXCOORD_")[1])+1)}function FB(n){return n=="COLOR_0"?"color":"color"+String(Number(n.split("COLOR_")[1])+1)}function VB(n){n.blending=5,n.blendEquation=100,n.blendSrc=201,n.blendDst=205}const UB=new Ge;class zB extends ti{constructor(e,t,r=512,o=512){super(),this.scene=e,this.camera=t,this.width=r,this.height=o,this.distance=.1,this.factor=1,this.precision=1,this.bentNormals=!1,this.noiseTexture=this.createNoiseTexture(),this.fsQuad=new Xi(null);const i=new P2;i.type=1014,this.renderTargetNormalDepth=new nn(this.width,this.height,{format:1023,depthTexture:i,depthBuffer:!0}),this.renderTargetNormalDepth.texture.name="GTAO.normal",this.renderTargetNormalDepth.depthTexture.name="GTAO.depth",this.renderTargetGTAO=new nn(this.width,this.height),this.renderTargetGTAO.texture.name="GTAO.gtao",this.renderTargetBlurX=new nn(this.width,this.height),this.renderTargetBlurX.texture.name="GTAO.blur",this.renderTarget=new nn(this.width,this.height),this.renderTarget.texture.name="GTAO.rt",this.materialNormal=new EP({}),this.materialGTAO=new Dn({type:"GTAO",defines:{ORTHO_CAMERA:0,CALC_BENT_NORMALS:0},extensions:{derivatives:!0},uniforms:{tNormal:{value:null},tDepth:{value:null},tNoise:{value:null},occlDistance:{value:.1},factor:{value:1},occlPrecision:{value:1},mainCameraProjMat:{value:new Ue},resolution:{value:new be}},vertexShader:Qe.pp_plane_vert,fragmentShader:Qe.pp_gtao_frag}),this.materialBlur=new Dn({type:"GTAOBlur",defines:{},uniforms:{tDiffuse:{value:null},tNormal:{value:null},direction:{value:new be},resolution:{value:new be}},customPrepTokens:{BLUR_RADIUS_PX:2},vertexShader:Qe.pp_plane_vert,fragmentShader:Qe.pp_gtao_blur_frag}),this._layerMasks={}}setCamera(e){this.camera=e}setSize(e,t){this.width=e,this.height=t,this.renderTargetNormalDepth.setSize(e,t),this.renderTargetGTAO.setSize(e,t),this.renderTargetBlurX.setSize(e,t),this.renderTarget.setSize(e,t),this.materialGTAO.uniforms.mainCameraProjMat.value.copy(this.camera.projectionMatrix),this.materialGTAO.uniforms.resolution.value.set(this.renderTargetGTAO.width,this.renderTargetGTAO.height),this.materialBlur.uniforms.resolution.value.set(this.renderTargetGTAO.width,this.renderTargetGTAO.height)}dispose(){this.dispatchEvent({type:"dispose"}),this.renderTargetNormalDepth.dispose(),this.renderTargetGTAO.dispose(),this.renderTargetBlurX.dispose(),this.renderTarget.dispose(),this.materialNormal.dispose(),this.materialGTAO.dispose(),this.materialBlur.dispose(),this.noiseTexture.dispose()}_saveLayers(){this.scene.traverse((e=>this._layerMasks[e.id]=e.layers.mask))}_setupLayers(){this.scene.traverse((e=>{e.layers.disableAll();const t=e instanceof Mt&&e.material&&!e.material.gtaoVisible,r=e instanceof Mt&&e.material&&e.material.isMeshNodeMaterial&&(e.material.alphaTest>0||e.material.alphaToCoverage);t?e.layers.enable(0):r?e.layers.enable(1):e.layers.enable(2)}))}_restoreLayers(){this.scene.traverse((e=>e.layers.mask=this._layerMasks[e.id]))}_setupNodeAlphaClipHashMaterials(){this.scene.traverse((e=>{e instanceof Mt&&e.material&&e.material.isMeshNodeMaterial&&(e.material.defines.NORMAL_OUTPUT=Number(e.material.alphaTest>0||e.material.alphaToCoverage),e.material.needsUpdate=!0)}))}_restoreNodeAlphaClipHashMaterials(){this.scene.traverse((e=>{e instanceof Mt&&e.material&&e.material.isMeshNodeMaterial&&(e.material.defines.NORMAL_OUTPUT=0,e.material.needsUpdate=!0)}))}render(e){this._saveLayers(),this._setupLayers(),this.camera.layers.disableAll(),this.camera.layers.enable(1),this._setupNodeAlphaClipHashMaterials(),this._renderOverride(e,null,this.renderTargetNormalDepth,8355839,1,!0),this._restoreNodeAlphaClipHashMaterials(),this.camera.layers.disableAll(),this.camera.layers.enable(2),this._renderOverride(e,this.materialNormal,this.renderTargetNormalDepth,null,null,!0),this._restoreLayers(),this.materialGTAO.defines.ORTHO_CAMERA=this.camera.isOrthographicCamera?1:0,this.materialGTAO.defines.CALC_BENT_NORMALS=this.bentNormals?1:0,this.materialGTAO.needsUpdate=!0,this.materialGTAO.uniforms.tNormal.value=this.renderTargetNormalDepth.texture,this.materialGTAO.uniforms.tDepth.value=this.renderTargetNormalDepth.depthTexture,this.materialGTAO.uniforms.tNoise.value=this.noiseTexture,this.materialGTAO.uniforms.occlDistance.value=this.distance,this.materialGTAO.uniforms.factor.value=this.factor,this.materialGTAO.uniforms.occlPrecision.value=this.precision,this.materialGTAO.uniforms.mainCameraProjMat.value.copy(this.camera.projectionMatrix),this.materialGTAO.uniforms.resolution.value.set(this.renderTargetGTAO.width,this.renderTargetGTAO.height),this._renderPass(e,this.materialGTAO,this.renderTargetGTAO),this.materialBlur.uniforms.tDiffuse.value=this.renderTargetGTAO.texture,this.materialBlur.map=this.renderTargetGTAO.texture,this.materialBlur.uniforms.tNormal.value=this.renderTargetNormalDepth.texture,this.materialBlur.uniforms.direction.value.set(1,0),this.materialBlur.uniforms.resolution.value.set(this.renderTargetGTAO.width,this.renderTargetGTAO.height),this._renderPass(e,this.materialBlur,this.renderTargetBlurX),this.materialBlur.uniforms.tDiffuse.value=this.renderTargetBlurX.texture,this.materialBlur.map=this.renderTargetBlurX.texture,this.materialBlur.uniforms.direction.value.set(0,1),this.materialBlur.uniforms.resolution.value.set(this.renderTargetBlurX.width,this.renderTargetBlurX.height),this._renderPass(e,this.materialBlur,this.renderTarget)}_renderOverride(e,t,r,o,i,a){const s=e.getRenderTarget(),l=e.getClearColor(UB),c=e.getClearAlpha(),u=e.autoClear,d=this.scene.background;e.setRenderTarget(r),o!=null&&(e.setClearColor(o),e.setClearAlpha(i??0),e.clear()),e.autoClear=!1,a&&(this.scene.background=null),t&&(this.scene.overrideMaterial=t),e.render(this.scene,this.camera),this.scene.overrideMaterial=null,e.setRenderTarget(s),e.setClearColor(l),e.setClearAlpha(c),e.autoClear=u,this.scene.background=d}_renderPass(e,t,r,o,i){const a=e.getRenderTarget(),s=e.getClearColor(UB),l=e.getClearAlpha(),c=e.autoClear;e.setRenderTarget(r),o!=null&&(e.setClearColor(o),e.setClearAlpha(i??0),e.clear()),e.autoClear=!1,this.fsQuad.material=t,this.fsQuad.render(e),e.setRenderTarget(a),e.setClearColor(s),e.setClearAlpha(l),e.autoClear=c}createNoiseTexture(){const e=new Uint8Array([101,192,145,80,53,136,86,207,229,131,240,6,58,41,171,13,199,63,175,128,113,55,246,66,115,213,157,59,243,114,68,169,255,60,216,5,200,37,250,65,170,48,153,108,125,211,137,29,120,82,38,213,25,198,15,150,33,131,173,16,140,180,9,206,134,20,117,176,99,222,124,190,95,33,198,221,86,68,241,157,227,142,253,96,72,135,169,102,204,253,89,195,50,233,94,38,185,86,235,72,149,163,25,2,146,75,254,14,164,189,0,100,49,187,162,8,181,222,240,52,7,73,41,109,210,123,76,150,226,161,44,11,242,51,107,232,212,116,177,54,141,37,207,77,115,19,59,235,110,42,83,122,160,184,224,148,2,164,248,24,203,109,129,192,208,138,83,182,61,132,28,229,96,121,224,173,248,197,88,127,147,29,193,210,139,96,237,30,63,191,102,54,69,178,32,93,63,170,36,247,17,201,80,155,245,18,60,133,151,32,219,206,165,67,230,20,57,12,171,128,84,221,139,13,236,146,220,252,20,120,222,150,99,166,43,108,196,183,89,45,9,107,74,49,4,100,175,117,246,71,198,113,241,39,174,119,46,82,1,157,105,195,72,9,127,239,217,6,69,145,211,166,230,181,240,136,190,251,87,155,35,219,143,50,22,159,213,92,191,127,212,41,135,237,50,206,88,58,176,118,36,234,27,114,64,93,157,119,21,214,45,129,187,105,92,208,182,66,6,249,27,167,62,185,78,172,29,160,188,25,139,249,161,84,130,254,203,14,37,226,59,143,77,238,0,166,18,254,79,133,103,153,205,113,94,246,12,216,100,116,227,76,209,48,97,186,1,53,144,192,82,169,108,179,28,198,65,228,42,151,122,197,233,53,74,222,24,146,123,56,141,255,3,151,106,20,200,220,73,174,104,216,131,248,7,209,156,86,112,136,177,58,223,11,36,140,241,8,195,178,232,85,200,43,65,180,240,133,61,149,120,231,22,46,71,30,92,230,121,52,242,215,97,26,110,186,89,172,158,102,50,70,34,156,15,189,126,91,34,168,10,245,39,91,163,243,152,202,140,42,188,17,163,8,203,77,156,237,63,118,32,130,251,165,112,208,98,235,161,213,228,81,110,194,178,14,125,185,111,61,173,103,253,71,144,39,125,250,45,207,15,217,177,202,88,1,226,132,75,26,56,12,119,203,46,137,66,209,77,220,3,238,19,80,129,218,179,90,193,168,132,98,146,81,19,235,142,59,183,44,250,174,104,144,69,155,251,97,230,145,33,99,49,159,212,196,31,56,110,225,22,62,2,183,245,55,123,40,106,215,17,150,116,218,194,238,31,186,0,23,55,162,241,194,135,87,118,147,236,4,158,244,75,117,228,35,109,194,67,155,78,168,199,91,64,8,135,47,88,169,212,129,181,111,11,65,170,227,40,68,176,95,201,46,142,209,154,90,165,218,255,188,232,27,121,244,35,163,79,206,124,242,103,72,223,83,204,123,25,247,10,191,111,136,26,85,187,18,236,51,134,7,144,13,99,48,138,227,190,101,223,24,153,60,41,149,30,255,45,152,184,103,78,162,51,252,217,128,171,104,70,197,30,84,114,57,176,205,70,4,148,54,253,181,113,6,231,191,134,172,95,220,56,211,141,233,205,16,66,40,224,5,122,243,179,211,226,127,247,158,85,111,174,126,15,73,202,167,87,215,17,116,3,71,130,19,35,90,124,154,182,98,248,148,57,156,96,43,73,196,34,16,218,237,42,208,94,143,38,247,122,67,52,201,234,164,249,177,199,61,1,108,76,167,31,204,80,231,22,170,0,147,93,120,183,64,28,161,239,57,185,105,28,159,139,184,106,40,81,114,145,242,219,190,239,53,138,112,11,187,133,107,204,239,168,54,141,102,193,81,221,134,9,216,78,229,244,90,23,153,225,10,95,160,43,132,23,214,195,89,47,215,252,62,38,82,228,21,214,251,2,151,109,21,175,197,149,44,5,173,64,210,52,196,69,29,172,83,118,13,154,236,175,119,26,159,137,112,189,44,131,75,171,121,49,232,92,126,62,101,205,130,117,250,138,180,125,207,254,58,225,97,67,37,142,74,98,182,210,7,68,152,202,94,34,243,200,70,39,252,166,16,224,188,32,84,21,100,231,12,106,148,199,178,249,164,5,229,55,245,87,165,234,105,14,225,60,184,140,158,214,27,115,143,74,51,162,147,238,47,76,167,36,137,3,48,126,104,201,189,128,18,47,124,31,244,180,160,115,23,10,101,79,179,193,233,93,246,107,217,4,192,154,221,91,186,234,79,24,219,85,33,152,223]),t=new Uint8Array([7,87,145,233,57,15,124,219,7,163,132,35,222,160,41,99,10,23,228,253,53,207,65,214,94,146,248,134,214,15,97,230,201,181,41,105,189,206,171,100,146,78,188,106,177,87,141,232,198,122,70,178,149,26,124,174,16,55,115,35,70,179,158,111,74,241,122,159,29,90,47,242,23,229,213,16,245,72,26,183,58,136,205,43,86,239,139,226,77,188,203,86,224,144,50,30,135,62,11,218,255,68,156,185,59,121,91,49,199,152,219,109,243,162,14,221,113,192,3,100,42,152,233,168,22,123,251,210,153,191,99,173,139,114,2,133,201,32,169,135,64,118,1,47,89,31,102,76,154,35,63,164,255,127,9,62,106,187,4,91,44,222,17,80,39,209,237,82,107,251,148,11,231,174,208,130,194,171,234,184,248,121,216,199,110,28,212,137,240,77,164,232,25,128,247,150,57,193,20,160,44,211,75,191,96,37,81,254,147,66,8,140,54,21,177,89,74,51,175,93,39,199,55,115,84,202,104,179,230,124,97,222,64,177,27,111,239,158,17,57,105,219,42,209,95,132,231,13,144,244,194,157,226,18,143,180,66,166,48,5,74,32,169,142,7,241,128,52,216,137,185,228,26,124,84,166,189,71,38,158,221,115,1,65,123,102,250,216,34,242,140,113,212,188,249,85,118,197,156,89,5,70,116,167,202,153,240,114,4,246,203,100,46,185,84,31,209,173,6,130,196,22,225,91,155,61,16,49,103,229,36,206,173,249,46,92,12,73,33,223,142,60,172,126,22,234,135,246,151,75,52,97,161,79,182,12,235,132,207,150,184,20,78,143,101,28,196,235,134,178,53,195,24,108,82,215,150,55,168,110,43,189,233,144,207,59,125,44,168,108,34,220,69,166,244,58,225,125,149,63,213,104,253,93,155,184,11,250,73,96,201,8,218,88,14,117,223,105,247,193,71,88,254,122,3,132,191,113,10,181,40,83,0,162,127,41,210,235,122,36,195,18,228,65,131,176,253,38,19,165,0,146,27,203,178,54,96,234,43,159,90,218,245,112,191,229,18,79,66,137,51,160,180,141,118,164,30,101,154,71,137,94,217,56,238,134,17,153,200,80,29,204,67,23,155,52,172,33,145,198,175,7,223,103,87,244,41,79,236,204,51,186,81,199,176,112,77,224,40,110,170,223,144,251,174,131,98,205,73,121,247,97,238,116,29,204,62,2,213,183,145,24,125,241,228,45,31,129,160,92,188,246,62,6,102,50,116,15,240,140,10,218,59,45,151,83,167,255,130,157,107,55,92,219,110,5,61,147,252,8,212,51,12,140,75,126,183,215,83,194,43,226,88,165,109,187,21,215,68,39,192,20,239,198,12,68,174,159,99,121,192,70,231,177,119,209,237,19,154,33,232,163,65,180,29,200,129,4,231,135,182,98,147,76,118,165,136,248,40,211,14,85,169,107,25,151,100,36,164,197,92,58,136,2,123,106,148,252,75,210,162,53,120,9,233,217,46,28,226,83,128,195,245,224,38,141,205,61,249,86,48,227,114,255,186,207,77,236,16,56,39,102,85,30,247,203,60,87,179,103,186,56,152,22,180,131,53,236,81,15,190,134,175,8,72,147,24,99,48,215,192,172,139,240,196,149,108,168,17,127,157,252,1,206,114,74,161,98,3,186,156,120,221,27,108,211,129,40,170,242,158,131,91,115,225,20,178,71,45,222,142,197,36,66,145,93,234,34,198,67,217,109,243,45,67,161,237,54,195,224,85,112,6,32,69,155,9,64,123,212,3,94,242,76,113,214,25,170,49,220,119,148,28,170,90,10,200,143,80,95,153,18,64,202,175,220,250,42,208,96,163,254,133,185,21,52,230,190,126,244,138,13,86,254,58,138,211,125,179,251,34,2,183,248,126,143,54,187,78,136,235,193,50,32,82,117,173,161,98,9,82,63,105,187,19,205,37,230,76,21,104,60,167,119,214,106,37,227,13,101,120,167,25,109,146,227,201,60,238,38,148,206,181,42,163,236,176,128,107,154,184,50,225,208,133,232,49,73,165,90,239,152,204,0,89,182,72,11,156,101,217,14,130,252,111,227,5,72,95,47,196,0,245,94,149,13,84,27,150,193,19,181,68,30,48,243,61,221,127,246,24,138,190,69,88,57,26,141,210,151,220,249,67,117,166,35,194,112,176,202,95,237,139,208,111,129,216,190,142,37,171,197,81,47,119,229,159,200,171,79,120,33,133,169,23,213,80,138,238,69,44,253,63,117,4,56,250,172,78,157,93,116,6,104,162,241,31,182,1,103,46,243,189,59]),r=new Uint8Array(2048);for(let i=0;i<1024;i++)r[2*i]=e[i],r[2*i+1]=t[i];const o=new gs(r,32,32,1030,1009);return o.name="GTAO.noise",o.wrapS=1e3,o.wrapT=1e3,o.needsUpdate=!0,o}}class _2e{constructor(e=4){this.pool=e,this.queue=[],this.workers=[],this.workersResolve=[],this.workerStatus=0}_initWorker(e){if(!this.workers[e]){const t=this.workerCreator();t.addEventListener("message",this._onMessage.bind(this,e)),this.workers[e]=t}}_getIdleWorker(){for(let e=0;e<this.pool;e++)if(!(this.workerStatus&1<<e))return e;return-1}_onMessage(e,t){const r=this.workersResolve[e];if(r&&r(t),this.queue.length){const{resolve:o,msg:i,transfer:a}=this.queue.shift();this.workersResolve[e]=o,this.workers[e].postMessage(i,a)}else this.workerStatus^=1<<e}setWorkerCreator(e){this.workerCreator=e}setWorkerLimit(e){this.pool=e}postMessage(e,t){return new Promise((r=>{const o=this._getIdleWorker();o!==-1?(this._initWorker(o),this.workerStatus|=1<<o,this.workersResolve[o]=r,this.workers[o].postMessage(e,t)):this.queue.push({resolve:r,msg:e,transfer:t})}))}dispose(){this.workers.forEach((e=>e.terminate())),this.workersResolve.length=0,this.workers.length=0,this.queue.length=0,this.workerStatus=0}}const k3=new WeakMap;let F3=0;class Pa extends Ci{constructor(e){super(e),this.transcoderPath="",this.transcoderBinary=null,this.transcoderPending=null,this.workerPool=new _2e,this.workerSourceURL="",this.workerConfig=null,typeof MSC_TRANSCODER<"u"&&console.warn('v3d.KTX2Loader: Please update to latest "basis_transcoder". "msc_basis_transcoder" is no longer supported in three.js r125+.')}setTranscoderPath(e){return this.transcoderPath=e,this}setWorkerLimit(e){return this.workerPool.setWorkerLimit(e),this}detectSupport(e){return this.workerConfig={astcSupported:e.extensions.has("WEBGL_compressed_texture_astc"),etc1Supported:e.extensions.has("WEBGL_compressed_texture_etc1"),etc2Supported:e.extensions.has("WEBGL_compressed_texture_etc"),dxtSupported:e.extensions.has("WEBGL_compressed_texture_s3tc")&&e.extensions.has("WEBGL_compressed_texture_s3tc_srgb"),bptcSupported:e.extensions.has("EXT_texture_compression_bptc"),pvrtcSupported:e.extensions.has("WEBGL_compressed_texture_pvrtc")||e.extensions.has("WEBKIT_WEBGL_compressed_texture_pvrtc")},e.capabilities.isWebGL2&&(this.workerConfig.etc1Supported=!1),this}dispose(){return this.workerPool.dispose(),this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),this}init(){if(!this.transcoderPending){const e=new Si(this.manager);e.setPath(this.transcoderPath),e.setWithCredentials(this.withCredentials);const t=e.loadAsync("basis_transcoder.js"),r=new Si(this.manager);r.setPath(this.transcoderPath),r.setResponseType("arraybuffer"),r.setWithCredentials(this.withCredentials);const o=r.loadAsync("basis_transcoder.wasm");this.transcoderPending=Promise.all([t,o]).then((([i,a])=>{const s=Pa.BasisWorker.toString(),l=["/* constants */","let _EngineFormat = "+JSON.stringify(Pa.EngineFormat),"let _TranscoderFormat = "+JSON.stringify(Pa.TranscoderFormat),"let _BasisFormat = "+JSON.stringify(Pa.BasisFormat),"/* basis_transcoder.js */",i,"/* worker */",s.substring(s.indexOf("{")+1,s.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([l])),this.transcoderBinary=a,this.workerPool.setWorkerCreator((()=>{const c=new Worker(this.workerSourceURL),u=this.transcoderBinary.slice(0);return c.postMessage({type:"init",config:this.workerConfig,transcoderBinary:u},[u]),c}))})),F3>0&&console.warn("v3d.KTX2Loader: Multiple active KTX2 loaders may cause performance issues. Use a single KTX2Loader instance, or call .dispose() on old instances."),F3++}return this.transcoderPending}load(e,t,r,o){if(this.workerConfig===null)throw new Error("v3d.KTX2Loader: Missing initialization with `.detectSupport(renderer)`.");const i=new Si(this.manager);i.setResponseType("arraybuffer"),i.setWithCredentials(this.withCredentials);const a=new dl;return i.load(e,(s=>{if(k3.has(s))return k3.get(s).promise.then(t).catch(o);this._createTexture([s]).then((function(l){a.copy(l),a.needsUpdate=!0,t&&t(a)})).catch(o)}),r,o),a}_createTextureFrom(e){const{mipmaps:t,width:r,height:o,format:i,type:a,error:s,dfdTransferFn:l,dfdFlags:c}=e;if(a==="error")return Promise.reject(s);const u=new dl(t,r,o,i,1009);return u.minFilter=t.length===1?1006:1008,u.magFilter=1006,u.generateMipmaps=!1,u.needsUpdate=!0,u.encoding=l===2?3001:3e3,u.premultiplyAlpha=!!(1&c),u}_createTexture(e,t={}){const r=t,o=this.init().then((()=>this.workerPool.postMessage({type:"transcode",buffers:e,taskConfig:r},e))).then((i=>this._createTextureFrom(i.data)));return k3.set(e[0],{promise:o}),o}dispose(){return URL.revokeObjectURL(this.workerSourceURL),this.workerPool.dispose(),F3--,this}}Pa.BasisFormat={ETC1S:0,UASTC_4x4:1},Pa.TranscoderFormat={ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16},Pa.EngineFormat={RGBAFormat:1023,RGBA_ASTC_4x4_Format:37808,RGBA_BPTC_Format:36492,RGBA_ETC2_EAC_Format:37496,RGBA_PVRTC_4BPPV1_Format:35842,RGBA_S3TC_DXT5_Format:33779,RGB_ETC1_Format:36196,RGB_ETC2_Format:37492,RGB_PVRTC_4BPPV1_Format:35840,RGB_S3TC_DXT1_Format:33776},Pa.BasisWorker=function(){let n,e,t;const r=_EngineFormat,o=_TranscoderFormat,i=_BasisFormat;self.addEventListener("message",(function(u){const d=u.data;switch(d.type){case"init":n=d.config,f=d.transcoderBinary,e=new Promise((h=>{t={wasmBinary:f,onRuntimeInitialized:h},BASIS(t)})).then((()=>{t.initializeBasis(),t.KTX2File===void 0&&console.warn("v3d.KTX2Loader: Please update Basis Universal transcoder.")}));break;case"transcode":e.then((()=>{try{const{width:h,height:p,hasAlpha:m,mipmaps:g,format:_,dfdTransferFn:A,dfdFlags:y}=(function(E){const x=new t.KTX2File(new Uint8Array(E));function w(){x.close(),x.delete()}if(!x.isValid())throw w(),new Error("v3d.KTX2Loader:    Invalid or unsupported .ktx2 file");const L=x.isUASTC()?i.UASTC_4x4:i.ETC1S,C=x.getWidth(),P=x.getHeight(),D=x.getLevels(),Q=x.getHasAlpha(),re=x.getDFDTransferFunc(),G=x.getDFDFlags(),{transcoderFormat:se,engineFormat:ee}=(function(H,T,R,O){let W,ae;const ne=H===i.ETC1S?s:l;for(let oe=0;oe<ne.length;oe++){const F=ne[oe];if(n[F.if]&&F.basisFormat.includes(H)&&!(O&&F.transcoderFormat.length<2)&&(!F.needsPowerOfTwo||c(T)&&c(R)))return W=F.transcoderFormat[O?1:0],ae=F.engineFormat[O?1:0],{transcoderFormat:W,engineFormat:ae}}return console.warn("v3d.KTX2Loader: No suitable compressed texture format found. Decoding to RGBA32."),W=o.RGBA32,ae=r.RGBAFormat,{transcoderFormat:W,engineFormat:ae}})(L,C,P,Q);if(!C||!P||!D)throw w(),new Error("v3d.KTX2Loader:    Invalid texture");if(!x.startTranscoding())throw w(),new Error("v3d.KTX2Loader: .startTranscoding failed");const ie=[];for(let H=0;H<D;H++){const T=x.getImageLevelInfo(H,0,0),R=T.origWidth,O=T.origHeight,W=new Uint8Array(x.getImageTranscodedSizeInBytes(H,0,0,se));if(!x.transcodeImage(W,H,0,0,se,0,-1,-1))throw w(),new Error("v3d.KTX2Loader: .transcodeImage failed.");ie.push({data:W,width:R,height:O})}return w(),{width:C,height:P,hasAlpha:Q,mipmaps:ie,format:ee,dfdTransferFn:re,dfdFlags:G}})(d.buffers[0]),b=[];for(let E=0;E<g.length;++E)b.push(g[E].data.buffer);self.postMessage({type:"transcode",id:d.id,width:h,height:p,hasAlpha:m,mipmaps:g,format:_,dfdTransferFn:A,dfdFlags:y},b)}catch(h){console.error(h),self.postMessage({type:"error",id:d.id,error:h.message})}}))}var f}));const a=[{if:"astcSupported",basisFormat:[i.UASTC_4x4],transcoderFormat:[o.ASTC_4x4,o.ASTC_4x4],engineFormat:[r.RGBA_ASTC_4x4_Format,r.RGBA_ASTC_4x4_Format],priorityETC1S:1/0,priorityUASTC:1,needsPowerOfTwo:!1},{if:"bptcSupported",basisFormat:[i.ETC1S,i.UASTC_4x4],transcoderFormat:[o.BC7_M5,o.BC7_M5],engineFormat:[r.RGBA_BPTC_Format,r.RGBA_BPTC_Format],priorityETC1S:3,priorityUASTC:2,needsPowerOfTwo:!1},{if:"dxtSupported",basisFormat:[i.ETC1S,i.UASTC_4x4],transcoderFormat:[o.BC1,o.BC3],engineFormat:[r.RGB_S3TC_DXT1_Format,r.RGBA_S3TC_DXT5_Format],priorityETC1S:4,priorityUASTC:5,needsPowerOfTwo:!1},{if:"etc2Supported",basisFormat:[i.ETC1S,i.UASTC_4x4],transcoderFormat:[o.ETC1,o.ETC2],engineFormat:[r.RGB_ETC2_Format,r.RGBA_ETC2_EAC_Format],priorityETC1S:1,priorityUASTC:3,needsPowerOfTwo:!1},{if:"etc1Supported",basisFormat:[i.ETC1S,i.UASTC_4x4],transcoderFormat:[o.ETC1],engineFormat:[r.RGB_ETC1_Format],priorityETC1S:2,priorityUASTC:4,needsPowerOfTwo:!1},{if:"pvrtcSupported",basisFormat:[i.ETC1S,i.UASTC_4x4],transcoderFormat:[o.PVRTC1_4_RGB,o.PVRTC1_4_RGBA],engineFormat:[r.RGB_PVRTC_4BPPV1_Format,r.RGBA_PVRTC_4BPPV1_Format],priorityETC1S:5,priorityUASTC:6,needsPowerOfTwo:!0}],s=a.sort((function(u,d){return u.priorityETC1S-d.priorityETC1S})),l=a.sort((function(u,d){return u.priorityUASTC-d.priorityUASTC}));function c(u){return u<=2||!(u&u-1)&&u!==0}};class GB{static fromCubeTexture(e){let t=0;const r=new N,o=new N,i=new Ge,a=[0,0,0,0,0,0,0,0,0],s=new td,l=s.coefficients;for(let u=0;u<6;u++){const d=e.image[u],f=d.width,h=d.height,p=document.createElement("canvas");p.width=f,p.height=h;const m=p.getContext("2d");m.drawImage(d,0,0,f,h);const g=m.getImageData(0,0,f,h),_=g.data,A=g.width,y=2/A;for(let b=0,E=_.length;b<E;b+=4){i.setRGB(_[b]/255,_[b+1]/255,_[b+2]/255),HB(i,e.encoding);const x=b/4,w=(x%A+.5)*y-1,L=1-(Math.floor(x/A)+.5)*y;switch(u){case 0:r.set(-1,L,-w);break;case 1:r.set(1,L,w);break;case 2:r.set(-w,1,-L);break;case 3:r.set(-w,-1,L);break;case 4:r.set(-w,L,1);break;case 5:r.set(w,L,-1)}const C=r.lengthSq(),P=4/(Math.sqrt(C)*C);t+=P,o.copy(r).normalize(),td.getBasisAt(o,a);for(let D=0;D<9;D++)l[D].x+=a[D]*i.r*P,l[D].y+=a[D]*i.g*P,l[D].z+=a[D]*i.b*P}}const c=4*Math.PI/t;for(let u=0;u<9;u++)l[u].x*=c,l[u].y*=c,l[u].z*=c;return new Dh(s)}static fromCubeRenderTarget(e,t){let r=0;const o=new N,i=new N,a=new Ge,s=[0,0,0,0,0,0,0,0,0],l=new td,c=l.coefficients,u=t.texture.type;for(let f=0;f<6;f++){const h=t.width,p=new(u===1016?Uint16Array:u===1015?Float32Array:Uint8Array)(h*h*4);e.readRenderTargetPixels(t,0,0,h,h,p,f);const m=2/h;for(let g=0,_=p.length;g<_;g+=4){u===1016?a.setRGB(J0(p[g]),J0(p[g+1]),J0(p[g+2])):u===1015?a.setRGB(p[g],p[g+1],p[g+2]):a.setRGB(p[g]/255,p[g+1]/255,p[g+2]/255),HB(a,t.texture.encoding);const A=g/4,y=(A%h+.5)*m-1,b=1-(Math.floor(A/h)+.5)*m;switch(f){case 0:o.set(1,b,-y);break;case 1:o.set(-1,b,y);break;case 2:o.set(y,1,-b);break;case 3:o.set(y,-1,b);break;case 4:o.set(y,b,1);break;case 5:o.set(-y,b,-1)}const E=o.lengthSq(),x=4/(Math.sqrt(E)*E);r+=x,i.copy(o).normalize(),td.getBasisAt(i,s);for(let w=0;w<9;w++)c[w].x+=s[w]*a.r*x,c[w].y+=s[w]*a.g*x,c[w].z+=s[w]*a.b*x}}const d=4*Math.PI/r;for(let f=0;f<9;f++)c[f].x*=d,c[f].y*=d,c[f].z*=d;return new Dh(l)}}function HB(n,e){switch(e){case 3001:n.convertSRGBToLinear();break;case 3e3:break;default:console.warn("WARNING: LightProbeGenerator convertColorToLinear() encountered an unsupported encoding.")}return n}class v2e extends Ki{constructor(e,t){const r=new At;r.setAttribute("position",new mt([1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],3)),r.computeBoundingSphere(),super(r,new _r({fog:!1})),this.light=e,this.color=t,this.type="RectAreaLightHelper";const o=new At;o.setAttribute("position",new mt([1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],3)),o.computeBoundingSphere(),this.add(new Mt(o,new pr({side:1,fog:!1})))}updateMatrixWorld(){if(this.scale.set(.5*this.light.width,.5*this.light.height,1),this.color!==void 0)this.material.color.set(this.color),this.children[0].material.color.set(this.color);else{this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity);const e=this.material.color,t=Math.max(e.r,e.g,e.b);t>1&&e.multiplyScalar(1/t),this.children[0].material.color.copy(this.material.color)}this.matrixWorld.extractRotation(this.light.matrixWorld).scale(this.scale).copyPosition(this.light.matrixWorld),this.children[0].matrixWorld.copy(this.matrixWorld)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}var hd=function(){var n=0,e=document.createElement("div");function t(u){return e.appendChild(u.dom),u}function r(u){for(var d=0;d<e.children.length;d++)e.children[d].style.display=d===u?"block":"none";n=u}e.style.cssText="position:absolute;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",e.addEventListener("click",(function(u){u.preventDefault(),r(++n%e.children.length)}),!1);var o=(performance||Date).now(),i=o,a=0,s=t(new hd.Panel("FPS","#0ff","#002")),l=t(new hd.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var c=t(new hd.Panel("MB","#f08","#201"));return r(0),{REVISION:16,dom:e,addPanel:t,showPanel:r,begin:function(){o=(performance||Date).now()},end:function(){a++;var u=(performance||Date).now();if(l.update(u-o,200),u>=i+1e3&&(s.update(1e3*a/(u-i),100),i=u,a=0,c)){var d=performance.memory;c.update(d.usedJSHeapSize/1048576,d.jsHeapSizeLimit/1048576)}return u},update:function(){o=this.end()}}};hd.Panel=function(n,e,t){var r=1/0,o=0,i=Math.round,a=i(window.devicePixelRatio||1),s=80*a,l=48*a,c=3*a,u=2*a,d=3*a,f=15*a,h=74*a,p=30*a,m=document.createElement("canvas");m.width=s,m.height=l,m.style.cssText="width:80px;height:48px";var g=m.getContext("2d");return g.font="bold "+9*a+"px Helvetica,Arial,sans-serif",g.textBaseline="top",g.fillStyle=t,g.fillRect(0,0,s,l),g.fillStyle=e,g.fillText(n,c,u),g.fillRect(d,f,h,p),g.fillStyle=t,g.globalAlpha=.9,g.fillRect(d,f,h,p),{dom:m,update:function(_,A){r=Math.min(r,_),o=Math.max(o,_),g.fillStyle=t,g.globalAlpha=1,g.fillRect(0,0,s,f),g.fillStyle=e,g.fillText(i(_)+" "+n+" ("+i(r)+"-"+i(o)+")",c,u),g.drawImage(m,d+a,f,h-a,p,d,f,h-a,p),g.fillRect(d+h-a,f,a,p),g.fillStyle=t,g.globalAlpha=.9,g.fillRect(d+h-a,f,a,i((1-_/A)*p))}}};const Jh=new N,ep=new N;class A2e extends ai{constructor(e,t=1,r=16711680){var a;const o=new At;if((a=e.geometry)==null?void 0:a.attributes.normal){const s=e.geometry.attributes.normal.count,l=new mt(2*s*3,3);o.setAttribute("position",l)}super(o,new _r({color:r,toneMapped:!1})),this.object=e,this.size=t,this.type="VertexNormalsHelper",this.matrixAutoUpdate=!1,this.update()}update(){var o,i;const e=this.geometry.attributes.position,t=(o=this.object.geometry)==null?void 0:o.attributes.position,r=(i=this.object.geometry)==null?void 0:i.attributes.normal;if(e&&t&&r){let a=0;for(let s=0,l=t.count;s<l;s++)Jh.fromBufferAttribute(t,s),ep.fromBufferAttribute(r,s),ep.normalize().multiplyScalar(this.size).add(Jh),e.setXYZ(a,Jh.x,Jh.y,Jh.z),a+=1,e.setXYZ(a,ep.x,ep.y,ep.z),a+=1;e.needsUpdate=!0}}dispose(){this.geometry.dispose(),this.material.dispose()}}class y2e extends ai{constructor(e,t="white"){super(new bP(e.geometry),new _r({color:t})),this.type="WireframeHelper",this.matrixAutoUpdate=!1}dispose(){this.geometry.dispose(),this.material.dispose()}}const b2e="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAIQXpUWHRSYXcgcHJvZmlsZSB0eXBlIGV4aWYAAHja7ZhZltw2DEX/uYosQSQ4LofjOdlBlp8LSqquHt12nD+X3JIKYpEg3sMDZDP/+XuZv/iIOGd8SDmWGA8+vvjiKjf5OD91n+3h93l//PWI76/s5vHAYRKucn7N8bJP7I7x7rL3a56KPTxNVOb1oL1+UK+JXL4WuOz3QmLPBY5rYlOvicRdK18utnNbRyw5PW+hX+PX9XyHgT+jJy/JxRBt8py9O1KKhfvsDp+I21BHV3dFfxfaNdGb7+Ye6vDJTbFycM7qoeC+FKmi93rGaSzCvUjY53J6ClrOHIn7csf1689Xnpvb9QvyV5A+7uwn9iekzQ7o/UDeIBQf1w/tNrzYzTOkG7enlWN8rPzKnufRXu35Rk3/1hp5rXnurvrIluO1qXsr+45xTaO1fxU5En/hyBpsPQpHJiU6PBqQrHF0W6wDxmW9HbbaZee+dttx0bvpElfnuhPbDcYMGMX1DbfXwy6XAH5IBvgOHQSre/hi97JlL9dtZuFhs4E9lsksP/lPh/nOoLU0oaw98iNW+OU00/BCkbPWHJZhIGLXFdSwA3wfbz+Kq4Bg2GHObLAeTWcA/hbsC7lkAy0MDFzPBLZpXBMQIjwIOGMFBI5oJdhoj4SwJWsJZAagiutOvGvAYkNwAyedF4mAQxawNr9Jdg91wZ1mhBAggkQjCWxITcDyPsCf5DMcqkGCDyHEkEIOJdQoUTMsxhRVUWuS5FNIMaWUU0nVZMk+hxxzyjmXXIsrguKGQj6WXEqplUUrM1d+XRlQa3NNmm+hxZZabqXV7kyX7nvosaeee+l1uCGDPB5xpJFHGXXaCZWmn2HGmWaeZdYF1ZYsv8KKK628iln1gdoF67vjJ1CzF2puI6UD0wM1rCndU1iVk6CYgZjzFsCTImDFOKeYHdl67xQ5xewoTkXQ4WRQcIZVxEDQT+vCsg/sXpALRuLvwc0AhPsdyBmF7hvIvcftI9RG3YVONkKahhrUQ8i+VdbM1eWqlfLLq/nRgO9e/0z0Z6LfNtEKlJIcBGEJdi4Y3YtQv/vMn9hbb2uO2qngQp1HkExeIqtF6sbqOjSLnimwjeScNfUo89iTZO/b7GHNot9iXc1v+ypRmpg4x9DZbZ/owSyht5CoP3X52YZQTUprFa0ItmIdx22xPvAvogdcVPyXdoNjrZpJ4+lZTtdDaj62hxnWigOhXduzQx+mQvaPZrNbk99ZfVDsDIMlgtBQLro75kMVI3Xb63P8HRXr6s2O0hI7YuI8TZLWlq8z1NZmxkfWRLdoCMcQIVAj5kCbeFkOhcg11PO8o7M6r+Z4Y/iJq4KdFVJt3w261qI9nXagWtvw6cKp96g4ZMIw/NZERidb2NYSDUzpabXiF3EzpaKqdZNqZSuTXqnN0CtBntdNmZYJStprx7kgxZCka/XWsc9qwzRVdkRnFEWjy8mRQDknXhkExoYgj6QNm96PWsKsM8EoejmdKOblTRMIQOt3ucsgJUigEUldCH5vJRCMcd1I1wWdMmKMNfyqcepalKOCefgzY9iGzOJ/Jd3Mhw9aLbrhTCyntQ44IOYBgdocpAPBbbGP1siF1bRxHYNyFKjJcD0EaAQs0EU0zcCEBBDNiuQn3CFPANTv3epZWd+CRs2zU7Og7coEZKcArFQGA8BOU5faUL/I3J0OuVAw2xqHzAHbywZiudFiNEM9XIMa3edcw7USP5WUzT5RLsA6JZ9SD/K07JoZAFUiPmdQak0CPlGYa/MptVDJT20yYguxkIT0DXQKexSrkjpz8QhlimYmdYF13enoS7Lj9CkCxcXzCa7Esl8AQBq6rDabFASNxDfMWcgaRzTRgIFeBRmje5n4GAJmnGIHE2qUtOBqhOpzOhnrHtCJiJnTPoAA9FmVwgzCETw7yqmHPwbBfIbCOxC6jSogCHVjYzWhLEk1KTQonoYhUIEbIQd4p42Wliu5ngJtT8Le6LXS6CdV5xIA+p3l6GY+dKCrHMp8mK0bSBPGK/WJ/d4U1PdiM3WhDiU9dQCRH6o4sxerpKcUyJGASZrjLVvTQ/XiJ0sAAj9ayPYW+8IbpLzW/3KkLUIvEnQKEG6FLW3OF3aksFMFtoZp+I0+giNUtd4xUutm3LTnZxLXmFQ5el3WkFEIPtPMorRGG2sfslIJ8NIaqxnbBKp7ckpOgDThLLn1kBGbnmRkvcgIlH+WkbLIoOC1LCAksc5RuviYqfE0yZeFd/2vomk+DSfceh1PLZ5k35uI3vXUvC+oKlTrUVBJ56eSyhJ5flhTzS8U1Q+v5ptF9aXK7ZuWNaXDJshY1S4xofutu27qtutxVSPSrffPqhGj39Ujan+5K9IXxXq+FPp3UhsAdw3TwQG5G3aWmEBohrt4qthpkCbBz4ntlcQXXreum5R1sbAXHs2QldBo9LOroE+gIaj52mBwabjzC2+lX17NjwbodeuhtFsPof1Q0UMOyTI0EO45g2lqG8k2i809EsB4quEkUrK1cKgW8mZb+UkcIAdcUXKyI9scHR1MY6I3jzUIZ2ODum6EgoaiEIrp9/YJmYP0QbMBnHLaCW2meqzsfm6AyYtX7S+id3W/vKle3e/OPRojdI/oDyOdRFVlrAORRx/igFKtQDte/oV654VGuvIKzMM2eCFuVB4SbD3CppXcXFE7i8guPY8i0l5XcpVqGsNjp1bjzGyCNLRgySyT5TY9R2fu2joo2cRhR6bsdCYa8P8MEJnzEqJpHiH6KEA6wXcCRHzMrwRovzykVEY/b/U/r81981+vfyb6M9H/MBF5RKaafwEjmLcIrlR0mgAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAAuIwAALiMBeKU/dgAAAAd0SU1FB+MCAwojJyJFeN4AAAAZdEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIEdJTVBXgQ4XAAAAd0lEQVR42u3YUQqAIBAFwLUDdf9zdCH7lwwEI2VnPkWQfWCvigAAAAAAgDTK1wecNWq7dpX+uaP7lw7gaZi3oUb3z3BkvwICEIAW+KcFRte3DWBGO7gCAhCAAHZ9FY6IpC3QG963gGeAAASgBRb6IwQAAAAAQCY34QUtIL9dJTwAAAAASUVORK5CYII=",x2e=0,E2e=1,C2e=2,S2e=Math.pow(2,-24),V3=Symbol("SKIP_GENERATION");function w2e(n){return n.index?n.index.count:n.attributes.position.count}function pd(n){return w2e(n)/3}function M2e(n,e=ArrayBuffer){return n>65535?new Uint32Array(new e(4*n)):new Uint16Array(new e(2*n))}function T2e(n,e){if(!n.index){const t=n.attributes.position.count,r=M2e(t,e.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer);n.setIndex(new Xe(r,1));for(let o=0;o<t;o++)r[o]=o}}function WB(n,e){const t=pd(n),r=e||n.drawRange,o=r.start/3,i=(r.start+r.count)/3,a=Math.max(0,o),s=Math.min(t,i)-a;return[{offset:Math.floor(a),count:Math.floor(s)}]}function jB(n,e){if(!n.groups||!n.groups.length)return WB(n,e);const t=[],r=new Set,o=e||n.drawRange,i=o.start/3,a=(o.start+o.count)/3;for(const l of n.groups){const c=l.start/3,u=(l.start+l.count)/3;r.add(Math.max(i,c)),r.add(Math.min(a,u))}const s=Array.from(r.values()).sort(((l,c)=>l-c));for(let l=0;l<s.length-1;l++){const c=s[l],u=s[l+1];t.push({offset:Math.floor(c),count:Math.floor(u-c)})}return t}function I2e(n,e){const t=pd(n),r=jB(n,e).sort(((a,s)=>a.offset-s.offset)),o=r[r.length-1];o.count=Math.min(t-o.offset,o.count);let i=0;return r.forEach((({count:a})=>i+=a)),t!==i}function U3(n,e,t,r,o){let i=1/0,a=1/0,s=1/0,l=-1/0,c=-1/0,u=-1/0,d=1/0,f=1/0,h=1/0,p=-1/0,m=-1/0,g=-1/0;for(let _=6*e,A=6*(e+t);_<A;_+=6){const y=n[_+0],b=n[_+1],E=y-b,x=y+b;E<i&&(i=E),x>l&&(l=x),y<d&&(d=y),y>p&&(p=y);const w=n[_+2],L=n[_+3],C=w-L,P=w+L;C<a&&(a=C),P>c&&(c=P),w<f&&(f=w),w>m&&(m=w);const D=n[_+4],Q=n[_+5],re=D-Q,G=D+Q;re<s&&(s=re),G>u&&(u=G),D<h&&(h=D),D>g&&(g=D)}r[0]=i,r[1]=a,r[2]=s,r[3]=l,r[4]=c,r[5]=u,o[0]=d,o[1]=f,o[2]=h,o[3]=p,o[4]=m,o[5]=g}function R2e(n,e=null,t=null,r=null){const o=n.attributes.position,i=n.index?n.index.array:null,a=pd(n),s=o.normalized;let l;e===null?(l=new Float32Array(6*a),t=0,r=a):(l=e,t=t||0,r=r||a);const c=o.array,u=o.offset||0,d=["getX","getY","getZ"];for(let f=t;f<t+r;f++){const h=3*f,p=6*f;let m=h+0,g=h+1,_=h+2;i&&(m=i[m],g=i[g],_=i[_]),s||(m=3*m+u,g=3*g+u,_=3*_+u);for(let A=0;A<3;A++){let y,b,E;s?(y=o[d[A]](m),b=o[d[A]](g),E=o[d[A]](_)):(y=c[m+A],b=c[g+A],E=c[_+A]);let x=y;b<x&&(x=b),E<x&&(x=E);let w=y;b>w&&(w=b),E>w&&(w=E);const L=(w-x)/2,C=2*A;l[p+C+0]=x+L,l[p+C+1]=L+(Math.abs(x)+L)*S2e}}return l}function ir(n,e,t){return t.min.x=e[n],t.min.y=e[n+1],t.min.z=e[n+2],t.max.x=e[n+3],t.max.y=e[n+4],t.max.z=e[n+5],t}function QB(n){let e=-1,t=-1/0;for(let r=0;r<3;r++){const o=n[r+3]-n[r];o>t&&(t=o,e=r)}return e}function $B(n,e){e.set(n)}function YB(n,e,t){let r,o;for(let i=0;i<3;i++){const a=i+3;r=n[i],o=e[i],t[i]=r<o?r:o,r=n[a],o=e[a],t[a]=r>o?r:o}}function R1(n,e,t){for(let r=0;r<3;r++){const o=e[n+2*r],i=e[n+2*r+1],a=o-i,s=o+i;a<t[r]&&(t[r]=a),s>t[r+3]&&(t[r+3]=s)}}function tp(n){const e=n[3]-n[0],t=n[4]-n[1],r=n[5]-n[2];return 2*(e*t+t*r+r*e)}const L2e=(n,e)=>n.candidate-e.candidate,vl=new Array(32).fill().map((()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0}))),L1=new Float32Array(6);function P2e(n,e,t,r,o,i){let a=-1,s=0;if(i===0)a=QB(e),a!==-1&&(s=(e[a]+e[a+3])/2);else if(i===1)a=QB(n),a!==-1&&(s=D2e(t,r,o,a));else if(i===2){const l=tp(n);let c=1.25*o;const u=6*r,d=6*(r+o);for(let f=0;f<3;f++){const h=e[f],p=(e[f+3]-h)/32;if(o<8){const m=[...vl];m.length=o;let g=0;for(let A=u;A<d;A+=6,g++){const y=m[g];y.candidate=t[A+2*f],y.count=0;const{bounds:b,leftCacheBounds:E,rightCacheBounds:x}=y;for(let w=0;w<3;w++)x[w]=1/0,x[w+3]=-1/0,E[w]=1/0,E[w+3]=-1/0,b[w]=1/0,b[w+3]=-1/0;R1(A,t,b)}m.sort(L2e);let _=o;for(let A=0;A<_;A++){const y=m[A];for(;A+1<_&&m[A+1].candidate===y.candidate;)m.splice(A+1,1),_--}for(let A=u;A<d;A+=6){const y=t[A+2*f];for(let b=0;b<_;b++){const E=m[b];y>=E.candidate?R1(A,t,E.rightCacheBounds):(R1(A,t,E.leftCacheBounds),E.count++)}}for(let A=0;A<_;A++){const y=m[A],b=y.count,E=o-y.count,x=y.leftCacheBounds,w=y.rightCacheBounds;let L=0;b!==0&&(L=tp(x)/l);let C=0;E!==0&&(C=tp(w)/l);const P=1+1.25*(L*b+C*E);P<c&&(a=f,c=P,s=y.candidate)}}else{for(let _=0;_<32;_++){const A=vl[_];A.count=0,A.candidate=h+p+_*p;const y=A.bounds;for(let b=0;b<3;b++)y[b]=1/0,y[b+3]=-1/0}for(let _=u;_<d;_+=6){let A=~~((t[_+2*f]-h)/p);A>=32&&(A=31);const y=vl[A];y.count++,R1(_,t,y.bounds)}const m=vl[31];$B(m.bounds,m.rightCacheBounds);for(let _=30;_>=0;_--){const A=vl[_],y=vl[_+1];YB(A.bounds,y.rightCacheBounds,A.rightCacheBounds)}let g=0;for(let _=0;_<31;_++){const A=vl[_],y=A.count,b=A.bounds,E=vl[_+1].rightCacheBounds;y!==0&&(g===0?$B(b,L1):YB(b,L1,L1)),g+=y;let x=0,w=0;g!==0&&(x=tp(L1)/l);const L=o-g;L!==0&&(w=tp(E)/l);const C=1+1.25*(x*g+w*L);C<c&&(a=f,c=C,s=A.candidate)}}}}else console.warn(`MeshBVH: Invalid build strategy value ${i} used.`);return{axis:a,pos:s}}function D2e(n,e,t,r){let o=0;for(let i=e,a=e+t;i<a;i++)o+=n[6*i+2*r];return o/t}class z3{constructor(){this.boundingData=new Float32Array(6)}}function B2e(n,e,t,r,o,i){let a=r,s=r+o-1;const l=i.pos,c=2*i.axis;for(;;){for(;a<=s&&t[6*a+c]<l;)a++;for(;a<=s&&t[6*s+c]>=l;)s--;if(!(a<s))return a;for(let u=0;u<3;u++){let d=e[3*a+u];e[3*a+u]=e[3*s+u],e[3*s+u]=d}for(let u=0;u<6;u++){let d=t[6*a+u];t[6*a+u]=t[6*s+u],t[6*s+u]=d}a++,s--}}function N2e(n,e,t,r,o,i){let a=r,s=r+o-1;const l=i.pos,c=2*i.axis;for(;;){for(;a<=s&&t[6*a+c]<l;)a++;for(;a<=s&&t[6*s+c]>=l;)s--;if(!(a<s))return a;{let u=n[a];n[a]=n[s],n[s]=u;for(let d=0;d<6;d++){let f=t[6*a+d];t[6*a+d]=t[6*s+d],t[6*s+d]=f}a++,s--}}}function Wo(n,e){return e[n+15]===65535}function di(n,e){return e[n+6]}function Ti(n,e){return e[n+14]}function Ii(n){return n+8}function Ri(n,e){return e[n+6]}function XB(n,e){return e[n+7]}function XEe(n){return n}let qB,np,P1,KB;const O2e=Math.pow(2,32);function G3(n){return"count"in n?1:1+G3(n.left)+G3(n.right)}function k2e(n,e,t){return qB=new Float32Array(t),np=new Uint32Array(t),P1=new Uint16Array(t),KB=new Uint8Array(t),H3(n,e)}function H3(n,e){const t=n/4,r=n/2,o="count"in e,i=e.boundingData;for(let a=0;a<6;a++)qB[t+a]=i[a];if(o){if(e.buffer){const a=e.buffer;KB.set(new Uint8Array(a),n);for(let s=n,l=n+a.byteLength;s<l;s+=32)Wo(s/2,P1)||(np[s/4+6]+=t);return n+a.byteLength}{const a=e.offset,s=e.count;return np[t+6]=a,P1[r+14]=s,P1[r+15]=65535,n+32}}{const a=e.left,s=e.right,l=e.splitAxis;let c;if(c=H3(n+32,a),c/4>O2e)throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return np[t+6]=c/4,c=H3(c,s),np[t+7]=l,c}}function F2e(n,e){const t=(n.index?n.index.count:n.attributes.position.count)/3,r=t>65536,o=r?4:2,i=e?new SharedArrayBuffer(t*o):new ArrayBuffer(t*o),a=r?new Uint32Array(i):new Uint16Array(i);for(let s=0,l=a.length;s<l;s++)a[s]=s;return a}function V2e(n,e,t,r,o){const{maxDepth:i,verbose:a,maxLeafTris:s,strategy:l,onProgress:c,indirect:u}=o,d=n._indirectBuffer,f=n.geometry,h=f.index?f.index.array:null,p=u?N2e:B2e,m=pd(f),g=new Float32Array(6);let _=!1;const A=new z3;return U3(e,t,r,A.boundingData,g),(function b(E,x,w,L=null,C=0){if(!_&&C>=i&&(_=!0,a&&(console.warn(`MeshBVH: Max depth of ${i} reached when generating BVH. Consider increasing maxDepth.`),console.warn(f))),w<=s||C>=i)return y(x+w),E.offset=x,E.count=w,E;const P=P2e(E.boundingData,L,e,x,w,l);if(P.axis===-1)return y(x+w),E.offset=x,E.count=w,E;const D=p(d,h,e,x,w,P);if(D===x||D===x+w)y(x+w),E.offset=x,E.count=w;else{E.splitAxis=P.axis;const Q=new z3,re=x,G=D-x;E.left=Q,U3(e,re,G,Q.boundingData,g),b(Q,re,G,g,C+1);const se=new z3,ee=D,ie=w-G;E.right=se,U3(e,ee,ie,se.boundingData,g),b(se,ee,ie,g,C+1)}return E})(A,t,r,g),A;function y(b){c&&c(b/m)}}function U2e(n,e){const t=n.geometry;e.indirect&&(n._indirectBuffer=F2e(t,e.useSharedArrayBuffer),I2e(t,e.range)&&!e.verbose&&console.warn('MeshBVH: Provided geometry contains groups or a range that do not fully span the vertex contents while using the "indirect" option. BVH may incorrectly report intersections on unrendered portions of the geometry.')),n._indirectBuffer||T2e(t,e);const r=e.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer,o=R2e(t),i=e.indirect?WB(t,e.range):jB(t,e.range);n._roots=i.map((a=>{const s=V2e(n,o,a.offset,a.count,e),l=G3(s),c=new r(32*l);return k2e(0,s,c),c}))}class ws{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(e,t){let r=1/0,o=-1/0;for(let i=0,a=e.length;i<a;i++){const s=e[i][t];r=s<r?s:r,o=s>o?s:o}this.min=r,this.max=o}setFromPoints(e,t){let r=1/0,o=-1/0;for(let i=0,a=t.length;i<a;i++){const s=t[i],l=e.dot(s);r=l<r?l:r,o=l>o?l:o}this.min=r,this.max=o}isSeparated(e){return this.min>e.max||e.min>this.max}}ws.prototype.setFromBox=(function(){const n=new N;return function(e,t){const r=t.min,o=t.max;let i=1/0,a=-1/0;for(let s=0;s<=1;s++)for(let l=0;l<=1;l++)for(let c=0;c<=1;c++){n.x=r.x*s+o.x*(1-s),n.y=r.y*l+o.y*(1-l),n.z=r.z*c+o.z*(1-c);const u=e.dot(n);i=Math.min(u,i),a=Math.max(u,a)}this.min=i,this.max=a}})();const z2e=(function(){const n=new N,e=new N,t=new N;return function(r,o,i){const a=r.start,s=n,l=o.start,c=e;t.subVectors(a,l),n.subVectors(r.end,r.start),e.subVectors(o.end,o.start);const u=t.dot(c),d=c.dot(s),f=c.dot(c),h=t.dot(s),p=s.dot(s)*f-d*d;let m,g;m=p!==0?(u*d-h*f)/p:0,g=(u+m*d)/f,i.x=m,i.y=g}})(),W3=(function(){const n=new be,e=new N,t=new N;return function(r,o,i,a){z2e(r,o,n);let s=n.x,l=n.y;if(s>=0&&s<=1&&l>=0&&l<=1)return r.at(s,i),void o.at(l,a);if(s>=0&&s<=1)return l<0?o.at(0,a):o.at(1,a),void r.closestPointToPoint(a,!0,i);if(l>=0&&l<=1)return s<0?r.at(0,i):r.at(1,i),void o.closestPointToPoint(i,!0,a);{let c,u;c=s<0?r.start:r.end,u=l<0?o.start:o.end;const d=e,f=t;return r.closestPointToPoint(u,!0,e),o.closestPointToPoint(c,!0,t),d.distanceToSquared(u)<=f.distanceToSquared(c)?(i.copy(d),void a.copy(u)):(i.copy(c),void a.copy(f))}}})(),G2e=(function(){const n=new N,e=new N,t=new Vo,r=new wa;return function(o,i){const{radius:a,center:s}=o,{a:l,b:c,c:u}=i;if(r.start=l,r.end=c,r.closestPointToPoint(s,!0,n).distanceTo(s)<=a||(r.start=l,r.end=u,r.closestPointToPoint(s,!0,n).distanceTo(s)<=a)||(r.start=c,r.end=u,r.closestPointToPoint(s,!0,n).distanceTo(s)<=a))return!0;const d=i.getPlane(t);if(Math.abs(d.distanceToPoint(s))<=a){const f=d.projectPoint(s,e);if(i.containsPoint(f))return!0}return!1}})();function j3(n){return Math.abs(n)<1e-15}class Li extends Br{constructor(...e){super(...e),this.isExtendedTriangle=!0,this.satAxes=new Array(4).fill().map((()=>new N)),this.satBounds=new Array(4).fill().map((()=>new ws)),this.points=[this.a,this.b,this.c],this.sphere=new ni,this.plane=new Vo,this.needsUpdate=!0}intersectsSphere(e){return G2e(e,this)}update(){const e=this.a,t=this.b,r=this.c,o=this.points,i=this.satAxes,a=this.satBounds,s=i[0],l=a[0];this.getNormal(s),l.setFromPoints(s,o);const c=i[1],u=a[1];c.subVectors(e,t),u.setFromPoints(c,o);const d=i[2],f=a[2];d.subVectors(t,r),f.setFromPoints(d,o);const h=i[3],p=a[3];h.subVectors(r,e),p.setFromPoints(h,o),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(s,e),this.needsUpdate=!1}}Li.prototype.closestPointToSegment=(function(){const n=new N,e=new N,t=new wa;return function(r,o=null,i=null){const{start:a,end:s}=r,l=this.points;let c,u=1/0;for(let d=0;d<3;d++){const f=(d+1)%3;t.start.copy(l[d]),t.end.copy(l[f]),W3(t,r,n,e),c=n.distanceToSquared(e),c<u&&(u=c,o&&o.copy(n),i&&i.copy(e))}return this.closestPointToPoint(a,n),c=a.distanceToSquared(n),c<u&&(u=c,o&&o.copy(n),i&&i.copy(a)),this.closestPointToPoint(s,n),c=s.distanceToSquared(n),c<u&&(u=c,o&&o.copy(n),i&&i.copy(s)),Math.sqrt(u)}})(),Li.prototype.intersectsTriangle=(function(){const n=new Li,e=new Array(3),t=new Array(3),r=new ws,o=new ws,i=new N,a=new N,s=new N,l=new N,c=new N,u=new wa,d=new wa,f=new wa,h=new N;function p(m,g,_){const A=m.points;let y=0,b=-1;for(let E=0;E<3;E++){const{start:x,end:w}=u;x.copy(A[E]),w.copy(A[(E+1)%3]),u.delta(a);const L=j3(g.distanceToPoint(x));if(j3(g.normal.dot(a))&&L){_.copy(u),y=2;break}const C=g.intersectLine(u,h);if(!C&&L&&h.copy(x),(C||L)&&!j3(h.distanceTo(w))){if(y<=1)(y===1?_.start:_.end).copy(h),L&&(b=y);else if(y>=2){(b===1?_.start:_.end).copy(h),y=2;break}if(y++,y===2&&b===-1)break}}return y}return function(m,g=null,_=!1){this.needsUpdate&&this.update(),m.isExtendedTriangle?m.needsUpdate&&m.update():(n.copy(m),n.update(),m=n);const A=this.plane,y=m.plane;if(Math.abs(A.normal.dot(y.normal))>1-1e-10){const b=this.satBounds,E=this.satAxes;t[0]=m.a,t[1]=m.b,t[2]=m.c;for(let L=0;L<4;L++){const C=b[L],P=E[L];if(r.setFromPoints(P,t),C.isSeparated(r))return!1}const x=m.satBounds,w=m.satAxes;e[0]=this.a,e[1]=this.b,e[2]=this.c;for(let L=0;L<4;L++){const C=x[L],P=w[L];if(r.setFromPoints(P,e),C.isSeparated(r))return!1}for(let L=0;L<4;L++){const C=E[L];for(let P=0;P<4;P++){const D=w[P];if(i.crossVectors(C,D),r.setFromPoints(i,e),o.setFromPoints(i,t),r.isSeparated(o))return!1}}return g&&(_||console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),g.start.set(0,0,0),g.end.set(0,0,0)),!0}{const b=p(this,y,d);if(b===1&&m.containsPoint(d.end))return g&&(g.start.copy(d.end),g.end.copy(d.end)),!0;if(b!==2)return!1;const E=p(m,A,f);if(E===1&&this.containsPoint(f.end))return g&&(g.start.copy(f.end),g.end.copy(f.end)),!0;if(E!==2)return!1;if(d.delta(s),f.delta(l),s.dot(l)<0){let P=f.start;f.start=f.end,f.end=P}const x=d.start.dot(s),w=d.end.dot(s),L=f.start.dot(s),C=f.end.dot(s);return(x===C||L===w||w<L!=x<C)&&(g&&(c.subVectors(d.start,f.start),c.dot(s)>0?g.start.copy(d.start):g.start.copy(f.start),c.subVectors(d.end,f.end),c.dot(s)<0?g.end.copy(d.end):g.end.copy(f.end)),!0)}}})(),Li.prototype.distanceToPoint=(function(){const n=new N;return function(e){return this.closestPointToPoint(e,n),e.distanceTo(n)}})(),Li.prototype.distanceToTriangle=(function(){const n=new N,e=new N,t=["a","b","c"],r=new wa,o=new wa;return function(i,a=null,s=null){const l=a||s?r:null;if(this.intersectsTriangle(i,l))return(a||s)&&(a&&l.getCenter(a),s&&l.getCenter(s)),0;let c=1/0;for(let u=0;u<3;u++){let d;const f=t[u],h=i[f];this.closestPointToPoint(h,n),d=h.distanceToSquared(n),d<c&&(c=d,a&&a.copy(n),s&&s.copy(h));const p=this[f];i.closestPointToPoint(p,n),d=p.distanceToSquared(n),d<c&&(c=d,a&&a.copy(p),s&&s.copy(n))}for(let u=0;u<3;u++){const d=t[u],f=t[(u+1)%3];r.set(this[d],this[f]);for(let h=0;h<3;h++){const p=t[h],m=t[(h+1)%3];o.set(i[p],i[m]),W3(r,o,n,e);const g=n.distanceToSquared(e);g<c&&(c=g,a&&a.copy(n),s&&s.copy(e))}}return Math.sqrt(c)}})();class bo{constructor(e,t,r){this.isOrientedBox=!0,this.min=new N,this.max=new N,this.matrix=new Ue,this.invMatrix=new Ue,this.points=new Array(8).fill().map((()=>new N)),this.satAxes=new Array(3).fill().map((()=>new N)),this.satBounds=new Array(3).fill().map((()=>new ws)),this.alignedSatBounds=new Array(3).fill().map((()=>new ws)),this.needsUpdate=!1,e&&this.min.copy(e),t&&this.max.copy(t),r&&this.matrix.copy(r)}set(e,t,r){this.min.copy(e),this.max.copy(t),this.matrix.copy(r),this.needsUpdate=!0}copy(e){this.min.copy(e.min),this.max.copy(e.max),this.matrix.copy(e.matrix),this.needsUpdate=!0}}bo.prototype.update=function(){const n=this.matrix,e=this.min,t=this.max,r=this.points;for(let l=0;l<=1;l++)for(let c=0;c<=1;c++)for(let u=0;u<=1;u++){const d=r[1*l|2*c|4*u];d.x=l?t.x:e.x,d.y=c?t.y:e.y,d.z=u?t.z:e.z,d.applyMatrix4(n)}const o=this.satBounds,i=this.satAxes,a=r[0];for(let l=0;l<3;l++){const c=i[l],u=o[l],d=r[1<<l];c.subVectors(a,d),u.setFromPoints(c,r)}const s=this.alignedSatBounds;s[0].setFromPointsField(r,"x"),s[1].setFromPointsField(r,"y"),s[2].setFromPointsField(r,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1},bo.prototype.intersectsBox=(function(){const n=new ws;return function(e){this.needsUpdate&&this.update();const t=e.min,r=e.max,o=this.satBounds,i=this.satAxes,a=this.alignedSatBounds;if(n.min=t.x,n.max=r.x,a[0].isSeparated(n)||(n.min=t.y,n.max=r.y,a[1].isSeparated(n))||(n.min=t.z,n.max=r.z,a[2].isSeparated(n)))return!1;for(let s=0;s<3;s++){const l=i[s],c=o[s];if(n.setFromBox(l,e),c.isSeparated(n))return!1}return!0}})(),bo.prototype.intersectsTriangle=(function(){const n=new Li,e=new Array(3),t=new ws,r=new ws,o=new N;return function(i){this.needsUpdate&&this.update(),i.isExtendedTriangle?i.needsUpdate&&i.update():(n.copy(i),n.update(),i=n);const a=this.satBounds,s=this.satAxes;e[0]=i.a,e[1]=i.b,e[2]=i.c;for(let d=0;d<3;d++){const f=a[d],h=s[d];if(t.setFromPoints(h,e),f.isSeparated(t))return!1}const l=i.satBounds,c=i.satAxes,u=this.points;for(let d=0;d<3;d++){const f=l[d],h=c[d];if(t.setFromPoints(h,u),f.isSeparated(t))return!1}for(let d=0;d<3;d++){const f=s[d];for(let h=0;h<4;h++){const p=c[h];if(o.crossVectors(f,p),t.setFromPoints(o,e),r.setFromPoints(o,u),t.isSeparated(r))return!1}}return!0}})(),bo.prototype.closestPointToPoint=function(n,e){return this.needsUpdate&&this.update(),e.copy(n).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),e},bo.prototype.distanceToPoint=(function(){const n=new N;return function(e){return this.closestPointToPoint(e,n),e.distanceTo(n)}})(),bo.prototype.distanceToBox=(function(){const n=["x","y","z"],e=new Array(12).fill().map((()=>new wa)),t=new Array(12).fill().map((()=>new wa)),r=new N,o=new N;return function(i,a=0,s=null,l=null){if(this.needsUpdate&&this.update(),this.intersectsBox(i))return(s||l)&&(i.getCenter(o),this.closestPointToPoint(o,r),i.closestPointToPoint(r,o),s&&s.copy(r),l&&l.copy(o)),0;const c=a*a,u=i.min,d=i.max,f=this.points;let h=1/0;for(let m=0;m<8;m++){const g=f[m];o.copy(g).clamp(u,d);const _=g.distanceToSquared(o);if(_<h&&(h=_,s&&s.copy(g),l&&l.copy(o),_<c))return Math.sqrt(_)}let p=0;for(let m=0;m<3;m++)for(let g=0;g<=1;g++)for(let _=0;_<=1;_++){const A=(m+1)%3,y=(m+2)%3,b=1<<m|g<<A|_<<y,E=f[g<<A|_<<y],x=f[b];e[p].set(E,x);const w=n[m],L=n[A],C=n[y],P=t[p],D=P.start,Q=P.end;D[w]=u[w],D[L]=g?u[L]:d[L],D[C]=_?u[C]:d[L],Q[w]=d[w],Q[L]=g?u[L]:d[L],Q[C]=_?u[C]:d[L],p++}for(let m=0;m<=1;m++)for(let g=0;g<=1;g++)for(let _=0;_<=1;_++){o.x=m?d.x:u.x,o.y=g?d.y:u.y,o.z=_?d.z:u.z,this.closestPointToPoint(o,r);const A=o.distanceToSquared(r);if(A<h&&(h=A,s&&s.copy(r),l&&l.copy(o),A<c))return Math.sqrt(A)}for(let m=0;m<12;m++){const g=e[m];for(let _=0;_<12;_++){const A=t[_];W3(g,A,r,o);const y=r.distanceToSquared(o);if(y<h&&(h=y,s&&s.copy(r),l&&l.copy(o),y<c))return Math.sqrt(y)}}return Math.sqrt(h)}})();class Q3{constructor(e){this._getNewPrimitive=e,this._primitives=[]}getPrimitive(){const e=this._primitives;return e.length===0?this._getNewPrimitive():e.pop()}releasePrimitive(e){this._primitives.push(e)}}class H2e extends Q3{constructor(){super((()=>new Li))}}const Pi=new H2e;class W2e{constructor(){this.float32Array=null,this.uint16Array=null,this.uint32Array=null;const e=[];let t=null;this.setBuffer=r=>{t&&e.push(t),t=r,this.float32Array=new Float32Array(r),this.uint16Array=new Uint16Array(r),this.uint32Array=new Uint32Array(r)},this.clearBuffer=()=>{t=null,this.float32Array=null,this.uint16Array=null,this.uint32Array=null,e.length!==0&&this.setBuffer(e.pop())}}}const Wn=new W2e;let Al,md;const gd=[],D1=new Q3((()=>new Tn));function j2e(n,e,t,r,o,i){Al=D1.getPrimitive(),md=D1.getPrimitive(),gd.push(Al,md),Wn.setBuffer(n._roots[e]);const a=$3(0,n.geometry,t,r,o,i);Wn.clearBuffer(),D1.releasePrimitive(Al),D1.releasePrimitive(md),gd.pop(),gd.pop();const s=gd.length;return s>0&&(md=gd[s-1],Al=gd[s-2]),a}function $3(n,e,t,r,o=null,i=0,a=0){const{float32Array:s,uint16Array:l,uint32Array:c}=Wn;let u=2*n;if(Wo(u,l)){const d=di(n,c),f=Ti(u,l);return ir(n,s,Al),r(d,f,!1,a,i+n,Al)}{let w=function(C){const{uint16Array:P,uint32Array:D}=Wn;let Q=2*C;for(;!Wo(Q,P);)Q=2*(C=Ii(C));return di(C,D)},L=function(C){const{uint16Array:P,uint32Array:D}=Wn;let Q=2*C;for(;!Wo(Q,P);)Q=2*(C=Ri(C,D));return di(C,D)+Ti(Q,P)};const d=Ii(n),f=Ri(n,c);let h,p,m,g,_=d,A=f;if(o&&(m=Al,g=md,ir(_,s,m),ir(A,s,g),h=o(m),p=o(g),p<h)){_=f,A=d;const C=h;h=p,p=C,m=g}m||(m=Al,ir(_,s,m));const y=t(m,Wo(2*_,l),h,a+1,i+_);let b;if(y===2){const C=w(_);b=r(C,L(_)-C,!0,a+1,i+_,m)}else b=y&&$3(_,e,t,r,o,i,a+1);if(b)return!0;g=md,ir(A,s,g);const E=t(g,Wo(2*A,l),p,a+1,i+A);let x;if(E===2){const C=w(A);x=r(C,L(A)-C,!0,a+1,i+A,g)}else x=E&&$3(A,e,t,r,o,i,a+1);return!!x}}const rp=new N,Y3=new N;function Q2e(n,e,t={},r=0,o=1/0){const i=r*r,a=o*o;let s=1/0,l=null;if(n.shapecast({boundsTraverseOrder:u=>(rp.copy(e).clamp(u.min,u.max),rp.distanceToSquared(e)),intersectsBounds:(u,d,f)=>f<s&&f<a,intersectsTriangle:(u,d)=>{u.closestPointToPoint(e,rp);const f=e.distanceToSquared(rp);return f<s&&(Y3.copy(rp),s=f,l=d),f<i}}),s===1/0)return null;const c=Math.sqrt(s);return t.point?t.point.copy(Y3):t.point=Y3.clone(),t.distance=c,t.faceIndex=l,t}const $2e=parseInt("4.10.0")>=169,bc=new N,xc=new N,Ec=new N,B1=new be,N1=new be,O1=new be,ZB=new N,JB=new N,eN=new N,op=new N;function Y2e(n,e,t,r,o,i,a,s){let l;if(l=i===1?n.intersectTriangle(r,t,e,!0,o):n.intersectTriangle(e,t,r,i!==2,o),l===null)return null;const c=n.origin.distanceTo(o);return c<a||c>s?null:{distance:c,point:o.clone()}}function X2e(n,e,t,r,o,i,a,s,l,c,u){bc.fromBufferAttribute(e,i),xc.fromBufferAttribute(e,a),Ec.fromBufferAttribute(e,s);const d=Y2e(n,bc,xc,Ec,op,l,c,u);if(d){const f=new N;Br.getBarycoord(op,bc,xc,Ec,f),r&&(B1.fromBufferAttribute(r,i),N1.fromBufferAttribute(r,a),O1.fromBufferAttribute(r,s),d.uv=Br.getInterpolation(op,bc,xc,Ec,B1,N1,O1,new be)),o&&(B1.fromBufferAttribute(o,i),N1.fromBufferAttribute(o,a),O1.fromBufferAttribute(o,s),d.uv1=Br.getInterpolation(op,bc,xc,Ec,B1,N1,O1,new be)),t&&(ZB.fromBufferAttribute(t,i),JB.fromBufferAttribute(t,a),eN.fromBufferAttribute(t,s),d.normal=Br.getInterpolation(op,bc,xc,Ec,ZB,JB,eN,new N),d.normal.dot(n.direction)>0&&d.normal.multiplyScalar(-1));const h={a:i,b:a,c:s,normal:new N,materialIndex:0};Br.getNormal(bc,xc,Ec,h.normal),d.face=h,d.faceIndex=i,$2e&&(d.barycoord=f)}return d}function k1(n,e,t,r,o,i,a){const s=3*r;let l=s+0,c=s+1,u=s+2;const d=n.index;n.index&&(l=d.getX(l),c=d.getX(c),u=d.getX(u));const{position:f,normal:h,uv:p,uv1:m}=n.attributes,g=X2e(t,f,h,p,m,l,c,u,e,i,a);return g?(g.faceIndex=r,o&&o.push(g),g):null}function Ar(n,e,t,r){const o=n.a,i=n.b,a=n.c;let s=e,l=e+1,c=e+2;t&&(s=t.getX(s),l=t.getX(l),c=t.getX(c)),o.x=r.getX(s),o.y=r.getY(s),o.z=r.getZ(s),i.x=r.getX(l),i.y=r.getY(l),i.z=r.getZ(l),a.x=r.getX(c),a.y=r.getY(c),a.z=r.getZ(c)}function q2e(n,e,t,r,o,i,a,s){const{geometry:l,_indirectBuffer:c}=n;for(let u=r,d=r+o;u<d;u++)k1(l,e,t,u,i,a,s)}function K2e(n,e,t,r,o,i,a){const{geometry:s,_indirectBuffer:l}=n;let c=1/0,u=null;for(let d=r,f=r+o;d<f;d++){let h;h=k1(s,e,t,d,null,i,a),h&&h.distance<c&&(u=h,c=h.distance)}return u}function Z2e(n,e,t,r,o,i,a){const{geometry:s}=t,{index:l}=s,c=s.attributes.position;for(let u=n,d=e+n;u<d;u++){let f;if(f=u,Ar(a,3*f,l,c),a.needsUpdate=!0,r(a,f,o,i))return!0}return!1}function J2e(n,e=null){e&&Array.isArray(e)&&(e=new Set(e));const t=n.geometry,r=t.index?t.index.array:null,o=t.attributes.position;let i,a,s,l,c=0;const u=n._roots;for(let f=0,h=u.length;f<h;f++)i=u[f],a=new Uint32Array(i),s=new Uint16Array(i),l=new Float32Array(i),d(0,c),c+=i.byteLength;function d(f,h,p=!1){const m=2*f;if(s[m+15]===65535){const g=a[f+6];let _=1/0,A=1/0,y=1/0,b=-1/0,E=-1/0,x=-1/0;for(let w=3*g,L=3*(g+s[m+14]);w<L;w++){let C=r[w];const P=o.getX(C),D=o.getY(C),Q=o.getZ(C);P<_&&(_=P),P>b&&(b=P),D<A&&(A=D),D>E&&(E=D),Q<y&&(y=Q),Q>x&&(x=Q)}return(l[f+0]!==_||l[f+1]!==A||l[f+2]!==y||l[f+3]!==b||l[f+4]!==E||l[f+5]!==x)&&(l[f+0]=_,l[f+1]=A,l[f+2]=y,l[f+3]=b,l[f+4]=E,l[f+5]=x,!0)}{const g=f+8,_=a[f+6],A=g+h,y=_+h;let b=p,E=!1,x=!1;e?b||(E=e.has(A),x=e.has(y),b=!E&&!x):(E=!0,x=!0);const w=b||x;let L=!1;(b||E)&&(L=d(g,h,b));let C=!1;w&&(C=d(_,h,b));const P=L||C;if(P)for(let D=0;D<3;D++){const Q=g+D,re=_+D,G=l[Q],se=l[Q+3],ee=l[re],ie=l[re+3];l[f+D]=G<ee?G:ee,l[f+D+3]=se>ie?se:ie}return P}}}function yl(n,e,t,r,o){let i,a,s,l,c,u;const d=1/t.direction.x,f=1/t.direction.y,h=1/t.direction.z,p=t.origin.x,m=t.origin.y,g=t.origin.z;let _=e[n],A=e[n+3],y=e[n+1],b=e[n+3+1],E=e[n+2],x=e[n+3+2];return d>=0?(i=(_-p)*d,a=(A-p)*d):(i=(A-p)*d,a=(_-p)*d),f>=0?(s=(y-m)*f,l=(b-m)*f):(s=(b-m)*f,l=(y-m)*f),!(i>l||s>a)&&((s>i||isNaN(i))&&(i=s),(l<a||isNaN(a))&&(a=l),h>=0?(c=(E-g)*h,u=(x-g)*h):(c=(x-g)*h,u=(E-g)*h),!(i>u||c>a)&&((c>i||i!=i)&&(i=c),(u<a||a!=a)&&(a=u),i<=o&&a>=r))}function ebe(n,e,t,r,o,i,a,s){const{geometry:l,_indirectBuffer:c}=n;for(let u=r,d=r+o;u<d;u++)k1(l,e,t,c?c[u]:u,i,a,s)}function tbe(n,e,t,r,o,i,a){const{geometry:s,_indirectBuffer:l}=n;let c=1/0,u=null;for(let d=r,f=r+o;d<f;d++){let h;h=k1(s,e,t,l?l[d]:d,null,i,a),h&&h.distance<c&&(u=h,c=h.distance)}return u}function nbe(n,e,t,r,o,i,a){const{geometry:s}=t,{index:l}=s,c=s.attributes.position;for(let u=n,d=e+n;u<d;u++){let f;if(f=t.resolveTriangleIndex(u),Ar(a,3*f,l,c),a.needsUpdate=!0,r(a,f,o,i))return!0}return!1}function rbe(n,e,t,r,o,i,a){Wn.setBuffer(n._roots[e]),X3(0,n,t,r,o,i,a),Wn.clearBuffer()}function X3(n,e,t,r,o,i,a){const{float32Array:s,uint16Array:l,uint32Array:c}=Wn,u=2*n;if(Wo(u,l))q2e(e,t,r,di(n,c),Ti(u,l),o,i,a);else{const d=Ii(n);yl(d,s,r,i,a)&&X3(d,e,t,r,o,i,a);const f=Ri(n,c);yl(f,s,r,i,a)&&X3(f,e,t,r,o,i,a)}}const obe=["x","y","z"];function ibe(n,e,t,r,o,i){Wn.setBuffer(n._roots[e]);const a=q3(0,n,t,r,o,i);return Wn.clearBuffer(),a}function q3(n,e,t,r,o,i){const{float32Array:a,uint16Array:s,uint32Array:l}=Wn;let c=2*n;if(Wo(c,s))return K2e(e,t,r,di(n,l),Ti(c,s),o,i);{const u=XB(n,l),d=obe[u],f=r.direction[d]>=0;let h,p;f?(h=Ii(n),p=Ri(n,l)):(h=Ri(n,l),p=Ii(n));const m=yl(h,a,r,o,i)?q3(h,e,t,r,o,i):null;if(m){const _=m.point[d];if(f?_<=a[p+u]:_>=a[p+u+3])return m}const g=yl(p,a,r,o,i)?q3(p,e,t,r,o,i):null;return m&&g?m.distance<=g.distance?m:g:m||g||null}}const F1=new Tn,_d=new Li,vd=new Li,ip=new Ue,tN=new bo,V1=new bo;function abe(n,e,t,r){Wn.setBuffer(n._roots[e]);const o=K3(0,n,t,r);return Wn.clearBuffer(),o}function K3(n,e,t,r,o=null){const{float32Array:i,uint16Array:a,uint32Array:s}=Wn;let l=2*n;if(o===null&&(t.boundingBox||t.computeBoundingBox(),tN.set(t.boundingBox.min,t.boundingBox.max,r),o=tN),!Wo(l,a)){const c=n+8,u=s[n+6];return ir(c,i,F1),o.intersectsBox(F1)&&K3(c,e,t,r,o)?!0:(ir(u,i,F1),!!(o.intersectsBox(F1)&&K3(u,e,t,r,o)))}{const c=e.geometry,u=c.index,d=c.attributes.position,f=t.index,h=t.attributes.position,p=di(n,s),m=Ti(l,a);if(ip.copy(r).invert(),t.boundsTree)return ir(n,i,V1),V1.matrix.copy(ip),V1.needsUpdate=!0,t.boundsTree.shapecast({intersectsBounds:_=>V1.intersectsBox(_),intersectsTriangle:_=>{_.a.applyMatrix4(r),_.b.applyMatrix4(r),_.c.applyMatrix4(r),_.needsUpdate=!0;for(let A=3*p,y=3*(m+p);A<y;A+=3)if(Ar(vd,A,u,d),vd.needsUpdate=!0,_.intersectsTriangle(vd))return!0;return!1}});for(let g=3*p,_=3*(m+p);g<_;g+=3){Ar(_d,g,u,d),_d.a.applyMatrix4(ip),_d.b.applyMatrix4(ip),_d.c.applyMatrix4(ip),_d.needsUpdate=!0;for(let A=0,y=f.count;A<y;A+=3)if(Ar(vd,A,f,h),vd.needsUpdate=!0,_d.intersectsTriangle(vd))return!0}}}const U1=new Ue,Z3=new bo,ap=new bo,sbe=new N,lbe=new N,cbe=new N,ube=new N;function dbe(n,e,t,r={},o={},i=0,a=1/0){e.boundingBox||e.computeBoundingBox(),Z3.set(e.boundingBox.min,e.boundingBox.max,t),Z3.needsUpdate=!0;const s=n.geometry,l=s.attributes.position,c=s.index,u=e.attributes.position,d=e.index,f=Pi.getPrimitive(),h=Pi.getPrimitive();let p=sbe,m=lbe,g=null,_=null;o&&(g=cbe,_=ube);let A=1/0,y=null,b=null;return U1.copy(t).invert(),ap.matrix.copy(U1),n.shapecast({boundsTraverseOrder:E=>Z3.distanceToBox(E),intersectsBounds:(E,x,w)=>w<A&&w<a&&(x&&(ap.min.copy(E.min),ap.max.copy(E.max),ap.needsUpdate=!0),!0),intersectsRange:(E,x)=>{if(e.boundsTree)return e.boundsTree.shapecast({boundsTraverseOrder:w=>ap.distanceToBox(w),intersectsBounds:(w,L,C)=>C<A&&C<a,intersectsRange:(w,L)=>{for(let C=w,P=w+L;C<P;C++){Ar(h,3*C,d,u),h.a.applyMatrix4(t),h.b.applyMatrix4(t),h.c.applyMatrix4(t),h.needsUpdate=!0;for(let D=E,Q=E+x;D<Q;D++){Ar(f,3*D,c,l),f.needsUpdate=!0;const re=f.distanceToTriangle(h,p,g);if(re<A&&(m.copy(p),_&&_.copy(g),A=re,y=D,b=C),re<i)return!0}}}});for(let w=0,L=pd(e);w<L;w++){Ar(h,3*w,d,u),h.a.applyMatrix4(t),h.b.applyMatrix4(t),h.c.applyMatrix4(t),h.needsUpdate=!0;for(let C=E,P=E+x;C<P;C++){Ar(f,3*C,c,l),f.needsUpdate=!0;const D=f.distanceToTriangle(h,p,g);if(D<A&&(m.copy(p),_&&_.copy(g),A=D,y=C,b=w),D<i)return!0}}}}),Pi.releasePrimitive(f),Pi.releasePrimitive(h),A===1/0?null:(r.point?r.point.copy(m):r.point=m.clone(),r.distance=A,r.faceIndex=y,o&&(o.point?o.point.copy(_):o.point=_.clone(),o.point.applyMatrix4(U1),m.applyMatrix4(U1),o.distance=m.sub(o.point).length(),o.faceIndex=b),r)}function fbe(n,e=null){e&&Array.isArray(e)&&(e=new Set(e));const t=n.geometry,r=t.index?t.index.array:null,o=t.attributes.position;let i,a,s,l,c=0;const u=n._roots;for(let f=0,h=u.length;f<h;f++)i=u[f],a=new Uint32Array(i),s=new Uint16Array(i),l=new Float32Array(i),d(0,c),c+=i.byteLength;function d(f,h,p=!1){const m=2*f;if(s[m+15]===65535){const g=a[f+6];let _=1/0,A=1/0,y=1/0,b=-1/0,E=-1/0,x=-1/0;for(let w=g,L=g+s[m+14];w<L;w++){const C=3*n.resolveTriangleIndex(w);for(let P=0;P<3;P++){let D=C+P;D=r?r[D]:D;const Q=o.getX(D),re=o.getY(D),G=o.getZ(D);Q<_&&(_=Q),Q>b&&(b=Q),re<A&&(A=re),re>E&&(E=re),G<y&&(y=G),G>x&&(x=G)}}return(l[f+0]!==_||l[f+1]!==A||l[f+2]!==y||l[f+3]!==b||l[f+4]!==E||l[f+5]!==x)&&(l[f+0]=_,l[f+1]=A,l[f+2]=y,l[f+3]=b,l[f+4]=E,l[f+5]=x,!0)}{const g=f+8,_=a[f+6],A=g+h,y=_+h;let b=p,E=!1,x=!1;e?b||(E=e.has(A),x=e.has(y),b=!E&&!x):(E=!0,x=!0);const w=b||x;let L=!1;(b||E)&&(L=d(g,h,b));let C=!1;w&&(C=d(_,h,b));const P=L||C;if(P)for(let D=0;D<3;D++){const Q=g+D,re=_+D,G=l[Q],se=l[Q+3],ee=l[re],ie=l[re+3];l[f+D]=G<ee?G:ee,l[f+D+3]=se>ie?se:ie}return P}}}function hbe(n,e,t,r,o,i,a){Wn.setBuffer(n._roots[e]),J3(0,n,t,r,o,i,a),Wn.clearBuffer()}function J3(n,e,t,r,o,i,a){const{float32Array:s,uint16Array:l,uint32Array:c}=Wn,u=2*n;if(Wo(u,l))ebe(e,t,r,di(n,c),Ti(u,l),o,i,a);else{const d=Ii(n);yl(d,s,r,i,a)&&J3(d,e,t,r,o,i,a);const f=Ri(n,c);yl(f,s,r,i,a)&&J3(f,e,t,r,o,i,a)}}const pbe=["x","y","z"];function mbe(n,e,t,r,o,i){Wn.setBuffer(n._roots[e]);const a=ex(0,n,t,r,o,i);return Wn.clearBuffer(),a}function ex(n,e,t,r,o,i){const{float32Array:a,uint16Array:s,uint32Array:l}=Wn;let c=2*n;if(Wo(c,s))return tbe(e,t,r,di(n,l),Ti(c,s),o,i);{const u=XB(n,l),d=pbe[u],f=r.direction[d]>=0;let h,p;f?(h=Ii(n),p=Ri(n,l)):(h=Ri(n,l),p=Ii(n));const m=yl(h,a,r,o,i)?ex(h,e,t,r,o,i):null;if(m){const _=m.point[d];if(f?_<=a[p+u]:_>=a[p+u+3])return m}const g=yl(p,a,r,o,i)?ex(p,e,t,r,o,i):null;return m&&g?m.distance<=g.distance?m:g:m||g||null}}const z1=new Tn,Ad=new Li,yd=new Li,sp=new Ue,nN=new bo,G1=new bo;function gbe(n,e,t,r){Wn.setBuffer(n._roots[e]);const o=tx(0,n,t,r);return Wn.clearBuffer(),o}function tx(n,e,t,r,o=null){const{float32Array:i,uint16Array:a,uint32Array:s}=Wn;let l=2*n;if(o===null&&(t.boundingBox||t.computeBoundingBox(),nN.set(t.boundingBox.min,t.boundingBox.max,r),o=nN),!Wo(l,a)){const c=n+8,u=s[n+6];return ir(c,i,z1),o.intersectsBox(z1)&&tx(c,e,t,r,o)?!0:(ir(u,i,z1),!!(o.intersectsBox(z1)&&tx(u,e,t,r,o)))}{const c=e.geometry,u=c.index,d=c.attributes.position,f=t.index,h=t.attributes.position,p=di(n,s),m=Ti(l,a);if(sp.copy(r).invert(),t.boundsTree)return ir(n,i,G1),G1.matrix.copy(sp),G1.needsUpdate=!0,t.boundsTree.shapecast({intersectsBounds:_=>G1.intersectsBox(_),intersectsTriangle:_=>{_.a.applyMatrix4(r),_.b.applyMatrix4(r),_.c.applyMatrix4(r),_.needsUpdate=!0;for(let A=p,y=m+p;A<y;A++)if(Ar(yd,3*e.resolveTriangleIndex(A),u,d),yd.needsUpdate=!0,_.intersectsTriangle(yd))return!0;return!1}});for(let g=p,_=m+p;g<_;g++){const A=e.resolveTriangleIndex(g);Ar(Ad,3*A,u,d),Ad.a.applyMatrix4(sp),Ad.b.applyMatrix4(sp),Ad.c.applyMatrix4(sp),Ad.needsUpdate=!0;for(let y=0,b=f.count;y<b;y+=3)if(Ar(yd,y,f,h),yd.needsUpdate=!0,Ad.intersectsTriangle(yd))return!0}}}const H1=new Ue,nx=new bo,lp=new bo,_be=new N,vbe=new N,Abe=new N,ybe=new N;function bbe(n,e,t,r={},o={},i=0,a=1/0){e.boundingBox||e.computeBoundingBox(),nx.set(e.boundingBox.min,e.boundingBox.max,t),nx.needsUpdate=!0;const s=n.geometry,l=s.attributes.position,c=s.index,u=e.attributes.position,d=e.index,f=Pi.getPrimitive(),h=Pi.getPrimitive();let p=_be,m=vbe,g=null,_=null;o&&(g=Abe,_=ybe);let A=1/0,y=null,b=null;return H1.copy(t).invert(),lp.matrix.copy(H1),n.shapecast({boundsTraverseOrder:E=>nx.distanceToBox(E),intersectsBounds:(E,x,w)=>w<A&&w<a&&(x&&(lp.min.copy(E.min),lp.max.copy(E.max),lp.needsUpdate=!0),!0),intersectsRange:(E,x)=>{if(e.boundsTree){const w=e.boundsTree;return w.shapecast({boundsTraverseOrder:L=>lp.distanceToBox(L),intersectsBounds:(L,C,P)=>P<A&&P<a,intersectsRange:(L,C)=>{for(let P=L,D=L+C;P<D;P++){const Q=w.resolveTriangleIndex(P);Ar(h,3*Q,d,u),h.a.applyMatrix4(t),h.b.applyMatrix4(t),h.c.applyMatrix4(t),h.needsUpdate=!0;for(let re=E,G=E+x;re<G;re++){const se=n.resolveTriangleIndex(re);Ar(f,3*se,c,l),f.needsUpdate=!0;const ee=f.distanceToTriangle(h,p,g);if(ee<A&&(m.copy(p),_&&_.copy(g),A=ee,y=re,b=P),ee<i)return!0}}}})}for(let w=0,L=pd(e);w<L;w++){Ar(h,3*w,d,u),h.a.applyMatrix4(t),h.b.applyMatrix4(t),h.c.applyMatrix4(t),h.needsUpdate=!0;for(let C=E,P=E+x;C<P;C++){const D=n.resolveTriangleIndex(C);Ar(f,3*D,c,l),f.needsUpdate=!0;const Q=f.distanceToTriangle(h,p,g);if(Q<A&&(m.copy(p),_&&_.copy(g),A=Q,y=C,b=w),Q<i)return!0}}}}),Pi.releasePrimitive(f),Pi.releasePrimitive(h),A===1/0?null:(r.point?r.point.copy(m):r.point=m.clone(),r.distance=A,r.faceIndex=y,o&&(o.point?o.point.copy(_):o.point=_.clone(),o.point.applyMatrix4(H1),m.applyMatrix4(H1),o.distance=m.sub(o.point).length(),o.faceIndex=b),r)}function xbe(){return typeof SharedArrayBuffer<"u"}const cp=new Wn.constructor,W1=new Wn.constructor,bl=new Q3((()=>new Tn)),bd=new Tn,xd=new Tn,rx=new Tn,ox=new Tn;let ix=!1;function Ebe(n,e,t,r){if(ix)throw new Error("MeshBVH: Recursive calls to bvhcast not supported.");ix=!0;const o=n._roots,i=e._roots;let a,s=0,l=0;const c=new Ue().copy(t).invert();for(let u=0,d=o.length;u<d;u++){cp.setBuffer(o[u]),l=0;const f=bl.getPrimitive();ir(0,cp.float32Array,f),f.applyMatrix4(c);for(let h=0,p=i.length;h<p&&(W1.setBuffer(i[h]),a=ra(0,0,t,c,r,s,l,0,0,f),W1.clearBuffer(),l+=i[h].length,!a);h++);if(bl.releasePrimitive(f),cp.clearBuffer(),s+=o[u].length,a)break}return ix=!1,a}function ra(n,e,t,r,o,i=0,a=0,s=0,l=0,c=null,u=!1){let d,f;u?(d=W1,f=cp):(d=cp,f=W1);const h=d.float32Array,p=d.uint32Array,m=d.uint16Array,g=f.float32Array,_=f.uint32Array,A=f.uint16Array,y=2*e,b=Wo(2*n,m),E=Wo(y,A);let x=!1;if(E&&b)x=u?o(di(e,_),Ti(2*e,A),di(n,p),Ti(2*n,m),l,a+e,s,i+n):o(di(n,p),Ti(2*n,m),di(e,_),Ti(2*e,A),s,i+n,l,a+e);else if(E){const w=bl.getPrimitive();ir(e,g,w),w.applyMatrix4(t);const L=Ii(n),C=Ri(n,p);ir(L,h,bd),ir(C,h,xd);const P=w.intersectsBox(bd),D=w.intersectsBox(xd);x=P&&ra(e,L,r,t,o,a,i,l,s+1,w,!u)||D&&ra(e,C,r,t,o,a,i,l,s+1,w,!u),bl.releasePrimitive(w)}else{const w=Ii(e),L=Ri(e,_);ir(w,g,rx),ir(L,g,ox);const C=c.intersectsBox(rx),P=c.intersectsBox(ox);if(C&&P)x=ra(n,w,t,r,o,i,a,s,l+1,c,u)||ra(n,L,t,r,o,i,a,s,l+1,c,u);else if(C)if(b)x=ra(n,w,t,r,o,i,a,s,l+1,c,u);else{const D=bl.getPrimitive();D.copy(rx).applyMatrix4(t);const Q=Ii(n),re=Ri(n,p);ir(Q,h,bd),ir(re,h,xd);const G=D.intersectsBox(bd),se=D.intersectsBox(xd);x=G&&ra(w,Q,r,t,o,a,i,l,s+1,D,!u)||se&&ra(w,re,r,t,o,a,i,l,s+1,D,!u),bl.releasePrimitive(D)}else if(P)if(b)x=ra(n,L,t,r,o,i,a,s,l+1,c,u);else{const D=bl.getPrimitive();D.copy(ox).applyMatrix4(t);const Q=Ii(n),re=Ri(n,p);ir(Q,h,bd),ir(re,h,xd);const G=D.intersectsBox(bd),se=D.intersectsBox(xd);x=G&&ra(L,Q,r,t,o,a,i,l,s+1,D,!u)||se&&ra(L,re,r,t,o,a,i,l,s+1,D,!u),bl.releasePrimitive(D)}}return x}const j1=new bo,rN=new Tn,Cbe={strategy:0,maxDepth:40,maxLeafTris:10,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,indirect:!1,verbose:!0,range:null};class Q1{static serialize(e,t={}){t={cloneBuffers:!0,...t};const r=e.geometry,o=e._roots,i=e._indirectBuffer,a=r.getIndex();let s;return s=t.cloneBuffers?{roots:o.map((l=>l.slice())),index:a?a.array.slice():null,indirectBuffer:i?i.slice():null}:{roots:o,index:a?a.array:null,indirectBuffer:i},s}static deserialize(e,t,r={}){r={setIndex:!0,indirect:!!e.indirectBuffer,...r};const{index:o,roots:i,indirectBuffer:a}=e,s=new Q1(t,{...r,[V3]:!0});if(s._roots=i,s._indirectBuffer=a||null,r.setIndex){const l=t.getIndex();if(l===null){const c=new Xe(e.index,1,!1);t.setIndex(c)}else l.array!==o&&(l.array.set(o),l.needsUpdate=!0)}return s}get indirect(){return!!this._indirectBuffer}constructor(e,t={}){if(!e.isBufferGeometry)throw new Error("MeshBVH: Only BufferGeometries are supported.");if((t=Object.assign({...Cbe,[V3]:!1},t)).useSharedArrayBuffer&&!xbe())throw new Error("MeshBVH: SharedArrayBuffer is not available.");this.geometry=e,this._roots=null,this._indirectBuffer=null,t[V3]||(U2e(this,t),!e.boundingBox&&t.setBoundingBox&&(e.boundingBox=this.getBoundingBox(new Tn))),this.resolveTriangleIndex=t.indirect?r=>this._indirectBuffer[r]:r=>r}refit(e=null){return(this.indirect?fbe:J2e)(this,e)}traverse(e,t=0){const r=this._roots[t],o=new Uint32Array(r),i=new Uint16Array(r);(function a(s,l=0){const c=2*s,u=i[c+15]===65535;if(u){const d=o[s+6],f=i[c+14];e(l,u,new Float32Array(r,4*s,6),d,f)}else{const d=s+8,f=o[s+6],h=o[s+7];e(l,u,new Float32Array(r,4*s,6),h)||(a(d,l+1),a(f,l+1))}})(0)}raycast(e,t=0,r=0,o=1/0){const i=this._roots,a=this.geometry,s=[],l=t.isMaterial,c=Array.isArray(t),u=a.groups,d=l?t.side:t,f=this.indirect?hbe:rbe;for(let h=0,p=i.length;h<p;h++){const m=c?t[u[h].materialIndex].side:d,g=s.length;if(f(this,h,m,e,s,r,o),c){const _=u[h].materialIndex;for(let A=g,y=s.length;A<y;A++)s[A].face.materialIndex=_}}return s}raycastFirst(e,t=0,r=0,o=1/0){const i=this._roots,a=this.geometry,s=t.isMaterial,l=Array.isArray(t);let c=null;const u=a.groups,d=s?t.side:t,f=this.indirect?mbe:ibe;for(let h=0,p=i.length;h<p;h++){const m=f(this,h,l?t[u[h].materialIndex].side:d,e,r,o);m!=null&&(c==null||m.distance<c.distance)&&(c=m,l&&(m.face.materialIndex=u[h].materialIndex))}return c}intersectsGeometry(e,t){let r=!1;const o=this._roots,i=this.indirect?gbe:abe;for(let a=0,s=o.length;a<s&&(r=i(this,a,e,t),!r);a++);return r}shapecast(e){const t=Pi.getPrimitive(),r=this.indirect?nbe:Z2e;let{boundsTraverseOrder:o,intersectsBounds:i,intersectsRange:a,intersectsTriangle:s}=e;if(a&&s){const d=a;a=(f,h,p,m,g)=>!!d(f,h,p,m,g)||r(f,h,this,s,p,m,t)}else a||(a=s?(d,f,h,p)=>r(d,f,this,s,h,p,t):(d,f,h)=>h);let l=!1,c=0;const u=this._roots;for(let d=0,f=u.length;d<f;d++){const h=u[d];if(l=j2e(this,d,i,a,o,c),l)break;c+=h.byteLength}return Pi.releasePrimitive(t),l}bvhcast(e,t,r){let{intersectsRanges:o,intersectsTriangles:i}=r;const a=Pi.getPrimitive(),s=this.geometry.index,l=this.geometry.attributes.position,c=this.indirect?p=>{const m=this.resolveTriangleIndex(p);Ar(a,3*m,s,l)}:p=>{Ar(a,3*p,s,l)},u=Pi.getPrimitive(),d=e.geometry.index,f=e.geometry.attributes.position,h=e.indirect?p=>{const m=e.resolveTriangleIndex(p);Ar(u,3*m,d,f)}:p=>{Ar(u,3*p,d,f)};if(i){const p=(m,g,_,A,y,b,E,x)=>{for(let w=_,L=_+A;w<L;w++){h(w),u.a.applyMatrix4(t),u.b.applyMatrix4(t),u.c.applyMatrix4(t),u.needsUpdate=!0;for(let C=m,P=m+g;C<P;C++)if(c(C),a.needsUpdate=!0,i(a,u,C,w,y,b,E,x))return!0}return!1};if(o){const m=o;o=function(g,_,A,y,b,E,x,w){return!!m(g,_,A,y,b,E,x,w)||p(g,_,A,y,b,E,x,w)}}else o=p}return Ebe(this,e,t,o)}intersectsBox(e,t){return j1.set(e.min,e.max,t),j1.needsUpdate=!0,this.shapecast({intersectsBounds:r=>j1.intersectsBox(r),intersectsTriangle:r=>j1.intersectsTriangle(r)})}intersectsSphere(e){return this.shapecast({intersectsBounds:t=>e.intersectsBox(t),intersectsTriangle:t=>t.intersectsSphere(e)})}closestPointToGeometry(e,t,r={},o={},i=0,a=1/0){return(this.indirect?bbe:dbe)(this,e,t,r,o,i,a)}closestPointToPoint(e,t={},r=0,o=1/0){return Q2e(this,e,t,r,o)}getBoundingBox(e){return e.makeEmpty(),this._roots.forEach((t=>{ir(0,new Float32Array(t),rN),e.union(rN)})),e}}class Sbe extends Mt{}function oN(n,e,t){return n===null?null:(n.point.applyMatrix4(e.matrixWorld),n.distance=n.point.distanceTo(t.ray.origin),n.object=e,n)}const $1=new Tu,iN=new N,aN=new Ue,wbe=Mt.prototype.raycast,Mbe=Sbe.prototype.raycast,sN=new N,Yr=new Mt,Y1=[];function lN(n,e){this.isBatchedMesh?Tbe.call(this,n,e):Ibe.call(this,n,e)}function Tbe(n,e){if(this.boundsTrees){const t=this.boundsTrees,r=this._drawInfo||this._instanceInfo,o=this._drawRanges||this._geometryInfo,i=this.matrixWorld;Yr.material=this.material,Yr.geometry=this.geometry;const a=Yr.geometry.boundsTree,s=Yr.geometry.drawRange;Yr.geometry.boundingSphere===null&&(Yr.geometry.boundingSphere=new ni);for(let l=0,c=r.length;l<c;l++){if(!this.getVisibleAt(l))continue;const u=r[l].geometryIndex;if(Yr.geometry.boundsTree=t[u],this.getMatrixAt(l,Yr.matrixWorld).premultiply(i),!Yr.geometry.boundsTree){this.getBoundingBoxAt(u,Yr.geometry.boundingBox),this.getBoundingSphereAt(u,Yr.geometry.boundingSphere);const d=o[u];Yr.geometry.setDrawRange(d.start,d.count)}Yr.raycast(n,Y1);for(let d=0,f=Y1.length;d<f;d++){const h=Y1[d];h.object=this,h.batchId=l,e.push(h)}Y1.length=0}Yr.geometry.boundsTree=a,Yr.geometry.drawRange=s,Yr.material=null,Yr.geometry=null}else Mbe.call(this,n,e)}function Ibe(n,e){if(this.geometry.boundsTree){if(this.isAuxClippingMesh||this.material===void 0)return;try{aN.copy(this.matrixWorld).invert()}catch{return}$1.copy(n.ray).applyMatrix4(aN),sN.setFromMatrixScale(this.matrixWorld),iN.copy($1.direction).multiply(sN);const t=iN.length(),r=n.near/t,o=n.far/t,i=this.geometry.boundsTree;if(n.firstHitOnly===!0){const a=oN(i.raycastFirst($1,this.material,r,o),this,n);a&&e.push(a)}else{const a=i.raycast($1,this.material,r,o);for(let s=0,l=a.length;s<l;s++){const c=oN(a[s],this,n);c&&e.push(c)}}}else wbe.call(this,n,e)}function cN(n={}){return this.boundsTree=new Q1(this,n),this.boundsTree}function uN(){this.boundsTree=null}const dN=["toneMapping","toneMappingLook","toneMappingMidTones","toneMappingPhysicalScale","toneMappingBrightness","toneMappingContrast","toneMappingChromaticAdaptation","toneMappingWhiteColor","toneMappingColorDifferentiation","toneMappingExteriorDaylight","toneMappingWhiteBalance","toneMappingHighlights","toneMappingShadows","toneMappingSaturation","toneMappingAperture","toneMappingShutter","toneMappingISO","toneMappingVignetting"],Rbe={type:"afterFirstRender"},Lbe={type:"afterRender"},Pbe={type:"beforeRender"},Dbe={type:"dispose"},Bbe={type:"pause"},Nbe={type:"resume"},Obe={type:"sceneLoad"};function Da(n,e,t){return 2*xu*Math.atan(Math.tan(ss*n/2)*e/t)}class fN extends ti{constructor(e,t={},r=null){if(super(),this.container=e instanceof HTMLElement?e:document.getElementById(e),this.scene=null,this.camera=null,this.clock=new Ca,this.mixer=null,this.renderCallbacks=[],this.compileCallbacks=[],this.elapsed=0,this.frame=0,this.preloader=r,this.worldCubemapRes=1024,this._pmremMaxTileSize=256,this._lightProbeCubemapRes=64,this._debugHelpers=[],this._debugModes=new Set,this.xrSession=null,this.xrCameraParent=null,this.xrControllers=[],t=t||{},!nr.checkWebGL()){const a=t.webglErrorMsg||'Ouch! Your device does not support WebGL.<br>Find out how to fix this <a href="https://www.soft8soft.com/webgl-supported-browsers-and-troubleshooting/" target="_top" class="v3d-webgl-error-link">here</a>.';return void nr.showWebGLErrorMessage(this.container,a)}Wr.legacyMode=!1;const o={};o.alpha=!!_e(t.alpha)&&t.alpha,o.depth=!_e(t.depth)||t.depth,o.stencil=!_e(t.stencil)||t.stencil,o.antialias=!_e(t.antialias)||t.antialias,o.premultipliedAlpha=!_e(t.premultipliedAlpha)||t.premultipliedAlpha,o.preserveDrawingBuffer=!!_e(t.preserveDrawingBuffer)&&t.preserveDrawingBuffer,nr.isSafariWithMultisamplingBug()&&(console.warn("v3d.App: disabling buggy context AA on Safari 15.4"),o.antialias=!1),this.renderer=new U2(o),m6.prepareRenderer(this.renderer),this.clearBkgOnLoad=!1,this.registerServiceKeys=!0,this.frameRateDivider=1,this.enableRender=!0,this.disableRenderTrigger=0,this.ssaaOnPause=!1,this.renderer.setSize(this.container.offsetWidth,this.container.offsetHeight),this.renderer.outputEncoding=3001,this.container.appendChild(this.renderer.domElement),this.container.classList.add("v3d-container"),this.renderer.domElement.classList.add("v3d-canvas"),this.container.setAttribute("translate","no"),this._onContextRestoreCb=()=>{this._onContextRestore()},this.renderer.domElement.addEventListener("webglcontextrestored",this._onContextRestoreCb),this.loader=new MB;const i=new Pa().setTranscoderPath(Gg()).detectSupport(this.renderer);this.loader.setKTX2Loader(i),At.prototype.computeBoundsTree=cN,At.prototype.disposeBoundsTree=uN,Mt.prototype.raycast=lN,this.actions=[],this._envIBLMode=0,this._envLightProbe=null,this._resizeCb=null,this._loadSceneURL="",this._loadingTime=0,this._webxrSave={background:null,postprocessing:null,useOIT:!1},this.cssRenderer=null,this.cssScene=null,this.stats=null,vo.drawWatermark(this),vo.addToAppList(this)}_updateRendererFromGLTF(e){const t=this,r=nr.checkHalfFloatTex(this.renderer,!0),o=this.renderer.capabilities.isWebGL2;if(e.renderer.shadowMap&&(this.renderer.shadowMap.enabled=e.renderer.shadowMap.enabled,this.renderer.shadowMap.type=e.renderer.shadowMap.type,r||this.renderer.shadowMap.type!==3||(this.renderer.shadowMap.type=2,e.scene.traverse((function(a){a.isLight&&a.castShadow&&a.shadow&&(a.shadow.bias/=100)})))),this.aaMethod=e.renderer.aaMethod??"AUTO",this.aaMethod==="AUTO"||o||(console.warn("v3d.App: setting anti-aliasing to Auto for WebGL 1.0 renderer"),this.aaMethod="AUTO"),this.useHDR=!!(e.renderer.useHDR&&r),this.useHDR&&!o&&(console.warn("v3d.App: disabling HDR for WebGL 1.0 renderer"),this.useHDR=!1),this.renderer.useOIT=e.renderer.useOIT??!1,this.renderer.useOIT&&!o&&(console.warn("v3d.App: disabling order-independent transparency for WebGL 1.0 renderer"),this.renderer.useOIT=!1),this.renderer.unitsScaleFactor=e.renderer.unitsScaleFactor??1,e.renderer.toneMapping)for(let a=0;a<dN.length;a++){const s=dN[a];_e(e.renderer[s])&&(this.renderer[s]=e.renderer[s])}e.renderer.pmremMaxTileSize!==void 0&&(this._pmremMaxTileSize=e.renderer.pmremMaxTileSize),e.renderer.iblEnvironmentMode!==void 0&&(this._envIBLMode=e.renderer.iblEnvironmentMode),e.renderer.esmDistanceScale!==void 0&&(this.renderer.shadowMap.esmDistanceScale=e.renderer.esmDistanceScale);let i=!1;e.scene.traverse((function(a){a.hidpiCompositing&&(o&&a.traverse((s=>{a.isMesh&&(s.layers.set(7),s.isMaterialGeneratedMesh&&a.parent.layers.set(7))})),i=!0)})),i&&(o?(t.useHiDPIRenderPass=!0,t.renderer.setPixelRatio(window.devicePixelRatio)):console.warn("v3d.App: disabling HiDPI pass for WebGL 1.0 renderer")),t.useHiDPIRenderPass&&e.scene.traverse((function(a){a.isLight&&a.layers.enable(7)}))}_updateMeshesRaycastFromGLTF(e){e.scene&&e.scene.traverse((function(t){const r=t.geometry;t.isMesh&&r.computeBoundsTree&&Object.keys(r.morphAttributes).length===0&&r.computeBoundsTree({verbose:!1})}))}_prepareReflProbesFromGLTF(e){e.scene&&e.scene.traverse((t=>{if(t.isCubeReflectionProbe)this._prepareEnvMapProbe(t);else if(t.isPlaneReflectionProbe){let r=this._checkMSAA(this.renderer,4);r>0&&t.makeMultisampleRenderTarget(r)}}))}_prepareEnvMapProbe(e){switch(e.setSize(this._pmremMaxTileSize),this._envIBLMode){case 0:e.onUpdate=t=>this.generateRTargetPMREM(t);break;case 1:case 2:e.onUpdate=()=>null}}_prepareReflProbesEncoding(e,t){e.traverse((r=>{(r.isCubeReflectionProbe||r.isPlaneReflectionProbe)&&r.setEncoding(t)}))}_prepareEnvMapProbeWorld(){if(this._envIBLMode==2)return;const e=new jr;e.worldMaterial=this.scene.worldMaterial,this.scene.worldEnvMapProbe===null&&(this.scene.worldEnvMapProbe=new l3(this._pmremMaxTileSize),this.scene.worldEnvMapProbe.influenceType=0,this.scene.worldEnvMapProbe.parallaxType=0);const t=this.scene.worldEnvMapProbe;switch(this._envIBLMode){case 0:t.onUpdate=r=>this.generateRTargetPMREM(r);break;case 1:t.onUpdate=r=>{const o=r.clone();o.setSize(this._lightProbeCubemapRes,this._lightProbeCubemapRes),nr.checkHalfFloatReadPixels(this.renderer)?o.texture.type=1016:nr.checkFloatReadPixels(this.renderer)?o.texture.type=1015:(console.warn("v3d.App: Target platform does not support reading pixels in float format, expect quality loss."),o.texture.type=1009),o.texture.format=1023,o.texture.encoding=3e3;const i=new Gh(r.texture);return i.render(this.renderer,o),i.dispose(),this._disposeEnvLightProbe(),this._envLightProbe=GB.fromCubeRenderTarget(this.renderer,o),this.scene.add(this._envLightProbe),o.dispose(),null}}t.update(e,this.renderer)}_updateMaterialsFromGLTF(e){const t=this;e.scene&&e.scene.traverse((function(r){const o=r.material;o&&t.useHDR&&(o.toneMapped=!1,o.useFloatTex=nr.checkFloatTex(t.renderer,!0),o.isMeshNodeMaterial&&o.updateNodeGraph(!0))}))}_updateAnimationsFromGLTF(e,t){const r=this;!r.mixer&&e.animations&&e.animations.length&&(r.mixer=new sD(r.scene)),(e.animations||[]).forEach((function(o){const i=t.getObjectById(o.nodeId);if(i){let a;o.clip.objectUUID=i.uuid,a=i.id==t.id||i.name!==""&&i.name!=="root"&&i.name!=="."&&i.name!==t.name&&i.name!==t.uuid?r.mixer.clipAction(o.clip,t):r.mixer.clipAction(o.clip,i),a.setLoop(o.loop,o.repetitions,!0),a.startAt(o.startAt+r.mixer.time),a.clampWhenFinished=!0,o.auto?a.play():(a.stop(),a.paused=!0),a.objectUUID=i.uuid,r.actions.push(a)}}))}_traverseSceneForTexUniforms(e,t){e.traverse((function(r){r.material&&(Array.isArray(r.material)?r.material:[r.material]).forEach((function(o){o.program!==void 0&&t(r,o,o.program.getTexUniformCount())}))}))}_checkMSAA(e,t){return Math.min(t,e.capabilities.maxSamples)}_precompileSceneAsync(e,t,r,o){const i=this,a=i.compileCallbacks;for(let l=0;l<a.length;l++)a[l](i);const s=i.renderer.getRenderTarget();i.renderer.setRenderTarget(r),i.renderer.compileAsync(e,t,(function(l){l>=1&&i.renderer.setRenderTarget(s),o&&o(100*l)}))}_handleAlphaToCoverage(e){this.scene.traverse((function(t){const r=t.material;r&&r.alphaToCoverage&&(e>0?(r.transparent=!1,r.premultipliedAlpha=!1,r.blending=0):r.alphaToCoverage=!1)}))}_onContextRestore(e){this.scene&&this.scene.worldMaterial&&(this.updateEnvironment(this.scene.worldMaterial),this.updateReflectionProbes(this.scene))}assignClippingPlanes(e){const t=this;let r=[],o=[],i=[],a=-1e3;e.traverse((function(s){s.isClippingPlaneObject&&(r.push(s),o.push(s.plane),e.traverse((function(l){s.needsClippingPlane(l)&&s.assignToObject(l,a++)})),i.push(a++))}));for(let s=0;s<r.length;s++){const l=r[s];l.crossSection&&l.createCrossSectionPlane(o,i[s])}r.length&&(t.renderer.localClippingEnabled=!0,t.postprocessing&&t.postprocessing.composer.setStencil(!0))}updateConstraints(e){const t=this;e.traverse((function(r){for(let o=0;o<r.constraints.length;o++){const i=r.constraints[o];i.isCanvasBreakpointsConstraint&&(i.appInstance=t),i.isCanvasFitConstraint&&(i.xr=t.renderer.xr),e.userData&&e.userData.coordSystem&&i.coordSystem&&(i.coordSystem=e.userData.coordSystem)}}))}loadScene(e,t,r,o){const i=this;i.renderer?(i._loadSceneURL=e,i._loadingTime=performance.now(),i.preloader&&i.preloader.onUpdate(0),this.loader.load(e,(function(a){i.scene=a.scene||new jr;let s=null;a.cameras&&a.cameras.length?i.camera=a.cameras[0]:(s=h1(i.scene),i.camera=f6(s,i.container.offsetWidth/i.container.offsetHeight),i.scene.add(i.camera)),i.camera.controlSettings||(s=s||h1(i.scene),h6(i.camera,h1(i.scene)),i.camera.viewportFit.type=1),i._updateRendererFromGLTF(a),i._prepareReflProbesFromGLTF(a),i._updateMaterialsFromGLTF(a),i._updateAnimationsFromGLTF(a,i.scene);const l=a.world.material;l&&(i.scene.background=new Ge,i.scene.worldMaterial=l,i.updateEnvironment(l)),i.initPostprocessing(),i.assignClippingPlanes(i.scene),i.updateConstraints(i.scene),i.onResize&&i.onResize(),i.scene.updateWorldMatrix(!1,!0),i.scene.matrixWorldAutoUpdate=!1,i.scene.visible=!1,i.scene.disableChildRendering=!0;const c=function(){i.scene&&i._traverseSceneForTexUniforms(i.scene,(function(d,f,h){h>8&&console.warn(`v3d.App: Material "${f.name}" on object "${d.name}" exceeds iOS limit of 8 textures (has ${h}).`)})),i.removeEventListener("afterFirstRender",c)},u=i.postprocessing?i.postprocessing.composer.renderTarget1:null;i._precompileSceneAsync(i.scene,i.camera,u,(function(d){const f=(60+.4*d)/1;r&&r(f),i.preloader&&i.preloader.onUpdate(f),f>=100&&(i._updateMeshesRaycastFromGLTF(a),i.addEventListener("afterFirstRender",c),t&&setTimeout((function(){i.scene.visible=!0,i.scene.disableChildRendering=!1,i.updateReflectionProbes(i.scene),i._loadingTime=performance.now()-i._loadingTime,i.dispatchEvent({...Obe}),t(i.scene)}),16),a=null)})),i.clearBkgOnLoad&&(i.scene.background=null),i.registerServiceKeys&&vo.registerServiceKeys(i)}),(function(a){const s=.6*a/1;r&&r(s),i.preloader&&i.preloader.onUpdate(s)}),(function(a){console.error(a),o&&o(a)})),window.removeEventListener("resize",this._resizeCb,!1),this._resizeCb=function(){i.onResize&&i.onResize()},window.addEventListener("resize",this._resizeCb,!1)):o&&o("WebGL not found")}appendScene(e,t,r,o,i,a){const s=this;s.renderer?(i===void 0&&(i=!0),a===void 0&&(a=!0),s.preloader&&s.preloader.onUpdate(0),this.loader.load(e,(function(l){const c=l.scene||new jr,u=[];c.traverse((function(h){(h.isCamera&&!i||h.isLight&&!a)&&u.push(h)})),u.forEach((function(h){s.unload(h)})),s.scene&&(s.scene.add(c),s._prepareReflProbesFromGLTF(l),s._updateMaterialsFromGLTF(l),s._updateAnimationsFromGLTF(l,c),s.scene.updateWorldMatrix(!1,!0));const d=s.postprocessing?s.postprocessing.composer.renderTarget1:null,f=s.scene||c;s.assignClippingPlanes(f),s.updateConstraints(f),c.visible=!1,c.disableChildRendering=!0,s._precompileSceneAsync(f,s.camera||new fh,d,(function(h){const p=(60+.4*h)/1;r&&r(p),s.preloader&&s.preloader.onUpdate(p),p>=100&&(s._updateMeshesRaycastFromGLTF(l),s._traverseSceneForTexUniforms(c,(function(m,g,_){_>8&&console.warn(`v3d.App: Material "${g.name}" on object "${m.name}" exceeds iOS limit of 8 textures (has ${_}).`)})),t&&setTimeout((function(){c.visible=!0,c.disableChildRendering=!1,s.updateReflectionProbes(s.scene),t(c)}),16),l=null)}))}),(function(l){const c=.6*l/1;r&&r(c),s.preloader&&s.preloader.onUpdate(c)}),(function(l){console.error(l),o&&o(l)}))):o&&o("WebGL not found")}unload(e){const t=this;function r(o){if(o.isAnnotation)o.dispose();else if(o.isLight&&o.shadow&&o.shadow.isLightShadow)o.shadow.dispose();else if(o.isCamera&&o.controlSettings&&o.controlSettings.orbitTarget)r(o.controlSettings.orbitTarget);else if(o.isScene){const i=o.worldMaterial;i!==null&&(o3(i),i.dispose()),o.worldEnvMapProbe!==null&&(o.worldEnvMapProbe.dispose(),o.worldEnvMapProbe=null)}else if(o.isMesh){o.geometry.dispose(),o.geometry.disposeBoundsTree&&o.geometry.disposeBoundsTree();const i=o.material;o3(i),i.dispose()}}if(e||(e=t.scene),e===t.scene){if(t.scene&&(t.scene.traverse(r),t.disposeEnvironment()),t.scene=null,t.disableControls(),t.camera=null,t.mixer&&(t.mixer.stopAllAction(),t.actions.forEach((function(o){t.mixer.uncacheAction(o.getClip(),o.getRoot())}))),t.mixer=null,t.actions=[],t.postprocessing){if(t.postprocessing.composer)for(let o in t.postprocessing){const i=t.postprocessing[o];(i instanceof xi||i instanceof c3)&&i.dispose()}t.disablePostprocessing()}t.postprocessing=null,Xi.dispose(),t.renderer&&t.renderer.disposeInternalCaches(),vo.unregisterServiceKeys(t),t.useHiDPIRenderPass=!1,t.renderer.setPixelRatio(1)}else if(t.scene&&(e.traverse(r),e.parent&&e.parent.remove(e)),t.mixer)for(let o=t.actions.length-1;o>=0;o--){const i=t.actions[o];d6(t.scene,i)||(i.stop(),t.mixer.uncacheAction(i.getClip(),i.getRoot()),t.actions.splice(o,1))}}dispose(){this.scene&&this.unload(),this.renderer&&(this.renderer.forceContextLoss(),this.renderer.dispose(),this.renderer.domElement.removeEventListener("webglcontextrestored",this._onContextRestoreCb),this._onContextRestoreCb=null,this.renderer.domElement.parentElement===this.container&&this.container.removeChild(this.renderer.domElement)),this.renderer=null,this.disableCSSRenderer(),this.loader=null,window.removeEventListener("resize",this._resizeCb,!1),this._resizeCb=null,this.renderCallbacks.length=0,this.compileCallbacks.length=0,vo.removeFromAppList(this),na.clear(),this.dispatchEvent({...Dbe}),delete this._listeners}getWidth(){return this.container.offsetWidth}getHeight(){return this.container.offsetHeight}onResize(){if(!this.renderer)return;this.enableRender&&!this.ssaaOnPause||(this.enableRendering(),this.disableRendering(1));const e=this.getWidth(),t=this.getHeight();if(this.renderer.setSize(e,t),this.cssRenderer&&this.cssRenderer.setSize(e,t),this.postprocessing&&(this.postprocessing.gtaoGenerator&&this.postprocessing.gtaoGenerator.setSize(e,t),this.postprocessing.composer.setSize(e,t)),this.scene){this.scene.traverse((i=>{i.isPlaneReflectionProbe&&i.setSize(e,t)}));const r=e/t,o=this.camera;if(o.isPerspectiveCamera){const i=o.aspect<o.viewportFit.initialAspect,a=r<o.viewportFit.initialAspect;switch(o.viewportFit.type){case 1:o.aspect=r;break;case 2:o.fov=Da(o.fov,o.aspect,r),o.aspect=r;break;case 3:i&&a?o.fov=Da(o.fov,o.aspect,r):i&&!a?o.fov=Da(o.fov,o.aspect,o.viewportFit.initialAspect):!i&&a&&(o.fov=Da(o.fov,o.viewportFit.initialAspect,r)),o.aspect=r;break;case 5:i&&a?o.fov=Da(o.fov,o.aspect,r):i&&!a?o.fov=Da(o.fov,o.viewportFit.initialAspect,r):!i&&a&&(o.fov=Da(o.fov,o.aspect,r)),o.aspect=r;break;case 4:i||a?i&&!a?o.fov=Da(o.fov,o.viewportFit.initialAspect,r):!i&&a&&(o.fov=Da(o.fov,o.aspect,o.viewportFit.initialAspect)):o.fov=Da(o.fov,o.aspect,r),o.aspect=r}}else if(o.isOrthographicCamera){let i,a;switch(o.viewportFit.type){case 1:case 5:i=o.top*r,o.left=-i,o.right=i;break;case 2:case 4:a=o.right/r,o.bottom=-a,o.top=a;break;case 3:const s=(o.right-o.left)/(o.top-o.bottom)<o.viewportFit.initialAspect,l=r<o.viewportFit.initialAspect;i=s&&l?o.right:s&&!l?o.right*r/o.viewportFit.initialAspect:!s&&l?o.top*o.viewportFit.initialAspect:o.top*r,o.left=-i,o.right=i,o.bottom=-i/r,o.top=i/r}}o.updateProjectionMatrix()}}run(){this.preloader&&(this.preloader.onFinish(),this.preloader=null),this.animate()}animate(){const e=this;e.renderer.setAnimationLoop((function(){e.stats&&e.stats.begin();const t=e.clock.getDelta();e.elapsed=t,e.mixer&&e.mixer.update(t),e.controls&&!e.xrSession&&e.controls.update(t);const r=e.renderCallbacks;for(let o=0;o<r.length;o++)r[o](t,e.clock.elapsedTime);e.frame%e.frameRateDivider==0&&e.enableRender&&(e.render(),e.frame===0&&e.dispatchEvent({...Rbe})),e.frame++,e.disableRenderTrigger&&--e.disableRenderTrigger==0&&(e.enableRender=!1),e.stats&&e.stats.end()}))}enableRendering(){this.disableRenderTrigger=0,this.enableRender=!0,this.ssaaOnPause&&this.enableSSAA(0,!0)}disableRendering(e){this.xrSession||(((e=e||0)||this.ssaaOnPause)&&this.enableRender&&this.disableRenderTrigger==0?(this.disableRenderTrigger=this.ssaaOnPause?32:e,this.ssaaOnPause&&this.enableSSAA(4,!0)):e==0&&(this.enableRender=!1))}pause(){this.renderer.setAnimationLoop(null),this.clock.stop(),this.dispatchEvent({...Bbe})}resume(){this.animate(),this.clock.start(),this.dispatchEvent({...Nbe})}setFrameRateDivider(e){this.frameRateDivider=e}render(){this.dispatchEvent({...Pbe});const e=!!this.scene&&!!this.camera;if(e&&(this.scene.updateMatrixWorld(),this.scene.traverse((t=>{t.isPlaneReflectionProbe&&t.update(this.scene,this.camera,this.renderer)}))),this.renderer.gtaoMapEnabled=!0,this.postprocessing){const t=this.postprocessing.gtaoGenerator;t&&t.render(this.renderer),this.postprocessing.composer.render(this.elapsed)}else e&&this.renderer.render(this.scene,this.camera);if(e&&this.useHiDPIRenderPass){const t=this.camera.layers.mask,r=this.scene.background,o=this.renderer.autoClear,i=this.renderer.useOIT;this.camera.layers.set(7),this.scene.background=null,this.renderer.autoClear=!1,this.renderer.useOIT=!1,this.renderer.clearDepth(),this.renderer.render(this.scene,this.camera),this.camera.layers.mask=t,this.scene.background=r,this.renderer.autoClear=o,this.renderer.useOIT=i}this.cssRenderer&&this.cssRenderer.render(this.cssScene,this.camera),this.renderer.gtaoMapEnabled=!1,this.dispatchEvent({...Lbe})}enableControls(e){const t=this.camera;if(!t.controlSettings)return;const r=t.controlSettings.type;if(!(this.controls&&t===this.controls.object&&(this.controls instanceof Zb&&r==="ORBIT"||this.controls instanceof t3&&r==="FLYING"||this.controls instanceof e3&&r==="FIRST_PERSON")))switch(this.disableControls(),r){case"ORBIT":this.controls=new Zb(t,e||this.renderer.domElement);break;case"FLYING":this.controls=new t3(t,e||this.renderer.domElement);break;case"FIRST_PERSON":this.controls=new e3(t,e||this.renderer.domElement);break;default:this.controls=null}this.controls&&(t.controlSettings.assignToControls(this.controls,this.scene),this.controls.update())}disableControls(){this.controls&&(this.controls.dispose(),this.controls=null)}setCamera(e){let t=[];if(this.camera)for(let r=this.camera.children.length-1;r>=0;r--){const o=this.camera.children[r];o instanceof JP&&(t.push(o),o.removeFromParent())}if(this.camera=e,this.postprocessing){const r=this.postprocessing.composer.passes;for(let o=0;o<r.length;o++)r[o].setCamera(e);this.postprocessing.renderPass&&this.postprocessing.renderPass.setCamera(e),this.postprocessing.ssaaRenderPass&&this.postprocessing.ssaaRenderPass.setCamera(e),this.postprocessing.gtaoGenerator&&this.postprocessing.gtaoGenerator.setCamera(e)}e.controlSettings?this.enableControls():this.disableControls();for(let r=0;r<t.length;r++)e.add(t[r]);this.onResize()}getCamera(e=!1){return e&&this.camera&&this.renderer&&this.renderer.xr.enabled&&this.renderer.xr.isPresenting?this.renderer.xr.getCamera():this.camera}initPostprocessing(){(this.scene.postprocessing&&this.scene.postprocessing.length||this.useHDR||this.useHiDPIRenderPass||this.aaMethod!="AUTO"||this.renderer.useOIT)&&this.enablePostprocessing(this.scene.postprocessing||[]),this.renderer.useOIT&&(this.useHiDPIRenderPass?console.warn("v3d.App: Order-Independent Transparency is not compatible with HiDPI Compositing, disabling OIT"):this.renderer.setOIT(1,this.postprocessing.composer.writeBuffer.samples)),this.postprocessing||this._handleAlphaToCoverage(this.renderer.getContextAttributes().antialias?4:0)}enablePostprocessing(e){if(this.xrSession)return;if(!this.renderer.capabilities.isWebGL2)return void console.warn("v3d.App: postprocessing is only supported for WebGL 2.0");const t={format:1023,stencilBuffer:!1};let r;if(this.useHDR?(t.type=1016,t.encoding=3e3):(t.type=1009,t.encoding=3001),this._prepareReflProbesEncoding(this.scene,t.encoding),this.postprocessing)r=this.postprocessing.composer;else{this.postprocessing={};const o=new o1(this.scene,this.camera);this.postprocessing.renderPass=o;let i=0;switch(this.aaMethod){case"AUTO":case"MSAA4":i=this._checkMSAA(this.renderer,4);break;case"MSAA8":i=this._checkMSAA(this.renderer,8);break;case"MSAA16":i=this._checkMSAA(this.renderer,16)}nr.checkSwiftShader(this.renderer)&&(console.warn("v3d.App: disabling buggy multisampling on SwiftShader renderer"),i=0),nr.isSafariWithMultisamplingBug()&&(console.warn("v3d.App: disabling buggy multisampling on Safari 15.4"),i=0);const a=new nn(this.getWidth(),this.getHeight(),t);a.texture.name="EffectComposer.rt1",a.samples=i,r=new c3(this.renderer,a),r.addPass(o),this.postprocessing.composer=r;const s=new kb;if(r.addPass(s),this.postprocessing.toneMapPass=s,this.useHDR||(s.material.toneMapped=!1),i==0&&this.aaMethod!="NONE"){const l=new e1(this.scene,this.camera);r.addPass(l),this.postprocessing.fxaaPass=l}this._handleAlphaToCoverage(i)}e.length&&this.postprocessing.copyPass&&(r.passes.splice(r.passes.indexOf(this.postprocessing.copyPass),1),this.postprocessing.copyPass=null);for(let o=0;o<e.length;o++){const i=e[o];let a=r.passes.length-1;switch(r.passes[a]instanceof e1&&a--,i.type){case"afterimage":const s=i.damp;let l;this.postprocessing.afterimagePass?(l=this.postprocessing.afterimagePass,l.damp=s):(l=new xD(new be(this.getWidth(),this.getHeight()),s,t),r.insertPass(l,a),this.postprocessing.afterimagePass=l);break;case"bloom":const c=i.strength,u=i.radius,d=i.threshold;let f;this.postprocessing.bloomPass?(f=this.postprocessing.bloomPass,f.strength=c,f.radius=u,f.threshold=d):(f=new pl(new be(this.getWidth(),this.getHeight()),c,u,d,t),r.insertPass(f,a),this.postprocessing.bloomPass=f);break;case"brightnessContrast":let h;this.postprocessing.brightnessContrastPass?h=this.postprocessing.brightnessContrastPass:(h=new Lb,r.insertPass(h,a),this.postprocessing.brightnessContrastPass=h),h.brightness=i.brightness,h.contrast=i.contrast;break;case"dof":let p;this.postprocessing.bokehPass?p=this.postprocessing.bokehPass:(p=new Rb(this.scene,this.camera,{width:this.getWidth(),height:this.getHeight()}),r.insertPass(p,a),this.postprocessing.bokehPass=p),p.focus=i.focus,p.aperture=i.aperture,p.maxblur=i.maxblur,p.depthLeakThreshold=i.depthLeakThreshold;break;case"grayscale":if(!this.postprocessing.grayscalePass){const b=new Pb;r.insertPass(b,a),this.postprocessing.grayscalePass=b}break;case"gtao":if(!nr.checkDepthTex(this.renderer)){console.warn("v3d.App: disabling GTAO since your hardware does not support depth textures");break}if(nr.getGPUVendor(this.renderer)==="ARM"&&nr.getGPUModel(this.renderer).startsWith("Mali-")){console.warn("v3d.App: disabling buggy GTAO on Mali devices");break}let m=this.postprocessing.gtaoGenerator;if(!m){m=this.postprocessing.gtaoGenerator=new zB(this.scene,this.camera,this.getWidth(),this.getHeight());const b=E=>{m.removeEventListener("dispose",b),this.renderer.disposeGTAO()};m.addEventListener("dispose",b),this.renderer.gtaoMap=m.renderTarget.texture}m.distance=i.distance,m.factor=i.factor,m.precision=i.precision,m.bentNormals=i.bentNormals;break;case"outline":let g;this.postprocessing.outlinePass?g=this.postprocessing.outlinePass:(g=new Ma(new be(this.getWidth(),this.getHeight()),this.scene,this.camera),r.insertPass(g,a),this.postprocessing.outlinePass=g),g.edgeStrength=i.edgeStrength,g.edgeGlow=i.edgeGlow,g.edgeThickness=i.edgeThickness,g.pulsePeriod=i.pulsePeriod,g.visibleEdgeColor.fromArray(i.visibleEdgeColor),g.hiddenEdgeColor.fromArray(i.hiddenEdgeColor),g.hiddenEdgeColor.setW(Number(i.renderHiddenEdge));break;case"ssr":if(!nr.checkHalfFloatTex(this.renderer,!1)){console.warn("v3d.App: disabling SSR since your hardware does not support half float textures");break}const _=_e(i.useRefract)&&i.useRefract,A=_e(i.simpleRefraction)&&i.simpleRefraction;let y;y=_&&!A?this.postprocessing.ssrPassRefract:_&&A?this.postprocessing.ssrPassSimpleRefract:this.postprocessing.ssrPassReflect,y||(y=new RD(this.scene,this.camera),r.insertPassAfter(y,[this.postprocessing.renderPass,this.postprocessing.ssrPassRefract,this.postprocessing.ssrPassReflect,this.postprocessing.ssrPassSimpleRefract]),_&&!A?this.postprocessing.ssrPassRefract=y:_&&A?this.postprocessing.ssrPassSimpleRefract=y:this.postprocessing.ssrPassReflect=y),y.useRefract=_,y.simpleRefraction=A,_e(i.objects)&&(y.objects=i.objects),_e(i.intensity)&&(y.intensity=i.intensity),_e(i.steps)&&(y.steps=i.steps),_e(i.stride)&&(y.stride=i.stride),_e(i.binarySearchSteps)&&(y.binarySearchSteps=i.binarySearchSteps),_e(i.renderTargetScale)&&(y.renderTargetScale=i.renderTargetScale),_e(i.thickness)&&(y.thickness=i.thickness),_e(i.maxDistance)&&(y.maxDistance=i.maxDistance),_e(i.jitter)&&(y.jitter=i.jitter),_e(i.renderAfter)&&(y.renderAfter=i.renderAfter),this.onResize&&this.onResize();break;default:console.error(`v3d.App: wrong postprocessing effect "${i.type}"`)}}if(r.passes.length==1){const o=new bs(Tt.copy);r.passes.push(o),this.postprocessing.copyPass=o}}disablePostprocessing(e,t){if(!this.postprocessing)return;const r=this.postprocessing.gtaoGenerator;!t&&r&&(r.dispose(),this.postprocessing.gtaoGenerator=null);const o=["afterimagePass","bloomPass","brightnessContrastPass","bokehPass","grayscalePass","ssrPassReflect","ssrPassRefract","ssrPassSimpleRefract"];e||o.push("outlinePass");const i=this.postprocessing.composer;for(let a=0;a<o.length;a++){const s=o[a];this.postprocessing[s]&&(i.passes.splice(i.passes.indexOf(this.postprocessing[s]),1),this.postprocessing[s].dispose(),this.postprocessing[s]=null)}if(this.aaMethod!="AUTO"||i.passes.length!=1||this.postprocessing.gtaoGenerator){if(i.passes.length==1){const a=new bs(Tt.copy);i.passes.push(a),this.postprocessing.copyPass=a}}else this.postprocessing.renderPass.dispose(),this.postprocessing.composer.dispose(),this.postprocessing=null}enableSSAA(e,t){if(this.postprocessing||this.enablePostprocessing([]),!this.postprocessing||e>0&&(this.postprocessing.ssrPassRefract||this.postprocessing.ssrPassReflect))return;const r=this;this.scene.traverse((function(i){i.isAnnotationControl&&(i.update(r.camera),i.doUpdate=!e)}));const o=this.postprocessing.composer;if(e>0&&o.passes[0]instanceof o1){let i;this.postprocessing.ssaaRenderPass?i=this.postprocessing.ssaaRenderPass:(i=new Fh(this.scene,this.camera),this.postprocessing.ssaaRenderPass=i,t&&i.addEventListener("iteration",(function(a){a.frame==e*e-1&&(o.enableAllPasses(),o.renderToScreen=!0,o.passes[o.passes.length-1].renderToScreen=!0,r.disableRenderTrigger=1)}))),i.sampleLevel=e||4,o.passes[0]=i,this.postprocessing.fxaaPass&&o.passes.splice(o.passes.length-1,1),t&&(i.iterative=!0,i.iterativeFrame=0,o.disableAllPasses(),o.renderToScreen=!1,i.enabled=!0)}else e>0?(o.passes[0].sampleLevel=e||4,t&&(ssaaRenderPass.iterative=!0,ssaaRenderPass.iterativeFrame=0,o.disableAllPasses(),o.renderToScreen=!1,ssaaRenderPass.enabled=!0)):e==0&&o.passes[0]instanceof Fh&&(o.passes[0]=this.postprocessing.renderPass,this.postprocessing.fxaaPass&&o.passes.push(this.postprocessing.fxaaPass),o.enableAllPasses(),o.renderToScreen=!0)}updateEnvironment(e){const t=this.renderer.xr.enabled;if(this.renderer.xr.enabled=!1,this.disposeEnvironment(),e.toneMapped=!1,this.scene.background!==null){const r=this.renderer.toneMapping===0?e.worldMaterialColor():null;r!==null?this.scene.background=r:(this.scene.background=A6(this.renderer,e,this.worldCubemapRes,{encoding:3001,format:1023,generateMipmaps:!0,minFilter:1008,type:1016}).texture,this.scene.backgroundToneMapped=!this.useHDR)}this._envIBLMode===0&&new gh(this.renderer,this._pmremMaxTileSize,!0).compileCubemapShader(),this._prepareEnvMapProbeWorld(),this.renderer.xr.enabled=t}disposeEnvironment(){this._disposeEnvLightProbe();let e=this.scene.background;e&&e&&(e.isTexture||e.isCubeTexture)&&e.dispose()}_disposeEnvLightProbe(){this._envLightProbe!==null&&(this.scene.remove(this._envLightProbe),this._envLightProbe=null)}updateReflectionProbes(e){e.traverse((t=>{t.isCubeReflectionProbe&&t.update(this.scene,this.renderer)}))}generateRTargetPMREM(e){if(!e.isWebGLCubeRenderTarget)return null;const t=new gh(this.renderer,this._pmremMaxTileSize,!0),r=t.fromCubemap(e.texture);return t.dispose(),r}initWebXR(e,t,r,o,i,a){r=r||function(){},o=o||function(){},i=i||function(){},a=a||{};const s=this;function l(f){s.xrSession.removeEventListener("end",l),i();for(let h=0;h<s.xrControllers.length;h++){const p=s.xrControllers[h];p.removeEventListener("connected",c),s.scene.remove(p)}if(s.xrControllers=[],s.xrCameraParent){const h=s.camera;h.removeFromParent(),s.scene.add(h),s.scene.remove(s.xrCameraParent),s.xrCameraParent=null}if(s.xrSession=null,s._webxrSave.background&&(s.scene.background=s._webxrSave.background,s._webxrSave.background=null),s.postprocessing=s._webxrSave.postprocessing,s._webxrSave.postprocessing=null,s.postprocessing){const h=s.postprocessing.gtaoGenerator;h&&(s.renderer.gtaoMap=h.renderTarget.texture)}s.renderer.useOIT=s._webxrSave.useOIT,s._webxrSave.useOIT=!1,s.onResize()}function c(f){const h=f.data,p=f.target;if(h.targetRayMode=="tracked-pointer"){const m=new At().setFromPoints([new N(0,0,0),new N(0,0,-1)]),g=new Ki(m);g.name=p.name+"_RAY",g.scale.z=5,p.add(g)}else if(h.targetRayMode=="gaze"){const m=new gb().load(b2e),g=new H2({map:m,sizeAttenuation:!1}),_=new VL(g);_.name=p.name+"_RETICLE",_.scale.multiplyScalar(.1),_.position.z=-5,p.add(_)}p.userData.inputSource=h}function u(f){const h=f.target;s.xrSession||h.removeEventListener("disconnected",u);for(let p=h.children.length-1;p>=0;p--){const m=h.children[p];m.name.indexOf(h.name)>-1&&(m.geometry.dispose(),m.material.dispose(),h.remove(m))}}const d={optionalFeatures:[t]};e=="immersive-ar"&&(d.optionalFeatures.push("hit-test"),a.domOverlay&&(d.optionalFeatures.push("dom-overlay"),d.domOverlay={root:s.container})),navigator.xr.requestSession(e,d).then((function(f){s._webxrSave.postprocessing=s.postprocessing,s.postprocessing=null,s._webxrSave.useOIT=s.renderer.useOIT,s.renderer.useOIT=!1,s.renderer.xr.setReferenceSpaceType(t),s.xrSession=f,f.addEventListener("end",l);const h=e=="immersive-vr"?2:1;for(let p=0;p<h;p++){const m=s.renderer.xr.getController(p);s.scene.add(m),s.xrControllers.push(m),m.addEventListener("connected",c),m.addEventListener("disconnected",u)}if(e=="immersive-vr"){const p=s.camera;p.parent&&p.parent.isScene&&(s.xrCameraParent=new kt,s.xrCameraParent.name="XR_CAMERA_CONTROL_OBJECT",s.scene.add(s.xrCameraParent),p.removeFromParent(),s.xrCameraParent.add(p))}else s._webxrSave.background=s.scene.background,s.scene.background=null;s.renderer.xr.enabled=!0,s.renderer.xr.setSession(f),a.domOverlay&&s.renderer.xr.addEventListener("sessionstart",(function(){setTimeout((function(){s.renderer.domElement.style.width=s.getWidth()+"px",s.renderer.domElement.style.height=s.getHeight()+"px"}),300)})),r()})).catch(o)}endWebXR(){this.xrSession&&this.xrSession.end()}printPerformanceInfo(e){vo.printPerformanceInfo(this,e)}showFPS(){if(this.container){this.hideFPS();const e=new hd;e.showPanel(0),this.container.appendChild(e.dom),this.stats=e}}hideFPS(){this.container&&this.stats&&(this.container.removeChild(this.stats.dom),this.stats=null)}enableCSSRenderer(){this.cssRenderer=new v6(this.container),this.cssRenderer.setSize(this.getWidth(),this.getHeight()),this.cssScene=new jr,this.controls&&(this.disableControls(),this.enableControls(this.container),this.controls.allowMouseOverIframes=!0),this.renderer&&(this.renderer.domElement.style.pointerEvents="none")}disableCSSRenderer(){if(this.cssRenderer&&(this.cssRenderer=null,this.controls&&(this.disableControls(),this.enableControls(),this.controls.allowMouseOverIframes=!1),this.renderer&&(this.renderer.domElement.style.pointerEvents="auto"),this.cssScene)){const e=[];this.cssScene.traverse((t=>{e.push(t)})),e.forEach((t=>{t.removeFromParent()})),this.cssScene=null}}enableDebugMode(e){this.hasDebugMode(e)&&this.disableDebugMode(e),this.scene.traverse((t=>{let r=null,o=!1;if(!this._debugHelpers.includes(t)&&!this._debugHelpers.includes(t.parent)){if(e=="wireframes"&&t.isMesh)r=new y2e(t,"white");else if(e=="lights")t.isDirectionalLight?(r=new AD(t,.5,"yellow"),o=!0):t.isSpotLight?(r=new dD(t,"yellow"),o=!0):t.isPointLight?(r=new pD(t,.1,"yellow"),o=!0):t.isRectAreaLight&&(r=new v2e(t,"yellow"));else if(e=="skeletons"&&t.isBone){let i=!1;t.traverseAncestors((a=>{a.isBone&&(i=!0)})),i||(r=new fD(t))}else e=="normals"&&t.isMesh&&(r=new A2e(t,.1));r!==null&&(r.name=t.name+"Helper",r.visible=t.visible,t.add(r),o&&r.update(),this._debugHelpers.push(r),this._debugModes.add(e))}}))}disableDebugMode(e){const t={wireframes:["WireframeHelper"],lights:["DirectionalLightHelper","SpotLightHelper","PointLightHelper","RectAreaLightHelper"],skeletons:["SkeletonHelper"],normals:["VertexNormalsHelper"]};for(let r=this._debugHelpers.length-1;r>=0;r--){const o=this._debugHelpers[r];t[e].includes(o.type)&&(o.removeFromParent(),this._debugHelpers.splice(r,1))}this._debugModes.delete(e)}hasDebugMode(e){return this._debugModes.has(e)}}function kbe(){console.error("v3d.SSAOPass has been removed, use v3d.GTAOMapGenerator instead")}function Fbe(){console.error("v3d.BlenderTextGeometry has been removed, use v3d.TextGeometry instead.")}function Vbe(){console.error("v3d.BlenderTextBufferGeometry has been removed, use v3d.TextGeometry instead.")}function Ube(){console.error("v3d.AnimationLoader has been removed, use glTF format for asset loading.")}function zbe(){console.error("v3d.BufferGeometryLoader has been removed, use glTF format for asset loading.")}function Gbe(){console.error("v3d.MaterialLoader has been removed, use glTF format for asset loading.")}function Hbe(){console.error("v3d.ObjectLoader has been removed, use glTF format for asset loading.")}class Wbe extends O0{constructor(e){console.error("v3d.MeshPhongMaterial has been removed, use node-based or standard material instead."),super(e)}}class jbe extends O0{constructor(e){console.error("v3d.MeshToonMaterial has been removed, use node-based material instead."),super(e)}}class Qbe extends O0{constructor(e){console.error("v3d.MeshMatcapMaterial has been removed, use node-based material instead."),super(e)}}At.prototype.toJSON=function(){return console.error("v3d.BufferGeometry.toJSON() has been removed, use glTF format for export."),{}},kt.prototype.toJSON=function(){return console.error("v3d.Object3D.toJSON() has been removed, use glTF format for export."),{}},Nr.prototype.toJSON=function(){return console.error("v3d.Material.toJSON() has been removed, use glTF format for export."),{}},Object.defineProperty(ab.prototype,"iridescence",{get:()=>(console.warn("v3d.MeshPhysicalMaterial: iridescence has been removed, use node-based material instead."),0),set(n){console.warn("v3d.MeshPhysicalMaterial: iridescence has been renamed, use node-based material instead.")}}),Object.defineProperty(ab.prototype,"sheen",{get:()=>(console.warn("v3d.MeshPhysicalMaterial: sheen has been removed, use node-based material instead."),0),set(n){console.warn("v3d.MeshPhysicalMaterial: sheen has been renamed, use node-based material instead.")}}),ta.nodeGraphDiffuse=function(n,e,t){return console.error("v3d.MeshNodeMaterial.nodeGraphDiffuse has been deprecated. Use v3d.MaterialUtils.createDiffuseMaterial instead."),i3("",n,e,t).nodeGraph};const $be=2,Ybe=2;function Xbe(){console.error("v3d.InterleavedBufferAttribute has been removed, use tightly packed buffers instead.")}function qbe(){console.error("v3d.InstancedInterleavedBuffer has been removed, use tightly packed buffers instead.")}function Kbe(){console.error("v3d.InterleavedBuffer has been removed, use tightly packed buffers instead.")}var hN={calcCameraZoomToObjectsParams:(function(){var n=new Tn,e=new ni;return function(t,r,o,i,a){var s=n.makeEmpty();r.forEach((function(c){s.expandByObject(c)}));var l=s.getBoundingSphere(e);hN.calcCameraZoomToSphereParams(t,l,o,i,a)}})(),calcCameraZoomToSphereParams:(function(){const n=new N;return function(e,t,r,o,i){if(e.isOrthographicCamera){let a=Math.min(e.top,e.right);i[0]=a/t.radius,r.setFromMatrixPosition(e.matrixWorld),o.copy(t.center)}else{let a=ih(e.fov/2);e.aspect<1&&(a=Math.atan(e.aspect*Math.tan(a)));let s=t.radius/Math.sin(a);const l=e.getWorldDirection(n);r.copy(t.center).addScaledVector(l,-s),o.copy(t.center)}}})()},X1={normalizeDialectOptions:function(n){var e={delimiter:",",doublequote:!0,lineterminator:`
`,quotechar:'"',skipinitialspace:!0,skipinitialrows:0};for(var t in n)e[t.toLowerCase()]=n[t];return e},parse:function(n,e){(!e||e&&!e.lineterminator)&&(n=X1.normalizeLineTerminator(n,e));var t=X1.normalizeDialectOptions(e);n=X1.chomp(n,t.lineterminator);var r,o,i="",a=!1,s=!1,l="",c=[],u=[];for(o=function(d){var f=String.prototype.trim?function(h){return h.trim()}:function(h){return h.replace(/^\s*/,"").replace(/\s*$/,"")};return s!==!0&&(d===""?d=null:t.skipinitialspace===!0&&(d=f(d)),/^\d+$/.test(d)?d=parseInt(d,10):/^\d*\.\d+$|^\d+\.\d*$/.test(d)&&(d=parseFloat(d,10))),d},r=0;r<n.length;r+=1)i=n.charAt(r),a!==!1||i!==t.delimiter&&i!==t.lineterminator?i!==t.quotechar?l+=i:a?n.charAt(r+1)===t.quotechar?(l+=t.quotechar,r+=1):a=!1:(a=!0,s=!0):(l=o(l),c.push(l),i===t.lineterminator&&(u.push(c),c=[]),l="",s=!1);return l=o(l),c.push(l),u.push(c),t.skipinitialrows&&(u=u.slice(t.skipinitialrows)),u},normalizeLineTerminator:function(n,e){return(e=e||{}).lineterminator?n:n.replace(/(\r\n|\n|\r)/gm,`
`)},chomp:function(n,e){return n.charAt(n.length-e.length)!==e?n:n.substring(0,n.length-e.length)}};const q1=new N(1,0,0),Zbe=new N,Jbe=new N,e3e=new It;class t3e extends Mt{constructor(e,t){e=e!==void 0?e:new Ge(1,0,0),t=t!==void 0?t:2;const r=new rd;r.setGeometry([0,0,0,q1.x,q1.y,q1.z]);const o=new sb({color:e,lineWidth:t,sizeAttenuation:0});super(r.geometry,o),this.isLineHTML=!0,this.elemHTML=null,this.offset=5}onBeforeRender(e,t,r,o,i,a){if(super.onBeforeRender(),!this.elemHTML)return;const s=e.domElement.offsetWidth,l=e.domElement.offsetHeight,c=this.elemHTML.getBoundingClientRect(),u=e.domElement.getBoundingClientRect(),d=c.left-u.left,f=c.right-u.left,h=c.top-u.top,p=c.bottom-u.top,m=(d+f)/2,g=(h+p)/2,_=this.getWorldPosition(Zbe).project(r),A=(_.x+1)/2*s,y=(1-_.y)/2*l,b=(g-y)/(m-A),E=(c.height+2*this.offset)/(c.width+2*this.offset);let x,w;Math.abs(b)>E?(w=y>g?Math.min(p+this.offset,y):Math.max(h-this.offset,y),x=(w-y)/b+A):(x=A<m?Math.max(d-this.offset,A):Math.min(f+this.offset,A),w=(x-A)*b+y);const L=2*x/s-1,C=1-2*w/l,P=Jbe.set(L,C,-1);P.unproject(r),this.parent&&this.parent.worldToLocal(P);const D=P.length();this.scale.setScalar(D),P.normalize();const Q=e3e.setFromUnitVectors(q1,P);this.setRotationFromQuaternion(Q),this.updateMatrixWorld()}}function Cc(){}Object.assign(Cc.prototype,{onUpdate:function(n){},onFinish:function(){}});class pN extends Cc{constructor(e){super();for(let t in e){const r=e[t];t==="container"&&(r===void 0?this.container=document.body:r instanceof HTMLElement?this.container=r:this.container=document.getElementById(r))}this.bar=document.createElement("div"),this.bar.setAttribute("class","v3d-simple-preloader-bar"),this.logo=document.createElement("div"),this.logo.setAttribute("class","v3d-simple-preloader-logo"),this.logoCont=document.createElement("div"),this.logoCont.setAttribute("id","v3d_preloader_container"),this.logoCont.setAttribute("class","v3d-simple-preloader-container"),this.background=document.createElement("div"),this.background.setAttribute("class","v3d-simple-preloader-background"),this.background.appendChild(this.logoCont),this.logoCont.appendChild(this.logo),this.logoCont.appendChild(this.bar),this.container.appendChild(this.background),this.clock=new Ca}onUpdate(e){super.onUpdate(e),e=Math.round(e),this.bar.style.width=e+"%"}onFinish(){super.onFinish(),this.container.removeChild(this.background)}}const n3e="puzzles.min.js";class r3e{_logicFileLoadError(e){const t=new Error(e);return t.name="LogicFileLoadError",t}_editorLoadError(e){const t=new Error(e);return t.name="EditorLoadError",t}async _getLogicPromise(e){var o,i,a;const t=ch(),r=new URL(e,document.baseURI).href;try{const s=(i=(o=await import(r)).createPL)==null?void 0:i.call(o);return await((a=s==null?void 0:s.loadPhysics)==null?void 0:a.call(s)),s??t.v3d.PL??null}catch{throw this._logicFileLoadError(`Unable to load the logic file: '${r}'.`)}}_getEditorPromise(e,t){const r=this;return new Promise((function(o,i){vo.loadScript(e,document.body,(function(){o()}),(function(){i(r._editorLoadError("Unable to load the Puzzles Editor: '"+e+"'."))}))}))}async _getLogicViaEditorPromise(e,t){const r=ch();if(!r.v3d||!r.v3d.PE)throw this._editorLoadError("Unable to load Puzzles' logic. The Puzzles Editor isn't loaded.");const o=t.split(".");o[o.length-1]="xml";const i=o.join("."),{PL:a,logicXMLLoaded:s}=await r.v3d.PE.init(e,i);if(!s)throw this._logicFileLoadError(`Unable to load the Puzzles Editor's XML logic file: '${i}'.`);return a}_getAmmoJSPromise(){const e=document.getElementsByTagName("script");let t=!1;for(let r=e.length-1;r>=0;--r)if(e[r].src.search(/ammo.wasm.js/)>-1){t=!0;break}return new Promise((function(r,o){t&&window.Ammo?(console.warn("You have ammo.wasm.js assigned in app html, please remove it"),r()):t&&!window.Ammo?(console.warn("You have ammo.wasm.js assigned in app html, please remove it and resave Puzzles"),import(Gg("ammo.wasm.js")).then((a=>{let s=a.default;s?new s().then((l=>{window.Ammo=l,r()})):o(new Error("Failed to load physics module"))}))):r()}))}async loadLogic(e,t,r){try{const o=await this._getLogicPromise(e);return await this._getAmmoJSPromise(),t&&t(),o}catch(o){console.error(o),r&&r(o)}}async loadEditorWithLogic(e,t,r,o){try{let i=null;await this._getEditorPromise(e+n3e);try{i=await this._getLogicViaEditorPromise(e,t)}catch(a){if(a.name!=="LogicFileLoadError")throw a}return await this._getAmmoJSPromise(),r&&r(),i}catch(i){console.error(i),o&&o(i)}}}function K1(n){Mt.call(this),this.type="CubeTextureHelper",this.geometry=new nc(2,2,2,1,1,1),this.geometry.computeBoundingSphere(),this.material=new pr,this.material.envMap=n}K1.prototype=Object.create(Mt.prototype),K1.prototype.constructor=K1;class mN extends kt{constructor(e){super(),this.isAnnotationControl=!0,this.doUpdate=!0,this.projected=new N,this.container=e,this.updatedCallback=null}clone(){return new this.constructor(this.container).copy(this)}update(e){if(this.doUpdate){var t=this.projected;this.getWorldPosition(t).project(e);var r=this.container.offsetWidth,o=this.container.offsetHeight,i=(.5+t.x/2)*r,a=(.5-t.y/2)*o;t.x=i,t.y=a;var s=t.z<=1&&i>=0&&i<=r&&a>=0&&a<=o;this.visible=s,this.updatedCallback&&this.updatedCallback(t.x,t.y,s)}}}var ax=new _0,Z1=new N,sx=new N,gN=new N;class o3e extends mN{constructor(e,t,r){super(e),this.isAnnotation=!0,this.type="Annotation",this.character=t,this.dialogContents=r,this.annotation=document.createElement("div"),this.annotation.innerHTML=t,this.annotation.className="v3d-annotation",this.container.appendChild(this.annotation),this.annotationDialogVisible=!1,this.annotationDialog=document.createElement("div"),this.annotationDialog.innerHTML=r,this.annotationDialog.className="v3d-annotation-dialog",this.annotation.appendChild(this.annotationDialog),this.fadeObscured=!0,this.obscured=!1;var o=!1,i=this;function a(s){s.target==i.annotation?i.annotationDialog.innerHTML.length==0||i.obscured||(i.annotationDialogVisible=!i.annotationDialogVisible,i.annotationDialog.style.visibility=i.annotationDialogVisible?"visible":"hidden",i.annotationDialogVisible?i.annotation.style.zIndex="2":i.annotation.style.zIndex="1"):s.target.className.indexOf("v3d-annotation")>-1&&(i.annotationDialogVisible=!1,i.annotationDialog.style.visibility="hidden",i.annotation.style.zIndex=i.obscured?"auto":"1")}this._touchstartCb=function(s){a(s),o=!0},document.body.addEventListener("touchstart",this._touchstartCb,!1),this._mousedownCb=function(s){o||a(s),o=!1},document.body.addEventListener("mousedown",this._mousedownCb,!1)}raycast(){}clone(){return new this.constructor(this.container,this.character,this.dialogContents).copy(this)}update(e){if(super.update(e),this.doUpdate){var t=this.projected,r=this.annotation;if(r.style.transform="translate("+t.x+"px, "+t.y+"px)",r.style.visibility=this.visible?"visible":"hidden",this.annotationDialog.style.visibility=this.visible&&this.annotationDialogVisible?"visible":"hidden",this.fadeObscured){e.getWorldPositionNU(Z1),this.getWorldPositionNU(sx),gN.copy(sx).sub(Z1).normalize(),ax.set(Z1,gN),ax.far=Z1.distanceTo(sx);var o=ax.intersectObject(this.findRoot(),!0);o.length>1||o.length==1&&o[0].object!=this.parent?(r.classList.add("v3d-annotation-transparent"),this.obscured=!0,r.style.zIndex="auto",this.annotationDialog.style.visibility="hidden"):(r.classList.remove("v3d-annotation-transparent"),r.style.zIndex=this.annotationDialog.style.visibility=="visible"?"2":"1",this.obscured=!1)}}}setDialogVisibility(e){e?(this.annotationDialogVisible=!0,this.annotationDialog.style.visibility="visible",this.annotation.style.zIndex="2"):(this.annotationDialogVisible=!1,this.annotationDialog.style.visibility="hidden",this.annotation.style.zIndex="1")}dispose(){var e=this.annotation.parentElement;e&&e.removeChild(this.annotation),document.body.removeEventListener("touchstart",this._touchstartCb,!1),document.body.removeEventListener("mousedown",this._mousedownCb,!1)}}const _N=new N,J1=new It,i3e=new It;function a3e(n,e,t){const r=n.parent;r&&!r.isScene&&(_N.copy(e).applyQuaternion(n.quaternion).applyQuaternion(r.quaternion),r.position.add(_N.multiplyScalar(t)))}function s3e(n,e,t){const r=n.parent;r&&!r.isScene&&(J1.setFromAxisAngle(e,t),J1.premultiply(n.quaternion),J1.premultiply(r.quaternion),r.quaternion.multiplyQuaternions(J1,i3e.copy(n.quaternion).invert()))}var l3e=Object.freeze({__proto__:null,rotateVRCamera:s3e,translateVRCamera:a3e}),c3e=`.v3d-container {overflow: hidden;z-index: 0;}.v3d-canvas {position: absolute;top: 0;bottom: 0;left: 0;right: 0;z-index: -1;}.v3d-simple-preloader-background {background-color: #fff;position: absolute;top: 0;bottom: 0;left: 0;right: 0;z-index: 1;height: 100%;width: 100%;}.v3d-simple-preloader-container {--v3d-preloader-img-width: 120px;--v3d-preloader-img-height: 120px;position: absolute;top: 50%;left: 50%;transform: translate(-50%, -50%);width: calc(var(--v3d-preloader-img-width) + 60px);height: calc(var(--v3d-preloader-img-height) + 60px);}.v3d-simple-preloader-bar {background: linear-gradient(90deg, #1458ae, #4388e0);width: 0%;height: 3px;margin: 15px -1px;border: 1px solid;border-radius: 50px;border-color: #2b70c7;}.v3d-simple-preloader-logo {width: var(--v3d-preloader-img-width);height: var(--v3d-preloader-img-height);background-image: url('data:image/svg+xml,%3C%3Fxml version="1.0" encoding="UTF-8" standalone="no"%3F%3E%3Csvg width="120" height="120" viewBox="0 0 31.75 31.75" version="1.1" id="svg5409" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns%23" xmlns:cc="http://creativecommons.org/ns%23" xmlns:dc="http://purl.org/dc/elements/1.1/"%3E%3Cdefs id="defs5403"%3E%3ClinearGradient xlink:href="%23linearGradient3077" id="linearGradient4375" gradientUnits="userSpaceOnUse" x1="172.91336" y1="78.689407" x2="193.7847" y2="53.806618" gradientTransform="matrix(1.1562901,0,0,1.1583991,-194.29093,208.80811)" /%3E%3ClinearGradient id="linearGradient3077"%3E%3Cstop style="stop-color:%230048a5;stop-opacity:1" offset="0" id="stop3073" /%3E%3Cstop style="stop-color:%234b86d1;stop-opacity:1" offset="1" id="stop3075" /%3E%3C/linearGradient%3E%3C/defs%3E%3Cmetadata id="metadata5406"%3E%3Crdf:RDF%3E%3Ccc:Work rdf:about=""%3E%3Cdc:format%3Eimage/svg+xml%3C/dc:format%3E%3Cdc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage" /%3E%3C/cc:Work%3E%3C/rdf:RDF%3E%3C/metadata%3E%3Cg id="layer1" transform="translate(0,-270.54167)"%3E%3Cpath style="display:inline;fill:url(%23linearGradient4375);fill-opacity:1;stroke:none;stroke-width:0.9171;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" d="m 15.945207,270.5417 c -1.669933,-0.007 -3.344811,1.1051 -7.2273169,3.32785 -7.76503612,4.4455 -7.2281318,3.52338 -7.2677439,12.48309 -0.03948,8.95973 -0.56829626,8.03286 7.1571159,12.5471 7.7254249,4.51422 6.6598479,4.50948 14.4248479,0.064 7.765036,-4.4455 7.228132,-3.52338 7.267744,-12.48309 0.03948,-8.95973 0.568296,-8.03287 -7.157116,-12.5471 -3.862718,-2.25711 -5.527635,-3.38445 -7.197531,-3.39185 z m -0.0132,2.85167 c 1.6836,0.007 3.363685,0.8128 6.115359,2.4207 5.503323,3.21577 6.107199,4.27438 6.078963,10.65695 -0.02832,6.3826 -0.641388,7.43578 -6.172923,10.60259 -5.531523,3.16682 -6.748576,3.16139 -12.2518993,-0.0544 -5.503299,-3.21578 -6.1071633,-4.27439 -6.0789633,-10.65697 0.02844,-6.38259 0.6413884,-7.43577 6.1729353,-10.6026 2.7657613,-1.5834 4.4529153,-2.37377 6.1365283,-2.3663 z m -0.154249,1.6177 c -2.694169,0.0343 -5.683359,3.07006 -7.236352,6.07548 -1.5776528,3.05311 -2.4803533,5.94456 -2.1086051,9.65753 0.1618801,1.61652 1.6983849,3.67982 3.5378539,4.71425 -0.3909602,-3.2062 -0.1707481,-6.34306 0.5400002,-8.94693 0.71076,-2.60387 2.83223,-6.82883 5.337159,-6.82316 2.504954,0.006 4.626375,4.22704 5.337123,6.83091 0.710725,2.60386 0.930961,5.74073 0.539989,8.94693 1.839481,-1.03442 3.375985,-3.09779 3.537853,-4.71432 0.371749,-3.71296 -0.53082,-6.60428 -2.108485,-9.6574 -1.547604,-2.99499 -4.52153,-6.01988 -7.24846,-6.08267 -0.0426,-9.5e-4 -0.08532,-10e-4 -0.128028,-6.2e-4 z m 0.131713,8.9184 a 2.4731483,2.4776591 0 0 0 -1.188637,0.29153 2.4731483,2.4776591 0 0 0 -1.017889,3.35228 2.4731483,2.4776591 0 0 0 3.34619,1.01974 2.4731483,2.4776591 0 0 0 1.017877,-3.35231 2.4731483,2.4776591 0 0 0 -2.157541,-1.31124 z" id="path4130" /%3E%3C/g%3E%3C/svg%3E');background-size: 100% 100%;background-repeat: no-repeat;margin: 20px auto;}.v3d-annotation {position: absolute;top: -0.7em;left: -0.5em;width: auto;min-width: 1em;height: 1.4em;padding: 0.3em 0.5em;border: 1px solid #fff;border-radius: 2em;font-size: 16px;font-family: sans-serif;line-height: 1.4em;color: #fff;text-align: center;user-select: none;background: rgba(0, 0, 0, 0.8);}.v3d-annotation-transparent {opacity: 0.5;}.v3d-annotation-dialog {position: absolute;top: 85%;left: 85%;font-family: sans-serif;user-select: none;padding: 1em;min-width: 200px;color: #fff;background: rgba(0, 0, 0, 0.8);border-radius: 1em;font-size: 12px;line-height: 1.2;transition: opacity .5s;visibility: hidden;}.v3d-mobile-forward {position: absolute;width: 62px;height: 62px;bottom: 31px;left: 50%;margin-left: -31px;background-image: url('data:image/svg+xml,%3C%3Fxml version="1.0" encoding="UTF-8" standalone="no"%3F%3E%3Csvg width="62" height="62" viewBox="0 0 16.404167 16.404167" version="1.1" id="svg2719" sodipodi:docname="move_forward.svg" inkscape:version="1.1.2 (b8e25be833, 2022-02-05)" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns%23" xmlns:cc="http://creativecommons.org/ns%23" xmlns:dc="http://purl.org/dc/elements/1.1/"%3E%3Csodipodi:namedview id="namedview7548" pagecolor="%23505050" bordercolor="%23eeeeee" borderopacity="1" inkscape:pageshadow="0" inkscape:pageopacity="0" inkscape:pagecheckerboard="0" showgrid="false" inkscape:snap-global="false" inkscape:zoom="7.1451613" inkscape:cx="42.266366" inkscape:cy="15.814898" inkscape:window-width="1920" inkscape:window-height="1137" inkscape:window-x="-8" inkscape:window-y="-8" inkscape:window-maximized="1" inkscape:current-layer="svg2719" /%3E%3Cdefs id="defs2713"%3E%3ClinearGradient gradientTransform="translate(-524.2581,-935.78503)" xlink:href="%23linearGradient2768" id="linearGradient2673" x1="501.88306" y1="942.95502" x2="508.08038" y2="935.61182" gradientUnits="userSpaceOnUse" /%3E%3ClinearGradient id="linearGradient2768"%3E%3Cstop style="stop-color:%23414141;stop-opacity:1" offset="0" id="stop2764" /%3E%3Cstop style="stop-color:%23767676;stop-opacity:1" offset="1" id="stop2766" /%3E%3C/linearGradient%3E%3ClinearGradient gradientTransform="translate(-521.96226,-941.8579)" xlink:href="%23linearGradient2648" id="linearGradient2665" x1="495.62714" y1="948.00964" x2="508.85629" y2="934.78046" gradientUnits="userSpaceOnUse" /%3E%3ClinearGradient id="linearGradient2648"%3E%3Cstop style="stop-color:%23ebebeb;stop-opacity:1" offset="0" id="stop2644" /%3E%3Cstop style="stop-color:%23ffffff;stop-opacity:1" offset="1" id="stop2646" /%3E%3C/linearGradient%3E%3Cfilter style="color-interpolation-filters:sRGB" id="filter2688" x="-0.12" width="1.24" y="-0.12" height="1.24"%3E%3CfeGaussianBlur stdDeviation="0.66145835" id="feGaussianBlur2690" /%3E%3C/filter%3E%3ClinearGradient inkscape:collect="always" xlink:href="%23linearGradient2768" id="linearGradient7749" x1="6.0107598" y1="11.942085" x2="11.430239" y2="4.0917845" gradientUnits="userSpaceOnUse" /%3E%3ClinearGradient inkscape:collect="always" xlink:href="%23linearGradient2648" id="linearGradient8251" x1="4.2536402" y1="13.238126" x2="12.150527" y2="2.9068334" gradientUnits="userSpaceOnUse" /%3E%3Cfilter inkscape:collect="always" style="color-interpolation-filters:sRGB" id="filter8772" x="-0.10840111" y="-0.10840111" width="1.2168022" height="1.2168022"%3E%3CfeGaussianBlur inkscape:collect="always" stdDeviation="0.59752352" id="feGaussianBlur8774" /%3E%3C/filter%3E%3C/defs%3E%3Cmetadata id="metadata2716"%3E%3Crdf:RDF%3E%3Ccc:Work rdf:about=""%3E%3Cdc:format%3Eimage/svg+xml%3C/dc:format%3E%3Cdc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage" /%3E%3C/cc:Work%3E%3C/rdf:RDF%3E%3C/metadata%3E%3Ccircle style="fill:%23000000;stroke-width:0.230841;stroke-linecap:round;stroke-linejoin:round;fill-opacity:0.5;filter:url(%23filter8772)" id="circle8626" cx="8.2020836" cy="8.2020836" r="6.6145835" /%3E%3Ccircle style="fill:url(%23linearGradient8251);stroke-width:0.230841;stroke-linecap:round;stroke-linejoin:round;fill-opacity:1" id="path7652" cx="8.2020836" cy="8.2020836" r="6.6145835" /%3E%3Cpath d="m 4.2333333,6.7138018 c 0,0.9875367 0.4960933,2.4804692 0.4960933,2.4804692 h 1.984375 c 0,-0.7441408 0.2480473,-1.1782225 0.496094,-1.612305 0.2480467,-0.4340817 0.4960942,-0.8681642 0.4960942,-1.6123037 0,-0.8743657 -0.2480475,-2.7285166 -1.4882817,-2.7285166 -1.240234,0 -1.9843749,1.9843749 -1.9843748,3.4726561 z m 1.4882816,4.4648442 c 0.5472533,0 0.9921867,-0.444934 0.9921867,-0.992188 V 9.6903643 h -1.984375 v 0.4960937 c 0,0.547254 0.4449341,0.992188 0.9921883,0.992188 z M 12.170834,8.6981768 c 0,-1.4882808 -0.744141,-3.4726553 -1.984376,-3.4726553 -1.240234,0 -1.4882807,1.8541503 -1.4882807,2.7285153 0,0.74414 0.2480467,1.1782226 0.4960933,1.6123041 0.2480467,0.4340821 0.4960934,0.8681641 0.4960934,1.6123051 h 1.984376 c 0,0 0.496094,-1.4929325 0.496094,-2.4804692 z m -1.488281,4.4648442 c 0.547253,0 0.992187,-0.444935 0.992187,-0.992188 V 11.674739 H 9.690364 v 0.496094 c 0,0.547253 0.444935,0.992188 0.992189,0.992188 z" id="path7734" style="stroke-width:0.0155029;fill-opacity:1;fill:url(%23linearGradient7749)" /%3E%3C/svg%3E');touch-action: none;-webkit-user-select: none;user-select: none;}.v3d-webgl-error-container {position: absolute;top: 50%;left: 50%;margin-top: -80px;margin-left: -200px;width: 400px;height: 160px;text-align: center;z-index: 10;}.v3d-webgl-error-image {width: 160px;height: 160px;background-repeat: no-repeat;margin: 0px auto;background-image: url('data:image/svg+xml,%3C%3Fxml version="1.0" encoding="UTF-8" standalone="no"%3F%3E%3Csvg width="160" height="160" viewBox="0 0 42.333332 42.333333" version="1.1" id="svg1" inkscape:version="1.3 (0e150ed6c4, 2023-07-21)" sodipodi:docname="webgl-error.svg" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg"%3E%3Csodipodi:namedview id="namedview1" pagecolor="%23ffffff" bordercolor="%23eeeeee" borderopacity="1" inkscape:showpageshadow="false" inkscape:pageopacity="0" inkscape:pagecheckerboard="false" inkscape:deskcolor="%23d1d1d1" inkscape:document-units="px" labelstyle="default" shape-rendering="auto" inkscape:clip-to-page="false" inkscape:zoom="1.6017536" inkscape:cx="-5.3066837" inkscape:cy="78.97594" inkscape:window-width="1920" inkscape:window-height="1137" inkscape:window-x="-8" inkscape:window-y="-8" inkscape:window-maximized="1" inkscape:current-layer="layer1" /%3E%3Cdefs id="defs1"%3E%3Cfilter inkscape:collect="always" style="color-interpolation-filters:sRGB" id="filter1" x="-0.18167429" y="-0.16562716" width="1.3633486" height="1.3312543"%3E%3CfeGaussianBlur inkscape:collect="always" stdDeviation="2.1910722" id="feGaussianBlur1" /%3E%3C/filter%3E%3ClinearGradient inkscape:collect="always" xlink:href="%23linearGradient3259" id="linearGradient10" x1="863.9444" y1="1424.3892" x2="892.88947" y2="1424.3892" gradientUnits="userSpaceOnUse" /%3E%3ClinearGradient inkscape:collect="always" id="linearGradient3259"%3E%3Cstop style="stop-color:%23c90000;stop-opacity:1" offset="0" id="stop3255" /%3E%3Cstop style="stop-color:%23ff0a0a;stop-opacity:1" offset="1" id="stop3257" /%3E%3C/linearGradient%3E%3C/defs%3E%3Cg inkscape:label="Layer 1" inkscape:groupmode="layer" id="layer1"%3E%3Cg id="g2" style="display:inline" transform="translate(-857.25025,-1403.2226)"%3E%3Cpath id="path10" style="fill:%23e40505;fill-opacity:0.4;stroke-width:0.0581876;filter:url(%23filter1)" d="m 878.41691,1413.9426 c 1.49459,-0.033 2.34009,1.1428 2.29362,2.1957 l -0.39169,8.8754 c -0.0465,1.0529 -0.84799,1.9018 -1.90193,1.9018 -1.05394,0 -1.8516,-0.8491 -1.90193,-1.9018 l -0.42433,-8.8754 c -0.0503,-1.0527 0.83167,-2.163 2.32626,-2.1957 z m -0.18948,15.5145 c 1.4715,-0.1102 2.72596,1.0544 2.72522,2.53 0.0257,3.4066 -5.09721,3.4066 -5.07148,0 -6.7e-4,-1.3275 1.02252,-2.4308 2.34626,-2.53 z m 0.26002,-20.9425 c -1.67293,-0.01 -3.35083,1.1046 -7.24038,3.3274 -7.77912,4.4454 -7.24153,3.5234 -7.28121,12.483 -0.0397,8.9596 -0.56935,8.0329 7.17011,12.547 7.73941,4.5142 6.67221,4.5096 14.45131,0.064 7.77911,-4.4455 7.241,-3.5233 7.28069,-12.483 0.0397,-8.9596 0.56933,-8.0328 -7.1701,-12.547 -3.86972,-2.257 -5.53749,-3.384 -7.21042,-3.3915 z m -0.0134,2.8509 v 6e-4 c 1.68666,0.01 3.37009,0.8126 6.12676,2.4205 5.51329,3.2157 6.11834,4.2746 6.09006,10.6572 -0.0283,6.3825 -0.64255,7.4357 -6.18411,10.6025 -5.54155,3.1668 -6.76089,3.161 -12.27419,-0.055 -5.51329,-3.2158 -6.11831,-4.2742 -6.09007,-10.6567 0.0284,-6.3825 0.64255,-7.4357 6.18412,-10.6025 2.77079,-1.5834 4.46077,-2.3737 6.14743,-2.3663 z" sodipodi:nodetypes="zssssszsccssssssssssccsssssssc" /%3E%3Cpath id="path3" style="fill:url(%23linearGradient10);stroke-width:0.0581876" d="m 878.41691,1413.9426 c 1.49459,-0.033 2.34009,1.1428 2.29362,2.1957 l -0.39169,8.8754 c -0.0465,1.0529 -0.84799,1.9018 -1.90193,1.9018 -1.05394,0 -1.8516,-0.8491 -1.90193,-1.9018 l -0.42433,-8.8754 c -0.0503,-1.0527 0.83167,-2.163 2.32626,-2.1957 z m -0.18948,15.5145 c 1.4715,-0.1102 2.72596,1.0544 2.72522,2.53 0.0257,3.4066 -5.09721,3.4066 -5.07148,0 -6.7e-4,-1.3275 1.02252,-2.4308 2.34626,-2.53 z m 0.26002,-20.9425 c -1.67293,-0.01 -3.35083,1.1046 -7.24038,3.3274 -7.77912,4.4454 -7.24153,3.5234 -7.28121,12.483 -0.0397,8.9596 -0.56935,8.0329 7.17011,12.547 7.73941,4.5142 6.67221,4.5096 14.45131,0.064 7.77911,-4.4455 7.241,-3.5233 7.28069,-12.483 0.0397,-8.9596 0.56933,-8.0328 -7.1701,-12.547 -3.86972,-2.257 -5.53749,-3.384 -7.21042,-3.3915 z m -0.0134,2.8509 v 6e-4 c 1.68666,0.01 3.37009,0.8126 6.12676,2.4205 5.51329,3.2157 6.11834,4.2746 6.09006,10.6572 -0.0283,6.3825 -0.64255,7.4357 -6.18411,10.6025 -5.54155,3.1668 -6.76089,3.161 -12.27419,-0.055 -5.51329,-3.2158 -6.11831,-4.2742 -6.09007,-10.6567 0.0284,-6.3825 0.64255,-7.4357 6.18412,-10.6025 2.77079,-1.5834 4.46077,-2.3737 6.14743,-2.3663 z" sodipodi:nodetypes="zssssszsccssssssssssccsssssssc" /%3E%3C/g%3E%3C/g%3E%3C/svg%3E');background-size: 100% 100%;}.v3d-webgl-error {font-family: Arial;font-size: 16px;}.v3d-webgl-error-link {font-style: italic;font-weight: bolder;}.v3d-webgl-error-link {color: #015fb1;}`;if(typeof __V3D_DEVTOOLS__<"u"&&__V3D_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:"4.10.0"}})),typeof window<"u"&&(window.__V3D__?console.warn("WARNING: Multiple instances of Verge3D being imported."):window.__V3D__="4.10.0"),typeof document<"u"){const n=document.createElement("style");n.appendChild(document.createTextNode(c3e)),document.head.insertBefore(n,document.head.firstChild)}const u3e=Object.freeze(Object.defineProperty({__proto__:null,ACESFilmicToneMapping:vie,AVERAGE:E2e,AddEquation:X5,AddOperation:hie,AdditiveAnimationBlendMode:Iae,AdditiveBlending:Koe,AgXBlenderToneMapping:Eie,AlphaFormat:Yie,AlwaysDepth:oie,AlwaysStencilFunc:ose,AmbientLight:XP,AmbientLightProbe:X_e,AnimationClip:j0,AnimationLoader:Ube,AnimationMixer:sD,AnimationObjectGroup:fve,AnimationUtils:rve,Annotation:o3e,AnnotationControl:mN,App:fN,AppUtils:vo,ArcCurve:w1e,ArrayCamera:BL,ArrowHelper:Lve,Audio:eD,AudioAnalyser:eve,AudioContext:_b,AudioListener:JP,AudioLoader:z_e,AxesHelper:Pve,BackSide:Qoe,BasicDepthPacking:Nae,BasicShadowMap:zoe,BilinearShadowMap:Goe,BlenderTextBufferGeometry:Vbe,BlenderTextGeometry:Fbe,BloomPass:pl,BokehPass:Rb,Bone:jL,BooleanKeyframeTrack:pc,Box2:xve,Box3:Tn,Box3Helper:Tb,BoxGeometry:nc,BoxHelper:Ive,BrightnessContrastPass:Lb,BufferAttribute:Xe,BufferGeometry:At,BufferGeometryLoader:zbe,BufferGeometryUtils:NAe,ByteType:Fie,CENTER:x2e,CSS3DObject:tye,CSS3DRenderer:v6,CSVParser:X1,Cache:na,Camera:fh,CameraHelper:Tve,CameraUtils:hN,CanvasBreakpointsConstraint:cB,CanvasFitConstraint:lB,CanvasTexture:oP,CapsuleGeometry:k1e,CatmullRomCurve3:M1e,ChildOfConstraint:R6,CineonToneMapping:_ie,CircleGeometry:F1e,ClampToEdgeWrapping:uR,ClearMaskPass:MD,Clock:Ca,Color:Ge,ColorKeyframeTrack:Sb,ColorManagement:Wr,Compat:m6,CompressedArrayTexture:S1e,CompressedTexture:dl,CompressedTextureLoader:V_e,ConeGeometry:V1e,Constraint:id,ConstraintSpaceCustom:Bse,ConstraintSpaceLocal:Nse,ConstraintSpaceWorld:Dse,ControlSettings:n3,CopyLocationConstraint:L6,CopyRotationConstraint:P6,CopyScaleConstraint:N6,CopyTransformsConstraint:V6,CubeCamera:a0,CubeCopy:Gh,CubeReflectionMapping:Tie,CubeReflectionProbe:l3,CubeRefractionMapping:Iie,CubeTexture:s0,CubeTextureHelper:K1,CubeTextureLoader:U_e,CubeUVReflectionMapping:Pie,CubicBezierCurve:aP,CubicBezierCurve3:N1e,CubicInterpolant:nD,CullFaceBack:Foe,CullFaceFront:Voe,CullFaceFrontBack:Uoe,CullFaceNone:koe,Curve:Zi,CurvePath:uP,CustomBlending:eie,CustomToneMapping:Aie,CylinderGeometry:tb,Cylindrical:bve,DampedTrackConstraint:z6,Data3DTexture:l2,DataArrayTexture:$g,DataTexture:gs,DataTextureLoader:kP,DataUtils:Bve,DecrementStencilOp:$ae,DecrementWrapStencilOp:Xae,DefaultLoadingManager:pb,DepthFormat:AR,DepthStencilFormat:Kie,DepthTexture:P2,Detector:nr,DirectionalLight:YP,DirectionalLightCSMHelper:Mve,DirectionalLightHelper:AD,DiscreteInterpolant:lb,DodecahedronGeometry:U1e,DoubleSide:$oe,DstAlphaFactor:oR,DstColorFactor:aR,DynamicCopyUsage:fse,DynamicDrawUsage:ase,DynamicReadUsage:cse,ESMDistancePacking:Vae,ESMShadowMap:Woe,EdgesGeometry:z1e,EffectComposer:c3,EllipseCurve:X2,EqualDepth:sie,EqualStencilFunc:Jae,EquirectangularReflectionMapping:Rie,EquirectangularRefractionMapping:Lie,Euler:$i,EventDispatcher:ti,ExtendedTriangle:Li,ExtrudeGeometry:vP,FXAAPass:e1,FileLoader:Si,FilmicBlenderToneMapping:xie,FirstPersonControls:e3,FixOrthoZoomConstraint:aB,Float16BufferAttribute:ple,Float32BufferAttribute:mt,Float64BufferAttribute:mle,FloatType:Hie,FloorConstraint:G6,FlyingControls:t3,Fog:G2,FogExp2:z2,Font:h3,FramebufferTexture:C1e,FrontSide:joe,Frustum:ph,GLBufferAttribute:yve,GLSL1:pse,GLSL3:Jy,GLTFExporter:r1,GLTFLoader:MB,GTAOMapGenerator:zB,GraphUtils:m_e,GrayscalePass:Pb,GreaterDepth:cie,GreaterEqualDepth:lie,GreaterEqualStencilFunc:rse,GreaterStencilFunc:tse,GridHelper:Sve,Group:qi,HalfFloatType:Wie,HemisphereLight:H_e,HemisphereLightHelper:Cve,HemisphereLightProbe:W_e,IBLEnvironmentNone:Sse,IBLEnvironmentPMREM:Ese,IBLEnvironmentProbe:Cse,IcosahedronGeometry:a_e,ImageBitmapLoader:FP,ImageLoader:mb,ImageUtils:zR,IncrementStencilOp:Qae,IncrementWrapStencilOp:Yae,InstancedBufferAttribute:j2,InstancedBufferGeometry:Ave,InstancedInterleavedBuffer:qbe,InstancedMesh:x1e,Int16BufferAttribute:fle,Int32BufferAttribute:hle,Int8BufferAttribute:cle,IntType:zie,InterleavedBuffer:Kbe,InterleavedBufferAttribute:Xbe,Interpolant:qu,InterpolateDiscrete:xae,InterpolateLinear:Eae,InterpolateSmooth:Cae,InvertStencilOp:qae,KeepStencilOp:Wae,KeyframeTrack:Sa,Keys:tt,LOD:v1e,LatheGeometry:dP,Layers:Iu,LessDepth:iie,LessEqualDepth:aie,LessEqualStencilFunc:ese,LessStencilFunc:Zae,Light:fl,LightProbe:Dh,LightProbeGenerator:GB,LimitDistanceConstraint:W6,LimitLocationConstraint:j6,LimitRotationConstraint:Q6,LimitScaleConstraint:$6,Line:Ki,Line3:wa,LineBasicMaterial:_r,LineCurve:eb,LineCurve3:O1e,LineDashedMaterial:p_e,LineHTML:t3e,LineLoop:eP,LineSegments:ai,LinearDepthPacking:kae,LinearEncoding:Dae,LinearFilter:mR,LinearInterpolant:z0,LinearMipMapLinearFilter:Oie,LinearMipMapNearestFilter:Nie,LinearMipmapLinearFilter:_R,LinearMipmapNearestFilter:gR,LinearSRGBColorSpace:Zy,LinearToneMapping:mie,Loader:Ci,LoaderUtils:Ea,LoadingManager:OP,LockedTrackConstraint:K6,LogarithmicMaxToneMapping:yie,LoopOnce:Aae,LoopPingPong:bae,LoopRepeat:yae,LuminanceAlphaFormat:qie,LuminanceFormat:Xie,MOD_SUITE:gse,MOUSE:ql,MaskPass:Nb,Material:Nr,MaterialLoader:Gbe,MaterialUtils:FAe,MathUtils:$se,Matrix3:ao,Matrix4:Ue,MaxEquation:nie,Mesh:Mt,MeshBVH:Q1,MeshBasicMaterial:pr,MeshDepthMaterial:Gu,MeshDistanceMaterial:IL,MeshLambertMaterial:O0,MeshLine:rd,MeshLineIndexed:ID,MeshLineMaterial:sb,MeshMaskMaterial:CP,MeshMatcapMaterial:Qbe,MeshNodeMaterial:ta,MeshNormalMaterial:EP,MeshPhongMaterial:Wbe,MeshPhysicalMaterial:ab,MeshStandardMaterial:Xu,MeshToonMaterial:jbe,MinEquation:tie,MirroredRepeatWrapping:dR,MixOperation:fie,MotionPathConstraint:yB,MultiplyBlending:Joe,MultiplyOperation:die,NearestFilter:fR,NearestMipMapLinearFilter:Bie,NearestMipMapNearestFilter:Die,NearestMipmapLinearFilter:pR,NearestMipmapNearestFilter:hR,NeverDepth:rie,NeverStencilFunc:Kae,NoBlending:Xoe,NoColorSpace:Gae,NoOIT:Lse,NoToneMapping:pie,NormalAnimationBlendMode:Tae,NormalBlending:qoe,NotEqualDepth:uie,NotEqualStencilFunc:nse,NumberKeyframeTrack:hc,OITWeighted:Pse,Object3D:kt,ObjectLoader:Hbe,ObjectSpaceNormalMap:zae,OctahedronGeometry:AP,OneFactor:J5,OneMinusDstAlphaFactor:iR,OneMinusDstColorFactor:sR,OneMinusSrcAlphaFactor:rR,OneMinusSrcColorFactor:tR,OrbitControls:Zb,OrthographicCamera:ya,OutlinePass:Ma,PCFShadowMap:Hoe,PCFShadowMapPoissonDisk:Ybe,PCFSoftShadowMap:$be,PMREMGenerator:gh,Pass:xi,Path:I0,PbrNeutralToneMapping:Cie,PerspectiveCamera:gr,PhysicalMaxToneMapping:bie,Plane:Vo,PlaneGeometry:ms,PlaneHelper:Rve,PointLight:HP,PointLightHelper:pD,Points:nP,PointsMaterial:$2,PolarGridHelper:wve,PolyhedronGeometry:Sh,PositionalAudio:J_e,Preloader:Cc,PropertyBinding:Kt,PropertyMixer:aD,PuzzlesLoader:r3e,QuadraticBezierCurve:sP,QuadraticBezierCurve3:lP,Quaternion:It,QuaternionKeyframeTrack:fc,QuaternionLinearInterpolant:iD,REVISION:Noe,RGBADepthPacking:Oae,RGBADistancePacking:Fae,RGBAFormat:vR,RGBAIntegerFormat:tae,RGBA_ASTC_10x10_Format:gae,RGBA_ASTC_10x5_Format:hae,RGBA_ASTC_10x6_Format:pae,RGBA_ASTC_10x8_Format:mae,RGBA_ASTC_12x10_Format:_ae,RGBA_ASTC_12x12_Format:vae,RGBA_ASTC_4x4_Format:TR,RGBA_ASTC_5x4_Format:aae,RGBA_ASTC_5x5_Format:sae,RGBA_ASTC_6x5_Format:lae,RGBA_ASTC_6x6_Format:cae,RGBA_ASTC_8x5_Format:uae,RGBA_ASTC_8x6_Format:dae,RGBA_ASTC_8x8_Format:fae,RGBA_BPTC_Format:IR,RGBA_ETC2_EAC_Format:MR,RGBA_PVRTC_2BPPV1_Format:iae,RGBA_PVRTC_4BPPV1_Format:CR,RGBA_S3TC_DXT1_Format:nae,RGBA_S3TC_DXT3_Format:rae,RGBA_S3TC_DXT5_Format:xR,RGBELoader:d3,RGB_ETC1_Format:SR,RGB_ETC2_Format:wR,RGB_PVRTC_2BPPV1_Format:oae,RGB_PVRTC_4BPPV1_Format:ER,RGB_S3TC_DXT1_Format:bR,RGFormat:yR,RGIntegerFormat:eae,RawShaderMaterial:mh,Ray:Tu,Raycaster:_0,RectAreaLight:WP,RectAreaLightUniformsLib:S6,RedFormat:Zie,RedIntegerFormat:Jie,ReflectionProbeTypeBox:Rse,ReflectionProbeTypeInfinite:Tse,ReflectionProbeTypeSphere:Ise,ReinhardToneMapping:gie,RenderPass:o1,RenderUtils:oye,RepeatWrapping:cR,ReplaceStencilOp:jae,ReverseSubtractEquation:K5,RingGeometry:s_e,SAH:C2e,SRGBColorSpace:Ky,SSAARenderPass:Fh,SSAOPass:kbe,Scene:jr,SceneBackground:Ge,SceneUtils:KAe,ShaderChunk:Qe,ShaderLib:Tt,ShaderMaterial:Dn,ShaderPass:bs,ShadowMaterial:h_e,Shape:$u,ShapeGeometry:l_e,ShapePath:bD,ShapeUtils:ba,ShortType:Vie,SimplePreloader:pN,Skeleton:E0,SkeletonHelper:fD,SkinnedMesh:x0,Source:Qg,Sphere:ni,SphereGeometry:yP,Spherical:xa,SphericalHarmonics3:td,SplineCurve:cP,SpotLight:UP,SpotLightHelper:dD,Sprite:VL,SpriteMaterial:H2,SrcAlphaFactor:nR,SrcAlphaSaturateFactor:lR,SrcColorFactor:eR,StaticCopyUsage:dse,StaticDrawUsage:ise,StaticReadUsage:lse,Stats:hd,StereoCamera:q_e,StreamCopyUsage:hse,StreamDrawUsage:sse,StreamReadUsage:use,StringKeyframeTrack:dc,SubtractEquation:q5,SubtractiveBlending:Zoe,TOUCH:Ooe,TTFLoader:u3,TangentSpaceNormalMap:Uae,TargetConstraint:Ao,TeapotGeometry:f_e,TetrahedronGeometry:c_e,TextGeometry:Ih,Texture:$n,TextureLoader:gb,ToneMapPass:kb,ToneMappingLookAgXPunchy:wie,ToneMappingLookNone:Sie,TorusGeometry:u_e,TorusKnotGeometry:ib,TrackToConstraint:iB,TransformationConstraint:SB,Triangle:Br,TriangleFanDrawMode:Pae,TriangleStripDrawMode:Lae,TrianglesDrawMode:Rae,TubeGeometry:d_e,TweenCameraController:d1,TweenLinear:wse,TweenSpherical:Mse,TwoPassDoubleSide:Yoe,USDZExporter:QD,UVMapping:Mie,Uint16BufferAttribute:ZR,Uint32BufferAttribute:JR,Uint8BufferAttribute:ule,Uint8ClampedBufferAttribute:dle,Uniform:Q0,UniformsGroup:vve,UniformsLib:qe,UniformsUtils:_o,UnsignedByteType:kie,UnsignedInt248Type:$ie,UnsignedIntType:Gie,UnsignedShort4444Type:jie,UnsignedShort5551Type:Qie,UnsignedShortType:Uie,V3DL:kg,Vector2:be,Vector3:N,Vector4:pt,VectorKeyframeTrack:Nh,VideoTexture:E1e,ViewportFitAuto:yse,ViewportFitFill:bse,ViewportFitHorizontal:Ase,ViewportFitNone:_se,ViewportFitOverscan:xse,ViewportFitVertical:vse,WebGL3DRenderTarget:tle,WebGLArrayRenderTarget:ele,WebGLCubeRenderTarget:hh,WebGLMultipleRenderTargets:c2,WebGLRenderTarget:nn,WebGLRenderer:U2,WebGLUtils:DL,WebXRUtils:l3e,WireframeGeometry:bP,WrapAroundEnding:Mae,XZ:y6,XZLoader:Wh,ZeroCurvatureEnding:Sae,ZeroFactor:Z5,ZeroSlopeEnding:wae,ZeroStencilOp:Hae,_SRGBAFormat:mse,acceleratedRaycast:lN,arrayMax:DR,arrayMin:Yse,clampArray:NR,computeBoundsTree:cN,disposeBoundsTree:uN,engineVersionCmp:VR,findModulePath:Gg,getGlobalScope:ch,isDef:_e,loadModule:i2,sRGBEncoding:Bae,shaderFloatStr:Js},Symbol.toStringTag,{value:"Module"}));function d3e(n=window.v3d){const e={percentage:0,output:{initOptions:{fadeAnnotations:!0,useBkgTransp:!1,preserveDrawBuf:!1,useCompAssets:!1,useFullscreen:!0,useCustomPreloader:!1,preloaderStartCb:function(){},preloaderProgressCb:function(){},preloaderEndCb:function(){}}}};var t={};t.objCache=new Map,t.fadeAnnotations=!0,t.pickedObject="",t.hoveredObject="",t.mediaElements={},t.loadedFile="",t.states=[],t.percentage=0,t.openedFile="",t.openedFileMeta={},t.xrSessionAcquired=!1,t.xrSessionCallbacks=[],t.screenCoords=new n.Vector2,t.intervalTimers={},t.customEvents=new n.EventDispatcher,t.eventListeners=[],t.htmlElements=new Set,t.materialsCache=new Map,t.css3Objects=new WeakMap,t.AXIS_X=new n.Vector3(1,0,0),t.AXIS_Y=new n.Vector3(0,1,0),t.AXIS_Z=new n.Vector3(0,0,1),t.MIN_DRAG_SCALE=.001,t.SET_OBJ_ROT_EPS=1e-8,t.vec2Tmp=new n.Vector2,t.vec2Tmp2=new n.Vector2,t.vec3Tmp=new n.Vector3,t.vec3Tmp2=new n.Vector3,t.vec3Tmp3=new n.Vector3,t.vec3Tmp4=new n.Vector3,t.eulerTmp=new n.Euler,t.eulerTmp2=new n.Euler,t.quatTmp=new n.Quaternion,t.quatTmp2=new n.Quaternion,t.colorTmp=new n.Color,t.mat4Tmp=new n.Matrix4,t.planeTmp=new n.Plane,t.raycasterTmp=new n.Raycaster;const r=({v3d:i=null,appInstance:a=null})=>{function s(H,T=!1){let R;if(Array.isArray(H)&&H[0]==="CONTAINER"){if(a!==null)R=a.container;else if(typeof e<"u"){const O=e.container;R=T?parent.document.getElementById(O):document.getElementById(O)}}else Array.isArray(H)&&H[0]==="WINDOW"?R=T?parent:window:Array.isArray(H)&&H[0]==="DOCUMENT"?R=T?parent.document:document:Array.isArray(H)&&H[0]==="BODY"?R=T?parent.document.body:document.body:Array.isArray(H)&&H[0]==="QUERYSELECTOR"?R=T?parent.document.querySelector(H):document.querySelector(H):R=T?parent.document.getElementById(H):document.getElementById(H);return R}function l(H,T=!1){const R=[];if(Array.isArray(H)&&H[0]!=="CONTAINER"&&H[0]!=="WINDOW"&&H[0]!=="DOCUMENT"&&H[0]!=="BODY"&&H[0]!=="QUERYSELECTOR")for(let O=0;O<H.length;O++)R.push(s(H[O],T));else R.push(s(H,T));return R}function c(H,T,R,O,W,ae,ne,oe){const F=!!(O instanceof Object?O.capture:O),k=!!(oe instanceof Object?oe.capture:oe);return H===W&&T===ae&&R===ne&&F===k}function u(H,T,R,O){t.eventListeners.some(ae=>c(ae.target,ae.type,ae.listener,ae.optionsOrUseCapture,H,T,R,O))||(H.addEventListener(T,R,O),t.eventListeners.push({target:H,type:T,listener:R,optionsOrUseCapture:O}))}function d(H){return H.name!==""&&!(H.isMesh&&H.isMaterialGeneratedMesh)&&!H.isAuxClippingMesh}function f(H){let T=null;const R=i.MathUtils.checkUUID?i.MathUtils.checkUUID(H):!1,O=t!==void 0;if(O&&(T=t.objCache.get(H)),T&&(R?T.uuid===H:T.name===H))return T;function W(ae,ne){if((R?ae.uuid===ne:ae.name===ne)&&d(ae))return ae;for(let oe=0;oe<ae.children.length;oe++){const F=ae.children[oe],k=W(F,ne);if(k!==null)return k}return null}return a.scene&&(T=W(a.scene,H),T&&O&&t.objCache.set(H,T)),T}function h(H){const T=[];return a.scene.traverse(R=>{if(d(R)){const O=R.groupNames;if(!O)return;for(let W=0;W<O.length;W++)O[W]===H&&T.push(R.name)}}),T}function p(){const H=[];return a.scene.traverse(T=>{d(T)&&H.push(T.name)}),H}function m(H,T){if(typeof H=="string")T.push(H);else if(Array.isArray(H)&&H[0]==="GROUP"){const R=h(H[1]);for(let O=0;O<R.length;O++)T.push(R[O])}else if(Array.isArray(H)&&H[0]==="ALL_OBJECTS"){const R=p();for(let O=0;O<R.length;O++)T.push(R[O])}else if(Array.isArray(H))for(let R=0;R<H.length;R++)m(H[R],T)}function g(H){const T=[];return m(H,T),T.filter(R=>R!=="")}function _(H){if(H.isMesh)return!0;for(let T=0;T<H.children.length;T++){const R=H.children[T];if(R.isMesh&&R.isMaterialGeneratedMesh)return!0}return!1}function A(H){return typeof H=="string"&&H.indexOf("data:")===0}const y=/^data:(.+\/.+);base64,(.*)$/;function b(H){return decodeURIComponent(atob(H).split("").map(T=>"%"+("00"+T.charCodeAt(0).toString(16)).slice(-2)).join(""))}function E(H){const T=H.match(y);return b(T[2])}function x(H){const T=i.SceneUtils.getMaterialByName(a,H);return T?T.isMeshNodeMaterial?Object.keys(T.nodeValueMap):T.isMeshStandardMaterial?["metalness","roughness","bumpScale","emissiveIntensity","envMapIntensity"]:[]:[]}function w(H,T,R,O=!1){if(T===R)return H;const W=H.y,ae=H.z;return T==="Z_UP_RIGHT"&&R==="Y_UP_RIGHT"?(H.y=ae,H.z=O?W:-W):T==="Y_UP_RIGHT"&&R==="Z_UP_RIGHT"?(H.y=O?ae:-ae,H.z=W):console.error("transformCoordsSpace: Unsupported coordinate space"),H}const L=(function(){const H=new i.Euler,T=new i.Euler,R=new i.Vector3;return function(O,W){const ae=H.copy(O).reorder("YZX"),ne=T.copy(ae).makeAlternative(),oe=R.setFromEuler(ae).lengthSq(),F=R.setFromEuler(ne).lengthSq();return W.copy(oe<F?ae:ne),w(W,"Y_UP_RIGHT","Z_UP_RIGHT")}})();function C(){const H=a.scene;return H&&"coordSystem"in H.userData?H.userData.coordSystem:"Y_UP_RIGHT"}function P(){this._userRotation=new i.Euler(0,0,0,"ZYX"),this._actualRotation=new i.Euler}Object.assign(P,{initObject:function(H){H.userData.puzzles===void 0&&(H.userData.puzzles={}),H.userData.puzzles.rotationInterface===void 0&&(H.userData.puzzles.rotationInterface=new P);const T=H.userData.puzzles.rotationInterface;return T.updateFromObject(H),T}}),Object.assign(P.prototype,{updateFromObject:function(H){this._actualRotation.equalsEps(H.rotation,1e-8)||(this._actualRotation.copy(H.rotation),this._updateUserRotFromActualRot())},getActualRotation:function(H){return H.copy(this._actualRotation)},setUserRotation:function(H){this._userRotation.set(H.x,H.y,H.z),this._updateActualRotFromUserRot()},getUserRotation:function(H){return H.copy(this._userRotation)},_updateUserRotFromActualRot:function(){const H=this._userRotation.order;this._userRotation.copy(this._actualRotation).reorder(H)},_updateActualRotFromUserRot:function(){const H=this._actualRotation.order;this._actualRotation.copy(this._userRotation).reorder(H)}});const D=(function(){var H=function(){this._tweens={},this._tweensAddedDuringUpdate={}};H.prototype={getAll:function(){return Object.keys(this._tweens).map((function(R){return this._tweens[R]}).bind(this))},removeAll:function(){this._tweens={}},add:function(R){this._tweens[R.getId()]=R,this._tweensAddedDuringUpdate[R.getId()]=R},remove:function(R){delete this._tweens[R.getId()],delete this._tweensAddedDuringUpdate[R.getId()]},update:function(R,O){var W=Object.keys(this._tweens);if(W.length===0)return!1;for(R=R!==void 0?R:T.now();0<W.length;){this._tweensAddedDuringUpdate={};for(var ae=0;ae<W.length;ae++){var ne=this._tweens[W[ae]];ne&&ne.update(R)===!1&&(ne._isPlaying=!1,O||delete this._tweens[W[ae]])}W=Object.keys(this._tweensAddedDuringUpdate)}return!0}};var T=new H;return T.Group=H,T._nextId=0,T.nextId=function(){return T._nextId++},typeof window>"u"&&typeof process<"u"&&process.hrtime?T.now=function(){var R=process.hrtime();return 1e3*R[0]+R[1]/1e6}:typeof window<"u"&&window.performance!==void 0&&window.performance.now!==void 0?T.now=window.performance.now.bind(window.performance):Date.now!==void 0?T.now=Date.now:T.now=function(){return new Date().getTime()},T.Tween=function(R,O){this._object=R,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._repeat=0,this._repeatDelayTime=void 0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=null,this._easingFunction=T.Easing.Linear.None,this._interpolationFunction=T.Interpolation.Linear,this._chainedTweens=[],this._onStartCallback=null,this._onStartCallbackFired=!1,this._onUpdateCallback=null,this._onCompleteCallback=null,this._onStopCallback=null,this._group=O||T,this._id=T.nextId()},T.Tween.prototype={getId:function(){return this._id},isPlaying:function(){return this._isPlaying},to:function(R,O){return this._valuesEnd=R,O!==void 0&&(this._duration=O),this},start:function(R){for(var O in this._group.add(this),this._isPlaying=!0,this._onStartCallbackFired=!1,this._startTime=R!==void 0?typeof R=="string"?T.now()+parseFloat(R):R:T.now(),this._startTime+=this._delayTime,this._valuesEnd){if(this._valuesEnd[O]instanceof Array){if(this._valuesEnd[O].length===0)continue;this._valuesEnd[O]=[this._object[O]].concat(this._valuesEnd[O])}this._object[O]!==void 0&&(this._valuesStart[O]=this._object[O],!(this._valuesStart[O]instanceof Array)&&(this._valuesStart[O]*=1),this._valuesStartRepeat[O]=this._valuesStart[O]||0)}return this},stop:function(){return this._isPlaying&&(this._group.remove(this),this._isPlaying=!1,this._onStopCallback!==null&&this._onStopCallback(this._object),this.stopChainedTweens()),this},end:function(){return this.update(this._startTime+this._duration),this},stopChainedTweens:function(){for(var R=0,O=this._chainedTweens.length;R<O;R++)this._chainedTweens[R].stop()},group:function(R){return this._group=R,this},delay:function(R){return this._delayTime=R,this},repeat:function(R){return this._repeat=R,this},repeatDelay:function(R){return this._repeatDelayTime=R,this},yoyo:function(R){return this._yoyo=R,this},easing:function(R){return this._easingFunction=R,this},interpolation:function(R){return this._interpolationFunction=R,this},chain:function(){return this._chainedTweens=arguments,this},onStart:function(R){return this._onStartCallback=R,this},onUpdate:function(R){return this._onUpdateCallback=R,this},onComplete:function(R){return this._onCompleteCallback=R,this},onStop:function(R){return this._onStopCallback=R,this},update:function(R){var O,W,ae;if(R<this._startTime)return!0;for(O in this._onStartCallbackFired===!1&&(this._onStartCallback!==null&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),W=(R-this._startTime)/this._duration,W=this._duration===0||1<W?1:W,ae=this._easingFunction(W),this._valuesEnd)if(this._valuesStart[O]!==void 0){var ne=this._valuesStart[O]||0,oe=this._valuesEnd[O];oe instanceof Array?this._object[O]=this._interpolationFunction(oe,ae):(typeof oe=="string"&&(oe=oe.charAt(0)==="+"||oe.charAt(0)==="-"?ne+parseFloat(oe):parseFloat(oe)),typeof oe=="number"&&(this._object[O]=ne+(oe-ne)*ae))}if(this._onUpdateCallback!==null&&this._onUpdateCallback(this._object),W!==1)return!0;if(0<this._repeat){for(O in isFinite(this._repeat)&&this._repeat--,this._valuesStartRepeat){if(typeof this._valuesEnd[O]=="string"&&(this._valuesStartRepeat[O]=this._valuesStartRepeat[O]+parseFloat(this._valuesEnd[O])),this._yoyo){var F=this._valuesStartRepeat[O];this._valuesStartRepeat[O]=this._valuesEnd[O],this._valuesEnd[O]=F}this._valuesStart[O]=this._valuesStartRepeat[O]}return this._yoyo&&(this._reversed=!this._reversed),this._repeatDelayTime!==void 0?this._startTime=R+this._repeatDelayTime:this._startTime=R+this._delayTime,!0}this._onCompleteCallback!==null&&this._onCompleteCallback(this._object);for(var k=0,q=this._chainedTweens.length;k<q;k++)this._chainedTweens[k].start(this._startTime+this._duration);return!1}},T.Easing={Linear:{None:function(R){return R}},Quadratic:{In:function(R){return R*R},Out:function(R){return R*(2-R)},InOut:function(R){return(R*=2)<1?.5*R*R:-.5*(--R*(R-2)-1)}},Cubic:{In:function(R){return R*R*R},Out:function(R){return--R*R*R+1},InOut:function(R){return(R*=2)<1?.5*R*R*R:.5*((R-=2)*R*R+2)}},Quartic:{In:function(R){return R*R*R*R},Out:function(R){return 1- --R*R*R*R},InOut:function(R){return(R*=2)<1?.5*R*R*R*R:-.5*((R-=2)*R*R*R-2)}},Quintic:{In:function(R){return R*R*R*R*R},Out:function(R){return--R*R*R*R*R+1},InOut:function(R){return(R*=2)<1?.5*R*R*R*R*R:.5*((R-=2)*R*R*R*R+2)}},Sinusoidal:{In:function(R){return 1-Math.cos(R*Math.PI/2)},Out:function(R){return Math.sin(R*Math.PI/2)},InOut:function(R){return .5*(1-Math.cos(Math.PI*R))}},Exponential:{In:function(R){return R===0?0:Math.pow(1024,R-1)},Out:function(R){return R===1?1:1-Math.pow(2,-10*R)},InOut:function(R){return R===0?0:R===1?1:(R*=2)<1?.5*Math.pow(1024,R-1):.5*(2-Math.pow(2,-10*(R-1)))}},Circular:{In:function(R){return 1-Math.sqrt(1-R*R)},Out:function(R){return Math.sqrt(1- --R*R)},InOut:function(R){return(R*=2)<1?-.5*(Math.sqrt(1-R*R)-1):.5*(Math.sqrt(1-(R-=2)*R)+1)}},Elastic:{In:function(R){return R===0?0:R===1?1:-Math.pow(2,10*(R-1))*Math.sin(5*(R-1.1)*Math.PI)},Out:function(R){return R===0?0:R===1?1:Math.pow(2,-10*R)*Math.sin(5*(R-.1)*Math.PI)+1},InOut:function(R){return R===0?0:R===1?1:(R*=2)<1?-.5*Math.pow(2,10*(R-1))*Math.sin(5*(R-1.1)*Math.PI):.5*Math.pow(2,-10*(R-1))*Math.sin(5*(R-1.1)*Math.PI)+1}},Back:{In:function(R){return R*R*(2.70158*R-1.70158)},Out:function(R){return--R*R*(2.70158*R+1.70158)+1},InOut:function(R){var O=2.5949095;return(R*=2)<1?R*R*((O+1)*R-O)*.5:.5*((R-=2)*R*((O+1)*R+O)+2)}},Bounce:{In:function(R){return 1-T.Easing.Bounce.Out(1-R)},Out:function(R){return R<1/2.75?7.5625*R*R:R<2/2.75?7.5625*(R-=1.5/2.75)*R+.75:R<2.5/2.75?7.5625*(R-=2.25/2.75)*R+.9375:7.5625*(R-=2.625/2.75)*R+.984375},InOut:function(R){return R<.5?.5*T.Easing.Bounce.In(2*R):.5*T.Easing.Bounce.Out(2*R-1)+.5}}},T.Interpolation={Linear:function(R,O){var W=R.length-1,ae=W*O,ne=Math.floor(ae),oe=T.Interpolation.Utils.Linear;return O<0?oe(R[0],R[1],ae):1<O?oe(R[W],R[W-1],W-ae):oe(R[ne],R[W<ne+1?W:ne+1],ae-ne)},Bezier:function(R,O){for(var W=0,ae=R.length-1,ne=Math.pow,oe=T.Interpolation.Utils.Bernstein,F=0;F<=ae;F++)W+=ne(1-O,ae-F)*ne(O,F)*R[F]*oe(ae,F);return W},CatmullRom:function(R,O){var W=R.length-1,ae=W*O,ne=Math.floor(ae),oe=T.Interpolation.Utils.CatmullRom;return R[0]===R[W]?(O<0&&(ne=Math.floor(ae=W*(1+O))),oe(R[(ne-1+W)%W],R[ne],R[(ne+1)%W],R[(ne+2)%W],ae-ne)):O<0?R[0]-(oe(R[0],R[0],R[1],R[1],-ae)-R[0]):1<O?R[W]-(oe(R[W],R[W],R[W-1],R[W-1],ae-W)-R[W]):oe(R[ne?ne-1:0],R[ne],R[W<ne+1?W:ne+1],R[W<ne+2?W:ne+2],ae-ne)},Utils:{Linear:function(R,O,W){return(O-R)*W+R},Bernstein:function(R,O){var W=T.Interpolation.Utils.Factorial;return W(R)/W(O)/W(R-O)},Factorial:(function(){var R=[1];return function(O){var W=1;if(R[O])return R[O];for(var ae=O;1<ae;ae--)W*=ae;return R[O]=W}})(),CatmullRom:function(R,O,W,ae,ne){var oe=.5*(W-R),F=.5*(ae-O),k=ne*ne;return(2*O-2*W+oe+F)*(ne*k)+(-3*O+3*W-2*oe-F)*k+oe*ne+O}}},(function(R){typeof define=="function"&&define.amd?define([],function(){return T}):typeof module<"u"&&typeof exports=="object"?module.exports=T:R!==void 0&&(console.log(R),R.TWEEN=T)})(this),T})();function Q(H,T){H.isClippingPlaneObject&&i.SceneUtils.removeClipPlanesFromMats&&i.SceneUtils.removeClipPlanesFromMats(H,a.scene),H.parent.remove(H),t.objCache.delete(T),H.traverse(R=>{t.objCache.delete(R.name)})}function re(H,T){let R=H;if(T!==void 0)for(;!T(R);){const O=R.match(/^(.*?)(\d+)$/);O?R=O[1]+(Number.parseInt(O[2],10)+1):R+="2"}return R}function G(H){return re(H,T=>!f(T))}function se(H){const T=i.SceneUtils.getMaterialByName(a,H);return T?T.isMeshNodeMaterial?Object.keys(T.nodeRGBMap):T.isMeshStandardMaterial?["color","emissive"]:T.isMeshLineMaterial?["color"]:[]:[]}function ee(H,T=!1){let R=[];if(T)R=i.SceneUtils.getMaterialsByName(a,H);else{const W=i.SceneUtils.getMaterialByName(a,H);W!==null&&(R=[W])}return R.reduce((W,ae)=>{let ne=[];switch(ae.type){case"MeshNodeMaterial":ne=Object.values(ae.nodeTextures);break;case"MeshStandardMaterial":ne=[ae.map,ae.lightMap,ae.aoMap,ae.emissiveMap,ae.bumpMap,ae.normalMap,ae.displacementMap,ae.roughnessMap,ae.metalnessMap,ae.alphaMap,ae.envMap];break;default:console.error("getMaterialEditableTextures: Unknown material type "+ae.type);break}return Array.prototype.push.apply(W,ne),W},[]).filter(W=>W&&(W.constructor===i.Texture||W.constructor===i.CompressedTexture||W.constructor===i.DataTexture||W.constructor===i.CanvasTexture||W.constructor===i.VideoTexture))}function ie(H,T,R){if(i.MaterialUtils.replaceTexture){i.MaterialUtils.replaceTexture(H,T,R);return}switch(H.type){case"MeshNodeMaterial":H.traverseNodes(W=>{W.originData.texture===T&&(W.originData.texture=R)});for(const W in H.nodeTextures)H.nodeTextures[W]===T&&(H.nodeTextures[W]=R);break;case"MeshStandardMaterial":["map","lightMap","aoMap","emissiveMap","bumpMap","normalMap","displacementMap","roughnessMap","metalnessMap","alphaMap","envMap"].forEach(W=>{H[W]===T&&(H[W]=R)});break;default:console.error("replaceMaterialEditableTexture: Unsupported material type "+H.type);break}R.encoding=T.encoding,R.wrapS=T.wrapS,R.wrapT=T.wrapT}return{getElements:l,bindListener:u,getElement:s,getObjectByName:f,retrieveObjectNames:g,isMeshObject:_,isObjectWorthProcessing:d,isDataUrl:A,extractDataUrlData:E,getMaterialEditableValues:x,transformCoordsSpace:w,transformEulerV3dToBlenderShortest:L,getSceneCoordSystem:C,RotationInterface:P,Tween:D,removeObject:Q,generateUniqueObjectName:G,getMaterialEditableColors:se,getMaterialEditableTextures:ee,replaceMaterialEditableTexture:ie}};var o={};return n[Symbol.toStringTag]!=="Module"&&(n.PL=n.puzzles=o),o.procedures=o.procedures||{},o.execInitPuzzles=function(i){const a=r({v3d:n});e.container=i!==void 0&&"container"in i?i.container:"";function s(l,c,u,d){for(var f=a.getElements(u,d),h=0;h<f.length;h++){var p=f[h];!p||!p.style||(p.style[l]=c)}}return e.output.initOptions.fadeAnnotations=!1,e.output.initOptions.useBkgTransp=!1,e.output.initOptions.preserveDrawBuf=!0,e.output.initOptions.useCompAssets=!0,e.output.initOptions.useFullscreen=!1,e.output.initOptions.useCustomPreloader=!0,e.output.initOptions.preloaderStartCb=function(){e.percentage=0},e.output.initOptions.preloaderProgressCb=function(l){e.percentage=l},e.output.initOptions.preloaderEndCb=function(){e.percentage=100,(function(){s("display","none","preloader_container",!1)})()},e.output},o.init=function(i,a){const s=r({v3d:n,appInstance:i});a=a||{},"fadeAnnotations"in a&&(t.fadeAnnotations=a.fadeAnnotations),this.procedures.renderImage=I,this.procedures.loadGLTF=J,this.procedures.verplaatsingMeubels=$,this.procedures.maatvoeringWeergeven=B,this.procedures.setCameraSettingsAtFront=Ie,this.procedures.setCameraSettingsAtBack=Ne,this.procedures.setCameraSettingsForScreenshot=He,this.procedures.moveCameraToFrontPosition=je,this.procedures.isCameraAtFrontPosition=Vt,this.procedures.setCamera=En,this.procedures.setCameraScreenshot=Rt,this.procedures.fHandleAfmetingen=Te,this.procedures._VasteWandBreedte=Ce,this.procedures._VasteWandBreedteLaatste=Zt,this.procedures.fVasteWandHandleWand=rt,this.procedures.fTaatsdeurMainLinkseDeur=rn,this.procedures.fTaatsdeurMainRechtseDeur=Di,this.procedures.fScharnierdeurMainLinkseDeur=xo,this.procedures.fScharnierdeurMainRechtseDeur=Eo,this.procedures.fSchuifdeurBovenrail=jn,this.procedures.fSchuifdeur=xl,this.procedures.schuifdeurHandgreepLinksRechts=Sc,this.procedures.fOpdekdeurMain=wc,this.procedures.fVouwwandMain=Vr,this.procedures.fHandleZijpaneelLinks=Ms,this.procedures.fHandleZijpaneelRechts=Mc,this.procedures.fHandleStaanders=oa,this.procedures.fHandleLiggers=Ed,this.procedures.fMainBovenlicht=Ts,this.procedures.fHandleRoedeConfiguratie=fi,this.procedures.removeObjectHandgreep=ce,this.procedures.getObjectNameHandgreep=Se,this.procedures.addObjectHandgreep=ut,this.procedures.removeObjectFrame=ft,this.procedures.getObjectByNameFrame=Ze,this.procedures.getObjectFrameShapeKeyValue=$t,this.procedures.getObjectFrameLocationXByFrameName=at,this.procedures.getObjectFrameLocationZByFrameName=zt,this.procedures.getObjectFrameData=Is,this.procedures.addObjectFrame=sn,this.procedures.removeObjectGlas=ln,this.procedures.getMaterialKleurGlas=hi,this.procedures.addObjectGlas=Cn,this.procedures.getMaterialKleurMateriaal=on,this.procedures.removeObjectLigger=ur,this.procedures.addObjectLigger=Ba,this.procedures.getObjectNameStaander=lx,this.procedures.getObjectDataStaander=Rs,this.procedures.removeObjectStaander=Co,this.procedures.addObjectStaander=El,this.procedures.getRoedeConfiguratiePositieOffsetX=dp,this.procedures.getObjectNameRoedeLiggendTypeRoede=t_,this.procedures.getObjectByNameRoede=cx,this.procedures.getRoedeConfiguratiePositieY=Cd,this.procedures.getObjectRoedeData=ux,this.procedures.getObjectNameRoedeStaandTypeRoede=n_,this.procedures.getRoedeConfiguratiePositieZ=Jt,this.procedures.removeObjectRoede=Sd,this.procedures.getRoedeConfiguratieDetails=fp,this.procedures.getObjectRoedeLocationXByName=r_,this.procedures.getObjectNameRoedeConfiguratie=pi,this.procedures.addObjectRoede=wd,this.procedures.removeObjectScharnier=Tr,this.procedures.addObjectScharnier=jo,this.procedures.removeObjectAfmetingen=Ln,this.procedures.addObjectAfmetingen=So,this.procedures.removeObjectKozijn=St,this.procedures.addObjectKozijn=Bi,this.procedures.removeObjectBovenrail=Md,this.procedures.addObjectBovenrail=wo,this.procedures.getObjectNameBovenrail=co;var l,c,u,d,f,h,p,m,g,_,A,y,b,E,x,w,L,C,P,D,Q,re,G,se,ee,ie,H,T,R;function O(Z){var X=i.ExternalInterface[Z];return typeof X=="function"?X:function(){}}function W(Z,X,ue,ge){for(var Oe=s.getElements(X,ue),xe=0;xe<Oe.length;xe++){var Ee=Oe[xe];Ee&&s.bindListener(Ee,Z,ge)}}function ae(Z,X,ue,ge,Oe){const xe=window.parent,Ee=xe.document.createElement(Z);X!==""&&(Ee.id=X);const We=s.getElement(ge,Oe);if(We instanceof xe.Element){switch(ue){case"TO":We.appendChild(Ee);break;case"BEFORE":We.insertAdjacentElement("beforebegin",Ee);break;case"AFTER":We.insertAdjacentElement("afterend",Ee);break}t.htmlElements.add(Ee)}else console.error('add HTML element puzzle: Invalid element "'+ge+'"')}function ne(Z,X,ue,ge){for(var Oe=s.getElements(ue,ge),xe=0;xe<Oe.length;xe++){var Ee=Oe[xe];Ee&&((Z=="href"||Z=="src")&&X instanceof Promise?X.then(function(We){Ee[Z]=We}):Ee[Z]=X)}}function oe(Z,X,ue){s.retrieveObjectNames(X).forEach(function(Oe){if(!Oe)return;var xe=s.getObjectByName(Oe);if(!xe||!xe.isCamera)return;if(!(xe.isPerspectiveCamera||xe.isOrthographicCamera)){console.error("set camera param puzzle: Incompatible camera type, have to be perspective or orthographic");return}let Ee=!1,We=!1;switch(Z){case"ORBIT_MIN_DISTANCE_PERSP":case"ORBIT_MAX_DISTANCE_PERSP":case"ORBIT_MIN_ZOOM_ORTHO":case"ORBIT_MAX_ZOOM_ORTHO":case"ORBIT_MIN_VERTICAL_ANGLE":case"ORBIT_MAX_VERTICAL_ANGLE":case"ORBIT_MIN_HORIZONTAL_ANGLE":case"ORBIT_MAX_HORIZONTAL_ANGLE":case"ORBIT_ALLOW_TURNOVER":case"SCREEN_SPACE_PANNING":Ee=!0;break;case"ENABLE_COLLISIONS":We=!0;break}let Je=["ROTATION_SPEED","MOVEMENT_SPEED","ALLOW_PANNING","ALLOW_ZOOM","ALLOW_CTRL_ZOOM","KEYBOARD_CONTROLS"].includes(Z)||Ee||We;if(Je)if(xe.controlSettings){if(Ee&&xe.controlSettings.type!="ORBIT"||We&&xe.controlSettings.type!="FIRST_PERSON"){console.error("set camera param puzzle: Incompatible camera controls: "+xe.controlSettings.type);return}}else{console.error('set camera param puzzle: The "'+Oe+'" camera has no control settings assigned');return}switch(Z){case"FIELD_OF_VIEW":if(xe.isPerspectiveCamera)xe.fov=ue,xe.updateProjectionMatrix();else{console.error("set camera param puzzle: Incompatible camera type, have to be perspective");return}break;case"ORTHO_SCALE":if(xe.isOrthographicCamera)xe.zoom=ue,xe.updateProjectionMatrix();else{console.error("set camera param puzzle: Incompatible camera type, have to be orthographic");return}break;case"ROTATION_SPEED":xe.controlSettings.rotateSpeed=ue;break;case"MOVEMENT_SPEED":xe.controlSettings.moveSpeed=ue;break;case"ALLOW_PANNING":xe.controlSettings.enablePan=ue;break;case"ALLOW_ZOOM":xe.controlSettings.enableZoom=ue;break;case"ALLOW_CTRL_ZOOM":xe.controlSettings.enableCtrlZoom=ue;break;case"KEYBOARD_CONTROLS":xe.controlSettings.enableKeys=ue;break;case"ORBIT_MIN_DISTANCE_PERSP":if(xe.isPerspectiveCamera)xe.controlSettings.orbitMinDistance=ue;else{console.error("set camera param puzzle: Incompatible camera type, have to be perspective");return}break;case"ORBIT_MAX_DISTANCE_PERSP":if(xe.isPerspectiveCamera)xe.controlSettings.orbitMaxDistance=ue;else{console.error("set camera param puzzle: Incompatible camera type, have to be perspective");return}break;case"ORBIT_MIN_ZOOM_ORTHO":if(xe.isOrthographicCamera)xe.controlSettings.orbitMinZoom=ue;else{console.error("set camera param puzzle: Incompatible camera type, have to be orthographic");return}break;case"ORBIT_MAX_ZOOM_ORTHO":if(xe.isOrthographicCamera)xe.controlSettings.orbitMaxZoom=ue;else{console.error("set camera param puzzle: Incompatible camera type, have to be orthographic");return}break;case"ORBIT_MIN_VERTICAL_ANGLE":xe.controlSettings.orbitMinPolarAngle=n.MathUtils.degToRad(ue);break;case"ORBIT_MAX_VERTICAL_ANGLE":xe.controlSettings.orbitMaxPolarAngle=n.MathUtils.degToRad(ue);break;case"ORBIT_MIN_HORIZONTAL_ANGLE":xe.controlSettings.orbitMinAzimuthAngle=n.MathUtils.degToRad(ue);break;case"ORBIT_MAX_HORIZONTAL_ANGLE":xe.controlSettings.orbitMaxAzimuthAngle=n.MathUtils.degToRad(ue);break;case"ORBIT_ALLOW_TURNOVER":xe.controlSettings.orbitEnableTurnover=ue;break;case"SCREEN_SPACE_PANNING":xe.controlSettings.screenSpacePanning=ue;break;case"ENABLE_COLLISIONS":xe.controlSettings.enableCollisions=ue;break;case"CLIP_START":xe.near=ue,xe.updateProjectionMatrix();break;case"CLIP_END":xe.far=ue,xe.updateProjectionMatrix();break}Je&&i.enableControls()})}function F(Z,X){window.setTimeout(X,1e3*Z)}function k(Z,X,ue,ge,Oe,xe){if(s.isObjectWorthProcessing(Z)){{const Ee=Z.name;switch(X){case"ALL":case"FIRST":xe.indexOf(Ee)<0&&xe.push(Ee);break;case"ANNOTATION":Z.isAnnotation&&xe.indexOf(Ee)<0&&xe.push(Ee);break;case"BONE":Z.isBone&&xe.indexOf(Ee)<0&&xe.push(Ee);break;case"CAMERA":Z.isCamera&&xe.indexOf(Ee)<0&&xe.push(Ee);break;case"EMPTY":!Z.isAnnotationControl&&!Z.isBone&&!Z.isCamera&&!Z.isGroup&&!Z.isLine&&!Z.isLOD&&!Z.isLight&&!s.isMeshObject(Z)&&!Z.isPoints&&!Z.isScene&&!Z.isSprite&&xe.indexOf(Ee)<0&&xe.push(Ee);break;case"LIGHT":Z.isLight&&xe.indexOf(Ee)<0&&xe.push(Ee);break;case"MESH":s.isMeshObject(Z)&&xe.indexOf(Ee)<0&&xe.push(Ee);break;default:console.error("get objects from puzzle: Unknown object type: "+X);break}}for(let Ee=0;Ee<Z.children.length;Ee++){const We=Z.children[Ee];k(We,X,ue,ge,Oe,xe)}}}function q(Z,X,ue,ge,Oe){const xe=[],Ee=s.retrieveObjectNames(Z);for(let We=0;We<Ee.length;We++){const Je=Ee[We];if(!Je)continue;const $e=s.getObjectByName(Je);$e&&k($e,X,ue,ge,Oe,xe)}return X=="FIRST"?xe[0]:xe}function j(Z,X){for(var ue=s.retrieveObjectNames(Z),ge=0;ge<ue.length;ge++){var Oe=ue[ge];if(Oe){var xe=s.getObjectByName(Oe);xe&&(xe.visible=X,xe.resolveMultiMaterial().forEach(function(Ee){Ee.visible=X}))}}}function U(Z,X,ue){var ge=s.getElement(X,ue);return ge?ge[Z]:""}function z(Z){s.isDataUrl(Z)&&(Z=s.extractDataUrlData(Z));try{return JSON.parse(Z)}catch{return console.error("read JSON puzzle: could not interpret data."),null}}function v(Z,X,ue){if(Z&&typeof Z=="object")return X in Z?Z[X]:ue}function M(Z,X,ue){if(!X)return;const ge=s.retrieveObjectNames(Z);for(let Oe=0;Oe<ge.length;Oe++){const xe=ge[Oe];if(!xe)continue;let Ee=s.getObjectByName(xe);Ee&&(Ee.resolveMultiMaterial().forEach(function(We){if(We.morphTargetDictionary&&X in We.morphTargetDictionary){const Je=We.morphTargetDictionary[X];We.morphTargetInfluences[Je]=Number(ue)}}),Ee.resolveMultiMaterial().forEach(function(We){We.getAuxClippingMeshes().forEach(function(Je){if(Je.morphTargetDictionary&&X in Je.morphTargetDictionary){const $e=Je.morphTargetDictionary[X];Je.morphTargetInfluences[$e]=Number(ue)}})}))}}function S(Z,X,ue){var ge=s.getMaterialEditableValues(Z);if(!(ge.indexOf(X)<0))for(var Oe=n.SceneUtils.getMaterialsByName(i,Z),xe=0;xe<Oe.length;xe++){var Ee=Oe[xe];if(Ee.isMeshNodeMaterial){var We=Ee.nodeValueMap[X];Ee.nodeValue[We]=Number(ue)}else Ee[X]=Number(ue);i.scene!==null&&Ee===i.scene.worldMaterial&&i.updateEnvironment(Ee)}}function I(){ie=z(U("value","configJSON",!0)),ie&&typeof ie=="object"&&ie.hasOwnProperty("type")?(P=v(ie,"type"),C=v(ie,"data"),T=v(ie,"parameters"),G=v(ie,"roedeConfiguratieDetails"),H=O("calculateMinMaxDimensions")(C,T),se=O("checkSchuifdeurVoorWand")(C),O("setData")(C,P),rt(),rn(),Di(),xo(),Eo(),xl(),jn(),wc(),Vr(),Ms(),Mc(),Ed(),oa(),fi(),Ts(),Te(),oe("FIELD_OF_VIEW","Camera",re),u?Rt():En(),u==!0&&(j(["GROUP","Load step 4 - Interieur woonkamer"],!0),F(1,function(){ae("div","generateRenderDone","TO",["BODY"],!0),ne("className","generateRenderDone","generateRenderDone",!0),ne("id","generateRenderDone","generateRenderDone",!0),console.log("generateRenderDone")})),M("Kamer","breedte_sparing",(Math.min(Math.max(v(H,"totalWidth"),.1),6)-.1)/(6-.1)*1+0),M("Plinten","breedte_sparing",(Math.min(Math.max(v(H,"totalWidth"),.1),6)-.1)/(6-.1)*1+0),M("Kamer","hoogte_sparing",(Math.min(Math.max(v(H,"totalHeight"),.2),4)-.2)/(4-.2)*1+0),M("Kamer","hoge_kamer",(Math.min(Math.max(v(H,"totalHeight"),3),4)-3)/1*1+0),$(),j(["GROUP","Load step 3 - Basis"],!0),j(["GROUP","Load step 4 - Interieur woonkamer"],!0),j(["GROUP","Load step 5 - Interieur keuken"],!0),B()?(j("Plinten",!1),j(["GROUP","Load step 5 - Interieur keuken"],!1),S("Visgraatvloer","Schaduwslag",0)):(j("Plinten",!0),j(["GROUP","Load step 5 - Interieur keuken"],!0),S("Visgraatvloer","Schaduwslag",1))):console.log("Geen data"),F(.1,function(){})}function J(){O("getBaseUrl")().length>0&&(c=!0)}function $(){v(H,"totalWidth")>2?(M("Spiegel","verplaatsing_meubels",(Math.min(Math.max((v(H,"totalWidth")-2)/2,0),2)-0)/2*1+0),M("Dressoir","verplaatsing_meubels",(Math.min(Math.max((v(H,"totalWidth")-2)/2,0),2)-0)/2*1+0),M("Vaas.001","verplaatsing_meubels",(Math.min(Math.max((v(H,"totalWidth")-2)/2,0),2)-0)/2*1+0),M("Vlak.002","verplaatsing_meubels",(Math.min(Math.max((v(H,"totalWidth")-2)/2,0),2)-0)/2*1+0),M("Vlak.003","verplaatsing_meubels",(Math.min(Math.max((v(H,"totalWidth")-2)/2,0),2)-0)/2*1+0)):(M("Spiegel","verplaatsing_meubels",0),M("Dressoir","verplaatsing_meubels",0),M("Vaas.001","verplaatsing_meubels",0),M("Vlak.002","verplaatsing_meubels",0),M("Vlak.003","verplaatsing_meubels",0))}function B(){return!!(v(C,"maatvoering_weergeven")||O("getMaatvoeringScreenshot")())}function V(Z){const X=window.navigator.userAgent,ue=window.navigator.platform;let ge,Oe;switch(Z){case"MOBILE":return/Android|webOS|BlackBerry/i.test(X)||n.Detector.checkIOS();case"ANDROID":return/Android/i.test(X);case"IOS":return n.Detector.checkIOS();case"WINDOWS":return["Win32","Win64","Windows","WinCE"].indexOf(ue)!==-1;case"MACOS":return["Macintosh","MacIntel","MacPPC","Mac68K"].indexOf(ue)!==-1&&!n.Detector.checkIOS();case"CHROMEOS":return/(CrOS)/.test(X);case"LINUX":return/Linux/.test(ue);case"CHROME":return!!window.chrome&&!/Edge/.test(navigator.userAgent);case"FIREFOX":return/Firefox/.test(navigator.userAgent);case"IE":return/Trident/.test(navigator.userAgent);case"EDGE":return/Edge/.test(navigator.userAgent);case"SAFARI":return/Safari/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent);case"TOUCH":return n.Detector.isTouchDevice();case"RETINA":return window.devicePixelRatio>=2;case"HDR":return i.useHDR;case"WEBAUDIO":return n.Detector.checkWebAudio();case"WEBGL":return ge=document.createElement("canvas"),Oe=ge.getContext("webgl"),!!Oe;case"WEBGL2":return ge=document.createElement("canvas"),Oe=ge.getContext("webgl2"),!!Oe;case"WOOCOMMERCE":try{return!!(window.parent.v3d_woo_get_product_info||window.parent.parent.v3d_woo_get_product_info)}catch{return!1}case"DO_NOT_TRACK":return navigator.doNotTrack=="1"||window.doNotTrack=="1";default:return!1}}function Y(Z){i.useHiDPIRenderPass||i.renderer.setPixelRatio(Z),i.postprocessing&&i.postprocessing.composer.setPixelRatio(Z),i.onResize()}function le(Z){switch(Z){case"VENDOR":return n.Detector.getGPUVendor(i.renderer);case"MODEL":return n.Detector.getGPUModel(i.renderer)}}function me(Z,X){const ue={};Z=Array.isArray(Z)?Z:Z.split(/\r?\n/).filter(ge=>ge).map(ge=>ge.trim()),X=Array.isArray(X)?X:X.split(/\r?\n/).map(ge=>ge.trim());for(let ge=0;ge<Z.length;ge++)ue[Z[ge]]=X[ge];return ue}function fe(Z,X,ue,ge){if(Z){var Oe=s.getObjectByName(Z);if(Oe){var xe=s.getSceneCoordSystem(),Ee;if(X&&Oe.parent)ue==="position"?Ee=s.transformCoordsSpace(Oe.getWorldPosition(t.vec3Tmp),"Y_UP_RIGHT",xe,ue==="scale"):ue==="rotation"?Ee=s.transformCoordsSpace(Oe.getWorldEuler(t.eulerTmp,"XYZ"),"Y_UP_RIGHT",xe,ue==="scale"):ue==="scale"&&(Ee=s.transformCoordsSpace(Oe.getWorldScale(t.vec3Tmp),"Y_UP_RIGHT",xe,ue==="scale"));else if(ue==="rotation"&&xe=="Z_UP_RIGHT")Ee=s.transformEulerV3dToBlenderShortest(Oe.rotation,t.eulerTmp);else if(ue==="rotation"&&xe=="Y_UP_RIGHT"){var We=s.RotationInterface.initObject(Oe);Ee=We.getUserRotation(t.eulerTmp)}else Ee=s.transformCoordsSpace(Oe[ue].clone(),"Y_UP_RIGHT",xe,ue==="scale");return ue==="rotation"&&(Ee.x=n.MathUtils.radToDeg(Ee.x),Ee.y=n.MathUtils.radToDeg(Ee.y),Ee.z=n.MathUtils.radToDeg(Ee.z)),ge=="xyz"?Ee.toArray().slice(0,3):Ee[ge]}}}function te(Z,X,ue,ge,Oe){var xe=i.getCamera();if(Array.isArray(Z)){var Ee=t.vec3Tmp.fromArray(Z);Ee=s.transformCoordsSpace(Ee,s.getSceneCoordSystem(),"Y_UP_RIGHT")}else if(Z){var We=s.getObjectByName(Z);if(!We)return;var Ee=We.getWorldPosition(t.vec3Tmp)}else var Ee=xe.getWorldPosition(t.vec3Tmp);if(Array.isArray(X)){var Je=t.vec3Tmp2.fromArray(X);Je=s.transformCoordsSpace(Je,s.getSceneCoordSystem(),"Y_UP_RIGHT")}else{var $e=s.getObjectByName(X);if(!$e)return;var Je=$e.getWorldPosition(t.vec3Tmp2)}ue=Math.max(0,ue),i.controls&&i.controls.tween?i.controls.inTween||i.controls.tween(Ee,Je,ue,ge,Oe):(xe.parent&&xe.parent.worldToLocal(Ee),xe.position.copy(Ee),xe.lookAt(Je),ge())}function de(){s.Tween.update()}i.renderCallbacks.push(de),o.editorRenderCallbacks&&o.editorRenderCallbacks.push([i,de]),t.animateParamUpdate=0,t.animateParamTweenInstance={};function we(Z,X,ue,ge,Oe,xe,Ee,We,Je,$e){var ht=s.Tween.Easing.Linear.None,st=typeof Z!="number";st||(Z=[Z],X=[X]);const tn=new s.Tween.Tween(Z).to(X,ue*1e3).easing(ht).repeat(xe).yoyo(Ee).onUpdate(function(Bn){st?t.animateParamUpdate=Bn:t.animateParamUpdate=Bn[0],Je()}).onComplete(function(Bn){$e()}).start();t.animateParamTweenInstance[We]=tn}function Ie(){oe("ORBIT_MIN_HORIZONTAL_ANGLE","Camera",0),oe("ORBIT_MAX_HORIZONTAL_ANGLE","Camera",20),oe("ORBIT_MIN_VERTICAL_ANGLE","Camera",80),oe("ORBIT_MAX_VERTICAL_ANGLE","Camera",95),oe("ORBIT_MIN_DISTANCE_PERSP","Camera",1),oe("ORBIT_MAX_DISTANCE_PERSP","Camera",7),v(H,"totalHeightInclDimensions")>3.5?oe("FIELD_OF_VIEW","Camera",40):oe("FIELD_OF_VIEW","Camera",re)}function Ne(){oe("ORBIT_MIN_HORIZONTAL_ANGLE","Camera",160),oe("ORBIT_MAX_HORIZONTAL_ANGLE","Camera",190),oe("ORBIT_MIN_VERTICAL_ANGLE","Camera",80),oe("ORBIT_MAX_VERTICAL_ANGLE","Camera",95),oe("ORBIT_MIN_DISTANCE_PERSP","Camera",1),oe("FIELD_OF_VIEW","Camera",Q)}function He(){oe("ORBIT_MIN_HORIZONTAL_ANGLE","Camera",90),oe("ORBIT_MAX_HORIZONTAL_ANGLE","Camera",270),oe("ORBIT_MIN_VERTICAL_ANGLE","Camera",50),oe("ORBIT_MAX_VERTICAL_ANGLE","Camera",130),oe("ORBIT_MIN_DISTANCE_PERSP","Camera",1),oe("FIELD_OF_VIEW","Camera",32)}function je(){te([0,-7,v(H,"middlePositionZInclDimensions")],[0,0,v(H,"middlePositionZInclDimensions")],2,function(){Ie()},0),we(Q,re,2,"Linear","In",0,!1,"N?tAuva-gwL%|9i#Qx,,",function(){oe("FIELD_OF_VIEW","Camera",t.animateParamUpdate||0)},function(){})}function ct(Z,X,ue,ge,Oe){t.objMovementInfos=t.objMovementInfos||{};function xe(Je,$e,ht){if(t.objMovementInfos[Je]){var st=t.objMovementInfos[Je];st.prevPosX=$e.position.x,st.prevPosY=$e.position.y,st.prevPosZ=$e.position.z,st.prevRotX=$e.rotation.x,st.prevRotY=$e.rotation.y,st.prevRotZ=$e.rotation.z,st.prevScaX=$e.scale.x,st.prevScaY=$e.scale.y,st.prevScaZ=$e.scale.z,st.prevIsMoving=ht}else{var st={prevPosX:$e.position.x,prevPosY:$e.position.y,prevPosZ:$e.position.z,prevRotX:$e.rotation.x,prevRotY:$e.rotation.y,prevRotZ:$e.rotation.z,prevScaX:$e.scale.x,prevScaY:$e.scale.y,prevScaZ:$e.scale.z,prevIsMoving:ht};t.objMovementInfos[Je]=st}return st}function Ee(Je,$e,ht){var st=t.objMovementInfos[Je]||xe(Je,$e,!1),tn=X*ht,Bn=Math.abs($e.position.x-st.prevPosX)>tn||Math.abs($e.position.y-st.prevPosY)>tn||Math.abs($e.position.z-st.prevPosZ)>tn||Math.abs($e.rotation.x-st.prevRotX)>tn||Math.abs($e.rotation.y-st.prevRotY)>tn||Math.abs($e.rotation.z-st.prevRotZ)>tn||Math.abs($e.scale.x-st.prevScaX)>tn||Math.abs($e.scale.y-st.prevScaY)>tn||Math.abs($e.scale.z-st.prevScaZ)>tn;!st.prevIsMoving&&Bn||st.prevIsMoving&&Bn?xe(Je,$e,!0):(st.prevIsMoving,xe(Je,$e,!1))}function We(Je){function $e(ht,st){for(var tn=s.retrieveObjectNames(Je),Bn=0;Bn<tn.length;Bn++){var Vn=tn[Bn],_n=s.getObjectByName(Vn);if(!_n)return;Ee(Vn,_n,ht)}}i.renderCallbacks.push($e),o.editorRenderCallbacks&&o.editorRenderCallbacks.push([i,$e])}We(Z)}function Vt(){return fe("Camera",!1,"position","y")<=0}function En(){oe("ALLOW_PANNING","Camera",!0),B()&&!Vt()?je():v(H,"middlePositionZ")>0&&te([0,fe("Camera",!1,"position","y")<=0?-7:5.5,B()?v(H,"middlePositionZInclDimensions"):v(H,"middlePositionZ")],[0,0,B()?v(H,"middlePositionZInclDimensions"):v(H,"middlePositionZ")],.5,function(){fe("Camera",!1,"position","y")>=0?Ne():Ie()},0)}function Rt(){oe("ALLOW_PANNING","Camera",!0),oe("FIELD_OF_VIEW","Camera",36),te([.02,-7,v(H,"middlePositionZInclDimensions")],[0,0,v(H,"middlePositionZInclDimensions")],.1,function(){},0)}function pe(Z){var X=Number(Z);return isNaN(X)&&(X=0),X}function Te(){if(B()?So("AfmetingenZijkant",pe(v(C,"hoogte")),v(H,"maxPositionX"),0,"Verticaal",.2,0,null,pe(v(C,"hoogte"))*.01):Ln("AfmetingenZijkant"),B()&&v(C,"bovenlicht")==!0?So("AfmetingenZijkantBovenlicht",pe(v(C,"hoogtebovenlicht")),v(H,"maxPositionX"),pe(v(C,"hoogte"))*.01,"Verticaal",.2,0,null,pe(v(C,"hoogtebovenlicht"))*.01):Ln("AfmetingenZijkantBovenlicht"),B()&&(v(C,"deur_aantal")>1||v(C,"zijpaneel_aantal_links")>0||v(C,"zijpaneel_aantal_rechts")>0)?So("AfmetingenBovenkant",v(H,"totalWidthCmString"),v(H,"minPositionX"),v(H,"totalHeight")+.1,"Horizontaal",0,O("getDimensionOffsetZ")(C,ee,"AfmetingenBovenkant"),v(H,"totalWidth"),null):Ln("AfmetingenBovenkant"),B())for(let Z=1;Z<=10;Z++)v(C,"deur_aantal")>=Z?So("AfmetingenBreedteDeur"+String(Z),v(O("customFunctionGetPanelWidth")(C,Z),"panelWidthCm"),P=="vaste-wand"?O("customFunctionVasteWandCalculatePositieX")(Z,C,T,H):pe(v(C,"breedte"))*(Z-1)*.01-v(H,"offsetPositionX"),v(H,"totalHeight")+0,"Horizontaal",0,O("getDimensionOffsetZ")(C,ee,"AfmetingenBreedteDeur"),v(O("customFunctionGetPanelWidth")(C,Z),"panelWidthM"),null):Ln("AfmetingenBreedteDeur"+String(Z));else for(let Z=1;Z<=10;Z++)Ln("AfmetingenBreedteDeur"+String(Z));if(B()&&v(C,"roede_design_keuze")==!1)for(let Z=1;Z<=4;Z++)v(C,"deur_aantal_ligger")>=Z?So("AfmetingenLigger"+String(Z),v(C,"asymmetrisch")==!0?v(C,"asymmetrisch_ligger_maten")[Z-1]:Z*(v(C,"hoogte")/(v(C,"deur_aantal_ligger")+1)),v(H,"minPositionX"),(v(C,"asymmetrisch")==!0?v(C,"asymmetrisch_ligger_maten")[Z-1]:Z*(v(C,"hoogte")/(v(C,"deur_aantal_ligger")+1)))*.01,"Maatpunt links/rechts",-.2,0,.05,null):Ln("AfmetingenLigger"+String(Z));else for(let Z=1;Z<=4;Z++)Ln("AfmetingenLigger"+String(Z));if(B())for(let Z=1;Z<=10;Z++)if(v(C,"deur_aantal")>=Z)for(let X=1;X<=4;X++)v(C,"deur_aantal_staander")>=X?So(["AfmetingenPaneel",Z,"Staander",X].join(""),v(Rs(["Paneel",Z,"Staander",X].join("")),"shapeKeyVerplaatsing"),v(Rs(["Paneel",Z,"Staander",X].join("")),"staanderPositionX"),v(H,"totalHeight"),"Maatpunt staander",0,O("getDimensionOffsetZ")(C,ee,null),null,.05):Ln(["AfmetingenPaneel",Z,"Staander",X].join(""));else for(let X=1;X<=4;X++)Ln(["AfmetingenPaneel",Z,"Staander",X].join(""));else for(let Z=1;Z<=10;Z++)for(let X=1;X<=4;X++)Ln(["AfmetingenPaneel",Z,"Staander",X].join(""));if(B())for(let Z=1;Z<=4;Z++)if(v(C,"zijpaneel_aantal_links")>=Z&&["taatsdeur","scharnierdeur","schuifdeur"].indexOf(P)>-1){So("AfmetingenZijpaneelLinks"+String(Z),pe(v(C,"zijpaneel_breedte_links")[Z-1]),O("customFunctionTaatsdeurZijpaneelLinksCalculatePositieX")(Z,C,T,H),v(H,"totalHeight"),"Horizontaal",0,O("getDimensionOffsetZ")(C,ee,"ZijpaneelFrame"),pe(v(C,"zijpaneel_breedte_links")[Z-1])*.01,null);for(let X=1;X<=4;X++)v(C,"zijpaneel_aantal_staander")>=X?So(["AfmetingenZijpaneelLinks",Z,"Staander",X].join(""),v(Rs(["ZijpaneelLinks",Z,"Staander",X].join("")),"shapeKeyVerplaatsing"),v(Rs(["ZijpaneelLinks",Z,"Staander",X].join("")),"staanderPositionX"),v(H,"totalHeight"),"Maatpunt staander",0,O("getDimensionOffsetZ")(C,ee,null),null,.05):Ln(["AfmetingenZijpaneelLinks",Z,"Staander",X].join(""))}else{Ln("AfmetingenZijpaneelLinks"+String(Z));for(let X=1;X<=4;X++)Ln(["AfmetingenZijpaneelLinks",Z,"Staander",X].join(""))}else for(let Z=1;Z<=4;Z++){Ln("AfmetingenZijpaneelLinks"+String(Z));for(let X=1;X<=4;X++)Ln(["AfmetingenZijpaneelLinks",Z,"Staander",X].join(""))}if(B())for(let Z=1;Z<=4;Z++)if(v(C,"zijpaneel_aantal_rechts")>=Z&&["taatsdeur","scharnierdeur","schuifdeur"].indexOf(P)>-1){So("AfmetingenZijpaneelRechts"+String(Z),pe(v(C,"zijpaneel_breedte_rechts")[Z-1]),O("customFunctionTaatsdeurZijpaneelRechtsCalculatePositieX")(Z,C,T,H),v(H,"totalHeight"),"Horizontaal",0,O("getDimensionOffsetZ")(C,ee,"ZijpaneelFrame"),pe(v(C,"zijpaneel_breedte_rechts")[Z-1])*.01,null);for(let X=1;X<=4;X++)v(C,"zijpaneel_aantal_staander")>=X?So(["AfmetingenZijpaneelRechts",Z,"Staander",X].join(""),v(Rs(["ZijpaneelRechts",Z,"Staander",X].join("")),"shapeKeyVerplaatsing"),v(Rs(["ZijpaneelRechts",Z,"Staander",X].join("")),"staanderPositionX"),v(H,"totalHeight"),"Maatpunt staander",0,O("getDimensionOffsetZ")(C,ee,null),null,.05):Ln(["AfmetingenZijpaneelRechts",Z,"Staander",X].join(""))}else{Ln("AfmetingenZijpaneelRechts"+String(Z));for(let X=1;X<=4;X++)Ln(["AfmetingenZijpaneelRechts",Z,"Staander",X].join(""))}else for(let Z=1;Z<=4;Z++){Ln("AfmetingenZijpaneelRechts"+String(Z));for(let X=1;X<=4;X++)Ln(["AfmetingenZijpaneelRechts",Z,"Staander",X].join(""))}}function Ce(Z){return v(C,"deurbreedtevariabel")?pe(v(C,"variabeledeurbreedte_maten")[Z-1]):pe(v(C,"breedte"))}function Zt(){return v(C,"deurbreedtevariabel")?pe(v(C,"variabeledeurbreedte_maten")[v(C,"deur_aantal")-1]):pe(v(C,"breedte"))}function rt(){var Z=pe(v(T,"vasteWandMaxPanelen")),X=1;1>Z&&(X=-X);for(let ue=1;X>=0?ue<=Z:ue>=Z;ue+=X)v(C,"deur_aantal")>=ue&&P=="vaste-wand"?(sn("ALU-Vaste wand",["vaste-wand",ue,"Frame"].join(""),Ce(ue),10,x,v(C,"hoogte"),L,D,O("customFunctionVasteWandCalculatePositieX")(ue,C,T,H),0,0),Cn("ALU-Vaste wand",Ze(["vaste-wand",ue,"Frame"].join("")),"ALU-Vaste wand_Glas",["vaste-wand",ue,"Glas"].join(""),Ce(ue),10,x,v(C,"hoogte"),L,D)):(ft(["vaste-wand",ue,"Frame"].join("")),ln(["vaste-wand",ue,"Glas"].join("")))}function rn(){v(C,"deur_aantal")>=1&&P=="taatsdeur"?(sn("ALU-Taatsdeur_Frame",["taatsdeur",1,"Frame"].join(""),pe(v(C,"breedte")),l,x,pe(v(C,"hoogte")),L,D,0-v(H,"offsetPositionX"),0,0),Cn("ALU-Taatsdeur_Frame",Ze([P,1,"Frame"].join("")),"ALU-Taatsdeur_Glas",["taatsdeur",1,"Glas"].join(""),pe(v(C,"breedte")),l,x,pe(v(C,"hoogte")),L,D),ut("ALU-Taatsdeur_Frame",Ze(["taatsdeur",1,"Frame"].join("")),Se(),["taatsdeur",1,"Handgreep"].join(""),pe(v(C,"breedte")),0,x,pe(v(C,"hoogte")),L,D,v(C,"deur_aantal")==1&&v(C,"draairichting")=="DRAAI_RECHTS"?"Links":"Rechts"),jo(Ze(["taatsdeur",1,"Frame"].join("")),"Bovenscharnier taats",["taatsdeur",1,"ScharnierBoven"].join(""),pe(v(C,"breedte")),pe(v(C,"hoogte")),v(C,"deur_aantal")==1&&v(C,"draairichting")=="DRAAI_RECHTS"?"Rechts":"Links"),jo(Ze(["taatsdeur",1,"Frame"].join("")),"Onderscharnier taats",["taatsdeur",1,"ScharnierOnder"].join(""),pe(v(C,"breedte")),0,v(C,"deur_aantal")==1&&v(C,"draairichting")=="DRAAI_RECHTS"?"Rechts":"Links")):(ft(["taatsdeur",1,"Frame"].join("")),ln(["taatsdeur",1,"Glas"].join("")),ce(["taatsdeur",1,"Handgreep"].join("")),Tr(["taatsdeur",1,"ScharnierBoven"].join("")),Tr(["taatsdeur",1,"ScharnierOnder"].join("")))}function Di(){v(C,"deur_aantal")>=2&&P=="taatsdeur"?(sn("ALU-Taatsdeur_Frame",["taatsdeur",2,"Frame"].join(""),pe(v(C,"breedte")),l,x,pe(v(C,"hoogte")),L,D,pe(Math.min(Math.max(v(C,"breedte"),v(T,"taatsDeurMinBreedte")),v(T,"taatsDeurMaxBreedte")))*.01-v(H,"offsetPositionX"),0,0),Cn("ALU-Taatsdeur_Frame",Ze([P,2,"Frame"].join("")),"ALU-Taatsdeur_Glas",["taatsdeur",2,"Glas"].join(""),pe(v(C,"breedte")),l,x,pe(v(C,"hoogte")),L,D),ut("ALU-Taatsdeur_Frame",Ze(["taatsdeur",2,"Frame"].join("")),Se(),["taatsdeur",2,"Handgreep"].join(""),pe(v(C,"breedte")),0,x,pe(v(C,"hoogte")),L,D,"Links"),jo(Ze(["taatsdeur",2,"Frame"].join("")),"Bovenscharnier taats",["taatsdeur",2,"ScharnierBoven"].join(""),pe(v(C,"breedte")),pe(v(C,"hoogte")),"Rechts"),jo(Ze(["taatsdeur",2,"Frame"].join("")),"Onderscharnier taats",["taatsdeur",2,"ScharnierOnder"].join(""),pe(v(C,"breedte")),0,"Rechts")):(ft(["taatsdeur",2,"Frame"].join("")),ln(["taatsdeur",2,"Glas"].join("")),ce(["taatsdeur",2,"Handgreep"].join("")),Tr(["taatsdeur",2,"ScharnierBoven"].join("")),Tr(["taatsdeur",2,"ScharnierOnder"].join("")))}function xo(){v(C,"deur_aantal")>=1&&P=="scharnierdeur"?(Bi("ALU-Kozijn",[P,1,"Kozijn"].join(""),(v(C,"zijpaneel_aantal_links")>0?1.7:0)+(v(C,"zijpaneel_aantal_rechts")>0?1.7:0)+v(C,"deur_aantal")*pe(v(C,"breedte")),20,300,pe(v(C,"hoogte")),20,300,(v(C,"zijpaneel_aantal_links")>0?-.017:0)-v(H,"offsetPositionX"),0),sn("ALU-Scharnierdeur",["scharnierdeur",1,"Frame"].join(""),pe(v(C,"breedte")),l,x,pe(v(C,"hoogte")),L,D,0-v(H,"offsetPositionX"),0,0),Cn("ALU-Scharnierdeur",Ze(["scharnierdeur",1,"Frame"].join("")),"ALU-Scharnierdeur_Glas",["scharnierdeur",1,"Glas"].join(""),pe(v(C,"breedte")),l,x,pe(v(C,"hoogte")),L,D),v(C,"deur_aantal")==1||v(C,"deur_aantal")>1&&v(C,"actievedeur")!="ACTIEVEDEUR_RECHTS"?ut("ALU-Scharnierdeur",Ze(["scharnierdeur",1,"Frame"].join("")),Se(),["scharnierdeur",1,"Handgreep"].join(""),pe(v(C,"breedte")),0,x,pe(v(C,"hoogte")),L,D,v(C,"deur_aantal")==1&&v(C,"draairichting")=="DRAAI_RECHTS"?"Links":"Rechts"):ce(["scharnierdeur",1,"Handgreep"].join("")),jo(Ze(["scharnierdeur",1,"Frame"].join("")),"Scharnier",["scharnierdeur",1,"ScharnierBoven"].join(""),pe(v(C,"breedte")),pe(v(C,"hoogte"))-20,v(C,"deur_aantal")==1&&v(C,"draairichting")=="DRAAI_RECHTS"?"Rechts":"Links"),jo(Ze(["scharnierdeur",1,"Frame"].join("")),"Scharnier",["scharnierdeur",1,"ScharnierMidden"].join(""),pe(v(C,"breedte")),pe(v(C,"hoogte"))/2,v(C,"deur_aantal")==1&&v(C,"draairichting")=="DRAAI_RECHTS"?"Rechts":"Links"),jo(Ze(["scharnierdeur",1,"Frame"].join("")),"Scharnier",["taatsdeur",1,"ScharnierOnder"].join(""),pe(v(C,"breedte")),20,v(C,"deur_aantal")==1&&v(C,"draairichting")=="DRAAI_RECHTS"?"Rechts":"Links")):(St(["scharnierdeur",1,"Kozijn"].join("")),ft(["scharnierdeur",1,"Frame"].join("")),ln(["scharnierdeur",1,"Glas"].join("")),ce(["scharnierdeur",1,"Handgreep"].join("")),Tr(["scharnierdeur",1,"ScharnierBoven"].join("")),Tr(["scharnierdeur",1,"ScharnierMidden"].join("")),Tr(["scharnierdeur",1,"ScharnierOnder"].join("")))}function Eo(){v(C,"deur_aantal")>=2&&P=="scharnierdeur"?(sn("ALU-Scharnierdeur",["scharnierdeur",2,"Frame"].join(""),pe(v(C,"breedte")),l,x,pe(v(C,"hoogte")),L,D,pe(Math.min(Math.max(v(C,"breedte"),v(T,"scharnierDeurMinBreedte")),v(T,"scharnierDeurMaxBreedte")))*.01-v(H,"offsetPositionX"),0,0),Cn("ALU-Scharnierdeur",Ze(["scharnierdeur",2,"Frame"].join("")),"ALU-Scharnierdeur_Glas",["scharnierdeur",2,"Glas"].join(""),pe(v(C,"breedte")),l,x,pe(v(C,"hoogte")),L,D),v(C,"deur_aantal")>1&&v(C,"actievedeur")=="ACTIEVEDEUR_RECHTS"?ut("ALU-Scharnierdeur",Ze(["scharnierdeur",2,"Frame"].join("")),Se(),["scharnierdeur",2,"Handgreep"].join(""),pe(v(C,"breedte")),0,x,pe(v(C,"hoogte")),L,D,"Links"):ce(["scharnierdeur",2,"Handgreep"].join("")),jo(Ze(["scharnierdeur",2,"Frame"].join("")),"Scharnier",["scharnierdeur",2,"ScharnierBoven"].join(""),pe(v(C,"breedte")),pe(v(C,"hoogte"))-20,"Rechts"),jo(Ze(["scharnierdeur",2,"Frame"].join("")),"Scharnier",["scharnierdeur",2,"ScharnierMidden"].join(""),pe(v(C,"breedte")),pe(v(C,"hoogte"))/2,"Rechts"),jo(Ze(["scharnierdeur",2,"Frame"].join("")),"Scharnier",["taatsdeur",2,"ScharnierOnder"].join(""),pe(v(C,"breedte")),20,"Rechts")):(ft(["scharnierdeur",2,"Frame"].join("")),ln(["scharnierdeur",2,"Glas"].join("")),ce(["scharnierdeur",2,"Handgreep"].join("")),Tr(["scharnierdeur",2,"ScharnierBoven"].join("")),Tr(["scharnierdeur",2,"ScharnierMidden"].join("")),Tr(["scharnierdeur",2,"ScharnierOnder"].join("")))}function jn(){P=="schuifdeur"?wo("SchuifdeurBovenrail",se==!0?O("customFunctionBovenRailLengte")(C,T):v(H,"totalWidth")*100,pe(v(C,"hoogte")),se==!0?O("customFunctionSchuifdeurBovenrailCalculatePositieX")(C,T,H):0-v(H,"middlePositionX"),-.05,0):Md("SchuifdeurBovenrail")}function xl(){var Z=pe(v(T,"schuifDeurMaxDeuren")),X=1;1>Z&&(X=-X);for(let ue=1;X>=0?ue<=Z:ue>=Z;ue+=X)v(C,"deur_aantal")>=ue&&P=="schuifdeur"?(sn("ALU-Schuifdeur",["schuifdeur",ue,"Frame"].join(""),pe(v(C,"breedte")),l,x,pe(v(C,"hoogte")),L,D,O("customFunctionSchuifdeurCalculatePositieX")(ue,C,T,H),se==!0?-.125:0,0),Cn("ALU-Schuifdeur",Ze(["schuifdeur",ue,"Frame"].join("")),"ALU-Schuifdeur_Glas",["schuifdeur",ue,"Glas"].join(""),pe(v(C,"breedte")),l,x,pe(v(C,"hoogte")),L,D),ue<=2&&v(C,"deur_aantal")<=2||ue==1&&v(C,"deur_aantal")>2?ut("ALU-Schuifdeur",Ze(["schuifdeur",ue,"Frame"].join("")),Se(),["schuifdeur",ue,"Handgreep"].join(""),pe(v(C,"breedte")),0,x,pe(v(C,"hoogte")),L,D,Sc(ue)):ce(["schuifdeur",ue,"Handgreep"].join(""))):(ft(["schuifdeur",ue,"Frame"].join("")),ln(["schuifdeur",ue,"Glas"].join("")),ce(["schuifdeur",ue,"Handgreep"].join("")))}function Sc(Z){return v(C,"deur_aantal")==1?v(C,"schuifrichting")=="SCHUIF_RECHTS"?"Links":"Rechts":v(C,"deur_aantal")==2?Z==2?"Links":"Rechts":"Links"}function wc(){P=="opdekdeur"?(Bi("Opdekkozijn",["opdekdeur",1,"Kozijn"].join(""),pe(v(C,"breedte")),l,x,pe(v(C,"hoogte")),L,D,0-v(H,"offsetPositionX"),0),sn("ALU-Opdekdeur",["opdekdeur",1,"Frame"].join(""),pe(v(C,"breedte")),l,x,pe(v(C,"hoogte")),L,D,0-v(H,"offsetPositionX"),-.106,0),Cn("ALU-Opdekdeur",Ze(["opdekdeur",1,"Frame"].join("")),"ALU-Opdekdeur_Glas",["opdekdeur",1,"Glas"].join(""),pe(v(C,"breedte")),l,x,pe(v(C,"hoogte")),L,D),ut("ALU-Opdekdeur",Ze(["opdekdeur",1,"Frame"].join("")),Se(),["opdekdeur",1,"Handgreep"].join(""),pe(v(C,"breedte")),0,x,pe(v(C,"hoogte")),L,D,v(C,"deur_aantal")==1&&v(C,"draairichting")=="DRAAI_RECHTS"?"Links":"Rechts")):(St(["opdekdeur",1,"Kozijn"].join("")),ft(["opdekdeur",1,"Frame"].join("")),ln(["opdekdeur",1,"Glas"].join("")),ce(["opdekdeur",1,"Handgreep"].join("")))}function Vr(){if(P=="vouwwand"){Bi("ALU-Vouwwand lijst",["vouwwand",1,"Kozijn"].join(""),pe(v(C,"breedte"))*v(C,"deur_aantal"),20,600,pe(v(C,"hoogte")),20,300,0-v(H,"offsetPositionX"),0);var Z=pe(v(T,"vouwwandMaxPanelen")),X=1;1>Z&&(X=-X);for(let Oe=1;X>=0?Oe<=Z:Oe>=Z;Oe+=X)v(C,"deur_aantal")>=Oe&&P=="vouwwand"?(sn("ALU-Vouwwand deur",["vouwwand",Oe,"Frame"].join(""),(pe(v(C,"breedte"))*v(C,"deur_aantal")-2*4.5)/v(C,"deur_aantal"),l,x,v(C,"hoogte"),20,300,(Oe-1)*((pe(v(C,"breedte"))*v(C,"deur_aantal")-2*4.5)/v(C,"deur_aantal"))*.01-v(H,"offsetPositionX")+.045,0,0),Cn("ALU-Vouwwand deur",Ze(["vouwwand",Oe,"Frame"].join("")),"ALU-Vouwwand_Glas",["vouwwand",Oe,"Glas"].join(""),(pe(v(C,"breedte"))*v(C,"deur_aantal")-2*4.5)/v(C,"deur_aantal"),l,x,v(C,"hoogte"),20,300)):(ft(["vouwwand",Oe,"Frame"].join("")),ln(["vouwwand",Oe,"Glas"].join("")));v(C,"handgreep")=="HANDGREEP_KLINK_1"?ut("ALU-Vouwwand deur",Ze(["vouwwand",1,"Frame"].join("")),Se(),["vouwwand",1,"Handgreep"].join(""),pe(v(C,"breedte")),0,x,pe(v(C,"hoogte")),L,D,"Links"):ce(["vouwwand",1,"Handgreep"].join(""))}else{St(["vouwwand",1,"Kozijn"].join(""));var ue=pe(v(T,"vouwwandMaxPanelen")),ge=1;1>ue&&(ge=-ge);for(let Oe=1;ge>=0?Oe<=ue:Oe>=ue;Oe+=ge)ft(["vouwwand",Oe,"Frame"].join("")),ln(["vouwwand",Oe,"Glas"].join(""));ce(["vouwwand",1,"Handgreep"].join(""))}}function Ms(){var Z=pe(v(T,"maxZijpanelenLinks")),X=1;1>Z&&(X=-X);for(let ue=1;X>=0?ue<=Z:ue>=Z;ue+=X)if(v(C,"zijpaneel_aantal_links")>=ue&&["taatsdeur","scharnierdeur","schuifdeur"].indexOf(P)>-1){if(sn("ALU-Vaste wand",["ZijpaneelLinks",ue,"Frame"].join(""),pe(v(C,"zijpaneel_breedte_links")[ue-1]),10,x,v(C,"bovenlicht")==!0?v(C,"hoogte")+v(C,"hoogtebovenlicht"):v(C,"hoogte"),L,D,O("customFunctionTaatsdeurZijpaneelLinksCalculatePositieX")(ue,C,T,H),0,0),Cn("ALU-Vaste wand",Ze(["ZijpaneelLinks",ue,"Frame"].join("")),"ALU-Vaste wand_Glas",["ZijpaneelLinks",ue,"Glas"].join(""),pe(v(C,"zijpaneel_breedte_links")[ue-1]),10,x,v(C,"bovenlicht")==!0?v(C,"hoogte")+v(C,"hoogtebovenlicht"):v(C,"hoogte"),L,D),v(C,"roede_design_keuze")==!0){for(let ge=1;ge<=4;ge++)ur(["ZijpaneelLinks",ue,"Ligger",ge].join(""));for(let ge=1;ge<=4;ge++)ur(["ZijpaneelLinks",ue,"Staander",ge].join(""));for(let ge=1;ge<=4;ge++)O("checkShapeKeyVerplaatsingRoedeConfiguratie")(ge,v(C,"deur_aantal")==1&&v(C,"draairichting")=="DRAAI_RECHTS"?"Rechts":"Links",C,G)?Ba("Zijlicht",["ZijpaneelLinks",ue,"Ligger",ge].join(""),O("calcShapeKeyVerplaatsingLiggerRoedeConfiguratie")(ge,v(C,"deur_aantal")==1&&v(C,"draairichting")=="DRAAI_RECHTS"?"Rechts":"Links",C,G,P),0,D,pe(v(C,"zijpaneel_breedte_links")[ue-1]),10,x,at(["ZijpaneelLinks",ue,"Frame"].join("")),0,zt(["ZijpaneelLinks",ue,"Frame"].join(""))):ur(["ZijpaneelLinks",ue,"Ligger",ge].join(""))}else for(let ge=1;ge<=4;ge++)v(C,"deur_aantal_ligger")>=ge?Ba("Zijlicht",["ZijpaneelLinks",ue,"Ligger",ge].join(""),v(C,"asymmetrisch")==!0?v(C,"asymmetrisch_ligger_maten")[ge-1]:ge*(Math.min(Math.max(v(C,"hoogte"),v(T,"taatsDeurMinHoogteZijpaneel")),v(T,"taatsDeurMaxHoogteZijpaneel"))/(v(C,"deur_aantal_ligger")+1)),0,D,pe(v(C,"zijpaneel_breedte_links")[ue-1]),10,x,at(["ZijpaneelLinks",ue,"Frame"].join("")),0,zt(["ZijpaneelLinks",ue,"Frame"].join(""))):ur(["ZijpaneelLinks",ue,"Ligger",ge].join(""));for(let ge=1;ge<=4;ge++)v(C,"zijpaneel_aantal_staander")>=ge?El("Zijlicht",["ZijpaneelLinks",ue,"Staander",ge].join(""),v(C,"asymmetrisch")==!0?v(C,"asymmetrisch_staander_maten_zijpaneel")[100+ge]:ge*(pe(v(C,"zijpaneel_breedte_links")[ue-1])/(v(C,"zijpaneel_aantal_staander")+1)),0,x,v(C,"bovenlicht")==!0?v(C,"hoogte")+v(C,"hoogtebovenlicht"):v(C,"hoogte"),L,D,at(["ZijpaneelLinks",ue,"Frame"].join("")),0,zt(["ZijpaneelLinks",ue,"Frame"].join(""))):Co(["ZijpaneelLinks",ue,"Staander",ge].join(""));v(C,"bovenlicht")==!0&&v(C,"bovenlicht_stijl_zijpaneel")==!0?Ba("Zijlicht",["ZijpaneelLinks",ue,"LiggerBovenlicht"].join(""),Math.min(Math.max(v(C,"hoogte"),v(T,"taatsDeurMinHoogteZijpaneel")),v(T,"taatsDeurMaxHoogteZijpaneel")),0,v(T,"taatsDeurMaxHoogteZijpaneel"),pe(v(C,"zijpaneel_breedte_links")[ue-1]),10,x,at(["ZijpaneelLinks",ue,"Frame"].join("")),0,zt(["ZijpaneelLinks",ue,"Frame"].join(""))):ur(["ZijpaneelLinks",ue,"LiggerBovenlicht"].join(""))}else{ft(["ZijpaneelLinks",ue,"Frame"].join("")),ln(["ZijpaneelLinks",ue,"Glas"].join(""));for(let ge=1;ge<=4;ge++)ur(["ZijpaneelLinks",ue,"Ligger",ge].join(""));for(let ge=1;ge<=4;ge++)Co(["ZijpaneelLinks",ue,"Staander",ge].join(""));ur(["ZijpaneelLinks",ue,"LiggerBovenlicht"].join(""))}}function Mc(){var Z=pe(v(T,"maxZijpanelenRechts")),X=1;1>Z&&(X=-X);for(let ue=1;X>=0?ue<=Z:ue>=Z;ue+=X)if(v(C,"zijpaneel_aantal_rechts")>=ue&&["taatsdeur","scharnierdeur","schuifdeur"].indexOf(P)>-1){if(sn("ALU-Vaste wand",["ZijpaneelRechts",ue,"Frame"].join(""),pe(v(C,"zijpaneel_breedte_rechts")[ue-1]),10,x,v(C,"bovenlicht")==!0?v(C,"hoogte")+v(C,"hoogtebovenlicht"):v(C,"hoogte"),L,D,O("customFunctionTaatsdeurZijpaneelRechtsCalculatePositieX")(ue,C,T,H),0,0),Cn("ALU-Vaste wand",Ze(["ZijpaneelRechts",ue,"Frame"].join("")),"ALU-Vaste wand_Glas",["ZijpaneelRechts",ue,"Glas"].join(""),pe(v(C,"zijpaneel_breedte_rechts")[ue-1]),10,x,v(C,"bovenlicht")==!0?v(C,"hoogte")+v(C,"hoogtebovenlicht"):v(C,"hoogte"),L,D),v(C,"roede_design_keuze")==!0){for(let ge=1;ge<=4;ge++)ur(["ZijpaneelRechts",ue,"Ligger",ge].join(""));for(let ge=1;ge<=4;ge++)ur(["ZijpaneelRechts",ue,"Staander",ge].join(""));for(let ge=1;ge<=4;ge++)O("checkShapeKeyVerplaatsingRoedeConfiguratie")(ge,v(C,"deur_aantal")==1&&v(C,"draairichting")=="DRAAI_RECHTS"?"Links":"Rechts",C,G)?Ba("Zijlicht",["ZijpaneelRechts",ue,"Ligger",ge].join(""),O("calcShapeKeyVerplaatsingLiggerRoedeConfiguratie")(ge,v(C,"deur_aantal")==1&&v(C,"draairichting")=="DRAAI_RECHTS"?"Links":"Rechts",C,G,P),0,D,pe(v(C,"zijpaneel_breedte_rechts")[ue-1]),10,x,at(["ZijpaneelRechts",ue,"Frame"].join("")),0,zt(["ZijpaneelRechts",ue,"Frame"].join(""))):ur(["ZijpaneelRechts",ue,"Ligger",ge].join(""))}else for(let ge=1;ge<=4;ge++)v(C,"deur_aantal_ligger")>=ge?Ba("Zijlicht",["ZijpaneelRechts",ue,"Ligger",ge].join(""),v(C,"asymmetrisch")==!0?v(C,"asymmetrisch_ligger_maten")[ge-1]:ge*(Math.min(Math.max(v(C,"hoogte"),v(T,"taatsDeurMinHoogteZijpaneel")),v(T,"taatsDeurMaxHoogteZijpaneel"))/(v(C,"deur_aantal_ligger")+1)),0,v(T,"taatsDeurMaxHoogteZijpaneel"),pe(v(C,"zijpaneel_breedte_rechts")[ue-1]),10,x,at(["ZijpaneelRechts",ue,"Frame"].join("")),0,zt(["ZijpaneelRechts",ue,"Frame"].join(""))):ur(["ZijpaneelRechts",ue,"Ligger",ge].join(""));for(let ge=1;ge<=4;ge++)v(C,"zijpaneel_aantal_staander")>=ge?El("Zijlicht",["ZijpaneelRechts",ue,"Staander",ge].join(""),v(C,"asymmetrisch")==!0?v(C,"asymmetrisch_staander_maten_zijpaneel")[200+ge]:ge*(pe(v(C,"zijpaneel_breedte_rechts")[ue-1])/(v(C,"zijpaneel_aantal_staander")+1)),0,x,v(C,"bovenlicht")==!0?v(C,"hoogte")+v(C,"hoogtebovenlicht"):v(C,"hoogte"),L,D,at(["ZijpaneelRechts",ue,"Frame"].join("")),0,zt(["ZijpaneelRechts",ue,"Frame"].join(""))):Co(["ZijpaneelRechts",ue,"Staander",ge].join(""));v(C,"bovenlicht")==!0&&v(C,"bovenlicht_stijl_zijpaneel")==!0?Ba("Zijlicht",["ZijpaneelRechts",ue,"LiggerBovenlicht"].join(""),Math.min(Math.max(v(C,"hoogte"),v(T,"taatsDeurMinHoogteZijpaneel")),v(T,"taatsDeurMaxHoogteZijpaneel")),0,D,pe(v(C,"zijpaneel_breedte_rechts")[ue-1]),10,x,at(["ZijpaneelRechts",ue,"Frame"].join("")),0,zt(["ZijpaneelRechts",ue,"Frame"].join(""))):ur(["ZijpaneelRechts",ue,"LiggerBovenlicht"].join(""))}else{ft(["ZijpaneelRechts",ue,"Frame"].join("")),ln(["ZijpaneelRechts",ue,"Glas"].join(""));for(let ge=1;ge<=4;ge++)ur(["ZijpaneelRechts",ue,"Ligger",ge].join(""));for(let ge=1;ge<=4;ge++)Co(["ZijpaneelRechts",ue,"Staander",ge].join(""));ur(["ZijpaneelRechts",ue,"LiggerBovenlicht"].join(""))}}function oa(){for(let Z=1;Z<=10;Z++)if(v(C,"deur_aantal")>=Z&&["vaste-wand","taatsdeur","scharnierdeur","schuifdeur","opdekdeur"].indexOf(P)>-1&&v(C,"roede_design_keuze")==!1)for(let X=1;X<=4;X++)v(C,"deur_aantal_staander")>=X?El(P,["Paneel",Z,"Staander",X].join(""),O("calcShapeKeyStaanderVerplaatsing")(C,Z,X),0,x,v(C,"hoogte"),L,D,at([P,Z,"Frame"].join("")),0,zt([P,Z,"Frame"].join(""))):Co(["Paneel",Z,"Staander",X].join(""));else for(let X=1;X<=4;X++)Co(["Paneel",Z,"Staander",X].join(""))}function Ed(){for(let Z=1;Z<=10;Z++)if(v(C,"deur_aantal")>=Z&&["vaste-wand","taatsdeur","scharnierdeur","schuifdeur","opdekdeur","vouwwand"].indexOf(P)>-1&&v(C,"roede_design_keuze")==!1)for(let X=1;X<=4;X++)v(C,"deur_aantal_ligger")>=X?Ba(P,["Paneel",Z,"Ligger",X].join(""),v(C,"asymmetrisch")==!0?pe(v(C,"asymmetrisch_ligger_maten")[X-1]):X*(v(C,"hoogte")/(v(C,"deur_aantal_ligger")+1)),0,D,pe(Ce(Z))-O("calcLiggerBreedteX")(C,T,200,"Paneel"),10,x,at([P,Z,"Frame"].join(""))+O("calcLiggerXPositieOffsetFrame")(C,T),0,zt([P,Z,"Frame"].join(""))):ur(["Paneel",Z,"Ligger",X].join(""));else for(let X=1;X<=4;X++)ur(["Paneel",Z,"Ligger",X].join(""))}function Ts(){if(v(C,"deur_aantal")>=1&&v(C,"bovenlicht")==!0&&["taatsdeur","scharnierdeur"].indexOf(P)>-1)if(sn("ALU-Bovenlicht","BovenlichtFrame",pe(v(C,"breedte"))*v(C,"deur_aantal"),L,D,pe(v(C,"hoogtebovenlicht")),l,x,0-v(H,"offsetPositionX"),0,0+pe(v(C,"hoogte"))*.01),Cn("ALU-Bovenlicht",Ze("BovenlichtFrame"),"ALU-Bovenlicht_Glas","BovenlichtGlas",pe(v(C,"breedte"))*v(C,"deur_aantal"),L,D,pe(v(C,"hoogtebovenlicht")),l,x),v(C,"bovenlicht_verberg_tussenstijl")!=!0&&v(C,"deur_aantal")>1?El("Bovenlicht","BovenlichtStaander",pe(v(C,"breedte")),0,x,pe(v(C,"hoogtebovenlicht")),L,D,at("BovenlichtFrame"),0,zt("BovenlichtFrame")):Co("BovenlichtStaander"),v(C,"roede_design_keuze")==!0)for(let Z=1;Z<=10;Z++)if(v(C,"deur_aantal")>=Z)for(let X=1;X<=4;X++)O("checkShapeKeyVerplaatsingRoedeConfiguratie")(X,"Boven",C,G)?El("Bovenlicht",["Bovenlicht",Z,"Staander",X].join(""),O("calcShapeKeyVerplaatsingStaanderRoedeConfiguratie")(X,Z==2||v(C,"deur_aantal")==1&&v(C,"draairichting")=="DRAAI_RECHTS"?"Mirror":"-",C,G,P),0,x,pe(v(C,"hoogtebovenlicht")),L,D,r_("RoedeConfiguratie"+String(Z))-O("getRoedeConfiguratieBreedte")(C,"RoedeConfiguratie"+String(Z))/2*.01,0,0+pe(v(C,"hoogte"))*.01):Co(["Bovenlicht",Z,"Staander",X].join(""));else for(let X=1;X<=4;X++)Co(["Bovenlicht",Z,"Staander",X].join(""));else for(let Z=1;Z<=10;Z++)for(let X=1;X<=4;X++)Co(["Bovenlicht",Z,"Staander",X].join(""));else{ft("BovenlichtFrame"),ln("BovenlichtGlas"),Co("BovenlichtStaander");for(let Z=1;Z<=10;Z++)for(let X=1;X<=4;X++)Co(["Bovenlicht",Z,"Staander",X].join(""))}}function fi(){["vaste-wand","taatsdeur","scharnierdeur","schuifdeur","opdekdeur"].indexOf(P)>-1&&v(C,"roede_design_keuze")==!0?(wd("RoedeConfiguratie1",O("getRoedeConfiguratieBreedte")(C,"RoedeConfiguratie1"),O("getRoedeConfiguratieHoogte")(C),at([P,1,"Frame"].join(""))+dp(1),Cd(),Jt()),v(C,"deur_aantal")>=2?wd("RoedeConfiguratie2",O("getRoedeConfiguratieBreedte")(C,"RoedeConfiguratie2"),O("getRoedeConfiguratieHoogte")(C),at([P,2,"Frame"].join(""))+dp(2),Cd(),Jt()):Sd("RoedeConfiguratie2")):(Sd("RoedeConfiguratie1"),Sd("RoedeConfiguratie2"))}function De(Z){const X=s.retrieveObjectNames(Z);for(let ue=0;ue<X.length;ue++){const ge=X[ue];if(!ge)continue;const Oe=s.getObjectByName(ge);if(!(!Oe||!Oe.parent)&&(s.removeObject(Oe,ge),t.css3Objects.has(Oe))){const xe=t.css3Objects.get(Oe);s.removeObject(xe,xe.name),t.css3Objects.delete(Oe)}}}function Bt(Z,X,ue){Z&&typeof Z=="object"&&(Z[X]=ue)}function ce(Z){v(d,Z)!=null&&(De(v(d,Z)),Bt(d,Z,null))}function Se(){return P=="opdekdeur"&&v(C,"handgreep")=="HANDGREEP_KLINK_1"||P=="scharnierdeur"&&v(C,"handgreep")=="HANDGREEP_KLINK_1"?"Smalslot Toi":P=="vouwwand"?"ALU-Vouwwand klink":v(C,"handgreep")=="HANDGREEP_HOEK"?"Hoekgreep":v(C,"handgreep")=="HANDGREEP_BUIS"?"Buisgreep":v(C,"handgreep")=="HANDGREEP_BEUGEL"?"Beugelgreep":v(C,"handgreep")=="HANDGREEP_KOKER_VOLLEDIG"?"Kokergreep profiellengte":v(C,"handgreep")=="HANDGREEP_KOKERGREEP"?"Kokergreep":v(C,"handgreep")=="HANDGREEP_MAANGREEP"?"Maangreep":v(C,"handgreep")=="HANDGREEP_KOMGREEP"?"Komgreep aluminium":v(C,"handgreep")=="FINEER_HANDGREEP_HOEKGREEP"?"Hoekgreep 200mm fineer":v(C,"handgreep")=="FINEER_HANDGREEP_OVAALGREEP"?"Ovaalgreep 200mm fineer":v(C,"handgreep")=="FINEER_HANDGREEP_MAANGREEP"?"Maangreep 200mm fineer":v(C,"handgreep")=="FINEER_HANDGREEP_KOMGREEP"?"Komgreep 160mm fineer":v(C,"handgreep")=="FINEER_HANDGREEP_BEUGELGREEP"?"Beugelgreep 600mm fineer":v(C,"handgreep")=="FINEER_HANDGREEP_HOEKGREEP_1050"?"Hoekgreep 1050mm fineer":v(C,"handgreep")=="FINEER_HANDGREEP_HOEKGREEP_1200"?"Hoekgreep 1200mm fineer":v(C,"handgreep")=="FINEER_HANDGREEP_KOKERGREEP"?"Kokergreep 565mm fineer":"<none>"}function Me(Z,X,ue){if(!Z)return;const ge=s.getObjectByName(Z);if(!ge)return;const Oe=ge.clone();Oe.name=s.generateUniqueObjectName(ge.name);const xe=Oe.resolveMultiMaterial();if(Oe!=xe[0])for(let Ee=0;Ee<xe.length;Ee++)xe[Ee].name=Oe.name+"MatMesh"+Ee;return i.scene.add(Oe),t.objCache.set(Oe.name,Oe),Oe.name}function Fe(Z,X,ue,ge,Oe){const xe=ge[0],Ee=ge[1],We=ge[2];if(isNaN(xe)||isNaN(Ee)||isNaN(We)){console.error("set transform puzzle: Invalid transform");return}const Je=s.retrieveObjectNames(Z);function $e(Bn,Vn,_n){Bn[ue][Vn]=_n}const ht=t.vec3Tmp.set(+(xe!==""),+(Ee!==""),+(We!=="")),st=t.vec3Tmp2.set(xe||0,Ee||0,We||0);ue==="rotation"&&st.multiplyScalar(n.MathUtils.DEG2RAD);const tn=s.getSceneCoordSystem();s.transformCoordsSpace(ht,tn,"Y_UP_RIGHT",!0),s.transformCoordsSpace(st,tn,"Y_UP_RIGHT",ue==="scale");for(let Bn=0;Bn<Je.length;Bn++){const Vn=Je[Bn];if(!Vn)continue;const _n=s.getObjectByName(Vn);if(_n){if(ue==="rotation"&&tn=="Z_UP_RIGHT"){const yr=s.transformEulerV3dToBlenderShortest(_n.rotation,t.eulerTmp);s.transformCoordsSpace(yr,tn,"Y_UP_RIGHT"),ht.x&&(yr.x=st.x),ht.y&&(yr.y=st.y),ht.z&&(yr.z=st.z),yr.order="YZX",yr.reorder(_n.rotation.order),_n.rotation.copy(yr)}else if(ue==="rotation"&&tn=="Y_UP_RIGHT"){const yr=s.RotationInterface.initObject(_n),ia=yr.getUserRotation(t.eulerTmp);ht.x&&(ia.x=st.x),ht.y&&(ia.y=st.y),ht.z&&(ia.z=st.z),yr.setUserRotation(ia),yr.getActualRotation(_n.rotation)}else ht.x&&$e(_n,"x",st.x),ht.y&&$e(_n,"y",st.y),ht.z&&$e(_n,"z",st.z);_n.updateWorldMatrix(!1,!0)}}}function Re(Z,X,ue,ge,Oe,xe){var Ee=s.getMaterialEditableColors(Z);if(!(Ee.indexOf(X)<0)){if(xe){var We=new n.Color(xe);ue=We.r,ge=We.g,Oe=We.b}for(var Je=n.SceneUtils.getMaterialsByName(i,Z),$e=0;$e<Je.length;$e++){var ht=Je[$e];if(ht.isMeshNodeMaterial){var st=ht.nodeRGBMap[X];ht.nodeRGB[st].x=ue,ht.nodeRGB[st].y=ge,ht.nodeRGB[st].z=Oe}else ht[X].r=ue,ht[X].g=ge,ht[X].b=Oe;n.engineVersionCmp("4.9.0",n.REVISION)<0&&(ht.needsUpdate=!0),i.scene!==null&&ht===i.scene.worldMaterial&&i.updateEnvironment(ht)}}}function ke(Z,X,ue){const ge=s.retrieveObjectNames(Z);if(!X)return;const Oe=We=>n.SceneUtils.getMaterialsByName(i,We.name).some(Je=>Je===We),xe=t.materialsCache,Ee=xe.get(X)||n.SceneUtils.getMaterialByName(i,X);if(Ee){for(let We=0;We<ge.length;We++){const Je=ge[We];if(!Je)continue;const $e=s.getObjectByName(Je);if($e){const ht=$e.resolveMultiMaterial();let st;if(Number.isInteger(ue)){console.error("assign material puzzle: Invalid material index "+ue);continue}else st=ht[0];const tn=st.material;if(!tn)continue;st.material=Ee,Oe(tn)||xe.set(tn.name,tn)}}xe.has(Ee.name)&&Oe(Ee)&&xe.delete(Ee.name)}}function ut(Z,X,ue,ge,Oe,xe,Ee,We,Je,$e,ht){De(v(d,ge)),fe(ue,!1,"position","x")!=null&&(Bt(d,ge,Me(ue)),Bt(d,"setpointPosition",O("getHandgreepPosition")(fe(X,!0,"position","xyz"),ht)),Fe(v(d,ge),!1,"position",[v(v(d,"setpointPosition"),"x"),v(v(d,"setpointPosition"),"y"),v(v(d,"setpointPosition"),"z")]),ht=="Links"&&P!="vouwwand"&&Fe(v(d,ge),!1,"scale",[fe(v(d,ge),!1,"scale","x")*-1,"",""]),se==!0?M(v(d,ge),"wandmontage",1):M(v(d,ge),"wandmontage",0),M(v(d,ge),"greep_taatsdeur",P=="taatsdeur"?1:0),M(v(d,ge),"greep_scharnierdeur",P=="scharnierdeur"?1:0),M(v(d,ge),"greep_schuifdeur",P=="schuifdeur"?1:0),M(v(d,ge),"greep_hoogte_paneel",(Math.min(Math.max(pe(We),Je),$e)-Je)/($e-Je)*1+0),v(C,"kleur_materiaal").indexOf("FINEER")>-1&&v(C,"type_handgreep")=="aluminium"?(Re("Handgreep","Principled BSDF Color",0,0,0,"#0A0A0A"),ke(v(d,ge),"Handgreep",void 0)):v(C,"kleur_materiaal").indexOf("FINEER")>-1&&v(C,"type_handgreep")=="hout"?(v(C,"kleur_materiaal")=="FINEER_RM_21_NATURAL"&&Re("Fineer","RGB",0,0,0,"#A48F7A"),v(C,"kleur_materiaal")=="FINEER_RM_10_CHOCOLATE"&&Re("Fineer","RGB",0,0,0,"#442f29"),ke(v(d,ge),"Fineer",void 0)):ke(v(d,ge),"Poedercoat",void 0),j(v(d,ge),!0))}function dt(Z,X){Z&&typeof Z=="object"&&delete Z[X]}function ft(Z){v(f,Z)!=null&&(De(v(f,Z)),Bt(f,Z,null),dt(f,String(Z)+"_frameData"))}function yt(Z,X){switch(X){case"OBJECT":case"ANIMATION":case"MATERIAL":return Z;case"GROUP":return["GROUP",Z]}}function Ze(Z){return yt(v(f,Z),"OBJECT")}function Rn(Z,X){if(Z&&X){var ue=s.getObjectByName(Z);if(ue&&(ue=ue.resolveMultiMaterial()[0],ue.morphTargetDictionary&&X in ue.morphTargetDictionary)){var ge=ue.morphTargetDictionary[X];return ue.morphTargetInfluences[ge]}}return 0}function $t(Z,X){return Rn(v(f,Z),X)}function at(Z){return fe(yt(v(f,Z),"OBJECT"),!1,"position","x")}function zt(Z){return fe(yt(v(f,Z),"OBJECT"),!1,"position","z")}function Is(){return f}function sn(Z,X,ue,ge,Oe,xe,Ee,We,Je,$e,ht){De(v(f,X)),Bt(f,X,Me(Z)),Fe(v(f,X),!1,"position",[Je,$e,ht]),M(v(f,X),"paneel_breedte",(Math.min(Math.max(pe(ue),ge),Oe)-ge)/(Oe-ge)*1+0),M(v(f,X),"paneel_hoogte",(Math.min(Math.max(pe(xe),Ee),We)-Ee)/(We-Ee)*1+0),v(C,"hogeonderdorpel")==!0||P=="taatsdeur"?M(v(f,X),"hoge_onderdorpel",1):M(v(f,X),"hoge_onderdorpel",0),se==!0?M(v(f,X),"wandmontage",1):M(v(f,X),"wandmontage",0),se==!0?M(v(f,X),"bovenkoker",0):M(v(f,X),"bovenkoker",1),X=="scharnierdeur1Frame"?(v(C,"zijpaneel_aantal_links")==0?M(v(f,X),"kozijnstijl_links",1):M(v(f,X),"kozijnstijl_links",0),v(C,"zijpaneel_aantal_rechts")==0&&v(C,"deur_aantal")==1?M(v(f,X),"kozijnstijl_rechts",1):M(v(f,X),"kozijnstijl_rechts",0)):X=="scharnierdeur2Frame"?(M(v(f,X),"kozijnstijl_links",0),v(C,"zijpaneel_aantal_rechts")==0?M(v(f,X),"kozijnstijl_rechts",1):M(v(f,X),"kozijnstijl_rechts",0)):(M(v(f,X),"kozijnstijl_links",0),M(v(f,X),"kozijnstijl_rechts",0)),X=="opdekdeur1Frame"&&v(C,"draairichting")=="DRAAI_RECHTS"?(M(v(f,X),"slotstijl_links",1),M(v(f,X),"slotstijl_rechts",0)):(M(v(f,X),"slotstijl_links",0),M(v(f,X),"slotstijl_rechts",1)),X=="scharnierdeur1Frame"&&v(C,"handgreep")=="HANDGREEP_KLINK_1"&&v(C,"deur_aantal")>1?v(C,"actievedeur")=="ACTIEVEDEUR_RECHTS"?(M(v(f,X),"smalslot_links",0),M(v(f,X),"smalslot_rechts",0)):(M(v(f,X),"smalslot_links",0),M(v(f,X),"smalslot_rechts",1)):X=="scharnierdeur2Frame"&&v(C,"handgreep")=="HANDGREEP_KLINK_1"&&v(C,"deur_aantal")>1?v(C,"actievedeur")=="ACTIEVEDEUR_RECHTS"?(M(v(f,X),"smalslot_links",1),M(v(f,X),"smalslot_rechts",0)):(M(v(f,X),"smalslot_links",0),M(v(f,X),"smalslot_rechts",0)):X=="scharnierdeur1Frame"&&v(C,"handgreep")=="HANDGREEP_KLINK_1"&&v(C,"deur_aantal")==1?v(C,"draairichting")=="DRAAI_RECHTS"?(M(v(f,X),"smalslot_links",1),M(v(f,X),"smalslot_rechts",0)):(M(v(f,X),"smalslot_links",0),M(v(f,X),"smalslot_rechts",1)):X=="vouwwand1Frame"&&v(C,"handgreep")=="HANDGREEP_KLINK_1"?(M(v(f,X),"smalslot_links",1),M(v(f,X),"smalslot_rechts",0)):(M(v(f,X),"smalslot_links",0),M(v(f,X),"smalslot_rechts",0)),M(v(f,X),"bovenkoker",0),P=="vaste-wand"?(M(v(f,X),"staander_links",1),M(v(f,X),"staander_links_hoogte",(Math.min(Math.max(pe(xe),Ee),We)-Ee)/(We-Ee)*1+0)):M(v(f,X),"staander_links_hoogte",0),X.indexOf("vaste-wand")>-1&&v(C,"verbergtussenstaanders")==!0?X.indexOf("1")>-1?(M(v(f,X),"staander_rechts",0),M(v(f,X),"staander_links",1),M(v(f,X),"staander_rechts_hoogte",0),M(v(f,X),"staander_links_hoogte",(Math.min(Math.max(pe(xe),Ee),We)-Ee)/(We-Ee)*1+0)):X.indexOf(v(C,"deur_aantal"))>-1?(M(v(f,X),"staander_rechts",1),M(v(f,X),"staander_links",0),M(v(f,X),"staander_rechts_hoogte",(Math.min(Math.max(pe(xe),Ee),We)-Ee)/(We-Ee)*1+0),M(v(f,X),"staander_links_hoogte",0)):(M(v(f,X),"staander_rechts",0),M(v(f,X),"staander_links",0),M(v(f,X),"staander_rechts_hoogte",0),M(v(f,X),"staander_links_hoogte",0)):X.indexOf("ZijpaneelLinks")>-1&&v(C,"verbergtussenstaanders")==!0?X.indexOf("1")>-1?(M(v(f,X),"staander_rechts",0),M(v(f,X),"staander_links",1),M(v(f,X),"staander_rechts_hoogte",0),M(v(f,X),"staander_links_hoogte",(Math.min(Math.max(pe(xe),Ee),We)-Ee)/(We-Ee)*1+0)):X.indexOf(v(C,"zijpaneel_aantal_links"))>-1?(M(v(f,X),"staander_rechts",1),M(v(f,X),"staander_links",0),M(v(f,X),"staander_rechts_hoogte",(Math.min(Math.max(pe(xe),Ee),We)-Ee)/(We-Ee)*1+0),M(v(f,X),"staander_links_hoogte",0)):(M(v(f,X),"staander_rechts",0),M(v(f,X),"staander_links",0),M(v(f,X),"staander_rechts_hoogte",0),M(v(f,X),"staander_links_hoogte",0)):X.indexOf("ZijpaneelRechts")>-1&&v(C,"verbergtussenstaanders")==!0?X.indexOf("1")>-1?(M(v(f,X),"staander_rechts",0),M(v(f,X),"staander_links",1),M(v(f,X),"staander_rechts_hoogte",0),M(v(f,X),"staander_links_hoogte",(Math.min(Math.max(pe(xe),Ee),We)-Ee)/(We-Ee)*1+0)):X.indexOf(v(C,"zijpaneel_aantal_rechts"))>-1?(M(v(f,X),"staander_rechts",1),M(v(f,X),"staander_links",0),M(v(f,X),"staander_rechts_hoogte",(Math.min(Math.max(pe(xe),Ee),We)-Ee)/(We-Ee)*1+0),M(v(f,X),"staander_links_hoogte",0)):(M(v(f,X),"staander_rechts",0),M(v(f,X),"staander_links",0),M(v(f,X),"staander_rechts_hoogte",0),M(v(f,X),"staander_links_hoogte",0)):(M(v(f,X),"staander_rechts",1),M(v(f,X),"staander_links",1),M(v(f,X),"staander_rechts_hoogte",(Math.min(Math.max(pe(xe),Ee),We)-Ee)/(We-Ee)*1+0),M(v(f,X),"staander_links_hoogte",(Math.min(Math.max(pe(xe),Ee),We)-Ee)/(We-Ee)*1+0)),ke(v(f,X),on(),void 0),j(v(f,X),!0)}function ln(Z){v(h,Z)!=null&&(De(v(h,Z)),Bt(h,Z,null))}function hi(){return S("Glas","Metallic",0),S("Glas","IOR",1.45),S("Glas","Transmission",1),["GLAS_BRONS_MAT","GLAS_MAT","GLAS_GRIJS_MAT"].indexOf(v(C,"kleur_glas"))>-1?(S("Glas","Ruwheid",.6),S("Glas","Alpha",.9),S("Glas","Roughness",.45)):(S("Glas","Ruwheid",0),S("Glas","Alpha",.3),S("Glas","Roughness",0)),v(C,"kleur_glas")=="GLAS_BRONS"?Re("Glas","Principled BSDF Color",0,0,0,"#6A5C3A"):v(C,"kleur_glas")=="GLAS_GRIJS"?Re("Glas","Principled BSDF Color",0,0,0,"#585858"):v(C,"kleur_glas")=="GLAS_BRONS_MAT"?Re("Glas","Principled BSDF Color",0,0,0,"#7A6F5F"):v(C,"kleur_glas")=="GLAS_MAT"?Re("Glas","Principled BSDF Color",0,0,0,"#E5F6FB"):v(C,"kleur_glas")=="GLAS_GRIJS_MAT"?Re("Glas","Principled BSDF Color",0,0,0,"#777777"):Re("Glas","Principled BSDF Color",0,0,0,"#E5F6FB"),"Glas"}function Cn(Z,X,ue,ge,Oe,xe,Ee,We,Je,$e){De(v(h,ge)),Bt(h,ge,Me(ue)),Fe(v(h,ge),!1,"position",[fe(X,!1,"position","x")+(fe(ue,!1,"position","x")-fe(Z,!1,"position","x")),fe(X,!1,"position","y")+(fe(ue,!1,"position","y")-fe(Z,!1,"position","y")),fe(X,!1,"position","z")+(fe(ue,!1,"position","z")-fe(Z,!1,"position","z"))]),M(v(h,ge),"glas_breedte",(Math.min(Math.max(pe(Oe),xe),Ee)-xe)/(Ee-xe)*1+0),M(v(h,ge),"glas_hoogte",(Math.min(Math.max(pe(We),Je),$e)-Je)/($e-Je)*1+0),v(C,"hogeonderdorpel")==!0?M(v(h,ge),"hoge_onderdorpel",1):M(v(h,ge),"hoge_onderdorpel",0),se==!0?M(v(h,ge),"wandmontage",1):M(v(h,ge),"wandmontage",0),se==!0?M(v(h,ge),"bovenkoker",0):M(v(h,ge),"bovenkoker",1),M(v(h,ge),"bovenkoker",0),ge.indexOf("vaste-wand")>-1&&v(C,"verbergtussenstaanders")==!0||ge.indexOf("Zijpaneel")>-1&&v(C,"verbergtussenstaanders")==!0?M(v(h,ge),"glas_10mm",1):M(v(h,ge),"glas_10mm",0),ke(v(h,ge),hi(),void 0),j(v(h,ge),!0)}function et(Z,X,ue,ge,Oe){const xe=s.getMaterialEditableTextures(Z,!0).filter(function(ht){return ht.name==X});if(!xe.length)return;const Ee=n.SceneUtils.getMaterialsByName(i,Z);if(ue instanceof Promise)ue.then(function(ht){We(ht)},function(ht){});else if(typeof ue=="string")We(ue);else if(ue instanceof Object&&ue.source instanceof HTMLVideoElement)Je(ue.source);else if(ue instanceof HTMLCanvasElement)$e(ue);else return;function We(ht){const st=ht.search(/\.hdr$/)>0,tn=ht.search(/\.ktx2/)>0;let Bn=!1,Vn=!1;xe.forEach(function(yr){yr.isCompressedTexture&&(Bn=!0),yr.isVideoTexture&&(Vn=!0)});let _n;!st&&!tn&&!Bn&&!Vn?(_n=new n.ImageLoader,_n.setCrossOrigin("Anonymous")):tn?(_n=i.loader.ktx2Loader,_n.setCrossOrigin("Anonymous")):Bn||Vn?(_n=new n.TextureLoader,_n.setCrossOrigin("Anonymous")):(_n=new n.FileLoader,_n.setResponseType("arraybuffer")),_n.load(ht,function(yr){xe.forEach(function(ia){ia.dispose();let Mo;if(!st&&!tn&&!Bn&&!Vn)Mo=ia.clone(),Ee.forEach(function(Na){s.replaceMaterialEditableTexture(Na,ia,Mo),Na.needsUpdate=!0}),Mo.source=new n.Source(yr);else if(tn||Bn||Vn)Mo=yr,Ee.forEach(function(Na){Mo.flipY=!1,Mo.name=X,s.replaceMaterialEditableTexture(Na,ia,Mo),Na.needsUpdate=!0,Na.isMeshNodeMaterial&&Na.updateNodeGraph(!0)});else{const fx=new n.RGBELoader().parse(yr);Mo=ia.clone(),Ee.forEach(function(bN){s.replaceMaterialEditableTexture(bN,ia,Mo),bN.needsUpdate=!0}),Mo.source=new n.Source({data:fx.data,width:fx.width,height:fx.height}),Mo.magFilter=n.LinearFilter,Mo.minFilter=n.LinearFilter,Mo.generateMipmaps=!1,Mo.isDataTexture=!0}if(i.scene!==null&&i.scene.worldMaterial!==null){var dx=i.scene.worldMaterial;for(let Na in dx.nodeTextures)dx.nodeTextures[Na]==Mo&&i.updateEnvironment(dx)}}),Oe()})}function Je(ht){const st=new n.VideoTexture(ht);st.flipY=!1,st.name=X;let tn=!1;var Bn=n.SceneUtils.getMaterialsByName(i,Z);Bn.forEach(function(Vn){if(xe.forEach(function(_n){s.replaceMaterialEditableTexture(Vn,_n,st)}),Vn.needsUpdate=!0,Vn.isMeshNodeMaterial)if(n.engineVersionCmp("4.9.0",n.REVISION)>=0)Vn.updateNodeGraph(!0);else{const _n=Vn.nodeRGBArr,yr=Vn.nodeValue;Vn.updateNodeGraph(),Vn.nodeRGBArr=_n,Vn.nodeValue=yr}tn=!0}),tn&&(ht.readyState<1?s.bindListener(ht,"loadedmetadata",Oe):Oe())}function $e(ht){const st=new n.CanvasTexture(ht);st.flipY=!1,st.name=X;let tn=!1;var Bn=n.SceneUtils.getMaterialsByName(i,Z);Bn.forEach(function(Vn){xe.forEach(function(_n){s.replaceMaterialEditableTexture(Vn,_n,st)}),Vn.needsUpdate=!0,tn=!0}),tn&&(o&&(o.canvasTextures=o.canvasTextures||{},o.canvasTextures[st.image.id]=st),Oe())}}function on(){return S("Poedercoat","Metallic",0),S("Poedercoat","IOR",1.45),S("Poedercoat","Alpha",1),S("Poedercoat","Roughness",.2),S("Poedercoat","Transmission",0),S("Poedercoat","Ruwheid",.2),v(C,"kleur_materiaal")=="FINEER_RM_21_NATURAL"&&et("Fineer","TextureFineer",String(O("getBaseUrl")())+"/v3dApp/RMC_Natural.jpg",!0,function(){}),v(C,"kleur_materiaal")=="FINEER_RM_10_CHOCOLATE"&&et("Fineer","TextureFineer",String(O("getBaseUrl")())+"/v3dApp/RMC_Chocolate.jpeg",!0,function(){}),S("Fineer","Roughness",.6),v(C,"kleur_materiaal")=="KLEUR_ALUMINIUM_ZWART"?Re("Poedercoat","Principled BSDF Color",0,0,0,"#0A0A0A"):v(C,"kleur_materiaal")=="KLEUR_ALUMINIUM_BEIGE"?Re("Poedercoat","Principled BSDF Color",0,0,0,"#CAC4B0"):v(C,"kleur_materiaal")=="KLEUR_ALUMINIUM_ANTRACIET"?Re("Poedercoat","Principled BSDF Color",0,0,0,"#2B2B2A"):v(C,"kleur_materiaal")=="KLEUR_ALUMINIUM_BRONS"?Re("Poedercoat","Principled BSDF Color",0,0,0,"#5F5B3D"):v(C,"kleur_materiaal")=="KLEUR_ALUMINIUM_GOLD"?Re("Poedercoat","Principled BSDF Color",0,0,0,"#B7A76D"):v(C,"kleur_materiaal")=="KLEUR_ALUMINIUM_RAL"?Re("Poedercoat","Principled BSDF Color",0,0,0,O("customFunctionRALtoHEX")(v(C,"kleur_ral"))):Re("Poedercoat","Principled BSDF Color",0,0,0,"#0A0A0A"),v(C,"kleur_materiaal")=="FINEER_RM_21_NATURAL"&&Re("Fineer","RGB",0,0,0,"#A48F7A"),v(C,"kleur_materiaal")=="FINEER_RM_10_CHOCOLATE"&&Re("Fineer","RGB",0,0,0,"#442f29"),v(C,"kleur_materiaal")=="FINEER_RM_21_NATURAL"||v(C,"kleur_materiaal")=="FINEER_RM_10_CHOCOLATE"?"Fineer":"Poedercoat"}function ur(Z){v(p,Z)!=null&&(De(v(p,Z)),Bt(p,Z,null))}function Ba(Z,X,ue,ge,Oe,xe,Ee,We,Je,$e,ht){De(v(p,X)),Bt(p,X,Me(t_())),P=="opdekdeur"?Fe(v(p,X),!1,"position",[Je,$e+-.106,ht]):se==!0?Fe(v(p,X),!1,"position",[Je,$e+-.125,ht]):Fe(v(p,X),!1,"position",[Je,$e,ht]),M(v(p,X),"roede_verplaatsing",(Math.min(Math.max(pe(ue),ge),Oe)-ge)/(Oe-ge)*1+0),M(v(p,X),"roede_breedte",(Math.min(Math.max(pe(xe),Ee),We)-Ee)/(We-Ee)*1+0),P=="vaste-wand"?M(v(p,_),"roede_vaste_wand",1):M(v(p,_),"roede_vaste_wand",0),P=="taatsdeur"?M(v(p,_),"roede_taatsdeur",1):M(v(p,_),"roede_taatsdeur",0),P=="scharnierdeur"?M(v(p,_),"roede_scharnierdeur",1):M(v(p,_),"roede_scharnierdeur",0),P=="schuifdeur"?M(v(p,_),"roede_schuifdeur",1):M(v(p,_),"roede_schuifdeur",0),P=="opdekdeur"?M(v(p,_),"roede_opdekdeur",1):M(v(p,_),"roede_opdekdeur",0),M(v(p,_),"roede_hout",0),ke(v(p,X),on(),void 0),j(v(p,X),!0)}function lx(Z){return yt(v(m,Z),"OBJECT")}function Rs(Z){return v(w,Z)}function Co(Z){v(m,Z)!=null&&(De(v(m,Z)),Bt(m,Z,null),Bt(w,Z,null))}function up(Z,X){return X=Math.pow(10,X),Math.round(Z*X)/X}function El(Z,X,ue,ge,Oe,xe,Ee,We,Je,$e,ht){De(v(m,X)),Bt(m,X,Me(n_())),P=="opdekdeur"?Fe(v(m,X),!1,"position",[Je+.035,$e+-.106,ht]):se==!0?Fe(v(m,X),!1,"position",[Je+0,$e+-.125,ht]):Fe(v(m,X),!1,"position",[Je,$e,ht]),M(v(m,X),"roede_verplaatsing",(Math.min(Math.max(pe(ue),ge),Oe)-ge)/(Oe-ge)*1+0),M(v(m,X),"roede_hoogte",(Math.min(Math.max(pe(xe),Ee),We)-Ee)/(We-Ee)*1+0),Z=="Bovenlicht"||Z=="Zijlicht"?(M(v(m,X),"roede_vaste_wand",0),M(v(m,X),"roede_taatsdeur",0),M(v(m,X),"roede_scharnierdeur",0),M(v(m,X),"roede_schuifdeur",0),M(v(m,X),"roede_opdekdeur",0)):(P=="vaste-wand"?M(v(m,X),"roede_vaste_wand",1):M(v(m,X),"roede_vaste_wand",0),P=="taatsdeur"?M(v(m,X),"roede_taatsdeur",1):M(v(m,X),"roede_taatsdeur",0),P=="scharnierdeur"?M(v(m,X),"roede_scharnierdeur",1):M(v(m,X),"roede_scharnierdeur",0),P=="schuifdeur"?M(v(m,X),"roede_schuifdeur",1):M(v(m,X),"roede_schuifdeur",0),P=="opdekdeur"?M(v(m,X),"roede_opdekdeur",1):M(v(m,X),"roede_opdekdeur",0),se==!0?M(v(m,X),"wandmontage",1):M(v(m,X),"wandmontage",0),v(C,"hogeonderdorpel")==!0?M(v(m,X),"hoge_onderdorpel",1):M(v(m,X),"hoge_onderdorpel",0)),M(v(m,X),"roede_hout",0),ke(v(m,X),on(),void 0),j(v(m,X),!0),De(v(w,X)),Bt(w,X,me(["shapeKeyVerplaatsing","framePositionX","staanderPositionX"],[up(ue,2),up(fe(v(m,X),!1,"position","x"),2),up(fe(v(m,X),!1,"position","x")+ue*.01,2)]))}function dp(Z){return O("calcRoedeConfiguratiePositieOffsetX")(C,P,Z)}function t_(){return P=="vouwwand"?"ALU-Vouwwand roede":v(C,"typeroede")=="T_ROEDE"?"ALU-T-roede liggend":(v(C,"typeroede")=="PLATTE_ROEDE","ALU-S30 - Striproede liggend")}function cx(Z){return yt(v(g,Z),"OBJECT")}function Cd(){return O("getRoedeConfiguratiePositieY")(C,P)}function ux(){return g}function n_(){return v(C,"typeroede")=="T_ROEDE"?"ALU-T-roede staand":(v(C,"typeroede")=="PLATTE_ROEDE","ALU-S30 - Striproede staand")}function Jt(){return O("getRoedeConfiguratiePositieZ")(P)}function Sd(Z){v(g,Z)!=null&&(De(v(g,Z)),Bt(g,Z,null))}function fp(Z){return G&&typeof G=="object"&&G.hasOwnProperty(v(C,"roede_configuratie"))?v(v(G,v(C,"roede_configuratie")),Z):{}}function r_(Z){return fe(yt(v(g,Z),"OBJECT"),!1,"position","x")}function pi(){return v(C,"roede_configuratie").indexOf("RV")>-1?yt(v(C,"roede_configuratie"),"OBJECT"):"<none>"}function wd(Z,X,ue,ge,Oe,xe){De(v(g,Z)),Bt(g,Z,Me(pi())),Fe(v(g,Z),!1,"position",[ge,Oe,xe]),(Z.indexOf("2")!=-1||v(C,"deur_aantal")==1&&v(C,"draairichting")=="DRAAI_RECHTS")&&Fe(v(g,Z),!1,"scale",[fe(v(g,Z),!1,"scale","x")*-1,"",""]),M(v(g,Z),"roede_breedte",(Math.min(Math.max(pe(X),50),150)-50)/100*-1+1),M(v(g,Z),"roede_hoogte",(Math.min(Math.max(pe(ue),150),300)-150)/150*-1+1),M(v(g,Z),"roede_hoogte_correctie",(Math.min(Math.max(pe(ue),150),300)-150)/150*-1+1),M(v(g,Z),"roede_correctie",(Math.min(Math.max(pe(X),50),150)-50)/100*-1+1>=(Math.min(Math.max(pe(ue),150),300)-150)/150*-1+1?(Math.min(Math.max(pe(X),50),150)-50)/100*-1+1:(Math.min(Math.max(pe(ue),150),300)-150)/150*-1+1),ke(v(g,Z),on(),void 0),j(v(g,Z),!0)}function Tr(Z){v(A,Z)!=null&&(De(v(A,Z)),Bt(A,Z,null))}function jo(Z,X,ue,ge,Oe,xe){De(v(A,ue)),Bt(A,ue,Me(X)),P=="taatsdeur"?Fe(v(A,ue),!1,"position",[xe=="Links"?fe(Z,!1,"position","x")+.1:ge*.01+(fe(Z,!1,"position","x")-.1),0,Oe*.01]):Fe(v(A,ue),!1,"position",[xe=="Links"?fe(Z,!1,"position","x")+.02:ge*.01+(fe(Z,!1,"position","x")-.02),0,Oe*.01]),xe=="Rechts"?M(v(A,ue),"scharnier_mirror",1):M(v(A,ue),"scharnier_mirror",0),v(C,"kleur_materiaal").indexOf("FINEER")>-1&&v(C,"type_handgreep")=="aluminium"?(Re("Handgreep","Principled BSDF Color",0,0,0,"#0A0A0A"),ke(v(A,ue),"Handgreep",void 0)):v(C,"kleur_materiaal").indexOf("FINEER")>-1&&v(C,"type_handgreep")=="hout"?(v(C,"kleur_materiaal")=="FINEER_RM_21_NATURAL"&&(Re("Fineer","RGB",0,0,0,"#DDC5A1"),ke(v(A,ue),"Fineer",void 0)),v(C,"kleur_materiaal")=="FINEER_RM_10_CHOCOLATE"&&(Re("Fineer","RGB",0,0,0,"#422A23"),ke(v(A,ue),"Fineer",void 0))):ke(v(A,ue),on(),void 0),j(v(A,ue),!0)}function Ln(Z){v(y,Z)!=null&&(De(yt(v(y,Z),"OBJECT")),dt(y,Z)),De(Z),De(String(Z)+"_StaandeLijnLinks"),De(String(Z)+"_StaandeLijnRechts"),De(String(Z)+"_HorizontaleLijn"),De(String(Z)+"_Tekstvak"),De(String(Z)+"_Tekst"),De(String(Z)+"_TekstGespiegeld"),De(String(Z)+"_LiggendeLijnBoven"),De(String(Z)+"_LiggendeLijnOnder"),De(String(Z)+"_VerticaleLijn")}function So(Z,X,ue,ge,Oe,xe,Ee,We,Je){Oe=="Horizontaal"&&(De(String(Z)+"_StaandeLijnLinks"),O("createLine")(String(Z)+"_StaandeLijnLinks","#0A0A0A",ue,.101,ge+(Ee-.05),ue,.101,ge+Ee+.05),De(String(Z)+"_StaandeLijnRechts"),O("createLine")(String(Z)+"_StaandeLijnRechts","#0A0A0A",ue+We,.101,ge+(Ee-.05),ue+We,.101,ge+Ee+.05),De(String(Z)+"_HorizontaleLijn"),O("createLine")(String(Z)+"_HorizontaleLijn","#0A0A0A",ue,.101,ge+Ee,ue+We,.101,ge+Ee),De(String(Z)+"_Tekst"),O("createDimensionText")(String(Z)+"_Tekst",ue+We/2,.105,ge+Ee,R,O("formatDecimals")(X),.1,.001,"#ffffff",!1)),Oe=="Verticaal"&&(De(String(Z)+"_LiggendeLijnBoven"),O("createLine")(String(Z)+"_LiggendeLijnBoven","#0A0A0A",ue+(xe-.05),.101,ge+Ee+Je,ue+xe+.05,.101,ge+Ee+Je),De(String(Z)+"_LiggendeLijnOnder"),O("createLine")(String(Z)+"_LiggendeLijnOnder","#0A0A0A",ue+(xe-.05),.101,ge+Ee,ue+xe+.05,.101,ge+Ee),De(String(Z)+"_VerticaleLijn"),O("createLine")(String(Z)+"_VerticaleLijn","#0A0A0A",ue+xe,.101,ge+Ee,ue+xe,.101,ge+Ee+Je),De(String(Z)+"_Tekst"),O("createDimensionText")(String(Z)+"_Tekst",ue+xe,.105,ge+Ee+Je/2+0,R,O("formatDecimals")(X),.1,.001,"#ffffff",!1)),Oe=="Maatpunt links/rechts"&&(De(String(Z)+"_HorizontaleLijn"),O("createLine")(String(Z)+"_HorizontaleLijn","#0A0A0A",ue+xe,.101,ge+Ee,ue+We,.101,ge+Ee),De(String(Z)+"_Tekst"),O("createDimensionText")(String(Z)+"_Tekst",ue+xe,.105,ge+Ee,R,O("formatDecimals")(X),.1,.001,"#ffffff",!1)),Oe=="Maatpunt staander"&&(De(String(Z)+"_VerticaleLijn"),O("createLine")(String(Z)+"_VerticaleLijn","#0A0A0A",ue+xe,.101,ge+Ee,ue+xe,.101,ge+0),De(String(Z)+"_Tekst"),O("createDimensionText")(String(Z)+"_Tekst",ue+xe,.105,ge+Ee,R,O("formatDecimals")(X),.1,.001,"#ffffff",!1))}function St(Z){v(b,Z)!=null&&(De(v(b,Z)),Bt(b,Z,null),dt(b,String(Z)+"_kozijnData"))}function Bi(Z,X,ue,ge,Oe,xe,Ee,We,Je,$e){De(v(b,X)),Bt(b,X,Me(Z)),Fe(v(b,X),!1,"position",[Je,"",$e]),M(v(b,X),"kozijn_breedte",(Math.min(Math.max(pe(ue),ge),Oe)-ge)/(Oe-ge)*1+0),M(v(b,X),"kozijn_hoogte",(Math.min(Math.max(pe(xe),Ee),We)-Ee)/(We-Ee)*1+0),X!=["opdekdeur",1,"Kozijn"].join("")?ke(v(b,X),on(),void 0):ke(v(b,X),"RAL9010",void 0),j(v(b,X),!0)}function Md(Z){v(E,Z)!=null&&(De(v(E,Z)),Bt(E,Z,null))}function wo(Z,X,ue,ge,Oe,xe){De(v(E,Z)),Bt(E,Z,Me(co())),Fe(v(E,Z),!1,"position",[ge,Oe,xe]),M(v(E,Z),"rail_breedte",(Math.min(Math.max(pe(X),20),600)-20)/580*1+0),M(v(E,Z),"rail_hoogte",(Math.min(Math.max(pe(ue),20),300)-20)/280*1+0),ke(v(E,Z),on(),void 0),j(v(E,Z),!0)}function co(){return se==!0?"ALU-Wandrail":"ALU-Bovenkoker-rail"}l=20,x=150,L=20,D=300,ee=.08,re=32,Q=32,R=String(O("getBaseUrl")())+"/fonts/Satoshi-Bold.woff",u=O("getMakeScreenshot")(),W("change","configJSON",!0,function(Z){I()}),W("change","triggerRenderImage",!0,function(Z){console.log("triggerRenderImage"),I()}),F(.1,function(){ae("div","puzzleLoaded","TO",["BODY"],!0),ne("className","puzzleLoaded","puzzleLoaded",!0),ne("id","puzzleLoaded","puzzleLoaded",!0),oe("KEYBOARD_CONTROLS","Camera",!1)}),j(q(["ALL_OBJECTS"],"ALL","null",void 0,!1),!1),c=!1,c||J(),V("MOBILE")||O("getFullscreenTemplate")()?Y(2):Y(1),O("setClientDetails")(me(["Mobiel device","WebGL 2.0","WebGL","Native screen scale","Touch","GPU Vendor","GPU Model","Retina Display","HDR"],[V("MOBILE"),V("WEBGL2"),V("WEBGL"),window.devicePixelRatio,V("TOUCH"),le("VENDOR"),le("MODEL"),V("RETINA"),V("HDR")])),V("MOBILE"),u=O("getMakeScreenshot")(),u!=!0&&(ne("className",String(U("className",["CONTAINER"],!0))+" rounded-lg lg:rounded-xl h-72 h-full max-h-screen",["CONTAINER"],!0),W("click","btnCamera",!0,function(Z){v(H,"middlePositionZ")>0&&(fe("Camera",!1,"position","y")<=0,te([0,fe("Camera",!1,"position","y")<=0?5.5:-7,v(H,"middlePositionZInclDimensions")],[0,0,v(H,"middlePositionZInclDimensions")],2,function(){fe("Camera",!1,"position","y")>=0?Ne():Ie()},0),we(fe("Camera",!1,"position","y")<=0?re:Q,fe("Camera",!1,"position","y")<=0?Q:re,2,"Linear","In",0,!1,"{!jb%6bg/AG3VA6~(SMX",function(){oe("FIELD_OF_VIEW","Camera",t.animateParamUpdate||0)},function(){}))})),ct("Camera",.05),d=[],f=[],h=[],p=[],m=[],w=[],g=[],A=[],y=[],b=[],E=[]},o.disposeListeners=function(){t&&(t.eventListeners.forEach(({target:i,type:a,listener:s,optionsOrUseCapture:l})=>{i.removeEventListener(a,s,l)}),t.eventListeners.length=0)},o.disposeHTMLElements=function(){t&&(t.htmlElements.forEach(i=>{i.remove()}),t.htmlElements.clear())},o.disposeMaterialsCache=function(){if(t){for(const i of t.materialsCache.values())i.dispose();t.materialsCache.clear()}},o.dispose=function(){o.disposeListeners(),o.disposeHTMLElements(),o.disposeMaterialsCache(),t=null,n[Symbol.toStringTag]!=="Module"&&(delete n.PL,delete n.puzzles)},o}function f3e(n,e,t,r){let o=0,i=0,a=0,s=null,l=(n==null?void 0:n.breedte)||0,c=(n==null?void 0:n.deur_aantal)||1,u=(n==null?void 0:n.zijpaneel_aantal_links)||0,d=(n==null?void 0:n.zijpaneel_aantal_rechts)||0,f=(n==null?void 0:n.type)==="schuifdeur"&&(n==null?void 0:n.zijpaneel_aantal_links)===0&&(n==null?void 0:n.zijpaneel_aantal_rechts)===0&&(n==null?void 0:n.verberg_rail_in_wand)!==!0;if(r==="Rechts"){switch(o=t?t[0]*1e3:0,o+=l*10,e){case"taatsdeur":o-=Ve.taatsDeurOffsetMmHandgreep,o-=Ve.taatsDeurSpelingMm;break;case"scharnierdeur":(n==null?void 0:n.handgreep)==="HANDGREEP_KLINK_1"?o-=Ve.scharnierDeurProfielSlotstijl:o-=Ve.scharnierDeurOffsetMmHandgreep,o-=Ve.scharnierDeurSpelingMm,c==1&&d===0&&(o-=Ve.scharnierDeurKozijnBreedteMm);break;case"schuifdeur":o-=Ve.schuifDeurOffsetMmHandgreep;break;case"opdekdeur":o-=Ve.opdekDeurOffsetMmHandgreep;break}(n==null?void 0:n.handgreep)==="HANDGREEP_KOKER_VOLLEDIG"&&(o-=Ve.taatsDeurHandgreepProfiellengteOffset)}if(r==="Links"){switch(o=t?t[0]*1e3:0,e){case"taatsdeur":o+=Ve.taatsDeurOffsetMmHandgreep,o+=Ve.taatsDeurSpelingMm;break;case"scharnierdeur":(n==null?void 0:n.handgreep)==="HANDGREEP_KLINK_1"?o+=Ve.scharnierDeurProfielSlotstijl:o+=Ve.scharnierDeurOffsetMmHandgreep,o+=Ve.scharnierDeurSpelingMm,c==1&&u==0&&(o+=Ve.scharnierDeurKozijnBreedteMm);break;case"schuifdeur":o+=Ve.schuifDeurOffsetMmHandgreep;break;case"opdekdeur":o+=Ve.opdekDeurOffsetMmHandgreep;break;case"vouwwand":o+=Ve.vouwwandOffsetMmHandgreep;break}(n==null?void 0:n.handgreep)==="HANDGREEP_KOKER_VOLLEDIG"&&(o+=Ve.taatsDeurHandgreepProfiellengteOffset)}return f&&(i=-125),e==="opdekdeur"&&(i=-125),a=1050,(n==null?void 0:n.handgreep)==="HANDGREEP_KOKER_VOLLEDIG"&&(a=0),(n==null?void 0:n.handgreep)==="FINEER_HANDGREEP_HOEKGREEP_1050"&&(a=10),(n==null?void 0:n.handgreep)==="FINEER_HANDGREEP_HOEKGREEP_1200"&&(a=10),s={x:o*.001,y:i*.001,z:a*.001},s}const h3e=XMLHttpRequest.prototype.open;XMLHttpRequest.prototype.open=function(n,e,...t){if(typeof e=="string"&&e.match(/\.(gltf|bin|png|jpg|jpeg|hdr|ktx2|xz|hdr)(\?|$)/i)){const r=e.includes("?")?"&":"?";e=`${e}${r}v=mlaxicsg`}return h3e.call(this,n,e,...t)};const p3e=window.fetch;window.fetch=function(n,e){if(typeof n=="string"&&n.match(/\.(gltf|bin|png|jpg|jpeg|hdr|ktx2|xz|hdr)(\?|$)/i)){const t=n.includes("?")?"&":"?";n=`${n}${t}v=mlaxicsg`}return p3e.call(this,n,e)};const vN={_promise:null,_font:null,init(n,e){return this._promise?this._promise:(this._promise=new Promise((t,r)=>{i2((n.endsWith("/")?n:n+"/")+"opentype.js",()=>{const o=new u3;o.setCrossOrigin("Anonymous"),o.load(e,i=>{this._font=new h3(i),t(this._font)},void 0,i=>r(i))},()=>r(new Error("opentype.js niet gevonden")))}),this._promise)},get(){return this._font?Promise.resolve(this._font):this._promise?this._promise:Promise.reject(new Error("GlobalFont.init() nog niet aangeroepen"))}};async function m3e({containerId:n,fsButtonId:e=null,sceneURL:t,baseUrl:r,apiUrl:o,deviceUuid:i,fullScreen:a,fullScreenTemplate:s,fontUrl:l=null}){var m;if(na.enabled=!0,l)try{await vN.init(r,l)}catch(g){console.warn("Font preload failed:",g)}const c=null;let u=null;u=d3e(u3e),await((m=u==null?void 0:u.loadPhysics)==null?void 0:m.call(u));let d={useFullscreen:!0};u&&(d=u.execInitPuzzles({container:n}).initOptions),t=d.useCompAssets?`${t}.xz`:t;const f=g3e(n,d),h=v3e(n,d,f,c,r,a,s,o),p=g=>{hr.doLog(o+"/api/ud",{event:"First render complete",loadingTime:g.target._loadingTime??"?",deviceUuid:i,clientDetails:h.clientDetails?h.clientDetails:{}}),h.removeEventListener("afterFirstRender",p)};return h.addEventListener("afterFirstRender",p),d.preloaderStartCb&&d.preloaderStartCb(),h.loadScene(t,()=>{h.enableControls(),h.run(),u&&u.init(h,d),y3e(h)},null,()=>{console.log(`Can't load the scene ${t}`)}),{app:h,PL:u}}function g3e(n,e,t){return e.useCustomPreloader?_3e(e.preloaderProgressCb,e.preloaderEndCb):new pN({container:n})}function _3e(n,e){function t(){Cc.call(this)}return t.prototype=Object.assign(Object.create(Cc.prototype),{onUpdate:function(r){Cc.prototype.onUpdate.call(this,r),n&&n(r)},onFinish:function(){Cc.prototype.onFinish.call(this),e&&e()}}),new t}function v3e(n,e,t,r,o,i,a,s){var u;const l={};e.useBkgTransp&&(l.alpha=!0),l.powerPreference="high-performance";const c=new fN(n,l,t);return e.useBkgTransp&&(c.clearBkgOnLoad=!0,c.renderer&&c.renderer.setClearColor(0,0)),c.baseUrl=o,c.apiUrl=s,c.fullScreen=i,c.fullScreenTemplate=a,o=o.endsWith("/")?o:o+"/",(u=c.loader)!=null&&u.ktx2Loader&&c.loader.ktx2Loader.setTranscoderPath(o),c.setFrameRateDivider(4),c.ExternalInterface={},c.configJSON_Data=null,c.configJSON_Type=null,A3e(c),c}function A3e(n){n.ExternalInterface.setClientDetails=function(e){n.clientDetails=e},n.ExternalInterface.setData=function(e,t){n.configJSON_Data=e,n.configJSON_Type=t},n.ExternalInterface.getBaseUrl=function(){return n.baseUrl},n.ExternalInterface.getApiUrl=function(){return n.apiUrl},n.ExternalInterface.getMaatvoeringScreenshot=function(){return n.fullScreen&&!n.fullScreenTemplate},n.ExternalInterface.getMakeScreenshot=function(){return n.fullScreen||n.fullScreenTemplate},n.ExternalInterface.getFullscreenTemplate=function(){return n.fullScreenTemplate},n.ExternalInterface.checkSchuifdeurVoorWand=function(e){return!e||typeof e!="object"?!1:(e==null?void 0:e.type)==="schuifdeur"&&(e==null?void 0:e.zijpaneel_aantal_links)===0&&(e==null?void 0:e.zijpaneel_aantal_rechts)===0&&(e==null?void 0:e.verberg_rail_in_wand)!==!0},n.ExternalInterface.getHandgreepPosition=function(e,t){return f3e(n.configJSON_Data,n.configJSON_Type,e,t)},n.ExternalInterface.getObjectData=function(e){return n.scene.getObjectByName(e)??null},n.ExternalInterface.formatDecimals=function(e){let t=parseFloat(e);return isNaN(t)?e:Number.isInteger(t)?t.toString():t.toFixed(1)},n.ExternalInterface.calcShapeKeyStaanderVerplaatsing=function(e,t){},n.ExternalInterface.customFunctionTaatsdeurZijpaneelRechtsCalculatePositieX=function(e,t,r,o){let i=0-parseFloat(o.offsetPositionX),a=parseInt(t.deur_aantal),s=parseFloat(t.breedte);switch(i+=a*s*.01,e){case 2:i+=parseFloat(t.zijpaneel_breedte_rechts[0])*.01;break;case 3:i+=(parseFloat(t.zijpaneel_breedte_rechts[0])+parseFloat(t.zijpaneel_breedte_rechts[1]))*.01;break;case 4:i+=(parseFloat(t.zijpaneel_breedte_rechts[0])+parseFloat(t.zijpaneel_breedte_rechts[1])+parseFloat(t.zijpaneel_breedte_rechts[2]))*.01;break}return i},n.ExternalInterface.customFunctionTaatsdeurZijpaneelLinksCalculatePositieX=function(e,t,r,o){let i=0-parseFloat(o.offsetPositionX),a=n.ExternalInterface.clamp(parseInt(t.zijpaneel_aantal_links),parseInt(0),parseInt(r.maxZijpanelenLinks));for(let s=e;s<=a;s++)i-=parseFloat(t.zijpaneel_breedte_links[s-1])*.01;return i},n.ExternalInterface.customFunctionVasteWandCalculatePositieX=function(e,t,r,o){let i=0,a=Array();a[1]=n.ExternalInterface.clamp(parseFloat(t.breedte),parseFloat(r.vasteWandMinBreedte),parseFloat(r.vasteWandMaxBreedte)),a[2]=n.ExternalInterface.clamp(parseFloat(t.breedte),parseFloat(r.vasteWandMinBreedte),parseFloat(r.vasteWandMaxBreedte)),a[3]=n.ExternalInterface.clamp(parseFloat(t.breedte),parseFloat(r.vasteWandMinBreedte),parseFloat(r.vasteWandMaxBreedte)),a[4]=n.ExternalInterface.clamp(parseFloat(t.breedte),parseFloat(r.vasteWandMinBreedte),parseFloat(r.vasteWandMaxBreedte)),a[5]=n.ExternalInterface.clamp(parseFloat(t.breedte),parseFloat(r.vasteWandMinBreedte),parseFloat(r.vasteWandMaxBreedte)),a[6]=n.ExternalInterface.clamp(parseFloat(t.breedte),parseFloat(r.vasteWandMinBreedte),parseFloat(r.vasteWandMaxBreedte)),t.deurbreedtevariabel&&(a[1]=n.ExternalInterface.clamp(parseFloat(t.variabeledeurbreedte_maten[0]),parseFloat(r.vasteWandMinBreedte),parseFloat(r.vasteWandMaxBreedte)),a[2]=n.ExternalInterface.clamp(parseFloat(t.variabeledeurbreedte_maten[1]),parseFloat(r.vasteWandMinBreedte),parseFloat(r.vasteWandMaxBreedte)),a[3]=n.ExternalInterface.clamp(parseFloat(t.variabeledeurbreedte_maten[2]),parseFloat(r.vasteWandMinBreedte),parseFloat(r.vasteWandMaxBreedte)),a[4]=n.ExternalInterface.clamp(parseFloat(t.variabeledeurbreedte_maten[3]),parseFloat(r.vasteWandMinBreedte),parseFloat(r.vasteWandMaxBreedte)),a[5]=n.ExternalInterface.clamp(parseFloat(t.variabeledeurbreedte_maten[4]),parseFloat(r.vasteWandMinBreedte),parseFloat(r.vasteWandMaxBreedte)),a[6]=n.ExternalInterface.clamp(parseFloat(t.variabeledeurbreedte_maten[5]),parseFloat(r.vasteWandMinBreedte),parseFloat(r.vasteWandMaxBreedte)));let s=n.ExternalInterface.clamp(parseInt(t.deur_aantal),parseInt(1),parseInt(r.vasteWandMaxPanelen));for(let l=e;l<=s;l++)i-=a[l]*.01;return i+=parseFloat(o.offsetPositionX),i},n.ExternalInterface.customFunctionSchuifdeurCalculatePositieX=function(e,t,r,o){let i=0;return i=n.ExternalInterface.clamp(parseFloat(t.breedte),parseFloat(r.schuifDeurMinBreedte),parseFloat(r.schuifDeurMaxBreedte))*.01*(e-1),i-=parseFloat(o.offsetPositionX),i},n.ExternalInterface.customFunctionSchuifdeurBovenrailCalculatePositieX=function(e,t,r){let o=0,i=parseInt(e.deur_aantal??1),a=parseInt(e.breedte??0),s=e.schuifrichting??"",l=(e==null?void 0:e.verberg_rail_in_wand)??!1;return i==1&&!l&&(s=="SCHUIF_RECHTS"?o=0:o-=a),i==2&&!l&&(o-=a),o=o*.01,o-=parseFloat(r.offsetPositionX),o},n.ExternalInterface.calcLiggerXPositieOffsetFrame=function(e,t){let r=0,o=(e==null?void 0:e.typeroede)??"";if(e!==void 0&&e.hasOwnProperty("type"))switch(e.type){case"vaste-wand":o=="T_ROEDE"&&(r=t.vasteWandOffsetMmLiggerTRoede),o=="PLATTE_ROEDE"&&(r=t.vasteWandOffsetMmLiggerStripRoede);break;case"taatsdeur":o=="T_ROEDE"&&(r=t.taatsDeurOffsetMmLiggerTRoede),o=="PLATTE_ROEDE"&&(r=t.taatsDeurOffsetMmLiggerStripRoede);break;case"scharnierdeur":o=="T_ROEDE"&&(r=t.scharnierDeurOffsetMmLiggerTRoede),o=="PLATTE_ROEDE"&&(r=t.scharnierDeurOffsetMmLiggerStripRoede);break;case"schuifdeur":o=="T_ROEDE"&&(r=t.schuifDeurOffsetMmLiggerTRoede),o=="PLATTE_ROEDE"&&(r=t.schuifDeurOffsetMmLiggerStripRoede);break;case"opdekdeur":o=="T_ROEDE"&&(r=t.opdekDeurOffsetMmLiggerTRoede),o=="PLATTE_ROEDE"&&(r=t.opdekDeurOffsetMmLiggerStripRoede);break;case"vouwwand":r=t.vouwwandOffsetMmLiggerStripRoede;break}return r*.001},n.ExternalInterface.calcLiggerBreedteX=function(e,t,r=1,o=""){let i=0,a=e.typeroede??"";if(e!==void 0&&e.hasOwnProperty("type"))switch(e.type){case"vaste-wand":a=="T_ROEDE"&&(i=t.vasteWandOffsetMmLiggerTRoede),a=="PLATTE_ROEDE"&&(i=t.vasteWandOffsetMmLiggerStripRoede);break;case"taatsdeur":a=="T_ROEDE"&&(i=t.taatsDeurOffsetMmLiggerTRoede),a=="PLATTE_ROEDE"&&(i=t.taatsDeurOffsetMmLiggerStripRoede);break;case"scharnierdeur":a=="T_ROEDE"&&(i=t.scharnierDeurOffsetMmLiggerTRoede),a=="PLATTE_ROEDE"&&(i=t.scharnierDeurOffsetMmLiggerStripRoede);break;case"schuifdeur":a=="T_ROEDE"&&(i=t.schuifDeurOffsetMmLiggerTRoede),a=="PLATTE_ROEDE"&&(i=t.schuifDeurOffsetMmLiggerStripRoede);break;case"opdekdeur":a=="T_ROEDE"&&(i=t.opdekDeurOffsetMmLiggerTRoede),a=="PLATTE_ROEDE"&&(i=t.opdekDeurOffsetMmLiggerStripRoede);break;case"vouwwand":i=t.vouwwandOffsetMmLiggerStripRoede;break}return o=="Zijlicht"&&(i-=13),i*.001*r},n.ExternalInterface.customFunctionBovenRailLengte=function(e,t){let r=parseInt(e.deur_aantal??1),o=parseInt(e.breedte??0),i=(e==null?void 0:e.verberg_rail_in_wand)??!1,a=o*r;return i?a=o*r:(r==1&&(a=o*2),r==2&&(a=o*r*2)),a},n.ExternalInterface.customFunctionGetPanelWidth=function(e,t){let r=0;if(e!==void 0&&e.hasOwnProperty("type"))switch(e.type){case"vaste-wand":e.deurbreedtevariabel?r=parseFloat(e.variabeledeurbreedte_maten[t-1]??0):r=parseFloat(e.breedte??0);break;default:r=parseFloat(e.breedte??0)}return r=parseFloat(r.toFixed(3)),{panelWidthCm:Number.isInteger(r)?String(r):String(r.toFixed(1)),panelWidthM:parseFloat(r.toFixed(3)*.01)}},n.ExternalInterface.calcShapeKeyStaanderVerplaatsing=function(e,t,r){let o=0;return e.asymmetrisch?o=e.asymmetrisch_staander_maten_deur[t*100+r]??0:o=n.ExternalInterface.customFunctionGetPanelWidth(e,t).panelWidthCm/(e.deur_aantal_staander+1)*r,o},n.ExternalInterface.clamp=function(e,t,r){return Math.max(t,Math.min(r,e))},n.ExternalInterface.customFunctionRALtoHEX=function(e=""){var t={ral1000:"#CDBA88",ral1001:"#D0B084",ral1002:"#D2AA6D",ral1003:"#F9A900",ral1004:"#E49E00",ral1005:"#CB8F00",ral1006:"#E19000",ral1007:"#E88C00",ral1011:"#AF8050",ral1012:"#DDAF28",ral1013:"#E3D9C7",ral1014:"#DDC49B",ral1015:"#E6D2B5",ral1016:"#F1DD39",ral1017:"#F6A951",ral1018:"#FACA31",ral1019:"#A48F7A",ral1020:"#A08F65",ral1021:"#F6B600",ral1023:"#F7B500",ral1024:"#BA8F4C",ral1026:"#FFFF00",ral1027:"#A77F0F",ral1028:"#FF9C00",ral1032:"#E2A300",ral1033:"#F99A1D",ral1034:"#EB9C52",ral1035:"#8F8370",ral1036:"#806440",ral1037:"#F09200",ral2000:"#DA6E00",ral2001:"#BA481C",ral2002:"#BF3922",ral2003:"#F67829",ral2004:"#E25304",ral2005:"#FF4D08",ral2007:"#FFB200",ral2008:"#EC6B22",ral2009:"#DE5308",ral2010:"#D05D29",ral2011:"#E26E0F",ral2012:"#D5654E",ral2013:"#923E25",ral2017:"#FC5500",ral3000:"#A72920",ral3001:"#9B2423",ral3002:"#9B2321",ral3003:"#861A22",ral3004:"#6B1C23",ral3005:"#59191F",ral3007:"#3E2022",ral3009:"#6D342D",ral3011:"#782423",ral3012:"#C5856D",ral3013:"#972E25",ral3014:"#CB7375",ral3015:"#D8A0A6",ral3016:"#A63D30",ral3017:"#CA555D",ral3018:"#C63F4A",ral3020:"#BB1F11",ral3022:"#CF6955",ral3024:"#FF2D21",ral3026:"#FF2A1C",ral3027:"#AB273C",ral3028:"#CC2C24",ral3031:"#A63437",ral3032:"#701D24",ral3033:"#A53A2E",ral4001:"#816183",ral4002:"#8D3C4B",ral4003:"#C4618C",ral4004:"#651E38",ral4005:"#76689A",ral4006:"#903373",ral4007:"#47243C",ral4008:"#844C82",ral4009:"#9D8692",ral4010:"#BB4077",ral4011:"#6E6387",ral4012:"#6A6B7F",ral5000:"#304F6E",ral5001:"#0E4C64",ral5002:"#00387A",ral5003:"#1F3855",ral5004:"#191E28",ral5005:"#005387",ral5007:"#376B8C",ral5008:"#2B3A44",ral5009:"#215F78",ral5010:"#004F7C",ral5011:"#1A2B3C",ral5012:"#0089B6",ral5013:"#193153",ral5014:"#637D96",ral5015:"#007CAF",ral5017:"#005B8C",ral5018:"#048B8C",ral5019:"#005E83",ral5020:"#00414B",ral5021:"#007577",ral5022:"#222D5A",ral5023:"#41698C",ral5024:"#6093AC",ral5025:"#20697C",ral5026:"#0F3052",ral6000:"#3C7460",ral6001:"#366735",ral6002:"#325928",ral6003:"#50533C",ral6004:"#024442",ral6005:"#114232",ral6006:"#3C392E",ral6007:"#2C3222",ral6008:"#36342A",ral6009:"#27352A",ral6010:"#4D6F39",ral6011:"#6B7C59",ral6012:"#2F3D3A",ral6013:"#7C765A",ral6014:"#474135",ral6015:"#3D3D36",ral6016:"#00694C",ral6017:"#587F40",ral6018:"#60993B",ral6019:"#B9CEAC",ral6020:"#37422F",ral6021:"#8A9977",ral6022:"#3A3327",ral6024:"#008351",ral6025:"#5E6E3B",ral6026:"#005F4E",ral6027:"#7EBAB5",ral6028:"#315442",ral6029:"#006F3D",ral6032:"#237F52",ral6033:"#45877F",ral6034:"#7AADAC",ral6035:"#194D25",ral6036:"#04574B",ral6037:"#008B29",ral6038:"#00B51B",ral6039:"#B3C43E",ral7000:"#7A888E",ral7001:"#8C979C",ral7002:"#817863",ral7003:"#797669",ral7004:"#9A9B9B",ral7005:"#6B6E6B",ral7006:"#766A5E",ral7008:"#745F3D",ral7009:"#5D6058",ral7010:"#585C56",ral7011:"#52595D",ral7012:"#575D5E",ral7013:"#575044",ral7015:"#4F5358",ral7016:"#383E42",ral7021:"#2F3234",ral7022:"#4C4A44",ral7023:"#808076",ral7024:"#45494E",ral7026:"#374345",ral7030:"#928E85",ral7031:"#5B686D",ral7032:"#B5B0A1",ral7033:"#7F8274",ral7034:"#92886F",ral7035:"#C5C7C4",ral7036:"#979392",ral7037:"#7A7B7A",ral7038:"#B0B0A9",ral7039:"#6B665E",ral7040:"#989EA1",ral7042:"#8E9291",ral7043:"#4F5250",ral7044:"#B7B3A8",ral7045:"#8D9295",ral7046:"#7E868A",ral7047:"#C8C8C7",ral7048:"#817B73",ral8000:"#89693F",ral8001:"#9D622B",ral8002:"#794D3E",ral8003:"#7E4B27",ral8004:"#8D4931",ral8007:"#70462B",ral8008:"#724A25",ral8011:"#5A3827",ral8012:"#66332B",ral8014:"#4A3526",ral8015:"#5E2F26",ral8016:"#4C2B20",ral8017:"#442F29",ral8019:"#3D3635",ral8022:"#1A1719",ral8023:"#A45729",ral8024:"#795038",ral8025:"#755847",ral8028:"#513A2A",ral8029:"#7F4031",ral9001:"#E9E0D2",ral9002:"#D6D5CB",ral9003:"#ECECE7",ral9004:"#2B2B2C",ral9005:"#0E0E10",ral9006:"#A1A1A0",ral9007:"#868581",ral9010:"#F1EDE1",ral9011:"#27292B",ral9012:"#F8F2E1",ral9016:"#F1F1EA",ral9017:"#29292A",ral9018:"#C8CBC4",ral9022:"#858583",ral9023:"#787B7A"};e=String(e);const r=e.replace(/\D/g,"");var i="ral"+parseInt(r);return t[i]?t[i]:"#1f1d20"},n.ExternalInterface.getDimensionOffsetZ=function(e,t,r=null){let o=0,i=0;switch(((e==null?void 0:e.zijpaneel_aantal_links)>0||(e==null?void 0:e.zijpaneel_aantal_rechts)>0)&&(e==null?void 0:e.zijpaneel_aantal_staander)>0&&(i=1),(e==null?void 0:e.deur_aantal_staander)>0&&(i=1),r){case"AfmetingenBovenkant":o=t*(3+i);break;case"AfmetingenBreedteDeur":o=t*(2+i);break;case"ZijpaneelFrame":o=t*(2+i);break;default:o=t*1}return n.ExternalInterface.checkSchuifdeurVoorWand(e)&&(o+=.1),o},n.ExternalInterface.createLine=function(e,t,r,o,i,a,s,l){const c=n.scene.getObjectByName(e);c&&n.scene.remove(c);const u=[{label:"startLocationX",value:r},{label:"startLocationY",value:o},{label:"startLocationZ",value:i},{label:"endLocationX",value:a},{label:"endLocationY",value:s},{label:"endLocationZ",value:l}];for(const m of u)if(typeof m.value!="number"||!Number.isFinite(m.value))return;let d=new _r({color:t}),f=[];f.push(e_(new N(r,o,i),"Y_UP_RIGHT","Z_UP_RIGHT",!0)),f.push(e_(new N(a,s,l),"Y_UP_RIGHT","Z_UP_RIGHT",!0));let h=new At().setFromPoints(f),p=new Ki(h,d);p.name=e,n.scene.add(p)},n.ExternalInterface.removeObjectsByName=function(e){n.scene.children.forEach(t=>{t.name&&t.name.includes(e)&&n.scene.remove(t)})},n.ExternalInterface.createDimensionText=function(e,t,r,o,i,a,s,l,c,u){vN.get().then(d=>{const f=n.scene.getObjectByName(e);f&&n.scene.remove(f);const h=new Ih(a,{font:d,size:s,height:l});h.center(),h.computeBoundingBox();const p=h.boundingBox,m=new N;p.getSize(m);const g=e_(new N(t,r,o),"Y_UP_RIGHT","Z_UP_RIGHT",!0),_=new pr({color:c}),A=new Mt(h,_);if(A.name=e,A.position.set(g.x,g.y,g.z),u){const x=new N(1,1,1);x.x*=-1,A.scale.multiply(x)}const y=new nc(m.x*1.4,m.y*1.5,.001),b=new Xu({color:"#383838",depthWrite:!1,polygonOffset:!0,polygonOffsetFactor:1,polygonOffsetUnits:1}),E=new Mt(y,b);E.position.set(0,0,-.001),E.name=e,A.add(E),n.scene.add(A)}).catch(d=>console.error("Error createDimensionText:",d))},n.ExternalInterface.createRectangle=function(e,t,r,o,i,a,s,l){const c=n.scene.getObjectByName(e);c&&n.scene.remove(c);const u=new nc(i,a,s),d=new Xu({color:l}),f=e_(new N(t,r,o),"Y_UP_RIGHT","Z_UP_RIGHT",!0),h=new Mt(u,d);h.position.set(f.x,f.y,f.z),h.name=e,n.scene.add(h)},n.ExternalInterface.calculateMinMaxDimensions=function(e,t){let r=0,o=0,i=0,a=0,s=0,l=0,c=0,u=0,d=0,f=0,h=0,p=0,m=(e.maatvoering_weergeven||n.ExternalInterface.getMaatvoeringScreenshot())??!1;if(e!==void 0&&e.hasOwnProperty("type"))switch(e.type){case"vaste-wand":if(e.deurbreedtevariabel){for(let g=1;g<=e.deur_aantal;g++)f+=e.variabeledeurbreedte_maten[g-1];r=f*.01}else r=parseInt(e.deur_aantal)*parseFloat(e.breedte)*.01;h=parseInt(e.hoogte),o=h*.01,p=r,c=parseFloat(p*.5);break;case"taatsdeur":if(f+=e.deur_aantal*e.breedte,parseInt(e.zijpaneel_aantal_links)>0)for(let g=1;g<=e.zijpaneel_aantal_links;g++)f+=e.zijpaneel_breedte_links[g-1];if(parseInt(e.zijpaneel_aantal_rechts)>0)for(let g=1;g<=e.zijpaneel_aantal_rechts;g++)f+=e.zijpaneel_breedte_rechts[g-1];if(r=f*.01,h=parseInt(e.hoogte),e.bovenlicht&&(h+=parseInt(e.hoogtebovenlicht)),o=h*.01,p+=e.deur_aantal*e.breedte*.5,parseInt(e.zijpaneel_aantal_rechts)>0)for(let g=1;g<=e.zijpaneel_aantal_rechts;g++)p+=e.zijpaneel_breedte_rechts[g-1]*.5;if(parseInt(e.zijpaneel_aantal_links)>0)for(let g=1;g<=e.zijpaneel_aantal_links;g++)p-=e.zijpaneel_breedte_links[g-1]*.5;c=parseFloat(p*.01);break;case"scharnierdeur":if(f+=e.deur_aantal*e.breedte,parseInt(e.zijpaneel_aantal_links)>0)for(let g=1;g<=e.zijpaneel_aantal_links;g++)f+=e.zijpaneel_breedte_links[g-1];if(parseInt(e.zijpaneel_aantal_rechts)>0)for(let g=1;g<=e.zijpaneel_aantal_rechts;g++)f+=e.zijpaneel_breedte_rechts[g-1];if(r=f*.01,h=parseInt(e.hoogte),e.bovenlicht&&(h+=parseInt(e.hoogtebovenlicht)),o=h*.01,p+=e.deur_aantal*e.breedte*.5,parseInt(e.zijpaneel_aantal_rechts)>0)for(let g=1;g<=e.zijpaneel_aantal_rechts;g++)p+=e.zijpaneel_breedte_rechts[g-1]*.5;if(parseInt(e.zijpaneel_aantal_links)>0)for(let g=1;g<=e.zijpaneel_aantal_links;g++)p-=e.zijpaneel_breedte_links[g-1]*.5;c=parseFloat(p*.01);break;case"schuifdeur":if(f+=e.deur_aantal*e.breedte,parseInt(e.zijpaneel_aantal_links)>0)for(let g=1;g<=e.zijpaneel_aantal_links;g++)f+=e.zijpaneel_breedte_links[g-1];if(parseInt(e.zijpaneel_aantal_rechts)>0)for(let g=1;g<=e.zijpaneel_aantal_rechts;g++)f+=e.zijpaneel_breedte_rechts[g-1];if(r=f*.01,h=parseInt(e.hoogte),e.bovenlicht&&(h+=parseInt(e.hoogtebovenlicht)),o=h*.01,p+=e.deur_aantal*e.breedte*.5,parseInt(e.zijpaneel_aantal_rechts)>0)for(let g=1;g<=e.zijpaneel_aantal_rechts;g++)p+=e.zijpaneel_breedte_rechts[g-1]*.5;if(parseInt(e.zijpaneel_aantal_links)>0)for(let g=1;g<=e.zijpaneel_aantal_links;g++)p-=e.zijpaneel_breedte_links[g-1]*.5;c=parseFloat(p*.01);break;case"opdekdeur":f+=e.deur_aantal*e.breedte,r=f*.01,h=parseInt(e.hoogte),o=h*.01,p+=e.deur_aantal*e.breedte*.5,c=parseFloat(p*.01);break;case"vouwwand":f+=e.deur_aantal*e.breedte,r=f*.01,h=parseInt(e.hoogte),o=h*.01,p+=e.deur_aantal*e.breedte*.5,c=parseFloat(p*.01);break;default:console.log("Oops")}return i=m?o+.5:o,a=parseFloat(r*.5),s=parseFloat(o*.5),l=parseFloat(i*.5),u=parseFloat(0-a),d=parseFloat(r-a),{offsetPositionX:parseFloat(c.toFixed(3)),totalWidth:parseFloat(r.toFixed(3)),totalHeight:parseFloat(o.toFixed(3)),totalHeightInclDimensions:parseFloat(i.toFixed(3)),middlePositionX:parseFloat(a.toFixed(3)),middlePositionZ:parseFloat(s.toFixed(3)),middlePositionZInclDimensions:parseFloat(l.toFixed(3)),minPositionX:parseFloat(u.toFixed(3)),maxPositionX:parseFloat(d.toFixed(3)),totalWidthCmString:Number.isInteger(r*100)?String(r*100):(r*100).toFixed(1)}},n.ExternalInterface.getRoedeConfiguratieBreedte=function(e,t){let r=e.breedte??0;if(e!==void 0&&e.hasOwnProperty("type"))switch(e.type){case"taatsdeur":r=e.breedte-7;break;case"scharnierdeur":e.deur_aantal>1?r=e.breedte-(Ve.scharnierDeurFrameBreedteMm+Ve.scharnierDeurSpelingMm)*.1:r=e.breedte-(Ve.scharnierDeurFrameBreedteMm+Ve.scharnierDeurSpelingMm*2)*.1,e.handgreep=="HANDGREEP_KLINK_1"&&(r-=Ve.scharnierDeurSmalslotStijlBreedteMm*.1);break;case"schuifdeur":r=e.breedte-6;break;case"opdekdeur":r=e.breedte-10.95;break}return r},n.ExternalInterface.getRoedeConfiguratieHoogte=function(e){let t=e.hoogte??0;if(e!==void 0&&e.hasOwnProperty("type"))switch(e.type){case"taatsdeur":t=e.hoogte-14.3;break;case"scharnierdeur":t=e.hoogte-10.5;break;case"schuifdeur":t=e.hoogte-14.2,e.zijpaneel_aantal_links===0&&e.zijpaneel_aantal_rechts===0&&(t+=7);break;case"opdekdeur":t=e.hoogte-7.35;break}return t},n.ExternalInterface.calcRoedeConfiguratiePositieOffsetX=function(e,t,r){let o=0;return o=e.breedte*.005,t==="scharnierdeur"&&e.handgreep==="HANDGREEP_KLINK_1"&&e.deur_aantal==1&&(e.draairichting==="DRAAI_RECHTS"?o+=Ve.scharnierDeurSmalslotStijlBreedteMm*.001*.5:o-=Ve.scharnierDeurSmalslotStijlBreedteMm*.001*.5),t==="opdekdeur"&&e.handgreep==="HANDGREEP_KLINK_1"&&(e.draairichting==="DRAAI_RECHTS"?o+=.02125:o-=.02125),o},n.ExternalInterface.getRoedeConfiguratiePositieY=function(e,t){let r=0;switch(t){case"opdekdeur":r=-.106;case"schuifdeur":e.zijpaneel_aantal_links===0&&e.zijpaneel_aantal_rechts===0&&(r=-.125);break}return r},n.ExternalInterface.getRoedeConfiguratiePositieZ=function(e){switch(e){case"taatsdeur":return .101;case"scharnierdeur":return .0465;case"schuifdeur":return .043;case"opdekdeur":return .04;default:return 0}},n.ExternalInterface.checkShapeKeyVerplaatsingRoedeConfiguratie=function(e,t,r,o){let i=!1,a=r.roede_design_roedes_doorlopen_zijlicht_bovenlicht??!0,s=o&&typeof o=="object"&&o.hasOwnProperty(r.roede_configuratie)?o[r.roede_configuratie]:[],l=[];return t=="Links"&&(l=s.Links),t=="Rechts"&&(parseInt(r.deur_aantal)>1?l=s.Links:l=s.Rechts),t=="Boven"&&(l=s.Boven??void 0),l&&l[e]!==void 0&&a&&(i=!0),i},n.ExternalInterface.calcShapeKeyVerplaatsingLiggerRoedeConfiguratie=function(e,t,r,o,i){var y,b,E,x,w,L;let a=o&&typeof o=="object"&&o.hasOwnProperty(r.roede_configuratie)?o[r.roede_configuratie]:[],s=[];t=="Links"&&(s=a.Links),t=="Rechts"&&(parseInt(r.deur_aantal)>1?s=a.Links:s=a.Rechts);let l=0,c=0,u=(300-n.ExternalInterface.getRoedeConfiguratieHoogte(r))/150,d=(150-n.ExternalInterface.getRoedeConfiguratieBreedte(r))/100,f=0,h=((y=s[e])==null?void 0:y.min_hoogte)??0,p=((b=s[e])==null?void 0:b.max_hoogte)??0;h!==0&&p!==0&&(l=((p-u*(p-h))*.001+n.ExternalInterface.getRoedeConfiguratiePositieZ(i))*100);let m=((E=s[e])==null?void 0:E.min_breedte)??0,g=((x=s[e])==null?void 0:x.max_breedte)??0;m!==0&&g!==0&&(l-=d*(g-m)*.1);let _=((w=s[e])==null?void 0:w.min_compensatie)??0,A=((L=s[e])==null?void 0:L.max_compensatie)??0;return _!==0&&A!==0&&(f=d>u?d:u,l-=f*(A-_)*.1),c=l,c},n.ExternalInterface.calcShapeKeyVerplaatsingStaanderRoedeConfiguratie=function(e,t,r,o){var f,h;let i=o&&typeof o=="object"&&o.hasOwnProperty(r.roede_configuratie)?o[r.roede_configuratie]:[],a=[];a=i.Boven;let s=0,l=0,c=(150-n.ExternalInterface.getRoedeConfiguratieBreedte(r))/100,u=((f=a[e])==null?void 0:f.min_breedte)??0,d=((h=a[e])==null?void 0:h.max_breedte)??0;return u!==0&&d!==0&&(s=(d-c*(d-u))*.001*100),t==="Mirror"?l=n.ExternalInterface.getRoedeConfiguratieBreedte(r)-s:l=s,l}}function y3e(n,e){n.render(),Lr.emit("configuratorLoaded")}function e_(n,e,t,r=!1){const o=n.y,i=n.z;return n.y=r?i:-i,n.z=o,n}const b3e={name:"V3DApp",props:{baseUrl:String,apiUrl:String,deviceUuid:String,fullScreen:Boolean,fullScreenTemplate:Boolean,fontUrl:String},created(){this.app=null,this.PL=null,this.uuid=hr.generateUUID(),this.containerId=`v3d-container-${this.uuid}`,this.sceneURL=this.baseUrl+"/v3dApp/aluw_configurator.gltf",this.loadApp=async function(){({app:this.app,PL:this.PL}=await m3e({containerId:this.containerId,fsButtonId:null,sceneURL:this.sceneURL,baseUrl:this.baseUrl,apiUrl:this.apiUrl,deviceUuid:this.deviceUuid,fullScreen:this.fullScreen,fullScreenTemplate:this.fullScreenTemplate,fontUrl:this.fontUrl}))},this.disposeApp=function(){var n,e;(n=this.app)==null||n.dispose(),this.app=null,(e=this.PL)==null||e.dispose(),this.PL=null}},mounted(){window.addEventListener("beforeunload",this.handleUnload),this.loadApp()},beforeUnmount(){window.removeEventListener("beforeunload",this.handleUnload),console.log("Disposing V3DApp"),this.disposeApp()},handleUnload(n){console.log("Page is closing"),this.disposeApp()}},x3e=["id"];function E3e(n,e,t,r,o,i){return he(),ye("div",{id:n.containerId,class:"h-full flex items-center justify-center"},[...e[0]||(e[0]=[XE('<div id="preloader_container" class="h-full flex items-center justify-center" data-v-6baf700f><div class="relative h-56 md:h-80 lg:h-110 flex items-center justify-center" data-v-6baf700f><svg class="h-full w-auto max-h-[500px]" viewBox="0 0 300 500" preserveAspectRatio="xMidYMid meet" xmlns="http://www.w3.org/2000/svg" data-v-6baf700f><path d="M50 50 H250 V450 H50 Z" class="line delay1" data-v-6baf700f></path><path d="M70 70 H230 V430 H70 Z" class="line delay2" data-v-6baf700f></path><line x1="150" y1="70" x2="150" y2="430" class="line delay3" data-v-6baf700f></line><line x1="70" y1="250" x2="230" y2="250" class="line delay4" data-v-6baf700f></line></svg></div></div>',1)])],8,x3e)}const C3e=Object.freeze(Object.defineProperty({__proto__:null,default:zi(b3e,[["render",E3e],["__scopeId","data-v-6baf700f"]])},Symbol.toStringTag,{value:"Module"}))})();
